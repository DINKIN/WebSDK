/**
 * Copyright 2018 PhenixP2P Inc. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("phenix-web-sdk",[],t):"object"==typeof exports?exports["phenix-web-sdk"]=t():e["phenix-web-sdk"]=t()}(this,function(){return function(i){var r={};function n(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return i[e].call(t.exports,t,t.exports,n),t.l=!0,t.exports}return n.m=i,n.c=r,n.i=function(e){return e},n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=105)}([function(e,t,i){var r,n;r=[i(60)],void 0===(n=function(e){"use strict";return e}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(50)],void 0===(n=function(e){return e}.apply(t,r))||(e.exports=n)},function(E,F,G){var I;I=function(L,M,N,O){return function(i){function r(e){if(n[e])return n[e].exports;var t=n[e]={i:e,l:!1,exports:{}};return i[e].call(t.exports,t,t.exports,r),t.l=!0,t.exports}var n={};return r.m=i,r.c=n,r.i=function(e){return e},r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=10)}([function(i,r,e){(function(e){var t;void 0===(t=function(){"use strict";return"object"==typeof window?window:"object"==typeof e?e:{}}.apply(r,[]))||(i.exports=t)}).call(r,e(9))},function(e,t){e.exports=L},function(e,t){e.exports=M},function(e,t,i){var r,n;r=[i(1),i(4),i(0)],void 0===(n=function(a,l,u){"use strict";function e(e,t,i){var r=this;this._ghost=e,this._stream=t,this._isUsingPlugin=i,this._events={};var n,s,o=function(e){r._loaded=!0,r._enabled=!0===e,e?d.call(r):f("Failed to create Phenix video element"),r._onReady&&r._onReady(r._enabled)};try{if(this._video=(n=i,s="{}".createElement("video"),n&&((s="{}".createElement("object")).type="application/x-phenix-video"),s),this._video.className=this._ghost.className,this._video.height=this._ghost.height,this._video.width=this._ghost.width,this._ghost.style.cssText="visibility:hidden !important;width:0px !important;height:0px !important;margin:0px !important;padding:0px !important;border-style:none !important;border-width:0px !important;max-width:0px !important;max-height:0px !important;outline:none !important",this._video.onunload=function(){r._loaded=!1},function(){var r=this;if(a.get(u,["MutationObserver"])){var e=new MutationObserver(function(e){e.forEach(function(e){if("childList"===e.type)for(var t=0;t<e.addedNodes.length;t++){var i=e.addedNodes[t];e.target!==r._video&&(i===r._ghost?(e.target.replaceChild(r._video,r._ghost),d.call(r)):h(e.target,r._ghost)&&(r._ghost.parentNode.replaceChild(r._video,r._ghost),d.call(r)))}})});e.observe("{}".body,{childList:!0,attributes:!1,characterData:!1,subtree:!0})}else p("Falling back to use of DOM event listeners. This results in degraded performance for further DOM modifications and does not work for IE prior to version 9. See https://developer.mozilla.org/en-US/docs/Web/Guide/Events/Mutation_events for details."),c(r._ghost,"DOMNodeInserted",function(){r._ghost.parentNode.replaceChild(r._video,r._ghost)})}.call(this),"{}".body&&"{}".body.contains||p("document.body.contains is not supported"),"{}".body&&"{}".body.contains&&"{}".body.contains(this._ghost)&&this._ghost.parentNode.replaceChild(this._video,this._ghost),!i)return o(!0);(new l).waitForReady(this._video,o)}catch(e){f("Error while loading Phenix RTC"+e),o(!1)}}function c(e,t,i){if(!this._isUsingPlugin)return this._video.addEventListener(e,t,i);var r=this._events[e];r||(r=this._events[e]=[],this._loaded&&n.call(this,e)),r.push(t)}function n(i){var r=this;r._video.phenixSetEventListener(i,function(){var e=r._events[i];if(e)for(var t=0;t<e.length;t++)e[t].apply(r,arguments)})}function i(e,t){var i;"{}".createEvent?(i="{}".createEvent("HTMLEvents")).initEvent(t,!0,!0):(i="{}".createEventObject()).eventType=t,i.eventName=t,setTimeout(function(){"{}".createEvent?e.dispatchEvent(i):e.fireEvent("on"+i.eventType,i)})}function d(){for(var e=Object.keys(this._events),t=0;t<e.length;t++)n.call(this,e[t]);this.hookUpEvents(),function(){var t=this,i=["style"];if(a.get(u,["MutationObserver"])){var e=new MutationObserver(function(e){e.forEach(function(e){"attributes"===e.type&&e.target===t._ghost&&-1===i.indexOf(e.attributeName)&&(t._video[e.attributeName]=t._ghost[e.attributeName])})});e.observe(t._ghost,{attributes:!0})}else p("Falling back to use of DOM event listeners. This results in degraded performance for further DOM modifications and does not work for IE prior to version 9. See https://developer.mozilla.org/en-US/docs/Web/Guide/Events/Mutation_events for details."),t._ghost.addEventListener?t._ghost.addEventListener("DOMAttrModified",function(e){t._video[e.target.tagName]=t._ghost[e.target.tagName]},!1):t._ghost.attachEvent("onpropertychange",function(e){t._video[e.target.tagName]=t._ghost[e.target.tagName]})}.call(this),this._video.id=this._ghost.id,this._video.style.cssText=this._ghost.cssText,this._video.className=this._ghost.className,this._video.innerHtml=this._ghost.innerHtml,this._video.width=this._ghost.width,this._video.height=this._ghost.height,this._video.autoplay=this._ghost.autoplay,this._video.muted=this._ghost.muted,this._video.defaultMuted=this._ghost.defaultMuted,this._video.volume=this._ghost.volume,this._stream&&(this._video.src=this._stream)}function h(e,t){for(var i=t.parentNode;null!==i;){if(i===e)return!0;i=i.parentNode}return!1}var p=function(){console.log.apply(console,arguments)},f=function(){console.error.apply(console,arguments)};return e.prototype.hookUpEvents=function(){var e=this,t=this._ghost;this.addEventListener("error",function(){i(t,"error")}),this.addEventListener("mute",function(){t.muted=e._video.muted,i(t,"mute")}),this.addEventListener("unmute",function(){t.muted=e._video.muted,i(t,"unmute")}),this.addEventListener("ended",function(){t.ended=e._video.ended,i(t,"ended")}),this.addEventListener("loadedmetadata",function(){t.width=e._video.width,t.height=e._video.height,i(t,"loadedmetadata")}),this.addEventListener("loadeddata",function(){t.width=e._video.width,t.height=e._video.height,i(t,"loadeddata")}),this.addEventListener("resize",function(){t.width=e._video.width,t.height=e._video.height,i(t,"resize")})},e.prototype.onReady=function(e){var t=this;this._loaded?setTimeout(function(){e(t._enabled)},1):this._onReady=e},e.prototype.getElement=function(){return this._video},e.prototype.addEventListener=function(e,t,i){c.call(this,e,t,i)},e.prototype.removeEventListener=function(e,t,i){(function(e,t,i){if(!this._isUsingPlugin)return this._video.removeEventListener(e,t,i);var r=this._events[e];if(r){var n=r.indexOf(t);0<=n&&(0<(r=r.splice(n,1)).length?this._events[e]=r:delete this._events[e])}}).call(this,e,t,i)},e}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(2)],void 0===(n=function(e){"use strict";function t(e){this._timeout=e||15e3}var l=new e(navigator.userAgent).detect(),u=function(){console.error.apply(console,arguments)};return t.prototype.waitForReadyWithTimeout=function(t,i,r){var n=!1,s=1,o=s,a=function(e){n||(n=!0,i(e))};t.hasOwnProperty&&t.hasOwnProperty("onload")||"IE"!==l.browser&&u("No means of detecting when <object> is loaded"),t.onload=function(){a(!0)},function e(){4===t.readyState?a(!0):t.phenixVersion?a(!0):(s=Math.min(s+1e3,2*s),r<(o+=s)?(u("Timed out while waiting for <object> to load"),a(!1)):setTimeout(e,s))}()},t.prototype.waitForReady=function(e,t){e.phenixVersion?t(!0):this.waitForReadyWithTimeout(e,t,this._timeout)},t}.apply(t,r))||(e.exports=n)},function(e,t){e.exports=N},function(e,t){e.exports=O},function(e,t,i){var r,n;r=[i(1),i(5),i(6),i(2),i(0),i(12),i(11)],void 0===(n=function(i,e,t,r,n,s,o){"use strict";function a(){if(i.assign(u,s()),o.isSupported()){u.phenixSupported=!0;var e=new o,t=function(){u.RTCPeerConnection=e.getRTCPeerConnectionConstructor(),u.RTCSessionDescription=e.getRTCSessionDescriptionConstructor(),u.RTCIceCandidate=e.getRTCIceCandidateConstructor(),u.getSources=e.getSourcesDelegate(),u.getUserMedia=e.getUserMediaDelegate(),u.getStats=e.getStatsDelegate(),Function.prototype.bind?(u.attachMediaStream=e.attachMediaStream.bind(e),u.reattachMediaStream=e.reattachMediaStream.bind(e),u.isPhenixEnabled=e.isEnabled.bind(e)):(u.attachMediaStream=function(){e.attachMediaStream.apply(e,arguments)},u.reattachMediaStream=function(){e.reattachMediaStream.apply(e,arguments)},u.isPhenixEnabled=function(){return e.isEnabled()}),u.webrtcSupported=!0,u.phenixSupported=!0,u.phenixVersion=e.getVersion(),u.onLoaded&&u.onLoaded.call()};e.isEnabled()?t():e.onReady(function(e){e&&(t(),u.onload&&"function"==typeof u.onload&&u.onload())}),e.onLoaded(function(){t()})}else u.phenixSupported=!1;return u}var l=new r(navigator.userAgent).detect(),u={browser:l.browser,browserVersion:l.version,phenixSupported:!1,isPhenixEnabled:function(){return!1},onLoaded:void 0,global:n};return i.assign(a(),{shim:a})}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0)],void 0===(n=function(t){"use strict";return function(e){t.RTCPeerConnection=e.RTCPeerConnection,t.RTCSessionDescription=e.RTCSessionDescription,t.RTCIceCandidate=e.RTCIceCandidate}}.apply(t,r))||(e.exports=n)},function(Hc,Ic){var Jc;Jc=function(){return this}();try{Jc=Jc||Function("return this")()||eval("this")}catch(e){"object"==typeof window&&(Jc=window)}Hc.exports=Jc},function(e,t,i){"use strict";var r,n;r=[i(7),i(8)],void 0===(n=function(e,t){return e.onLoaded=function(){t(e)},e.onLoaded(),e}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(1),i(5),i(6),i(4),i(3)],void 0===(n=function(s,i,o,n,r){"use strict";function e(){var e,t=this;this._root=((e="{}".createElement("div")).id="phenixRTC",e.style.cssText="visibility:hidden !important;width:0px !important;height:0px !important;margin:0px !important;padding:0px !important;border-style:none !important;border-width:0px !important;max-width:0px !important;max-height:0px !important;outline:none !important","{}".body.appendChild(e),e),this._version="?";var i,r;try{this._phenixRTC=(i=this._root,(r="{}".createElement("object")).type="application/x-phenix-rtc",i.appendChild(r),r),this._phenixRTC.onunload=function(){t._loaded=!1},(new n).waitForReady(this._phenixRTC,function(e){t._loaded=!0,t._enabled=!0===e,t._version=t._phenixRTC.phenixVersion||"?.?.?.?",c(e?"Phenix RTC "+t._version:"No Phenix RTC"),t._onReady&&t._onReady(t._enabled)})}catch(e){d("Error while loading Phenix RTC"+e)}}function a(){this._root&&"{}".getElementById("phenixRTC")!==this._root&&("{}".body.appendChild(this._root),this._onLoaded&&this._onLoaded.call(this))}function t(t){var i=function(){var e=null;switch(arguments.length){case 0:e=new t;break;case 1:e=new t(arguments[0]);break;case 2:e=new t(arguments[0],arguments[1]);break;case 3:e=new t(arguments[0],arguments[1],arguments[2]);break;case 4:e=new t(arguments[0],arguments[1],arguments[2],arguments[3]);break;case 5:e=new t(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]);break;default:throw new Error("Unsupported number of arguments in Phenix Object Constructor")}return e.phenixAddEventListener=s.bind(l,e),e.phenixRemoveEventListener=s.bind(u,e),e};return s.forOwn(t,function(e,t){i[t]=e}),i}function l(e,t){i.stringNotEmpty(e,"name"),i.isFunction(t,"listener"),function(r){if(!this.events||!this.events[r]){this.events||(this.events={});var n=this.events;n[r]={observable:(new o.Observable).extend({timeout:0}),subscription:null,listeners:[]},this.phenixSetEventListener(r,s.bind(n[r].observable.setValue,n[r].observable)),n[r].subscription=n[r].observable.subscribe(function(t){var e=n[r],i=e.listeners;s.forEach(i,function(e){e(t)})})}}.call(this,e),function(e,t){if(!this.events||!this.events[e])throw new Error("No event observable for event: "+name);this.events[e].listeners.push(t)}.call(this,e,t)}function u(e,t){(function(e,t){this.events&&this.events.events[e]&&(this.events[e].listeners=s.filter(this.events[e].listeners,function(e){return t!==e}))}).call(this,e,t)}var c=function(){console.log.apply(console,arguments)},d=function(){console.error.apply(console,arguments)};return e.prototype.onReady=function(e){var t=this;this._loaded?setTimeout(function(){e(t._enabled)},1):this._onReady=e},e.prototype.onLoaded=function(e){this._onLoaded=e},e.prototype.isLoaded=function(){return!0===this._loaded},e.isSupported=function(){if(navigator.plugins)for(var e=navigator.plugins,t=0;t<e.length;t++)if(0<=e[t].name.indexOf("PhenixRTC"))return!0;if(navigator.userAgent&&(navigator.userAgent.match(/MSIE/)||navigator.userAgent.match(/Trident/)))try{return new window.ActiveXObject("PhenixP2P.RTC"),!0}catch(e){return!1}return!1},e.prototype.isEnabled=function(){return a.call(this),this._phenixRTC&&void 0!==this._phenixRTC.phenixVersion},e.prototype.getVersion=function(){return a.call(this),this._version},e.prototype.getRTCPeerConnectionConstructor=function(){return a.call(this),t(this._phenixRTC.RTCPeerConnection)},e.prototype.getRTCSessionDescriptionConstructor=function(){return a.call(this),t(this._phenixRTC.RTCSessionDescription)},e.prototype.getRTCIceCandidateConstructor=function(){return a.call(this),t(this._phenixRTC.RTCIceCandidate)},e.prototype.getSourcesDelegate=function(){var t=this;return function(e){return a.call(t),t._phenixRTC.getSources(e)}},e.prototype.getUserMediaDelegate=function(){var r=this;return function(e,t,i){return a.call(r),r._phenixRTC.getUserMedia(e,t,i)}},e.prototype.getStatsDelegate=function(){return function(e,t,i,r){return e.getStats(t,i,r)}},e.prototype.attachMediaStream=function(e,t){return a.call(this),function(e,t){if(!e)throw new Error("Can not attach a stream to a undefined element");if(e.phenixVersion)return e.src=t,e;var i=new r(e,t,!0);return(i.getElement().phenixPresenter=i).getElement()}.call(this,e,t)},e.prototype.reattachMediaStream=function(e,t){return a.call(this),this.attachMediaStream(e,t.src)},e}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(1),i(2),i(13),i(0),i(3)],void 0===(n=function(a,e,t,n,i){"use strict";function r(e,t,i){var r=a.bind(s,this,e,t,i);return navigator&&a.isFunction(navigator.getUserMedia)?navigator.getUserMedia(e,r,i):n&&a.isFunction(n.getUserMedia)?n.getUserMedia(e,r,i):void 0}function s(n,s,o,a){setTimeout(function(){for(var e=a.getTracks(),t=0;t<e.length;t++){var i=e[t];if(i.onended=function(e){f(e.timeStamp,"Track",i.id,i.label,"ended")},f("Track",i.id,i.label,e[t].kind,"readyState=",e[t].readyState),"ended"===i.readyState)return l("User media not available",o,e)}var r=(n.audio?1:0)+(n.video?1:0);return e.length!==r?l("Unable to get all requested user media.",o,e):void s(a)},100)}function l(e,t,i){try{var r=new Error(e);r.code="unavailable",t(r)}finally{!function(e){for(var t=0;t<e.length;t++)e[t].stop()}(i)}}function o(i,r){if("input"!==i&&"output"!==i)throw new Error("Unsupported device type "+i);navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices().then(function(e){var t=[];e.forEach(function(e){e.kind==="audio"+i?t.push({kind:"audio",id:e.deviceId,label:e.label}):e.kind==="video"+i&&t.push({kind:"video",id:e.deviceId,label:e.label})}),r(t)})}function u(e,t){return void 0!==e.srcObject?e.srcObject=t:void 0!==e.mozSrcObject?e.mozSrcObject=t:void 0!==e.src?e.src=URL.createObjectURL(t):f("Error attaching stream to element."),e.play(),e}function c(e,t){return e.src=t,e.play(),e}function d(e,t){return e.src=t.src,e}function h(e,t,i){t(function(t,e){switch(m.browser){case"Edge":e.forEach(function(e){e.mediaType=function(e,t){var i;if(t)return r=e,n=function(e){a.startsWith(e,"video")&&a.includes(e.toLowerCase(),t.toLowerCase())&&(i="video"),a.startsWith(e,"audio")&&a.includes(e.toLowerCase(),t.toLowerCase())&&(i="audio")},s=r.localDescription.sdp.split("m="),o=r.remoteDescription.sdp.split("m="),s.length===o.length&&a.findIndex(s,function(e,t){return n(e,t,o)}),i;var r,n,s,o}(t,e.codecId),e.bytesSent=p(e.packetsSent,e.mediaType),e.bytesReceived=p(e.packetsReceived,e.mediaType)});break;case"Safari":e.forEach(function(e){a.includes(e.id.toLowerCase(),"audio")&&a.includes(e.id.toLowerCase(),"rtp")&&(e.mediaType="audio"),a.includes(e.id.toLowerCase(),"video")&&a.includes(e.id.toLowerCase(),"rtp")&&(e.mediaType="video")})}return e}(e,i))}function p(e,t){var i=parseInt(e)||0;return"audio"===t?100*i:"video"===t?1080*i:void 0}var f=function(){console.log.apply(console,arguments)},m=new e(navigator.userAgent).detect(),g=n.RTCPeerConnection,y=n.RTCSessionDescription,v=n.RTCIceCandidate,b=null,_=null,w=null,S=null,E=null,T=null,k=null,I=!1;return function(){!function(){if(g=n.RTCPeerConnection,y=n.RTCSessionDescription,v=n.RTCIceCandidate,navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(b=a.bind(o,null,"input")),navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(_=a.bind(o,null,"output")),(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||n.getUserMedia)&&(w=r),!n.RTCPeerConnection)return f("[%s] browser version [%s] does not appear to be WebRTC-capable",m.browser,m.version);switch(m.browser){case"Firefox":f("Firefox detected",m),E=function(e,t){f("Attaching media stream");var i=e.muted;return 57<m.version&&(e.srcObject=t),e.mozSrcObject=t,e.play(),!0===i&&(e.muted=!0),e},k=function(e,t){f("Reattaching media stream");var i=e.muted;return 57<m.version&&(e.srcObject=t.srcObject),e.mozSrcObject=t.mozSrcObject,e.play(),!0===i&&(e.muted=!0),e},S=function(e,t,i,r){e.getStats(t,a.bind(h,this,e,i),r)},I=!0;break;case"Opera":f("Opera detected",m),E=u,k=d,S=function(e,t,i,r){e.getStats(a.bind(h,this,e,i),t,r)},I=!0;break;case"Chrome":f("Webkit detected",m),E=u,k=d,S=function(e,t,i,r){e.getStats(a.bind(h,this,e,i),t,r)},I=!0;break;case"Edge":f("Edge detected",m),E=u,k=d,S=function(e,t,i,r){e.getStats(t,a.bind(h,this,e,i),r)},I=!0;break;case"Safari":f("Safari detected",m),E=function(e,t){return a.isObject(t)&&(e.__phenixHasPlayedWebRtc=!0),u(e,t)},T=function(e,t){return e.__phenixHasPlayedWebRtc?((e=new i(e,t,!1).getElement()).play(),e):c(e,t)},k=d,S=function(e,t,i,r){e.getStats(t).then(a.bind(h,this,e,i),r)},I=!0;break;case"ReactNative":f("React Native detected",m),E=function(){f("attachMediaStream not supported in React Native environment")},T=function(){f("attachUriStream not supported in React Native environment")},k=function(){f("reattachMediaStream not supported in React Native environment")},S=function(e,t,i,r){e.getStats(t).then(a.bind(h,this,e,i),r)},I=!0;break;default:f("Browser does not appear to be WebRTC-capable",m)}}();var e={RTCPeerConnection:g,RTCSessionDescription:y,RTCIceCandidate:v,getSources:b,getDestinations:_,getUserMedia:w,getStats:S,attachMediaStream:E,attachUriStream:T||c,reattachMediaStream:k,webrtcSupported:I,exportGlobal:function(){n.RTCPeerConnection=e.RTCPeerConnection,n.RTCSessionDescription=e.RTCSessionDescription,n.RTCIceCandidate=e.RTCIceCandidate}};return e}}.apply(t,r))||(e.exports=n)},function(e,t,i){var r;void 0===(r=function(){"use strict";return function(){}}.apply(t,[]))||(e.exports=r)}])},E.exports=I(G(0),G(25),G(1),G(4))},function(e,t,i){var r,n;r=[i(56),i(57)],void 0===(n=function(e,t){return{Disposable:e,DisposableList:t}}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(28),i(64),i(65)],void 0===(n=function(e,t,i){"use strict";return{Observable:e,ObservableArray:t,ObservableMonitor:i}}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(26),i(58)],void 0===(n=function(e,t){return{Event:e,NamedEvents:t}}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(59)],void 0===(n=function(e){"use strict";return e}.apply(t,r))||(e.exports=n)},function(e,t,i){var r;void 0===(r=function(){"use strict";return{networkStates:{networkEmpty:{id:0,name:"NETWORK_EMPTY"},networkIdle:{id:1,name:"NETWORK_IDLE"},networkLoading:{id:2,name:"NETWORK_LOADING"},networkNoSource:{id:3,name:"NETWORK_NO_SOURCE"}},types:{realTime:{id:0,name:"RealTime"},dash:{id:1,name:"dash"},hls:{id:2,name:"hls"}},streamEvents:{playerEnded:{id:0,name:"playerended"},playerError:{id:1,name:"playererror"},stopped:{id:2,name:"stopped"}},rendererEvents:{ended:{id:0,name:"ended"},error:{id:1,name:"error"}}}}.apply(t,[]))||(e.exports=r)},function(e,t,i){var r,n;r=[i(62),i(61),i(14)],void 0===(n=function(e,t,i){"use strict";return{createLogger:function(){return new e},Logger:e,ConsoleAppender:t,level:i.level}}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(1),i(5)],void 0===(n=function(i,t,r){"use strict";function e(e,t){if(!e)throw new Error("'logger' must be specified.");this._logger=e,this._dimensionsChangedEvent=new r.Event,this._dimensionsChangedIntervalId=null,this._toBeStarted=!1,this._videoElement=null,this._dimensionsChangedData={pollFrequency:500,previousWidth:0,previousHeight:0},t&&t.pollFrequency&&(this._dimensionsChangedData.pollFrequency=15<=t.pollFrequency?t.pollFrequency:15),this._renderer=null}function n(){if(this._toBeStarted&&!this._dimensionsChangedIntervalId&&0!==this._dimensionsChangedEvent.size()){var e=this;this._dimensionsChangedData.previousWidth=this._videoElement.videoWidth,this._dimensionsChangedData.previousHeight=this._videoElement.videoHeight,this._dimensionsChangedIntervalId=setInterval(function(){e._videoElement.videoWidth===e._dimensionsChangedData.previousWidth&&e._videoElement.videoHeight===e._dimensionsChangedData.previousHeight||(e._dimensionsChangedData.previousWidth=e._videoElement.videoWidth,e._dimensionsChangedData.previousHeight=e._videoElement.videoHeight,e._dimensionsChangedEvent.fireAsync([e._renderer,{width:e._videoElement.videoWidth,height:e._videoElement.videoHeight}]))},e._dimensionsChangedData.pollFrequency)}}return e.prototype.start=function(e,t){(function(e,t){t&&!i.isUndefined(t.videoWidth)||this._logger.warn("Attempting to start dimensions changed monitor without providing proper 'video' element.");this._renderer=e,this._videoElement=t,this._toBeStarted=!0,n.call(this)}).call(this,e,t)},e.prototype.stop=function(){(function(){this._toBeStarted=!1,this._dimensionsChangedIntervalId&&(clearInterval(this._dimensionsChangedIntervalId),this._dimensionsChangedIntervalId=null);this._dimensionsChangedEvent.dispose()}).call(this)},e.prototype.addVideoDisplayDimensionsChangedCallback=function(e){return t.isFunction(e,"addVideoDisplayDimensionsChangedCallback"),n.call(this),this._dimensionsChangedEvent.listen(e)},e.prototype.toString=function(){return"DimensionsChangedMonitor[pollFrequency="+this._dimensionsChangedData.pollFrequency+", previousHeight="+this._dimensionsChangedData.previousHeight+", previousWidth="+this._dimensionsChangedData.previousHeight+", state="+(this._dimensionsChangedIntervalId?"running":"stopped")+"]"},e}.apply(t,r))||(e.exports=n)},function(e,t,i){var r;void 0===(r=function(){"use strict";return{roles:{participant:{id:0,name:"Participant"},moderator:{id:1,name:"Moderator"},presenter:{id:2,name:"Presenter"},audience:{id:3,name:"Audience"}},states:{active:{id:0,name:"Active"},passive:{id:1,name:"Passive"},handRaised:{id:2,name:"HandRaised"},inactive:{id:3,name:"Inactive"},offline:{id:4,name:"Offline"}}}}.apply(t,[]))||(e.exports=r)},function(e,t,i){var r;void 0===(r=function(){"use strict";return{types:{directChat:{id:0,name:"DirectChat"},multiPartyChat:{id:1,name:"MultiPartyChat"},moderatedChat:{id:2,name:"ModeratedChat"},townHall:{id:3,name:"TownHall"},channel:{id:4,name:"Channel"}},events:{memberJoined:{id:0,name:"MemberJoined"},memberLeft:{id:1,name:"MemberLeft"},memberUpdated:{id:2,name:"MemberUpdated"},roomUpdated:{id:3,name:"RoomUpdated"},roomEnded:{id:4,name:"RoomEnded"}}}}.apply(t,[]))||(e.exports=r)},function(e,t,i){var r,n,s,o;o=function(l){"use strict";var f=function(e,t,i){if(void 0===e&&(e=f.DEFAULT_CAPACITY),void 0===t&&(t=f.DEFAULT_ENDIAN),void 0===i&&(i=f.DEFAULT_NOASSERT),!i){if((e|=0)<0)throw RangeError("Illegal capacity");t=!!t,i=!!i}this.buffer=0===e?s:new ArrayBuffer(e),this.view=0===e?null:new Uint8Array(this.buffer),this.offset=0,this.markedOffset=-1,this.limit=e,this.littleEndian=t,this.noAssert=i};f.VERSION="5.0.1",f.LITTLE_ENDIAN=!0,f.BIG_ENDIAN=!1,f.DEFAULT_CAPACITY=16,f.DEFAULT_ENDIAN=f.BIG_ENDIAN,f.DEFAULT_NOASSERT=!1,f.Long=l||null;var o=f.prototype;o.__isByteBuffer__,Object.defineProperty(o,"__isByteBuffer__",{value:!0,enumerable:!1,configurable:!1});var s=new ArrayBuffer(0),i=String.fromCharCode;function a(e){var t=0;return function(){return t<e.length?e.charCodeAt(t++):null}}function u(){var e=[],t=[];return function(){if(0===arguments.length)return t.join("")+i.apply(String,e);1024<e.length+arguments.length&&(t.push(i.apply(String,e)),e.length=0),Array.prototype.push.apply(e,arguments)}}function r(e,t,i,r,n){var s,o,a=8*n-r-1,l=(1<<a)-1,u=l>>1,c=-7,d=i?n-1:0,h=i?-1:1,p=e[t+d];for(d+=h,s=p&(1<<-c)-1,p>>=-c,c+=a;0<c;s=256*s+e[t+d],d+=h,c-=8);for(o=s&(1<<-c)-1,s>>=-c,c+=r;0<c;o=256*o+e[t+d],d+=h,c-=8);if(0===s)s=1-u;else{if(s===l)return o?NaN:1/0*(p?-1:1);o+=Math.pow(2,r),s-=u}return(p?-1:1)*o*Math.pow(2,s-r)}function n(e,t,i,r,n,s){var o,a,l,u=8*s-n-1,c=(1<<u)-1,d=c>>1,h=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:s-1,f=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=c):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),2<=(t+=1<=o+d?h/l:h*Math.pow(2,1-d))*l&&(o++,l/=2),c<=o+d?(a=0,o=c):1<=o+d?(a=(t*l-1)*Math.pow(2,n),o+=d):(a=t*Math.pow(2,d-1)*Math.pow(2,n),o=0));8<=n;e[i+p]=255&a,p+=f,a/=256,n-=8);for(o=o<<n|a,u+=n;0<u;e[i+p]=255&o,p+=f,o/=256,u-=8);e[i+p-f]|=128*m}f.accessor=function(){return Uint8Array},f.allocate=function(e,t,i){return new f(e,t,i)},f.concat=function(e,t,i,r){"boolean"!=typeof t&&"string"==typeof t||(r=i,i=t,t=void 0);for(var n,s=0,o=0,a=e.length;o<a;++o)f.isByteBuffer(e[o])||(e[o]=f.wrap(e[o],t)),0<(n=e[o].limit-e[o].offset)&&(s+=n);if(0===s)return new f(0,i,r);var l,u=new f(s,i,r);for(o=0;o<a;)(n=(l=e[o++]).limit-l.offset)<=0||(u.view.set(l.view.subarray(l.offset,l.limit),u.offset),u.offset+=n);return u.limit=u.offset,u.offset=0,u},f.isByteBuffer=function(e){return!0===(e&&e.__isByteBuffer__)},f.type=function(){return ArrayBuffer},f.wrap=function(e,t,i,r){if("string"!=typeof t&&(r=i,i=t,t=void 0),"string"==typeof e)switch(void 0===t&&(t="utf8"),t){case"base64":return f.fromBase64(e,i);case"hex":return f.fromHex(e,i);case"binary":return f.fromBinary(e,i);case"utf8":return f.fromUTF8(e,i);case"debug":return f.fromDebug(e,i);default:throw Error("Unsupported encoding: "+t)}if(null===e||"object"!=typeof e)throw TypeError("Illegal buffer");var n;if(f.isByteBuffer(e))return(n=o.clone.call(e)).markedOffset=-1,n;if(e instanceof Uint8Array)n=new f(0,i,r),0<e.length&&(n.buffer=e.buffer,n.offset=e.byteOffset,n.limit=e.byteOffset+e.byteLength,n.view=new Uint8Array(e.buffer));else if(e instanceof ArrayBuffer)n=new f(0,i,r),0<e.byteLength&&(n.buffer=e,n.offset=0,n.limit=e.byteLength,n.view=0<e.byteLength?new Uint8Array(e):null);else{if("[object Array]"!==Object.prototype.toString.call(e))throw TypeError("Illegal buffer");(n=new f(e.length,i,r)).limit=e.length;for(var s=0;s<e.length;++s)n.view[s]=e[s]}return n},o.writeBitSet=function(e,t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if(!(e instanceof Array))throw TypeError("Illegal BitSet: Not an array");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}var r,n=t,s=e.length,o=s>>3,a=0;for(t+=this.writeVarint32(s,t);o--;)r=1&!!e[a++]|(1&!!e[a++])<<1|(1&!!e[a++])<<2|(1&!!e[a++])<<3|(1&!!e[a++])<<4|(1&!!e[a++])<<5|(1&!!e[a++])<<6|(1&!!e[a++])<<7,this.writeByte(r,t++);if(a<s){var l=0;for(r=0;a<s;)r|=(1&!!e[a++])<<l++;this.writeByte(r,t++)}return i?(this.offset=t,this):t-n},o.readBitSet=function(e){var t=void 0===e;t&&(e=this.offset);var i,r=this.readVarint32(e),n=r.value,s=n>>3,o=0,a=[];for(e+=r.length;s--;)i=this.readByte(e++),a[o++]=!!(1&i),a[o++]=!!(2&i),a[o++]=!!(4&i),a[o++]=!!(8&i),a[o++]=!!(16&i),a[o++]=!!(32&i),a[o++]=!!(64&i),a[o++]=!!(128&i);if(o<n){var l=0;for(i=this.readByte(e++);o<n;)a[o++]=!!(i>>l++&1)}return t&&(this.offset=e),a},o.readBytes=function(e,t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+e>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+"+e+") <= "+this.buffer.byteLength)}var r=this.slice(t,t+e);return i&&(this.offset+=e),r},o.writeBytes=o.append,o.writeInt8=function(e,t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=1;var r=this.buffer.byteLength;return r<t&&this.resize((r*=2)>t?r:t),t-=1,this.view[t]=e,i&&(this.offset+=1),this},o.writeByte=o.writeInt8,o.readInt8=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var i=this.view[e];return 128==(128&i)&&(i=-(255-i+1)),t&&(this.offset+=1),i},o.readByte=o.readInt8,o.writeUint8=function(e,t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=1;var r=this.buffer.byteLength;return r<t&&this.resize((r*=2)>t?r:t),t-=1,this.view[t]=e,i&&(this.offset+=1),this},o.writeUInt8=o.writeUint8,o.readUint8=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var i=this.view[e];return t&&(this.offset+=1),i},o.readUInt8=o.readUint8,o.writeInt16=function(e,t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=2;var r=this.buffer.byteLength;return r<t&&this.resize((r*=2)>t?r:t),t-=2,this.littleEndian?(this.view[t+1]=(65280&e)>>>8,this.view[t]=255&e):(this.view[t]=(65280&e)>>>8,this.view[t+1]=255&e),i&&(this.offset+=2),this},o.writeShort=o.writeInt16,o.readInt16=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+2) <= "+this.buffer.byteLength)}var i=0;return this.littleEndian?(i=this.view[e],i|=this.view[e+1]<<8):(i=this.view[e]<<8,i|=this.view[e+1]),32768==(32768&i)&&(i=-(65535-i+1)),t&&(this.offset+=2),i},o.readShort=o.readInt16,o.writeUint16=function(e,t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=2;var r=this.buffer.byteLength;return r<t&&this.resize((r*=2)>t?r:t),t-=2,this.littleEndian?(this.view[t+1]=(65280&e)>>>8,this.view[t]=255&e):(this.view[t]=(65280&e)>>>8,this.view[t+1]=255&e),i&&(this.offset+=2),this},o.writeUInt16=o.writeUint16,o.readUint16=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+2) <= "+this.buffer.byteLength)}var i=0;return this.littleEndian?(i=this.view[e],i|=this.view[e+1]<<8):(i=this.view[e]<<8,i|=this.view[e+1]),t&&(this.offset+=2),i},o.readUInt16=o.readUint16,o.writeInt32=function(e,t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=4;var r=this.buffer.byteLength;return r<t&&this.resize((r*=2)>t?r:t),t-=4,this.littleEndian?(this.view[t+3]=e>>>24&255,this.view[t+2]=e>>>16&255,this.view[t+1]=e>>>8&255,this.view[t]=255&e):(this.view[t]=e>>>24&255,this.view[t+1]=e>>>16&255,this.view[t+2]=e>>>8&255,this.view[t+3]=255&e),i&&(this.offset+=4),this},o.writeInt=o.writeInt32,o.readInt32=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}var i=0;return this.littleEndian?(i=this.view[e+2]<<16,i|=this.view[e+1]<<8,i|=this.view[e],i+=this.view[e+3]<<24>>>0):(i=this.view[e+1]<<16,i|=this.view[e+2]<<8,i|=this.view[e+3],i+=this.view[e]<<24>>>0),i|=0,t&&(this.offset+=4),i},o.readInt=o.readInt32,o.writeUint32=function(e,t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=4;var r=this.buffer.byteLength;return r<t&&this.resize((r*=2)>t?r:t),t-=4,this.littleEndian?(this.view[t+3]=e>>>24&255,this.view[t+2]=e>>>16&255,this.view[t+1]=e>>>8&255,this.view[t]=255&e):(this.view[t]=e>>>24&255,this.view[t+1]=e>>>16&255,this.view[t+2]=e>>>8&255,this.view[t+3]=255&e),i&&(this.offset+=4),this},o.writeUInt32=o.writeUint32,o.readUint32=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}var i=0;return this.littleEndian?(i=this.view[e+2]<<16,i|=this.view[e+1]<<8,i|=this.view[e],i+=this.view[e+3]<<24>>>0):(i=this.view[e+1]<<16,i|=this.view[e+2]<<8,i|=this.view[e+3],i+=this.view[e]<<24>>>0),t&&(this.offset+=4),i},o.readUInt32=o.readUint32,l&&(o.writeInt64=function(e,t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"==typeof e)e=l.fromNumber(e);else if("string"==typeof e)e=l.fromString(e);else if(!(e&&e instanceof l))throw TypeError("Illegal value: "+e+" (not an integer or Long)");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}"number"==typeof e?e=l.fromNumber(e):"string"==typeof e&&(e=l.fromString(e)),t+=8;var r=this.buffer.byteLength;r<t&&this.resize((r*=2)>t?r:t),t-=8;var n=e.low,s=e.high;return this.littleEndian?(this.view[t+3]=n>>>24&255,this.view[t+2]=n>>>16&255,this.view[t+1]=n>>>8&255,this.view[t]=255&n,t+=4,this.view[t+3]=s>>>24&255,this.view[t+2]=s>>>16&255,this.view[t+1]=s>>>8&255,this.view[t]=255&s):(this.view[t]=s>>>24&255,this.view[t+1]=s>>>16&255,this.view[t+2]=s>>>8&255,this.view[t+3]=255&s,t+=4,this.view[t]=n>>>24&255,this.view[t+1]=n>>>16&255,this.view[t+2]=n>>>8&255,this.view[t+3]=255&n),i&&(this.offset+=8),this},o.writeLong=o.writeInt64,o.readInt64=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+8) <= "+this.buffer.byteLength)}var i=0,r=0;this.littleEndian?(i=this.view[e+2]<<16,i|=this.view[e+1]<<8,i|=this.view[e],i+=this.view[e+3]<<24>>>0,e+=4,r=this.view[e+2]<<16,r|=this.view[e+1]<<8,r|=this.view[e],r+=this.view[e+3]<<24>>>0):(r=this.view[e+1]<<16,r|=this.view[e+2]<<8,r|=this.view[e+3],r+=this.view[e]<<24>>>0,e+=4,i=this.view[e+1]<<16,i|=this.view[e+2]<<8,i|=this.view[e+3],i+=this.view[e]<<24>>>0);var n=new l(i,r,!1);return t&&(this.offset+=8),n},o.readLong=o.readInt64,o.writeUint64=function(e,t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"==typeof e)e=l.fromNumber(e);else if("string"==typeof e)e=l.fromString(e);else if(!(e&&e instanceof l))throw TypeError("Illegal value: "+e+" (not an integer or Long)");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}"number"==typeof e?e=l.fromNumber(e):"string"==typeof e&&(e=l.fromString(e)),t+=8;var r=this.buffer.byteLength;r<t&&this.resize((r*=2)>t?r:t),t-=8;var n=e.low,s=e.high;return this.littleEndian?(this.view[t+3]=n>>>24&255,this.view[t+2]=n>>>16&255,this.view[t+1]=n>>>8&255,this.view[t]=255&n,t+=4,this.view[t+3]=s>>>24&255,this.view[t+2]=s>>>16&255,this.view[t+1]=s>>>8&255,this.view[t]=255&s):(this.view[t]=s>>>24&255,this.view[t+1]=s>>>16&255,this.view[t+2]=s>>>8&255,this.view[t+3]=255&s,t+=4,this.view[t]=n>>>24&255,this.view[t+1]=n>>>16&255,this.view[t+2]=n>>>8&255,this.view[t+3]=255&n),i&&(this.offset+=8),this},o.writeUInt64=o.writeUint64,o.readUint64=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+8) <= "+this.buffer.byteLength)}var i=0,r=0;this.littleEndian?(i=this.view[e+2]<<16,i|=this.view[e+1]<<8,i|=this.view[e],i+=this.view[e+3]<<24>>>0,e+=4,r=this.view[e+2]<<16,r|=this.view[e+1]<<8,r|=this.view[e],r+=this.view[e+3]<<24>>>0):(r=this.view[e+1]<<16,r|=this.view[e+2]<<8,r|=this.view[e+3],r+=this.view[e]<<24>>>0,e+=4,i=this.view[e+1]<<16,i|=this.view[e+2]<<8,i|=this.view[e+3],i+=this.view[e]<<24>>>0);var n=new l(i,r,!0);return t&&(this.offset+=8),n},o.readUInt64=o.readUint64),o.writeFloat32=function(e,t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof e)throw TypeError("Illegal value: "+e+" (not a number)");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=4;var r=this.buffer.byteLength;return r<t&&this.resize((r*=2)>t?r:t),t-=4,n(this.view,e,t,this.littleEndian,23,4),i&&(this.offset+=4),this},o.writeFloat=o.writeFloat32,o.readFloat32=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}var i=r(this.view,e,this.littleEndian,23,4);return t&&(this.offset+=4),i},o.readFloat=o.readFloat32,o.writeFloat64=function(e,t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof e)throw TypeError("Illegal value: "+e+" (not a number)");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=8;var r=this.buffer.byteLength;return r<t&&this.resize((r*=2)>t?r:t),t-=8,n(this.view,e,t,this.littleEndian,52,8),i&&(this.offset+=8),this},o.writeDouble=o.writeFloat64,o.readFloat64=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+8) <= "+this.buffer.byteLength)}var i=r(this.view,e,this.littleEndian,52,8);return t&&(this.offset+=8),i},o.readDouble=o.readFloat64,f.MAX_VARINT32_BYTES=5,f.calculateVarint32=function(e){return(e>>>=0)<128?1:e<16384?2:e<1<<21?3:e<1<<28?4:5},f.zigZagEncode32=function(e){return((e|=0)<<1^e>>31)>>>0},f.zigZagDecode32=function(e){return e>>>1^-(1&e)|0},o.writeVarint32=function(e,t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}var r,n=f.calculateVarint32(e);t+=n;var s=this.buffer.byteLength;for(s<t&&this.resize((s*=2)>t?s:t),t-=n,e>>>=0;128<=e;)r=127&e|128,this.view[t++]=r,e>>>=7;return this.view[t++]=e,i?(this.offset=t,this):n},o.writeVarint32ZigZag=function(e,t){return this.writeVarint32(f.zigZagEncode32(e),t)},o.readVarint32=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var i,r=0,n=0;do{if(!this.noAssert&&e>this.limit){var s=Error("Truncated");throw s.truncated=!0,s}i=this.view[e++],r<5&&(n|=(127&i)<<7*r),++r}while(0!=(128&i));return n|=0,t?(this.offset=e,n):{value:n,length:r}},o.readVarint32ZigZag=function(e){var t=this.readVarint32(e);return"object"==typeof t?t.value=f.zigZagDecode32(t.value):t=f.zigZagDecode32(t),t},l&&(f.MAX_VARINT64_BYTES=10,f.calculateVarint64=function(e){"number"==typeof e?e=l.fromNumber(e):"string"==typeof e&&(e=l.fromString(e));var t=e.toInt()>>>0,i=e.shiftRightUnsigned(28).toInt()>>>0,r=e.shiftRightUnsigned(56).toInt()>>>0;return 0==r?0==i?t<16384?t<128?1:2:t<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:r<128?9:10},f.zigZagEncode64=function(e){return"number"==typeof e?e=l.fromNumber(e,!1):"string"==typeof e?e=l.fromString(e,!1):!1!==e.unsigned&&(e=e.toSigned()),e.shiftLeft(1).xor(e.shiftRight(63)).toUnsigned()},f.zigZagDecode64=function(e){return"number"==typeof e?e=l.fromNumber(e,!1):"string"==typeof e?e=l.fromString(e,!1):!1!==e.unsigned&&(e=e.toSigned()),e.shiftRightUnsigned(1).xor(e.and(l.ONE).toSigned().negate()).toSigned()},o.writeVarint64=function(e,t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"==typeof e)e=l.fromNumber(e);else if("string"==typeof e)e=l.fromString(e);else if(!(e&&e instanceof l))throw TypeError("Illegal value: "+e+" (not an integer or Long)");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}"number"==typeof e?e=l.fromNumber(e,!1):"string"==typeof e?e=l.fromString(e,!1):!1!==e.unsigned&&(e=e.toSigned());var r=f.calculateVarint64(e),n=e.toInt()>>>0,s=e.shiftRightUnsigned(28).toInt()>>>0,o=e.shiftRightUnsigned(56).toInt()>>>0;t+=r;var a=this.buffer.byteLength;switch(a<t&&this.resize((a*=2)>t?a:t),t-=r,r){case 10:this.view[t+9]=o>>>7&1;case 9:this.view[t+8]=9!==r?128|o:127&o;case 8:this.view[t+7]=8!==r?s>>>21|128:s>>>21&127;case 7:this.view[t+6]=7!==r?s>>>14|128:s>>>14&127;case 6:this.view[t+5]=6!==r?s>>>7|128:s>>>7&127;case 5:this.view[t+4]=5!==r?128|s:127&s;case 4:this.view[t+3]=4!==r?n>>>21|128:n>>>21&127;case 3:this.view[t+2]=3!==r?n>>>14|128:n>>>14&127;case 2:this.view[t+1]=2!==r?n>>>7|128:n>>>7&127;case 1:this.view[t]=1!==r?128|n:127&n}return i?(this.offset+=r,this):r},o.writeVarint64ZigZag=function(e,t){return this.writeVarint64(f.zigZagEncode64(e),t)},o.readVarint64=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var i=e,r=0,n=0,s=0,o=0;if(r=127&(o=this.view[e++]),128&o&&(r|=(127&(o=this.view[e++]))<<7,(128&o||this.noAssert&&void 0===o)&&(r|=(127&(o=this.view[e++]))<<14,(128&o||this.noAssert&&void 0===o)&&(r|=(127&(o=this.view[e++]))<<21,(128&o||this.noAssert&&void 0===o)&&(n=127&(o=this.view[e++]),(128&o||this.noAssert&&void 0===o)&&(n|=(127&(o=this.view[e++]))<<7,(128&o||this.noAssert&&void 0===o)&&(n|=(127&(o=this.view[e++]))<<14,(128&o||this.noAssert&&void 0===o)&&(n|=(127&(o=this.view[e++]))<<21,(128&o||this.noAssert&&void 0===o)&&(s=127&(o=this.view[e++]),(128&o||this.noAssert&&void 0===o)&&(s|=(127&(o=this.view[e++]))<<7,128&o||this.noAssert&&void 0===o))))))))))throw Error("Buffer overrun");var a=l.fromBits(r|n<<28,n>>>4|s<<24,!1);return t?(this.offset=e,a):{value:a,length:e-i}},o.readVarint64ZigZag=function(e){var t=this.readVarint64(e);return t&&t.value instanceof l?t.value=f.zigZagDecode64(t.value):t=f.zigZagDecode64(t),t}),o.writeCString=function(e,t){var i=void 0===t;i&&(t=this.offset);var r,n=e.length;if(!this.noAssert){if("string"!=typeof e)throw TypeError("Illegal str: Not a string");for(r=0;r<n;++r)if(0===e.charCodeAt(r))throw RangeError("Illegal str: Contains NULL-characters");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}n=h.calculateUTF16asUTF8(a(e))[1],t+=n+1;var s=this.buffer.byteLength;return s<t&&this.resize((s*=2)>t?s:t),t-=n+1,h.encodeUTF16toUTF8(a(e),function(e){this.view[t++]=e}.bind(this)),this.view[t++]=0,i?(this.offset=t,this):n},o.readCString=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var i,r=e,n=-1;return h.decodeUTF8toUTF16(function(){if(0===n)return null;if(e>=this.limit)throw RangeError("Illegal range: Truncated data, "+e+" < "+this.limit);return 0===(n=this.view[e++])?null:n}.bind(this),i=u(),!0),t?(this.offset=e,i()):{string:i(),length:e-r}},o.writeIString=function(e,t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("string"!=typeof e)throw TypeError("Illegal str: Not a string");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}var r,n=t;r=h.calculateUTF16asUTF8(a(e),this.noAssert)[1],t+=4+r;var s=this.buffer.byteLength;if(s<t&&this.resize((s*=2)>t?s:t),t-=4+r,this.littleEndian?(this.view[t+3]=r>>>24&255,this.view[t+2]=r>>>16&255,this.view[t+1]=r>>>8&255,this.view[t]=255&r):(this.view[t]=r>>>24&255,this.view[t+1]=r>>>16&255,this.view[t+2]=r>>>8&255,this.view[t+3]=255&r),t+=4,h.encodeUTF16toUTF8(a(e),function(e){this.view[t++]=e}.bind(this)),t!==n+4+r)throw RangeError("Illegal range: Truncated data, "+t+" == "+(t+4+r));return i?(this.offset=t,this):t-n},o.readIString=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}var i=e,r=this.readUint32(e),n=this.readUTF8String(r,f.METRICS_BYTES,e+=4);return e+=n.length,t?(this.offset=e,n.string):{string:n.string,length:e-i}},f.METRICS_CHARS="c",f.METRICS_BYTES="b",o.writeUTF8String=function(e,t){var i,r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}var n=t;i=h.calculateUTF16asUTF8(a(e))[1],t+=i;var s=this.buffer.byteLength;return s<t&&this.resize((s*=2)>t?s:t),t-=i,h.encodeUTF16toUTF8(a(e),function(e){this.view[t++]=e}.bind(this)),r?(this.offset=t,this):t-n},o.writeString=o.writeUTF8String,f.calculateUTF8Chars=function(e){return h.calculateUTF16asUTF8(a(e))[0]},f.calculateUTF8Bytes=function(e){return h.calculateUTF16asUTF8(a(e))[1]},f.calculateString=f.calculateUTF8Bytes,o.readUTF8String=function(e,t,i){"number"==typeof t&&(i=t,t=void 0);var r=void 0===i;if(r&&(i=this.offset),void 0===t&&(t=f.METRICS_CHARS),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal length: "+e+" (not an integer)");if(e|=0,"number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}var n,s=0,o=i;if(t===f.METRICS_CHARS){if(n=u(),h.decodeUTF8(function(){return s<e&&i<this.limit?this.view[i++]:null}.bind(this),function(e){++s,h.UTF8toUTF16(e,n)}),s!==e)throw RangeError("Illegal range: Truncated data, "+s+" == "+e);return r?(this.offset=i,n()):{string:n(),length:i-o}}if(t===f.METRICS_BYTES){if(!this.noAssert){if("number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+e>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+"+e+") <= "+this.buffer.byteLength)}var a=i+e;if(h.decodeUTF8toUTF16(function(){return i<a?this.view[i++]:null}.bind(this),n=u(),this.noAssert),i!==a)throw RangeError("Illegal range: Truncated data, "+i+" == "+a);return r?(this.offset=i,n()):{string:n(),length:i-o}}throw TypeError("Unsupported metrics: "+t)},o.readString=o.readUTF8String,o.writeVString=function(e,t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("string"!=typeof e)throw TypeError("Illegal str: Not a string");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}var r,n,s=t;r=h.calculateUTF16asUTF8(a(e),this.noAssert)[1],n=f.calculateVarint32(r),t+=n+r;var o=this.buffer.byteLength;if(o<t&&this.resize((o*=2)>t?o:t),t-=n+r,t+=this.writeVarint32(r,t),h.encodeUTF16toUTF8(a(e),function(e){this.view[t++]=e}.bind(this)),t!==s+r+n)throw RangeError("Illegal range: Truncated data, "+t+" == "+(t+r+n));return i?(this.offset=t,this):t-s},o.readVString=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var i=e,r=this.readVarint32(e),n=this.readUTF8String(r.value,f.METRICS_BYTES,e+=r.length);return e+=n.length,t?(this.offset=e,n.string):{string:n.string,length:e-i}},o.append=function(e,t,i){"number"!=typeof t&&"string"==typeof t||(i=t,t=void 0);var r=void 0===i;if(r&&(i=this.offset),!this.noAssert){if("number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}e instanceof f||(e=f.wrap(e,t));var n=e.limit-e.offset;if(n<=0)return this;i+=n;var s=this.buffer.byteLength;return s<i&&this.resize((s*=2)>i?s:i),i-=n,this.view.set(e.view.subarray(e.offset,e.limit),i),e.offset+=n,r&&(this.offset+=n),this},o.appendTo=function(e,t){return e.append(this,t),this},o.assert=function(e){return this.noAssert=!e,this},o.capacity=function(){return this.buffer.byteLength},o.clear=function(){return this.offset=0,this.limit=this.buffer.byteLength,this.markedOffset=-1,this},o.clone=function(e){var t=new f(0,this.littleEndian,this.noAssert);return e?(t.buffer=new ArrayBuffer(this.buffer.byteLength),t.view=new Uint8Array(t.buffer)):(t.buffer=this.buffer,t.view=this.view),t.offset=this.offset,t.markedOffset=this.markedOffset,t.limit=this.limit,t},o.compact=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||t<e||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}if(0===e&&t===this.buffer.byteLength)return this;var i=t-e;if(0===i)return this.buffer=s,this.view=null,0<=this.markedOffset&&(this.markedOffset-=e),this.offset=0,this.limit=0,this;var r=new ArrayBuffer(i),n=new Uint8Array(r);return n.set(this.view.subarray(e,t)),this.buffer=r,this.view=n,0<=this.markedOffset&&(this.markedOffset-=e),this.offset=0,this.limit=i,this},o.copy=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||t<e||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}if(e===t)return new f(0,this.littleEndian,this.noAssert);var i=t-e,r=new f(i,this.littleEndian,this.noAssert);return r.offset=0,r.limit=i,0<=r.markedOffset&&(r.markedOffset-=e),this.copyTo(r,0,e,t),r},o.copyTo=function(e,t,i,r){var n,s;if(!this.noAssert&&!f.isByteBuffer(e))throw TypeError("Illegal target: Not a ByteBuffer");if(t=(s=void 0===t)?e.offset:0|t,i=(n=void 0===i)?this.offset:0|i,r=void 0===r?this.limit:0|r,t<0||t>e.buffer.byteLength)throw RangeError("Illegal target range: 0 <= "+t+" <= "+e.buffer.byteLength);if(i<0||r>this.buffer.byteLength)throw RangeError("Illegal source range: 0 <= "+i+" <= "+this.buffer.byteLength);var o=r-i;return 0===o?e:(e.ensureCapacity(t+o),e.view.set(this.view.subarray(i,r),t),n&&(this.offset+=o),s&&(e.offset+=o),this)},o.ensureCapacity=function(e){var t=this.buffer.byteLength;return t<e?this.resize((t*=2)>e?t:e):this},o.fill=function(e,t,i){var r=void 0===t;if(r&&(t=this.offset),"string"==typeof e&&0<e.length&&(e=e.charCodeAt(0)),void 0===t&&(t=this.offset),void 0===i&&(i=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof i||i%1!=0)throw TypeError("Illegal end: Not an integer");if(i>>>=0,t<0||i<t||i>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+i+" <= "+this.buffer.byteLength)}if(i<=t)return this;for(;t<i;)this.view[t++]=e;return r&&(this.offset=t),this},o.flip=function(){return this.limit=this.offset,this.offset=0,this},o.mark=function(e){if(e=void 0===e?this.offset:e,!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}return this.markedOffset=e,this},o.order=function(e){if(!this.noAssert&&"boolean"!=typeof e)throw TypeError("Illegal littleEndian: Not a boolean");return this.littleEndian=!!e,this},o.LE=function(e){return this.littleEndian=void 0===e||!!e,this},o.BE=function(e){return this.littleEndian=void 0!==e&&!e,this},o.prepend=function(e,t,i){"number"!=typeof t&&"string"==typeof t||(i=t,t=void 0);var r=void 0===i;if(r&&(i=this.offset),!this.noAssert){if("number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}e instanceof f||(e=f.wrap(e,t));var n=e.limit-e.offset;if(n<=0)return this;var s=n-i;if(0<s){var o=new ArrayBuffer(this.buffer.byteLength+s),a=new Uint8Array(o);a.set(this.view.subarray(i,this.buffer.byteLength),n),this.buffer=o,this.view=a,this.offset+=s,0<=this.markedOffset&&(this.markedOffset+=s),this.limit+=s,i+=s}else new Uint8Array(this.buffer);return this.view.set(e.view.subarray(e.offset,e.limit),i-n),e.offset=e.limit,r&&(this.offset-=n),this},o.prependTo=function(e,t){return e.prepend(this,t),this},o.printDebug=function(e){"function"!=typeof e&&(e=console.log.bind(console)),e(this.toString()+"\n-------------------------------------------------------------------\n"+this.toDebug(!0))},o.remaining=function(){return this.limit-this.offset},o.reset=function(){return 0<=this.markedOffset?(this.offset=this.markedOffset,this.markedOffset=-1):this.offset=0,this},o.resize=function(e){if(!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal capacity: "+e+" (not an integer)");if((e|=0)<0)throw RangeError("Illegal capacity: 0 <= "+e)}if(this.buffer.byteLength<e){var t=new ArrayBuffer(e),i=new Uint8Array(t);i.set(this.view),this.buffer=t,this.view=i}return this},o.reverse=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||t<e||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}return e===t||Array.prototype.reverse.call(this.view.subarray(e,t)),this},o.skip=function(e){if(!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal length: "+e+" (not an integer)");e|=0}var t=this.offset+e;if(!this.noAssert&&(t<0||t>this.buffer.byteLength))throw RangeError("Illegal length: 0 <= "+this.offset+" + "+e+" <= "+this.buffer.byteLength);return this.offset=t,this},o.slice=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||t<e||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}var i=this.clone();return i.offset=e,i.limit=t,i},o.toBuffer=function(e){var t=this.offset,i=this.limit;if(!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: Not an integer");if(t>>>=0,"number"!=typeof i||i%1!=0)throw TypeError("Illegal limit: Not an integer");if(i>>>=0,t<0||i<t||i>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+i+" <= "+this.buffer.byteLength)}if(!e&&0===t&&i===this.buffer.byteLength)return this.buffer;if(t===i)return s;var r=new ArrayBuffer(i-t);return new Uint8Array(r).set(new Uint8Array(this.buffer).subarray(t,i),0),r},o.toArrayBuffer=o.toBuffer,o.toString=function(e,t,i){if(void 0===e)return"ByteBufferAB(offset="+this.offset+",markedOffset="+this.markedOffset+",limit="+this.limit+",capacity="+this.capacity()+")";switch("number"==typeof e&&(i=t=e="utf8"),e){case"utf8":return this.toUTF8(t,i);case"base64":return this.toBase64(t,i);case"hex":return this.toHex(t,i);case"binary":return this.toBinary(t,i);case"debug":return this.toDebug();case"columns":return this.toColumns();default:throw Error("Unsupported encoding: "+e)}};var c=function(){for(var e={},n=[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,43,47],o=[],t=0,i=n.length;t<i;++t)o[n[t]]=t;return e.encode=function(e,t){for(var i,r;null!==(i=e());)t(n[i>>2&63]),r=(3&i)<<4,null!==(i=e())?(t(n[63&((r|=i>>4&15)|i>>4&15)]),r=(15&i)<<2,null!==(i=e())?(t(n[63&(r|i>>6&3)]),t(n[63&i])):(t(n[63&r]),t(61))):(t(n[63&r]),t(61),t(61))},e.decode=function(e,t){var i,r,n;function s(e){throw Error("Illegal character code: "+e)}for(;null!==(i=e());)if(void 0===(r=o[i])&&s(i),null!==(i=e())&&(void 0===(n=o[i])&&s(i),t(r<<2>>>0|(48&n)>>4),null!==(i=e()))){if(void 0===(r=o[i])){if(61===i)break;s(i)}if(t((15&n)<<4>>>0|(60&r)>>2),null!==(i=e())){if(void 0===(n=o[i])){if(61===i)break;s(i)}t((3&r)<<6>>>0|n)}}},e.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)},e}();o.toBase64=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),t|=0,(e|=0)<0||t>this.capacity||t<e)throw RangeError("begin, end");var i;return c.encode(function(){return e<t?this.view[e++]:null}.bind(this),i=u()),i()},f.fromBase64=function(e,t){if("string"!=typeof e)throw TypeError("str");var i=new f(e.length/4*3,t),r=0;return c.decode(a(e),function(e){i.view[r++]=e}),i.limit=r,i},f.btoa=function(e){return f.fromBinary(e).toBase64()},f.atob=function(e){return f.fromBase64(e).toBinary()},o.toBinary=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),t|=0,(e|=0)<0||t>this.capacity()||t<e)throw RangeError("begin, end");if(e===t)return"";for(var i=[],r=[];e<t;)i.push(this.view[e++]),1024<=i.length&&(r.push(String.fromCharCode.apply(String,i)),i=[]);return r.join("")+String.fromCharCode.apply(String,i)},f.fromBinary=function(e,t){if("string"!=typeof e)throw TypeError("str");for(var i,r=0,n=e.length,s=new f(n,t);r<n;){if(255<(i=e.charCodeAt(r)))throw RangeError("illegal char code: "+i);s.view[r++]=i}return s.limit=n,s},o.toDebug=function(e){for(var t,i=-1,r=this.buffer.byteLength,n="",s="",o="";i<r;){if(-1!==i&&(n+=(t=this.view[i])<16?"0"+t.toString(16).toUpperCase():t.toString(16).toUpperCase(),e&&(s+=32<t&&t<127?String.fromCharCode(t):".")),++i,e&&0<i&&i%16==0&&i!==r){for(;n.length<51;)n+=" ";o+=n+s+"\n",n=s=""}i===this.offset&&i===this.limit?n+=i===this.markedOffset?"!":"|":i===this.offset?n+=i===this.markedOffset?"[":"<":i===this.limit?n+=i===this.markedOffset?"]":">":n+=i===this.markedOffset?"'":e||0!==i&&i!==r?" ":""}if(e&&" "!==n){for(;n.length<51;)n+=" ";o+=n+s+"\n"}return e?o:n},f.fromDebug=function(e,t,i){for(var r,n,s=e.length,o=new f((s+1)/3|0,t,i),a=0,l=0,u=!1,c=!1,d=!1,h=!1,p=!1;a<s;){switch(r=e.charAt(a++)){case"!":if(!i){if(c||d||h){p=!0;break}c=d=h=!0}o.offset=o.markedOffset=o.limit=l,u=!1;break;case"|":if(!i){if(c||h){p=!0;break}c=h=!0}o.offset=o.limit=l,u=!1;break;case"[":if(!i){if(c||d){p=!0;break}c=d=!0}o.offset=o.markedOffset=l,u=!1;break;case"<":if(!i){if(c){p=!0;break}c=!0}o.offset=l,u=!1;break;case"]":if(!i){if(h||d){p=!0;break}h=d=!0}o.limit=o.markedOffset=l,u=!1;break;case">":if(!i){if(h){p=!0;break}h=!0}o.limit=l,u=!1;break;case"'":if(!i){if(d){p=!0;break}d=!0}o.markedOffset=l,u=!1;break;case" ":u=!1;break;default:if(!i&&u){p=!0;break}if(n=parseInt(r+e.charAt(a++),16),!i&&(isNaN(n)||n<0||255<n))throw TypeError("Illegal str: Not a debug encoded string");o.view[l++]=n,u=!0}if(p)throw TypeError("Illegal str: Invalid symbol at "+a)}if(!i){if(!c||!h)throw TypeError("Illegal str: Missing offset or limit");if(l<o.buffer.byteLength)throw TypeError("Illegal str: Not a debug encoded string (is it hex?) "+l+" < "+s)}return o},o.toHex=function(e,t){if(e=void 0===e?this.offset:e,t=void 0===t?this.limit:t,!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||t<e||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}for(var i,r=new Array(t-e);e<t;)(i=this.view[e++])<16?r.push("0",i.toString(16)):r.push(i.toString(16));return r.join("")},f.fromHex=function(e,t,i){if(!i){if("string"!=typeof e)throw TypeError("Illegal str: Not a string");if(e.length%2!=0)throw TypeError("Illegal str: Length not a multiple of 2")}for(var r,n=e.length,s=new f(n/2|0,t),o=0,a=0;o<n;o+=2){if(r=parseInt(e.substring(o,o+2),16),!i&&(!isFinite(r)||r<0||255<r))throw TypeError("Illegal str: Contains non-hex characters");s.view[a++]=r}return s.limit=a,s};var d,h=d={MAX_CODEPOINT:1114111,encodeUTF8:function(e,t){var i=null;for("number"==typeof e&&(i=e,e=function(){return null});null!==i||null!==(i=e());)i<128?t(127&i):(i<2048?t(i>>6&31|192):(i<65536?t(i>>12&15|224):(t(i>>18&7|240),t(i>>12&63|128)),t(i>>6&63|128)),t(63&i|128)),i=null},decodeUTF8:function(e,t){for(var i,r,n,s,o=function(e){e=e.slice(0,e.indexOf(null));var t=Error(e.toString());throw t.name="TruncatedError",t.bytes=e,t};null!==(i=e());)if(0==(128&i))t(i);else if(192==(224&i))null===(r=e())&&o([i,r]),t((31&i)<<6|63&r);else if(224==(240&i))(null===(r=e())||null===(n=e()))&&o([i,r,n]),t((15&i)<<12|(63&r)<<6|63&n);else{if(240!=(248&i))throw RangeError("Illegal starting byte: "+i);(null===(r=e())||null===(n=e())||null===(s=e()))&&o([i,r,n,s]),t((7&i)<<18|(63&r)<<12|(63&n)<<6|63&s)}},UTF16toUTF8:function(e,t){for(var i,r=null;null!==(i=null!==r?r:e());)55296<=i&&i<=57343&&null!==(r=e())&&56320<=r&&r<=57343?(t(1024*(i-55296)+r-56320+65536),r=null):t(i);null!==r&&t(r)},UTF8toUTF16:function(e,t){var i=null;for("number"==typeof e&&(i=e,e=function(){return null});null!==i||null!==(i=e());)i<=65535?t(i):(t(55296+((i-=65536)>>10)),t(i%1024+56320)),i=null},encodeUTF16toUTF8:function(e,t){d.UTF16toUTF8(e,function(e){d.encodeUTF8(e,t)})},decodeUTF8toUTF16:function(e,t){d.decodeUTF8(e,function(e){d.UTF8toUTF16(e,t)})},calculateCodePoint:function(e){return e<128?1:e<2048?2:e<65536?3:4},calculateUTF8:function(e){for(var t,i=0;null!==(t=e());)i+=t<128?1:t<2048?2:t<65536?3:4;return i},calculateUTF16asUTF8:function(e){var t=0,i=0;return d.UTF16toUTF8(e,function(e){++t,i+=e<128?1:e<2048?2:e<65536?3:4}),[t,i]}};return o.toUTF8=function(t,i){if(void 0===t&&(t=this.offset),void 0===i&&(i=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof i||i%1!=0)throw TypeError("Illegal end: Not an integer");if(i>>>=0,t<0||i<t||i>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+i+" <= "+this.buffer.byteLength)}var e;try{h.decodeUTF8toUTF16(function(){return t<i?this.view[t++]:null}.bind(this),e=u())}catch(e){if(t!==i)throw RangeError("Illegal range: Truncated data, "+t+" != "+i)}return e()},f.fromUTF8=function(e,t,i){if(!i&&"string"!=typeof e)throw TypeError("Illegal str: Not a string");var r=new f(h.calculateUTF16asUTF8(a(e),!0)[1],t,i),n=0;return h.encodeUTF16toUTF8(a(e),function(e){r.view[n++]=e}),r.limit=n,r},f},n=[i(48)],void 0===(s="function"==typeof(r=o)?r.apply(t,n):r)||(e.exports=s)},function(e,t,i){var r,n;r=[i(49)],void 0===(n=function(e){"use strict";return new e}.apply(t,r))||(e.exports=n)},function(e,t,i){var r;void 0===(r=function(){"use strict";return{level:{TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,FATAL:5}}}.apply(t,[]))||(e.exports=r)},function(e,t,i){var r,n;r=[i(67),i(66),i(31)],void 0===(n=function(e,t,i){return{MQWebSocket:e,BatchHttpProto:t,MQService:i}}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(6),i(3),i(54)],void 0===(n=function(i,s,n,o){"use strict";var a=4;function e(e,t,i,r){if("string"!=typeof e)throw new Error('Must pass a valid "version"');if("string"!=typeof t)throw new Error('Must pass a valid "baseUri"');if("object"!=typeof i)throw new Error('Must pass a valid "logger"');this._version=e,this._baseUri=t,this._logger=i,this._disposables=new n.DisposableList,this._sessionTelemetry=r}return e.DefaultPCastUri="https://pcast.phenixp2p.com",e.prototype.getBaseUri=function(){return this._baseUri},e.prototype.resolveUri=function(e){return function(e,r){if(0===e.lastIndexOf("wss:",0))r(void 0,{uri:e+"/ws",roundTripTime:0});else if(0===e.lastIndexOf("https:",0)){var n=this;(function(e,r){var t=s.getWithRetry(e+"/pcast/endPoints",{timeout:15e3,queryParameters:{version:"2018-05-15T23:23:03Z",_:i.now()},retryOptions:{maxAttempts:a}},function(e,t){if(e)return r(new Error("Failed to resolve an end point",e));var i=t.data.split(",");i.length<1&&r(new Error("Failed to discover end points")),r(void 0,i)});this._disposables.add(t)}).call(n,e,function(e,t){if(e)return r(e);var i=new o(n._logger,n._version,r,function(e,t){e?n._logger.warn("An error occured in resolving an endpoint",e):n._sessionTelemetry.recordMetric("RoundTripTime",{uint64:t.time},null,{resource:t.endPoint,kind:"https"})});i.resolveAll(t),n._disposables.add(i)})}else r(new Error("Uri not supported"))}.call(this,this._baseUri,e)},e.prototype.dispose=function(){this._disposables.dispose()},e.prototype.toString=function(){return"PCastEndPoint["+this._baseUri+"]"},e}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(1),i(8),i(82)],void 0===(n=function(e,n,s,o){"use strict";function t(){}return t.prototype.createPCastLogger=function(e,t){e&&n.isStringNotEmpty(e,"baseUri");var i=new s.Logger,r=o.getAppender(e);return r.setThreshold(s.level.INFO),t||i.addAppender(new s.ConsoleAppender),i.addAppender(r),i.isPCastLogger=!0,i},new t}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(1),i(4),i(19),i(41)],void 0===(n=function(n,s,o,e,t){"use strict";var i=e.types,a=t.states,r="pcast://phenixp2p.com/";function l(e,t,i,r){this.init(e,t,i,r)}function u(e){return n.includes(e,r)?r:"pcast://phenixrts.com/"}function c(e){var r={},t=e.split("?");if(2!==t.length)return r;var i=t[1].split("&");return n.forEach(i,function(e){var t=e.split("="),i=t[0];r[i]=t[1]}),r}function d(e){if(!(e=n.getEnumName(i,e)))throw new Error('"type" must be a valid stream type');return e}function h(e){if(!(e=n.getEnumName(a,e)))throw new Error('"state" must be a valid track state');return e}return l.prototype.init=function(e,t,i,r){s.isString(e,"uri"),this._uri=new o.Observable(e),this._type=new o.Observable(t,d),this._audioState=new o.Observable(i||a.trackEnabled.name,h),this._videoState=new o.Observable(r||a.trackEnabled.name,h),this._streamId=l.parsePCastStreamIdFromStreamUri(e)},l.prototype.getUri=function(){return this._uri.getValue()},l.prototype.getType=function(){return this._type.getValue()},l.prototype.getObservableAudioState=function(){return this._audioState},l.prototype.getObservableVideoState=function(){return this._videoState},l.prototype.toJson=function(){return{uri:this._uri.getValue(),type:this._type.getValue(),audioState:this._audioState.getValue(),videoState:this._videoState.getValue()}},l.prototype._update=function(e){var t,i;n.isObject(e)&&(e.hasOwnProperty("uri")&&e.uri!==this._uri.getValue()&&(t=e.uri,i=this._uri.getValue(),l.parsePCastStreamIdFromStreamUri(t)===l.parsePCastStreamIdFromStreamUri(i))&&(this._uri.setValue(e.uri),this._streamId=l.parsePCastStreamIdFromStreamUri(e.uri)),e.hasOwnProperty("audioState")&&this._audioState.setValue(e.audioState),e.hasOwnProperty("videoState")&&this._videoState.setValue(e.videoState))},l.prototype.isPCastStream=function(){return!!this._streamId},l.prototype.getPCastStreamId=function(){return this._streamId},l.prototype.getInfo=function(){return c(this._uri.getValue())},l.getPCastPrefix=function(){return r},l.parsePCastStreamIdFromStreamUri=function(e){return n.includes(e,u(e))?e.replace(u(e),"").split("?")[0]:null},l.getInfoFromStreamUri=function(e){return c(e)},l}.apply(t,r))||(e.exports=n)},function(e,t,i){var r;void 0===(r=function(){"use strict";return{types:{user:{id:0,name:"User"},presentation:{id:1,name:"Presentation"},audio:{id:2,name:"Audio"}}}}.apply(t,[]))||(e.exports=r)},function(e,t,i){var r,n;r=[i(0),i(1),i(4),i(3),i(17),i(6),i(33),i(74),i(16),i(102),i(103),i(43),i(9),i(100),i(99),i(98),i(42),i(94),i(89),i(92),i(7),i(2),i(87)],void 0===(n=function(b,_,i,r,n,e,t,s,o,a,l,w,u,c,p,d,S,f,h,m,g,E,y){"use strict";function v(e){e=e||{},_.isObject(e,"options"),e.streamingSourceMapping&&(_.isObject(e.streamingSourceMapping,"options.streamingSourceMapping"),_.isStringNotEmpty(e.streamingSourceMapping.replacement,"options.streamingSourceMapping.replacement"),e.streamingSourceMapping.patternToReplace instanceof RegExp||_.isStringNotEmpty(e.streamingSourceMapping.patternToReplace,"options.streamingSourceMapping.patternToReplace")),b.isNullOrUndefined(e.disableMultiplePCastInstanceWarning)||_.isBoolean(e.disableMultiplePCastInstanceWarning,"options.disableMultiplePCastInstanceWarning"),this._observableStatus=new i.Observable("offline"),this._baseUri=e.uri||o.DefaultPCastUri,this._deviceId=e.deviceId||"",this._version="2018-05-15T23:23:03Z",this._logger=e.logger||n.createPCastLogger(this._baseUri,e.disableConsoleLogging),this._metricsTransmitter=e.metricsTransmitter||c.createMetricsTransmitter(this._baseUri),this._screenShareExtensionManager=new a(e,this._logger),this._shaka=e.shaka,this._videojs=e.videojs||E.global.videojs,this._status="offline",this._streamingSourceMapping=e.streamingSourceMapping,this._disposables=new r.DisposableList,this._disableMultiplePCastInstanceWarning=e.disableMultiplePCastInstanceWarning,this._canPlaybackAudio=!0;var t=this;b.addEventListener(E.global,"unload",function(){return t._logger.info("Window Unload Event Triggered"),t.stop()}),e.disableBeforeUnload||b.addEventListener(E.global,"beforeunload",function(){return t._logger.info("Window Before Unload Event Triggered"),t.stop()}),E.webrtcSupported||"ReactNative"!==E.browser||E.shim(),E.webrtcSupported&&(function(){var i=this,e=new E.RTCPeerConnection;"Safari"===E.browser&&10<E.browserVersion&&(e.addTransceiver("audio"),e.addTransceiver("video"));e.createOffer(function(e){var t=y.getH264ProfileIds(e.sdp);if(0===t.length)return i._logger.info("Unable to find local h264 profile level id");i._logger.info("Found local h264 profile level ids [%s]",t,e.sdp),i._h264ProfileIds=t},function(e){i._logger.error("Unable to create offer to get local h264 profile level id",e)},{offerToReceiveAudio:!0,offerToReceiveVideo:!0})}.call(this),D.call(this))}function T(){if(C.call(this)&&"offline"===this._observableStatus.getValue())return this._logger.warn("[PCast] connected after being offline. Going offline."),q.call(this,"critical-network-issue"),this.stop();var i=this;this._connected=!0,i._stopped||i._protocol.authenticate(i._authToken,function(e,t){i._authenticationCallback&&(e?(i._logger.error("Failed to authenticate [%s]",e),q.call(i,"unauthorized"),i._authenticationCallback.call(i,i,"unauthorized","")):"ok"!==t.status?(i._logger.warn("Failed to authenticate, status [%s]",t.status),q.call(i,"unauthorized"),i._authenticationCallback.call(i,i,"unauthorized","")):(q.call(i,"online"),i._authenticationCallback.call(i,i,t.status,t.sessionId)))})}function k(){q.call(this,"reconnecting")}function I(){q.call(this,"reconnected"),this._logger.info("Attempting to re-authenticate after reconnect event"),function(){var n=this;n._stopped||n._protocol.authenticate(n._authToken,function(e,t){var i=!0===n._connected;if(e)return n._logger.error("Unable to authenticate after reconnect to WebSocket [%s]",e),q.call(n,"reconnect-failed");if("ok"!==t.status){n._logger.warn("Unable to authenticate after reconnect to WebSocket, status [%s]",t.status);var r="capacity"===t.status?t.status:"reconnect-failed";return q.call(n,r)}return n._connected=!0,n._logger.info("Successfully authenticated after reconnect to WebSocket"),q.call(n,"online",null,i)})}.call(this)}function R(){if(C.call(this)&&"reconnecting"===this._observableStatus.getValue())return this._logger.warn("[PCast] disconnected after attempting to reconnect. Going offline."),q.call(this,"critical-network-issue"),this.stop();this._connected=!1,q.call(this,"offline")}function C(){return b.reduce(this._peerConnections,function(e,t){return e?"closed"===t.iceConnectionState:e},!0)}function O(e){switch(e){case"":case"none":case"ended":return"ended";case"server-error":case"session-error":case"not-ready":case"error":case"died":return"failed";case"censored":return"censored";case"maintenance":return"maintenance";case"capacity":return"capacity";case"app-background":return"app-background";default:return"custom"}}function P(e){var t=e.streamId,i=e.reason;return A.call(this,t,i)}function M(e){var t=e.streamId,i=e.status,r=e.reason,n=this._mediaStreams[t];n&&n.dataQualityChangedCallback(i,r);var s=this._publishers[t];s&&"function"==typeof s.dataQualityChangedCallback&&s.dataQualityChangedCallback(s,i,r)}function A(e,t){this._logger.info("[%s] Stream ended with reason [%s]",e,t);var i=this._mediaStreams[e];i&&i.streamEndedCallback(O(t),t,!0),delete this._mediaStreams[e];var r=this._publishers[e];r&&"function"==typeof r.publisherEndedCallback&&r.publisherEndedCallback(r,O(t),t),delete this._publishers[e];var n=this._peerConnections[e];n&&B.call(this,e,n,"ended"),delete this._peerConnections[e]}function x(o,a,l,u,c,d){var h=this;b.addEventListener(l,"addstream",function(e){if(!a.failed){var t=e.stream,i="real-time";if(!t)return a.failed=!0,h._logger.warn("[%s] No remote stream",o),c.call(h,void 0,"failed");h._logger.info("[%s] Got remote stream",o),u.setProperty("kind",i);var r=b.assign({networkLag:h._networkOneWayLatency},d),n=new m(o,t,l,u,r,h._logger),s=new f(i,n,h._logger);s.on(g.streamEvents.playerError.name,function(e,t){h._logger.warn("Phenix Real-Time Stream Error [%s] [%s]",e,t),s.streamErrorCallback(i,t)}),s.on(g.streamEvents.stopped.name,function(e){a.stopped||(h._logger.info("[%s] stop media stream",o),B.call(h,o,l,"stop"),h._protocol.destroyStream(o,e||"",function(e,t){e?h._logger.error("[%s] failed to destroy stream [%s]",o,e):"ok"===t.status?h._logger.info("[%s] destroyed stream",o):h._logger.warn("[%s] failed to destroy stream, status [%s]",o,t.status)}),a.stopped=!0)}),h._mediaStreams[o]=s,c.call(h,n)}})}function L(i,e,r){var n=this;b.addEventListener(e,"icecandidate",function(e){var t=e.candidate;t?n._logger.debug("[%s] ICE candidate: [%s] [%s] [%s]",i,t.sdpMid,t.sdpMLineIndex,t.candidate):n._logger.info("[%s] ICE candidate discovery complete",i),r&&r(t)})}function N(t,i){var r=this;b.addEventListener(i,"negotiationneeded",function(e){r._logger.info("[%s] Negotiation needed")}),b.addEventListener(i,"iceconnectionstatechange",function(e){r._logger.info("[%s] ICE connection state changed [%s]",t,i.iceConnectionState)}),b.addEventListener(i,"icegatheringstatechange ",function(e){r._logger.info("[%s] ICE gathering state changed [%s]",t,i.iceGatheringState)}),b.addEventListener(i,"signalingstatechange",function(e){r._logger.info("[%s] Signaling state changed [%s]",t,i.signalingState)}),b.addEventListener(i,"connectionstatechange",function(e){r._logger.info("[%s] Connection state changed [%s]",t,i.connectionState)})}function D(t){var i=this;switch(E.browser){case"Edge":return E.getDestinations(function(e){0===b.filter(e,function(e){return"audio"===e.kind}).length?(i._canPlaybackAudio&&i._logger.info("Detected no audio devices attached to machine"),i._canPlaybackAudio=!1):i._canPlaybackAudio=!0,t&&t()});default:t&&t()}}function F(e,s,t,i,r,n){if("IE"===E.browser)throw new Error("Subscribing in real-time not supported on IE without the PhenixP2P Plugin");var o=this,a={failed:!1,stopped:!1},l=t.match(/a=crypto:/i),u=t.match(/m=application /i),c=new E.RTCPeerConnection(e,{optional:[{DtlsSrtpKeyAgreement:!l},{RtpDataChannels:u}]}),d=null;if(o._peerConnections[s]=c,"Firefox"===E.browser||"Edge"===E.browser){if(t.match(/(\nm=video)/g)&&t.match(/(\nm=audio)/g)){var h=/(a=candidate)((.|\n)*)(?=m=)/g;t=t.replace(h,t.match(h)+"a=end-of-candidates\n")}t=(t+="a=end-of-candidates").replace(/(\na=ice-options:trickle)/g,"")}"ReactNative"===E.browser&&(t=K(t));var p=function(e){a.failed||(a.failed=!0,a.stopped=!0,delete o._peerConnections[s],B.call(o,s,c,"failure"),r.call(o,void 0,e||"failed"))};x.call(o,s,a,c,i,r,n),L.call(o,s,c,function(e){d&&d(e)}),N.call(o,s,c);var f=new E.RTCSessionDescription({type:"offer",sdp:t});c.setRemoteDescription(f,function(){o._logger.debug("Set remote description (offer)");var e={mandatory:{}};"Chrome"===E.browser||"ReactNative"===E.browser?(e.mandatory.OfferToReceiveVideo=!1!==n.receiveVideo,e.mandatory.OfferToReceiveAudio=!1!==n.receiveAudio):(e.mandatory.offerToReceiveVideo=!1!==n.receiveVideo,e.mandatory.offerToReceiveAudio=!1!==n.receiveAudio),c.createAnswer(function(e){o._logger.info("Created answer [%s]",e.sdp),o._protocol.setAnswerDescription(s,e.sdp,function(e,t){if(e)return o._logger.error("Failed to set answer description [%s]",e),p();if("ok"!==t.status)return o._logger.warn("Failed to set answer description, status [%s]",t.status),p(t.status);b.includes(t.options,"ice-candidates")&&(d=function(e){var t=[];e?[].push(e):t.push("completed"),o._protocol.addIceCandidates(s,e,t,function(e,t){e?o._logger.error("Failed to add ICE candidate [%s]",e):"ok"===t.status?b.includes(t.options,"cancel")&&(d=null):o._logger.warn("Failed to add ICE candidate, status [%s]",t.status)})});var i=t.sessionDescription.sdp;if(H()){var r=b.get(function(){var e=b.get(E,["global","navigator","userAgent"],"");if(/iP(hone|od|ad)/.test(e)){var t=e.match(/.*OS (\d+)_(\d+)_?(\d+)? like Mac OS X/);return{major:parseInt(b.get(t,[1],0),10),minor:parseInt(b.get(t,[2],0),10),patch:parseInt(b.get(t,[3],0),10)}}}(),["major"]);o._logger.info("iOS Version is [%s]",r),r<11&&(i=i.replace("BUNDLE audio video","BUNDLE video audio"))}var n=new E.RTCSessionDescription({type:"answer",sdp:i});c.setLocalDescription(n,function(){o._logger.debug("Set local description (answer)")},p)})},p,e)},p)}function U(e,t,i,r,n){var s=t.match(/a=x-playlist:([^\n]*[.]mpd\??[^\s]*)/m),o=t.match(/a=x-playlist:([^\n]*[.]m3u8\??[^\s]*)/m),a=b.get(s,[1],""),l=b.get(o,[1],"");this._streamingSourceMapping&&(a=a.replace(this._streamingSourceMapping.patternToReplace,this._streamingSourceMapping.replacement),l=l.replace(this._streamingSourceMapping.patternToReplace,this._streamingSourceMapping.replacement));var u=H()||"Safari"===E.browser;return s&&2===s.length&&!u?(n.isDrmProtectedContent=/[?&]drmToken=([^&]*)/.test(s[1])||/x-widevine-service-certificate/.test(t),n.isDrmProtectedContent&&(n.widevineServiceCertificateUrl=t.match(/a=x-widevine-service-certificate:([^\n][^\s]*)/m)[1],n.playreadyLicenseUrl=t.match(/a=x-playready-license-url:([^\n][^\s]*)/m)[1]),this._shaka&&!this._shaka.Player.isBrowserSupported()?(this._logger.warn("[%s] Shaka does not support this browser",e),r.call(this,void 0,"browser-unsupported")):V.call(this,e,a,g.types.dash.name,i,r,n)):(o&&o.length,this._logger.warn("[%s] Offer does not contain a supported manifest",e,t),r.call(this,void 0,"failed"))}function V(i,e,t,r,n,s){var o=this,a=new h(t,i,e,r,s,this._shaka,this._logger),l=new f(t,a,this._logger);r.setProperty("kind",t),l.on(g.streamEvents.playerError.name,function(e,t){o._logger.warn("Phenix Live Stream Player Error [%s] [%s]",e,t),l.streamErrorCallback(e,t)}),l.on(g.streamEvents.stopped.name,function(e){o._protocol.destroyStream(i,e||"",function(e,t){e?o._logger.error("[%s] failed to destroy stream, [%s]",i,e):"ok"===t.status||o._logger.warn("[%s] failed to destroy stream, status [%s]",i,t.status)})}),this._mediaStreams[i]=l,n.call(this,l.getPhenixMediaStream())}function q(e,t,i){var r,n=this.getStatus();if(n!==e&&("critical-network-issue"!==(r=n)&&"offline"!==r||"offline"!==e)){if(this._observableStatus.setValue(e),i)return;switch(e){case"connecting":case"reconnecting":case"reconnected":break;case"critical-network-issue":case"unauthorized":case"reconnect-failed":case"offline":return this._offlineCallback.call(this);case"online":return this._onlineCallback.call(this)}}}function B(e,t,i){"closed"===t.signalingState||t.__closing||(this._logger.debug("[%s] close peer connection [%s]",e,i),t.close(),t.__closing=!0)}function j(e){if(!e)return e;var t=b.isArray(e)?[]:{},i=b.bind(z,null,t);return b.isArray(e)?b.forEach(e,i):b.forOwn(e,i),t}function z(e,t,i){if(null!==t){if(b.isObject(t)||b.isArray(t))return e[i]=j(t);if(!b.isString(t)||!b.isString(i))return e[i]=t;var r=b.startsWith(t.toLowerCase(),i.toLowerCase())?t.substring(i.length,t.length).toLowerCase():t;e[i]=r}}function W(e){return"Firefox"===E.browser&&function(e){if(!e)return;b.forEach(e.iceServers,function(e){e.urls=b.filter(e.urls,function(e){return!b.startsWith(e,"turns")})})}(e),e}v.prototype.getBaseUri=function(){return this._baseUri},v.prototype.getStatus=function(){return this._observableStatus.getValue()},v.prototype.getObservableStatus=function(){return this._observableStatus},v.prototype.isStarted=function(){return this._started},v.prototype.reAuthenticate=function(e){if(_.isStringNotEmpty(e,"authToken"),"online"===this._observableStatus.getValue())return this._logger.warn("Already authenticated. Denying request to re-authenticate");this._logger.info("Attempting to re-authenticate with new auth token [%s]",e),this._authToken=e,I.call(this)},v.prototype.start=function(e,t,i,r){if("string"!=typeof e)throw new Error('"authToken" must be a string');if("function"!=typeof t)throw new Error('"authenticationCallback" must be a function');if("function"!=typeof i)throw new Error('"onlineCallback" must be a function');if("function"!=typeof r)throw new Error('"offlineCallback" must be a function');if(this._started)throw new Error('"Already started"');b.isNumber(E.global.__phenixInstantiatedPCastCount)?E.global.__phenixInstantiatedPCastCount++:E.global.__phenixInstantiatedPCastCount=1,1<E.global.__phenixInstantiatedPCastCount&&!this._disableMultiplePCastInstanceWarning&&this._logger.warn("Avoid using multiple instances of PCast as this uses unnecessary resources and will reduce performance. This is your [%s] simultaneous instance. Remember to dispose all resources when done with them by calling .stop() or .dispose()",E.global.__phenixInstantiatedPCastCount),this._stopped=!1,this._started=!0,this._authToken=e,this._authenticationCallback=t,this._onlineCallback=i,this._offlineCallback=r,this._sessionTelemetry=new d(this._logger,this._metricsTransmitter),this._endPoint=new o(this._version,this._baseUri,this._logger,this._sessionTelemetry),q.call(this,"connecting"),this._peerConnections={},this._mediaStreams={},this._publishers={},this._gumStreams=[],this._disposables.add(this._endPoint),this._disposables.add(this._sessionTelemetry);var n=this;n._endPoint.resolveUri(function(e,t){if(e){switch(n._logger.error("Failed to connect to [%s]",n._baseUri,e),q.call(n,"offline"),e.code){case 0:n._authenticationCallback.call(n,n,"network-unavailable","");break;case 503:n._authenticationCallback.call(n,n,"capacity","");break;default:n._authenticationCallback.call(n,n,"failed","")}return n._stopped=!0,void(n._started=!1)}n._logger.info("Discovered end point [%s] with RTT [%s]",t.uri,t.roundTripTime),n._networkOneWayLatency=t.roundTripTime/2,n._resolvedEndPoint=t.uri,function(e){this._protocol=new s(e,this._deviceId,this._version,this._logger),this._protocol.onEvent("connected",b.bind(T,this)),this._protocol.onEvent("reconnecting",b.bind(k,this)),this._protocol.onEvent("reconnected",b.bind(I,this)),this._protocol.onEvent("disconnected",b.bind(R,this)),this._protocol.onEvent("pcast.StreamEnded",b.bind(P,this)),this._protocol.onEvent("pcast.StreamDataQuality",b.bind(M,this)),this._logger.setObservableSessionId&&this._logger.setObservableSessionId(this._protocol.getObservableSessionId());this._sessionTelemetrySubscription&&(this._sessionTelemetrySubscription.dispose(),this._sessionTelemetry.setSessionId(null));this._sessionTelemetrySubscription=this._protocol.getObservableSessionId().subscribe(b.bind(this._sessionTelemetry.setSessionId,this._sessionTelemetry))}.call(n,t.uri)})},v.prototype.stop=function(){if(this._started){this._stopped=!0,this._started=!1,delete this._authenticationCallback;try{var i=this;b.forOwn(this._mediaStreams,function(e,t){A.call(i,t,"")}),b.forOwn(this._publishers,function(e,t){A.call(i,t,""),b.includes(e.getOptions(),"detached")||e.stop("",!0)}),b.forOwn(this._peerConnections,function(e,t){A.call(i,t,"")}),b.forEach(this._gumStreams,function(e){var t=e.getTracks();b.forEach(t,function(e){e.stop()})})}finally{this._protocol&&(this._protocol.disconnect(),this._protocol=null),this._logger.setObservableSessionId&&this._logger.setObservableSessionId(null),this._sessionTelemetrySubscription&&(this._sessionTelemetrySubscription.dispose(),this._sessionTelemetry.setSessionId(null)),E.global.__phenixInstantiatedPCastCount--,this._disposables.dispose()}}},v.prototype.getUserMedia=function(e,t,i){if("IE"===E.browser)throw new Error("Publishing not supported on IE");return _.isObject(e,"options"),_.isFunction(t,"callback"),i&&_.isFunction(i,"onScreenShare"),new l(this._logger,this._screenShareExtensionManager,i).getUserMedia(e,t)},v.prototype.publish=function(e,a,l,t,u){if("IE"===E.browser)throw new Error("Publishing not supported on IE");if(!this._started)throw new Error("PCast not started. Unable to publish. Please start pcast first.");if("string"!=typeof e)throw new Error('"streamToken" must be a string');if("object"!=typeof a&&"string"!=typeof a)throw new Error('"streamToPublish" must be an object or URI');if("function"!=typeof l)throw new Error('"callback" must be a function');if(t=t||[],!Array.isArray(t))throw new Error('"tags" must be an array');if("object"!=typeof(u=u||{}))throw new Error('"options" must be an object');var c=this,d=b.assign({},u,{negotiate:!0});"string"==typeof a?(d.negotiate=!1,d.connectUri=a):d.connectUri=u.connectUri,0<t.length&&(d.tags=t);var h=new p(this.getProtocol().getSessionId(),this._logger,this._metricsTransmitter);h.setProperty("resource","upload"),this._protocol.setupStream("upload",e,d,2*c._networkOneWayLatency,function(e,t){if(e)return c._logger.error("Failed to create uploader [%s]",e),l.call(c,c,"failed");if("ok"===t.status){var i=t.createStreamResponse.streamId;if(h.setStreamId(i),h.setStartOffset(t.createStreamResponse.offset),h.recordMetric("Provisioned"),h.recordMetric("RoundTripTime",{uint64:2*c._networkOneWayLatency},null,{resource:c._resolvedEndPoint,kind:"https"}),!0===d.negotiate){var r=t.createStreamResponse.createOfferDescriptionResponse.sessionDescription.sdp,n=W(j(t.createStreamResponse.rtcConfiguration));if("Opera"===E.browser&&0<c._h264ProfileIds.length){var s=b.get(y.getH264ProfileIds(r),[0]),o=y.getH264ProfileIdWithSameProfileAndEqualToOrHigherLevel(c._h264ProfileIds,s);o?s!==o&&(c._logger.info("[%s] Replacing publisher h264 profile level id [%s] with new value [%s] in offer sdp",i,s,o),r=y.replaceH264ProfileId(r,s,o)):c._logger.warn("[%s] Unable to find new publisher h264 profile level id to replace [%s]. Rejected environment defaults of [%s]",i,s,c._h264ProfileIds)}return function(e,s,l,u,t,c,i,d){var h=this,p={failed:!1,stopped:!1},r=u.match(/a=crypto:/i),n=u.match(/m=application /i),f=new E.RTCPeerConnection(e,{optional:[{DtlsSrtpKeyAgreement:!r},{RtpDataChannels:n}]}),m=null,o=null,g=null;if((h._peerConnections[l]=f).addStream(s),"Firefox"===E.browser||"Edge"===E.browser){if(u.match(/(\nm=video)/g)&&u.match(/(\nm=audio)/g)){var a=/(a=candidate)((.|\n)*)(?=m=)/g;u=u.replace(a,u.match(a)+"a=end-of-candidates\n")}u=(u+="a=end-of-candidates").replace(/(\na=ice-options:trickle)/g,"")}var y=function(e){p.failed||(p.failed=!0,p.stopped=!0,delete h._peerConnections[l],B.call(h,l,f,"failure"),c.call(h,void 0,e||"failed"))};x.call(h,l,p,f,t,function(e){var t=h._publishers[l];m=e,t&&t.remoteMediaStreamCallback&&t.remoteMediaStreamCallback(t,e)},i),L.call(h,l,f,function(e){o&&o(e)}),N.call(h,l,f);var v=new E.RTCSessionDescription({type:"offer",sdp:u});f.setRemoteDescription(v,function(){h._logger.info("Set remote description (offer)");var e={mandatory:{}};"Chrome"===E.browser||"ReactNative"===E.browser?(e.mandatory.OfferToReceiveVideo=!0===i.receiveVideo,e.mandatory.OfferToReceiveAudio=!0===i.receiveAudio):(e.mandatory.offerToReceiveVideo=!0===i.receiveVideo,e.mandatory.offerToReceiveAudio=!0===i.receiveAudio);f.createAnswer(function(e){h._logger.info("Created answer [%s]",e.sdp),h._protocol.setAnswerDescription(l,e.sdp,function(e,t){if(e)return h._logger.error("Failed to set answer description [%s]",e),y();if("ok"!==t.status)return h._logger.warn("Failed to set answer description, status [%s]",t.status),y(t.status);b.includes(t.options,"ice-candidates")&&(o=function(e){var t=[],i=[];e?t.push(e):i.push("completed"),h._protocol.addIceCandidates(l,t,i,function(e,t){e?h._logger.error("Failed to add ICE candidate [%s]",e):"ok"===t.status?b.includes(t.options,"cancel")&&(o=null):h._logger.warn("Failed to add ICE candidate, status [%s]",t.status)})});var i=new E.RTCSessionDescription({type:"answer",sdp:t.sessionDescription.sdp});f.setLocalDescription(i,function(){var n=/(b=AS:([0-9]*)[\n\r]*)/gi,o=/(mid:video)([\n\r]*)/gi;h._logger.info("Set local description (answer)");var a=0,e=n.exec(u);e&&3<=e.length&&(a=1e3*e[2]);var r={getStreamId:function(){return l},getStream:function(){return s},isActive:function(){return!p.stopped},hasEnded:function(){switch(f.iceConnectionState){case"new":case"checking":case"connected":case"completed":return!1;case"disconnected":case"failed":case"closed":default:return!0}},stop:function(e){p.stopped||(B.call(h,l,f,"closed"),h._protocol.destroyStream(l,e||"",function(e,t){e?h._logger.error("[%s] failed to destroy stream [%s]",l,e):"ok"===t.status?h._logger.info("[%s] destroyed stream",l):h._logger.warn("[%s] failed to destroy stream, status [%s]",l,t.status)}),p.stopped=!0)},setPublisherEndedCallback:function(e){if("function"!=typeof e)throw new Error('"callback" must be a function');this.publisherEndedCallback=e},setDataQualityChangedCallback:function(e){if("function"!=typeof e)throw new Error('"callback" must be a function');this.dataQualityChangedCallback=e},limitBandwidth:function(e){if("Edge"===E.browser)return h._logger.warn("Limit bandwidth not support on [%s]",E.browser);if("number"!=typeof e)throw new Error('"bandwidthLimit" must be a number');var s=a?Math.min(e,a):e,t=f.remoteDescription;h._logger.info("Changing bandwidth limit to [%s]",s);var i=t.sdp.replace(n,"");i=i.replace(o,function(e,t,i,r,n){return[t,i,"b=AS:",Math.ceil(s/1e3),i].join("")});var r=new E.RTCSessionDescription({type:t.type,sdp:i});return f.setRemoteDescription(r),{dispose:function(){f.setRemoteDescription(t)}}},getMonitor:function(){return g},monitor:function(e,i){if("object"!=typeof e)throw new Error('"options" must be an object');if("function"!=typeof i)throw new Error('"callback" must be a function');var t=new w(l,f,h._logger);return e.direction="outbound",t.start(e,function(){return h._publishers[l]===r&&!p.stopped},function(e,t){return e&&h._logger.warn("[%s] Publisher monitor triggered unrecoverable error [%s]",e),h._logger.warn("[%s] Publisher triggered monitor condition for [%s]",l,t.type),i(r,"client-side-failure",t)}),b.forEach(s.getTracks(),function(e){b.addEventListener(e,"readystatechange",function(){if("ended"===e.readyState)return h._logger.warn("[%s] Publisher track has failed [%s]",l,e),i(r,"camera-track-failure",{type:e.kind+"-track-ended",message:"Publisher "+e.kind+" track has ended in an unrecoverable way. This may require reconfiguring your camera or microphone."})})}),g=t},setRemoteMediaStreamCallback:function(e){if("function"!=typeof e)throw new Error('"callback" must be a function');this.remoteMediaStreamCallback=e,m&&e(r,m)},getOptions:function(){return d},getStats:function(t){_.isFunction(t,"callback"),this._lastStats||(this._lastStats={});var i=this;return E.getStats(f,null,function(e){t(S.convertPeerConnectionStats(e,i._lastStats))})}};h._publishers[l]=r,c.call(h,r)},y)})},y,e)},y)}.call(c,n,a,i,r,h,function(e,t){h.recordMetric("SetupCompleted",{string:t?"failed":"ok"}),t?l.call(c,c,"failed",null):l.call(c,c,"ok",e)},u,t.createStreamResponse.options)}return function(i,e,t){var r=this,n={stopped:!1},s={getStreamId:function(){return i},getStream:function(){return r._logger.debug("[%s] Unable to get stream on publisher of remote origin.",i),null},getStats:function(){return r._logger.debug("[%s] Unable to get stream stats on publisher of remote origin.",i),null},isActive:function(){return!n.stopped},hasEnded:function(){return n.stopped},stop:function(e){n.stopped||(r._protocol.destroyStream(i,e||"",function(e,t){e?r._logger.error("[%s] failed to destroy stream [%s]",i,e):"ok"===t.status?r._logger.info("[%s] destroyed stream",i):r._logger.warn("[%s] failed to destroy stream, status [%s]",i,t.status)}),n.stopped=!0)},setPublisherEndedCallback:function(e){if("function"!=typeof e)throw new Error('"callback" must be a function');this.publisherEndedCallback=e},setDataQualityChangedCallback:function(e){if("function"!=typeof e)throw new Error('"callback" must be a function');this.dataQualityChangedCallback=e},getOptions:function(){return t},monitor:function(e,t){if("object"!=typeof e)throw new Error('"options" must be an object');if("function"!=typeof t)throw new Error('"callback" must be a function')},getMonitor:function(){return null}};r._publishers[i]=s,e(s)}.call(c,i,function(e,t){h.recordMetric("SetupCompleted",{string:t?"failed":"ok"}),t?l.call(c,c,"failed",null):l.call(c,c,"ok",e)},t.createStreamResponse.options)}switch(c._logger.warn("Failed to create uploader, status [%s]",t.status),t.status){case"timeout":case"capacity":case"unauthorized":return l.call(c,c,t.status);default:return l.call(c,c,"failed")}})},v.prototype.subscribe=function(i,c,r){if(!this._started)throw new Error("PCast not started. Unable to subscribe. Please start pcast first.");if("string"!=typeof i)throw new Error('"streamToken" must be a string');if("function"!=typeof c)throw new Error('"callback" must be a function');if("object"!=typeof(r=r||{}))throw new Error('"options" must be an object');var d=this;D.call(d,function(){var e="download",t=b.assign({},r,{negotiate:!1!==r.negotiate}),l=new p(d.getProtocol().getSessionId(),d._logger,d._metricsTransmitter),u=b.assign({},{useNativeHlsPlayer:!0},r);u.canPlaybackAudio=d._canPlaybackAudio,!d._canPlaybackAudio&&r.disableAudioIfNoOutputFound&&!1!==r.receiveAudio&&(t.receiveAudio=!1,u.receiveAudio=!1,u.forcedAudioDisabled=!0),l.setProperty("resource",e),d._protocol.setupStream(e,i,t,2*d._networkOneWayLatency,function(e,t){if(e)return d._logger.error("Failed to create downloader [%s]",e),c.call(d,d,"failed");if("ok"===t.status){var i=t.createStreamResponse.streamId,r=t.createStreamResponse.createOfferDescriptionResponse.sessionDescription.sdp,n=W(j(t.createStreamResponse.rtcConfiguration)),s=b.bind(F,d,n);if(r.match(/a=x-playlist:/)&&(s=U),l.setStreamId(i),l.setStartOffset(t.createStreamResponse.offset),l.recordMetric("Provisioned"),l.recordMetric("RoundTripTime",{uint64:2*d._networkOneWayLatency},null,{resource:d.getBaseUri(),kind:"https"}),u.originStartTime=b.now()-t.createStreamResponse.offset+d._networkOneWayLatency,("Chrome"===E.browser&&62<=E.browserVersion&&Y()||"Opera"===E.browser)&&0<d._h264ProfileIds.length){var o=b.get(y.getH264ProfileIds(r),[0]),a=y.getH264ProfileIdWithSameOrHigherProfileAndEqualToOrHigherLevel(d._h264ProfileIds,o);a?o!==a&&(d._logger.info("[%s] Replacing subscriber h264 profile level id [%s] with new value [%s] in offer sdp",i,o,a),r=y.replaceH264ProfileId(r,o,a)):d._logger.warn("[%s] Unable to find new subscriber h264 profile level id to replace [%s]. Rejected environment defaults of [%s]",i,o,d._h264ProfileIds)}return s.call(d,i,r,l,function(e,t){l.recordMetric("SetupCompleted",{string:t?"failed":"ok"}),t?c.call(d,d,"failed",null):c.call(d,d,"ok",e)},u)}switch(d._logger.warn("Failed to create downloader, status [%s]",t.status),t.status){case"capacity":case"stream-ended":case"origin-stream-ended":case"streaming-not-available":case"unauthorized":case"timeout":return c.call(d,d,t.status);default:return c.call(d,d,"failed")}})})},v.prototype.getProtocol=function(){return this._protocol},v.prototype.getLogger=function(){return this._logger},v.prototype.toString=function(){var e=this.getProtocol();return"PCast["+(e?e.getSessionId():"")||"unauthenticated,"+(e?e.toString():"uninitialized")+"]"};var Y=function(){var e=b.get(E,["global","navigator","userAgent"],"");return H()||/Android|webOS|BlackBerry|IEMobile|Opera Mini|Mobile|mobile|CriOS/i.test(e)},H=function(){var e=b.get(E,["global","navigator","userAgent"],"");return/iPad|iPhone|iPod/.test(e)&&!E.global.MSStream};var K=function(i){var e=i.match(/(?=a=group:BUNDLE).*/),t=b.get(b.get(e,[0],"").split("a=group:BUNDLE "),[1],""),r=t.split(" ").sort(function(e,t){return i.indexOf("m="+e)>i.indexOf("m="+t)});return 0<r.length&&(i=i.replace(t,r.join(" "))),i};return v}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(1),i(4),i(29),i(32),i(24),i(20),i(2),i(95)],void 0===(n=function(m,g,t,y,i,n,r,v,b){"use strict";var _="unauthorized",l=1e3,s={maxOfflineTime:18e4,maxReconnectFrequency:6e4};function e(e){if(g.isObject(e,"options"),g.isStringNotEmpty(e.backendUri,"options.backendUri"),g.isObject(e.authenticationData,"options.authenticationData"),e.authToken&&g.isStringNotEmpty(e.authToken,"options.authToken"),e.onError&&g.isFunction(e.onError,"options.onError"),!m.isNullOrUndefined(e.onlineTimeout)&&(g.isNumber(e.onlineTimeout,"options.onlineTimeout"),e.onlineTimeout<0))throw new Error('"options.onlineTimeout" must be a positive number');e.reconnectOptions&&(g.isObject(e.reconnectOptions,"options.reconnectOptions"),g.isNumber(e.reconnectOptions.maxOfflineTime,"options.reconnectOptions.maxOfflineTime"),g.isNumber(e.reconnectOptions.maxReconnectFrequency,"options.reconnectOptions.maxReconnectFrequency")),this._pcastObservable=new t.Observable(null).extend({rateLimit:0}),this._subscribers={},this._publishers={},this._adminAPI=new i(e.backendUri,e.authenticationData),this._isInstantiated=!1,this._reauthCount=0,this._reconnectCount=0,this._authToken=e.authToken,this._onError=e.onError,this._options=e,this._onlineTimeout=m.isNumber(e.onlineTimeout)?e.onlineTimeout:2e4,this._reconnectOptions=e.reconnectOptions||s,this._logger=null,a.call(this)}e.prototype.dispose=function(){this._listedForCriticalNetworkRecoveryDisposable&&(this._listedForCriticalNetworkRecoveryDisposable.dispose(),this._listedForCriticalNetworkRecoveryDisposable=null),this._pcastObservable.getValue()&&(this._pcastObservable.getValue().stop(),this._pcastObservable.setValue(null)),m.isNumber(this._instantiatePCastTimeout)&&(clearTimeout(this._instantiatePCastTimeout),this._instantiatePCastTimeout=null),this._adminAPI.dispose(),this._reconnectCount=0,this._reauthCount=0},e.prototype.getPCast=function(){return this._pcastObservable.getValue()},e.prototype.getPCastObservable=function(){return this._pcastObservable},e.prototype.getAdminAPI=function(){return this._adminAPI},e.prototype.getUserMedia=function(t,i){var r=this;if(g.isObject(t.mediaConstraints,"options.mediaConstraints"),g.isFunction(i,"callback"),t.resolution&&g.isNumber(t.resolution,"options.resolution"),t.frameRate&&g.isNumber(t.frameRate,"options.frameRate"),t.aspectRatio&&g.isStringNotEmpty(t.aspectRatio,"options.aspectRatio"),t.onResolveMedia&&g.isFunction(t.onResolveMedia,"options.onResolveMedia"),t.onScreenShare&&g.isFunction(t.onScreenShare,"options.onScreenShare"),r._pcastObservable.getValue())return p.call(r,r._pcastObservable.getValue(),t,i);var n=r._pcastObservable.subscribe(function(e){e&&(n.dispose(),p.call(r,e,t,i))})},e.prototype.publish=function(i,r){g.isObject(i,"options"),g.isFunction(r,"callback"),i.capabilities&&g.isArray(i.capabilities,"options.capabilities"),i.connectOptions&&g.isArray(i.connectOptions,"options.connectOptions"),i.mediaConstraints?g.isObject(i.mediaConstraints,"options.mediaConstraints"):g.isObject(i.userMediaStream,"options.userMediaStream"),i.videoElement&&g.isObject(i.videoElement,"options.videoElement"),i.monitor&&(g.isObject(i.monitor,"options.monitor"),g.isFunction(i.monitor.callback,"options.monitor.callback"),i.monitor.options&&g.isObject(i.monitor.options,"options.monitor.options")),i.streamToken&&g.isStringNotEmpty(i.streamToken,"options.streamToken");var n=this;this.waitForOnline(function(e){return e?r(e):i.userMediaStream?w.call(n,i.userMediaStream,i,!1,r):void n.getUserMedia(i,function(e,t){return e?r(e):"ok"!==t.status?r(null,t):void w.call(n,t.userMedia,i,!0,r)})},i.isContinuation)};var o=["streaming","low-latency","on-demand","uld","vvld","vld","ld","sd","hd","fhd","uhd"];function a(){var i=this;if(!this._pcastObservable.getValue()){var e=m.assign({logger:this._logger},this._options);this._pcastObservable.setValue(new r(e))}if(this._logger||(this._logger=this._pcastObservable.getValue().getLogger()),this._pcastStatusSubscription||(this._pcastStatusSubscription=this._pcastObservable.getValue().getObservableStatus().subscribe(m.bind(u,this))),this._authToken)return this._pcastObservable.getValue().start(this._authToken,m.noop,m.noop,m.noop);this._adminAPI.createAuthenticationToken(function(e,t){return e&&"timeout"===e.message?u.call(i,e.message):e?h.call(i,e):"ok"!==t.status?u.call(i,t.status):i._pcastObservable.getValue()?void i._pcastObservable.getValue().start(t.authenticationToken,m.noop,m.noop,m.noop):i._logger.warn("Unable to authenticate. PCast not instantiated.")})}function u(e){var t=this;switch(e){case"timeout":case"critical-network-issue":return t._pcastObservable.getValue()&&(t._pcastObservable.getValue().stop("express-recovery"),t._pcastObservable.setValue(null)),t._pcastStatusSubscription&&(t._pcastStatusSubscription.dispose(),t._pcastStatusSubscription=null),t._reconnectCount++,c.call(t);case"reconnect-failed":case"unauthorized":return delete this._authToken,t._reauthCount++,1<t._reauthCount?h.call(this,new Error(e)):(t._logger.info("[Express] Attempting to create new authToken and re-connect after [%s] response",_),d.call(t));case"capacity":case"network-unavailable":return t._reconnectCount++,c.call(t);case"online":return t._reauthCount=0,t._reconnectCount=0,t._isInstantiated||t._logger.info("Express API successfully instantiated"),void(t._isInstantiated=!0);case"reconnecting":case"reconnected":case"connecting":break;case"offline":return;case"failed":default:return h.call(t,new Error(e))}}function c(){var e=this,t=Math.min(l*e._reconnectCount*e._reconnectCount,this._reconnectOptions.maxReconnectFrequency),i=Math.min(t/1e4,5),r=t+Math.random()*i*1e3;this._logger.info("Waiting for [%s] ms before continuing to attempt to reconnect to PCast",r),this._instantiatePCastTimeout=setTimeout(function(){return e._pcastObservable.getValue()&&e._pcastObservable.getValue().isStarted()?d.call(e):a.call(e)},r)}function d(){var i=this;this._adminAPI.createAuthenticationToken(function(e,t){return e&&"timeout"===e.message?u.call(i,e.message):e?h.call(i,e):"ok"!==t.status?u.call(i,t.status):i._pcastObservable.getValue()?void i._pcastObservable.getValue().reAuthenticate(t.authenticationToken):i._logger.warn("Unable to authenticate. PCast not instantiated.")})}function h(e){if(!this._onError)throw e;this._onError(e)}function p(e,i,r){new n(e,{aspectRatio:i.aspectRatio,resolutionHeight:i.resolution,frameRate:i.frameRate,resolutionSelectionStrategy:i.resolutionSelectionStrategy,onScreenShare:function(e){return(e=i.onScreenShare?i.onScreenShare(e):e).resolution&&g.isNumber(e.resolution,"clientOptions.resolution"),e.frameRate&&g.isNumber(e.frameRate,"screenOptions.frameRate"),e.aspectRatio&&g.isStringNotEmpty(e.aspectRatio,"screenOptions.aspectRatio"),m.assign({resolutionHeight:e.resolution},e)}}).getUserMedia(i.mediaConstraints,function(e,t){if(e)return r(e);i.onResolveMedia&&i.onResolveMedia(t.options),r(null,m.assign({status:"ok"},t))})}function w(i,r,n,s){var o=this;if(g.isArray(r.capabilities,"options.capabilities"),r.streamToken)return f.call(o,r.streamToken,i,r,n,s);o.waitForOnline(function(e){if(e)return s(e);var t=o._pcastObservable.getValue().getProtocol().getSessionId();o._logger.info("Session Id [%s]",t),o._adminAPI.createStreamTokenForPublishing(t,r.capabilities,function(e,t){return e?s(e):"ok"!==t.status?s(null,t):void f.call(o,t.streamToken,i,r,n,s)})},r.isContinuation)}function f(l,u,c,d,h){var p=this,f=!1;c.tags&&g.isArray(c.tags,"options.tags"),c.connectOptions&&g.isArray(c.connectOptions,"options.connectOptions");var t=function(e,t,r){var i=function(e){var t=m.uniqueId(),i=m.assign({streamToken:l,isContinuation:!0},c);p._publishers[t]=!0,"camera-track-failure"===e?(r.stop(e,!1),p.publish(c,h)):(r.stop(e,!0),w.call(p,u,i,d,h)),delete p._publishers[t]};if(t===_&&c.streamToken||"timeout"===t){p._logger.info("[Express] Attempting to create new streamToken and re-publish after [%s] response",_);var n=m.assign({isContinuation:!0},c);return delete n.streamToken,w.call(p,u,n,d,h)}if("ok"!==t)return h(null,{status:t});p._publishers[r.getStreamId()]=r,c.videoElement&&!f&&(v.attachMediaStream(c.videoElement,u),f=!0);var s=m.bind(R,p,function(){},i,!0);if(c.monitor){var o=m.bind(I,p,c.monitor.callback,i);r.monitor(c.monitor.options||{},o),s=m.bind(R,p,c.monitor.callback,i,!0)}r.setPublisherEndedCallback(s);var a=function(r,n,s){var o=m.bind(r.stop,r);return r.stop=function(e,t){if(o(e),n&&(n.src="",n.srcObject=null),s&&r.getStream()&&!t){var i=r.getStream();i&&i.getTracks().forEach(function(e){e.stop()})}},r.enableAudio=function(){return E(r.getStream(),!0)},r.disableAudio=function(){return E(r.getStream(),!1)},r.enableVideo=function(){return T(r.getStream(),!0)},r.disableVideo=function(){return T(r.getStream(),!1)},r.setPublisherEndedCallback=function(){},r}.call(p,r,c.videoElement,d);h(null,{status:"ok",publisher:a})};p.waitForOnline(function(e){if(e)return h(e);p._pcastObservable.getValue().publish(l,u,t,c.tags,{connectOptions:c.connectOptions})},c.isContinuation)}function S(d,h,p){var f=this,t=function(e,t,r){var i,n=function(e){var t=m.uniqueId(),i=m.assign({isContinuation:!0},h);f._subscribers[t]=!0,r.stop(e),f._logger.warn("[%s] Stream failure occurred with reason [%s]. Attempting to recover from failure.",h.streamId,e),S.call(f,d,i,p),delete f._subscribers[t]};if(t===_&&h.streamToken||"timeout"===t){f._logger.info("[%s] [Express] Attempting to create new streamToken and re-subscribe after [%s] response",h.streamId,_);var s=m.assign({isContinuation:!0},h);return delete s.streamToken,f.subscribe(s,p)}if("streaming-not-ready"===t)return p(null,{status:t,retry:m.bind(n,f,t)});if("ok"!==t)return p(null,{status:t});f._subscribers[r.getStreamId()]=r,h.videoElement&&(i=r.createRenderer()).start(h.videoElement);var o=m.noop,a=m.bind(R,f,o,n,!1);if(h.monitor){var l=m.bind(I,f,h.monitor.callback,n);r.monitor(h.monitor.options||{},l),a=m.bind(R,f,h.monitor.callback,n,!1)}r.setStreamEndedCallback(a);var u=function(e,t){var i=m.bind(e.stop,e);return e.stop=function(e){t&&t.stop(),i(e)},e.enableAudio=function(){return E(e.getStream(),!0)},e.disableAudio=function(){return E(e.getStream(),!1)},e.enableVideo=function(){return T(e.getStream(),!0)},e.disableVideo=function(){return T(e.getStream(),!1)},e.setStreamEndedCallback=function(){},e}.call(f,r,i),c={status:"ok",mediaStream:u};r.setStreamErrorCallback(function(e,t,i){if("real-time"===t&&"connection-timeout"===i.message)return n.call(f,i.message);if("shaka"!==t||i.severity===b.errorSeverity.critical.id){if("phenix-player"===t&&i.severity===y.errors.severity.RECOVERABLE){var r=m.assign({isContinuation:!0},h);return delete r.streamToken,f.subscribe(r,p)}return f._logger.warn("[%s] Error while playing stream with Express API. Stopping stream.",u.getStreamId(),i),u.stop(),p(i)}}),i&&(c.renderer=i),p(null,c)};f.waitForOnline(function(e){if(e)return p(e);f._pcastObservable.getValue().subscribe(d,t,h.subscriberOptions)},h.isContinuation)}function E(e,t){if(e)return k(e.getAudioTracks(),t),t}function T(e,t){if(e)return k(e.getVideoTracks(),t),t}function k(e,t){g.isArray(e,"tracks"),m.forEach(e,function(e){e.enabled=t})}function I(e,t,i,r,n){switch(r){case"camera-track-failure":case"client-side-failure":e(null,m.assign({status:r,retry:m.bind(t,null,r)},n))}}function R(e,t,i,r,n,s){var o={status:"stream-ended",reason:n,description:s};switch(n){case"ended":case"censored":var a={status:n,reason:n,description:s};return i?a.publisher=r:a.mediaStream=r,e(null,a);case"custom":return e(null,o);case"capacity":return setTimeout(function(){return t(n)},l);case"failed":case"maintenance":return t(n);case"app-background":default:return o.retry=t,e(null,o)}}return e.prototype.publishRemote=function(i,r){if(g.isObject(i,"options"),g.isFunction(r,"callback"),g.isStringNotEmpty(i.streamUri,"options.streamUri"),i.capabilities&&g.isArray(i.capabilities,"options.capabilities"),i.connectOptions&&g.isArray(i.connectOptions,"options.connectOptions"),i.mediaConstraints)throw new Error("Invalid argument, Media Constraints, for publishing remote.");if(i.videoElement)throw new Error("May not view remote stream publisher. Please subscribe to view.");i.prerollSkipDuration&&g.isNumber(i.prerollSkipDuration,"options.prerollSkipDuration"),i.monitor&&(g.isObject(i.monitor,"options.monitor"),g.isFunction(i.monitor.callback,"options.monitor.callback"),i.monitor.options&&g.isObject(i.monitor.options,"options.monitor.options")),i.frameRate&&(g.isObject(i.frameRate,"options.frameRate"),i.frameRate.exact&&g.isNumber(i.frameRate.exact,"options.frameRate.exact"),i.frameRate.max&&g.isNumber(i.frameRate.max,"options.frameRate.max")),i.streamToken&&g.isStringNotEmpty(i.streamToken,"options.streamToken");var n=this;this.waitForOnline(function(e){if(e)return r(e);var t=m.assign({connectOptions:[],capabilities:[]},i);m.includes(t.capabilities,"publish-uri")||t.capabilities.push("publish-uri"),m.forEach(o,function(e){m.includes(t.capabilities,e)&&t.connectOptions.push("publisher-capability="+e)}),i.frameRate&&i.frameRate.exact&&t.connectOptions.push("source-uri-video-fps="+i.frameRate.exact),i.frameRate&&i.frameRate.max&&t.connectOptions.push("source-uri-video-fps-max="+i.frameRate.max),t.connectOptions.push("source-uri-preroll-skip-duration="+(m.isNumber(i.prerollSkipDuration)?i.prerollSkipDuration:500).toString()),w.call(n,t.streamUri,t,!1,r)})},e.prototype.publishScreen=function(e,t){var i=m.assign({mediaConstraints:{screen:!0}},e);return m.set(i,["monitor","options"],m.assign({},{monitorFrameRate:!1,videoBitRateThreshold:100,conditionCountForNotificationThreshold:8},m.get(i,["monitor","options"],{}))),this.publish(i,t)},e.prototype.subscribe=function(i,r){g.isObject(i,"options"),g.isFunction(r,"callback"),g.isStringNotEmpty(i.streamId,"options.streamId"),g.isObject(i.capabilities,"options.capabilities"),i.videoElement&&g.isObject(i.videoElement,"options.videoElement"),i.monitor&&(g.isObject(i.monitor,"options.monitor"),g.isFunction(i.monitor.callback,"options.monitor.callback"),i.monitor.options&&g.isObject(i.monitor.options,"options.monitor.options")),i.streamToken&&g.isStringNotEmpty(i.streamToken,"options.streamToken"),i.subscriberOptions&&g.isObject(i.subscriberOptions,"options.subscriberOptions");var n=this;this.waitForOnline(function(e){return e?r(e):i.streamToken?S.call(n,i.streamToken,i,r):void n._adminAPI.createStreamTokenForSubscribing(n._pcastObservable.getValue().getProtocol().getSessionId(),i.capabilities,i.streamId,null,function(e,t){return e?r(e):"ok"!==t.status?r(null,t):void S.call(n,t.streamToken,i,r)})},i.isContinuation)},e.prototype.subscribeToScreen=function(e,t){var i=m.assign({},e);return m.set(i,["monitor","options"],m.assign({},{monitorFrameRate:!1,videoBitRateThreshold:100,conditionCountForNotificationThreshold:8},m.get(i,["monitor","options"],{}))),this.subscribe(i,t)},e.prototype.waitForOnline=function(t,e){if(g.isFunction(t,"callback"),this._pcastObservable.getValue()&&"online"===this._pcastObservable.getValue().getStatus())return t();var i=this,r=e?m.get(i._reconnectOptions,["maxOfflineTime"]):this._onlineTimeout,n=null,s=null,o=setTimeout(function(){i._logger.info("Disposing of Express Online listener after [%s] ms",r),n&&n.dispose(),s&&s.dispose(),t(new Error("timeout"))},r);this._logger.info("Waiting for Online status before continuing. Timeout set to [%s]",r);var a=function(e){s&&s.dispose(),e&&(s=e.getObservableStatus().subscribe(function(e){if("online"===e)return clearTimeout(o),s.dispose(),n.dispose(),t()},{initial:"notify"}))};this._pcastObservable.getValue()&&a(this._pcastObservable.getValue()),n=this._pcastObservable.subscribe(a)},e}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(1),i(4),i(3),i(32),i(21),i(23),i(36),i(18),i(11),i(10),i(19),i(41)],void 0===(n=function(v,m,e,u,t,r,l,s,g,b,c,i,y){"use strict";function n(e){m.isObject(e,"options"),e.pcastExpress?m.isObject(e.pcastExpress,"options.pcastExpress"):(m.isStringNotEmpty(e.backendUri,"options.backendUri"),m.isObject(e.authenticationData,"options.authenticationData")),this._pcastExpress=e.pcastExpress||new r(e),this._shouldDisposeOfPCastExpress=!e.pcastExpress,this._roomServices={},this._roomServicePublishers={},this._activeRoomServices=[],this._membersSubscriptions={},this._logger=this._pcastExpress.getPCast().getLogger();var i=this;this._pcastExpress.getPCastObservable().subscribe(function(e){if(!e){var t=v.assign({},i._roomServices);v.forOwn(i._membersSubscriptions,function(e){e.dispose()}),i._pcastExpress.waitForOnline(function(){v.forOwn(t,function(e){e.stop()})},!0),i._membersSubscriptions={},i._roomServices={},i._activeRoomServices=[]}})}function h(r,n,s){var o=this,a=v.uniqueId();this._pcastExpress.waitForOnline(function(e){if(e)return s(e);var t=_.call(o,r,n);if(t)return s(null,{status:"ok",roomService:t});o._roomServices[a]=new l(o._pcastExpress.getPCast());var i=function(n,e){var s=this,t=n.stop,o=n.leaveRoom;return n.stop=function(){t.call(n),delete s._roomServices[e]},n.leaveRoom=function(i){var r=n.getObservableActiveRoom().getValue();o.call(n,function(e,t){return e?(n.stop(),i(e)):("ok"!==t.status&&"not-in-room"!==t.status||(r&&s._membersSubscriptions[r.getRoomId()]&&(s._membersSubscriptions[r.getRoomId()].dispose(),delete s._membersSubscriptions[r.getRoomId()]),s._logger.info("Successfully disposed of Express Room Service [%s]",r?r.getRoomId():"Uninitialized"),n.stop()),i(null,t))})},n}.call(o,o._roomServices[a],a);s(null,{status:"ok",roomService:i})})}function _(i,r){return v.find(this._activeRoomServices,function(e){var t=e.getObservableActiveRoom().getValue();return t&&(t.getRoomId()===i||t.getObservableAlias().getValue()===r)})}function d(o,a,l){var u=this,c=o.role,d=o.screenName||v.uniqueId();h.call(u,o.roomId,o.alias,function(e,t){if(e)return a(e);if("ok"!==t.status)return a(null,t);var r=t.roomService,n=r.getObservableActiveRoom(),i=n.getValue(),s=null;if(i||r.start(c,d),o.streams&&function(e,t,i,r){var n=i?i.getObservableActiveRoom().getValue():null;e&&i&&i.getSelf().setStreams(e);t&&i&&i.getSelf().getObservableRole().setValue(t);if(n&&i.getSelf())return T.call(this,i.getSelf(),r)}.call(u,o.streams,o.role,r,function(e){if(e)return a(e)}),i&&l)return a(null,{status:"ok",roomService:r}),n.subscribe(function(e){s&&(s.dispose(),s=null),e&&(s=e.getObservableMembers().subscribe(l,{initial:"notify"}))},{initial:"notify"});r.enterRoom(o.roomId,o.alias,function(e,t){if(e)return r.stop(),a(e);if("not-found"===t.status)return r.stop(),a(null,{status:"room-not-found"});if("ok"!==t.status&&"already-in-room"!==t.status)return r.stop(),a(null,t);var i=t.room;return u._activeRoomServices.push(r),a(null,{status:"ok",roomService:r}),l?(s=i.getObservableMembers().subscribe(l,{initial:"notify"}),n.subscribe(function(e){s&&(s.dispose(),s=null),e&&(s=e.getObservableMembers().subscribe(l,{initial:"notify"}))})):void 0})})}function p(t,e){this._roomServicePublishers[e.getRoomId()]&&t&&(this._roomServicePublishers[e.getRoomId()]=v.filter(this._roomServicePublishers[e.getRoomId()],function(e){return e.getStreamId()!==t.getStreamId()}))}function w(u,c,d,h){var n,p=this,f=u.streamType,m=u.streamInfo,e="high-availability"===u.viewerStreamSelectionStrategy&&d.getObservableType().getValue()===b.types.channel.name,g=null,y=h;if(!u.enableWildcardCapability){var t=I(c,f,m),i=v.assign({},u,{streams:E.call(p,t,d)});return S.call(p,i,y,c,d)}if(e){var r=s.getSimilarMembers(u.screenName,d.getObservableMembers().getValue());g=o(r),y=function(e,t){h(e,t);var i=v.get(t,"roomService",_.call(p,d.getRoomId()));if(!e&&"ok"===t.status&&!n&&i){var r=i.getObservableActiveRoom().getValue();n=r.getObservableMembers().subscribe(function(e){var t=o(s.getSimilarMembers(u.screenName,e));t.length===g.length&&v.reduce(t,function(e,t){return e?v.includes(g,t):e},!0)||(p._logger.debug("Members with similar content to stream [%s] have changed. Generating new wildcard viewer token",c.getStreamId()),n.dispose(),n=null,w.call(p,u,c,r,function(e,t){(e||"ok"!==t.status)&&h(e,t)}))})}}}g&&0<g.length?p._logger.debug("Creating [real-time] viewer wildcard stream token for published stream [%s] with [%s] additional streams",c.getStreamId(),g.length):p._logger.debug("Creating [real-time] viewer wildcard stream token for published stream [%s]",c.getStreamId()),p._pcastExpress.getAdminAPI().createStreamTokenForSubscribing("*",[],c.getStreamId(),g,function(e,l){return e?h(e):"ok"!==l.status?h(null,l):(g&&0<g.length?p._logger.debug("Creating [broadcast] viewer wildcard stream token for published stream [%s] with [%s] additional streams",c.getStreamId(),g.length):p._logger.debug("Creating [broadcast] viewer wildcard stream token for published stream [%s]",c.getStreamId()),void p._pcastExpress.getAdminAPI().createStreamTokenForSubscribing("*",["broadcast"],c.getStreamId(),g,function(e,a){if(e)return h(e);if("ok"!==a.status)return h(null,a);if(v.includes(u.capabilities,"streaming"))return g&&0<g.length?p._logger.debug("Creating [streaming] viewer wildcard stream token for published stream [%s] with [%s] additional streams",c.getStreamId(),g.length):p._logger.debug("Creating [streaming] viewer wildcard stream token for published stream [%s]",c.getStreamId()),p._pcastExpress.getAdminAPI().createStreamTokenForSubscribing("*",["streaming"],c.getStreamId(),g,function(e,o){if(e)return h(e);if("ok"!==o.status)return h(null,o);if(v.includes(u.capabilities,"drm"))return g&&0<g.length?p._logger.debug("Creating [drm-open-access] and [drm-hollywood] viewer wildcard stream token for published stream [%s] with [%s] additional streams",c.getStreamId(),g.length):p._logger.debug("Creating [drm-open-access] and [drm-hollywood] viewer wildcard stream token for published stream [%s]",c.getStreamId()),p._pcastExpress.getAdminAPI().createStreamTokenForSubscribing("*",["streaming","drm-open-access"],c.getStreamId(),g,function(e,s){return e?h(e):"ok"!==s.status?h(null,s):p._pcastExpress.getAdminAPI().createStreamTokenForSubscribing("*",["streaming","drm-hollywood"],c.getStreamId(),g,function(e,t){if(e)return h(e);if("ok"!==t.status)return h(null,t);var i=[s.streamToken,t.streamToken],r=I(c,f,m,l.streamToken,a.streamToken,o.streamToken,i),n=v.assign({},u,{streams:E.call(p,r,d)});S.call(p,n,y,c,d)})});var t=I(c,f,m,l.streamToken,a.streamToken,o.streamToken),i=v.assign({},u,{streams:E.call(p,t,d)});S.call(p,i,y,c,d)});var t=I(c,f,m,l.streamToken,a.streamToken),i=v.assign({},u,{streams:E.call(p,t,d)});S.call(p,i,y,c,d)}))})}function o(e){return v.reduce(e,function(e,t){var i=v.get(t.getObservableStreams().getValue(),"0"),r=i?i.getPCastStreamId():"";return r&&e.push(r),e},[])}function S(s,o,a,l){var u=this,c=_.call(u,l.getRoomId()),d={publisher:a,roomService:c};f.call(u,s.streams,s.memberRole,c,s,function(e,t){if(e)return o(e);if("ok"===t.status){var i=(c=_.call(u,l.getRoomId())).getSelf().getObservableStreams().getValue(),r=v.find(i,function(e){return e.getPCastStreamId()===a.getStreamId()});(function(r,n){var e=r.getTracks(),s=this;v.forEach(e,function(i){v.addEventListener(i,"StateChange",function(){var e=i.enabled?y.states.trackEnabled.name:y.states.trackDisabled.name,t=function(r){var e=v.find(this._activeRoomServices,function(e){var t=e.getSelf(),i=t?t.getObservableStreams().getValue():[];return v.find(i,function(e){return r===e})});return e?e.getSelf():null}.call(s,n);s._logger.info("[%s] [%s] Track state changed to [%s], updating room member stream state [%s]",r.id,i.id,i.enabled,e),"video"===i.kind?n.getObservableVideoState().setValue(e):n.getObservableAudioState().setValue(e),t&&T.call(s,t)})})}).call(u,a.getStream(),r)}if("ok"===t.status&&!a._cleanUpRoomWrapper){var n=v.bind(a.stop,a);a._cleanUpRoomWrapper=!0,a.stop=function(){p.call(u,a,l);var e=E.call(u,null,l),t=_.call(u,l.getRoomId());n.apply(a,arguments),t&&f.call(u,e,s.memberRole,t,s,function(e){if(e)return o(e)})}}return o(null,v.assign({},d,t))})}function E(s,e){var t=_.call(this,e.getRoomId()),i=s?[s]:[];if(!t)return i;var r=t.getSelf();if(!r)return i;var n=v.map(r.getObservableStreams().getValue(),function(e){return e.toJson()}),o=this._roomServicePublishers[e.getRoomId()]||[],a=v.map(o,function(e){return e.getStreamId()});return n&&0!==n.length?(s&&(n=v.filter(n,function(e){var t=e.uri===s.uri,i=g.parsePCastStreamIdFromStreamUri(e.uri),r=!!i&&i===g.parsePCastStreamIdFromStreamUri(s.uri),n=e.type===s.type;return!t&&!r||!n})).push(s),v.filter(n,function(e){return v.includes(a,g.parsePCastStreamIdFromStreamUri(e.uri)||e.uri)})):i}function f(e,t,i,r,n){var s=_.call(this,r.room.roomId,r.room.alias),o=i?i.getObservableActiveRoom().getValue():null,a=!o&&!s;if(e&&s&&s.getSelf().setStreams(e),t&&s&&s.getSelf().getObservableRole().setValue(t),o&&s.getSelf())return T.call(this,s.getSelf(),n);if(a){var l=v.assign({role:t,alias:v.get(r,["room","alias"]),roomId:v.get(r,["room","roomId"])},r);d.call(this,l,function(e,t){return e?n(e):"ok"!==t.status&&"already-in-room"!==t.status?n(null,t):void n(e,t)})}}function T(r,n){var s=0,o=this;try{r.commitChanges(function e(t,i){return t&&s++,i&&"ok"!==i.status&&s++,i&&"ok"===i.status?(s=0,!n||n(null,i)):5<=s?(o._logger.warn("Unable to update self after [%s] attempts.",5),n(new Error("Unable to update self"))):0<s&&s<5?(o._logger.warn("Unable to update self after [%s] attempts. Retrying.",s),r.commitChanges(e)):void 0})}catch(e){n(e)}}function k(e,t,i){return t?e(t):i.retry?i.retry():void e(t,i)}function I(e,t,i,r,n,s,o){var a=e.getStream(),l=a?a.getAudioTracks():null,u=a?a.getVideoTracks():null,c=0<l.length&&l[0].enabled,d=0<u.length&&u[0].enabled,h={uri:g.getPCastPrefix()+e.getStreamId(),type:t,audioState:c?y.states.trackEnabled.name:y.states.trackDisabled.name,videoState:d?y.states.trackEnabled.name:y.states.trackDisabled.name},p=v.assign({},i,{streamToken:r,streamTokenForBroadcastStream:n,streamTokenForLiveStream:s});r||delete p.streamToken,n||delete p.streamTokenForBroadcastStream,s||delete p.streamTokenForLiveStream,o&&(m.isArray(o,"drmStreamTokens"),p.streamTokenForLiveStreamWithDrmOpenAccess=o[0],p.streamTokenForLiveStreamWithDrmHollywood=o[1]);var f=v.reduce(p,function(e,t,i){return e+(e?"&":"?")+i+"="+t},"");return 0<f.length&&(h.uri=h.uri+f),h}return n.prototype.dispose=function(){(function(){v.forOwn(this._membersSubscriptions,function(e){e.dispose()}),v.forOwn(this._roomServicePublishers,function(e){v.forEach(e,function(e){e.stop()})}),v.forOwn(this._roomServices,function(e){e.stop()}),this._membersSubscriptions={},this._roomServicePublishers={},this._roomServices={},this._activeRoomServices=[]}).call(this),this._shouldDisposeOfPCastExpress&&this._pcastExpress.dispose()},n.prototype.getPCastExpress=function(){return this._pcastExpress},n.prototype.createRoom=function(n,s){m.isFunction(s,"callback"),m.isObject(n.room,"options.room"),m.isStringNotEmpty(n.room.name,"options.room.name"),m.isStringNotEmpty(n.room.type,"options.room.type"),n.room.description&&m.isStringNotEmpty(n.room.description,"options.room.description");var o=n.room.description||function(e){switch(e){case b.types.channel.name:return"Room Channel";case b.types.moderatedChat.name:return"Moderated Chat";case b.types.multiPartyChat.name:return"Multi Party Chat";case b.types.townHall.name:return"Town Hall";case b.types.directChat.name:return"Direct Chat";default:throw new Error("Unsupported Room Type")}}(n.room.type);h.call(this,null,null,function(e,t){if(e)return s(e);if("ok"!==t.status)return s(null,t);var i=t.roomService,r=v.assign({},n.room);r.description||(r.description=o),i.createRoom(r,function(e,t){return e?s(e):(i.stop(),s(null,t))})})},n.prototype.joinRoom=function(e,s,t){m.isObject(e,"options"),m.isFunction(s,"joinRoomCallback"),m.isStringNotEmpty(e.role,"options.role"),t&&m.isFunction(t,"membersChangedCallback"),e.screenName&&m.isStringNotEmpty(e.screenName,"options.screenName"),e.roomId&&m.isStringNotEmpty(e.roomId,"options.roomId"),e.alias&&m.isStringNotEmpty(e.alias,"options.alias"),e.streams&&m.isArray(e.streams,"options.streams");var i=this,r=function(n){n&&d.call(i,e,function(e,t){var i=t;if(i&&i.roomService){var r=i.roomService.leaveRoom;i.roomService.leaveRoom=function(e){o&&"offline"!==n.getObservableStatus()&&o.dispose(),r(e)}}s(e,t)},t)};if(this._pcastExpress.getPCastObservable())return r(this._pcastExpress.getPCastObservable());var o=this._pcastExpress.getPCastObservable().subscribe(r)},n.prototype.publishToRoom=function(o,a){m.isObject(o,"options"),m.isFunction(a,"callback"),m.isObject(o.room,"options.room"),o.streamUri?m.isStringNotEmpty(o.streamUri,"options.streamUri"):o.mediaConstraints?m.isObject(o.mediaConstraints,"options.mediaConstraints"):m.isObject(o.userMediaStream,"options.userMediaStream"),o.videoElement&&m.isObject(o.videoElement,"options.videoElement"),o.screenName&&m.isStringNotEmpty(o.screenName,"options.screenName"),o.capabilities&&m.isArray(o.capabilities,"options.capabilities"),o.tags&&m.isArray(o.tags,"options.tags"),o.streamInfo&&m.isObject(o.streamInfo,"options.streamInfo"),o.viewerStreamSelectionStrategy&&m.isStringNotEmpty(o.viewerStreamSelectionStrategy,"options.viewerStreamSelectionStrategy"),v.isUndefined(o.enableWildcardCapability)&&(o.enableWildcardCapability=!0),m.isValidType(o.streamType,i.types,"options.streamType"),m.isValidType(o.memberRole,c.roles,"options.memberRole"),m.isBoolean(o.enableWildcardCapability,"options.enableWildcardCapability");var l=this,u=o.screenName||v.uniqueId();this.createRoom(o,function(e,r){if(e)return a(e);if("ok"!==r.status&&"already-exists"!==r.status)return a(null,r);var t=r.room,n=v.assign({monitor:{callback:v.bind(k,l,a),options:{conditionCountForNotificationThreshold:8}},streamInfo:{}},o);if(t.getObservableType().getValue()===b.types.channel.name?n.tags=["channelId:"+t.getRoomId()].concat(n.tags||[]):n.tags=["roomId:"+t.getRoomId()].concat(n.tags||[]),o.streamUri){var i=v.assign({connectOptions:[]},n);return v.find(i.connectOptions,function(e){return v.startsWith(e,"room-id")})||(i.connectOptions=i.connectOptions.concat(["room-id="+t.getRoomId(),"member-role="+o.memberRole,"member-stream-type="+o.streamType,"screen-name="+u])),o.enableWildcardCapability&&i.connectOptions.concat(["member-stream-token-type=Wildcard","member-stream-token-refresh-interval="+3e5]),l._pcastExpress.publishRemote(i,a)}var s=v.assign({},o,{role:c.roles.audience.name,roomId:t.getRoomId()});d.call(l,s,function(e,t){if(e)return a(e);if("ok"!==t.status&&"already-in-room"!==t.status)return a(null,r);var i=t.roomService.getObservableActiveRoom().getValue();(function(r,n,s){var o,a,l=this,e=function(e,t){if(a&&o&&clearInterval(a),e)return s(e);if("ok"!==t.status)return s(null,t);(function(e,t){this._roomServicePublishers[t.getRoomId()]||(this._roomServicePublishers[t.getRoomId()]=[]);this._roomServicePublishers[t.getRoomId()].push(e)}).call(l,t.publisher,n),p.call(l,o,n),o=t.publisher;var i=v.bind(o.stop,o);o.stop=function(){clearInterval(a),i.apply(o,arguments)},r.enableWildcardCapability&&(a=setInterval(function(){l._logger.debug("Refresh wildcard viewer stream token for [%s] interval of [%s] has expired. Creating new token.",o.getStreamId(),3e5);var e=_.call(l,n.getRoomId()),t=e?e.getObservableActiveRoom().getValue():n;w.call(l,r,o,t,function(e,t){(e||"ok"!==t.status)&&s(e,t)})},3e5)),w.call(l,r,t.publisher,n,s)};if(v.get(r,["mediaConstraints","screen"],!1))return v.set(r,["streamInfo","isScreen"],!0),this._pcastExpress.publishScreen(r,e);this._pcastExpress.publish(r,e)}).call(l,n,i,a)})})},n.prototype.publishScreenToRoom=function(e,t){var i=v.assign({mediaConstraints:{screen:!0}},e);this.publishToRoom(i,t)},n.prototype.subscribeToMemberStream=function(t,e,i){m.isObject(t,"memberStream"),m.isObject(e,"options"),m.isFunction(i,"callback");var r=t.getUri(),n=t.getPCastStreamId(),s=function(e,t){var i=g.getInfoFromStreamUri(e),r=(i.streamTokenForLiveStream||i.streamTokenStreaming)&&v.includes(t,"streaming");if(v.includes(t,"drm-open-access")&&v.includes(t,"drm-hollywood"))return;if(r&&i.streamTokenForLiveStreamWithDrmOpenAccess&&(v.includes(t,"drm-open-access")||/(android)/i.test(navigator.userAgent)))return i.streamTokenForLiveStreamWithDrmOpenAccess;if(r&&i.streamTokenForLiveStreamWithDrmHollywood&&v.includes(t,"drm-hollywood"))return i.streamTokenForLiveStreamWithDrmHollywood;if(r&&!v.includes(t,"drm-open-access")&&!v.includes(t,"drm-hollywood"))return i.streamTokenForLiveStream||i.streamTokenStreaming;if(i.streamTokenForBroadcastStream&&v.includes(t,"broadcast"))return i.streamTokenForBroadcastStream;if(!v.includes(t,"streaming")&&!v.includes(t,"broadcast"))return i.streamToken}(r,e.capabilities),o=v.get(t.getInfo(),["isScreen"],!1);if(!n)throw this._logger.error("Invalid Member Stream. Unable to parse streamId from uri"),new Error("Invalid Member Stream. Unable to parse streamId from uri");var a=v.assign({},{streamId:n,streamToken:s},e),l=new u.DisposableList;(function(e,t,r){var n=0,i=function(e,t){if(e)return r(e);if("ok"!==t.status&&"streaming-not-ready"!==t.status)return r(null,t);if(n++,"streaming-not-ready"===t.status&&n<3)return setTimeout(t.retry,n*n*1e3);if("streaming-not-ready"===t.status&&3<=n)return r(null,{status:t.status});var i=v.assign({},t,{status:"ok"});if(1<n)return i.reason="stream-failure-recovered",r(null,i);r(null,i)};if(t)return this._pcastExpress.subscribeToScreen(e,i);return this._pcastExpress.subscribe(e,i)}).call(this,a,o,function(e,r){if(l.dispose(),r&&"ok"===r.status&&r.mediaStream&&r.mediaStream.getStream()&&(l.add(t.getObservableAudioState().subscribe(function(e){var t=r.mediaStream.getMonitor(),i=r.mediaStream.getStream().getAudioTracks();t&&1===i.length&&t.setMonitorTrackState(i[0],e===y.states.trackEnabled.name)},{initial:"notify"})),l.add(t.getObservableVideoState().subscribe(function(e){var t=r.mediaStream.getMonitor(),i=r.mediaStream.getStream().getVideoTracks();t&&1===i.length&&t.setMonitorTrackState(i[0],e===y.states.trackEnabled.name)},{initial:"notify"}))),e&&6===parseInt(e.category))return i(e,{status:"device-insecure"});i(e,r)})},n}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(1),i(4),i(3),i(34),i(40),i(86),i(39),i(80),i(11),i(10)],void 0===(n=function(d,l,u,c,t,s,r,h,e,i,p){"use strict";var f=d.freeze({status:"not-in-room"}),m=d.freeze({status:"already-in-room"}),g=d.freeze({status:"in-another-room"});function n(e){l.isObject(e,"pcast"),l.isFunction(e.getLogger,"pcast.getLogger"),l.isFunction(e.getProtocol,"pcast.getProtocol"),this._pcast=e,this._logger=e.getLogger(),this._protocol=e.getProtocol(),this._self=new u.Observable(null),this._activeRoom=new u.Observable(null),this._cachedRoom=new u.Observable(null),this._roomChatService=null,l.isObject(this._logger,"this._logger"),l.isObject(this._protocol,"this._protocol"),this._authService=new t(this._pcast)}function o(){this._self.setValue(null),this._activeRoom.setValue(null),this._cachedRoom.setValue(null),this._roomChatService=null,this._disposables&&this._disposables.dispose(),this._disposables=null}function y(){var e=this,t=e._activeRoom.getValue(),i=e._self.getValue().getSessionId();if(d.isObject(t)&&i){var r=t.getRoomId(),n=t.getObservableAlias().getValue();e._logger.info("Leaving and re-entering room after reset of self model"),E.call(e,function(){a.call(e,r,n,function(){e._logger.info("Room Reset Completed")})})}}function v(e){l.isObject(e,"event"),l.isString(e.roomId,"event.roomId"),l.isString(e.eventType,"event.eventType"),l.isArray(e.members,"event.members"),d.forEach(e.members,function(e){l.isObject(e,"member")});var t=this;switch(e.eventType){case i.events.memberJoined.name:return t._logger.debug("[%s] Member joined [%s]",e.roomId,e.members),function(e,t){var i=this._activeRoom.getValue(),r=this._cachedRoom.getValue();if(!i||i.getRoomId()!==e)return;i._removeMembers(t),i._addMembers(t),r._removeMembers(t),r._addMembers(t);var n=this,s=d.find(t,function(e){return e.sessionId===n.getSelf().getSessionId()});s&&(R.call(n,i),i._updateMembers([s]));this._logger.info("[%s] Room has now [%d] members",e,i.getObservableMembers().getValue().length)}.call(t,e.roomId,e.members);case i.events.memberLeft.name:return t._logger.debug("[%s] Member left [%s]",e.roomId,e.members),function(e,t){var i=this._activeRoom.getValue(),r=this._cachedRoom.getValue();if(!i||i.getRoomId()!==e)return;i._removeMembers(t),r._removeMembers(t),this._logger.info("[%s] Room has now [%d] members",e,i.getObservableMembers().getValue().length)}.call(t,e.roomId,e.members);case i.events.memberUpdated.name:return t._logger.debug("[%s] Member updated [%s]",e.roomId,e.members),function(e,t){var i=this._activeRoom.getValue(),r=this._cachedRoom.getValue();if(!i||i.getRoomId()!==e)return;var n=function(e){var n=this;return d.map(e,function(e){var t=_(e.sessionId,n._cachedRoom),i=new h(null,e.state,e.sessionId,e.screenName,e.role,e.streams,e.lastUpdate),r=S(i,t);return r.lastUpdate=e.lastUpdate,r})}.call(this,t);i._updateMembers(n),r._updateMembers(n),this._logger.info("[%s] Room has [%d] updated members",e,t.length)}.call(t,e.roomId,e.members);case i.events.roomUpdated.name:return t._logger.debug("[%s] Room updated [%s]",e.roomId,e.room),function(e,t){var i=this._activeRoom.getValue(),r=this._cachedRoom.getValue();if(!i||i.getRoomId()!==e)return;r._update(t),i._update(t)}.call(t,e.roomId,e.room);case i.events.roomEnded.name:t._logger.info("[%s] Room ended",e.roomId);break;default:t._logger.warn("Unsupported room event [%s]",e.eventType)}}function b(e){this.getSelf()&&this.getSelf().getSessionId()===(e||"")||function(e){var t=this._self.getValue().toJson();this._logger.info("Resetting self after sessionId changed to [%s]",e),this._self.setValue(new h(this,t.state,e||"",t.screenName,t.role,t.streams,t.lastUpdate))}.call(this,e)}function _(e,t){var i,r,n=t.getValue().getObservableMembers().getValue();return i=e,r=n,d.find(r,function(e){return i===e.getSessionId()})}function w(e){this._logger.info("PCast status changed to [%s]",e),"offline"!==e.toLowerCase()&&"offline"===this._lastPcastStatus||"offline"===e.toLowerCase()&&"offline"!==this._lastPcastStatus&&d.isNullOrUndefined(this._lastPcastStatus),this._lastPcastStatus=e}function S(e,t){var i=function(e,t){if(!t)return e.toJson();var i={},r=e.toJson(),n=t.toJson(),s=d.findDifferences(r,n,!0);return d.forEach(s,function(e){i[e]=r[e]}),i}(e,t);return i.sessionId=e.getSessionId(),i.lastUpdate=t?t.getLastUpdate():d.now(),i}function a(e,t,r){var i=this._activeRoom.getValue();if(i){var n=e===i.getRoomId()||t===i.getObservableAlias().getValue();return this._logger.info("Unable to join room. Already in [%s]/[%s] room.",i.getRoomId(),i.getObservableAlias().getValue()),r(null,d.assign({room:i},n?m:g))}this._authService.assertAuthorized();var s=this._self.getValue(),o=s.getObservableScreenName().getValue(),a=s.getObservableRole().getValue(),l=S.call(this,s,null),u=d.now();this._logger.info("Enter room [%s]/[%s] with screen name [%s] and role [%s]",e,t,o,a);var c=this;this._protocol.enterRoom(e,t,l,u,function(e,t){if(e)return c._logger.error("Joining of room failed with error [%s]",e),r(e,null);var i={status:t.status};if("ok"!==t.status)return c._logger.warn("Joining of room failed with status [%s]",t.status),r(null,i);i.room=function(e){var t=I.call(this,e),i=I.call(this,e);return R.call(this,t),this._activeRoom.setValue(t),this._cachedRoom.setValue(i),t}.call(c,t),"ok"===t.status&&t.self&&c.getSelf()._update(t.self),r(null,i)})}function E(r){if(!this._activeRoom.getValue())return this._logger.info("Unable to leave room. Not currently in a room."),r(null,f);if(!this._isLeavingRoom){this._authService.assertAuthorized();var e=this._activeRoom.getValue().getRoomId(),t=d.now();this._logger.info("Leave room [%s]",e);var n=this;this._isLeavingRoom=!0,this._protocol.leaveRoom(e,t,function(e,t){if(n._isLeavingRoom=!1,e)return n._logger.error("Leaving room failed with error [%s]",e),r(e,null);var i={status:t.status};if("ok"!==t.status)return n._logger.warn("Leaving room failed with status [%s]",t.status),r(null,i);n._roomChatService&&n._roomChatService.stop(),n._roomChatService=null,n._activeRoom.setValue(null),n._cachedRoom.setValue(null),r(null,i)})}}function T(e,r){if(!this._activeRoom.getValue())return this._logger.warn("Not in a room. Please Enter a room before updating member."),r(null,f);this._authService.assertAuthorized();var t=e.getSessionId()===this.getSelf().getSessionId(),i=_(e.getSessionId(),this._cachedRoom),n=S.call(this,e,i),s=d.now(),o=t&&!i,a=t&&n.role===p.roles.audience.name;o&&(n.lastUpdate=e.getObservableLastUpdate().getValue()),this._logger.info("Updating member info for active room");var l=this;this._protocol.updateMember(n,s,function(e,t){if(e)return l._logger.error("Update of member failed with error [%s]",e),r(e,null);var i={status:t.status};"ok"!==t.status&&l._logger.warn("Update of member failed with status [%s]",t.status),"ok"===t.status&&a&&l.getSelf().getObservableLastUpdate().setValue(t.lastUpdate),r(null,i)})}function k(e){var t=e.room,i=e.members||[];return new r(this,t.roomId,t.alias,t.name,t.description,t.type,i,t.bridgeId,t.pin)}function I(e){var t=e.room,i=e.members;return new s(this,t.roomId,t.alias,t.name,t.description,t.type,i,t.bridgeId,t.pin)}function R(e){var t=this._self.getValue(),i=e.getObservableMembers().getValue(),r=d.findIndex(i,function(e){return t.getSessionId()===e.getSessionId()});if(!d.isNumber(r))return this._logger.info("Self not in server room model.");t._update(i[r].toJson()),i[r]=t,e.getObservableMembers().setValue(i)}return n.prototype.start=function(e,t){if(this._started)return this._logger.warn("RoomService already started.");l.isStringNotEmpty(e,"role"),l.isStringNotEmpty(t,"screenName");var i=p.states.passive.name,r=this._authService.getPCastSessionId(),n=t,s=d.now(),o=new h(this,i,r,n,e,[],s);this._self=new u.Observable(o),this._disposables=new c.DisposableList;var a=this._protocol.onEvent("chat.RoomEvent",d.bind(v,this));return this._disposables.add(a),function(){var e=this._self.subscribe(d.bind(y,this)),t=this._authService.getObservableStatus().subscribe(d.bind(w,this)),i=this._authService.getObservableSessionId().subscribe(d.bind(b,this));this._disposables.add(e),this._disposables.add(t),this._disposables.add(i)}.call(this),this._started=!0,o},n.prototype.getRoomInfo=function(e,t,i){e?l.isStringNotEmpty(e,"roomId"):l.isStringNotEmpty(t,"alias"),l.isFunction(i,"callback"),function(e,t,r){this._authService.assertAuthorized();var n=this;this._protocol.getRoomInfo(e,t,function(e,t){if(e)return n._logger.error("Request to get room info failed with error [%s]",e),r(e,null);var i={status:t.status};if("ok"!==t.status)return n._logger.warn("Request to get room info failed with status [%s]",t.status),r(null,i);i.room=d.freeze(k.call(this,t)),r(null,i)})}.call(this,e,t,i)},n.prototype.createRoom=function(e,t){l.isObject(e,"room"),l.isStringNotEmpty(e.name,"room.name"),l.isStringNotEmpty(e.type,"room.type"),l.isString(e.description,"room.description"),l.isFunction(t,"callback"),function(e,r){this._authService.assertAuthorized();var n=this,t=function(e){return new s(this,"",e.alias,e.name,e.description,e.type,[],e.bridgeId,e.pin).toJson()}(e);this._protocol.createRoom(t,function(e,t){if(e)return n._logger.error("Creating room failed with error [%s]",e),r(e,null);var i={status:t.status};if("ok"!==t.status&&"already-exists"!==t.status)return n._logger.warn("Creating room failed with status [%s]",t.status),r(null,i);i.room=d.freeze(k.call(this,t)),r(null,i)})}.call(this,e,t)},n.prototype.enterRoom=function(e,t,i){e?l.isStringNotEmpty(e,"roomId"):l.isStringNotEmpty(t,"alias"),l.isFunction(i,"callback"),a.call(this,e,t,i)},n.prototype.leaveRoom=function(e){return E.call(this,e)},n.prototype.getChatService=function(){return!this._roomChatService&&this._activeRoom.getValue()&&(this._roomChatService=new e(this)),this._roomChatService},n.prototype.getSelf=function(){return this._self.getValue()},n.prototype.getObservableActiveRoom=function(){return this._activeRoom},n.prototype.updateSelf=function(e){l.isFunction(e,"callback"),T.call(this,this.getSelf(),e)},n.prototype.updateMember=function(e,t){l.isFunction(t,"callback"),l.isObject(e,"member"),T.call(this,e,t)},n.prototype.updateRoom=function(e){l.isFunction(e,"callback"),function(r){if(!this._activeRoom.getValue())return this._logger.warn("Not in a room. Please Enter a room before updating member."),r(null,f);this._authService.assertAuthorized();var e=this._activeRoom.getValue(),t=d.now(),n=this;this._protocol.updateRoom(e.toJson(),t,function(e,t){if(e)return n._logger.error("Update of room failed with error [%s]",e),r(e,null);var i={status:t.status};"ok"!==t.status&&n._logger.warn("Update of room failed with status [%s]",t.status),r(null,i)})}.call(this,e)},n.prototype.revertRoomChanges=function(){var e=this._activeRoom.getValue(),t=this._cachedRoom.getValue();if(!e||!t)return this._logger.warn("Unable to revert changes to room. Not currently in a room.");e._update(t.toJson())},n.prototype.revertMemberChanges=function(e){l.isObject(e,"member");var t=_(e.getSessionId(),this._cachedRoom),i=_(e.getSessionId(),this._activeRoom);if(!t||!i)return this._logger.warn("Unable to revert changes to member. Member is currently not in room.");i._update(t.toJson())},n.prototype.isInRoom=function(){return!!this._activeRoom.getValue()},n.prototype.toString=function(){return"RoomService"},n.prototype.stop=function(){var e=this._activeRoom.getValue(),i=this;if(e)return this.leaveRoom(function(e,t){e&&i._logger.warn("Failure to stop room service. Unable to leave room",e),t&&"ok"!==t.status&&i._logger.warn("Failure to stop room service. Unable to leave room. Status: [%s]",t.status),t&&"ok"===t.status&&(o.call(i),i._started=!1)});o.call(this),i._started=!1},n}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(1),i(2),i(101)],void 0===(n=function(m,s,g,o){"use strict";function e(e,t){s.isObject(e,"pcast"),t&&s.isObject(t,"options"),t&&t.screenShare&&s.isFunction(t.screenShare,"options.screenShare"),this._pcast=e,this._logger=e.getLogger(),this._options=t||{},this._onScreenShare=m.get(t,["onScreenShare"])}return e.prototype.getUserMedia=function(e,t){s.isObject(e,"deviceOptions");var i=new o(this._options),r=i.getDefaultResolution(),n=i.getDefaultFrameRate();(function a(l,u,c,d,h){var e=this.getVendorSpecificConstraints(l,u||{},c);var p=!!e.video;var f=this;this._pcast.getUserMedia(e,function(e,t,i,r){if("ok"===t)return h(null,{userMedia:i,options:{frameRate:p?c:null,resolution:p?m.get(u,["height"],null):null,aspectRatio:p?m.get(u,["aspectRatio"],null):null}});var n=u,s=c,o=function(e){if(e.constraintName)return e.constraintName;if(e.constraint)return e.constraint;return""}(r);if(r&&("ConstraintNotSatisfiedError"===r.name||"OverconstrainedError"===r.name||"OverconstrainedError"===r.constructor.name||"unavailable"===r.code&&"Edge"===g.browser))switch(o.toLowerCase()){case"width":case"height":if(!u||!d.canResolveNextResolution())break;return f._logger.warn("Unable to get user media with constraint [%s] with height [%s] and width [%s]. Retrying with next closest resolution.",o,n.height,n.width),n=d.getNextResolution(u.height,u.aspectRatio),a.call(f,l,n,s,d,h);case"framerate":default:if(c)return f._logger.warn("Unable to get user media with constraint [%s] and framerate [%s]. Retrying without frame rate constraint.",o,c),a.call(f,l,n,s=null,d,h);if(!u||!d.canResolveNextResolution())break;return f._logger.warn("Unable to get user media with constraint [%s] with height [%s] and width [%s]. Retrying with next closest resolution.",o,n.height,n.width),n=d.getNextResolution(u.height,u.aspectRatio),a.call(f,l,n,s,d,h)}return f._logger.error("Unable to get user media with status [%s]",t,r),h(r)},function(e){var t=e;if(f._onScreenShare&&"Chrome"===g.browser){var i,r=function(e){var t=m.get(e,["video","mandatory","chromeMediaSource"]),i=m.get(e,["audio","mandatory","chromeMediaSource"]),r=m.get(e,["video","mandatory","chromeMediaSourceId"]),n=m.get(e,["audio","mandatory","chromeMediaSourceId"]),s={};(t||n)&&(m.set(s,["screen","mediaSource"],t),m.set(s,["screen","mediaSourceId"],r));(i||n)&&(m.set(s,["screenAudio","mediaSource"],i),m.set(s,["screenAudio","mediaSourceId"],n));return s}(e);(t=f._onScreenShare(r)).resolutionHeight&&t.aspectRatio&&(i={width:d.calculateWidthByAspectRatio(t.resolution,t.aspectRatio),height:t.resolutionHeight}),t=function(e,t,i){var r=this.getVendorSpecificConstraints(e,t,i);r.screen&&(r.video=r.screen,delete r.screen);r.screenAudio&&(r.audio=r.screenAudio,delete r.screenAudio);var n=m.get(r,["video","mandatory","mediaSource"]),s=m.get(r,["audio","mandatory","mediaSource"]),o=m.get(r,["video","mandatory","mediaSourceId"]),a=m.get(r,["audio","mandatory","mediaSourceId"]);(n||o)&&(m.set(r,["video","mandatory","chromeMediaSource"],n),m.set(r,["video","mandatory","chromeMediaSourceId"],o),delete r.video.mandatory.mediaSource,delete r.video.mandatory.mediaSourceId);(s||a)&&(m.set(r,["audio","mandatory","chromeMediaSource"],s),m.set(r,["audio","mandatory","chromeMediaSourceId"],a),delete r.audio.mandatory.mediaSource,delete r.audio.mandatory.mediaSourceId);return r}.call(f,r,i,t.frameRate)}return t})}).call(this,e,r,n,i,t)},e.prototype.getVendorSpecificConstraints=function(e,t,i){if(t=t||{},!e||!e.audio&&!e.video&&!e.screen&&!e.screenAudio)throw new Error("Invalid device options. Must pass in at least one device option.");return"Firefox"===g.browser&&38<g.browserVersion||"Chrome"===g.browser&&52<g.browserVersion&&!e.screen&&!e.screenAudio||"Safari"===g.browser&&10<g.browserVersion||"Opera"===g.browser&&40<g.browserVersion?function(e,t,i){var r=e.video,n=e.audio,s=e.screen,o=e.screenAudio,a=t.width,l=t.height,u={};r&&(u.video={height:{min:l,ideal:l,max:l},width:{min:a,ideal:a,max:a},frameRate:{ideal:i,max:i}},r.deviceId&&(u.video.deviceId={exact:r.deviceId}),r.facingMode&&(u.video.facingMode=r.facingMode),a||delete u.video.width,l||delete u.video.height,i||delete u.video.frameRate,a||l||i||r.deviceId||r.facingMode||(u.video=!0));n&&(u.audio={},n.deviceId&&(u.audio.deviceId={exact:n.deviceId}),n.mediaSource&&(u.audio.mediaSource=n.mediaSource),n.mediaSourceId&&(u.audio.mediaSourceId=n.mediaSourceId),n.deviceId||n.mediaSource||n.mediaSourceId||(u.audio=!0));o&&(u.screenAudio={},o.deviceId&&(u.screenAudio.deviceId={exact:o.deviceId}),o.mediaSource&&(u.screenAudio.mediaSource=o.mediaSource),o.mediaSourceId&&(u.screenAudio.mediaSourceId=o.mediaSourceId),o.deviceId||o.mediaSource||o.mediaSourceId||(u.screenAudio=!0));s&&(u.screen={height:{min:l,ideal:l,max:l},width:{min:a,ideal:a,max:a},frameRate:{ideal:i,max:i}},a||delete u.screen.width,l||delete u.screen.height,i||delete u.screen.frameRate,s.mediaSource&&(u.screen.mediaSource=s.mediaSource),a||l||i||s.mediaSource||(u.screen=!0));s&&r&&(u.screen=!0);return u}(e,t,i):"Edge"===g.browser?function(e,t,i){var r=e.video,n=e.audio,s=e.screen,o=t.width,a=t.height,l={};r&&(l.video={height:{min:a,max:a,exact:a},width:{min:o,max:o,exact:o},frameRate:i},r.deviceId&&(l.video.deviceId=r.deviceId),r.facingMode&&(l.video.facingMode=r.facingMode),o||delete l.video.width,a||delete l.video.height,i||delete l.video.frameRate,o||a||i||r.deviceId||r.facingMode||(l.video=!0));n&&(l.audio=!0,n.deviceId&&(l.audio={deviceId:n.deviceId}));s&&(l.screen=!0);return l}(e,t,i):function(e,t,i){var r=e.video,n=e.audio,s=e.screen,o=e.screenAudio,a=t.width,l=t.height,u={};r&&(u.video={mandatory:{minHeight:l,maxHeight:l,minWidth:a,maxWidth:a,maxFrameRate:i}},r.deviceId&&(u.video.mandatory.sourceId=r.deviceId),r.facingMode&&(u.video.facingMode=r.facingMode),r.mediaSource&&(u.video.mandatory.mediaSource=r.mediaSource),r.mediaSourceId&&(u.video.mandatory.mediaSourceId=r.mediaSourceId),a||(delete u.video.mandatory.minWidth,delete u.video.mandatory.maxWidth),l||(delete u.video.mandatory.minHeight,delete u.video.mandatory.maxHeight),i||delete u.video.mandatory.maxFrameRate,a||l||i||r.deviceId||r.facingMode||r.mediaSource||r.mediaSourceId||(u.video=!0));n&&(u.audio={mandatory:{}},n.deviceId&&(u.audio.mandatory.sourceId=n.deviceId),n.mediaSource&&(u.audio.mandatory.mediaSource=n.mediaSource),n.mediaSourceId&&(u.audio.mandatory.mediaSourceId=n.mediaSourceId),n.deviceId||n.mediaSource||n.mediaSourceId||(u.audio=!0));o&&(u.screenAudio={mandatory:{}},o.deviceId&&(u.screenAudio.mandatory.sourceId=o.deviceId),o.mediaSource&&(u.screenAudio.mandatory.mediaSource=o.mediaSource),o.mediaSourceId&&(u.screenAudio.mandatory.mediaSourceId=o.mediaSourceId),o.deviceId||o.mediaSource||o.mediaSourceId||(u.screenAudio=!0));s&&(u.screen={mandatory:{minHeight:l,maxHeight:l,minWidth:a,maxWidth:a,maxFrameRate:i}},a||(delete u.screen.mandatory.minWidth,delete u.screen.mandatory.maxWidth),l||(delete u.screen.mandatory.minHeight,delete u.screen.mandatory.maxHeight),i||delete u.screen.mandatory.maxFrameRate,s.mediaSource&&(u.screen.mandatory.mediaSource=s.mediaSource),s.mediaSourceId&&(u.screen.mandatory.mediaSourceId=s.mediaSourceId),a||l||i||s.mediaSource||(u.screen=!0));s&&r&&(u.screen=!0);return u}(e,t,i)},e}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(55)],void 0===(n=function(e){return e}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(1),i(3)],void 0===(n=function(s,o,i){"use strict";function e(){this._listeners=[]}function r(t,i,e){var r=this;s.isNullOrUndefined(t)&&(t=[]),o.isArray(t,"args");var n=function(){s.forEach(r._listeners,function(e){e.apply(i,t)})};e?setTimeout(function(){n(),e()},0):n()}return e.prototype.fire=function(e,t){r.call(this,e,t)},e.prototype.fireAsync=function(e,t,i){r.call(this,e,t,i||function(){})},e.prototype.listen=function(t){var e=this;return o.isFunction(t,"listener"),e._listeners.push(t),new i.Disposable(function(){e._listeners=s.remove(e._listeners,function(e){return e===t})})},e.prototype.size=function(){return this._listeners.length},e.prototype.dispose=function(){this._listeners=[]},e.prototype.toString=function(){return"Event|"+this.size()},e}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(63)],void 0===(n=function(e){"use strict";return e}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(1),i(3)],void 0===(n=function(s,o,a){"use strict";function e(e,t){this.latestValue=null,this.subscribeCallbacks={},this.subscriptionTimeout=100,this.subscriptionCount=0,this.resetOnChange=!1,this.lastChangeTime=0,this.isPendingChanges=!1,this.beforeChange=t,r.call(this,e)}function i(e){return null==e?e:s.isArray(e)?e.slice():e}function r(e){var t=e;this.beforeChange&&(t=this.beforeChange(e)),this.latestValue=i(t)}function l(e,t){if(this.lastChangeTime=s.now(),!this.isPendingChanges&&0!==this.subscriptionCount){if(this.isPendingChanges=!0,t)return n.call(this);(function t(e){var i=this;setTimeout(function(){var e=s.now()-i.lastChangeTime;i.resetOnChange&&e<i.subscriptionTimeout?t.call(i,i.subscriptionTimeout-e):n.call(i)},e)}).call(this,e)}}function n(){try{(function(){var t=this;s.forOwn(t.subscribeCallbacks,function(e){s.isFunction(e)&&e(t.latestValue)})}).call(this)}finally{this.isPendingChanges=!1}}return e.prototype.getValue=function(){return i(this.latestValue)},e.prototype.setValue=function(e){e!==this.latestValue&&(r.call(this,e),l.call(this,this.subscriptionTimeout))},e.prototype.subscribe=function(e,t){o.isFunction(e,"callback"),t&&o.isObject(t,"options");var i,r=this,n=s.uniqueId();return r.subscribeCallbacks[n]=e,r.subscriptionCount+=1,t&&("notify"===t.initial&&l.call(r,r.subscriptionTimeout,!0),t.listenForChanges&&(i=setInterval(function(){var e=t.listenForChanges.callback();e!==r.latestValue&&r.setValue(e)},t.listenForChanges.timeout))),new a.Disposable(function(){delete r.subscribeCallbacks[n],i&&(clearInterval(i),i=null),r.subscriptionCount-=1})},e.prototype.extend=function(e){switch(o.isObject(e,"options"),e.method){case"notifyWhenChangesStop":this.subscriptionTimeout=e.timeout,this.resetOnChange=!0;break;case"notifyAtFixedRate":this.subscriptionTimeout=e.timeout}return s.isNumber(e.rateLimit)&&(this.subscriptionTimeout=e.rateLimit),this},e}.apply(t,r))||(e.exports=n)},function(e,t,i){var r;r=function(i,r,n,s,o,a,l,u,c){return function(i){function r(e){if(n[e])return n[e].exports;var t=n[e]={i:e,l:!1,exports:{}};return i[e].call(t.exports,t,t.exports,r),t.l=!0,t.exports}var n={};return r.m=i,r.c=n,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=21)}([function(e,t){e.exports=i},function(e,t){e.exports=r},function(e,t){e.exports=n},function(e,t){e.exports=s},function(e,t,i){var r,n;r=[i(1),i(0),i(2),i(3),i(10),i(7),i(22),i(23),i(13),i(14),i(26),i(5)],void 0!==(n=function(u,r,i,n,l,s,c,d,h,p,f,o){"use strict";function e(e,t){t&&r.isStringNotEmpty(t,"playlistUrl"),this.parsedPlaylist=null,this._logger=e||new i.Logger,this.playlistUrl=t,this.baseUrl=t?t.substring(0,t.lastIndexOf("/")+1):"",this._name=t?t.substring(t.lastIndexOf("/"),t.length):"",this._trackAddedEvent=new n.Event,this._playlistTracksByMimeType={},this._mimeTypes=[],this._deliveryType=g(this.playlistUrl),this._type=null,this._localToServerTimeOffset=0}function m(e,t){r.isInstanceOf(e,s,"track"),t=t||u.noop,r.isFunction(t,"eventCallback");var i=e.getMimeType();this._playlistTracksByMimeType[i]||(this._playlistTracksByMimeType[i]=[]),u.includes(this._playlistTracksByMimeType[i],e)||this._playlistTracksByMimeType[i].push(e),u.includes(this._mimeTypes,i)||this._mimeTypes.push(i),this._trackAddedEvent.fireAsync([e],this,t)}function g(e){return/[.]mpd\??[^\s]*/i.test(e)?"Dash":/[.]m3u8\??[^\s]*/i.test(e)?"Hls":null}function y(e,t,i){if(this._logger.error("Failed to load playlist [%s]. Status code: [%s] (status text: [%s])",this.playlistUrl,e.code,e.message),t&&5===t.attempts){var r="Failed to get playlist with max retries of [5 after ["+u.get(t,["stats","totalResponseTimeForAllAttempts"],0)+"] ms";return i(a(o.name.playlistNotFound.name,o.severity.CRITICAL,r))}if(0===e.code){var n="Failed to get playlist with timeout after ["+u.get(t,["stats","totalResponseTimeForAllAttempts"],0)+"]";return i(a(o.name.timeout.name,o.severity.RECOVERABLE,n))}return i(a(o.name.error.name,o.severity.CRITICAL,e))}function a(e,t,i){return{category:o.category.PLAYLIST,name:e,severity:t,error:"Error"===i.constructor.name?i:new Error(i)}}return e.prototype.toString=function(){return"Playlist [playlistUrl="+this.playlistUrl+", baseUrl="+this.baseUrl+", mimeTypes="+this._mimeTypes+", trackAddedEvent(size)="+this._trackAddedEvent.size()+", playlistTracks="+this.getAllPlaylistTracks()+"]"},e.prototype.dispose=function(){u.forOwn(this._playlistTracksByMimeType,function(e){u.forEach(e,function(e){e.dispose()})}),this._playlistTracksByMimeType={},this._trackAddedEvent.dispose()},e.prototype.getPlaylistTracksByMimeType=function(e){return this._playlistTracksByMimeType[e]},e.prototype.fetch=function(e){(function(i){var r=this;l.getWithRetry(r.playlistUrl,{retryOptions:{backoff:1,delay:1e3,maxAttempts:5,additionalRetryErrorCodes:[0]}},function(e,t){if(e)return y.call(r,e,t,i);(function(e,t,r){var n=null,i=[],s=this;switch(s._initTime=u.now(),this._deliveryType){case"Dash":n=new h(s._logger,e);var o=new f(s._logger,n.timeSources,t);s.parsedPlaylist=n,s._playbackDurationSinceAvailable=s.parsedPlaylist.publishTime?s.parsedPlaylist.publishTime.getTime()-s.parsedPlaylist.availabilityStartTime.getTime():null,s._suggestedPresentationDelayTotalMillis=u.get(s.parsedPlaylist,["suggestedPresentationDelay","totalMillis"],null),s._totalMediaTimeInMillis=u.get(s.parsedPlaylist,["mediaPresentationDuration","totalMillis"],1/0),s._minBufferTimeTotalMillis=u.get(s.parsedPlaylist,["minBufferTime","totalMillis"],null),s._type=s.parsedPlaylist.type,i=function(e){var t=this;return u.map(e.representations,function(e){return{chunkDuration:e.duration,dataChunkUrlTemplate:e.media,codec:e.mseCodec,bandwidth:e.bandwidth,height:e.height,trackId:e.id,initUrl:e.initialization,mimeType:e.mimeType,totalNumberOfChunks:Math.ceil(t._totalMediaTimeInMillis/e.duration)}})}.call(s,s.parsedPlaylist),u.forEach(i,function(e){m.call(s,new c(s._logger,e))}),o.calculateOffset(function(e){s._localToServerTimeOffset=e,r()});break;case"Hls":n=new p(s._logger,s._name,e),s.parsedPlaylist=n,s._playbackDurationSinceAvailable=0,s._minBufferTimeTotalMillis=0,s._suggestedPresentationDelayTotalMillis=0,s._totalMediaTimeInMillis=1/0;var a=0;u.forEach(n.streamVariants,function(e){var t=s.baseUrl+e.name,i=new d(s._logger,{mediaSegmentPlaylistUrl:t,codecs:e.codecs.join("|"),bandwidth:e.bandwidth,trackId:e.name,mimeType:"application/octet-stream",height:null});l.getWithRetry(t,{retryOptions:{maxAttempts:5,backoff:1}},function(e,t){if(e)return y.call(s,e,t,r);i.updateMediaSegments(t.data),m.call(s,i),++a===n.streamVariants.length&&(s._type=i.isComplete()?"static":"dynamic","static"===s._type&&(s._totalMediaTimeInMillis=1e3*i.getPlayableDuration()),r())})});break;default:throw s._logger.error("[%s] Unsupported Delivery Type [%s]",s.playlistUrl,g(s.playlistUrl)),new Error("Unsupported Delivery Type "+g(s.playlistUrl))}}).call(r,t.data,t.stats.successResponseTime,function(){i(e,{raw:t,parsed:r.parsedPlaylist})})})}).call(this,e)},e.prototype.getType=function(){return this._type},e.prototype.getDeliveryType=function(){return this._deliveryType},e.prototype.getPlaylistTracksByBandwidthPerMimeType=function(o,a){r.isObject(a,"restrictions");var l=this;return u.map(this._mimeTypes,function(e){var t,s,i=(t=l.getPlaylistTracksByMimeType(e),s=a,0===u.keys(s).length?t:u.filter(t,function(e){return i=s,r=(t=e).getHeight()||0,n=t.getBandwidth()||0,u.reduce(i,function(e,t,i){switch(i){case"maxHeight":return r<=t;case"minHeight":return t<=r;case"maxBandwidth":return n<=t;case"minBandwidth":return t<=n;default:throw new Error("Unknown restriction "+i)}},!1);var t,i,r,n})),r=u.reduce(i,function(e,t){return t.getBandwidth()>o?e:e&&e.getBandwidth()>t.getBandwidth()?e:t},null)||l.getPlaylistTrackByMimeTypeAndNextHighestBandwidth(0,e);if(r)return r;var n=u.get(u.filter(i,function(e){return!e.getBandwidth()}),"0");if(n)return l._logger.debug("Unable to get track with bandwidth [%s]. Falling back to track [%s].",n.getTrackId()),n;l._logger.warn("Unable to get track with bandwidth [%s]. No other tracks to fallback on.")})},e.prototype.getPlaylistTrackByBandwidthAndMimeType=function(e,t){return u.find(this.getPlaylistTracksByBandwidthPerMimeType(e,{}),function(e){return e.getMimeType()===t})},e.prototype.getPlaylistTrackByMimeTypeAndNextHighestBandwidth=function(i,e){return u.reduce(this.getPlaylistTracksByMimeType(e),function(e,t){return t.getBandwidth()<=i?e:e?e.getBandwidth()>t.getBandwidth()?t:e:t},null)},e.prototype.getAllPlaylistTracks=function(){return[].concat.apply([],u.values(this._playlistTracksByMimeType))},e.prototype.getMimeTypes=function(){return this._mimeTypes},e.prototype.getPlaybackDurationSinceAvailable=function(){return u.now()-this._initTime+this._playbackDurationSinceAvailable+this._localToServerTimeOffset},e.prototype.getSuggestedPresentationDelayTotalMillis=function(){return this._suggestedPresentationDelayTotalMillis},e.prototype.getTotalMediaTimeInMillis=function(){return this._totalMediaTimeInMillis},e.prototype.getMinBufferTimeTotalMillis=function(){return this._minBufferTimeTotalMillis},e.prototype.getLocalToServerTimeOffset=function(){return this._localToServerTimeOffset},e.prototype.addEventListener=function(e,t){switch(r.isString(e,"eventName"),r.isFunction(t,"listener"),e){case"trackadded":return this._trackAddedEvent.listen(t);default:throw new Error('Event "'+e+'" is unknown.')}},e}.apply(t,r))&&(e.exports=n)},function(e,t,i){var r;void 0!==(r=function(){"use strict";return{name:{chunkNotFound:{id:0,name:"chunk-not-found"},timeout:{id:1,name:"timeout"},error:{id:2,name:"error"},playlistNotFound:{id:3,name:"playlist-not-found"},progressTimeOut:{id:4,name:"progress-timeout"},hlsNativeError:{id:5,name:"hls-native-error"}},category:{PLAYLIST:4,STREAMING:5,DRM:6},severity:{RECOVERABLE:1,CRITICAL:2}}}.apply(t,[]))&&(e.exports=r)},function(e,t){e.exports=o},function(e,t,i){var r,n;r=[i(0),i(3),i(2)],void 0!==(n=function(e,t,i){"use strict";function r(e,t,i){}return r.prototype.toString=function(){throw new Error("Must be implemented")},r.prototype.dispose=function(){throw new Error("Must be implemented")},r.prototype.getMseCodec=function(){throw new Error("Must be implemented")},r.prototype.getTrackId=function(){throw new Error("Must be implemented")},r.prototype.getChunkDuration=function(){throw new Error("Must be implemented")},r.prototype.getBandwidth=function(){throw new Error("Must be implemented")},r.prototype.getHeight=function(){throw new Error("Must be implemented")},r.prototype.getMimeType=function(){throw new Error("Must be implemented")},r.prototype.getTotalNumberOfChunks=function(){throw new Error("Must be implemented")},r.prototype.getCurrentChunkId=function(){throw new Error("Must be implemented")},r.prototype.setCurrentChunkId=function(e){throw new Error("Must be implemented")},r.prototype.incrementCurrentChunkId=function(){throw new Error("Must be implemented")},r.prototype.addDataChunk=function(e,t,i){throw new Error("Must be implemented")},r.prototype.getChunks=function(){throw new Error("Must be implemented")},r.prototype.addEventListener=function(e,t){throw new Error("Must be implemented")},r}.apply(t,r))&&(e.exports=n)},function(e,t){e.exports=a},function(e,t,i){var r,n;r=[i(1),i(2)],void 0!==(n=function(s,i){"use strict";function e(e,t){this._options=t||{},this._logger=e||new i.Logger,this._rateDataPoints={},this._ewmaPeriods=t.ewmaPeriods||null,this._ewmaMultiplier=this._ewmaPeriods?2/(this._ewmaPeriods+1):null}function o(e,t,i,r,n){var s=(i*(e.length-1)+n(t))/e.length;if(0<r)for(;t.added-e[0].added>r;){var o=e.shift();s=(s*(e.length+1)-n(o))/e.length}return s}return e.prototype.toString=function(){var i=this;return"StatsProvider [rateDataPoints(keys)="+s.keys(this._rateDataPoints)+", rateDataPoints="+s.toString(s.map(this._rateDataPoints,function(e,t){return i.getRateAverages(t)}))+", options="+this._options+"]"},e.prototype.dispose=function(){delete this._rateDataPoints},e.prototype.addRateDataPoint=function(e,t,i,r){if(!s.isNullOrUndefined(this._rateDataPoints)){this._rateDataPoints[e]||(this._rateDataPoints[e]={tenSecDataPoints:[],thirtySecDataPoints:[],oneMinDataPoints:[],twoMinDataPoints:[],ewmaDataPoints:[],tenSecAverageRate:0,thirtySecAverageRate:0,oneMinAverageRate:0,twoMinAverageRate:0,ewmaRate:0,smaRate:0,tenSecAverageDuration:0,thirtySecAverageDuration:0,oneMinAverageDuration:0,twoMinAverageDuration:0,ewmaDuration:0,smaDuration:0});var n={duration:t,amount:i,durationToSecondsFactor:r,rate:i/(t*r),added:s.now()};(function(e,t){var i=function(e){return e.rate},r=function(e){return e.duration};e.tenSecDataPoints.push(t),e.thirtySecDataPoints.push(t),e.oneMinDataPoints.push(t),e.twoMinDataPoints.push(t),e.tenSecAverageRate=o.call(this,e.tenSecDataPoints,t,e.tenSecAverageRate,1e4,i),e.thirtySecAverageRate=o.call(this,e.thirtySecDataPoints,t,e.thirtySecAverageRate,3e4,i),e.oneMinAverageRate=o.call(this,e.oneMinDataPoints,t,e.oneMinAverageRate,6e4,i),e.twoMinAverageRate=o.call(this,e.twoMinDataPoints,t,e.twoMinAverageRate,12e4,i),e.tenSecAverageDuration=o.call(this,e.tenSecDataPoints,t,e.tenSecAverageDuration,1e4,r),e.thirtySecAverageDuration=o.call(this,e.thirtySecDataPoints,t,e.thirtySecAverageDuration,3e4,r),e.oneMinAverageDuration=o.call(this,e.oneMinDataPoints,t,e.oneMinAverageDuration,6e4,r),e.twoMinAverageDuration=o.call(this,e.twoMinDataPoints,t,e.twoMinAverageDuration,12e4,r),this._ewmaMultiplier&&(e.ewmaDataPoints.push(t),e.smaRate=o.call(this,e.ewmaDataPoints,t,e.smaRate,-1,i),e.smaDuration=o.call(this,e.ewmaDataPoints,t,e.smaDuration,-1,r),e.ewmaDataPoints.length>=this._ewmaPeriods&&(e.ewmaDataPoints.shift(),e.ewmaDataPoints.length===this._ewmaPeriods?(e.ewmaRate=e.smaRate,e.ewmaDuration=e.smaDuration):(e.ewmaRate=this._ewmaMultiplier*(e.smaRate-e.ewmaRate)+e.ewmaRate,e.ewmaDuration=this._ewmaMultiplier*(e.smaDuration-e.ewmaDuration)+e.ewmaDuration)))}).call(this,this._rateDataPoints[e],n)}},e.prototype.getRateAverages=function(e){if(!s.get(this,["_rateDataPoints",e]))return{tenSecAverageRate:0,thirtySecAverageRate:0,oneMinAverageRate:0,twoMinAverageRate:0,ewmaRate:0,tenSecAverageDuration:0,thirtySecAverageDuration:0,oneMinAverageDuration:0,twoMinAverageDuration:0,ewmaDuration:0};var t=this._rateDataPoints[e];return{tenSecAverageRate:t.tenSecAverageRate,thirtySecAverageRate:t.thirtySecAverageRate,oneMinAverageRate:t.oneMinAverageRate,twoMinAverageRate:t.twoMinAverageRate,ewmaRate:t.ewmaRate,tenSecAverageDuration:t.tenSecAverageDuration,thirtySecAverageDuration:t.thirtySecAverageDuration,oneMinAverageDuration:t.oneMinAverageDuration,twoMinAverageDuration:t.twoMinAverageDuration,ewmaDuration:t.ewmaDuration}},e}.apply(t,r))&&(e.exports=n)},function(e,t){e.exports=l},function(e,t){e.exports=u},function(e,t,i){var r;void 0!==(r=function(){"use strict";function e(e,t,i,r){}return e.prototype.toString=function(){throw new Error("Must be implemented")},e.prototype.dispose=function(){throw new Error("Must be implemented")},e.prototype.initialize=function(e,t,i,r){throw new Error("Must be implemented")},e.prototype.getStreamDurationBeforeInitialization=function(){throw new Error("Must be implemented")},e.prototype.getLocalToServerTimeOffset=function(){throw new Error("Must be implemented")},e.prototype.setActiveTracks=function(e){throw new Error("Must be implemented")},e.prototype.initializePlaylistTracks=function(e,t,i,r){throw new Error("Must be implemented")},e.prototype.startRequestingDataForActiveTracks=function(){throw new Error("Must be implemented")},e.prototype.isFetchingData=function(){throw new Error("Must be implemented")},e.prototype.seekToChunk=function(e){throw new Error("Must be implemented")},e.prototype.stopRequestingAllData=function(){throw new Error("Must be implemented")},e}.apply(t,[]))&&(e.exports=r)},function(e,t,i){var r,n;r=[i(1),i(0),i(25)],void 0!==(n=function(v,b,_){"use strict";function e(e,t){b.isStringNotEmpty(t,"mpdXml"),b.isObject(e,"logger"),this._mpdXml=t,this._logger=e,this.minBufferTime=0,this.type=null,this.publishTime=null,this.availabilityStartTime=null,this.timeShiftBufferDepth=0,this.suggestedPresentationDelay=0,this.minimumUpdatePeriod=0,this.maxSegmentDuration=0,this.profiles=null,this.moreInfoUrl=null,this.programInfoTitle=null,this.representations=[],function(){b.isStringNotEmpty(this._mpdXml,"mpdXml");var e,t=_.parseXml(this._mpdXml),i=t.getElementsByTagName("parsererror");if(i&&0<i.length)throw e="Failed to parse MPD Playlist XML: "+i.item(0).innerText+" (source xml: "+this._mpdXml+")",this._logger.error(e),new Error(e);if("MPD"!==t.documentElement.nodeName)throw e='Invalid MPD Playlist XML. Does not start with "MPD": '+this._mpdXml,this._logger.error(e),new Error(e);this.minBufferTime=w(E(t.documentElement,"minBufferTime")),this.type=E(t.documentElement,"type"),this.publishTime=S(E(t.documentElement,"publishTime")),this.availabilityStartTime=S(E(t.documentElement,"availabilityStartTime")),this.timeShiftBufferDepth=w(E(t.documentElement,"timeShiftBufferDepth")),this.suggestedPresentationDelay=w(E(t.documentElement,"suggestedPresentationDelay")),this.minimumUpdatePeriod=w(E(t.documentElement,"minimumUpdatePeriod")),this.maxSegmentDuration=w(E(t.documentElement,"maxSegmentDuration")),this.mediaPresentationDuration=w(E(t.documentElement,"mediaPresentationDuration")),this.profiles=E(t.documentElement,"profiles");var r=t.getElementsByTagName("ProgramInformation"),n=t.getElementsByTagName("UTCTiming");if(r&&1<=r.length){var s=r.item(0);this.programInfoTitle=T(s,"Title").childNodes[0].nodeValue,this.moreInfoUrl=E(s,"moreInformationURL")}var o=t.getElementsByTagName("ContentProtection");if(this.contentProtectionTags=[],0<o.length)for(var a=0;a<o.length;a++){var l=o.item(a),u=v.reduce(l.attributes,function(e,t){return e[t.name]=t.value,e},{});this.contentProtectionTags.push(u)}for(var c=t.getElementsByTagName("Representation"),d=0;d<c.length;d++){var h=function(e){var t={};if(t.id=E(e,"id"),t.mimeType=E(e,"mimeType"),t.codecs=E(e,"codecs"),t.mseCodec=_.getMSECodec(t.mimeType,t.codecs),t.isAudio=0<=t.mimeType.indexOf("audio"),t.isVideo=0<=t.mimeType.indexOf("video"),!_.isCodecSupported(t.mseCodec))return this._logger.debug("MPD representation has unsupported codec. Skipping stream id [%s] (mimeType=[%s], codecs=[%s])",t.id,t.mimeType,t.codecs),null;var i=E(e,"bandwidth");t.bandwidth=i?parseInt(i,10):null;var r=E(e,"height");t.height=r?parseInt(r,10):null;var n=T(e,"SegmentTemplate");return n&&(t.timescale=parseInt(E(n,"timescale")),t.media=E(n,"media"),t.startNumber=parseInt(E(n,"startNumber")),t.duration=parseInt(E(n,"duration")),t.initialization=E(n,"initialization")),t}.call(this,c.item(d));h&&this.representations.push(h)}this.timeSources=[];for(var p=0;p<n.length;p++){var f=n.item(p),m=E(f,"schemeIdUri"),g=E(f,"value"),y=S(g);this.timeSources.push({name:m,value:isNaN(y.getTime())?g:y.getTime()})}}.call(this)}function w(e){if(!e)return null;var t=/^(-)?P(?:(-?[0-9,.]*)Y)?(?:(-?[0-9,.]*)M)?(?:(-?[0-9,.]*)W)?(?:(-?[0-9,.]*)D)?(?:T(?:(-?[0-9,.]*)H)?(?:(-?[0-9,.]*)M)?(?:(-?[0-9,.]*)S)?)?$/.exec(e);if(t){var i="-"===t[1]?-1:1,r={year:n(t[2],i),month:n(t[3],i),week:n(t[4],i),day:n(t[5],i),hour:n(t[6],i),minute:n(t[7],i),second:n(t[8],i)};return r.totalMillis=1e3*(r.second+60*(r.minute+60*(r.hour+24*r.day))),r}return null}function n(e,t){var i=e&&parseFloat(e.replace(",","."));return(isNaN(i)?0:i)*t}function S(e){if(!e)return null;var t=new Date;return t.setTime(Date.parse(e)),t}function E(e,t){var i=e.attributes.getNamedItem(t);return i?i.value:null}function T(e,t){for(var i=0;i<e.childNodes.length;i++){var r=e.childNodes.item(i);if(r.nodeName===t)return r}return null}return e.prototype.toString=function(){return"Mpd [minBufferTime="+this.minBufferTime+", type="+this.type+", publishTime="+this.publishTime+", availabilityStartTime="+this.availabilityStartTime+", timeShiftBufferDepth="+this.timeShiftBufferDepth+", suggestedPresentationDelay="+this.suggestedPresentationDelay+", minimumUpdatePeriod="+this.minimumUpdatePeriod+", maxSegmentDuration="+this.maxSegmentDuration+", profiles="+this.profiles+", moreInfoUrl="+this.moreInfoUrl+", programInfoTitle="+this.programInfoTitle+", representations="+JSON.stringify(this.representations)+"]"},e}.apply(t,r))&&(e.exports=n)},function(e,t,i){var r,n;r=[i(1),i(0)],void 0!==(n=function(f,r){"use strict";function e(e,t,i){r.isStringNotEmpty(i,"M3u8VariantPlaylistString"),r.isStringNotEmpty(t,"name"),r.isObject(e,"logger"),this._rawM3u8VariantPlaylist=i,this._name=t,this._logger=e,function(e){var h=e.match(/[^\r\n]+/g),p=this;return f.forEach(h,function(e,t){var i,r,n,s,o,a,l=e.match(/(?!#)EXT.+?(?=[:\n\r])/),u=f.get(l,["0"],null),c=e.trim().substring(u?u.length+2:0,e.length);switch(u){case"EXT-X-STREAM-INF":p.streamVariants=p.streamVariants||[];var d=[c,h[t+1]];p.streamVariants.push((o=(r=(i=d)[0],n=f.get(r.match(/(?:CODECS=).*?",/),["0"],""),s=f.get(n.split("="),["1"],""),s.substring(1,s.length-2)||"").split(","),a=(m(i[0],"FRAME-RATE")||"").trim(),{programId:m(i[0],"PROGRAM-ID"),codecs:o,bandwidth:parseInt(m(i[0],"BANDWIDTH")),averageBandwidth:parseInt(m(i[0],"AVERAGE-BANDWIDTH")),frameRate:parseInt(parseInt(a)||0),name:f.get(i,["1"],"").trim()}));break;case"EXT-X-ALLOW-CACHE":p.allowCache="YES"===c;break;case"#EXT-X-COMBINED":p.combined="YES"===c;break;case"EXTM3U":case null:break;default:return p._logger.debug("[%s] [Variant] Playlist unsupported key type [%s]",p._name,u)}}),p}.call(this,this._rawM3u8VariantPlaylist)}function m(e,t){var i=new RegExp("(?:"+t+"=).*?(?=[,\n\r])"),r=new RegExp("(?:"+t+"=).*?$"),n=f.get(e.match(i)||e.match(r),["0"],"");return f.get(n.split("="),["1"])}return e.prototype.toString=function(){return"M3u8VariantPlaylist[name="+this._name+",numberOfStreamVariants="+this.streamVariants.length+"]"},e}.apply(t,r))&&(e.exports=n)},function(e,t,i){var r,n;r=[i(1),i(0),i(2),i(3),i(16),i(12),i(4),i(7),i(9),i(13),i(5)],void 0!==(n=function(l,a,n,s,o,e,u,c,d,h,p){"use strict";function t(e,t,i,r){a.isInstanceOf(t,u,"playlist"),a.isInstanceOf(t.parsedPlaylist,h,"playlist.parsedPlaylist"),a.isInstanceOf(i,d,"statsProvider"),a.isStringNotEmpty(t.playlistUrl,"playlist.playlistUrl"),a.isStringNotEmpty(t.baseUrl,"playlist.baseUrl"),r&&r.defaultPresentationDelay&&a.isNumber(r.defaultPresentationDelay,"options.defaultPresentationDelay"),r&&r.targetBufferSizeInMS&&a.isNumber(r.targetBufferSizeInMS,"options.targetBufferSizeInMS"),this._playlist=t,this._baseUrl=this._playlist.baseUrl,this._statsProvider=i,this._logger=e||new n.Logger,this._httpRequestManager=new o(this._logger),this._feederErrorEvent=new s.Event,this._activeTracks=[],this._currentPlaybackTimeInSeconds=0,this._keepFetchingData=!1,this._defaultPresentationDelay=l.get(r,"defaultPresentationDelay",0),this._targetBufferSizeInMS=l.get(r,"targetBufferSizeInMS",0),this._bufferSize=Math.max(this._playlist.getSuggestedPresentationDelayTotalMillis(),this._playlist.getMinBufferTimeTotalMillis(),this._defaultPresentationDelay),this._streamDurationBeforeInitialization=Math.max(this._playlist.getPlaybackDurationSinceAvailable()-this._bufferSize,0),this._timeOfChunkAvailabilityDelta={average:0,values:[],maxSize:10}}function f(t,i,r,n){r=r||l.noop,a.isArray(t,"tracks"),a.isFunction(r,"done");var s=0,o=this;l.forEach(t,function(e){a.isInstanceOf(e,c,"track"),e.setCurrentChunkId(function(e){var t=Math.max(this._targetBufferSizeInMS?this._targetBufferSizeInMS-e:0,0),i=Math.max(Math.floor((this._streamDurationBeforeInitialization-t)/e),0);return"static"===this._playlist.getType()&&(i=0),this._logger.trace("Getting chunk index to start: [%s], playbackTimePassed=[%s], duration=[%s]",i,this._streamDurationBeforeInitialization,e),i}.call(o,e.getChunkDuration())),function(n,s,o){var a=this;(function(i,r){var n=this;n._logger.trace("Fetching init chunk for [%s]: [%s], nextChunkId=[%s]",i.getMseCodec(),n._baseUrl+i.getInitUrl(),i.getCurrentChunkId()),v.call(n,n._baseUrl+i.getInitUrl(),null,500,function(e,t){n._logger.trace("DONE Fetching init chunk for [%s]: [%s], nextChunkId=[%s]",i.getMseCodec(),n._baseUrl+i.getInitUrl(),i.getCurrentChunkId()+(e?": FAILED: "+e.code:": data="+t.data.byteLength)),r(e,t.data)})}).call(a,n,function(e,t){if(e){var i=new Error("Failed to fetch init chunk of stream for config [%s]",n);return i.cause=e,a._logger.error("[%s] (Cause: [%s])",i.message,e),o(i)}if(n.setInitChunkData(t),s){var r=Math.min(Math.floor(a._bufferSize/n.getChunkDuration),1);return a._logger.debug("Got init chunk: data chunksToFetch=[%s], initBufferSize=[%s], chunkDuration=[%s]",r,a._bufferSize,n.getChunkDuration()),y.call(a,n,r,null,o)}o()})}.call(o,e,i,function(e){if(e)return n(e);++s===t.length&&r()})})}function i(){var t=this;l.forEach(t._activeTracks,function(e){e.setCurrentChunkId(m.call(t,e.getChunkDuration()))})}function m(e){var t=e/1e3;return Math.floor(this._currentPlaybackTimeInSeconds/t)}function g(e){var t=1e3*this._currentPlaybackTimeInSeconds+2*e.getChunkDuration()-this._playlist.getPlaybackDurationSinceAvailable(),i=Math.max(t,0);return Math.min(e.getChunkDuration(),i)+this._timeOfChunkAvailabilityDelta.average}function y(t,i,r,n){var s=this;(function(n,s,o){var e,t,a=this,l=(e=a._baseUrl+n.getDataChunkUrlTemplate(),t=n.getCurrentChunkId(),e.replace("$Number%05d$",("00000"+t).substr(-5))),u=n.getCurrentChunkId();a._logger.trace("Fetching data chunk for [%s]: [%s], nextChunkId=[%s]",n.getMseCodec(),l,n.getCurrentChunkId());var c=n.getMseCodec();v.call(a,l,s,w,function(e,t){if(a._logger.trace("DONE Fetching data chunk for [%s] : [%s], nextChunkId=[%s]",c,l,n.getCurrentChunkId()+(e?": FAILED: "+e.code:": data="+t.data.byteLength)),!e){a._statsProvider.addRateDataPoint(c,t.stats.successResponseTime,t.data.byteLength,.001);var i=t.stats.totalResponseTimeForAllAttempts-t.stats.successResponseTime-Math.max(s,0);if(a._timeOfChunkAvailabilityDelta.values.push(i),a._timeOfChunkAvailabilityDelta.average=(a._timeOfChunkAvailabilityDelta.average*(a._timeOfChunkAvailabilityDelta.values.length-1)+i)/a._timeOfChunkAvailabilityDelta.values.length,a._timeOfChunkAvailabilityDelta.values.length>a._timeOfChunkAvailabilityDelta.maxSize){var r=a._timeOfChunkAvailabilityDelta.values.shift();a._timeOfChunkAvailabilityDelta.average=(a._timeOfChunkAvailabilityDelta.average*(a._timeOfChunkAvailabilityDelta.values.length+1)-r)/a._timeOfChunkAvailabilityDelta.values.length}}if(!e&&u===n.getCurrentChunkId())return n.incrementCurrentChunkId(),a._currentPlaybackTimeInSeconds=n.getChunkDuration()*n.getCurrentChunkId()/1e3,n.addDataChunk(t.data,u,function(){o(e)});e?(e.feederReason=404===e.code?"not yet available":"other",o(e)):o(null,t.data)})}).call(s,t,r,function(e){return e&&s._logger.trace('Failed to fetch data chunk of stream for config [%s]". Error: [%s]',t,e),!e&&1<i&&y.call(s,t,i,r,n),n(e)})}function v(n,e,t,s){var o=this,i={responseType:"arraybuffer",retryOptions:{delay:t,maxAttempts:_},timeout:S};if(l.isNumber(e)&&0!==e)i.delay=e;else if(!l.isNullOrUndefined(e)&&0!==e)throw new Error('"delay" must be a positive number greater than or equal to 0 or null or undefined');return this._httpRequestManager.getWithRetry(n,i,function(e,t){if(e){if(o._logger.debug("Failed to load next stream data chunk. Status code: [%s] (status text: [%s]) for [%s]",e.code,e.message,n),t&&t.attempts===_){var i="Failed to get chunk with max retries of ["+_+" after ["+l.get(t,["stats","totalResponseTimeForAllAttempts"],0)+"] ms";return o._logger.warn(i),o._feederErrorEvent.fire([b(p.name.chunkNotFound.name,p.severity.CRITICAL,i)])}if(0===e.code){var r="Failed to get chunk with timeout after ["+l.get(t,["stats","totalResponseTimeForAllAttempts"],0)+"] ms with chunk timeout of ["+S+"]";return o._logger.warn(r),o._feederErrorEvent.fire([b(p.name.timeout.name,p.severity.RECOVERABLE,r)])}return o._feederErrorEvent.fire([b(p.name.error.name,p.severity.CRITICAL,e)])}s(e,t)})}function b(e,t,i){return{category:p.category.STREAMING,name:e,severity:t,error:"Error"===i.constructor.name?i:new Error(i)}}var _=15,w=150,S=5e3;return((t.prototype=Object.create(e.prototype)).constructor=t).prototype.toString=function(){return"MpdPlaylistChunkFeeder [mpdPlaylistUrl="+this._playlist.playlistUrl+", baseUrl="+this._baseUrl+", defaultPresentationDelay="+this._defaultPresentationDelay+"]"},t.prototype.addEventListener=function(e,t){switch(a.isString(e,"eventName"),a.isFunction(t,"listener"),e){case"error":return this._feederErrorEvent.listen(t);default:throw new Error('Event "'+e+'" is unknown.')}},t.prototype.dispose=function(){this.stopRequestingAllData(l.noop),this._httpRequestManager.dispose(),this._playlist.dispose(),this._statsProvider.dispose(),this._feederErrorEvent.dispose(),this._activeTracks=null,this._currentPlaybackTimeInSeconds=0},t.prototype.initialize=function(e,t,i,r,n){var s=this;i=i||l.noop,a.isFunction(i,"done"),this._initializedAt=l.now(),f.call(s,e,!0,i,function(e){return s._logger.error("Unable to initialize active tracks",e),n(e)}),f.call(s,t,!1,r,function(e){return s._logger.error("Unable to initialize alternate tracks",e),n(e)})},t.prototype.getStreamDurationBeforeInitialization=function(){return this._streamDurationBeforeInitialization},t.prototype.getLocalToServerTimeOffset=function(){return this._localToServerTimeOffset},t.prototype.setActiveTracks=function(e){this._activeTracks=e},t.prototype.getActiveTracks=function(){return this._activeTracks},t.prototype.startRequestingDataForActiveTracks=function(){if(this.isFetchingData())return this._logger.debug("Unable to start requesting data. Feeder is already fetching data.");this._keepFetchingData=!0,this._logger.debug("Starting requesting data at timestamp [%s]",this._currentPlaybackTimeInSeconds),i.call(this),function n(s){var o=this,a=o._activeTracks.length;l.forEach(o._activeTracks,function(e,t){!function(i,e){if(l.find(o._activeTracks,function(e){return e.getMimeType()===i.getMimeType()})===i){var r=m.call(o,i.getChunkDuration()),t=r>=i.getTotalNumberOfChunks();if("static"===o._playlist.getType()&&t)return e===a-1&&(o._keepFetchingData=!1),o._logger.info("Finished getting chunks for [static] track [%s] [%s]",i.getTrackId(),i.getMimeType());l.isNullOrUndefined(s)&&"dynamic"===o._playlist.getType()&&(s=g.call(o,i)),y.call(o,i,1,s,function(e){if(e&&e.causes&&0<e.causes.length&&"not yet available"===e.causes[0].feederReason?o._logger.info("Failed to get next chunk (packet not yet available) for [%s]|[%s]. Trying to fetch again in [%s] ms.",i.getMseCodec(),i.getBandwidth(),w):(e&&o._logger.warn("Failed to get next chunk (# of errors=[%s], errors=[%s]). Moving on.",e.causes?e.causes.length:"n/a",e),a--),a<=0&&o._keepFetchingData){if("dynamic"===o._playlist.getType()){var t=g.call(o,i);return o._logger.debug("Done fetching chunk with index [%s] for each active track. Waiting for [%s] ms before moving on to next chunk.",r,t),n.call(o,t)}o._logger.debug("Done fetching chunk with index [%s] for each active track. Moving on to next chunk",r),n.call(o,null)}})}}(e,t)})}.call(this,null)},t.prototype.isFetchingData=function(){return this._keepFetchingData},t.prototype.seekToChunk=function(e){this._currentPlaybackTimeInSeconds=Math.floor(e),this._logger.debug("Seeking to timestamp [%s]",this._currentPlaybackTimeInSeconds),i.call(this)},t.prototype.seekToCurrent=function(){var e=l.reduce(this._activeTracks,function(e,t){return t.getChunkDuration()>e?t.getChunkDuration():e},0),t=(Math.max(this._playlist.getPlaybackDurationSinceAvailable()-this._bufferSize,0)-Math.max(this._targetBufferSizeInMS?this._targetBufferSizeInMS-e:0,e))/1e3;return this._logger.info("Seeking to most recent chunk"),this.seekToChunk(t),t},t.prototype.stopRequestingAllData=function(){this._keepFetchingData&&(this._keepFetchingData=!1,this._logger.debug("Pausing requesting of data at timestamp [%s]",this._currentPlaybackTimeInSeconds),this._httpRequestManager.disposePendingRequests())},t}.apply(t,r))&&(e.exports=n)},function(e,t,i){var r,n;r=[i(1),i(0),i(10),i(6)],void 0!==(n=function(t,s,o,i){"use strict";function e(e){s.isObject(e,"logger"),this._logger=e,this._requestDisposables=new i.DisposableList}return e.prototype.toString=function(){return"HttpRequestManager"},e.prototype.disposePendingRequests=function(){this._requestDisposables.dispose(),this._requestDisposables=new i.DisposableList},e.prototype.dispose=function(){this.disposePendingRequests()},e.prototype.getWithRetry=function(i,e,r){s.isStringNotEmpty(i,"url"),s.isObject(e,"options"),s.isFunction(r,"callback");var n=this;e.retryOptions=t.assign({delay:0,backoff:1,maxAttempts:1,additionalRetryErrorCodes:[404,0]},e.retryOptions),this._requestDisposables.add(o.getWithRetry(i,e,function(e,t){return e&&4e3===e.code?n._logger.debug("Request handler disposed of before response received for get [%s]",i):(e&&n._logger.debug("Status code: [%s] (status text: [%s]) for get [%s]",e.code,e.message,i),r(e,t))}))},e}.apply(t,r))&&(e.exports=n)},function(e,t,i){var r,n;r=[i(1),i(0),i(2),i(3),i(16),i(12),i(4),i(7),i(9),i(14),i(5)],void 0!==(n=function(l,u,n,s,o,e,a,t,i,c,d){"use strict";function r(e,t,i,r){u.isInstanceOf(t,a,"playlist"),u.isInstanceOf(t.parsedPlaylist,c,"playlist.parsedPlaylist"),u.isStringNotEmpty(t.playlistUrl,"playlist.playlistUrl"),u.isStringNotEmpty(t.baseUrl,"playlist.baseUrl"),r&&r.targetLatencyInMS&&u.isNumber(r.targetLatencyInMS,"options.targetLatencyInMS"),this._playlist=t,this._baseUrl=this._playlist.baseUrl,this._statsProvider=i,this._logger=e||new n.Logger,this._httpRequestManager=new o(this._logger),this._options=r,this._feederErrorEvent=new s.Event,this._activeTracks=[],this._currentPlaybackTimeInSeconds=0,this._keepFetchingData=!1,this._targetLatencyInMS=l.get(r,"targetLatencyInMS",0),this._targetBufferSizeInMS=l.get(r,"targetBufferSizeInMS",0),this._bufferSize=Math.max(this._playlist.getSuggestedPresentationDelayTotalMillis(),this._playlist.getMinBufferTimeTotalMillis(),this._defaultPresentationDelay),this._streamDurationBeforeInitialization=Math.max(this._playlist.getPlaybackDurationSinceAvailable()-this._bufferSize,0)}function h(){var e=this;l.isNumber(e._mediaSegmentRequestTimeout)||(e._mediaSegmentRequestTimeout=setTimeout(function(){(function(n){var s=this,o=0;l.forEach(this._activeTracks,function(i){var r=i.getMediaSegmentPlaylistUrlInfo(),e=l.assign({version:l.now()},r.queryParameters),t={retryOptions:{delay:b,maxAttempts:_},queryParameters:e};s._httpRequestManager.getWithRetry(r.url,t,function(e,t){if(e)return s._logger.debug("Unable to get media segment playlist [%s]",r.url);t&&i.updateMediaSegments(t),++o===s._activeTracks.length&&n()})},v)}).call(e,function(){l.isNullOrUndefined(e._mediaSegmentRequestTimeout)||(e._mediaSegmentRequestTimeout=null,h.call(e))})},v))}function p(r){var n=this,s=n._activeTracks.length;n._waitingForNextSegment=!1,l.forEach(n._activeTracks,function(e,t){var i;i=e,l.find(n._activeTracks,function(e){return e.getMimeType()===i.getMimeType()})!==i?n._logger.debug("Wrong track type [%s]. Pausing fetching for track [%s]",i.getMimeType(),i.getTrackId()):i.isLastMediaSegment(n._currentPlaybackTimeInSeconds)?("dynamic"===n._playlist.getType()&&(n._waitingForNextSegment=!0),n._logger.debug("No more chunks. Pausing fetching for track [%s]",i.getMimeType(),i.getTrackId())):f.call(n,i,1,r,function(e){if(e&&e.causes&&0<e.causes.length&&"not yet available"===e.causes[0].feederReason?n._logger.info("Failed to get next chunk (packet not yet available) for [%s]|[%s]. Trying to fetch again in [%s] ms.",i.getMseCodec(),i.getBandwidth(),y):(e&&n._logger.warn("Failed to get next chunk (# of errors=[%s], errors=[%s]). Moving on.",e.causes?e.causes.length:"n/a",JSON.stringify(e)),s--),s<=0){n._logger.debug("Done fetching chunk for timestamp [%s] for each active track. Moving on to next chunk. (keep fetching=[%s])",n._currentPlaybackTimeInSeconds,n._keepFetchingData);var t=i.isLastMediaSegment(n._currentPlaybackTimeInSeconds);if("static"===n._playlist.getType()&&t)return n._keepFetchingData=!1,n._logger.info("Finished getting chunks for [static] track [%s] [%s]",i.getTrackId(),i.getMimeType());if(t)return n._waitingForNextSegment=!0,n._logger.debug("Waiting for new segment on the Segment Playlist for [dynaimic] track [%s] [%s]",i.getTrackId(),i.getMimeType());n._keepFetchingData&&p.call(n,null)}})})}function f(t,i,r,n){var s=this;(function(i,e,r){var n=this,s=i.getSegmentByTimestamp(n._currentPlaybackTimeInSeconds),o=n._baseUrl+s.name;n._logger.trace("Fetching data chunk for [%s]: [%s], next segment=[%s]",i.getMseCodec(),o,s.name);var a=i.getMseCodec();(function(n,e,s){var o=this,t={responseType:"arraybuffer",retryOptions:{delay:y,maxAttempts:g},timeout:w};if(l.isNumber(e))t.delay=e;else if(!l.isNullOrUndefined(e))throw new Error('"delay" must be a number or null or undefined');return this._httpRequestManager.getWithRetry(n,t,function(e,t){if(e){if(o._logger.debug("Failed to load next stream data chunk. Status code: [%s] (status text: [%s]) for [%s]",e.code,e.message,n),t&&t.attempts===g){var i="Failed to get chunk with max retries of ["+g+" after ["+l.get(t,["stats","totalResponseTimeForAllAttempts"],0)+"] ms";return o._feederErrorEvent.fire([m(d.name.chunkNotFound.name,d.severity.CRITICAL,i)])}if(0===e.code){var r="Failed to get chunk with timeout after ["+l.get(t,["stats","totalResponseTimeForAllAttempts"],0)+"] ms with chunk timeout of ["+w+"]";return o._feederErrorEvent.fire([m(d.name.timeout.name,d.severity.RECOVERABLE,r)])}return o._feederErrorEvent.fire([m(d.name.error.name,d.severity.CRITICAL,e)])}s(e,t)})}).call(n,o,e,function(e,t){if(n._logger.trace("DONE Fetching data chunk for [%s] : [%s], next segment=[%s]",a,o,s.name+(e?": FAILED: "+e.code:": data="+t.data.byteLength)),e||n._statsProvider.addRateDataPoint(a,t.stats.successResponseTime,t.data.byteLength,.001),!e)return n._logger.debug("Finished fetching [%s]. Updating timestamp to fetch to [%s]",s.name,s.timestamp+s.duration),n._currentPlaybackTimeInSeconds=s.timestamp+s.duration,i.addDataChunk(t.data,s.name,function(){r(e)});e?(e.feederReason=404===e.code?"not yet available":"other",r(e)):r(null,t.data)})}).call(s,t,r,function(e){return e&&s._logger.trace('Failed to fetch data chunk of stream for config [%s]". Error: [%s]',JSON.stringify(t),e),!e&&1<i&&f.call(s,t,i,r,n),n(e)})}function m(e,t,i){return{category:d.category.STREAMING,name:e,severity:t,error:"Error"===i.constructor.name?i:new Error(i)}}var g=15,y=700,v=200,b=10,_=2,w=5e3;return((r.prototype=Object.create(e.prototype)).constructor=r).prototype.toString=function(){return"M3u8PlaylistChunkFeeder [mpdPlaylistUrl="+this._playlist.playlistUrl+", baseUrl="+this._baseUrl+", defaultPresentationDelay="+this._defaultPresentationDelay+"]"},r.prototype.addEventListener=function(e,t){switch(u.isString(e,"eventName"),u.isFunction(t,"listener"),e){case"error":return this._feederErrorEvent.listen(t);default:throw new Error('Event "'+e+'" is unknown.')}},r.prototype.dispose=function(){this.stopRequestingAllData(l.noop),this._httpRequestManager.dispose(),this._playlist.dispose(),this._statsProvider.dispose(),this._activeTracks=null,this._currentPlaybackTimeInSeconds=0,this._segmentsReadyDisposable&&(this._segmentsReadyDisposable.dispose(),this._segmentsReadyDisposable=null)},r.prototype.initialize=function(t,e,i,r,n){i=i||l.noop,u.isFunction(i,"done"),this.setActiveTracks(t),"dynamic"===this._playlist.getType()&&h.call(this);var s=this,o=0,a=function(e){f.call(s,e,1,null,function(e){if(e)return n(e);++o===t.length&&(s._initializedAt=l.now(),i(),r())})};l.forEach(t,function(e){return s._segmentsReadyDisposable=e.addEventListener("segmentsready",function(){if(s._waitingForNextSegment){if(s._logger.debug("Continuing fetching of track [%s] segments after wait",e.getTrackId()),!s._initializedAt)return s.seekToCurrent(),a(e);p.call(s,null)}}),e.hasSegments()?a(e):s._waitingForNextSegment=!0})},r.prototype.getStreamDurationBeforeInitialization=function(){return this._streamDurationBeforeInitialization},r.prototype.getLocalToServerTimeOffset=function(){return this._localToServerTimeOffset},r.prototype.setActiveTracks=function(e){this._activeTracks=e;var t=l.map(e,function(e){return e.getTrackId()});this._logger.debug("Setting active tracks [%s]",t)},r.prototype.getActiveTracks=function(){return this._activeTracks},r.prototype.startRequestingDataForActiveTracks=function(){if(this.isFetchingData())return this._logger.debug("Unable to start requesting data. Feeder is already fetching data.");this._keepFetchingData=!0,this._logger.debug("Starting requesting data at timestamp [%s]",this._currentPlaybackTimeInSeconds),"dynamic"===this._playlist.getType()&&h.call(this),p.call(this,null)},r.prototype.isFetchingData=function(){return this._keepFetchingData},r.prototype.seekToChunk=function(e){var t=l.get(this._activeTracks,["0"]),i=t.getClosestSegmentNotGreaterThanTimestamp(e),r=l.get(i,["timestamp"]);l.isUndefined(r)?t||(this._currentPlaybackTimeInSeconds=e):this._currentPlaybackTimeInSeconds=Math.floor(i.timestamp),this._logger.debug("Seeking to timestamp [%s]",this._currentPlaybackTimeInSeconds)},r.prototype.seekToCurrent=function(){var e=l.reduce(this._activeTracks,function(e,t){var i=l.get(t.getLastSegment(),["duration"],0);return e<i?i:e},0),t=(l.reduce(this._activeTracks,function(e,t){var i=t.getLastSegment().timestamp;return i<e?i:e},0)-Math.max(this._targetBufferSizeInMS?this._targetBufferSizeInMS-e:0,e))/1e3;return this._logger.info("Seeking to most recent chunk"),this.seekToChunk(t),t},r.prototype.stopRequestingAllData=function(){this._keepFetchingData&&(this._keepFetchingData=!1,this._waitingForNextSegment=!1,this._logger.debug("Pausing requesting of data at timestamp [%s]",this._currentPlaybackTimeInSeconds),this._httpRequestManager.disposePendingRequests(),clearTimeout(this._mediaSegmentRequestTimeout),this._mediaSegmentRequestTimeout=null)},r}.apply(t,r))&&(e.exports=n)},function(e,t,i){var r,n;r=[i(1),i(0),i(2),i(3),i(10),i(6),i(11),i(8),i(5)],void 0!==(n=function(h,p,a,l,f,m,e,g,y){"use strict";function t(e,t,i,r){p.isObject(t,"videoElement");var n=this;this._videoElement=t,this._logger=e||new a.Logger,this._mediaKeys=null,this._licenseRequestRetryTimeout=null,this._certificateRequestRetryTimeout=null,this._disposables=new m.DisposableList;var s,o=h.bind(C,this);"Safari"===_.browser&&(o=h.bind(function(e,t){var i,r,n=this;if(t=t||1,!this._fairplayServerCertificate){if(t<=20)return n._logger.debug("Attempt [%s] for checking if the certificate have been set",t),void(n._certificateRequestRetryTimeout=setTimeout(function(){C.call(n,e,t+1)},200));var s="Unable to find fairplay certificate after "+(t-1)+" attempts";return n._logger.warn(s),n._drmErrorEvent.fire([b("NoCertificate",y.severity.RECOVERABLE,s)])}this._logger.info("Key requested by Webkit browser"),n._fallbackLicenseUri=(i=e.initData,"https://"+(r=i,String.fromCharCode.apply(null,new g.global.Uint16Array(r.buffer))).split("skd://")[1]);var o="phenix-fairplay-"+h.now(),a=function(e,t,i){var r=function(e){for(var t=new g.global.ArrayBuffer(2*e.length),i=new g.global.Uint16Array(t),r=0,n=e.length;r<n;r++)i[r]=e.charCodeAt(r);return i}(t),n=0,s=new g.global.ArrayBuffer(e.byteLength+4+r.byteLength+4+i.byteLength),o=new g.global.DataView(s);new Uint8Array(s,n,e.byteLength).set(e),n+=e.byteLength,o.setUint32(n,r.byteLength,!0),n+=4;var a=new g.global.Uint16Array(s,n,r.length);return a.set(r),n+=a.byteLength,o.setUint32(n,i.byteLength,!0),n+=4,new Uint8Array(s,n,i.byteLength).set(i),new Uint8Array(s,0,s.byteLength)}(e.initData,o,n._fairplayServerCertificate);if(n._videoElement.webkitKeys||n._videoElement.webkitSetMediaKeys(new g.global.WebKitMediaKeys(T)),!n._videoElement.webkitKeys)return n._drmErrorEvent.fire([b("webkitKeys",y.severity.RECOVERABLE,new Error("Could not create MediaKeys"))]);var l=n._videoElement.webkitKeys.createSession("video/mp4",a);if(!l)return n._drmErrorEvent.fire([b("webkitKeySession",y.severity.RECOVERABLE,new Error("Could not create key session"))]);var u=h.bind(v,n);l.addEventListener("webkitkeymessage",u,!1),n._disposables.add(new m.Disposable(function(){l.removeEventListener("webkitkeymessage",u,!1)}));var c=function(){n._logger.info("Decryption key was added")};l.addEventListener("webkitkeyadded",c,!1),n._disposables.add(new m.Disposable(function(){l.removeEventListener("webkitkeyadded",c,!1)}));var d=function(e){n._drmErrorEvent.fire([b("webkitkeyerror",y.severity.RECOVERABLE,e)])};l.addEventListener("webkitkeyerror",d,!1),n._disposables.add(new m.Disposable(function(){l.removeEventListener("webkitkeyerror",d,!1)}))},this)),this._videoElement.addEventListener(R,o,!1),this._disposables.add(new m.Disposable(function(){n._videoElement.removeEventListener(R,o,!1)})),this._disposables.add(new m.Disposable(function(){null!==n._licenseRequestRetryTimeout&&g.global.clearTimeout(n._licenseRequestRetryTimeout)})),this._disposables.add(new m.Disposable(function(){null!==n._certificateRequestRetryTimeout&&g.global.clearTimeout(n._certificateRequestRetryTimeout)})),this._defaultMediaKeySystemConfig={initDataTypes:["cenc"],videoCapabilities:[{contentType:'video/mp4; codecs="avc1.42c01f"'}],audioCapabilities:[{contentType:'audio/mp4; codecs="mp4a.40.2"'}],persistentState:"optional",distinctiveIdentifier:"optional"},this._config={},"Edge"===_.browser||"IE"===_.browser?this._selectedKeySystem=S:"Safari"===_.browser?this._selectedKeySystem=T:this._selectedKeySystem=w,function(t,i){var e,r=this,n=(e=h.keys(t).concat(h.keys(i)),h.keys(h.reduce(e,function(e,t){return e[t]=1,e},{})));h.forEach(n,function(e){h.set(r._config,[e],h.assign({},h.get(t,[e],{}),h.get(i,[e],{}))),h.set(r._config,[e,"mediaKeySystemConfiguration"],h.assign({},r._defaultMediaKeySystemConfig,h.get(t,[e,"mediaKeySystemConfiguration"],{}),h.get(i,[e,"mediaKeySystemConfiguration"],{})))})}.call(this,(s=i,h.reduce(s,function(i,e){var r="com.phenixp2p.widevine"===e.schemeIdUri||"com.phenixrts.widevine"===e.schemeIdUri?w:e.schemeIdUri===E?S:e.schemeIdUri;return i[r]={licenseServerUrl:"com.phenixp2p.widevine"===e.schemeIdUri||"com.phenixrts.widevine"===e.schemeIdUri?decodeURIComponent(e.widevineLicenseServerUrl):e.licenseServerUrl,serverCertificateUrl:e.serverCertificateUrl},h.forOwn(e,function(e,t){h.startsWith(t,"mediaKeySystemConfiguration.")&&h.set(i[r],t,e)}),i},{})),r||{}),function(){p.isObject(this._config,"this._config");var i=this;h.forOwn(this._config,function(e,t){p.isValidType(t,k,t),t===i._selectedKeySystem&&(t!==w&&t!==T||p.isStringNotEmpty(e.serverCertificateUrl,t+"[serverCertificateUrl]"),p.isObject(e.mediaKeySystemConfiguration,t+"[mediaKeySystemConfiguration]"),p.isArrayOfString(e.mediaKeySystemConfiguration.initDataTypes,t+"[mediaKeySystemConfiguration][initDataTypes]"),p.isArray(e.mediaKeySystemConfiguration.videoCapabilities,t+"[mediaKeySystemConfiguration][videoCapabilities]"),p.isArray(e.mediaKeySystemConfiguration.audioCapabilities,t+"[mediaKeySystemConfiguration][audioCapabilities]"),p.isStringNotEmpty(e.mediaKeySystemConfiguration.persistentState,t+"[mediaKeySystemConfiguration][persistentState]"),p.isStringNotEmpty(e.mediaKeySystemConfiguration.distinctiveIdentifier,t+"[mediaKeySystemConfiguration][distinctiveIdentifier]"))})}.call(this),this._drmErrorEvent=new l.Event,this._drmTrackEventRestrictionsAvailableEvent=new l.Event,this._disposables.add(this._drmErrorEvent),this._disposables.add(this._drmTrackEventRestrictionsAvailableEvent),I&&function(){var n=this;if(!this._videoElement.mediaKeys){var e=h.get(this._config,[this._selectedKeySystem,"mediaKeySystemConfiguration"]);g.global.navigator.requestMediaKeySystemAccess(this._selectedKeySystem,[e]).then(function(e){e.createMediaKeys().catch(function(e){n._drmErrorEvent.fire([b("CreateMediaKeys",y.severity.CRITICAL,e)]),n._logger.error("Unable to create MediaKeys",e)}).then(function(e){return n._mediaKeys=e,n._videoElement.setMediaKeys(e)}).catch(function(e){n._drmErrorEvent.fire([b("SetMediaKeys",y.severity.CRITICAL,e)]),n._logger.error("Unable to set MediaKeys",e)}).then(function(){return new g.global.Promise(function(r){var e=h.get(n._config,[n._selectedKeySystem,"serverCertificateUrl"]);if(!e)return n._logger.info("Not fetching server certificate because [%s] -> [serverCertificateUrl] is not set",n._selectedKeySystem),r();c(e,function(e,t){if(e)return n._logger.warn("Failed to get service certificate",e),r();var i=d(t.data);return n._mediaKeys.setServerCertificate(i).then(r).catch(function(e){n._logger.warn("Failed to set service certificate",e)})})})})}).catch(function(e){n._drmErrorEvent.fire([b("RequestMediaKeySystemAccess",y.severity.CRITICAL,e)]),n._logger.error("Unable to request MediaKeySystemAccess with error [%s]",e)})}}.call(this),"Safari"===_.browser&&(g.global.WebKitMediaKeys.isTypeSupported("com.apple.fps.1_0","video/mp4")||n._drmErrorEvent.fire([b("isTypeSupported",y.severity.CRITICAL,new Error("com.apple.fps.1_0 Key System not supported"))]),c(h.get(n._config,[n._selectedKeySystem,"serverCertificateUrl"]),function(e,t){e&&(n._drmErrorEvent.fire([b("getServerCertificateFairplay",y.severity.CRITICAL,e)]),n._logger.error("[Fairplay] Failed to get service certificate",e)),n._fairplayServerCertificate=d(t.data)}))}function v(e){var r=this,n=e.target;u.call(this,e.message,function(e,t){if(e)return r._drmErrorEvent.fire([b("LicenseRetrieval",y.severity.RECOVERABLE,e)]);try{var i=n.update(t)}catch(e){return r._drmErrorEvent.fire([b("KeySessionUpdate",y.severity.CRITICAL,e)])}h.isFunction(h.get(i,["catch"]))&&i.catch(function(e){r._drmErrorEvent.fire([b("KeySessionUpdate",y.severity.CRITICAL,e)]),r._logger.error("Update of keySession with license failed [%s]",e)})})}function u(e,s){var t,o=this,i=h.get(this._config,[this._selectedKeySystem,"licenseServerUrl"],this._fallbackLicenseUri),r={};if(p.isStringNotEmpty(i,"licenseServerUrl"),this._selectedKeySystem===S){var n=(new DOMParser).parseFromString(String.fromCharCode.apply(null,new g.global.Uint16Array(e)),"application/xml");if(!n.getElementsByTagName("Challenge")[0])return s(new Error("[Playready] Cannot find `challenge` in key message"));t=atob(n.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue);var a=n.getElementsByTagName("name"),l=n.getElementsByTagName("value");if(a.length!==l.length)return s(new Error("[Playready] Mismatched header name/value pair in key message"));r.headers={};for(var u=0;u<a.length;u++){var c=h.get(a,[u,"childNodes",0,"nodeValue"]),d=h.get(l,[u,"childNodes",0,"nodeValue"]);c&&d&&(r.headers[c]=d)}r.responseType="arraybuffer"}else r.contentType="application/octet-stream",t=e;f.post(i,t,r,function(e,t){if(e)return o._logger.error("Failed to get license with [%s] [%s]",e,t),s(e);if(o._selectedKeySystem===S)return s(null,t.data);var i=t.data,r=null,n=null;try{o._logger.debug("Attempting to unwrap license response"),r=(i=JSON.parse(i)).license||i.ckc,i.trackRestrictions&&o._drmTrackEventRestrictionsAvailableEvent.fire([i.trackRestrictions])}catch(e){if(!(e instanceof SyntaxError))return o._logger.error("Unexpected error [%s]",e),s(e);o._logger.debug("Unwrapping of license failed. Assuming that license response is already unwrapped"),r=i}"<ckc>"===r.substr(0,5)&&"</ckc>"===r.substr(-6)&&(r=r.slice(5,-6));try{n=function(e){for(var t=g.global.atob(e),i=new Uint8Array(t.length),r=0;r<t.length;++r)i[r]=t.charCodeAt(r);return i}(r)}catch(e){o._logger.error("Failed to convert base64 license string [%s] to binary",r),s(e)}s(null,n)})}function c(e,t){f.get(e,{mimeType:"text/plain; charset=x-user-defined"},t)}function d(e){for(var t=e.length,i=new g.global.Uint8Array(t),r=0;r<t;r++)i[r]=e.charCodeAt(r);return i}function b(e,t,i){return{category:y.category.DRM,name:e,severity:t,error:"Error"===i.constructor.name?i:new Error(i)}}var _=new e(g.global.navigator.userAgent).detect(),w="com.widevine.alpha",S="com.microsoft.playready",E="urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95",T="com.apple.fps.1_0",k=h.freeze([{id:1,name:"org.w3.clearkey"},{id:2,name:w},{id:3,name:S},{id:4,name:E},{id:5,name:T}]),I=!!g.global.navigator.requestMediaKeySystemAccess,R="encrypted";I||"Edge"!==_.browser&&"IE"!==_.browser||(R="msneedkey"),"Safari"===_.browser&&(R="webkitneedkey"),t.isSupported=function(){return!(("IE"!==_.browser||11!==_.version)&&("Safari"===_.browser?h.isNullOrUndefined(g.global.WebKitMediaKeys)||h.isNullOrUndefined(g.global.Uint16Array)||h.isNullOrUndefined(g.global.Uint8Array)||h.isNullOrUndefined(g.global.ArrayBuffer)||h.isNullOrUndefined(g.global.DataView):h.isNullOrUndefined(g.global.navigator.requestMediaKeySystemAccess)||h.isNullOrUndefined(g.global.Promise)||h.isNullOrUndefined(g.global.Uint8Array)||h.isNullOrUndefined(g.global.atob)))},t.prototype.addEventListener=function(e,t){switch(p.isString(e,"eventName"),p.isFunction(t,"listener"),e){case"trackRestrictionsAvailable":return this._drmTrackEventRestrictionsAvailableEvent.listen(t);case"error":return this._drmErrorEvent.listen(t);default:throw new Error('Event "'+e+'" is unknown.')}},t.prototype.toString=function(){return"EncryptedMediaHandler [config="+JSON.stringify(this._config)+"]"},t.prototype.dispose=function(){this._disposables.dispose(),delete this._mediaKeys};var C=function(e,t){var i=this;if(t=t||1,!I)try{this._videoElement.msSetMediaKeys(new g.global.MSMediaKeys(this._selectedKeySystem))}catch(r){return i._drmErrorEvent.fire([b("RequestMediaKeySystemAccess",y.severity.CRITICAL,new Error('Unable to create MediaKeys ("'+this._selectedKeySystem+'"). Error: '+r.message))])}if(!this._mediaKeys&&!i._videoElement.msKeys){if(t<=20)return i._logger.debug("Attempt [%s] for checking if the media keys have been set",t),void(i._licenseRequestRetryTimeout=setTimeout(function(){C.call(i,e,t+1)},200));var r="Unable to find media keys after "+(t-1)+" attempts";return i._logger.warn(r),i._drmErrorEvent.fire([b("NoMediaKeys",y.severity.RECOVERABLE,r)])}if(i._videoElement.msKeys){var n=i._videoElement.msKeys.createSession("video/mp4",e.initData);n||i._drmErrorEvent.fire([b("NoKeySession",y.severity.CRITICAL,new Error("Could not create key session"))]);var s=function(e){u.call(i,e.message.buffer,function(e,t){if(e)return i._drmErrorEvent.fire([b("getLicense",y.severity.RECOVERABLE,e)]);n.update(new Uint8Array(t))})};n.addEventListener("mskeymessage",s,!1),i._disposables.add(new m.Disposable(function(){n.removeEventListener("mskeymessage",s,!1)}));var o=function(){i._drmErrorEvent.fire([b("MicrosoftKeyError",y.severity.CRITICAL,new Error("Unexpected `keyerror` event from key session. Code: "+n.error.code+", systemCode: "+n.error.systemCode))])};return n.addEventListener("mskeyerror",o,!1),void i._disposables.add(new m.Disposable(function(){n.removeEventListener("mskeyerror",o,!1)}))}var a=i._mediaKeys.createSession(),l=h.bind(v,i);return a.addEventListener("message",l,!1),i._disposables.add(new m.Disposable(function(){a.removeEventListener("message",l,!1)})),a.generateRequest(e.initDataType,e.initData).then(function(){i._logger.info("passing the media data to CDM")}).catch(function(e){i._drmErrorEvent.fire([b("InitKeySessionFailure",y.severity.CRITICAL,e)]),i._logger.error("Unable to create or initialize key session [%s]",e)})};return t}.apply(t,r))&&(e.exports=n)},function(e,t){e.exports=c},function(e,t,i){var r,n;r=[i(1),i(0),i(2),i(6),i(19),i(4),i(9)],void 0!==(n=function(a,n,s,o,l,u,c){"use strict";function e(e,t,i,r){n.isInstanceOf(t,u,"playlist"),n.isNotUndefined(i,"webPlayer"),n.isInstanceOf(r,c,"statsProvider"),this._playlist=t,this._webPlayer=i,this._statsProvider=r,this._logger=e||new s.Logger,this._bandwidthChangeDetails={nextSwitchCheckTime:a.now()+5e3,oldBandwidth:-1},this._disposables=new o.DisposableList,this._webPlayer.addEventListener("started",a.bind(function(){var s=this;this._bandwidthLimits=a.reduce(this._playlist.getMimeTypes(),function(e,t){var i=s._playlist.getPlaylistTracksByMimeType(t)||[],r=a.filter(i,function(e){return a.isNumber(e.getBandwidth())}),n=a.map(r,function(e){return e.getBandwidth()});return i.length>r.length&&s._logger.info("Excluding [%s] tracks without Bandwidth from ABR switching.",i.length-r.length),e[t]={max:Math.max.apply(null,n),min:Math.min.apply(null,n)},e},{}),this._logger.debug("Listening for bandwidth changes with max and min bandwidths of [%s]",this._bandwidthLimits),this._webPlayer.addEventListener("playbacktimeleft",a.bind(function(e,t){if(!this._bandwidthChangeDetails.isInProgress&&l.isForeground()){var i=this._bandwidthLimits[t.getMimeType()],r=this;if(0<this._bandwidthChangeDetails.nextSwitchCheckTime){if(this._bandwidthChangeDetails.nextSwitchCheckTime>a.now())return;this._bandwidthChangeDetails.nextSwitchCheckTime=0,this._bandwidthChangeDetails.oldBandwidth=-1}var n=a.bind(function(){this._bandwidthChangeDetails.isInProgress=!1},this);if(d.call(r,t,e)&&t.getBandwidth()<i.max){this._bandwidthChangeDetails.isInProgress=!0;var s=this._playlist.getPlaylistTrackByMimeTypeAndNextHighestBandwidth(t.getBandwidth(),t.getMimeType());this._playbackTimeout=setTimeout(function(){d.call(r,t,r._webPlayer.getTimeLeft())?(r._logger.info("Switching to higher quality track with [%s] time left in buffer and ewma of [%s].",r._webPlayer.getTimeLeft(),p.call(r,t)),r._bandwidthChangeDetails.nextSwitchCheckTime=a.now()+1e3*e+g,r._bandwidthChangeDetails.oldBandwidth=t.getBandwidth(),r._webPlayer.changeBandwidthLimit(s.getBandwidth(),n)):r._bandwidthChangeDetails.isInProgress=!1},500)}else if(h.call(r,t,e)&&t.getBandwidth()>i.min){this._bandwidthChangeDetails.isInProgress=!0;var o=this._playlist.getPlaylistTrackByBandwidthAndMimeType(t.getBandwidth()-1,t.getMimeType());this._playbackTimeout=setTimeout(function(){h.call(r,t,r._webPlayer.getTimeLeft())?(r._logger.info("Switching to lower quality track with [%s] time left in buffer and ewma of [%s].",r._webPlayer.getTimeLeft(),p.call(r,t)),r._bandwidthChangeDetails.nextSwitchCheckTime=a.now()+1e3*e+5e3,r._bandwidthChangeDetails.oldBandwidth=t.getBandwidth(),r._webPlayer.changeBandwidthLimit(o.getBandwidth(),n)):r._bandwidthChangeDetails.isInProgress=!1},500)}}},this))},this)),this._disposables.add(l.onBackground(a.bind(f,this,!1))),this._disposables.add(l.onForeground(a.bind(f,this,!0))),this._backgroundTimeout=null,this._foregroundBandwidth=null}function d(e,t){var i=this._statsProvider.getRateAverages(e.getMseCodec()).ewmaDuration,r=e.getChunkDuration();return 3.5<t||0<i&&i<=3*r/4&&2<t/(r/1e3)}function h(e,t){var i=this._statsProvider.getRateAverages(e.getMseCodec()).ewmaDuration,r=e.getChunkDuration();return t<.7||0<i&&7*r/8<=i&&t/(r/1e3)<=1.5}function p(e){return this._statsProvider.getRateAverages(e.getMseCodec()).ewmaDuration}function f(e){null!==this._playbackTimeout&&(clearTimeout(this._playbackTimeout),this._playbackTimeout=null);var t=this._webPlayer.getVideoElement();if(e){if(clearTimeout(this._backgroundTimeout),(this._backgroundTimeout=null)===this._foregroundBandwidth)return;var i=this._foregroundBandwidth;return this._foregroundBandwidth=null,i!==this._webPlayer.getBandwidthLimit()&&(this._bandwidthChangeDetails.nextSwitchCheckTime=a.now()+g,this._logger.info("Detected change to [foreground] for tab. Reverting to [%s] previous bandwidth limit from [%s]",i,this._webPlayer.getBandwidthLimit()),this._webPlayer.changeBandwidthLimit(i)),void(m(t)||"dynamic"!==this._playlist.getType()||(this._logger.info("Detecting application [foreground] with muted video. Resuming playback at most recent available chunk."),this._webPlayer.play()))}var r=this;this._backgroundTimeout=setTimeout(function(){l.isForeground()||(r._foregroundBandwidth=r._webPlayer.getBandwidthLimit(),m(t)||"dynamic"!==r._playlist.getType()||(r._logger.info("Detecting application [background] with muted video. Pausing playback until application focused again."),r._webPlayer.pause()))},y)}function m(e){return!e.muted&&0!==e.volume&&(0<a.get(e,["webkitAudioDecodedByteCount"],0)||0<a.get(e,["audioTracks","length"],0)||e.mozHasAudio||e.hasAudio||e.webkitHasAudio)}var g=15e3,y=3e3;return e.prototype.dispose=function(){null!==this._playbackTimeout&&clearTimeout(this._playbackTimeout),null!==this._backgroundTimeout&&clearTimeout(this._backgroundTimeout),this._disposables.dispose(),this._backgroundTimeout=null,this._playbackTimeout=null},e}.apply(t,r))&&(e.exports=n)},function(e,t,i){"use strict";var r,n;r=[i(4),i(15),i(17),i(27),i(9),i(20),i(5)],void 0!==(n=function(e,t,i,r,n,s,o){return{Playlist:e,MpdPlaylistChunkFeeder:t,M3u8PlaylistChunkFeeder:i,WebPlayer:r,StatsProvider:n,AdaptiveStreamingManager:s,isSupported:r.isSupported,errors:o}}.apply(t,r))&&(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(3),i(2),i(7)],void 0!==(n=function(n,r,s,e){"use strict";function t(e,t,i){if(n.isObject(e,"logger"),n.isObject(t,"playlistTrackConfig"),n.isStringNotEmpty(t.codec,"playlistTrackConfig.codec"),n.isStringNotEmpty(t.mimeType,"playlistTrackConfig.mimeType"),n.isNumber(t.bandwidth,"playlistTrackConfig.bandwidth"),n.isNumber(t.chunkDuration,"playlistTrackConfig.chunkDuration"),n.isStringNotEmpty(t.trackId,"playlistTrackConfig.trackId"),n.isStringNotEmpty(t.initUrl,"playlistTrackConfig.initUrl"),n.isStringNotEmpty(t.dataChunkUrlTemplate,"playlistTrackConfig.dataChunkUrlTemplate"),n.isNumber(t.chunkDuration,"playlistTrackConfig.chunkDuration"),i=i||{},this._logger=e||new s.Logger,this._mseCodec=t.codec,this._chunkDuration=t.chunkDuration,this._bandwidth=t.bandwidth,this._height=t.height,this._trackId=t.trackId,this._mimeType=t.mimeType,this._initUrl=t.initUrl,this._dataChunkUrlTemplate=t.dataChunkUrlTemplate,this._totalNumberOfChunks=t.totalNumberOfChunks,this._currentChunkId=null,this._maxChunksToCache=i.maxChunksToCache||20,this._lowWaterMaxChunks=i.lowWaterMaxChunks||15,n.isNumber(this._maxChunksToCache,"options.maxChunksToCache"),n.isNumber(this._lowWaterMaxChunks,"options.lowWaterMaxChunks"),this._lowWaterMaxChunks>=this._maxChunksToCache)throw new Error('The "maxChunksToCache" cannot be less than or equal to the "lowWaterMaxChunks"');this._initChunk=null,this._dataChunks=[],this._chunkAddedEvent=new r.Event}return((t.prototype=Object.create(e.prototype)).constructor=t).prototype.toString=function(){return"MpdPlaylistTrack [mseCodec="+this._mseCodec+", maxChunksToCache="+this._maxChunksToCache+", lowWaterMaxChunks="+this._lowWaterMaxChunks+", initChunk="+this._initChunk+", dataChunks(size)="+this._dataChunks.length+", chunkAddedEvent(size)="+this._chunkAddedEvent.size()+", trackId="+(this._trackId?this._trackId:"n/a")+", bandwidth="+(this.bandwidth?this.bandwidth:"n/a")+"]"},t.prototype.dispose=function(){this._dataChunks=[],this._chunkAddedEvent.dispose()},t.prototype.getMseCodec=function(){return this._mseCodec},t.prototype.getTrackId=function(){return this._trackId},t.prototype.getChunkDuration=function(){return this._chunkDuration},t.prototype.getBandwidth=function(){return this._bandwidth},t.prototype.getHeight=function(){return this._height},t.prototype.getMimeType=function(){return this._mimeType},t.prototype.getTotalNumberOfChunks=function(){return this._totalNumberOfChunks},t.prototype.getInitChunkData=function(){return this._initChunk},t.prototype.setInitChunkData=function(e){this._initChunk=e},t.prototype.getCurrentChunkId=function(){return this._currentChunkId},t.prototype.setCurrentChunkId=function(e){this._currentChunkId=e},t.prototype.incrementCurrentChunkId=function(){null===this._currentChunkId&&this._logger.error("[%s] Attempting to increment `CurrentChunkId` that is not initialized",this._trackId),this._currentChunkId++},t.prototype.getInitUrl=function(){return this._initUrl},t.prototype.getDataChunkUrlTemplate=function(){return this._dataChunkUrlTemplate},t.prototype.addDataChunk=function(e,t,i){n.isNotUndefined(e,"dataChunk"),i=i||function(){},n.isFunction(i,"eventCallback");var r={data:e,chunkId:t,timestamp:t*this._chunkDuration/1e3};if(this._dataChunks.push(r),this._dataChunks.length>this._maxChunksToCache)for(;this._dataChunks.length>this._lowWaterMaxChunks;)this._dataChunks.shift();this._chunkAddedEvent.fireAsync([r],this,i)},t.prototype.getChunks=function(){return this._dataChunks},t.prototype.addEventListener=function(e,t){if(n.isString(e,"eventName"),n.isFunction(t,"listener"),"chunkadded"!==e)throw new Error('Event "'+e+'" is unknown.');return this._chunkAddedEvent.listen(t)},t}.apply(t,r))&&(e.exports=n)},function(e,t,i){var r,n;r=[i(1),i(0),i(3),i(2),i(7),i(24)],void 0!==(n=function(a,o,l,u,e,c){"use strict";function t(e,t,i){if(o.isObject(e,"logger"),o.isObject(t,"playlistTrackConfig"),o.isStringNotEmpty(t.codecs,"playlistTrackConfig.codecs"),o.isNumber(t.bandwidth,"playlistTrackConfig.bandwidth"),o.isStringNotEmpty(t.trackId,"playlistTrackConfig.trackId"),i=i||{},this._logger=e||new u.Logger,this._mseCodec=1<t.codecs.split("|").length?"video/mp4":"audio/mp4",this._bandwidth=t.bandwidth,this._height=t.height,this._trackId=t.trackId,this._mimeType=t.mimeType,this._totalNumberOfChunks=t.totalNumberOfChunks,this._mediaSegments=[],this._isComplete=!1,this._playableDuration=0,this._chunkDuration=0,this._mediaSegmentPlaylistUrlInfo=(r=t.mediaSegmentPlaylistUrl,n=r.split("?")[0],s=a.get(r.split("?"),[1],""),{url:n,queryParameters:a.reduce(s.split("&"),function(e,t){var i=t.split("=")[0];return i&&(e[i]=t.split("=")[1]),e},{})}),this._currentChunkId=null,this._maxChunksToCache=i.maxChunksToCache||20,this._lowWaterMaxChunks=i.lowWaterMaxChunks||15,o.isNumber(this._maxChunksToCache,"options.maxChunksToCache"),o.isNumber(this._lowWaterMaxChunks,"options.lowWaterMaxChunks"),this._lowWaterMaxChunks>=this._maxChunksToCache)throw new Error('The "maxChunksToCache" cannot be less than or equal to the "lowWaterMaxChunks"');var r,n,s;this._initChunk=null,this._dataChunks=[],this._chunkAddedEvent=new l.Event,this._segmentsReadyEvent=new l.Event}return((t.prototype=Object.create(e.prototype)).constructor=t).prototype.toString=function(){return"M3u8PlaylistTrack"},t.prototype.dispose=function(){this._dataChunks=[],this._chunkAddedEvent.dispose()},t.prototype.getMseCodec=function(){return this._mseCodec},t.prototype.getTrackId=function(){return this._trackId},t.prototype.getChunkDuration=function(){return this._chunkDuration},t.prototype.getBandwidth=function(){return this._bandwidth},t.prototype.getHeight=function(){return this._height},t.prototype.getMimeType=function(){return this._mimeType},t.prototype.getTotalNumberOfChunks=function(){return this._totalNumberOfChunks},t.prototype.getPlayableDuration=function(){return this._playableDuration},t.prototype.isComplete=function(){return this._isComplete},t.prototype.hasSegments=function(){return 0<this._mediaSegments.length},t.prototype.getSegmentByTimestamp=function(t){return a.find(this._mediaSegments,function(e){return e.timestamp<=t&&t<e.timestamp+e.duration})},t.prototype.getLastSegment=function(){return a.get(this._mediaSegments,[this._mediaSegments.length-1],null)},t.prototype.getMediaSegmentPlaylistUrlInfo=function(){return this._mediaSegmentPlaylistUrlInfo},t.prototype.getClosestSegmentNotGreaterThanTimestamp=function(e){return e>this._playableDuration?this._mediaSegments[this._mediaSegments.length-1]:this.getSegmentByTimestamp(e)},t.prototype.isLastMediaSegment=function(e){var t=this.getSegmentByTimestamp(e),i=!this._isComplete&&a.get(t,["timestamp"],0)+a.get(t,["duration"],0)===this._playableDuration,r=!this._isComplete&&e>this._playableDuration;return this._playableDuration===e||i||r},t.prototype.updateMediaSegments=function(e){var t=new c(this._logger,this._trackId,e),i=this._totalNumberOfChunks||0,r=a.map(this._mediaSegments,function(e){return e.name}),n=this,s=a.get(this._mediaSegments,[this._mediaSegments.length-1]),o=a.get(s,["timestamp"])+a.get(s,["duration"])||void 0;a.forEach(t.mediaSegments,function(e){a.includes(r,e.name)||(e.timestamp=a.isUndefined(o)?0:o,n._mediaSegments.push(e),n._playableDuration+=e.duration,o=e.timestamp+e.duration,e.duration>n._chunkDuration&&(n._chunkDuration=e.duration),n._logger.trace("[%s]:[%s]:[%s] Got new segment from playlist [%s]",(new Date).getHours(),(new Date).getMinutes(),(new Date).getSeconds(),e.name))}),i!==this._mediaSegments.length&&(this._isComplete=t.isComplete,this._totalNumberOfChunks=this._mediaSegments.length,this._segmentsReadyEvent.fireAsync([this._mediaSegments],null,a.noop))},t.prototype.addDataChunk=function(e,t,i){o.isNotUndefined(e,"dataChunk"),i=i||function(){},o.isFunction(i,"eventCallback");var r={data:e,chunkId:t,timestamp:t*this._chunkDuration/1e3};if(this._dataChunks.push(r),this._dataChunks.length>this._maxChunksToCache)for(;this._dataChunks.length>this._lowWaterMaxChunks;)this._dataChunks.shift();this._chunkAddedEvent.fireAsync([r],this,i)},t.prototype.getChunks=function(){return this._dataChunks},t.prototype.addEventListener=function(e,t){switch(o.isString(e,"eventName"),o.isFunction(t,"listener"),e){case"chunkadded":return this._chunkAddedEvent.listen(t);case"segmentsready":return this._segmentsReadyEvent.listen(t);default:throw new Error('Event "'+e+'" is unknown.')}},t}.apply(t,r))&&(e.exports=n)},function(e,t,i){var r,n;r=[i(1),i(0)],void 0!==(n=function(l,n){"use strict";function e(e,t,i){n.isStringNotEmpty(i,"m3u8String"),n.isObject(e,"logger"),this._rawM3U8=i,this._logger=e,this._name=t,this.mediaSegments=[],function(e){var o=e.match(/[^\r\n]+/g),a=this;return l.forEach(o,function(e,t){var i=e.match(/(?!#)EXT.+?(?=[:\n\r])/),r=l.get(i,["0"],null),n=e.trim().substring(r?r.length+2:0,e.length);switch("#EXT-X-ENDLIST"===e&&(r="EXT-X-ENDLIST"),r){case"EXT-X-VERSION":a.version=parseFloat(n);break;case"EXT-X-PROGRAM-DATE-TIME":a.programDateTime=n?new Date(n.trim()):null;break;case"EXT-X-TARGETDURATION":a.targetDuration=1e3*parseFloat(n)||0;break;case"EXT-X-MEDIA-SEQUENCE":a.mediaSequence=parseInt(n);break;case"EXTINF":var s=[n,o[t+1]];a.mediaSegments.push(u(s,a.mediaSegments+1));break;case"EXT-X-ENDLIST":a.isComplete=!0;break;case"EXTM3U":case null:break;default:return a._logger.debug("[%s] [Segment] Playlist unsupported key type [%s]",a._name,r)}}),a}.call(this,this._rawM3U8);var r=0;l.forEach(this.mediaSegments,function(e){e.timestamp=r,r+=e.duration}),this.playableDuration=r,this.isComplete=!!this.isComplete}e.prototype.toString=function(){return"vod"};var u=function(e){var t=l.get(e,["0"],"").split(","),i=l.get(t,["0"],0),r=l.get(t,["1"],"").trim(),n=l.get(e,["1"],"").trim();return{duration:parseFloat(i),title:r,name:n}};return e}.apply(t,r))&&(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(8)],void 0!==(n=function(i,r){"use strict";function e(){}return e.prototype.isCodecSupported=function(e){return i.isStringNotEmpty(e,"codec"),r.global.MediaSource&&"function"==typeof r.global.MediaSource.isTypeSupported&&r.global.MediaSource.isTypeSupported(e)},e.prototype.parseXml=function(e){if(i.isStringNotEmpty(e,"xmlString"),void 0!==r.global.DOMParser)return(new r.global.DOMParser).parseFromString(e,"text/xml");if(void 0!==r.global.ActiveXObject&&new r.global.ActiveXObject("Microsoft.XMLDOM")){var t=new r.global.ActiveXObject("Microsoft.XMLDOM");return t.async="false",t.loadXML(e),t}throw new Error("No XML parser found")},e.prototype.getMSECodec=function(e,t){return i.isStringNotEmpty(e,"mpdMimeType"),i.isStringNotEmpty(t,"mpdCodecs"),e+'; codecs="'+t+'"'},new e}.apply(t,r))&&(e.exports=n)},function(e,t,i){var r,n;r=[i(1),i(0),i(10)],void 0!==(n=function(l,r,u){"use strict";function e(e,t,i){r.isObject(e,"logger"),this._logger=e,this._timeSources=t.sort(function(e,t){return n[e.name]-n[t.name]}),this._directSourceOffset=i}var n={"urn:mpeg:dash:utc:http-head:2014":0,"urn:mpeg:dash:utc:direct:2014":1};return e.prototype.calculateOffset=function(e){(function t(i,r){r=r||0;var n=this,e=l.get(this._timeSources,[r],{});(function(s,o){var a=this;switch(s.name){case"urn:mpeg:dash:utc:http-head:2014":return u.get(s.value,{contentType:"text/plain"},function(e,t){var i=l.get(t,["headers","date"],""),r=new Date(i).getTime();if(e||isNaN(r))return a._logger.warn("Unable to resolve dash timing via [%s]",s.value),o();var n=l.now()-r-t.stats.successResponseTime/2;return a._logger.info("Resolved [%s] local to server timestamp offset [%s]",s.name,n),o(n)});case"urn:mpeg:dash:utc:direct:2014":var e=l.now()-s.value-this._directSourceOffset/2;return a._logger.info("Resolved [%s] local to server timestamp offset [%s]",s.name,e),o(e);default:return a._logger.info("Unable to resolve mpd Timing Sources. Defaulting to local time"),o(0)}}).call(this,e,function(e){if(!l.isNumber(e))return t.call(n,i,r+1);i(e)})}).call(this,e)},e.prototype.toString=function(){return"MpdTimeSync [Time Source Number: "+this._timeSources.length+", Direct Source Offset: "+this._directSourceOffset+"]"},e}.apply(t,r))&&(e.exports=n)},function(e,t,i){var r,n;r=[i(1),i(0),i(2),i(3),i(6),i(11),i(8),i(28),i(29),i(4),i(9),i(20),i(15),i(17)],void 0!==(n=function(o,r,n,s,a,l,u,c,t,i,d,h,p,f){"use strict";function e(e,t,i){r.isNotUndefined(t,"videoElement"),r.isNotUndefined(t.videoWidth,"videoElement.videoWidth"),this._logger=e||new n.Logger,this._options=i,this._videoElement=t,this._disposables=new a.DisposableList,this._browserDetails=new l(u.global.navigator.userAgent).detect(),this._preferNative=this._options.preferNative||!1,this._player=null,this._playbackStarted=!1,this._isWaiting=!1,this._playbackStarted=!1,this._playbackTimeLeftEvent=new s.Event,this._playerStartedEvent=new s.Event,this._playerErrorEvent=new s.Event,this._disposables.add(this._playbackTimeLeftEvent),this._disposables.add(this._playerStartedEvent),this._disposables.add(this._playerErrorEvent)}function m(){var t=this;"Edge"===t._browserDetails.browser||"IE"===t._browserDetails.browser?(t._videoElement.play(),t._playbackStarted=!0,t._playerStartedEvent.fireAsync([],t),t._logger.debug("Playback Started")):t._videoElement.play().then(function(){t._playbackStarted=!0,t._playerStartedEvent.fireAsync([],t),t._logger.debug("Playback Started")}).catch(function(e){t._logger.error("Playback Failed [%s]",e)})}return e.prototype.toString=function(){return o.toString(this)},e.prototype.start=function(e){if(r.isStringNotEmpty(e,"uri"),this._player)return this._logger.warn("Already started Phenix Web Player");var s=this;if(this._preferNative||!c.isSupported)return this._player=new t(this._logger,this._videoElement,this._options),this._player.addEventListener("error",function(e){s._playerErrorEvent.fire([e])}),this._disposables.add(this._player),this._player.start(e,function(){m.call(s)});var o=new i(this._logger,e);s._disposables.add(o),o.fetch(function(e){if(e)return s._playerErrorEvent.fire([e]);var t,i=new d(s._logger,{ewmaPeriods:30});"Dash"===o.getDeliveryType()?t=new p(s._logger,o,i,s._options):"Hls"===o.getDeliveryType()&&(t=new f(s._logger,o,i,s._options));var r=new c(s._logger,o,s._videoElement,t,s._options),n=new h(s._logger,o,s,i);r.start(),m.call(s),s._player=r,s._player.addEventListener("playbacktimeleft",function(e,t){s._playbackTimeLeftEvent.fire([e,t])}),s._player.addEventListener("error",function(e){s._playerErrorEvent.fire([e])}),s._disposables.add(s._player),s._disposables.add(i),s._disposables.add(n)})},e.prototype.play=function(){m.call(this),this._player&&this._player.play()},e.prototype.pause=function(){this._logger.info("Pausing web player"),this._player&&this._player.pause()},e.prototype.getVideoElement=function(){return this._videoElement},e.prototype.dispose=function(){this._disposables.dispose(),this._videoElement&&(this._videoElement.load(),this._videoElement.src="",this._videoElement.mediaKeys&&this._videoElement.setMediaKeys(null)),this._player=null,this._videoElement=null},e.prototype.getBandwidthLimit=function(){this._player.getBandwidthLimit()},e.prototype.getTimeLeft=function(){return this._videoElement?function(e){var t=this._videoElement.currentTime,i=this._videoElement.duration,r=function(e,t){for(var i=0;i<e.buffered.length;i++){var r=e.buffered.start(i),n=e.buffered.end(i);if(r<=t&&t<=n)return i}}(e,t),n=o.isNumber(r)?e.buffered.end(r):0,s=0===n?0:n-t;return{bufferedLength:e.buffered.length,current:t,bufferEnd:n,timeBufferedButNotPlayed:s,duration:i,timestampOffset:e.timestampOffset}}.call(this,this._videoElement).timeBufferedButNotPlayed:0},e.prototype.changeBandwidthLimit=function(e,t){this._player.changeBandwidthLimit(e,t)},e.prototype.addEventListener=function(e,t){switch(r.isString(e,"eventName"),r.isFunction(t,"listener"),e){case"playbacktimeleft":return this._playbackTimeLeftEvent.listen(t);case"started":var i=this._playerStartedEvent.listen(t);return this._playbackStarted&&setTimeout(o.bind(t,this),0),i;case"error":return this._playerErrorEvent.listen(t);default:throw new Error('Event "'+e+'" is unknown.')}},e.prototype.getStats=function(){return this._player?this._player.getStats():{}},e.isSupported=t.isSupported||c.isSupported,e}.apply(t,r))&&(e.exports=n)},function(e,t,i){var r,n;r=[i(1),i(0),i(2),i(3),i(6),i(11),i(8),i(4),i(12),i(18)],void 0!==(n=function(h,o,a,l,p,u,c,d,f,m){"use strict";function e(e,t,i,r,n){o.isInstanceOf(t,d,"playlist"),o.isNotUndefined(i,"videoElement"),o.isNotUndefined(i.videoWidth,"videoElement.videoWidth"),o.isNotUndefined(r,"playlistChunkFeeder"),o.isInstanceOf(r,f,"playlistChunkFeeder"),h.isUndefined(h.get(n,"bandwidthToStartAt"))||o.isNumber(n.bandwidthToStartAt,"options.bandwidthToStartAt"),h.isUndefined(h.get(n,"trackRestrictions"))||o.isObject(n.trackRestrictions,"options.trackRestrictions"),h.isUndefined(h.get(n,"bufferSizeToPauseFetch"))||o.isNumber(n.bufferSizeToPauseFetch,"options.bufferSizeToPauseFetch"),h.isUndefined(h.get(n,"bufferSizeToResumeFetch"))||o.isNumber(n.bufferSizeToResumeFetch,"options.bufferSizeToResumeFetch"),h.isUndefined(h.get(n,"maximumFrequencyForAlteringPlaybackRate"))||o.isNumber(n.maximumFrequencyForAlteringPlaybackRate,"options.maximumFrequencyForAlteringPlaybackRate"),h.isUndefined(h.get(n,"playbackRateToRecover"))||o.isNumber(n.playbackRateToRecover,"options.playbackRateToRecover"),h.isUndefined(h.get(n,"targetMinBufferSize"))||o.isNumber(n.targetMinBufferSize,"options.targetMinBufferSize");var s=this;this._options=n,this._videoElement=i,this._feeder=r,this._playlist=t,this._disposables=new p.DisposableList,this._logger=e||new a.Logger,this._bandwidthLimit=h.get(n,"bandwidthToStartAt",2e6),this._trackRestrictions=h.get(n,"trackRestrictions",{}),this._bufferSizeToPauseFetch=h.get(n,"bufferSizeToPauseFetch",60),this._bufferSizeToResumeFetch=h.get(n,"bufferSizeToResumeFetch",30),this._maximumFrequencyForAlteringPlaybackRate=h.get(n,"maximumFrequencyForAlteringPlaybackRate",300),this._targetMinBufferSize=h.get(n,"targetMinBufferSize",2),this._playbackRateToDecreaseBuffer=h.get(n,"playbackRateToDecreaseBuffer",1.03),this._playbackRateToIncreaseBuffer=h.get(n,"playbackRateToIncreaseBuffer",.97),this._targetBufferSizeToStartFastForward=this._targetMinBufferSize+3.5,this._maxBufferSizeWhileRecoveringBufferWithSlowMotion=this._targetMinBufferSize+2,this._playbackStarted=!1,this._isWaiting=!1,this._bufferStats=[],this._browserDetails=new u(c.global.navigator.userAgent).detect(),function(){var t=this,e=h.get(this._playlist,["parsedPlaylist","contentProtectionTags"],[]);if(0!==e.length)return m.isSupported()?(this._encryptedMediaHandler=new m(this._logger,this._videoElement,e,h.get(this._options,"drm")),this._encryptedMediaHandler.addEventListener("error",function(e){t._playerErrorEvent.fire([e])}),this._encryptedMediaHandler.addEventListener("trackRestrictionsAvailable",function(e){0<h.keys(e).length&&(t._trackRestrictions=e,g.call(t),t._videoElement.play())}),void this._disposables.add(this._encryptedMediaHandler)):this._logger.error("DRM not supported by the browser")}.call(this),this._playbackStarted=!1,this._mediaSourceBuffers={},this._bufferDetails={},this._playbackTimeLeftEvent=new l.Event,this._playerErrorEvent=new l.Event,this._feeder.addEventListener("error",function(e){s._playerErrorEvent.fire([e])}),this._disposables.add(this._feeder),this._disposables.add(this._playbackTimeLeftEvent),this._disposables.add(this._playerErrorEvent),this._disposables.add(new p.Disposable(function(){null!==s._switchTrackDisposable&&c.global.clearTimeout(s._switchTrackDisposable)}))}function g(){var e=this._playlist.getPlaylistTracksByBandwidthPerMimeType(this._bandwidthLimit,this._trackRestrictions);return this._feeder.setActiveTracks(e),e}function y(e,t,i){this._logger.debug("VIDEO EVENT: [%s]",e),t&&t.call(this,i)}function v(t,i){var r=h.bind(y,this,"durationchange",function(){var e=this;if("dynamic"!==e._playlist.getType())return e._videoElement.removeEventListener("durationchange",r,!1),e._ready=!0;0!==h.get(e,["_videoElement","buffered","length"],0)&&function(s,o){var a=this;s=h.isNumber(s)?s:a._playlist.getPlaybackDurationSinceAvailable()/1e3-1,"Firefox"===this._browserDetails.browser&&(s-=1),setTimeout(function(){var e=a._videoElement.buffered.start(a._videoElement.buffered.length-1),t=a._videoElement.buffered.end(a._videoElement.buffered.length-1),i=a._videoElement.currentTime<s||a._videoElement.currentTime>s+1,r=e<=s&&s<=t,n=2<=a._durationChangeCount;r||n||!a._initialized?(!i||a._setTimeoutOnce||!r&&!n&&a._initialized||(a._initialized||r?a._videoElement.currentTime=n?(t-e)/2+e:e:a._videoElement.currentTime=e,a._setTimeoutOnce=!0,a._initialized||(a._initialized=!0)),e<=a._videoElement.currentTime&&a._videoElement.currentTime<=t&&(r||n)&&(a._ready=!0,a._setTimeoutOnce=!1,o())):a._durationChangeCount++},10)}.call(e,t,function(){e._videoElement.removeEventListener("durationchange",r,!1),i&&i()})});return this._durationChangeCount=0,r}function b(e){var t=this._videoElement.currentTime,i=this._videoElement.duration,r=_(e,t),n=h.isNumber(r)?e.buffered.end(r):0,s=0===n?0:n-t;return{bufferedLength:e.buffered.length,current:t,bufferEnd:n,timeBufferedButNotPlayed:s,duration:i,timestampOffset:e.timestampOffset}}function _(e,t){for(var i=0;i<e.buffered.length;i++){var r=e.buffered.start(i),n=e.buffered.end(i);if(r<=t&&t<=n)return i}}function w(){var r=!0,n=!1;h.forOwn(this._mediaSourceBuffers,h.bind(function(e){var t=b.call(this,e.buffer),i=parseFloat(t.timeBufferedButNotPlayed);i<this._bufferSizeToPauseFetch&&(r=!1),i<this._bufferSizeToResumeFetch&&(n=!0)},this)),r&&this._feeder.isFetchingData()&&(this._logger.debug("Pausing feeder due to excess buffer"),s.call(this)),!n||this._feeder.isFetchingData()||this._pausedAt||(this._logger.debug("Starting feeder due to limited buffer"),R.call(this))}function S(e,t){var i=this._mediaSourceBuffers[k(e)],r=this._bufferDetails[I(e)];if(!r)return this._logger.warn("Unable to add chunk for non existent buffer");if("dynamic"===this._playlist.getType()&&this._pausedAt&&!this._reset&&0<i.buffer.buffered.length)i.buffer.remove(0,i.buffer.buffered.end(i.buffer.buffered.length-1)),i.cleared=!0,h.reduce(this._mediaSourceBuffers,function(e,t){return e?t.cleared:e},!0)&&(this._initialized=!1,this._ready=!1,this._setTimeoutOnce=!1,this._reset=!0);else if(0<r.chunks.length){if(this._videoElement.error)return this._logger.error("Unable to continue appending to buffer. Video element error code [%s] and message [%s]",this._videoElement.error.code,this._videoElement.error.message),s.call(this),this._playerErrorEvent.fire([this._videoElement.error]);var n=r.chunks.shift();i.cleared=!1,this._logger.debug("Appending chunk to buffer for track [%s]",e.getTrackId()),i.buffer.appendBuffer(new Uint8Array(n))}else t&&(w.call(this),r.chunkAddRequested=!0)}function E(e){var t=this._mediaSourceBuffers[k(e)],i=h.bind(function(e){this._logger.warn("Buffer Error [%s]",e)},this),r=!!t.track;if(t.track!==e){var n=this._bufferDetails[I(e)];if(t.track&&t.track!==e&&r&&(t.buffer.removeEventListener("updateend",t.updateEndListener),t.buffer.removeEventListener("error",i),n&&(n.addInitChunkFirst=!0,n.chunkAddRequested=!0,n.chunks=[])),t.track=e,t.updateEndListener=h.bind(t.updateEnd,this,e),t.buffer.addEventListener("updateend",t.updateEndListener),t.buffer.addEventListener("error",i),t.buffer.onerror=i,!r){var s="Dash"===this._playlist.getDeliveryType()?[e.getInitChunkData()]:[];n.chunks=[].concat(s,h.map(e.getChunks(),function(e){return e.data})),"static"===this._playlist.getType()&&"Edge"!==this._browserDetails.browser&&"IE"!==this._browserDetails.browser&&this._mediaSource.setLiveSeekableRange(0,this._playlist.getTotalMediaTimeInMillis()/1e3),S.call(this,e,!1)}}}function T(e){this._logger.debug("Creating MSE buffers for all tracks."),h.forEach(e,h.bind(function(e){(function(e){var n=this,s={track:e,chunks:[],chunkAddRequested:!1},t=k(e),i=!h.includes(h.keys(n._mediaSourceBuffers),t),o=i?n._mediaSource.addSourceBuffer(e.getMseCodec()):n._mediaSourceBuffers[t].buffer,r=I(e);n._bufferDetails[r]=s,i&&(o.mode="segments","static"===n._playlist.getType()&&(o.appendWindowEnd=n._playlist.getTotalMediaTimeInMillis()/1e3),n._logger.debug("Creating MSE Buffer for [%s] with mode [%s]",n._playlist.getType(),o.mode),n._mediaSourceBuffers[t]={buffer:o,updateEnd:function(e){o.updating||S.call(this,e,!0)}},n._disposables.add(new p.Disposable(function(){n._logger.debug("Cleaning up sourceBuffer [%s]",t),n._mediaSource.removeSourceBuffer(o)})));var a=e.addEventListener("chunkadded",h.bind(function(e,t){s.addInitChunkFirst&&"Dash"===n._playlist.getDeliveryType()&&(s.addInitChunkFirst=!1,this._logger.debug("Pushing track [%s] chunk [%s] into buffer",e.getTrackId(),"Init"),s.chunks.push(e.getInitChunkData())),this._logger.debug("Pushing track [%s] chunk [%s] into buffer",e.getTrackId(),t.chunkId),s.chunks.push(t.data),s.chunkAddRequested&&(s.chunkAddRequested=!1,o.updating||S.call(this,e,!1));var i=1e3<=h.now()-this._lastUpdate,r=500<=h.now()-this._lastPlayAttempt;this._isWaiting&&i&&r&&!this._videoElement.paused&&!this._pausedAt&&(this._logger.trace("Starting after wait [%s]",h.now()-this._lastUpdate),this._lastPlayAttempt=h.now(),this._videoElement.play())},n,e));n._disposables.add(a)}).call(this,e)},this))}function k(e){return 0<=e.getMseCodec().indexOf("video")?"video":0<=e.getMseCodec().indexOf("audio")?"audio":"other"}function I(e){return e.getTrackId()+"_"+e.getMseCodec()}e.prototype.toString=function(){return h.toString(this)},e.prototype.play=function(){if("dynamic"===this._playlist.getType()){var e=this._feeder.seekToCurrent();R.call(this);var t=this,i=v.call(this,e,function(){t._pausedAt=0,t._videoElement&&t._videoElement.play()});return setTimeout(function(){t._videoElement.addEventListener("durationchange",i,!1)},300),this._disposables.add(new p.Disposable(function(){t._videoElement.removeEventListener("durationchange",i,!1)}))}R.call(this),this._videoElement&&this._videoElement.play()},e.prototype.pause=function(){this._logger.info("Pausing web player"),s.call(this);var t=this;this._videoElement&&(this._videoElement.pause(),this._pausedAt=h.now(),this._reset=!1,h.forOwn(this._feeder.getActiveTracks(),function(e){t._mediaSourceBuffers[k(e)].buffer.updating||S.call(t,e,!1)}))},e.prototype.dispose=function(){this._disposables.dispose(),this._playbackStarted=!1,this._mediaSourceBuffers={},this._bufferDetails={},this._bufferStats=[],this._mediaSource=null,this._playlist=null,this._videoElement=null},e.prototype.start=function(e){(function(e){var t=this;t._mediaSource=new MediaSource;var i=function(){(function(t){var i=this,r=g.call(this),e=i._playlist.getAllPlaylistTracks().sort(function(e,t){return-1*(e.getBandwidth()-t.getBandwidth())}),n=h.filter(e,function(e){return!h.includes(r,e)});if(this._logger.info("Initializing feeder with [%s] [%s] playlist of duration [%s]",i._playlist.getType(),i._playlist.getDeliveryType(),i._playlist.getTotalMediaTimeInMillis()/1e3),"static"===i._playlist.getType())i._mediaSource.duration=i._playlist.getTotalMediaTimeInMillis()/1e3;else if("Hls"===i._playlist.getDeliveryType()){i._mediaSource.duration=1/0;var s=h.reduce(r,function(e,t){var i=h.get(t.getLastSegment(),["timestamp"],0);return h.isNullOrUndefined(e)?i:i<e?i:e})||0;i._feeder.seekToChunk(s)}this._logger.debug("Loading tracks: numberOfTracksToInitialize=[%s], all tracks: [%s]",r.length,e),this._feeder.initialize(r,n,function(){T.call(i,r);var e=g.call(i);h.forEach(e,function(e){E.call(i,e)}),function(e){var t=this,i=h.bind(function(){var i;this._isWaiting=!1,this._lastUpdate=h.now(),h.forOwn(this._mediaSourceBuffers,h.bind(function(e){var t=b.call(this,e.buffer);(!i||i>t.timeBufferedButNotPlayed)&&(i=t.timeBufferedButNotPlayed),this._playbackTimeLeftEvent.fire([t.timeBufferedButNotPlayed,e.track],this)},this)),w.call(this),function(e){this._bufferStats.push({size:e,timestamp:h.now()});for(var t=h.get(this._bufferStats,[0,"timestamp"],h.now());3e5<h.now()-t;)this._bufferStats.shift(),t=h.get(this._bufferStats,[0,"timestamp"],h.now());this._bufferStatsMin=Math.min.apply(null,h.map(this._bufferStats,function(e){return e.size}))}.call(this,i),function(e){if("Dash"===this._playlist.getDeliveryType()||"dynamic"===this._playlist.getType()){var t=this._targetBufferSizeToStartFastForward,i=this._lastPlaybackRateChange,r=300<h.now()-this._startTime,n=!i||h.now()-i>1e3*this._maximumFrequencyForAlteringPlaybackRate,s=this._bufferStatsMin>this._targetMinBufferSize,o=this._bufferStatsMin<=this._targetMinBufferSize+.1&&this._bufferStatsMin>=this._targetMinBufferSize-.1,a=e>=this._maxBufferSizeWhileRecoveringBufferWithSlowMotion&&this._videoElement.playbackRate===this._playbackRateToIncreaseBuffer;t<=e&&s&&this._videoElement.playbackRate<=1&&r&&n?(this._logger.info("Adjusting playback rate to [%s] to reduce buffer size from [%s] with minimum buffer size of [%s]",this._playbackRateToDecreaseBuffer,e,this._bufferStatsMin),this._videoElement.playbackRate=this._playbackRateToDecreaseBuffer):!s&&!o&&1<=this._videoElement.playbackRate&&n?(this._logger.info("Adjusting playback rate to [%s] to increase buffer size from [%s] with minimum buffer size of [%s]",this._playbackRateToIncreaseBuffer,e,this._bufferStatsMin),this._videoElement.playbackRate=this._playbackRateToIncreaseBuffer):(a||o)&&1!==this._videoElement.playbackRate&&(this._logger.info("Resuming normal playback rate with buffer size of [%s] and minimum buffer size of [%s]",e,this._bufferStatsMin),this._videoElement.playbackRate=1,this._lastPlaybackRateChange=h.now())}}.call(this,i||0)},t),r=h.bind(y,t,"stalled",null),n=h.bind(y,t,"suspend",null),s=h.bind(y,t,"ended",null),o=h.bind(y,t,"error",null),a=h.bind(y,t,"pause",null),l=h.bind(y,t,"play",function(){this._pausedAt&&this._videoElement.pause()}),u=h.bind(y,t,"waiting",function(){this._playbackStarted&&(this._logger.debug("Waiting for new chunk or end of track"),this._isWaiting=!0)}),c=h.bind(y,t,"seeking",function(e){var t=h.keys(this._mediaSourceBuffers),i=h.get(t,"0",null),r=this._mediaSourceBuffers[i],n=this;if(r&&this._ready&&"Hls"!==this._playlist.getDeliveryType()){var s=_(r.buffer,e.timeStamp/1e3),o=_(r.buffer,this._videoElement.currentTime),a=h.reduce(this._mediaSourceBuffers,function(e,t){var i=_(t.buffer,n._videoElement.currentTime),r=h.isNumber(i)?t.buffer.buffered.end(i):0;return e?r<e?r:e:r})||this._videoElement.currentTime;if(this._feeder.stopRequestingAllData(),this._logger.debug("Pausing of feeder completed."),this._feeder.seekToChunk("dynamic"===this._playlist.getType()?this._videoElement.currentTime:a),s!==o||h.isNullOrUndefined(o)){if(this._feeder.isFetchingData())return;this._feeder.startRequestingDataForActiveTracks(this._bandwidthLimit)}}}),d=v.call(t);t._videoElement.addEventListener("timeupdate",i,!1),t._videoElement.addEventListener("ended",s,!1),t._videoElement.addEventListener("error",o,!1),t._videoElement.addEventListener("pause",a,!1),t._videoElement.addEventListener("stalled",r,!1),t._videoElement.addEventListener("suspend",n,!1),t._videoElement.addEventListener("play",l,!1),t._videoElement.addEventListener("waiting",u,!1),t._videoElement.addEventListener("seeking",c,!1),t._videoElement.addEventListener("durationchange",d,!1),t._disposables.add(new p.Disposable(function(){t._logger.debug("Cleaning up videoElement listeners"),t._videoElement.removeEventListener("timeupdate",i,!1),t._videoElement.removeEventListener("ended",s,!1),t._videoElement.removeEventListener("error",o,!1),t._videoElement.removeEventListener("pause",a,!1),t._videoElement.removeEventListener("stalled",r,!1),t._videoElement.removeEventListener("suspend",n,!1),t._videoElement.removeEventListener("play",l,!1),t._videoElement.removeEventListener("waiting",u,!1),t._videoElement.removeEventListener("seeking",c,!1),t._videoElement.removeEventListener("durationchange",d,!1)})),R.call(t),t._lastPlayAttempt=h.now(),h.isFunction(e)&&e()}.call(i,t)},function(){"Hls"!==i._playlist.getDeliveryType()&&T.call(i,n)},function(e){return i._logger.error("Unable to initialize playlist chunk feeder",e),i._playerErrorEvent.fire([e])})}).call(t,e)};t._mediaSource.addEventListener("sourceopen",i),t._disposables.add(new p.Disposable(function(){t._logger.debug("Cleaning up sourceopen listener"),t._mediaSource.removeEventListener("sourceopen",i)})),t._videoElement.src=c.global.URL.createObjectURL(t._mediaSource)}).call(this,e),this._startTime=h.now()},e.prototype.getBandwidthLimit=function(){return this._bandwidthLimit},e.prototype.changeBandwidthLimit=function(e,t){this._logger.debug("Changing playback bandwidth limit: [%s], current limit: [%s]",e,this._bandwidthLimit),this._bandwidthLimit=e,this._switchTrackDisposable=setTimeout(h.bind(function(e){var o=this,i=this._feeder.getActiveTracks(),t=g.call(this),r=h.filter(t,function(t){return!h.find(i,function(e){return e.getTrackId()===t.getTrackId()})});h.forEach(r,function(e){E.call(o,e),o._logger.info("Switched [%s] to track [%s] with [%s] bandwidth limit",k(e),e.getTrackId(),o._bandwidthLimit)});var n=h.reduce(t,function(e,t){var i=o._mediaSourceBuffers[k(t)],r=_(i.buffer,o._videoElement.currentTime),n=t.getChunkDuration()/1e3;if(!h.isNumber(r))return!h.isNumber(e)||e>o._videoElement.currentTime?o._videoElement.currentTime:e;var s=Math.round(i.buffer.buffered.end(r)/n)*n;return!h.isNumber(e)||s<e?s:e});h.isNumber(n)||(n=o._videoElement.currentTime),this._feeder.stopRequestingAllData(),this._feeder.seekToChunk(n),this._logger.debug("Pausing of feeder completed."),this._feeder.isFetchingData()||(this._feeder.startRequestingDataForActiveTracks(this._bandwidthLimit),e())},this,t||h.noop),250)},e.prototype.addEventListener=function(e,t){switch(o.isString(e,"eventName"),o.isFunction(t,"listener"),e){case"playbacktimeleft":return this._playbackTimeLeftEvent.listen(t);case"error":return this._playerErrorEvent.listen(t);default:throw new Error('Event "'+e+'" is unknown.')}},e.prototype.getStats=function(){return{currentTime:h.get(this._element,["currentTime"],0),width:h.get(this._element,["videoWidth"],0)||h.get(this._element,["width"],0),height:h.get(this._element,["videoHeight"],0)||h.get(this._element,["height"],0),lag:0,deliveryType:this._playlist.getDeliveryType(),isNative:!1}},e.isSupported=!!c.global.MediaSource;var s=function(){this._feeder.stopRequestingAllData(),this._logger.debug("Pausing of feeder completed.")},R=function(){if(this._feeder.isFetchingData())return this._logger.debug("Unable to start requesting data. Feeder is already fetching data.");this._feeder.startRequestingDataForActiveTracks()};return e}.apply(t,r))&&(e.exports=n)},function(e,t,i){var r,n;r=[i(1),i(0),i(2),i(3),i(6),i(11),i(19),i(8),i(4),i(18),i(5)],void 0!==(n=function(l,r,n,s,o,a,i,u,c,d,h){"use strict";function e(e,t,i){r.isNotUndefined(t,"videoElement"),r.isNotUndefined(t.videoWidth,"videoElement.videoWidth"),this._options=i,this._videoElement=t,this._disposables=new o.DisposableList,this._logger=e||new n.Logger,this._browserDetails=new a(u.global.navigator.userAgent).detect(),this._playerErrorEvent=new s.Event,this._disposables.add(this._playerErrorEvent),this._onStalled=l.bind(function(){var t=this,i=this._element.currentTime,r=function(){return 1.5*this._lastProgress.averageLength<2e3?2e3:1.5*this._lastProgress.averageLength}.call(t);setTimeout(function(){if(0===t._lastProgress.count){var e="Stream has not started within ["+r/1e3+"] seconds";t._logger.warn(e),m.call(t,h.name.progressTimeOut.name,e)}},r),setTimeout(function(){if(t._element&&t._element.currentTime===i&&!t._element.paused&&p.call(t)){var e="Stream has been stalled for [6] seconds";t._logger.warn(e),f.call(t,h.name.progressTimeOut.name,e)}},6e3)},this),this._onProgress=l.bind(function(){if(this._lastProgress.time=l.now(),0===this._element.buffered.length)return this._logger.debug("[%s] Hls stream progress event fired without any buffered content",this._uri);var e=this._element.buffered.end(this._element.buffered.length-1);if(this._lastProgress.buffered!==e){if(null!==this._lastProgress.buffered){var t=this._lastProgress.averageLength*this._lastProgress.count+(e-this._lastProgress.buffered);if(this._lastProgress.count+=1,this._lastProgress.averageLength=t/this._lastProgress.count,this._lastProgress.lastCurrentTime!==this._element.currentTime&&(this._lastProgress.lastCurrentTimeOccurrenceTimestamp=l.now()),this._lastProgress.lastCurrentTimeOccurrenceTimestamp&&6e3<l.now()-this._lastProgress.lastCurrentTimeOccurrenceTimestamp&&this._element&&!this._element.paused&&p.call(this)){var i="Reloading stream after current time has not changed for [6] seconds due to unregistered stall.";this._logger.warn(i),f.call(this,h.name.progressTimeOut.name,i)}}this._lastProgress.buffered=e,this._lastProgress.lastCurrentTime=this._element.currentTime}},this),this._onEnded=l.bind(function(){this._logger.info("[%s] Hls stream ended",this._streamId),this.stop("ended")},this),this._onError=l.bind(function(e){var t=0===this._lastProgress.count;4===l.get(this._element,["error","code"])&&t&&m.call(this,h.name.hlsNativeError.name,e),g.call(this,h.name.hlsNativeError.name,e)},this),this._lastProgress={time:0,buffered:null,averageLength:0,count:0,lastCurrentTime:0,lastCurrentTimeOccurrenceTimestamp:0},this._bufferSizeHistory=[],function(){var t=this;if(!d.isSupported())return this._logger.error("DRM not supported by the browser");this._encryptedMediaHandler=new d(this._logger,this._videoElement,[],l.get(this._options,"drm")),this._encryptedMediaHandler.addEventListener("error",function(e){t._playerErrorEvent.fire([e])}),this._encryptedMediaHandler.addEventListener("trackRestrictionsAvailable",function(e){0<l.keys(e).length&&(t._trackRestrictions=e)}),this._disposables.add(this._encryptedMediaHandler)}.call(this),setTimeout(l.bind(function(){this._playlist=new c(this._logger,this._uri),this._disposables.add(this._playlist),this._playlist.fetch(l.noop)},this),2e3)}function p(){return this._element&&0!==this._element.buffered.length}function f(e,t){if(!p.call(this))return g.call(this,e,t);m.call(this,e,t)}function m(e,t){this._playerErrorEvent.fire([y(e,h.severity.RECOVERABLE,t)])}function g(e,t){this._playerErrorEvent.fire([y(e,h.severity.CRITICAL,t)])}function t(e){if(e){if(clearTimeout(this._backgroundTimeout),this._backgroundTimeout=null,!this._backgroundThrottled)return;return this._backgroundThrottled=!1,void this.start(this._element)}var t=this;this._backgroundTimeout=setTimeout(function(){var e;i.isForeground()||!(e=t._element).muted&&(0<l.get(e,["webkitAudioDecodedByteCount"],0)||0<l.get(e,["audioTracks","length"],0)||e.webkitHasAudio)||(t._logger.info("Detecting application [background] with muted video. Pausing playback until application focused again."),t._element.pause(),t._backgroundThrottled=!0)},3e3)}function y(e,t,i){return{category:h.category.STREAMING,name:e,severity:t,error:"Error"===i.constructor.name?i:new Error(i)}}return e.prototype.toString=function(){return l.toString(this)},e.prototype.play=function(){this._videoElement.play()},e.prototype.pause=function(){this._videoElement.pause()},e.prototype.dispose=function(){this._disposables.dispose()},e.prototype.start=function(e){if(this._uri)return this._logger.warn("Already started player");this._uri=e,this._disposables.add(i.onBackground(l.bind(t,this,!1))),this._disposables.add(i.onForeground(l.bind(t,this,!0))),function(e){u.attachUriStream(e,this._uri),!1===this._options.receiveAudio&&(e.muted=!0),l.addEventListener(e,"error",this._onError,!0),l.addEventListener(e,"stalled",this._onStalled,!1),l.addEventListener(e,"pause",this._onStalled,!1),l.addEventListener(e,"suspend",this._onStalled,!1),l.addEventListener(e,"progress",this._onProgress,!1),l.addEventListener(e,"ended",this._onEnded,!1),this._element=e}.call(this,this._videoElement)},e.prototype.getBandwidthLimit=function(){return this._logger.warn("getBandwidthLimit not supported for HLS Native")},e.prototype.changeBandwidthLimit=function(){return this._logger.warn("changeBandwidthLimit not supported for HLS Native")},e.prototype.addEventListener=function(e,t){switch(r.isString(e,"eventName"),r.isFunction(t,"listener"),e){case"error":return this._playerErrorEvent.listen(t);default:throw new Error('Event "'+e+'" is unknown.')}},e.prototype.getStats=function(){if(!this._videoElement)return{width:0,height:0,currentTime:0,lag:0,deliveryType:"Hls",isNative:!0};var e=l.get(this._element,["currentTime"],0),t=this._element&&this._element.buffered&&0<this._element.buffered.length?this._element.buffered.end(this._element.buffered.length-1):0,i=Math.max(0,t-e);this._bufferSizeHistory.push(i),15<this._bufferSizeHistory.length&&this._bufferSizeHistory.shift();for(var r=0,n=0,s=this._bufferSizeHistory.length;n<s;n++)r=Math.max(r,this._bufferSizeHistory[n]);var o=2;this._playlist&&0<this._playlist.getAllPlaylistTracks().length&&(o=this._playlist.getAllPlaylistTracks()[0].getChunkDuration());var a=2*o+r;return{width:this._element.videoWidth||this._element.width,height:this._element.videoHeight||this._element.height,currentTime:e,lag:a,deliveryType:"Hls",isNative:!0}},e.isSupported=!1,e}.apply(t,r))&&(e.exports=n)}])},e.exports=r(i(1),i(0),i(8),i(5),i(3),i(2),i(6),i(25),i(13))},function(e,t,i){var r,n;r=[i(0),i(72),i(68)],void 0===(n=function(o,r,n){"use strict";function e(e,t){var i=r.loadJson(n);o.forEach(e,function(e){i=r.loadJson(e,i)}),this._builders=i.build(),this._apiVersion=t||3}function i(e){for(var t=e.split("."),i=this._builders,r=0;r<t.length-1;r++)if(!(i=i[t[r]]))throw new Error('Unsupported type "'+e+'"');if("function"!=typeof(i=i[t[t.length-1]]))throw new Error('Unsupported type "'+e+'"');return i}return e.prototype.getApiVersion=function(){return this._apiVersion},e.prototype.encode=function(e,t){if("string"!=typeof e)throw new Error("'type' must be a string");if("object"!=typeof t)throw new Error("'data' must be an object");return i.call(this,e).encode(t)},e.prototype.decode=function(e,t){if("string"!=typeof e)throw new Error("'type' must be a string");return function n(s){if(s&&s.$type&&s.$type.children)o.forOwn(s.$type.children,function(t){var e=s[t.name],i=t&&t.element?t.element.resolvedType:null;if(o.isArray(e))s[t.name]=[],o.forEach(e,function(e){s[t.name].push(n(e))});else if(i&&"Message"===i.className&&i.children)s[t.name]=n(e);else if(i&&"Enum"===i.className&&i.children){var r=o.getEnumName(i.children,e);r&&(s[t.name]=r)}else e&&o.isFunction(e.toNumber)&&(s[t.name]=e.toNumber())});else if(s&&o.isFunction(s.toNumber))return s.toNumber();return s}(i.call(this,e).decode(t))},e}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(1),i(5),i(3),i(30),i(12)],void 0===(n=function(u,o,s,r,a,l){"use strict";var c="continuation",d=2e3,h=3e5,p=18e3;function e(e,t,i,r,n){o.isObject(e,"logger"),o.isFunction(t,"sendCallback"),o.isFunction(i,"receiveCallback"),this._logger=e,this._mqProtocol=new a(r,n),this._nextRequestId=0,this._namedEvents=new s.NamedEvents,this._requests={},this._responses={},this._requestListeners={},this._requestTimeouts={},this._requestTimestamps={},this._continuationTimeouts={},this._receiveCallback=i,this._sendCallback=t,i(u.bind(f,this))}function f(e){if(this._disposed)return this._logger.warn("Proto already disposed of. Unable process message");var t,i,r;try{t=this._mqProtocol.decode("mq.Message",l.wrap(e.data,"base64")),r=this._requests[t.requestId],this._logger.info(">> [%s] [%s]",t.messageType,t.type),i=this._mqProtocol.decode(t.type,t.payload)}catch(e){if(this._logger.error(e),r)return r(e);throw e}switch(function(e,t,i){var r=u.now(),n=this._requestTimestamps[e.requestId];if(u.isNumber(n)){var s=r-n;e.wallTime=[s].concat(e.wallTime)}this._namedEvents.fireAsync("received",[{key:e.requestId,messageType:e.messageType,type:e.type,wallTime:e.wallTime,received:r,bytes:i,payload:t}]),delete this._requestTimestamps[e.requestId]}.call(this,t,i,e.data.length),t.messageType){case"Response":if(i.status!==c&&delete this._requests[t.requestId],clearTimeout(this._requestTimeouts[t.requestId]),delete this._requestTimeouts[t.requestId],!r)return;return"mq.Error"===t.type?r(i,null):r(null,i);case"Request":var n=u.bind(this.sendResponse,this,t.requestId,t.type+"Response"),s=this._requestListeners[t.type];this._responses[t.requestId]=u.now(),s?s(i,n):this._logger.info("Received request without a subscribed listener");break;case"Event":return function(e,t){this._namedEvents.fire(e,t,this)}.call(this,t.type,[i]);default:return this._logger.warn(">> Unsupported message type [%s]",t.messageType)}}function m(e,t,i,r,n,s,o){return o&&o.status===c?(!this._continuationTimeouts[e]&&this._requests[e]&&(this._continuationTimeouts[e]=function(e,t){return setTimeout(u.bind(v,this,e,h,t),h)}.call(this,e,n)),function(e,t,i,r,n,s){if(!r||!r.continuationId&&!r.routeKey)return this._logger.warn("Received request for continuation without a continuationId or routeKey"),s();var o=u.assign({},i,{continuationId:r.continuationId,routeKey:r.routeKey}),a={requestId:e,type:t,payload:this._mqProtocol.encode(t,o),messageType:"Request"},l=this;return setTimeout(function(){if(l._requests[e])return g.call(l,e,a,o,n,s)},d)}.call(this,e,t,i,o,r,n)):(clearTimeout(this._continuationTimeouts[e]),delete this._continuationTimeouts[e],n(s,o))}function g(e,t,i,r,n){this._requestTimeouts[e]&&clearTimeout(this._requestTimeouts[e]);var s=r||p;return this._requestTimeouts[e]=setTimeout(u.bind(v,this,e,s,n),s),y.call(this,t,i)}function y(e,t){var i=this._mqProtocol.encode("mq.Message",e).toString("base64");return function(e,t,i){var r=u.now();this._requestTimestamps[e.requestId]=r,this._namedEvents.fireAsync("sent",[{key:e.requestId,messageType:e.messageType,type:e.type,received:r,bytes:i,payload:t}])}.call(this,e,t,i.length),this._sendCallback(i)}function v(e,t,i){if(this._requests[e])return function(e,t){this._namedEvents.fireAsync("timeout",[{key:e,timeout:t}]),delete this._requestTimestamps[e]}.call(this,e,t),this._logger.warn("Request [%s] has not completed in [%s] ms. Dropping request.",e,t),delete this._requests[e],i(null,{status:"timeout"})}return e.prototype.onEvent=function(e,t){return this._disposed?this._logger.warn("Proto already disposed of. Unable to listen for event"):(o.isStringNotEmpty(e,"eventName"),o.isFunction(t,"handler"),this._namedEvents.listen(e,t))},e.prototype.onRequest=function(e,t){if(this._disposed)return this._logger.warn("Proto already disposed of. Unable to listen for request");o.isStringNotEmpty(e,"requestName"),o.isFunction(t,"handler"),this._requestListeners[e]&&this._logger.warn("May not set multiple handlers for the same request. Overriding existing handlers for request [%s]",e),this._requestListeners[e]=t;var i=this;return new r.Disposable(function(){i._requestListeners[e]=null})},e.prototype.sendRequest=function(e,t,i,r){if(this._disposed)return this._logger.warn("Proto already disposed of. Unable to send request"),i(null,{status:"proto-disposed"});r=r||{},o.isStringNotEmpty(e,"type"),o.isObject(t,"message"),o.isObject(r,"settings"),i&&o.isFunction(i,"callback"),r.timeout&&o.isNumber(r.timeout,"settings.timeout");var n="C"+(this._nextRequestId++).toString(),s={requestId:n,type:e,payload:this._mqProtocol.encode(e,t),messageType:"Request"};return this._requests[n]=u.bind(m,this,n,e,t,r.timeout,i),g.call(this,n,s,t,r.timeout,i)},e.prototype.sendResponse=function(e,t,i,r){if(this._disposed)return this._logger.warn("Proto already disposed of. Unable to send response"),r(null,{status:"proto-disposed"});o.isStringNotEmpty(e,"requestId"),o.isStringNotEmpty(t,"type"),o.isObject(i,"message");var n=this._responses[e];n||(this._logger.error("Already responded to request [%s]",e),r(new Error("no-response-handler")));var s={requestId:e,type:t,payload:this._mqProtocol.encode(t,i),messageType:"Response",wallTime:[u.now()-n]};return y.call(this,s,i),delete this._responses[e],r(null,{status:"ok"})},e.prototype.disposeOfRequests=function(){u.forOwn(this._requestTimeouts,function(e){clearTimeout(e)}),u.forOwn(this._continuationTimeouts,function(e){clearTimeout(e)}),this._requests={},this._responses={},this._requestListeners={},this._requestTimeouts={},this._requestTimestamps={},this._continuationTimeouts={}},e.prototype.dispose=function(){this._disposed=!0,this._receiveCallback=null,this._sendCallback=null,this.disposeOfRequests(),this._namedEvents.dispose()},e.prototype.getApiVersion=function(){return this._mqProtocol.getApiVersion()},e.prototype.toString=function(){return"Proto["+this._webSocket.toString()+"]"},e}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(1),i(6),i(3)],void 0===(n=function(a,l,u,n){"use strict";var c={timeout:2e4,retryOptions:{backoff:1.5,delay:1e3,maxAttempts:3,additionalRetryErrorCodes:[0]}};function e(e,t){l.isStringNotEmpty(e,"backendUri"),l.isObject(t,"authenticationData"),this._backendUri=e,this._authenticationData=t,this._disposables=new n.DisposableList}function d(e,i){var r=null,t=e(a.bind(s,this,function(e,t){clearTimeout(r),i(e,t)}));r=setTimeout(function(){t.dispose(),i(new Error("timeout"))},2e4),this._disposables.add(t),this._disposables.add(new n.Disposable(function(){clearTimeout(r)}))}function h(e){return a.assign({},e,this._authenticationData)}function s(e,t,i){if(t)return e(t,{});var r=JSON.parse(i.data);return"ok"!==r.status?e(null,{status:r.status}):e(null,r)}return e.prototype.dispose=function(){return this._disposables.dispose()},e.prototype.createAuthenticationToken=function(e){var t=h.call(this,{}),i=a.bind(u.postWithRetry,u,this._backendUri+"/auth",JSON.stringify(t),c);return d.call(this,i,e)},e.prototype.createStreamTokenForPublishing=function(e,t,i){l.isStringNotEmpty(e,"sessionId"),l.isObject(t,"capabilities");var r=h.call(this,{sessionId:e,capabilities:t}),n=a.bind(u.postWithRetry,u,this._backendUri+"/stream",JSON.stringify(r),c);return d.call(this,n,i)},e.prototype.createStreamTokenForSubscribing=function(e,t,i,r,n){l.isStringNotEmpty(e,"sessionId"),l.isObject(t,"capabilities"),a.isNullOrUndefined(r)||(l.isArray(r,"additionalStreamIds"),a.forEach(r,function(e){l.isStringNotEmpty(e,"alternateOriginStreamId")}));var s=h.call(this,{sessionId:e,capabilities:t,originStreamId:i});r&&0<r.length&&(s.alternateOriginStreamIds=r);var o=a.bind(u.postWithRetry,u,this._backendUri+"/stream",JSON.stringify(s),c);return d.call(this,o,n)},e.prototype.getStreams=function(e){var t=a.bind(u.getWithRetry,u,this._backendUri+"/streams",c);return d.call(this,t,e)},e}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(2)],void 0===(n=function(e){"use strict";function t(){this.init()}return t.prototype.init=function(){if(!e.global.AudioContext&&!e.global.webkitAudioContext)throw new Error("Browser does not support AudioContext");this._audioContext=new(e.global.AudioContext||e.global.webkitAudioContext)},t.prototype.getNativeAudioContext=function(){return this._audioContext},t.prototype.toString=function(){return"AudioContext"},t}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(1)],void 0===(n=function(e,t){"use strict";function i(e){t.isObject(e,"pcast"),t.isFunction(e.getObservableStatus,"pcast.getObservableStatus"),t.isFunction(e.getLogger,"pcast.getLogger"),t.isFunction(e.getProtocol,"pcast.getProtocol"),this._pcast!==e&&(this._pcast=e,this._logger=e.getLogger(),this._protocol=e.getProtocol(),t.isObject(this._logger,"this._logger"),t.isObject(this._protocol,"this._protocol"),t.isFunction(this._protocol.getObservableSessionId,"this._protocol.getObservableSessionId"),t.isFunction(this._pcast.getObservableStatus,"this._pcast.getObservableStatus"),this._sessionId=this._protocol.getObservableSessionId(),this._status=this._pcast.getObservableStatus())}return i.prototype.assertAuthorized=function(){if(null==(e=this.getPCastStatus())||""===e||"offline"===e.toLowerCase())throw new Error("Unable to perform action. Status [%s]. Please wait to reconnect.",this.getPCastStatus());var e,t;if(null==(t=this.getPCastSessionId())||""===t)throw new Error("Unable to perform action. Invalid sessionId [%s]",this.getPCastSessionId())},i.prototype.getObservableSessionId=function(){return this._sessionId},i.prototype.getObservableStatus=function(){return this._status},i.prototype.getPCastSessionId=function(){return this._sessionId.getValue()},i.prototype.getPCastStatus=function(){return this._status.getValue()},i}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0)],void 0===(n=function(t){"use strict";var e={parseEnvFromPcastBaseUri:function(e){return e=e.toLowerCase(),t.includes(e,"local")?"local":t.includes(e,"stg")?"staging":"production"}};return e}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(1)],void 0===(n=function(a,i){"use strict";var l="most-recent";function e(e,t){e&&i.isStringNotEmpty(e,"selectionStrategy"),i.isObject(t,"logger"),this._selectionStrategy=e||l,this._logger=t,this._lastSelectedMember=null,this._blackListedMembers=[]}function u(t){return!!a.find(this._blackListedMembers,function(e){return e.key===c(t)})}function c(e){return e?e.getSessionId()+e.getObservableScreenName().getValue():""}function d(e){return s(e.getObservableScreenName().getValue())}function h(e){return o(e.getObservableScreenName().getValue())}function s(e){return/primary/i.test(e)}function o(e){return/alternate/i.test(e)}return e.prototype.getNext=function(e,t){var i=function(e,t){switch(this._selectionStrategy){case l:return o=e,a.reduce(o,function(e,t){return e&&e.getLastUpdate()>t.getLastUpdate()?e:t});case"high-availability":if(this._lastSelectedMember&&!t)return this._lastSelectedMember;var i=function(e){var t=this;return a.filter(e,function(e){return!u.call(t,e)})}.call(this,e);t&&(n=i,s=this._lastSelectedMember,i=a.filter(n,function(e){return c(e)!==c(s)}));var r=a.filter(i,d);return 0===r.length&&(r=a.filter(i,h)),0===r.length&&(r=i),a.sample(r);default:throw new Error("Invalid Selection Strategy")}var n,s;var o}.call(this,e,t);return 0<this.getNumberOfBlackListedMembers()&&function(){return 18e4<a.reduce(this._blackListedMembers,function(e,t){return e+a.now()-t.timestamp},0)}.call(this)&&!i?(this._logger.info("Unable to select new member. Clearing [%s] black-listed members and trying again",this.getNumberOfBlackListedMembers()),this.clearBlackListedMembers(),this.getNext(e,t)):(this._lastSelectedMember!==i&&(i?this._logger.info("Selecting new Member [%s]/[%s]",i.getSessionId(),i.getObservableScreenName().getValue()):this._logger.info("Unable to select new member"),this._lastSelectedMember&&!u.call(this,this._lastSelectedMember)&&function(e){if(!e)return;this._blackListedMembers.push({key:c(e),timestamp:a.now()})}.call(this,this._lastSelectedMember)),this._lastSelectedMember=i)},e.prototype.getStrategy=function(){return this._selectionStrategy},e.prototype.clearBlackListedMembers=function(){this._blackListedMembers=[]},e.prototype.getNumberOfBlackListedMembers=function(){return this._blackListedMembers.length},e.prototype.dispose=function(){this._lastSelectedMember=null,this._blackListedMembers=[]},e.getSimilarMembers=function(t,e){var i=a.filter(e,function(e){return e.getObservableScreenName().getValue()!==t}),r=a.filter(i,d),n=a.filter(i,h);return s(t)?r||n||i:o(t)?n||r||i:i||r||n},e}.apply(t,r))||(e.exports=n)},function(e,t,i){var r;void 0===(r=function(){"use strict";return{package:"telemetry",messages:[{name:"LogData",fields:[{rule:"required",type:"LogLevel",name:"level",id:1},{rule:"required",type:"string",name:"timestamp",id:2},{rule:"required",type:"string",name:"category",id:3},{rule:"required",type:"string",name:"message",id:4},{rule:"optional",type:"string",name:"source",id:5},{rule:"optional",type:"string",name:"fullQualifiedName",id:11},{rule:"optional",type:"string",name:"sessionId",id:6},{rule:"optional",type:"string",name:"userId",id:7},{rule:"optional",type:"string",name:"environment",id:8},{rule:"optional",type:"string",name:"version",id:9},{rule:"optional",type:"float",name:"runtime",id:10}]},{name:"StoreLogRecords",fields:[{rule:"repeated",type:"LogData",name:"records",id:1}]},{name:"StoreLogRecordsResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"required",type:"uint64",name:"storedRecords",id:2}]},{name:"MetricValue",fields:[{rule:"optional",type:"string",name:"string",id:1},{rule:"optional",type:"float",name:"float",id:2},{rule:"optional",type:"uint64",name:"uint64",id:3},{rule:"optional",type:"int64",name:"int64",id:4},{rule:"optional",type:"bool",name:"boolean",id:5},{rule:"optional",type:"string",name:"timestamp",id:6}]},{name:"MetricData",fields:[{rule:"required",type:"string",name:"timestamp",id:1},{rule:"optional",type:"string",name:"sessionId",id:2},{rule:"optional",type:"string",name:"streamId",id:3},{rule:"optional",type:"string",name:"source",id:4},{rule:"optional",type:"string",name:"resource",id:5},{rule:"optional",type:"string",name:"kind",id:6},{rule:"required",type:"Metric",name:"metric",id:7},{rule:"optional",type:"MetricValue",name:"value",id:8},{rule:"optional",type:"MetricValue",name:"previousValue",id:9},{rule:"optional",type:"uint64",name:"elapsed",id:10},{rule:"optional",type:"string",name:"fullQualifiedName",id:11},{rule:"optional",type:"string",name:"environment",id:12},{rule:"optional",type:"string",name:"version",id:13},{rule:"optional",type:"string",name:"tool",id:14},{rule:"optional",type:"string",name:"toolVersion",id:15},{rule:"required",type:"float",name:"runtime",id:16}]},{name:"SubmitMetricRecords",fields:[{rule:"repeated",type:"MetricData",name:"records",id:1}]},{name:"SubmitMetricRecordsResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"required",type:"uint64",name:"storedRecords",id:2}]}],enums:[{name:"LogLevel",values:[{name:"Trace",id:0},{name:"Debug",id:1},{name:"Info",id:2},{name:"Warn",id:3},{name:"Error",id:4},{name:"Fatal",id:5}]},{name:"Metric",values:[{name:"RoundTripTime",id:0},{name:"DownlinkThroughputCapacity",id:26},{name:"Initialized",id:1},{name:"Provisioned",id:2},{name:"SetupCompleted",id:3},{name:"Offset",id:4},{name:"TimeToFirstFrame",id:5},{name:"Playing",id:6},{name:"Stalled",id:7},{name:"Buffering",id:8},{name:"Seeking",id:22},{name:"Stopped",id:9},{name:"BitRateAdaptation",id:10},{name:"ResolutionChanged",id:11},{name:"DisplayResolutionChanged",id:23},{name:"VideoBitRate",id:28},{name:"AudioBitRate",id:29},{name:"FrameRateChanged",id:12},{name:"FramesDropped",id:13},{name:"PacketsLost",id:14},{name:"PictureLost",id:15},{name:"PlayoutDelayChanged",id:16},{name:"CodecChanged",id:17},{name:"PlayerEvent",id:21},{name:"MetricDropped",id:18},{name:"NetworkOffline",id:19},{name:"NetworkOnline",id:20},{name:"NetworkType",id:27},{name:"ApplicationForeground",id:24},{name:"ApplicationBackground",id:25}]}]}}.apply(t,[]))||(e.exports=r)},function(e,t,i){var r,n;r=[i(0),i(1)],void 0===(n=function(e,t){"use strict";function i(e){t.isObject(e,"room"),this._room=e}return i.prototype.getChannelId=function(){return this._room.getRoomId.apply(this._room,arguments)},i.prototype.getObservableAlias=function(){return this._room.getObservableAlias.apply(this._room,arguments)},i.prototype.getObservableName=function(){return this._room.getObservableName.apply(this._room,arguments)},i.prototype.getObservableDescription=function(){return this._room.getObservableDescription.apply(this._room,arguments)},i.prototype.getObservableType=function(){return this._room.getObservableType.apply(this._room,arguments)},i.prototype.getObservableMembers=function(){return this._room.getObservableMembers.apply(this._room,arguments)},i.prototype.getObservableBridgeId=function(){return this._room.getObservableBridgeId.apply(this._room,arguments)},i.prototype.getObservablePin=function(){return this._room.getObservablePin.apply(this._room,arguments)},i.prototype.toString=function(){return this._room.toString.apply(this._room,arguments)},i.prototype.toJson=function(){return{channelId:this._room.getRoomId(),alias:this._room.getObservableAlias().getValue(),name:this._room.getObservableName().getValue(),description:this._room.getObservableDescription().getValue(),type:this._room.getObservableType().getValue(),pin:this._room.getObservablePin().getValue(),bridgeId:this._room.getObservableBridgeId().getValue()}},i.prototype.commitChanges=function(){return this._room.commitChanges.apply(this._room,arguments)},i.prototype.reload=function(){return this._room.reload.apply(this._room,arguments)},i.prototype._update=function(){return this._room._update.apply(this._room,arguments)},i.prototype._addMembers=function(){return this._room._addMembers.apply(this._room,arguments)},i.prototype._removeMembers=function(){return this._room._removeMembers.apply(this._room,arguments)},i.prototype._updateMembers=function(){return this._room._updateMembers.apply(this._room,arguments)},i}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(1),i(4),i(18),i(10)],void 0===(n=function(a,l,u,r,e){"use strict";var t=e.roles,i=e.states;function n(e,t,i,r,n,s,o){this.init(e,t,i,r,n,s,o)}function o(e){return new r(e.uri,e.type,e.audioState,e.videoState)}function c(e){if(!(e=a.getEnumName(t,e)))throw new Error('"role" must be a valid member role');return e}function d(e){if(!(e=a.getEnumName(i,e)))throw new Error('"state" must be a valid member state');return e}return n.prototype.init=function(e,t,i,r,n,s,o){l.isString(i,"sessionId"),l.isString(r,"screenName"),l.isArray(s,"streams"),l.isNumber(a.utc(o),"lastUpdate"),e&&l.isObject(e,"roomService"),this._sessionId=new u.Observable(i),this._screenName=new u.Observable(r),this._streams=new u.ObservableArray([]),this._state=new u.Observable(t,d).extend({rateLimit:500}),this._role=new u.Observable(n,c),this._lastUpdate=new u.Observable(o,a.utc),this._roomService=e,this.setStreams(s)},n.prototype.getObservableState=function(){return this._state},n.prototype.getSessionId=function(){return this._sessionId.getValue()},n.prototype.getObservableScreenName=function(){return this._screenName},n.prototype.getObservableRole=function(){return this._role},n.prototype.getObservableStreams=function(){return this._streams},n.prototype.getObservableLastUpdate=function(){return this._lastUpdate},n.prototype.getLastUpdate=function(){return this._lastUpdate.getValue()},n.prototype.getStreams=function(){return a.map(this._streams.getValue(),function(e){return e.toJson()})},n.prototype.commitChanges=function(e){l.isObject(this._roomService,"this._roomService"),this._roomService.updateMember(this,e)},n.prototype.reload=function(){l.isObject(this._roomService,"this._roomService"),this._roomService.revertMemberChanges(this)},n.prototype.setStreams=function(e){var t=a.map(e,function(e){return o(e)});this._streams.setValue(t)},n.prototype.toString=function(){return this.getObservableRole().getValue()+"["+this.getObservableScreenName().getValue()+","+this.getSessionId()+"]"},n.prototype.toJson=function(){var t={sessionId:this._sessionId.getValue(),screenName:this._screenName.getValue(),role:this._role.getValue(),state:this._state.getValue(),streams:[],lastUpdate:this._lastUpdate.getValue()};return a.forEach(this._streams.getValue(),function(e){t.streams.push(e.toJson())}),t},n.prototype._update=function(e){a.isObject(e)&&(e.hasOwnProperty("state")&&this._state.setValue(e.state),e.hasOwnProperty("screenName")&&this._screenName.setValue(e.screenName),e.hasOwnProperty("role")&&this._role.setValue(e.role),e.hasOwnProperty("lastUpdate")&&this._lastUpdate.setValue(e.lastUpdate),e.hasOwnProperty("streams")&&function(e){var t=this._streams.getValue(),i=[];a.forEach(e,function(n){var s=r.parsePCastStreamIdFromStreamUri(n.uri),e=a.find(t,function(e){var t=e.getUri()===n.uri,i=e.isPCastStream()&&e.getPCastStreamId()===s,r=t||i;return e.getType()===n.type&&r});e?e._update(n):e=o(n),i.push(e)}),this._streams.setValue(i)}.call(this,e.streams))},n}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(1),i(4),i(39),i(11)],void 0===(n=function(r,u,c,i,e){"use strict";var t=e.types;function n(e,t,i,r,n,s,o,a,l){this.init(e,t,i,r,n,s,o,a,l)}function d(e,t){return r.map(e,function(e){return new i(t,e.state,e.sessionId,e.screenName,e.role,e.streams,e.lastUpdate)})}function h(e){if(!(e=r.getEnumName(t,e)))throw new Error('"type" must be a valid room type');return e}return n.prototype.init=function(e,t,i,r,n,s,o,a,l){u.isStringNotEmpty(r,"name"),u.isStringNotEmpty(n,"description"),u.isArray(o,"members"),t&&u.isStringNotEmpty(t,"id"),i&&u.isStringNotEmpty(i,"alias"),a&&u.isStringNotEmpty(a,"bridgeId"),l&&u.isStringNotEmpty(l,"pin"),e&&u.isObject(e,"roomService"),this._roomId=new c.Observable(t),this._alias=new c.Observable(i),this._name=new c.Observable(r),this._description=new c.Observable(n),this._type=new c.Observable(s,h),this._members=new c.ObservableArray([]).extend({method:"notifyWhenChangesStop",timeout:400}),this._options=new c.ObservableArray,this._bridgeId=new c.Observable(a),this._pin=new c.Observable(l),this._roomService=e,function(e){var t=d(e,this._roomService);this._members.setValue(t)}.call(this,o)},n.prototype.getRoomId=function(){return this._roomId.getValue()},n.prototype.getObservableAlias=function(){return this._alias},n.prototype.getObservableName=function(){return this._name},n.prototype.getObservableDescription=function(){return this._description},n.prototype.getObservableType=function(){return this._type},n.prototype.getObservableMembers=function(){return this._members},n.prototype.getObservableBridgeId=function(){return this._bridgeId},n.prototype.getObservablePin=function(){return this._pin},n.prototype.toString=function(){return this._type.getValue()+"["+this._roomId.getValue()+"]"},n.prototype.toJson=function(){return{roomId:this._roomId.getValue(),alias:this._alias.getValue(),name:this._name.getValue(),description:this._description.getValue(),type:this._type.getValue(),pin:this._pin.getValue(),bridgeId:this._bridgeId.getValue()}},n.prototype.commitChanges=function(e){u.isObject(this._roomService,"this._roomService"),this._roomService.updateRoom(this,e)},n.prototype.reload=function(){u.isObject(this._roomService,"this._roomService"),this._roomService.revertRoomChanges(this)},n.prototype._update=function(e){r.isObject(e)&&(e.roomId&&this._roomId.setValue(e.roomId),e.alias&&this._alias.setValue(e.alias),e.name&&this._name.setValue(e.name),e.description&&this._description.setValue(e.description),e.type&&this._type.setValue(e.type),e.options&&this._options.setValue(e.options),e.bridgeId&&this._bridgeId.setValue(e.bridgeId),e.pin&&this._pin.setValue(e.pin),e.members)},n.prototype._addMembers=function(e){var t=this,i=d(e);r.forEach(i,function(e){t._members.push(e)})},n.prototype._removeMembers=function(e){var i=this;r.forEach(e,function(t){i._members.remove(function(e){return t.sessionId===e.getSessionId()&&t.lastUpdate>=e.getObservableLastUpdate().getValue()})})},n.prototype._updateMembers=function(i){r.forEach(this._members.getValue(),function(t){var e=r.find(i,function(e){return t.getSessionId()===e.sessionId&&e.lastUpdate>t.getObservableLastUpdate().getValue()});e&&t._update(e)})},n}.apply(t,r))||(e.exports=n)},function(e,t,i){var r;void 0===(r=function(){"use strict";return{states:{trackEnabled:{id:0,name:"TrackEnabled"},trackDisabled:{id:1,name:"TrackDisabled"},trackEnded:{id:2,name:"TrackEnded"}}}}.apply(t,[]))||(e.exports=r)},function(e,t,i){var r,n;r=[i(0)],void 0===(n=function(d){"use strict";function e(){}return e.convertPeerConnectionStats=function(e,t){return function(e,u){if(!e)return null;var c=[],a=function(e,t,i,r,n,s){if(e){d.hasIndexOrKey(u,e)||(u[e]={timestamp:0});var o=parseFloat(i)-u[e].timestamp,a=function(e,t,i){if(e){var r=t||0,n=8e3*(e-r)/i;return Math.round(n/1e3)}return 0}(parseFloat(r),u[e].bytesSent,o),l=function(e,t,i){if(e){var r=t||0,n=8e3*(e-r)/i;return Math.round(n/1e3)}return 0}(parseFloat(n),u[e].bytesReceived,o);u[e].bytesSent=parseFloat(r),u[e].bytesReceived=parseFloat(n),u[e].timestamp=parseFloat(i),c.push({uploadRate:a,downloadRate:l,mediaType:t,ssrc:e,direction:s})}};d.isFunction(e.result)?d.forEach(e.result(),function(e){if("ssrc"===e.type){var t=e.stat("ssrc"),i=e.stat("bytesSent"),r=e.stat("bytesReceived"),n=e.stat("mediaType"),s=e.timestamp.getTime(),o=-1<e.id.indexOf("send")?"upload":"download";a(t,n,s,i,r,o)}}):d.isFunction(e.values)?d.forEach(Array.from(e.values()),function(e){if(d.hasIndexOrKey(e,"ssrc")){if(!e.ssrc||d.includes(e.id,"rtcp"))return;var t=-1<e.type.indexOf("outbound")?"upload":"download";a(e.ssrc,e.mediaType,e.timestamp,e.bytesSent,e.bytesReceived,t)}}):d.forEach(e,function(e){if(d.hasIndexOrKey(e,"ssrc")){if(!e.ssrc||d.includes(e.id,"rtcp"))return;var t=-1<e.type.indexOf("outbound")?"upload":"download";a(e.ssrc,e.mediaType,e.timestamp,e.bytesSent,e.bytesReceived,t)}});return c}(e,t)},e}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(1),i(2)],void 0===(n=function(F,n,U){"use strict";function e(e,t,i){n.isString(e,"name"),n.isObject(t,"peerConnection"),n.isObject(i,"logger"),this._name=e,this._peerConnection=t,this._logger=i}function V(e){this.time=F.now(),this.value=e||0}function s(e){var r={};switch(U.browser){case"Firefox":return e;case"IE":F.forOwn(e,function(e,t){if(!F.startsWith(t,"ssrc")){return}r[e.id]=e});return r;case"Safari":case"Edge":e.forEach(function(e){r[e.id]=e});return r;case"ReactNative":var t=F.isString(e)?JSON.parse(e):e;t.forEach(function(e){var i={id:e.id,type:e.type};e.values.forEach(function(t){F.keys(t).forEach(function(e){i[e]=t[e]})});r[i.id]=i});return r;case"Chrome":default:e.result().forEach(function(t){var i={id:t.id,type:t.type};t.names().forEach(function(e){i[e]=t.stat(e)});r[i.id]=i});return r}}function o(e,t,i,r,n){if(!i()){return this._logger.info("[%s] Finished monitoring of peer connection",this._name)}U.getStats(e,null,function(e){var t=s(e);r(t)},function(e){n(e)})}function q(e){var t=e.getLocalStreams?e.getLocalStreams():[],i=e.getRemoteStreams?e.getRemoteStreams():[],r=[],n=[];if(F.forEach(t,function(e){r=r.concat(e.getTracks())}),F.forEach(i,function(e){n=n.concat(e.getTracks())}),0!==r.length&&0!==n.length)throw this._logger.error("Invalid State. PeerConnection contains [%s] local and [%s] remote streams.",t.length,i.length),new Error("Invalid State. PeerConnection contains both local and remote streams.");return 0!==r.length?r:0!==n.length?n:[]}function B(e,i){var t=e.localDescription.sdp.split("m="),r=e.remoteDescription.sdp.split("m=");return t.length===r.length&&F.findIndex(t,function(e,t){return i(e,t,r)})}function j(e,t,i){return t?8*(e.value-t.value)/((e.time-t.time)/1e3):i}function z(t){var e=q(this._peerConnection),i=F.filter(e,function(e){return e.kind===t}),r=F.filter(this._pausedTracks,function(e){return e.kind===t});return F.reduce(i,function(e,t){if(!e)return e;var i=!!F.find(r,function(e){return e.id===t.id});return!t.enabled||i},!0)}return e.prototype.start=function(e,t,i){if(n.isObject(e,"options"),n.isFunction(t,"activeCallback"),n.isFunction(i,"monitorCallback"),"inbound"!==e.direction&&"outbound"!==e.direction)throw new Error("Invalid monitoring direction");if(this._frameRateFailureThreshold=e.frameRateThreshold||2,this._videoBitRateFailureThreshold=e.videoBitRateThreshold||6e3,this._audioBitRateFailureThreshold=e.audioBitRateThreshold||5e3,this._conditionCountForNotificationThreshold=e.conditionCountForNotificationThreshold||3,this._monitoringInterval=e.monitoringInterval||4e3,this._conditionMonitoringInterval=e.monitoringInterval||1500,this._monitorFrameRate=!e.hasOwnProperty("monitorFrameRate")||e.monitorFrameRate,this._monitorBitRate=!e.hasOwnProperty("monitorBitRate")||e.monitorBitRate,this._monitorState=!e.hasOwnProperty("monitorState")||e.monitorState,this._pausedTracks=[],"Edge"===U.browser){var r=this._conditionMonitoringInterval*this._conditionCountForNotificationThreshold;this._monitoringInterval=Math.max(this._monitoringInterval,6e3),this._conditionMonitoringInterval=Math.max(this._conditionMonitoringInterval,6e3),this._conditionCountForNotificationThreshold=Math.max(Math.ceil(r/this._monitoringInterval),2),this._logger.info("Using modified options for optimal monitoring of PeerConnection on [Edge]. Monitor Interval [%s], Condition Monitor Interval [%s], Condition Count For Notification [%s]",this._monitoringInterval,this._conditionMonitoringInterval,this._conditionCountForNotificationThreshold)}return function(E,T,k,I,R){var C=this,O=0,P=void 0,M=void 0,A=void 0,x={},L={},N={},D=null;setTimeout(function w(S){o.call(C,T,null,I,function(e){var s=!1,o=!1,a=!1,l=!1,u=!1;if(!I())return C._logger.info("[%s] Finished monitoring of peer connection",E);function i(e,t){var i=e.id||e.ssrc,r=null;if(e.framesEncoded){var n=new V(e.framesEncoded);e.framerateMean=function(e,t,i){if(!t)return i;return(e.value-t.value)/((e.time-t.time)/1e3)}(n,N[i],2*C._frameRateFailureThreshold),N[i]=n}switch(U.browser){case"Safari":case"Firefox":case"Edge":case"IE":if(u=l|=e.selected&&"succeeded"===e.state||"IE"===U.browser||"Edge"===U.browser||"Safari"===U.browser,"outbound"===k.direction&&("outboundrtp"===e.type||"outbound-rtp"===e.type||"kOutboundRtp"===e.type))switch(r=new V(e.bytesSent),e.mediaType){case"video":C._logger.debug("[%s] Outbound [%s] [%s] with bitrate [%s], droppedFrames [%s] and frame rate [%s]",E,e.mediaType,e.ssrc,e.bitrateMean,e.droppedFrames,e.framerateMean),s=!0,P=e.framerateMean||0,o=!0,M=j(r,L[i],2*C._videoBitRateFailureThreshold),L[i]=r,"Edge"===U.browser&&(s=!1);break;case"audio":C._logger.debug("[%s] Outbound [%s] [%s]",E,e.mediaType,e.ssrc),a=!0,A=j(r,x[i],2*C._audioBitRateFailureThreshold),x[i]=r}if("inbound"===k.direction&&("inboundrtp"===e.type||"inbound-rtp"===e.type||"kInboundRtp"===e.type))switch(r=new V(e.bytesReceived),e.mediaType){case"video":C._logger.debug("[%s] Inbound [%s] [%s] with framerate [%s] and jitter [%s]",E,e.mediaType,e.ssrc,e.framerateMean,e.jitter),o=!0,M=j(r,L[i],2*C._videoBitRateFailureThreshold),L[i]=r;break;case"audio":C._logger.debug("[%s] Inbound [%s] [%s] with jitter [%s]",E,e.mediaType,e.ssrc,e.jitter),a=!0,A=j(r,x[i],2*C._audioBitRateFailureThreshold),x[i]=r}break;case"Chrome":default:if("true"===e.googWritable&&(u=!0),"true"===e.googReadable&&(l=!0),"ssrc"!==e.type)return;if("outbound"===k.direction)switch(r=new V(e.bytesSent),e.mediaType){case"video":C._logger.debug("[%s] Outbound [%s] [%s] with average encoding time [%s] ms (CPU limited=[%s]) and RTT [%s]",E,e.mediaType,e.ssrc,e.googAvgEncodeMs,e.googCpuLimitedResolution,e.googRtt),s=!0,P=e.googFrameRateSent||0,o=!0,M=j(r,L[i],2*C._videoBitRateFailureThreshold),L[i]=r;break;case"audio":C._logger.debug("[%s] Outbound [%s] [%s] with audio input level [%s] and RTT [%s] and jitter [%s]",E,e.mediaType,e.ssrc,e.audioInputLevel,e.googRtt,e.googJitterReceived),a=!0,A=j(r,x[i],2*C._audioBitRateFailureThreshold),x[i]=r}else if("inbound"===k.direction)switch(r=new V(e.bytesReceived),e.mediaType){case"video":C._logger.debug("[%s] Inbound [%s] [%s] with current delay [%s] ms and target delay [%s] ms",E,e.mediaType,e.ssrc,e.googCurrentDelayMs,e.googTargetDelayMs),s=!0,P=e.googFrameRateReceived||0,o=!0,M=j(r,L[i],2*C._videoBitRateFailureThreshold),L[i]=r;break;case"audio":C._logger.debug("[%s] Inbound [%s] [%s] with output level [%s] and jitter [%s] and jitter buffer [%s] ms",E,e.mediaType,e.ssrc,e.audioOutputLevel,e.googJitterReceived,e.googJitterBufferMs),a=!0,A=j(r,x[i],2*C._audioBitRateFailureThreshold),x[i]=r}}}if(!e)throw new Error("Report must be a valid PeerConnection.getStats Report");e.forEach?e.forEach(i):F.forOwn(e,function(e,t){i(e,t)});var t,r,n,c=(t=B(T,function(e,t,i){return!!F.startsWith(e,"audio")&&(!F.includes(e,"a=inactive")&&!F.includes(i[t],"a=inactive"))}),F.isNumber(t)),d=(r=B(T,function(e,t,i){return!!F.startsWith(e,"video")&&(!F.includes(e,"a=inactive")&&!F.includes(i[t],"a=inactive"))}),F.isNumber(r));if((o&&0===M||a&&0===A||s&&0===P)&&(o=o&&d,a=a&&c,s=s&&d,l=l||!(d||c),u=u||!(d||c)),(a||o||s)&&C._logger.debug("[%s] Current bit rate is [%s] bps for audio and [%s] bps for video with [%s] FPS",E,Math.ceil(A||0),Math.ceil(M||0),P||"?"),!C._monitorState||"closed"!==T.connectionState&&"failed"!==T.connectionState&&"failed"!==T.iceConnectionState)C._monitorFrameRate&&s&&P<=C._frameRateFailureThreshold&&!z.call(C,"video")?O++:C._monitorBitRate&&a&&A<=C._audioBitRateFailureThreshold&&!z.call(C,"audio")?O++:C._monitorBitRate&&o&&M<=C._videoBitRateFailureThreshold&&!z.call(C,"video")?O++:l&&u?O=0:O++;else{var h=c&&d,p=q.call(C,T);if(!h&&(n=B(T,function(e){return F.startsWith(e,"video")||F.startsWith(e,"audio")}),F.isNumber(n)))return void C._logger.info("[%s] Finished monitoring of peer connection with [%s] inactive tracks",E,p.length);O++}var f=!(0!==M&&o||0!==A&&a||function(){var r=this;return F.reduce(q(this._peerConnection),function(e,t){if(!e)return e;var i=!!F.find(r._pausedTracks,function(e){return e.id===t.id});return!t.enabled||i},!0)}.call(C));f&&!D?D=setTimeout(F.bind(w,this,!0),5e3):f||(clearTimeout(D),D=null);var m=S&&f&&D,g=function(){C._logger.info("[%s] Failure has been acknowledged",E),O=Number.MIN_VALUE,setTimeout(w,C._monitoringInterval)};if(O>=C._conditionCountForNotificationThreshold||m){var y="["+E+"] Failure detected with frame rate ["+P+"] FPS, audio bit rate ["+A+"] bps, and video bit rate ["+M+"] bps",v="["+E+"] Failure detected with 0 bps audio and video for [5] seconds",b=m?v:y,_={type:"condition",message:b,report:e,frameRate:P,videoBitRate:M,audioBitRate:A,acknowledgeFailure:g};R(null,_)?g():C._logger.error(b+": [%s]",e)}else setTimeout(w,0<O?C._conditionMonitoringInterval:C._monitoringInterval)},function(e){R(e,{type:"error",message:"Unable to get Connection statistics. Connection may have failed."})})},C._monitoringInterval)}.call(this,this._name,this._peerConnection,e,t,i)},e.prototype.setMonitorTrackState=function(t,e){n.isObject(t,"track"),n.isBoolean(e,"state");var i=q(this._peerConnection);if(!!!F.find(i,function(e){return e.id===t.id}))return this._logger.warn("[%s] Unable to find track [%s] [%s] in peer connection",this._name,t.kind,t.id);if(!e)return this._logger.info("[%s] Pausing monitoring of track [%s] [%s]",this._name,t.kind,t.id),this._pausedTracks.push(t);var r=this._pausedTracks.length;this._pausedTracks=F.filter(this._pausedTracks,function(e){return e.id!==t.id}),r!==this._pausedTracks.length&&this._logger.info("[%s] Starting monitoring of track [%s] [%s] after it was paused",this._name,t.kind,t.id)},e.prototype.toString=function(){return"PeerConnectionMonitor["+this._name+"]"},e}.apply(t,r))||(e.exports=n)},function(e,t){},function(e,t,i){var r,n;r=[i(0),i(1),i(17),i(16),i(33),i(77),i(75)],void 0===(n=function(i,n,r,s,o,a,l){"use strict";function e(e,t){n.isArray(e,"userMediaStreams"),t=t||{},this._baseUri=t.uri||s.DefaultPCastUri,this._logger=t.logger||r.createPCastLogger(this._baseUri),this._audioContext=t.audioContext||new o,this._nativeAudioContext=this._audioContext.getNativeAudioContext(),this._onSpeakingChanged=null,this._userMediaStreams=e,this._disposeOfAudioContext=!i.isObject(t.audioContext),this._audioVolumeMeterFactory=new a(this._logger),i.forEach(this._userMediaStreams,i.bind(u,this,t))}function u(e,t){n.isObject(t,"stream"),n.isObject(e,"options");var i=this._audioVolumeMeterFactory.getAudioVolumeMeter(t);i.init(this._nativeAudioContext,e.alpha),i.connect(t)}function c(e,t){n.isObject(t,"stream"),n.isObject(e,"options");var i=this._audioVolumeMeterFactory.getAudioVolumeMeter(t),r=new l(this._logger);e.alpha&&i.setAlpha(e.alpha),r.onValue(this._onSpeakingChanged),r.startDetection(i,e)}return e.prototype.start=function(e,t){n.isFunction(t,"callback"),this._onSpeakingChanged=t,e=e||{},i.forEach(this._userMediaStreams,i.bind(c,this,e))},e.prototype.stop=function(){i.forEach(this.getAudioVolumeMeters(),function(e){e.onValue(function(){})}),this._onSpeakingChanged=null},e.prototype.getAudioVolumeMeter=function(e){return n.isObject(e,"stream"),this._audioVolumeMeterFactory.getAudioVolumeMeter(e)},e.prototype.getAudioVolumeMeters=function(){return this._audioVolumeMeterFactory.getAudioVolumeMeters()},e.prototype.dispose=function(){this._disposeOfAudioContext&&this._nativeAudioContext.close(),this._audioVolumeMeterFactory.stopAllMeters(),this._userMediaStreams=null},e.prototype.toString=function(){return"AudioSpeakerDetector"},e}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(1),i(17),i(16),i(78)],void 0===(n=function(i,r,n,s,o){"use strict";function e(e,t){r.isArray(e,"userMediaStreams"),t=t||{},this._baseUri=t.uri||s.DefaultPCastUri,this._logger=t.logger||n.createPCastLogger(this._baseUri),this._publisherAdjusters=[],this._publishers=e}function a(e,t,i){var r=new o(i);r.connect(e,t),this._publisherAdjusters.push(r)}return e.prototype.start=function(e,t){t=t||{},i.forEach(this._publishers,i.bind(a,this,e,t))},e.prototype.stop=function(){i.forEach(this._publisherAdjusters,function(e){e.close()}),this._publisherAdjusters=[]},e.prototype.toString=function(){return"BandwidthMonitor"},e}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(1),i(4),i(3),i(22),i(85),i(38),i(36),i(18),i(11),i(10),i(19)],void 0===(n=function(b,r,e,t,i,n,s,o,_,a,w,l){"use strict";var u={maxOfflineTime:864e5,maxReconnectFrequency:6e4};function c(e){r.isObject(e,"options"),e.roomExpress?r.isObject(e.roomExpress,"options.roomExpress"):(r.isStringNotEmpty(e.backendUri,"options.backendUri"),r.isObject(e.authenticationData,"options.authenticationData"));var t=b.assign({reconnectOptions:u},e);this._roomExpress=e.roomExpress||new i(t),this._shouldDisposeOfRoomExpress=!e.roomExpress,this._logger=this._roomExpress.getPCastExpress().getPCast().getLogger()}function S(e,t,i){i&&i.roomService&&(i.channelService=new n(i.roomService),delete i.roomService),i&&i.room&&(i.channel=new s(i.room),delete i.room),e(t,i)}return c.prototype.dispose=function(){this._shouldDisposeOfRoomExpress&&this._roomExpress.dispose()},c.prototype.getRoomExpress=function(){return this._roomExpress},c.prototype.getPCastExpress=function(){return this._roomExpress.getPCastExpress()},c.prototype.createChannel=function(e,t){r.isObject(e,"options"),r.isObject(e.channel,"options.channel");var i=b.assign({room:e.channel},e);i.room.type=a.types.channel.name,delete i.channel,this._roomExpress.createRoom(i,b.bind(S,null,t))},c.prototype.joinChannel=function(d,s,h){r.isObject(d,"options"),r.isFunction(s,"joinChannelCallback"),r.isFunction(h,"subscriberCallback"),d.videoElement&&r.isObject(d.videoElement,"options.videoElement"),d.streamSelectionStrategy&&r.isStringNotEmpty(d.streamSelectionStrategy,"options.streamSelectionStrategy");var p,f,m,e=b.assign({type:a.types.channel.name,role:w.roles.audience.name},d),g=new o(d.streamSelectionStrategy,this._logger),y="",v=this;e.channelId&&(e.roomId=e.channelId),delete e.channelId;v._roomExpress.joinRoom(e,function(e,t){var i=!t||b.assign({},t);if(t&&t.roomService){var r=t.roomService.leaveRoom,n=t.roomService.getObservableActiveRoom().getValue();m=t.roomService,y=n?n.getRoomId():"",v._logger.info("Joined channel [%s] with [%s] selection strategy",y,g.getStrategy()),i.roomService.leaveRoom=function(e){p&&p.stop(),r(e)}}S(s,e,i)},function r(e,t){var i=b.filter(e,function(e){return e.getObservableRole().getValue()===w.roles.presenter.name&&0<e.getObservableStreams().getValue().length}),n=!!t||!p||!f,s=g.getNext(i,n),o=s?s.getObservableStreams().getValue()[0]:null,a=o?o.getPCastStreamId():"";if(!s||!o)return 0===i.length?h(null,{status:"no-stream-playing"}):t?(v._logger.info("Unable to find a new presenter to replace stream [%s] that ended in channel [%s] with status [%s] and [%s] black-listed members",f,y,t,g.getNumberOfBlackListedMembers()),h(null,{status:t||"unable-to-recover"})):h(null,{status:"no-stream-playing"});if(!function(e){var t=_.getInfoFromStreamUri(e);if(0===b.values(t).length)return!0;return!!t.streamTokenForLiveStream||!!t.streamTokenStreaming}(o.getUri())&&b.includes(d.capabilities,"streaming"))return h(null,{status:"streaming-not-available"});if(!a)return v._logger.info("Channel [%s] presenter has no stream",y),h(null,{status:"no-stream-playing"});if(a===f)return t?(v._logger.info("Unable to find a new presenter to replace stream [%s] that ended in channel [%s] with status [%s]",f,y,t),h(null,{status:t||"unable-to-recover"})):void 0;f&&p&&p.stop();var l=function(e){var t=m?m.getObservableActiveRoom().getValue():null,i=t?t.getObservableMembers().getValue():[];if(t)return r(i,e)};var u=b.assign({},{monitor:{callback:b.bind(function(e,t,i){if(f===e)return t?l("unable-to-subscribe"):"app-background"===i.reason?h(t,i):i.retry&&"high-availability"!==g.getStrategy()?i.retry():"ok"!==i.status?l(i.status):void 0},this,a),options:{conditionCountForNotificationThreshold:8}}},d),c=f?t?"recovered-from-failure":"stream-override":"stream-started";f=a;v._roomExpress.subscribeToMemberStream(o,u,b.bind(function(e,t,i){if(f===e){if(i&&"ok"===i.status&&(i.reason=c),t||i&&"ok"!==i.status)return v._logger.info("[%s] Issue with stream [%s]. Trying next member",e,i?i.status:"",t),l(i?i.status:"");p=i&&i.mediaStream?i.mediaStream:f=null,h(t,i)}},this,a))})},c.prototype.publishToChannel=function(e,t){r.isObject(e,"options"),r.isFunction(t,"callback");var i=b.assign({memberRole:w.roles.presenter.name,streamType:l.types.presentation.name,room:e.channel},e);i.room.type=a.types.channel.name,delete i.channel,this._roomExpress.publishToRoom(i,b.bind(S,null,t))},c.prototype.publishScreenToChannel=function(e,t){r.isObject(e,"options"),r.isFunction(t,"callback");var i=b.assign({memberRole:w.roles.presenter.name,streamType:l.types.presentation.name,room:e.channel},e);i.room.type=a.types.channel.name,delete i.channel,this._roomExpress.publishScreenToRoom(i,b.bind(S,null,t))},c}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n,s;n=[],void 0===(s="function"==typeof(r=function(){"use strict";function r(e,t,i){this.low=0|e,this.high=0|t,this.unsigned=!!i}function p(e){return!0===(e&&e.__isLong__)}Object.defineProperty(r.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1}),r.isLong=p;var s={},o={};function e(e,t){var i,r,n;return t?(n=0<=(e>>>=0)&&e<256)&&(r=o[e])?r:(i=m(e,(0|e)<0?-1:0,!0),n&&(o[e]=i),i):(n=-128<=(e|=0)&&e<128)&&(r=s[e])?r:(i=m(e,e<0?-1:0,!1),n&&(s[e]=i),i)}function f(e,t){if(isNaN(e)||!isFinite(e))return t?l:v;if(t){if(e<0)return l;if(n<=e)return w}else{if(e<=-a)return S;if(a<=e+1)return _}return e<0?f(-e,t).neg():m(e%i|0,e/i|0,t)}function m(e,t,i){return new r(e,t,i)}r.fromInt=e,r.fromNumber=f,r.fromBits=m;var c=Math.pow;function d(e,t,i){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return v;if("number"==typeof t?(i=t,t=!1):t=!!t,(i=i||10)<2||36<i)throw RangeError("radix");var r;if(0<(r=e.indexOf("-")))throw Error("interior hyphen");if(0===r)return d(e.substring(1),t,i).neg();for(var n=f(c(i,8)),s=v,o=0;o<e.length;o+=8){var a=Math.min(8,e.length-o),l=parseInt(e.substring(o,o+a),i);if(a<8){var u=f(c(i,a));s=s.mul(u).add(f(l))}else s=(s=s.mul(n)).add(f(l))}return s.unsigned=t,s}function g(e){return e instanceof r?e:"number"==typeof e?f(e):"string"==typeof e?d(e):m(e.low,e.high,e.unsigned)}r.fromString=d,r.fromValue=g;var i=4294967296,n=i*i,a=n/2,y=e(1<<24),v=e(0);r.ZERO=v;var l=e(0,!0);r.UZERO=l;var u=e(1);r.ONE=u;var h=e(1,!0);r.UONE=h;var b=e(-1);r.NEG_ONE=b;var _=m(-1,2147483647,!1);r.MAX_VALUE=_;var w=m(-1,-1,!0);r.MAX_UNSIGNED_VALUE=w;var S=m(0,-2147483648,!1);r.MIN_VALUE=S;var t=r.prototype;return t.toInt=function(){return this.unsigned?this.low>>>0:this.low},t.toNumber=function(){return this.unsigned?(this.high>>>0)*i+(this.low>>>0):this.high*i+(this.low>>>0)},t.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(S)){var t=f(e),i=this.div(t),r=i.mul(t).sub(this);return i.toString(e)+r.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var n=f(c(e,6),this.unsigned),s=this,o="";;){var a=s.div(n),l=(s.sub(a.mul(n)).toInt()>>>0).toString(e);if((s=a).isZero())return l+o;for(;l.length<6;)l="0"+l;o=""+l+o}},t.getHighBits=function(){return this.high},t.getHighBitsUnsigned=function(){return this.high>>>0},t.getLowBits=function(){return this.low},t.getLowBitsUnsigned=function(){return this.low>>>0},t.getNumBitsAbs=function(){if(this.isNegative())return this.eq(S)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;0<t&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},t.isZero=function(){return 0===this.high&&0===this.low},t.isNegative=function(){return!this.unsigned&&this.high<0},t.isPositive=function(){return this.unsigned||0<=this.high},t.isOdd=function(){return 1==(1&this.low)},t.isEven=function(){return 0==(1&this.low)},t.equals=function(e){return p(e)||(e=g(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&(this.high===e.high&&this.low===e.low)},t.eq=t.equals,t.notEquals=function(e){return!this.eq(e)},t.neq=t.notEquals,t.lessThan=function(e){return this.comp(e)<0},t.lt=t.lessThan,t.lessThanOrEqual=function(e){return this.comp(e)<=0},t.lte=t.lessThanOrEqual,t.greaterThan=function(e){return 0<this.comp(e)},t.gt=t.greaterThan,t.greaterThanOrEqual=function(e){return 0<=this.comp(e)},t.gte=t.greaterThanOrEqual,t.compare=function(e){if(p(e)||(e=g(e)),this.eq(e))return 0;var t=this.isNegative(),i=e.isNegative();return t&&!i?-1:!t&&i?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},t.comp=t.compare,t.negate=function(){return!this.unsigned&&this.eq(S)?S:this.not().add(u)},t.neg=t.negate,t.add=function(e){p(e)||(e=g(e));var t=this.high>>>16,i=65535&this.high,r=this.low>>>16,n=65535&this.low,s=e.high>>>16,o=65535&e.high,a=e.low>>>16,l=0,u=0,c=0,d=0;return c+=(d+=n+(65535&e.low))>>>16,u+=(c+=r+a)>>>16,l+=(u+=i+o)>>>16,l+=t+s,m((c&=65535)<<16|(d&=65535),(l&=65535)<<16|(u&=65535),this.unsigned)},t.subtract=function(e){return p(e)||(e=g(e)),this.add(e.neg())},t.sub=t.subtract,t.multiply=function(e){if(this.isZero())return v;if(p(e)||(e=g(e)),e.isZero())return v;if(this.eq(S))return e.isOdd()?S:v;if(e.eq(S))return this.isOdd()?S:v;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(y)&&e.lt(y))return f(this.toNumber()*e.toNumber(),this.unsigned);var t=this.high>>>16,i=65535&this.high,r=this.low>>>16,n=65535&this.low,s=e.high>>>16,o=65535&e.high,a=e.low>>>16,l=65535&e.low,u=0,c=0,d=0,h=0;return d+=(h+=n*l)>>>16,c+=(d+=r*l)>>>16,d&=65535,c+=(d+=n*a)>>>16,u+=(c+=i*l)>>>16,c&=65535,u+=(c+=r*a)>>>16,c&=65535,u+=(c+=n*o)>>>16,u+=t*l+i*a+r*o+n*s,m((d&=65535)<<16|(h&=65535),(u&=65535)<<16|(c&=65535),this.unsigned)},t.mul=t.multiply,t.divide=function(e){if(p(e)||(e=g(e)),e.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?l:v;var t,i,r;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return l;if(e.gt(this.shru(1)))return h;r=l}else{if(this.eq(S))return e.eq(u)||e.eq(b)?S:e.eq(S)?u:(t=this.shr(1).div(e).shl(1)).eq(v)?e.isNegative()?u:b:(i=this.sub(e.mul(t)),r=t.add(i.div(e)));else if(e.eq(S))return this.unsigned?l:v;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();r=v}for(i=this;i.gte(e);){t=Math.max(1,Math.floor(i.toNumber()/e.toNumber()));for(var n=Math.ceil(Math.log(t)/Math.LN2),s=n<=48?1:c(2,n-48),o=f(t),a=o.mul(e);a.isNegative()||a.gt(i);)a=(o=f(t-=s,this.unsigned)).mul(e);o.isZero()&&(o=u),r=r.add(o),i=i.sub(a)}return r},t.div=t.divide,t.modulo=function(e){return p(e)||(e=g(e)),this.sub(this.div(e).mul(e))},t.mod=t.modulo,t.not=function(){return m(~this.low,~this.high,this.unsigned)},t.and=function(e){return p(e)||(e=g(e)),m(this.low&e.low,this.high&e.high,this.unsigned)},t.or=function(e){return p(e)||(e=g(e)),m(this.low|e.low,this.high|e.high,this.unsigned)},t.xor=function(e){return p(e)||(e=g(e)),m(this.low^e.low,this.high^e.high,this.unsigned)},t.shiftLeft=function(e){return p(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?m(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):m(0,this.low<<e-32,this.unsigned)},t.shl=t.shiftLeft,t.shiftRight=function(e){return p(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?m(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):m(this.high>>e-32,0<=this.high?0:-1,this.unsigned)},t.shr=t.shiftRight,t.shiftRightUnsigned=function(e){if(p(e)&&(e=e.toInt()),0===(e&=63))return this;var t=this.high;return e<32?m(this.low>>>e|t<<32-e,t>>>e,this.unsigned):m(32===e?t:t>>>e-32,0,this.unsigned)},t.shru=t.shiftRightUnsigned,t.toSigned=function(){return this.unsigned?m(this.low,this.high,!1):this},t.toUnsigned=function(){return this.unsigned?this:m(this.low,this.high,!0)},t.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},t.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24&255,255&e,e>>>8&255,e>>>16&255,e>>>24&255]},t.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24&255,e>>>16&255,e>>>8&255,255&e,t>>>24&255,t>>>16&255,t>>>8&255,255&t]},r})?r.apply(t,n):r)||(e.exports=s)},function(e,t,i){var r,n;r=[i(0),i(1),i(5),i(3)],void 0===(n=function(n,t,e,s){"use strict";var o=3e3;function i(){this._namedEvents=new e.NamedEvents,this._timeOfLastTabFocusChange=n.now(),this._disposables=new s.DisposableList,this._isForeground=!0,this._disposables.add(this._namedEvents),function(){if(r())return function(){if(!r())return;var n=this;chrome.extension.onRequest.addListener(function(e,i,r){"is_selected"===e&&chrome.tabs.getSelected(null,function(e){var t=e.id===i.tab.id;a.call(n,t),r(!!t)})})}.call(this);(function(){var t,e,i=this;return void 0;void 0!=="{}".msHidden?(t="msHidden",e="msvisibilitychange"):void 0!=="{}".webkitHidden?(t="webkitHidden",e="webkitvisibilitychange"):void 0!=="{}".hidden&&(t="hidden",e="visibilitychange");function r(){var e=!"{}"[t];a.call(i,e)}void 0!=="{}".addEventListener&&void 0!=="{}"[t]?(n.addEventListener("{}",e,r,!1),i._disposables.add(new s.Disposable(function(){n.removeEventListener("{}",e,r,!1)}))):function(){var t=this;t._documentFocusInterval=setInterval(function(){var e="{}".hasFocus();a.call(t,e)},o),t._disposables.add(new s.Disposable(function(){n.isNumber(t._documentFocusInterval)&&clearInterval(t._documentFocusInterval),t._documentFocusInterval=null}))}.call(i)}).call(this)}.call(this)}function r(){return"undefined"!=typeof chrome&&chrome.extension&&chrome.extension.onRequest}function a(e){if(t.isBoolean(e,"isForeground"),this._isForeground!==e)return e?(this._isForeground=!0,l.call(this,"foreground")):(this._isForeground=!1,l.call(this,"background"))}function l(e){var t=n.now(),i=t-this._timeOfLastTabFocusChange;this._timeOfLastTabFocusChange=t,this._namedEvents.fire(e,[i])}return i.prototype.isForeground=function(){return this._isForeground},i.prototype.getTimeSinceLastChange=function(){return n.now()-this._timeOfLastTabFocusChange},i.prototype.onForeground=function(e){return t.isFunction(e,"callback"),this._namedEvents.listen("foreground",e)},i.prototype.onBackground=function(e){return t.isFunction(e,"callback"),this._namedEvents.listen("background",e)},i}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0)],void 0===(n=function(r){var n=function(){};return n.prototype.isObject=function(e,t){n.prototype.isString("name",t);var i='"'+t+'" must be an object';if(!r.isObject(e))throw new Error(i)},n.prototype.isArray=function(e,t){n.prototype.isString("name",t);var i='"'+t+'" must be an array';if(!r.isArray(e))throw new Error(i)},n.prototype.isString=function(e,t){var i='"'+t+'" must be a string';if(!r.isString(t))throw new Error('"name" must be a string');if(!r.isString(e))throw new Error(i)},n.prototype.isBoolean=function(e,t){n.prototype.isString("name",t);var i='"'+t+'" must be a boolean';if(!r.isBoolean(e))throw new Error(i)},n.prototype.isNumber=function(e,t){n.prototype.isString("name",t);var i='"'+t+'" must be a number';if(!r.isNumber(e))throw new Error(i)},n.prototype.isFunction=function(e,t){n.prototype.isString("name",t);var i='"'+t+'" must be a function';if(!r.isFunction(e))throw new Error(i)},n.prototype.stringNotEmpty=function(e,t){n.prototype.isStringNotEmpty(e,t)},n.prototype.isStringNotEmpty=function(e,t){n.prototype.isString("name",t);var i='"'+t+'" must not be empty';if(n.prototype.isString(e,t),""===e)throw new Error(i)},n.prototype.isInstanceOf=function(e,t,i){if(n.prototype.isString("name",i),!r.isObject(e))throw new Error('"'+i+'" must be an instance');if(!(e instanceof t))throw new Error('"'+i+'" must be a valid instance of class')},n.prototype.isNotUndefined=function(e,t){if(n.prototype.isString("name",t),r.isUndefined(e))throw new Error('"'+t+'" must not be undefined')},n.prototype.isValidType=function(e,t,i){if(n.prototype.isStringNotEmpty(i,"name"),e=r.getEnumName(t,e),r.isNullOrUndefined(e))throw new Error('"'+i+'" must be a valid type');return e},n.prototype.isArrayOfString=function(e,i){n.prototype.isString(i,"name"),n.prototype.isArray(e,i),r.forEach(e,function(e,t){n.prototype.isString(e,i+"["+t+"]")})},new n}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(1),i(5),i(27),i(6),i(4),i(3)],void 0===(n=function(s,o,a,l,u,c,d){var i=0,h={capacity:"capacity",error:"error",response:"response"};function e(e,t,i,r){o.isStringNotEmpty(e,"uri"),t=t||{},o.isObject(t,"options"),t.requestType&&o.isStringNotEmpty(t.requestType,"options.requestType"),t.maxAttempts&&o.isNumber(t.maxAttempts,"options.maxAttempts"),t.maxBufferedRecords&&o.isNumber(t.maxBufferedRecords,"options.maxBufferedRecords"),t.maxBatchSize&&o.isNumber(t.maxBatchSize,"options.maxBatchSize"),t.contentType&&o.isStringNotEmpty(t.contentType,"options.maxBatchSize"),i&&o.isFunction(i,"serializeRequest"),r&&o.isFunction(r,"deserializeResponse"),this._localStoreKey="__phenixBatchHttpMessages|"+e,this._requestType=t.requestType||"POST",this._requestTimeout=t.requestTimeout||3e4,this._maxAttempts=t.maxAttempts||5,this._maxBufferedRecords=t.maxBufferedRecords||1e3,this._maxBatchSize=t.maxBatchSize||100,this._contentType=t.contentType||"application/json",this._serializeRequest=i,this._deserializeResponse=r,this._uri=e,this._records=m.call(this)||[],this._isEnabled=!0,this._namedEvents=new a.NamedEvents,this._canSendRequestObservable=new c.Observable(!0),this._disposables=new d.DisposableList,this._pending=!1,this._unloadTriggered=!1,this._disposables.add(this._canSendRequestObservable.subscribe(s.bind(p,this))),this._disposables.add(function(){var e=this;return l.listenForNetworkChange(function(){f.call(e,e._pending)})}.call(this)),this._disposables.add(this._namedEvents),y.call(this,[]),p.call(this);var n=this;s.addEventListener(window,"beforeunload",function(){g.call(n,n._records),n._unloadTriggered=!0,n._records=[]})}function t(){if(this._records.length>this._maxBufferedRecords){var e=this._records.length-this._maxBufferedRecords/2;this._records=this._records.slice(e),this._namedEvents.fireAsync(h.capacity,[null,{numberOfDeletedRecords:e}])}}function p(){if(this._canSendRequestObservable.getValue()&&0!==this._records.length){f.call(this,!0);var e={records:s.take(this._records,this._maxBatchSize)};this._records=this._records.slice(this._maxBatchSize);var t=this;try{(function(e,t,r){var n=this,i=this._serializeRequest?this._serializeRequest(s.assign({},t)):t;switch(this._requestType){case"POST":return u.postWithRetry(e,i,{timeout:this._requestTimeout,contentType:this._contentType,retryOptions:{maxAttempts:this._maxAttempts,additionalRetryErrorCodes:[0]}},function(e,t){if(e)return"timeout"!==e.message||function(){return this._records.length>=this._maxBufferedRecords}.call(n)?(f.call(n,!1),n._namedEvents.fire(h.error,[e])):r();f.call(n,!1);var i=n._deserializeResponse?n._deserializeResponse(t.data):t.data;return n._namedEvents.fire(h.response,[i])});default:throw new Error("Invalid request type")}}).call(this,this._uri,e,function(){setTimeout(function(){t._records=t._records.concat(e.records),f.call(t,!1)},i)})}catch(e){setTimeout(function(){return f.call(t,!1),t._namedEvents.fire(h.error,[e])},i)}}}function f(e){this._pending=e,this._canSendRequestObservable.setValue(!e&&l.isOnline())}e.prototype.on=function(e,t){return o.isStringNotEmpty(e,"eventName"),o.isFunction(t,"callback"),this._namedEvents.listen(e,t)},e.prototype.addRecord=function(e){if(this._unloadTriggered)return g.call(this,[e]);this._records.push(e),p.call(this),t.call(this)},e.prototype.addRecordToBeginning=function(e){this._records.unshift(e),p.call(this),t.call(this)},e.prototype.dispose=function(){this._records=[],this._disposables.dispose()};var m=function(){if(!window.localStorage)return null;var e=window.localStorage.getItem(this._localStoreKey);return e?JSON.parse(e):[]},g=function(e){if(!window.localStorage||!e||0===e.length)return null;var t=m.call(this).concat(e);return y.call(this,t)},y=function(e){return window.localStorage&&e?window.localStorage.setItem(this._localStoreKey,JSON.stringify(e)):null};return e}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(51)],void 0===(n=function(e){"use strict";return e}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(1),i(6),i(3)],void 0===(n=function(d,n,t,s){"use strict";function e(e,t,i,r){n.isObject(e,"logger"),n.isStringNotEmpty(t,"version"),n.isFunction(i,"onClosestEndpointFound"),r&&n.isFunction(r,"onAnEndpointResolved"),this._logger=e,this._version=t,this._onClosestEndpointFound=i,r&&(this._onAnEndpointResolved=r),this._done=!1,this._minTime=Number.MAX_VALUE,this._minResponseText="",this._disposables=new s.DisposableList}return e.prototype.isResolved=function(){return this._done},e.prototype.dispose=function(){this._disposables.dispose()},e.prototype.measurementCallback=function(e,t,i){return t<this._minTime&&(this._logger.info("Current closest end point is [%s] with latency of [%s] ms",i,t),this._minTime=t,this._minResponseText=i),this.isResolved()},e.prototype.completeCallback=function(e){if(this._minResponseText&&this._minTime<Number.MAX_VALUE&&!this.isResolved())return this._done=!0,this._onClosestEndpointFound(null,{uri:this._minResponseText,roundTripTime:this._minTime})},e.prototype.resolveAll=function(e){for(var t=0;t<e.length;t++)this.resolve(e[t],4)},e.prototype.resolve=function(e,a){var l=this,u=1,c=0;!function n(s){var o=d.now();l._logger.info("[%s] Checking end point [%s]",u,s);var e=t.getWithRetry(s,{timeout:15e3,queryParameters:{version:l._version,_:d.now()},retryOptions:{maxAttempts:1}},function(e,t){var i=d.now()-o,r=30<i;if(l._onAnEndpointResolved&&(e?l._onAnEndpointResolved(e):l._onAnEndpointResolved(null,{time:i,endPoint:s})),u++,!e){if(l.measurementCallback(s,i,t.data))return;c++}return u<=a&&!l.isResolved()&&(r||e)?(e&&l._logger.info("Retrying after failure to resolve end point [%s] with [%s]",s,e),n(s)):0===c?l._logger.warn("Unable to resolve end point [%s] with [%s]",s,e):l.completeCallback(s)});l._disposables.add(e)}(e)},e}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(53)],void 0===(n=function(e){return e}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0)],void 0===(n=function(s){"use strict";function e(e){this._userAgent=e||""}return e.prototype.detect=function(){var e="Unknown",t="?",i=this._userAgent.match(/(Chrome|Chromium|Firefox|Opera|Safari)+\//),r=this._userAgent.match(/(Chrome|Chromium|Firefox|Version)+\/([0-9]+)\./),n=!1;return i&&2<=i.length?e=i[1]:this._userAgent.match(/^\(?Mozilla/)&&(e="Mozilla",(this._userAgent.match(/MSIE/)||this._userAgent.match(/; Trident\/.*rv:[0-9]+/))&&(e="IE",(r=this._userAgent.match(/MSIE ([0-9]+)/))?(t=parseInt(r[1],10),(r=this._userAgent.match(/MSIE [0-9]+.*MSIE ([0-9]+)/))&&(t=parseInt(r[1],10))):(r=this._userAgent.match(/rv:([0-9]+)/))&&(t=parseInt(r[1],10)))),"Chrome"===e&&this._userAgent.match(/OPR\//)?(e="Opera",r=this._userAgent.match(/(OPR)\/([0-9]+)\./)):"Chrome"===e&&this._userAgent.match(/Edge\//)?(e="Edge",r=this._userAgent.match(/(Edge)\/([0-9]+)\./)):"Firefox"!==e&&"IE"!==e||!this._userAgent.match(/Opera/)?"Mozilla"===e&&this._userAgent.match(/iphone|ipod|ipad/i)&&(e="Safari",t=parseInt(s.get(this._userAgent.match(/OS\s([0-9]+)/),[1]),10),n=!0):(e="Opera",r=this._userAgent.match(/(Opera) ([0-9]+)\./)),"Chrome"===e&&(this._userAgent.match(/; wv/)||this._userAgent.match(/Android/)&&this._userAgent.match(/Version\/[0-9].[0-9]/))&&(n=!0),"IE"!==e&&r&&3<=r.length&&(t=parseInt(r[2],10)),"ReactNative"===navigator.product&&(e="ReactNative",t=navigator.productSub||"?"),{browser:e,version:t,isWebview:n}},e}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(1)],void 0===(n=function(e,t){"use strict";function i(e){t.isFunction(e,"cleanup"),this._cleanup=e}return i.prototype.dispose=function(){return this._cleanup.call()},i.prototype.toString=function(){return e.toString(this)},i}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0)],void 0===(n=function(i){"use strict";function e(){this._list=[]}return e.prototype.add=function(e){if(!e||!i.isFunction(e.dispose))throw new Error('"disposable" must be a disposable or implement dispose');this._list.push(e)},e.prototype.dispose=function(){var t=[];return i.forEach(this._list,function(e){t.push(e.dispose())}),this._list=[],t},e.prototype.toString=function(){return i.toString(this)},e}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(1),i(26)],void 0===(n=function(r,n,i){"use strict";function e(){this._events={}}return e.prototype.fire=function(e,t,i){n.isStringNotEmpty(e,"name"),r.includes(r.keys(this._events),e)&&this._events[e].fire(t,i)},e.prototype.fireAsync=function(e,t,i){n.isStringNotEmpty(e,"name"),r.includes(r.keys(this._events),e)&&this._events[e].fireAsync(t,i)},e.prototype.listen=function(e,t){return n.isStringNotEmpty(e,"name"),(r.includes(r.keys(this._events),e)?this._events[e]:this._events[e]=new i).listen(t)},e.prototype.size=function(e){return r.includes(r.keys(this._events),e)?this._events[e].size():0},e.prototype.dispose=function(){r.forOwn(this._events,function(e){e.dispose()}),this._events={}},e.prototype.toString=function(){return"NamedEvents|"+r.keys(this._events).length},e}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(1),i(3)],void 0===(n=function(f,a,m){"use strict";var o="GET",n="POST",s="PUT",l="DELETE",g=1,y=2,v=1500,b={clientAborted:{id:4e3,name:"Aborted by Client"}};function e(){}function u(e,t,i,r,n){d(r=r||{});var s=p(e,h(r.queryParameters||{},t)),o=f.bind(E,this,f.now(),n);if(!s)return n(_());r.responseType&&(s.responseType=r.responseType),w(s,r),s.addEventListener("readystatechange",f.bind(S,this,s,r,o)),s.timeout=r.timeout||15e3,s.send(i)}function c(e,t,i,r,n){var s=f.bind(e,this,t,i,r),o={startTime:f.now(),isDisposed:!1};return T.call(this,t,r,s,o,n)}function d(e){a.isObject(e,"settings"),e.queryParameters&&a.isObject(e.queryParameters,"settings.queryParameters"),e.mimeType&&a.stringNotEmpty(e.mimeType,"settings.mimeType"),e.accept&&a.stringNotEmpty(e.accept,"settings.accept"),e.contentType&&a.stringNotEmpty(e.contentType,"settings.contentType"),e.responseType&&a.stringNotEmpty(e.responseType,"settings.responseType"),f.isNullOrUndefined(e.timeout)||a.isNumber(e.timeout,"settings.timeout")}function h(e,t){var i=f.reduce(e,function(e,t,i){return(e+=e?"&":"?")+i.toString()+"="+t.toString()},"");return 0<i.length?t+i:t}function p(e,t){var i=new XMLHttpRequest;if("withCredentials"in i)i.open(e,t,!0);else{if("undefined"==typeof XDomainRequest)return;(i=new XDomainRequest).open(e,t)}return i}function _(){var e=new Error("unsupported");return e.code="unsupported",e}function w(i,e){var t=e.contentType||"application/json",r=e.accept||t,n=f.assign({},{"Content-Type":t,Accept:r},f.get(e,["headers"],{}));f.forOwn(n,function(e,t){i.setRequestHeader(t,e)})}function S(e,t,i){if(4===e.readyState)if(200===e.status){var r=(o=e.getAllResponseHeaders(),f.reduce(o.trim().split(/[\r\n]+/),function(e,t){var i=t.split(": "),r=i.shift(),n=i.join(": ");return r&&(e[r]=n),e},{}));i(null,{data:e.response||e.responseText,headers:r,rawXhr:e})}else{var n=new Error(0===e.status?"timeout":e.statusText),s=f.get(t,["retryOptions","additionalRetryErrorCodes"],[]);f.forEach(s,function(e){a.isNumber(e,"additionalRetryErrorCode")}),n.code=e.status,(500<=e.status&&e.status<600||f.includes(s,e.status))&&(n.retryable=!0),i(n)}var o}function E(e,t,i,r){r&&f.set(r,["stats","successResponseTime"],f.now()-e),t(i,r)}function T(i,r,n,s,o,a){a=a||1;var l=this,e=f.get(r,["delay"],null),t=f.get(r,["retryOptions","delay"],v),u=f.get(r,["retryOptions","backoff"],y),c=f.get(r,["retryOptions","maxAttempts"],g),d=1<a?t*Math.pow(a,u):e,h=function(e,t){return s.isDisposed?o(k(b.clientAborted)):e&&e.retryable&&a<c?T.call(l,i,r,n,s,o,a+1):function(e,t,i,r,n){n&&(f.set(n,["stats","totalResponseTimeForAllAttempts"],f.now()-e),f.set(n,["stats","attempts"],t)),i(r,n)}.call(l,s.startTime,a,o,e,t)},p=new m.Disposable(function(){f.isNumber(s.mostRecentTimeout)&&clearTimeout(s.mostRecentTimeout),s.isDisposed=!0});return!f.isNumber(e)&&1===a||f.get(r,["retryOptions","sync"],!1)?n.call(l,h):function(e,t,i,r,n,s){var o=this;r.mostRecentTimeout=setTimeout(function(){if(r.isDisposed)return s(k(b.clientAborted));i.call(o,s)},n)}.call(l,i,r,n,s,d,h),p}function k(e){var t=new Error(e.name);return t.code=e.id,t}return e.prototype.get=function(e,t,i){d(t=t||{});var r=h(t.queryParameters||{},e),n=p(o,r),s=f.bind(E,this,f.now(),i);if(!n)return i(_());t.mimeType&&n.overrideMimeType(t.mimeType),t.responseType&&(n.responseType=t.responseType),w(n,t),n.addEventListener("readystatechange",f.bind(S,this,n,t,s)),n.timeout=t.timeout||3e3,n.send()},e.prototype.post=function(e,t,i,r){return u.call(this,n,e,t,i,r)},e.prototype.put=function(e,t,i,r){return u.call(this,s,e,t,i,r)},e.prototype.delete=function(e,t,i,r){return u.call(this,l,e,t,i,r)},e.prototype.getWithRetry=function(e,t,i){var r=f.bind(this.get,this,e,t),n={startTime:f.now(),isDisposed:!1};return T.call(this,e,t,r,n,i)},e.prototype.postWithRetry=function(e,t,i,r){return c.call(this,this.post,e,t,i,r)},e.prototype.putWithRetry=function(e,t,i,r){return c.call(this,this.put,e,t,i,r)},e.prototype.deleteWithRetry=function(e,t,i,r){return c.call(this,this.delete,e,t,i,r)},new e}.apply(t,r))||(e.exports=n)},function(e,t,i){var r;void 0===(r=function(){"use strict";var a=function(){};a.get=function(e,t,i){if(a.isNullOrUndefined(e))return i;o(e,"objectToTraverse");var r=t;if(a.isString(r))r=c(t);else if(!a.isArray(r))throw new Error("Unsupported path type "+typeof t);var n=a.reduce(r,function(e,t){if(a.isObject(e)||a.isArray(e))return e[t]},e);return a.isUndefined(n)?i:n},a.set=function(e,t,i){if(!a.isObject(e))return e;o(e,"objectToTraverse");var r=e,n=t;if(a.isString(n))n=c(t);else if(!a.isArray(n))throw new Error("Unsupported path type "+typeof t);return a.forEach(n,function(e,t){!function(e,t,i){{if(a.isNumber(parseInt(t))&&a.isArray(e))return e[t]=i;if(a.isString(t)&&a.isObject(e))return e[t]=i}throw new Error("Unsupported type "+typeof t+" when setting property or index")}(r,e,function(e,t,i,r){if(e.length-1===t)return r;var n=e[t],s=e[t+1];if(a.isArray(i[n])||a.isObject(i[n]))return i[n];{if(!a.isArray(i[n])&&a.isNumber(parseInt(s)))return[];if(!a.isObject(i[n])&&a.isString(s))return{}}throw new Error("Unsupported type "+typeof n+" when setting property or index")}(n,t,r,i)),r=r[e]}),e},a.bind=function(t,i){var r=Array.prototype.slice.call(arguments,2);return function(){if(!a.isFunction(t))throw new TypeError("_.bind - callback must be a function");var e=r.concat(Array.prototype.slice.call(arguments));return t.apply(i,e)}},a.now=function(){return(new Date).getTime()},a.utc=function(e){return a.isNumber(e)?e:e?Math.floor(e):NaN},a.isoString=function(){var e=new Date;return e.toISOString?e.toISOString():e.getUTCFullYear()+"-"+a.pad(e.getUTCMonth()+1,2)+"-"+a.pad(e.getUTCDate(),2)+"T"+a.pad(e.getUTCHours(),2)+":"+a.pad(e.getUTCMinutes(),2)+":"+a.pad(e.getUTCSeconds(),2)+"."+(e.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"},a.map=function(e,i){o(e,"collection");var r=[];return e.constructor===Array?a.forEach(e,function(e,t){a.isString(i)&&a.isObject(e)?r.push(e[i]):a.isFunction(i)&&r.push(i(e,t))}):a.forOwn(e,function(e,t){a.isFunction(i)&&r.push(i(e,t))}),r},a.values=function(e){if(!a.isObject(e)||a.isArray(e))throw new Error("Collection must be an object.");return a.map(e,function(e){return e})},a.keys=function(e){if(!a.isObject(e)||a.isArray(e))throw new Error("Collection must be an object.");return a.map(e,function(e,t){return t})},a.forEach=function(e,t){if(!a.isFunction(t))throw new Error("Callback must be a function");s(e,"collection");for(var i=0;i<e.length;i++){if(!1===t(e[i],i))return}},a.forOwn=function(e,t){if(!a.isFunction(t))throw new Error("Callback must be a function");o(e,"objectWithProperties");for(var i=Object.keys(e),r=0;r<i.length;r++){var n=i[r];(e.hasOwnProperty(n)||Object.prototype.hasOwnProperty.call(e,n))&&t(e[n],n)}},a.argumentsToArray=function(e){if(!a.isObject(e)||!e.length)throw new Error("Collection must be arguments");for(var t=[],i=0;i<e.length;i++)t.push(e[i]);return t},a.assign=function(i){o(i,"target");var e=a.argumentsToArray(arguments);return e.shift(),a.forEach(e,function(e,t){o(e,"source "+t),a.forOwn(e,function(e,t){i[t]=e})}),i},a.includes=function(e,t){if(a.isString(e))return u(t,"Includes value and search parameter"),-1<e.indexOf(t);if(a.isUndefined(e)||a.isUndefined(t))return!1;o(e,"collection");var i=!1,r=function(e){e===t&&(i=!0)};return e.constructor===Array?a.forEach(e,r):a.forOwn(e,r),i},a.reduce=function(e,i,t){o(e,"collection");var r=t===a.noop()?null:t;return e.constructor===Array?a.forEach(e,function(e,t){r=i(r,e,t)}):a.forOwn(e,function(e,t){r=i(r,e,t)}),r},a.sample=function(e){return s(e,"collection"),e[Math.floor(Math.random()*e.length)]},a.uniqueId=function(){return(a.now()*Math.random()).toString()},a.find=function(e,i,r){var n;return s(e,"collection"),a.forEach(e,function(e,t){if(i(e)&&(r||0)<=t)return n=e}),n},a.findIndex=function(e,i,r){var n;return s(e,"collection"),a.forEach(e,function(e,t){if(i(e,t)&&(r||0)<=t)return n=t}),n},a.filter=function(e,t){s(e,"collection");var i=[];return a.forEach(e,function(e){t(e)&&i.push(e)}),i},a.remove=function(e,t){s(e,"collection");return a.filter(e,function(e){return!t(e)})},a.take=function(e,t){return s(e,"collection"),e.slice(0,t)},a.hasDifferences=function(e,t,i){return 0<a.findDifferences(e,t,i).length},a.findDifferences=function(i,r,n){var s=[],o={};function e(e,t){o[t]=1,(a.isObject(e)||a.isArray(e))&&n?a.hasIndexOrKey(r,t)&&a.sameTypes(i[t],r[t])?a.hasDifferences(i[t],r[t],n)&&s.push(t):s.push(t):i[t]!==r[t]&&s.push(t)}if(a.isArray(i)&&a.isArray(r))i.length>r.length?a.forEach(i,e):a.forEach(r,e);else{if(!a.isObject(i)||!a.isObject(r)||a.isArray(i)||a.isArray(r))throw new Error("Object types do not match");a.forOwn(i,e),a.forOwn(r,function(e,t){o.hasOwnProperty(t)||s.push(t)})}return s},a.hasIndexOrKey=function(e,t){return a.isArray(e)?e.length>parseInt(t):!!a.isObject(e)&&e.hasOwnProperty(t)},a.startsWith=function(e,t){return u(e,"value"),u(t,"prefix"),0===e.indexOf(t)},a.sameTypes=function(e,t){return a.isNullOrUndefined(e)||a.isNullOrUndefined(t)?a.isNullOrUndefined(e)&&a.isNullOrUndefined(t):a.isArray(e)||a.isArray(t)?a.isArray(e)&&a.isArray(t):typeof e==typeof t},a.freeze=function(e){return"freeze"in Object?Object.freeze(e):e},a.noop=function(){},a.isObject=function(e){return null!==e&&"object"==typeof e},a.isArray=function(e){return!!a.isObject(e)&&e.constructor===Array},a.isString=function(e){return"string"==typeof e},a.isNumber=function(e){return!isNaN(e)&&"number"==typeof e},a.isBoolean=function(e){return"boolean"==typeof e},a.isFunction=function(e){return"function"==typeof e},a.isNullOrUndefined=function(e){return null===e||a.isUndefined(e)},a.isUndefined=function(e){return void 0===e},a.getEnumName=function(e,t){var i=null,r=a.map(e,function(e){return e});return a.isNumber(t)?i=a.find(r,function(e){return e.id===t}):a.isString(t)&&(i=a.find(r,function(e){return e.name.toLowerCase()===t.toLowerCase()})),i?i.name:null},a.toString=function(e){if(a.isString(e))return e;if(a.isBoolean(e))return e?"true":"false";if(a.isNumber(e))return e.toString();var t="";if(e)if(a.isFunction(e.toString))t=e.toString();else if(a.isObject(e.toString))try{t=e.toString()}catch(e){t="[object invalid toString()]"}if(0!==t.indexOf("[object"))return t;var i=[];return t+JSON.stringify(e,function(e,t){if(a.isObject(t)&&!a.isNullOrUndefined(t)){if(a.includes(i,t))return"<recursive>";i.push(t)}return""===e?t:a.toString(t)})},a.pad=function(e,t){n(e,"value"),n(t,"numberToPad");for(var i=e.toString().length,r=0;r<t-i;r++)e="0"+e.toString();return e.toString()},a.addEventListener=function(e,t,i,r){o(e,"target"),u(t,"eventName"),l(i,"listener"),e.phenixAddEventListener?e.phenixAddEventListener.call(e,t,i,!!r):e.addEventListener?e.addEventListener(t,i,!!r):e.attachEvent&&e.attachEvent("on"+t,i)},a.removeEventListener=function(e,t,i,r){o(e,"target"),u(t,"eventName"),l(i,"listener"),e.phenixRemoveEventListener?e.phenixRemoveEventListener.call(e,t,i,!!r):e.removeEventListener?e.removeEventListener(t,i,!!r):e.detachEvent&&e.detachEvent("on"+t,i)};var s=function(e){if(!a.isArray(e))throw new Error("Input must be an array.")},n=function(e,t){if(u(t,"name"),!a.isNumber(e))throw new Error(t+" must be a number.")},o=function(e,t){if(u(t,"name"),!a.isObject(e))throw new Error("collection type not supported - "+t+" must be an array or object.")},l=function(e,t){if(u(t,"name"),!a.isFunction(e))throw new Error(t+" must be a function.")},u=function(e,t){if(!a.isString(t))throw new Error("Name must be a string.");if(!a.isString(e))throw new Error(t+" must be a string.")};function c(e){var t=e.split("."),i=[];return a.forEach(t,function(e){i=i.concat(function(e){for(var t="",i=[],r=0,n=0;n<e.length;n++)if("["===e[n]){if(r++,!a.isString(t)||1<r)return[e];t&&(i.push(t),t="")}else if("]"===e[n]){if(0!==--r)return[e];i.push(t),t=""}else{if(n===e.length-1)return[e];t+=e[n]}return i}(e))}),i}return a}.apply(t,[]))||(e.exports=r)},function(e,t,i){var r,n;r=[i(0),i(1),i(14)],void 0===(n=function(e,t,u){"use strict";function i(){this._minLevel=u.level.TRACE}i.prototype.setThreshold=function(e){t.isNumber(e,"level"),this._minLevel=e},i.prototype.getThreshold=function(){return this._minLevel},i.prototype.log=function(e,t,i,r,n,s,o,a,l){l.level<this._minLevel||(r[0]=e+" ["+i+"] "+t+" "+r[0],l.level>u.level.INFO?d(r):c(r))};var c=function(e){console.log.apply(console,e)},d=function(e){console.error.apply(console,e)};return i}.apply(t,r))||(e.exports=n)},function(i,r,n){(function(d){var e,t;e=[n(0),n(1),n(14)],void 0===(t=function(a,t,l){"use strict";var e=c().__phenixPageLoadTime||c().__pageLoadTime||a.now(),i="2018-05-15T23:23:03Z";function r(){this._appenders=[],this._userId=null,this._sessionId=null,this._environment="production",this._applicationVersion=i}function n(e){(this._sessionId=e)?this.info("Session started on websdk version [%s] ([%s]), user agent [%s]",i,"2018.2.4",navigator.userAgent):this.info("Websdk version [%s] ([%s]), user agent [%s]",i,"2018.2.4",navigator.userAgent)}function s(t,i){var r=(a.now()-e)/1e3,n=function(e){switch(e){case l.level.TRACE:return"Trace";case l.level.DEBUG:return"Debug";case l.level.INFO:return"Info";case l.level.WARN:return"Warn";case l.level.ERROR:return"Error";case l.level.FATAL:return"Fatal";default:throw new Error("Unsupported Logging Level "+e)}}(i.level),s=i.name||"websdk",o=this;a.forEach(this._appenders,function(e){try{e.log(r,n,s,u(Array.prototype.slice.call(t)),o._sessionId,o._userId,o._environment,o._applicationVersion,i)}catch(e){}})}r.prototype.trace=function(){return s.call(this,arguments,{level:l.level.TRACE})},r.prototype.debug=function(){return s.call(this,arguments,{level:l.level.DEBUG})},r.prototype.info=function(){return s.call(this,arguments,{level:l.level.INFO})},r.prototype.warn=function(){return s.call(this,arguments,{level:l.level.WARN})},r.prototype.error=function(){return s.call(this,arguments,{level:l.level.ERROR})},r.prototype.fatal=function(){return s.call(this,arguments,{level:l.level.FATAL})},r.prototype.addAppender=function(e){t.isObject(e,"appender"),t.isFunction(e.log,"appender.log"),this._appenders.push(e)},r.prototype.getAppenders=function(){return this._appenders},r.prototype.getUserId=function(){return this._userId},r.prototype.setUserId=function(e){this._userId=e},r.prototype.getEnvironment=function(){return this._environment},r.prototype.setEnvironment=function(e){this._environment=e},r.prototype.getApplicationVersion=function(){return this._applicationVersion},r.prototype.setApplicationVersion=function(e){this._applicationVersion=e},r.prototype.getObservableSessionId=function(){return this._observableSessionId},r.prototype.setObservableSessionId=function(e){this._observableSessionId=e,this._sessionIdSubscription&&this._sessionIdSubscription.dispose(),e&&(t.isObject(e,"observableSessionId"),this._sessionIdSubscription=this._observableSessionId.subscribe(a.bind(n,this),{initial:"notify"}))};var u=function(e){if(0!==e.length){var t=[],i=[];return a.forEach(e,function(e){t.push(a.toString(e)),e instanceof Error&&i.push(e.stack)}),o(t.concat(i))}},o=function(e){for(var t=e[0],i=0;t.indexOf&&1<e.length&&0<=i;){if(0<(i=t.indexOf("%",i)))switch(t.substring(i+1,i+2)){case"%":t=t.substring(0,i)+t.substring(i+1),i++;break;case"s":case"d":e[0]=t=t.substring(0,i)+e[1]+t.substring(i+2),e.splice(1,1);break;default:return e}}return e};function c(){return"object"==typeof window?window:"object"==typeof d?d:{}}return r}.apply(r,e))||(i.exports=t)}).call(r,n(73))},function(e,t,i){var r,n;r=[i(0),i(5),i(4),i(3)],void 0===(n=function(s,t,i,o){"use strict";function e(){var e="undefined"==typeof navigator||navigator.onLine;this._onlineObservable=new i.Observable(e).extend({timeout:0}),this._namedEvents=new t.NamedEvents,"undefined"!=typeof window&&(s.addEventListener(window,"online",s.bind(this._namedEvents.fire,this._namedEvents,"online",[])),s.addEventListener(window,"offline",s.bind(this._namedEvents.fire,this._namedEvents,"offline",[])),s.addEventListener(window,"unload",s.bind(this._namedEvents.dispose,this._namedEvents))),this._namedEvents.listen("online",s.bind(this._onlineObservable.setValue,this._onlineObservable,!0)),this._namedEvents.listen("offline",s.bind(this._onlineObservable.setValue,this._onlineObservable,!1))}function a(e,t){var i=this;if(this._onlineObservable.setValue(!1),!s.isNumber(t))return e(!1);i.offlineTimeout=setTimeout(function(){e&&!i._onlineObservable.getValue()&&e(!1)},t)}function l(e){this._onlineObservable.setValue(!0),e&&e(!0)}return e.prototype.listenForNetworkChange=function(e,t){var i=new o.DisposableList,r=s.bind(l,this,e),n=s.bind(a,this,e,t);return i.add(this._namedEvents.listen("online",r)),i.add(this._namedEvents.listen("offline",n)),i},e.prototype.isOnline=function(){return this._onlineObservable.getValue()},new e}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(1),i(28)],void 0===(n=function(n,r,s){"use strict";function e(e,t){var i=e;null==i&&(i=[]),r.isArray(i,"valuesToSet"),this.observableArray=new s(i,t)}return e.prototype.getValue=function(){return this.observableArray.getValue()},e.prototype.setValue=function(e){return null==e&&(e=[]),void 0!==e&&r.isArray(e,"values"),this.observableArray.setValue(e)},e.prototype.subscribe=function(e,t){return this.observableArray.subscribe(e,t)},e.prototype.push=function(e){var t=this.observableArray.getValue();t.push(e),this.observableArray.setValue(t)},e.prototype.pop=function(){var e=this.observableArray.getValue(),t=e.pop();return this.observableArray.setValue(e),t},e.prototype.remove=function(t){var e=this.observableArray.getValue(),i=function(e){return n.isFunction(t)?t(e):e===t},r=n.filter(e,i);return 0<r.length&&this.observableArray.setValue(n.remove(e,i)),r},e.prototype.removeAll=function(){var e=this.observableArray.getValue();return this.observableArray.setValue([]),e},e.prototype.extend=function(e){return this.observableArray.extend(e),this},e}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(1)],void 0===(n=function(i,t){"use strict";function e(e){t.isObject(e,"observable"),this._observable=e,this._listenerSubscription=null,this._isEnabled=!1}return e.prototype.start=function(e,t){this._isEnabled=!0,this._listenerSubscription=this._observable.subscribe(i.noop,{listenForChanges:{callback:e,timeout:t||500}})},e.prototype.stop=function(){this._isEnabled=!1,this._listenerSubscription&&this._listenerSubscription.dispose(),this._listenerSubscription=null},e.prototype.isEnabled=function(){return this._isEnabled},e}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(1),i(52),i(30),i(12)],void 0===(n=function(a,l,u,c,r){function d(e,t,i){return e.encode(t,i).toBinary()}function h(e,t,i){return e.decode(t+"Response",r.fromBinary(i))}return function(e,t,i,r,n){l.isStringNotEmpty(e,"uri"),l.isArray(t,"protocols"),l.isStringNotEmpty(i,"type"),l.isObject(r,"options");var s=a.assign({},r||{},{contentType:"application/protobuf"}),o=new c(t,n);return new u(e,s,a.bind(d,this,o,i),a.bind(h,this,o,i))}}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(1),i(5),i(70),i(31)],void 0===(n=function(n,s,o,a,l){"use strict";function e(e,t,i,r){s.isStringNotEmpty(e,"uri"),s.isObject(t,"logger"),s.isArray(i,"protocols"),this._uri=e,this._logger=t,this._logger.info("Connecting to [%s]",e),this._webSocket=new a(this._uri,this._logger),this._mqService=new l(this._logger,n.bind(m,this),n.bind(f,this),i,r),this._namedEvents=new o.NamedEvents,this._webSocket.onconnected=n.bind(c,this),this._webSocket.onreconnecting=n.bind(u,this),this._webSocket.onreconnected=n.bind(d,this),this._webSocket.ondisconnected=n.bind(h,this),this._webSocket.onerror=n.bind(p,this),this._disconnected=!1}function t(e,t){this._namedEvents.fire(e,t,this)}function u(e){t.call(this,"reconnecting")}function c(e){t.call(this,"connected")}function d(e){t.call(this,"reconnected")}function h(e){t.call(this,"disconnected",[e.code,e.reason]),this._disconnected&&(this._namedEvents.dispose(),this._mqService.dispose())}function p(e){t.call(this,"error",[e.data])}function f(e){this._webSocket.onmessage=e}function m(e){this._webSocket&&this._webSocket.send(e)}return e.prototype.onEvent=function(e,t){return this._namedEvents.listen(e,t),this._mqService.onEvent(e,t)},e.prototype.onRequest=function(e,t){return this._mqService.onRequest(e,t)},e.prototype.sendRequest=function(e,t,i,r){return this._mqService.sendRequest(e,t,i,r)},e.prototype.sendResponse=function(e,t,i,r){return this._mqService.sendResponse(e,t,i,r)},e.prototype.disconnect=function(){return this._disconnected=!0,this._webSocket.disconnect()},e.prototype.disposeOfPendingRequests=function(){return this._logger.info("Disposing of pending MQ WebSocket requests"),this._mqService.disposeOfRequests()},e.prototype.getApiVersion=function(){return this._mqService.getApiVersion()},e.prototype.toString=function(){return"MQWebSocket["+this._webSocket.toString()+"]"},e}.apply(t,r))||(e.exports=n)},function(e,t,i){var r;void 0===(r=function(){"use strict";return{package:"mq",messages:[{name:"Message",fields:[{rule:"optional",type:"MessageType",name:"messageType",id:7,options:{default:"Request"}},{rule:"optional",type:"string",name:"sessionId",id:1},{rule:"optional",type:"string",name:"requestId",id:2},{rule:"required",type:"string",name:"type",id:3},{rule:"optional",type:"string",name:"encoding",id:4},{rule:"required",type:"bytes",name:"payload",id:5},{rule:"repeated",type:"double",name:"wallTime",id:6}],enums:[{name:"MessageType",values:[{name:"Request",id:0},{name:"Response",id:1},{name:"Event",id:2}]}]},{name:"Error",fields:[{rule:"required",type:"string",name:"reason",id:1}]},{name:"PingPong",fields:[{rule:"required",type:"uint64",name:"originTimestamp",id:1},{rule:"optional",type:"uint64",name:"count",id:2}]}]}}.apply(t,[]))||(e.exports=r)},function(e,t,i){var r,n;r=[i(0),i(1),i(27)],void 0===(n=function(s,o,a){"use strict";var l=15e3,u=1e3,c={byebye:{code:1e3,reason:"byebye",desc:"Client closed"},backoffLimitReached:{code:4e3,reason:"backoff-limit-reached",desc:"Reached the limit in terms of the number of reconnects"},networkDisconnect:{code:4001,reason:"network-disconnect",desc:"Network connection monitor determined loss to internet connectivity"},reconnecting:{code:4002,reason:"reconnecting",desc:"Closing WebSocket in order to attempt to establish another connection"}},d={connecting:{code:0,state:"CONNECTING",desc:"The connection is not yet open"},open:{code:1,state:"OPEN",desc:"The connection is open and ready to communicate"},closing:{code:2,state:"CLOSING",desc:"The connection is in the process of closing"},closed:{code:3,state:"CLOSED",desc:"The connection is closed or could not be opened"}};function e(e,t,i,r){o.isStringNotEmpty(e,"uri"),o.isObject(t,"logger"),s.isNullOrUndefined(i)?i=4:o.isNumber(i,"maxReconnectAttempts"),this._uri=e,this._logger=t,this._maxReconnectAttempts=i,this._reconnectBackoffInterval=r||1e3,this._hasAttemptedReconnect=!1,this._stopped=!1,this._queuedMessages=[],this._connectionState="connecting",this._logger.info("Connecting WebSocket to [%s]",e),this._webSocket=h.call(this,m,p);var n=this;this._disconnectTimeoutId=null,this._networkConnectionMonitorDisposable=a.listenForNetworkChange(function(e){if(e)return s.isNumber(n._disconnectTimeoutId)&&(clearTimeout(n._disconnectTimeoutId),n._disconnectTimeoutId=null),function(){var e=this;setTimeout(function(){return e._stopped?e._logger.info("Unable to go back online after network reconnect. Client has stopped WebSocket."):e._webSocket.readyState!==d.open.code?(e._logger.info("Network Reconnected. Attempting to reconnect WebSocket."),e.reconnect()):e._didGoOfflineDueToDisconnect?(e._logger.info("Network Reconnected with WebSocket status of [%s].",d.open.state),m.call(e)):("online"===e._connectionState&&"reconnected"===this._connectionState||g.call(e),void e._logger.info("Network Reconnected."))},u)}.call(n);s.isNumber(n._disconnectTimeoutId)||(f.call(n),n._disconnectTimeoutId=setTimeout(function(){return function(){this._logger.warn("Network not reconnected after [%s]. Going Offline and disconnecting WebSocket connection.",l),this._didGoOfflineDueToDisconnect=!0,y.call(this,c.networkDisconnect)}.call(n)},l))},0)}function r(e){return this._webSocket.readyState===d.closed.code?p.call(this,e):this._webSocket.close(e.code,e.reason)}function h(e,t){var i=new WebSocket(this._uri);return i.onopen=s.bind(e,this),i.onclose=s.bind(t,this),i.onmessage=s.bind(b,this),i.onerror=s.bind(v,this),i}function n(e){this._webSocket.readyState!==d.open.code&&this.reconnect(e+1)}function p(e){switch(e.code){case c.reconnecting.code:return;case c.byebye.code:case c.backoffLimitReached.code:case c.networkDisconnect.code:return y.call(this,e);default:if(this._hasAttemptedReconnect)return;return f.call(this,e),this._logger.info("Attempting to re-establish socket connection after disconnect event with code [%s] and reason [%s]",e.code,e.reason),this.reconnect()}}function f(e){this._logger.info("WebSocket is reconnecting"),this._connectionState="reconnecting",this.onreconnecting&&this.onreconnecting(e)}function m(e){this._logger.info("WebSocket Connected"),function(){var e=this._queuedMessages.length;if(0===e)return;this._logger.info("Sending [%s] queued messages",e);for(;0<e;){e--;var t=this._queuedMessages.shift();this.send(t)}}.call(this),this._connectionState="connected",this.onconnected&&this.onconnected(e)}function g(e){this._logger.info("Successfully reconnected to WebSocket"),this._connectionState="reconnected",this.onreconnected&&this.onreconnected(e)}function y(e){this._logger.info("WebSocket Disconnected [%s]: [%s]",e.code,e.reason),this._connectionState="disconnected",this.ondisconnected&&this.ondisconnected(e)}function v(e){this._logger.error("An error occurred on the WebSocket connection [%s]",e.data||e),this.onerror&&this.onerror(e)}function b(e){this._logger.debug(">> [%s]",e.data),this.onmessage&&this.onmessage(e)}return e.prototype.onmessage=null,e.prototype.onconnected=null,e.prototype.onreconnecting=null,e.prototype.onreconnected=null,e.prototype.ondisconnected=null,e.prototype.onerror=null,e.prototype.send=function(e){return a.isOnline(),this._webSocket.send(e)},e.prototype.reconnect=function(e){this._webSocket.onclose=null,this._webSocket.onerror=null,this._hasAttemptedReconnect=!0;var t,i=this;if(s.isNumber(e)||(e=1),this._stopped)return this._logger.info("Client has stopped WebSocket after [%s] reconnect attempts",e-1);if(e>this._maxReconnectAttempts)return this._logger.warn("Unable to reconnect WebSocket after [%s] attempts",this._maxReconnectAttempts),r.call(this,c.backoffLimitReached);r.call(this,c.reconnecting);try{this._webSocket=h.call(i,function(){return t&&clearTimeout(t),i._hasAttemptedReconnect=!1,i._webSocket.onclose=s.bind(p,i),g.call(i)},function(){e+1>i._maxReconnectAttempts&&(t&&clearTimeout(t),n.call(i,e))})}catch(e){this._logger.warn("Unable to create WebSocket connection [%s]",e)}t=function(e){var t=this;return setTimeout(function(){n.call(t,e)},e*e*this._reconnectBackoffInterval)}.call(this,e)},e.prototype.disconnect=function(){return this._networkConnectionMonitorDisposable.dispose(),this._stopped=!0,s.isNumber(this._disconnectTimeoutId)&&(clearTimeout(this._disconnectTimeoutId),this._disconnectTimeoutId=null),this._webSocket.close(c.byebye.code,c.byebye.reason)},e.prototype.toString=function(){return"ReconnectedWebSocket["+this._uri+","+this._webSocket.readyState+"]"},e}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(69)],void 0===(n=function(e){"use strict";return e}.apply(t,r))||(e.exports=n)},function(e,t){var i,r,n=e.exports={};function s(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(t){if(i===setTimeout)return setTimeout(t,0);if((i===s||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:s}catch(e){i=s}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(e){r=o}}();var l,u=[],c=!1,d=-1;function h(){c&&l&&(c=!1,l.length?u=l.concat(u):d=-1,u.length&&p())}function p(){if(!c){var e=a(h);c=!0;for(var t=u.length;t;){for(l=u,u=[];++d<t;)l&&l[d].run();d=-1,t=u.length}l=null,c=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function m(){}n.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];u.push(new f(e,t)),1!==u.length||c||a(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=m,n.addListener=m,n.once=m,n.off=m,n.removeListener=m,n.removeAllListeners=m,n.emit=m,n.prependListener=m,n.prependOnceListener=m,n.listeners=function(e){return[]},n.binding=function(e){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},function(s,o,h){(function(r){var e,t,i,n;n=function(w,e){"use strict";var n,d,t,o,a,i,s={};return s.ByteBuffer=w,s.Long=w.Long||null,s.VERSION="5.0.0",s.WIRE_TYPES={},s.WIRE_TYPES.VARINT=0,s.WIRE_TYPES.BITS64=1,s.WIRE_TYPES.LDELIM=2,s.WIRE_TYPES.STARTGROUP=3,s.WIRE_TYPES.ENDGROUP=4,s.WIRE_TYPES.BITS32=5,s.PACKABLE_WIRE_TYPES=[s.WIRE_TYPES.VARINT,s.WIRE_TYPES.BITS64,s.WIRE_TYPES.BITS32],s.TYPES={int32:{name:"int32",wireType:s.WIRE_TYPES.VARINT,defaultValue:0},uint32:{name:"uint32",wireType:s.WIRE_TYPES.VARINT,defaultValue:0},sint32:{name:"sint32",wireType:s.WIRE_TYPES.VARINT,defaultValue:0},int64:{name:"int64",wireType:s.WIRE_TYPES.VARINT,defaultValue:s.Long?s.Long.ZERO:void 0},uint64:{name:"uint64",wireType:s.WIRE_TYPES.VARINT,defaultValue:s.Long?s.Long.UZERO:void 0},sint64:{name:"sint64",wireType:s.WIRE_TYPES.VARINT,defaultValue:s.Long?s.Long.ZERO:void 0},bool:{name:"bool",wireType:s.WIRE_TYPES.VARINT,defaultValue:!1},double:{name:"double",wireType:s.WIRE_TYPES.BITS64,defaultValue:0},string:{name:"string",wireType:s.WIRE_TYPES.LDELIM,defaultValue:""},bytes:{name:"bytes",wireType:s.WIRE_TYPES.LDELIM,defaultValue:null},fixed32:{name:"fixed32",wireType:s.WIRE_TYPES.BITS32,defaultValue:0},sfixed32:{name:"sfixed32",wireType:s.WIRE_TYPES.BITS32,defaultValue:0},fixed64:{name:"fixed64",wireType:s.WIRE_TYPES.BITS64,defaultValue:s.Long?s.Long.UZERO:void 0},sfixed64:{name:"sfixed64",wireType:s.WIRE_TYPES.BITS64,defaultValue:s.Long?s.Long.ZERO:void 0},float:{name:"float",wireType:s.WIRE_TYPES.BITS32,defaultValue:0},enum:{name:"enum",wireType:s.WIRE_TYPES.VARINT,defaultValue:0},message:{name:"message",wireType:s.WIRE_TYPES.LDELIM,defaultValue:null},group:{name:"group",wireType:s.WIRE_TYPES.STARTGROUP,defaultValue:null}},s.MAP_KEY_TYPES=[s.TYPES.int32,s.TYPES.sint32,s.TYPES.sfixed32,s.TYPES.uint32,s.TYPES.fixed32,s.TYPES.int64,s.TYPES.sint64,s.TYPES.sfixed64,s.TYPES.uint64,s.TYPES.fixed64,s.TYPES.bool,s.TYPES.string,s.TYPES.bytes],s.ID_MIN=1,s.ID_MAX=536870911,s.convertFieldsToCamelCase=!1,s.populateAccessors=!0,s.populateDefaults=!0,s.Util=((n={}).IS_NODE=!("object"!=typeof r||r+""!="[object process]"||r.browser),n.XHR=function(){for(var e=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],t=null,i=0;i<e.length;i++){try{t=e[i]()}catch(e){continue}break}if(!t)throw Error("XMLHttpRequest is not supported");return t},n.fetch=function(e,i){if(i&&"function"!=typeof i&&(i=null),n.IS_NODE){var t=h(104);if(i)t.readFile(e,function(e,t){i(e?null:""+t)});else try{return t.readFileSync(e)}catch(e){return null}}else{var r=n.XHR();if(r.open("GET",e,!!i),r.setRequestHeader("Accept","text/plain"),"function"==typeof r.overrideMimeType&&r.overrideMimeType("text/plain"),!i)return r.send(null),200==r.status||0==r.status&&"string"==typeof r.responseText?r.responseText:null;if(r.onreadystatechange=function(){4==r.readyState&&(200==r.status||0==r.status&&"string"==typeof r.responseText?i(r.responseText):i(null))},4==r.readyState)return;r.send(null)}},n.toCamelCase=function(e){return e.replace(/_([a-zA-Z])/g,function(e,t){return t.toUpperCase()})},n),s.Lang={DELIM:/[\s\{\}=;:\[\],'"\(\)<>]/g,RULE:/^(?:required|optional|repeated|map)$/,TYPE:/^(?:double|float|int32|uint32|sint32|int64|uint64|sint64|fixed32|sfixed32|fixed64|sfixed64|bool|string|bytes)$/,NAME:/^[a-zA-Z_][a-zA-Z_0-9]*$/,TYPEDEF:/^[a-zA-Z][a-zA-Z_0-9]*$/,TYPEREF:/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)+$/,FQTYPEREF:/^(?:\.[a-zA-Z][a-zA-Z_0-9]*)+$/,NUMBER:/^-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+|([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?)|inf|nan)$/,NUMBER_DEC:/^(?:[1-9][0-9]*|0)$/,NUMBER_HEX:/^0[xX][0-9a-fA-F]+$/,NUMBER_OCT:/^0[0-7]+$/,NUMBER_FLT:/^([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?|inf|nan)$/,BOOL:/^(?:true|false)$/i,ID:/^(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,NEGID:/^\-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,WHITESPACE:/\s/,STRING:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")|(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,STRING_DQ:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,STRING_SQ:/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g},s.DotProto=function(r,o){var e={},t=function(e){this.source=e+"",this.index=0,this.line=1,this.stack=[],this._stringOpen=null},i=t.prototype;i._readString=function(){var e='"'===this._stringOpen?o.STRING_DQ:o.STRING_SQ;e.lastIndex=this.index-1;var t=e.exec(this.source);if(!t)throw Error("unterminated string");return this.index=e.lastIndex,this.stack.push(this._stringOpen),this._stringOpen=null,t[1]},i.next=function(){if(0<this.stack.length)return this.stack.shift();if(this.index>=this.source.length)return null;if(null!==this._stringOpen)return this._readString();var e,t,i;do{for(e=!1;o.WHITESPACE.test(i=this.source.charAt(this.index));)if("\n"===i&&++this.line,++this.index===this.source.length)return null;if("/"===this.source.charAt(this.index))if(++this.index,"/"===this.source.charAt(this.index)){for(;"\n"!==this.source.charAt(++this.index);)if(this.index==this.source.length)return null;++this.index,++this.line,e=!0}else{if("*"!==(i=this.source.charAt(this.index)))return"/";do{if("\n"===i&&++this.line,++this.index===this.source.length)return null;t=i,i=this.source.charAt(this.index)}while("*"!==t||"/"!==i);++this.index,e=!0}}while(e);if(this.index===this.source.length)return null;var r=this.index;if(o.DELIM.lastIndex=0,!o.DELIM.test(this.source.charAt(r++)))for(;r<this.source.length&&!o.DELIM.test(this.source.charAt(r));)++r;var n=this.source.substring(this.index,this.index=r);return'"'!==n&&"'"!==n||(this._stringOpen=n),n},i.peek=function(){if(0===this.stack.length){var e=this.next();if(null===e)return null;this.stack.push(e)}return this.stack[0]},i.skip=function(e){var t=this.next();if(t!==e)throw Error("illegal '"+t+"', '"+e+"' expected")},i.omit=function(e){return this.peek()===e&&(this.next(),!0)},i.toString=function(){return"Tokenizer ("+this.index+"/"+this.source.length+" at line "+this.line+")"},e.Tokenizer=t;var n=function(e){this.tn=new t(e),this.proto3=!1},s=n.prototype;function a(e,t){var i=-1,r=1;if("-"==e.charAt(0)&&(r=-1,e=e.substring(1)),o.NUMBER_DEC.test(e))i=parseInt(e);else if(o.NUMBER_HEX.test(e))i=parseInt(e.substring(2),16);else{if(!o.NUMBER_OCT.test(e))throw Error("illegal id value: "+(r<0?"-":"")+e);i=parseInt(e.substring(1),8)}if(i=r*i|0,!t&&i<0)throw Error("illegal id value: "+(r<0?"-":"")+e);return i}function l(e){var t=1;if("-"==e.charAt(0)&&(t=-1,e=e.substring(1)),o.NUMBER_DEC.test(e))return t*parseInt(e,10);if(o.NUMBER_HEX.test(e))return t*parseInt(e.substring(2),16);if(o.NUMBER_OCT.test(e))return t*parseInt(e.substring(1),8);if("inf"===e)return t*(1/0);if("nan"===e)return NaN;if(o.NUMBER_FLT.test(e))return t*parseFloat(e);throw Error("illegal number value: "+(t<0?"-":"")+e)}function u(e,t,i){void 0===e[t]?e[t]=i:(Array.isArray(e[t])||(e[t]=[e[t]]),e[t].push(i))}return s.parse=function(){var e,t={name:"[ROOT]",package:null,messages:[],enums:[],imports:[],options:{},services:[]},i=!0;try{for(;e=this.tn.next();)switch(e){case"package":if(!i||null!==t.package)throw Error("unexpected 'package'");if(e=this.tn.next(),!o.TYPEREF.test(e))throw Error("illegal package name: "+e);this.tn.skip(";"),t.package=e;break;case"import":if(!i)throw Error("unexpected 'import'");"public"===(e=this.tn.peek())&&this.tn.next(),e=this._readString(),this.tn.skip(";"),t.imports.push(e);break;case"syntax":if(!i)throw Error("unexpected 'syntax'");this.tn.skip("="),"proto3"===(t.syntax=this._readString())&&(this.proto3=!0),this.tn.skip(";");break;case"message":this._parseMessage(t,null),i=!1;break;case"enum":this._parseEnum(t),i=!1;break;case"option":this._parseOption(t);break;case"service":this._parseService(t);break;case"extend":this._parseExtend(t);break;default:throw Error("unexpected '"+e+"'")}}catch(e){throw e.message="Parse error at line "+this.tn.line+": "+e.message,e}return delete t.name,t},n.parse=function(e){return new n(e).parse()},s._readString=function(){var e,t,i="";do{if("'"!==(t=this.tn.next())&&'"'!==t)throw Error("illegal string delimiter: "+t);i+=this.tn.next(),this.tn.skip(t),e=this.tn.peek()}while('"'===e||'"'===e);return i},s._readValue=function(e){var t=this.tn.peek();if('"'===t||"'"===t)return this._readString();if(this.tn.next(),o.NUMBER.test(t))return l(t);if(o.BOOL.test(t))return"true"===t.toLowerCase();if(e&&o.TYPEREF.test(t))return t;throw Error("illegal value: "+t)},s._parseOption=function(e,t){var i=this.tn.next(),r=!1;if("("===i&&(r=!0,i=this.tn.next()),!o.TYPEREF.test(i))throw Error("illegal option name: "+i);var n=i;r&&(this.tn.skip(")"),n="("+n+")",i=this.tn.peek(),o.FQTYPEREF.test(i)&&(n+=i,this.tn.next())),this.tn.skip("="),this._parseOptionValue(e,n),t||this.tn.skip(";")},s._parseOptionValue=function(e,t){var i=this.tn.peek();if("{"!==i)u(e.options,t,this._readValue(!0));else for(this.tn.skip("{");"}"!==(i=this.tn.next());){if(!o.NAME.test(i))throw Error("illegal option name: "+t+"."+i);this.tn.omit(":")?u(e.options,t+"."+i,this._readValue(!0)):this._parseOptionValue(e,t+"."+i)}},s._parseService=function(e){var t=this.tn.next();if(!o.NAME.test(t))throw Error("illegal service name at line "+this.tn.line+": "+t);var i={name:t,rpc:{},options:{}};for(this.tn.skip("{");"}"!==(t=this.tn.next());)if("option"===t)this._parseOption(i);else{if("rpc"!==t)throw Error("illegal service token: "+t);this._parseServiceRPC(i)}this.tn.omit(";"),e.services.push(i)},s._parseServiceRPC=function(e){var t=this.tn.next();if(!o.NAME.test(t))throw Error("illegal rpc service method name: "+t);var i=t,r={request:null,response:null,request_stream:!1,response_stream:!1,options:{}};if(this.tn.skip("("),"stream"===(t=this.tn.next()).toLowerCase()&&(r.request_stream=!0,t=this.tn.next()),!o.TYPEREF.test(t))throw Error("illegal rpc service request type: "+t);if(r.request=t,this.tn.skip(")"),"returns"!==(t=this.tn.next()).toLowerCase())throw Error("illegal rpc service request type delimiter: "+t);if(this.tn.skip("("),"stream"===(t=this.tn.next()).toLowerCase()&&(r.response_stream=!0,t=this.tn.next()),r.response=t,this.tn.skip(")"),"{"===(t=this.tn.peek())){for(this.tn.next();"}"!==(t=this.tn.next());){if("option"!==t)throw Error("illegal rpc service token: "+t);this._parseOption(r)}this.tn.omit(";")}else this.tn.skip(";");void 0===e.rpc&&(e.rpc={}),e.rpc[i]=r},s._parseMessage=function(e,t){var i=!!t,r=this.tn.next(),n={name:"",fields:[],enums:[],messages:[],options:{},services:[],oneofs:{}};if(!o.NAME.test(r))throw Error("illegal "+(i?"group":"message")+" name: "+r);for(n.name=r,i&&(this.tn.skip("="),t.id=a(this.tn.next()),n.isGroup=!0),"["===(r=this.tn.peek())&&t&&this._parseFieldOptions(t),this.tn.skip("{");"}"!==(r=this.tn.next());)if(o.RULE.test(r))this._parseMessageField(n,r);else if("oneof"===r)this._parseMessageOneOf(n);else if("enum"===r)this._parseEnum(n);else if("message"===r)this._parseMessage(n);else if("option"===r)this._parseOption(n);else if("service"===r)this._parseService(n);else if("extensions"===r)this._parseExtensions(n);else if("extend"===r)this._parseExtend(n);else if("reserved"===r)this._parseMessageReserved(n);else{if(!o.TYPEREF.test(r))throw Error("illegal message token: "+r);if(!this.proto3)throw Error("illegal field rule: "+r);this._parseMessageField(n,"optional",r)}return this.tn.omit(";"),e.messages.push(n),n},s._parseMessageReserved=function(e){for(;";"!==this.tn.peek();)this.tn.next();this.tn.skip(";")},s._parseMessageField=function(e,t,i){if(!o.RULE.test(t))throw Error("illegal message field rule: "+t);var r,n={rule:t,type:"",name:"",options:{},id:0};if("map"===t){if(i)throw Error("illegal type: "+i);if(this.tn.skip("<"),r=this.tn.next(),!o.TYPE.test(r)&&!o.TYPEREF.test(r))throw Error("illegal message field type: "+r);if(n.keytype=r,this.tn.skip(","),r=this.tn.next(),!o.TYPE.test(r)&&!o.TYPEREF.test(r))throw Error("illegal message field: "+r);if(n.type=r,this.tn.skip(">"),r=this.tn.next(),!o.NAME.test(r))throw Error("illegal message field name: "+r);n.name=r,this.tn.skip("="),n.id=a(this.tn.next()),"["===(r=this.tn.peek())&&this._parseFieldOptions(n),this.tn.skip(";")}else if("group"===(i=void 0!==i?i:this.tn.next())){var s=this._parseMessage(e,n);if(!/^[A-Z]/.test(s.name))throw Error("illegal group name: "+s.name);n.type=s.name,n.name=s.name.toLowerCase(),this.tn.omit(";")}else{if(!o.TYPE.test(i)&&!o.TYPEREF.test(i))throw Error("illegal message field type: "+i);if(n.type=i,r=this.tn.next(),!o.NAME.test(r))throw Error("illegal message field name: "+r);n.name=r,this.tn.skip("="),n.id=a(this.tn.next()),"["===(r=this.tn.peek())&&this._parseFieldOptions(n),this.tn.skip(";")}return e.fields.push(n),n},s._parseMessageOneOf=function(e){var t=this.tn.next();if(!o.NAME.test(t))throw Error("illegal oneof name: "+t);var i,r=t,n=[];for(this.tn.skip("{");"}"!==(t=this.tn.next());)(i=this._parseMessageField(e,"optional",t)).oneof=r,n.push(i.id);this.tn.omit(";"),e.oneofs[r]=n},s._parseFieldOptions=function(e){this.tn.skip("[");for(var t=!0;"]"!==this.tn.peek();)t||this.tn.skip(","),this._parseOption(e,!0),t=!1;this.tn.next()},s._parseEnum=function(e){var t={name:"",values:[],options:{}},i=this.tn.next();if(!o.NAME.test(i))throw Error("illegal name: "+i);for(t.name=i,this.tn.skip("{");"}"!==(i=this.tn.next());)if("option"===i)this._parseOption(t);else{if(!o.NAME.test(i))throw Error("illegal name: "+i);this.tn.skip("=");var r={name:i,id:a(this.tn.next(),!0)};"["===(i=this.tn.peek())&&this._parseFieldOptions({options:{}}),this.tn.skip(";"),t.values.push(r)}this.tn.omit(";"),e.enums.push(t)},s._parseExtensions=function(e){var t=this.tn.next(),i=[];"min"===t?i.push(r.ID_MIN):"max"===t?i.push(r.ID_MAX):i.push(l(t)),this.tn.skip("to"),"min"===(t=this.tn.next())?i.push(r.ID_MIN):"max"===t?i.push(r.ID_MAX):i.push(l(t)),this.tn.skip(";"),e.extensions=i},s._parseExtend=function(e){var t=this.tn.next();if(!o.TYPEREF.test(t))throw Error("illegal extend reference: "+t);var i={ref:t,fields:[]};for(this.tn.skip("{");"}"!==(t=this.tn.next());)if(o.RULE.test(t))this._parseMessageField(i,t);else{if(!o.TYPEREF.test(t))throw Error("illegal extend token: "+t);if(!this.proto3)throw Error("illegal field rule: "+t);this._parseMessageField(i,"optional",t)}return this.tn.omit(";"),e.messages.push(i),i},s.toString=function(){return"Parser at line "+this.tn.line},e.Parser=n,e}(s,s.Lang),s.Reflect=function(m){var o={},c=function(e,t,i){this.builder=e,this.parent=t,this.name=i,this.className},e=c.prototype;e.fqn=function(){for(var e=this.name,t=this;;){if(null==(t=t.parent))break;e=t.name+"."+e}return e},e.toString=function(e){return(e?this.className+" ":"")+this.fqn()},e.build=function(){throw Error(this.toString(!0)+" cannot be built directly")},o.T=c;var a=function(e,t,i,r,n){c.call(this,e,t,i),this.className="Namespace",this.children=[],this.options=r||{},this.syntax=n||"proto2"},t=a.prototype=Object.create(c.prototype);t.getChildren=function(e){if(null==(e=e||null))return this.children.slice();for(var t=[],i=0,r=this.children.length;i<r;++i)this.children[i]instanceof e&&t.push(this.children[i]);return t},t.addChild=function(e){var t;if(t=this.getChild(e.name))if(t instanceof h.Field&&t.name!==t.originalName&&null===this.getChild(t.originalName))t.name=t.originalName;else{if(!(e instanceof h.Field&&e.name!==e.originalName&&null===this.getChild(e.originalName)))throw Error("Duplicate name in namespace "+this.toString(!0)+": "+e.name);e.name=e.originalName}this.children.push(e)},t.getChild=function(e){for(var t="number"==typeof e?"id":"name",i=0,r=this.children.length;i<r;++i)if(this.children[i][t]===e)return this.children[i];return null},t.resolve=function(e,t){var i,r="string"==typeof e?e.split("."):e,n=this,s=0;if(""===r[s]){for(;null!==n.parent;)n=n.parent;s++}do{do{if(!(n instanceof o.Namespace)){n=null;break}if(!(i=n.getChild(r[s]))||!(i instanceof o.T)||t&&!(i instanceof o.Namespace)){n=null;break}n=i,s++}while(s<r.length);if(null!=n)break;if(null!==this.parent)return this.parent.resolve(e,t)}while(null!=n);return n},t.qn=function(e){for(var t=[],i=e;t.unshift(i.name),null!==(i=i.parent););for(var r=1;r<=t.length;r++){var n=t.slice(t.length-r);if(e===this.resolve(n,e instanceof o.Namespace))return n.join(".")}return e.fqn()},t.build=function(){for(var e,t={},i=this.children,r=0,n=i.length;r<n;++r)(e=i[r])instanceof a&&(t[e.name]=e.build());return Object.defineProperty&&Object.defineProperty(t,"$options",{value:this.buildOpt()}),t},t.buildOpt=function(){for(var e={},t=Object.keys(this.options),i=0,r=t.length;i<r;++i){var n=t[i],s=this.options[t[i]];e[n]=s}return e},t.getOption=function(e){return void 0===e?this.options:void 0!==this.options[e]?this.options[e]:null},o.Namespace=a;var d=function(e,t,i,r){if(this.type=e,this.resolvedType=t,this.isMapKey=i,this.syntax=r,i&&m.MAP_KEY_TYPES.indexOf(e)<0)throw Error("Invalid map key type: "+e.name)},i=d.prototype;function s(e,t){if(e&&"number"==typeof e.low&&"number"==typeof e.high&&"boolean"==typeof e.unsigned&&e.low==e.low&&e.high==e.high)return new m.Long(e.low,e.high,void 0===t?e.unsigned:t);if("string"==typeof e)return m.Long.fromString(e,t||!1,10);if("number"==typeof e)return m.Long.fromNumber(e,t||!1);throw Error("not convertible to Long")}d.defaultFieldValue=function(e){if("string"==typeof e&&(e=m.TYPES[e]),void 0===e.defaultValue)throw Error("default value for type "+e.name+" is not supported");return e==m.TYPES.bytes?new w(0):e.defaultValue},i.verifyValue=function(t){var i=function(e,t){throw Error("Illegal value for "+this.toString(!0)+" of type "+this.type.name+": "+e+" ("+t+")")}.bind(this);switch(this.type){case m.TYPES.int32:case m.TYPES.sint32:case m.TYPES.sfixed32:return("number"!=typeof t||t==t&&t%1!=0)&&i(typeof t,"not an integer"),4294967295<t?0|t:t;case m.TYPES.uint32:case m.TYPES.fixed32:return("number"!=typeof t||t==t&&t%1!=0)&&i(typeof t,"not an integer"),t<0?t>>>0:t;case m.TYPES.int64:case m.TYPES.sint64:case m.TYPES.sfixed64:if(m.Long)try{return s(t,!1)}catch(e){i(typeof t,e.message)}else i(typeof t,"requires Long.js");case m.TYPES.uint64:case m.TYPES.fixed64:if(m.Long)try{return s(t,!0)}catch(e){i(typeof t,e.message)}else i(typeof t,"requires Long.js");case m.TYPES.bool:return"boolean"!=typeof t&&i(typeof t,"not a boolean"),t;case m.TYPES.float:case m.TYPES.double:return"number"!=typeof t&&i(typeof t,"not a number"),t;case m.TYPES.string:return"string"==typeof t||t&&t instanceof String||i(typeof t,"not a string"),""+t;case m.TYPES.bytes:return w.isByteBuffer(t)?t:w.wrap(t,"base64");case m.TYPES.enum:var e=this.resolvedType.getChildren(m.Reflect.Enum.Value);for(n=0;n<e.length;n++){if(e[n].name==t)return e[n].id;if(e[n].id==t)return e[n].id}if("proto3"===this.syntax)return("number"!=typeof t||t==t&&t%1!=0)&&i(typeof t,"not an integer"),(4294967295<t||t<0)&&i(typeof t,"not in range for uint32"),t;i(t,"not a valid enum value");case m.TYPES.group:case m.TYPES.message:if(t&&"object"==typeof t||i(typeof t,"object expected"),t instanceof this.resolvedType.clazz)return t;if(t instanceof m.Builder.Message){var r={};for(var n in t)t.hasOwnProperty(n)&&(r[n]=t[n]);t=r}return new this.resolvedType.clazz(t)}throw Error("[INTERNAL] Illegal value for "+this.toString(!0)+": "+t+" (undefined type "+this.type+")")},i.calculateLength=function(e,t){if(null===t)return 0;var i;switch(this.type){case m.TYPES.int32:return t<0?w.calculateVarint64(t):w.calculateVarint32(t);case m.TYPES.uint32:return w.calculateVarint32(t);case m.TYPES.sint32:return w.calculateVarint32(w.zigZagEncode32(t));case m.TYPES.fixed32:case m.TYPES.sfixed32:case m.TYPES.float:return 4;case m.TYPES.int64:case m.TYPES.uint64:return w.calculateVarint64(t);case m.TYPES.sint64:return w.calculateVarint64(w.zigZagEncode64(t));case m.TYPES.fixed64:case m.TYPES.sfixed64:return 8;case m.TYPES.bool:return 1;case m.TYPES.enum:return w.calculateVarint32(t);case m.TYPES.double:return 8;case m.TYPES.string:return i=w.calculateUTF8Bytes(t),w.calculateVarint32(i)+i;case m.TYPES.bytes:if(t.remaining()<0)throw Error("Illegal value for "+this.toString(!0)+": "+t.remaining()+" bytes remaining");return w.calculateVarint32(t.remaining())+t.remaining();case m.TYPES.message:return i=this.resolvedType.calculate(t),w.calculateVarint32(i)+i;case m.TYPES.group:return(i=this.resolvedType.calculate(t))+w.calculateVarint32(e<<3|m.WIRE_TYPES.ENDGROUP)}throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+t+" (unknown type)")},i.encodeValue=function(e,t,i){if(null===t)return i;switch(this.type){case m.TYPES.int32:t<0?i.writeVarint64(t):i.writeVarint32(t);break;case m.TYPES.uint32:i.writeVarint32(t);break;case m.TYPES.sint32:i.writeVarint32ZigZag(t);break;case m.TYPES.fixed32:i.writeUint32(t);break;case m.TYPES.sfixed32:i.writeInt32(t);break;case m.TYPES.int64:case m.TYPES.uint64:i.writeVarint64(t);break;case m.TYPES.sint64:i.writeVarint64ZigZag(t);break;case m.TYPES.fixed64:i.writeUint64(t);break;case m.TYPES.sfixed64:i.writeInt64(t);break;case m.TYPES.bool:"string"==typeof t?i.writeVarint32("false"===t.toLowerCase()?0:!!t):i.writeVarint32(t?1:0);break;case m.TYPES.enum:i.writeVarint32(t);break;case m.TYPES.float:i.writeFloat32(t);break;case m.TYPES.double:i.writeFloat64(t);break;case m.TYPES.string:i.writeVString(t);break;case m.TYPES.bytes:if(t.remaining()<0)throw Error("Illegal value for "+this.toString(!0)+": "+t.remaining()+" bytes remaining");var r=t.offset;i.writeVarint32(t.remaining()),i.append(t),t.offset=r;break;case m.TYPES.message:var n=(new w).LE();this.resolvedType.encode(t,n),i.writeVarint32(n.offset),i.append(n.flip());break;case m.TYPES.group:this.resolvedType.encode(t,i),i.writeVarint32(e<<3|m.WIRE_TYPES.ENDGROUP);break;default:throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+t+" (unknown type)")}return i},i.decode=function(e,t,i){if(t!=this.type.wireType)throw Error("Unexpected wire type for element");var r,n;switch(this.type){case m.TYPES.int32:return 0|e.readVarint32();case m.TYPES.uint32:return e.readVarint32()>>>0;case m.TYPES.sint32:return 0|e.readVarint32ZigZag();case m.TYPES.fixed32:return e.readUint32()>>>0;case m.TYPES.sfixed32:return 0|e.readInt32();case m.TYPES.int64:return e.readVarint64();case m.TYPES.uint64:return e.readVarint64().toUnsigned();case m.TYPES.sint64:return e.readVarint64ZigZag();case m.TYPES.fixed64:return e.readUint64();case m.TYPES.sfixed64:return e.readInt64();case m.TYPES.bool:return!!e.readVarint32();case m.TYPES.enum:return e.readVarint32();case m.TYPES.float:return e.readFloat();case m.TYPES.double:return e.readDouble();case m.TYPES.string:return e.readVString();case m.TYPES.bytes:if(n=e.readVarint32(),e.remaining()<n)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+n+" required but got only "+e.remaining());return(r=e.clone()).limit=r.offset+n,e.offset+=n,r;case m.TYPES.message:return n=e.readVarint32(),this.resolvedType.decode(e,n);case m.TYPES.group:return this.resolvedType.decode(e,-1,i)}throw Error("[INTERNAL] Illegal decode type")},i.valueFromString=function(e){if(!this.isMapKey)throw Error("valueFromString() called on non-map-key element");switch(this.type){case m.TYPES.int32:case m.TYPES.sint32:case m.TYPES.sfixed32:case m.TYPES.uint32:case m.TYPES.fixed32:return this.verifyValue(parseInt(e));case m.TYPES.int64:case m.TYPES.sint64:case m.TYPES.sfixed64:case m.TYPES.uint64:case m.TYPES.fixed64:return this.verifyValue(e);case m.TYPES.bool:return"true"===e;case m.TYPES.string:return this.verifyValue(e);case m.TYPES.bytes:return w.fromBinary(e)}},i.valueToString=function(e){if(!this.isMapKey)throw Error("valueToString() called on non-map-key element");return this.type===m.TYPES.bytes?e.toString("binary"):e.toString()},o.Element=d;var h=function(e,t,i,r,n,s){a.call(this,e,t,i,r,s),this.className="Message",this.extensions=[m.ID_MIN,m.ID_MAX],this.clazz=null,this.isGroup=!!n,this._fields=null,this._fieldsById=null,this._fieldsByName=null},r=h.prototype=Object.create(a.prototype);function g(e,t){var i=t.readVarint32(),r=7&i,n=i>>>3;switch(r){case m.WIRE_TYPES.VARINT:for(;128==(128&(i=t.readUint8())););break;case m.WIRE_TYPES.BITS64:t.offset+=8;break;case m.WIRE_TYPES.LDELIM:i=t.readVarint32(),t.offset+=i;break;case m.WIRE_TYPES.STARTGROUP:g(n,t);break;case m.WIRE_TYPES.ENDGROUP:if(n===e)return!1;throw Error("Illegal GROUPEND after unknown group: "+n+" ("+e+" expected)");case m.WIRE_TYPES.BITS32:t.offset+=4;break;default:throw Error("Illegal wire type in unknown group "+e+": "+r)}return!0}r.build=function(e){if(this.clazz&&!e)return this.clazz;var t=function(d,o){var a=o.getChildren(d.Reflect.Message.Field),l=o.getChildren(d.Reflect.Message.OneOf),u=function(e,t){d.Builder.Message.call(this);for(var i=0,r=l.length;i<r;++i)this[l[i].name]=null;for(i=0,r=a.length;i<r;++i){var n=a[i];this[n.name]=n.repeated?[]:n.map?new d.Map(n):null,!n.required&&"proto3"!==o.syntax||null===n.defaultValue||(this[n.name]=n.defaultValue)}var s;if(0<arguments.length)if(1!==arguments.length||null===e||"object"!=typeof e||!("function"!=typeof e.encode||e instanceof u)||Array.isArray(e)||e instanceof d.Map||w.isByteBuffer(e)||e instanceof ArrayBuffer||d.Long&&e instanceof d.Long)for(i=0,r=arguments.length;i<r;++i)void 0!==(s=arguments[i])&&this.$set(a[i].name,s);else this.$set(e)},s=u.prototype=Object.create(d.Builder.Message.prototype);s.add=function(e,t,i){var r=o._fieldsByName[e];if(!i){if(!r)throw Error(this+"#"+e+" is undefined");if(!(r instanceof d.Reflect.Message.Field))throw Error(this+"#"+e+" is not a field: "+r.toString(!0));if(!r.repeated)throw Error(this+"#"+e+" is not a repeated field");t=r.verifyValue(t,!0)}return null===this[e]&&(this[e]=[]),this[e].push(t),this},s.$add=s.add,s.set=function(e,t,i){if(e&&"object"==typeof e){for(var r in i=t,e)e.hasOwnProperty(r)&&void 0!==(t=e[r])&&this.$set(r,t,i);return this}var n=o._fieldsByName[e];if(i)this[e]=t;else{if(!n)throw Error(this+"#"+e+" is not a field: undefined");if(!(n instanceof d.Reflect.Message.Field))throw Error(this+"#"+e+" is not a field: "+n.toString(!0));this[n.name]=t=n.verifyValue(t)}if(n&&n.oneof){var s=this[n.oneof.name];null!==t?(null!==s&&s!==n.name&&(this[s]=null),this[n.oneof.name]=n.name):s===e&&(this[n.oneof.name]=null)}return this},s.$set=s.set,s.get=function(e,t){if(t)return this[e];var i=o._fieldsByName[e];if(!(i&&i instanceof d.Reflect.Message.Field))throw Error(this+"#"+e+" is not a field: undefined");if(!(i instanceof d.Reflect.Message.Field))throw Error(this+"#"+e+" is not a field: "+i.toString(!0));return this[i.name]},s.$get=s.get;for(var e=0;e<a.length;e++){var t=a[e];t instanceof d.Reflect.Message.ExtensionField||o.builder.options.populateAccessors&&function(i){var e=i.originalName.replace(/(_[a-zA-Z])/g,function(e){return e.toUpperCase().replace("_","")});e=e.substring(0,1).toUpperCase()+e.substring(1);var t=i.originalName.replace(/([A-Z])/g,function(e){return"_"+e}),r=function(e,t){return this[i.name]=t?e:i.verifyValue(e),this},n=function(){return this[i.name]};null===o.getChild("set"+e)&&(s["set"+e]=r),null===o.getChild("set_"+t)&&(s["set_"+t]=r),null===o.getChild("get"+e)&&(s["get"+e]=n),null===o.getChild("get_"+t)&&(s["get_"+t]=n)}(t)}function h(e,i,r,n){if(null===e||"object"!=typeof e){if(n&&n instanceof d.Reflect.Enum){var t=d.Reflect.Enum.getName(n.object,e);if(null!==t)return t}return e}if(w.isByteBuffer(e))return i?e.toBase64():e.toBuffer();if(d.Long.isLong(e))return r?e.toString():d.Long.fromValue(e);var s;if(Array.isArray(e))return s=[],e.forEach(function(e,t){s[t]=h(e,i,r,n)}),s;if(s={},e instanceof d.Map){for(var o=e.entries(),a=o.next();!a.done;a=o.next())s[e.keyElem.valueToString(a.value[0])]=h(a.value[1],i,r,e.valueElem.resolvedType);return s}var l=e.$type,u=void 0;for(var c in e)e.hasOwnProperty(c)&&(l&&(u=l.getChild(c))?s[c]=h(e[c],i,r,u.resolvedType):s[c]=h(e[c],i,r));return s}return s.encode=function(t,e){"boolean"==typeof t&&(e=t,t=void 0);var i=!1;t||(t=new w,i=!0);var r=t.littleEndian;try{return o.encode(this,t.LE(),e),(i?t.flip():t).LE(r)}catch(e){throw t.LE(r),e}},u.encode=function(e,t,i){return new u(e).encode(t,i)},s.calculate=function(){return o.calculate(this)},s.encodeDelimited=function(e){var t=!1;e||(e=new w,t=!0);var i=(new w).LE();return o.encode(this,i).flip(),e.writeVarint32(i.remaining()),e.append(i),t?e.flip():e},s.encodeAB=function(){try{return this.encode().toArrayBuffer()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toArrayBuffer()),e}},s.toArrayBuffer=s.encodeAB,s.encodeNB=function(){try{return this.encode().toBuffer()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toBuffer()),e}},s.toBuffer=s.encodeNB,s.encode64=function(){try{return this.encode().toBase64()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toBase64()),e}},s.toBase64=s.encode64,s.encodeHex=function(){try{return this.encode().toHex()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toHex()),e}},s.toHex=s.encodeHex,s.toRaw=function(e,t){return h(this,!!e,!!t,this.$type)},s.encodeJSON=function(){return JSON.stringify(h(this,!0,!0,this.$type))},u.decode=function(t,e){"string"==typeof t&&(t=w.wrap(t,e||"base64"));var i=(t=w.isByteBuffer(t)?t:w.wrap(t)).littleEndian;try{var r=o.decode(t.LE());return t.LE(i),r}catch(e){throw t.LE(i),e}},u.decodeDelimited=function(t,e){if("string"==typeof t&&(t=w.wrap(t,e||"base64")),(t=w.isByteBuffer(t)?t:w.wrap(t)).remaining()<1)return null;var i=t.offset,r=t.readVarint32();if(t.remaining()<r)return t.offset=i,null;try{var n=o.decode(t.slice(t.offset,t.offset+r).LE());return t.offset+=r,n}catch(e){throw t.offset+=r,e}},u.decode64=function(e){return u.decode(e,"base64")},u.decodeHex=function(e){return u.decode(e,"hex")},u.decodeJSON=function(e){return new u(JSON.parse(e))},s.toString=function(){return o.toString()},Object.defineProperty&&(Object.defineProperty(u,"$options",{value:o.buildOpt()}),Object.defineProperty(s,"$options",{value:u.$options}),Object.defineProperty(u,"$type",{value:o}),Object.defineProperty(s,"$type",{value:o})),u}(m,this);this._fields=[],this._fieldsById={},this._fieldsByName={};for(var i,r=0,n=this.children.length;r<n;r++)if((i=this.children[r])instanceof p||i instanceof h||i instanceof v){if(t.hasOwnProperty(i.name))throw Error("Illegal reflect child of "+this.toString(!0)+": "+i.toString(!0)+" cannot override static property '"+i.name+"'");t[i.name]=i.build()}else if(i instanceof h.Field)i.build(),this._fields.push(i),this._fieldsById[i.id]=i,this._fieldsByName[i.name]=i;else if(!(i instanceof h.OneOf||i instanceof y))throw Error("Illegal reflect child of "+this.toString(!0)+": "+this.children[r].toString(!0));return this.clazz=t},r.encode=function(e,t,i){for(var r,n,s=null,o=0,a=this._fields.length;o<a;++o)n=e[(r=this._fields[o]).name],r.required&&null===n?null===s&&(s=r):r.encode(i?n:r.verifyValue(n),t,e);if(null!==s){var l=Error("Missing at least one required field for "+this.toString(!0)+": "+s);throw l.encoded=t,l}return t},r.calculate=function(e){for(var t,i,r=0,n=0,s=this._fields.length;n<s;++n){if(i=e[(t=this._fields[n]).name],t.required&&null===i)throw Error("Missing at least one required field for "+this.toString(!0)+": "+t);r+=t.calculate(i,e)}return r},r.decode=function(e,t,i){t="number"==typeof t?t:-1;for(var r,n,s,o,a=e.offset,l=new this.clazz;e.offset<a+t||-1===t&&0<e.remaining();){if(s=(r=e.readVarint32())>>>3,(n=7&r)===m.WIRE_TYPES.ENDGROUP){if(s!==i)throw Error("Illegal group end indicator for "+this.toString(!0)+": "+s+" ("+(i?i+" expected":"not a group")+")");break}if(o=this._fieldsById[s]){if(o.repeated&&!o.options.packed)l[o.name].push(o.decode(n,e));else if(o.map){var u=o.decode(n,e);l[o.name].set(u[0],u[1])}else if(l[o.name]=o.decode(n,e),o.oneof){var c=l[o.oneof.name];null!==c&&c!==o.name&&(l[c]=null),l[o.oneof.name]=o.name}}else switch(n){case m.WIRE_TYPES.VARINT:e.readVarint32();break;case m.WIRE_TYPES.BITS32:e.offset+=4;break;case m.WIRE_TYPES.BITS64:e.offset+=8;break;case m.WIRE_TYPES.LDELIM:var d=e.readVarint32();e.offset+=d;break;case m.WIRE_TYPES.STARTGROUP:for(;g(s,e););break;default:throw Error("Illegal wire type for unknown field "+s+" in "+this.toString(!0)+"#decode: "+n)}}for(var h=0,p=this._fields.length;h<p;++h)if(null===l[(o=this._fields[h]).name])if("proto3"===this.syntax)l[o.name]=o.defaultValue;else{if(o.required){var f=Error("Missing at least one required field for "+this.toString(!0)+": "+o.name);throw f.decoded=l,f}m.populateDefaults&&null!==o.defaultValue&&(l[o.name]=o.defaultValue)}return l},o.Message=h;var l=function(e,t,i,r,n,s,o,a,l,u){c.call(this,e,t,s),this.className="Message.Field",this.required="required"===i,this.repeated="repeated"===i,this.map="map"===i,this.keyType=r||null,this.type=n,this.resolvedType=null,this.id=o,this.options=a||{},this.defaultValue=null,this.oneof=l||null,this.syntax=u||"proto2",this.originalName=this.name,this.element=null,this.keyElement=null,!this.builder.options.convertFieldsToCamelCase||this instanceof h.ExtensionField||(this.name=m.Util.toCamelCase(this.name))},n=l.prototype=Object.create(c.prototype);n.build=function(){this.element=new d(this.type,this.resolvedType,!1,this.syntax),this.map&&(this.keyElement=new d(this.keyType,void 0,!0,this.syntax)),"proto3"!==this.syntax||this.repeated||this.map?void 0!==this.options.default&&(this.defaultValue=this.verifyValue(this.options.default)):this.defaultValue=d.defaultFieldValue(this.type)},n.verifyValue=function(e,t){t=t||!1;var i,r=function(e,t){throw Error("Illegal value for "+this.toString(!0)+" of type "+this.type.name+": "+e+" ("+t+")")}.bind(this);if(null===e)return this.required&&r(typeof e,"required"),"proto3"===this.syntax&&this.type!==m.TYPES.message&&r(typeof e,"proto3 field without field presence cannot be null"),null;if(this.repeated&&!t){Array.isArray(e)||(e=[e]);var n=[];for(i=0;i<e.length;i++)n.push(this.element.verifyValue(e[i]));return n}return this.map&&!t?e instanceof m.Map?e:(e instanceof Object||r(typeof e,"expected ProtoBuf.Map or raw object for map field"),new m.Map(this,e)):(!this.repeated&&Array.isArray(e)&&r(typeof e,"no array expected"),this.element.verifyValue(e))},n.hasWirePresence=function(e,t){if("proto3"!==this.syntax)return null!==e;if(this.oneof&&t[this.oneof.name]===this.name)return!0;switch(this.type){case m.TYPES.int32:case m.TYPES.sint32:case m.TYPES.sfixed32:case m.TYPES.uint32:case m.TYPES.fixed32:return 0!==e;case m.TYPES.int64:case m.TYPES.sint64:case m.TYPES.sfixed64:case m.TYPES.uint64:case m.TYPES.fixed64:return 0!==e.low||0!==e.high;case m.TYPES.bool:return e;case m.TYPES.float:case m.TYPES.double:return 0!==e;case m.TYPES.string:return 0<e.length;case m.TYPES.bytes:return 0<e.remaining();case m.TYPES.enum:return 0!==e;case m.TYPES.message:return null!==e;default:return!0}},n.encode=function(t,n,e){if(null===this.type||"object"!=typeof this.type)throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===t||this.repeated&&0==t.length)return n;try{var i;if(this.repeated)if(this.options.packed&&0<=m.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)){n.writeVarint32(this.id<<3|m.WIRE_TYPES.LDELIM),n.ensureCapacity(n.offset+=1);var r=n.offset;for(i=0;i<t.length;i++)this.element.encodeValue(this.id,t[i],n);var s=n.offset-r,o=w.calculateVarint32(s);if(1<o){var a=n.slice(r,n.offset);r+=o-1,n.offset=r,n.append(a)}n.writeVarint32(s,r-o)}else for(i=0;i<t.length;i++)n.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,t[i],n);else this.map?t.forEach(function(e,t,i){var r=w.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,t)+w.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,e);n.writeVarint32(this.id<<3|m.WIRE_TYPES.LDELIM),n.writeVarint32(r),n.writeVarint32(8|this.keyType.wireType),this.keyElement.encodeValue(1,t,n),n.writeVarint32(16|this.type.wireType),this.element.encodeValue(2,e,n)},this):this.hasWirePresence(t,e)&&(n.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,t,n))}catch(e){throw Error("Illegal value for "+this.toString(!0)+": "+t+" ("+e+")")}return n},n.calculate=function(t,e){if(t=this.verifyValue(t),null===this.type||"object"!=typeof this.type)throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===t||this.repeated&&0==t.length)return 0;var n=0;try{var i,r;if(this.repeated)if(this.options.packed&&0<=m.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)){for(n+=w.calculateVarint32(this.id<<3|m.WIRE_TYPES.LDELIM),i=r=0;i<t.length;i++)r+=this.element.calculateLength(this.id,t[i]);n+=w.calculateVarint32(r),n+=r}else for(i=0;i<t.length;i++)n+=w.calculateVarint32(this.id<<3|this.type.wireType),n+=this.element.calculateLength(this.id,t[i]);else this.map?t.forEach(function(e,t,i){var r=w.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,t)+w.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,e);n+=w.calculateVarint32(this.id<<3|m.WIRE_TYPES.LDELIM),n+=w.calculateVarint32(r),n+=r},this):this.hasWirePresence(t,e)&&(n+=w.calculateVarint32(this.id<<3|this.type.wireType),n+=this.element.calculateLength(this.id,t))}catch(e){throw Error("Illegal value for "+this.toString(!0)+": "+t+" ("+e+")")}return n},n.decode=function(e,t,i){var r,n;if(!(!this.map&&e==this.type.wireType||!i&&this.repeated&&this.options.packed&&e==m.WIRE_TYPES.LDELIM||this.map&&e==m.WIRE_TYPES.LDELIM))throw Error("Illegal wire type for field "+this.toString(!0)+": "+e+" ("+this.type.wireType+" expected)");if(e==m.WIRE_TYPES.LDELIM&&this.repeated&&this.options.packed&&0<=m.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)&&!i){n=t.readVarint32(),n=t.offset+n;for(var s=[];t.offset<n;)s.push(this.decode(this.type.wireType,t,!0));return s}if(this.map){var o=d.defaultFieldValue(this.keyType);if(r=d.defaultFieldValue(this.type),n=t.readVarint32(),t.remaining()<n)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+n+" required but got only "+t.remaining());var a=t.clone();for(a.limit=a.offset+n,t.offset+=n;0<a.remaining();){var l=a.readVarint32();e=7&l;var u=l>>>3;if(1===u)o=this.keyElement.decode(a,e,u);else{if(2!==u)throw Error("Unexpected tag in map field key/value submessage");r=this.element.decode(a,e,u)}}return[o,r]}return this.element.decode(t,e,this.id)},o.Message.Field=l;var u=function(e,t,i,r,n,s,o){l.call(this,e,t,i,null,r,n,s,o),this.extension};u.prototype=Object.create(l.prototype),o.Message.ExtensionField=u;o.Message.OneOf=function(e,t,i){c.call(this,e,t,i),this.fields=[]};var p=function(e,t,i,r,n){a.call(this,e,t,i,r,n),this.className="Enum",this.object=null};p.getName=function(e,t){for(var i,r=Object.keys(e),n=0;n<r.length;++n)if(e[i=r[n]]===t)return i;return null},(p.prototype=Object.create(a.prototype)).build=function(e){if(this.object&&!e)return this.object;for(var t=new m.Builder.Enum,i=this.getChildren(p.Value),r=0,n=i.length;r<n;++r)t[i[r].name]=i[r].id;return Object.defineProperty&&Object.defineProperty(t,"$options",{value:this.buildOpt(),enumerable:!1}),this.object=t},o.Enum=p;var f=function(e,t,i,r){c.call(this,e,t,i),this.className="Enum.Value",this.id=r};f.prototype=Object.create(c.prototype),o.Enum.Value=f;var y=function(e,t,i,r){c.call(this,e,t,i),this.field=r};y.prototype=Object.create(c.prototype),o.Extension=y;var v=function(e,t,i,r){a.call(this,e,t,i,r),this.className="Service",this.clazz=null};(v.prototype=Object.create(a.prototype)).build=function(e){return this.clazz&&!e?this.clazz:this.clazz=function(t,n){for(var s=function(e){t.Builder.Service.call(this),this.rpcImpl=e||function(e,t,i){setTimeout(i.bind(this,Error("Not implemented, see: https://github.com/dcodeIO/ProtoBuf.js/wiki/Services")),0)}},e=s.prototype=Object.create(t.Builder.Service.prototype),i=n.getChildren(t.Reflect.Service.RPCMethod),r=0;r<i.length;r++)!function(r){e[r.name]=function(e,i){try{try{e=r.resolvedRequestType.clazz.decode(w.wrap(e))}catch(e){if(!(e instanceof TypeError))throw e}if(null===e||"object"!=typeof e)throw Error("Illegal arguments");e instanceof r.resolvedRequestType.clazz||(e=new r.resolvedRequestType.clazz(e)),this.rpcImpl(r.fqn(),e,function(e,t){if(e)i(e);else{try{t=r.resolvedResponseType.clazz.decode(t)}catch(e){}t&&t instanceof r.resolvedResponseType.clazz?i(null,t):i(Error("Illegal response type received in service method "+n.name+"#"+r.name))}})}catch(e){setTimeout(i.bind(this,e),0)}},s[r.name]=function(e,t,i){new s(e)[r.name](t,i)},Object.defineProperty&&(Object.defineProperty(s[r.name],"$options",{value:r.buildOpt()}),Object.defineProperty(e[r.name],"$options",{value:s[r.name].$options}))}(i[r]);return Object.defineProperty&&(Object.defineProperty(s,"$options",{value:n.buildOpt()}),Object.defineProperty(e,"$options",{value:s.$options}),Object.defineProperty(s,"$type",{value:n}),Object.defineProperty(e,"$type",{value:n})),s}(m,this)},o.Service=v;var b=function(e,t,i,r){c.call(this,e,t,i),this.className="Service.Method",this.options=r||{}};(b.prototype=Object.create(c.prototype)).buildOpt=t.buildOpt,o.Service.Method=b;var _=function(e,t,i,r,n,s,o,a){b.call(this,e,t,i,a),this.className="Service.RPCMethod",this.requestName=r,this.responseName=n,this.requestStream=s,this.responseStream=o,this.resolvedRequestType=null,this.resolvedResponseType=null};return _.prototype=Object.create(b.prototype),o.Service.RPCMethod=_,o}(s),s.Builder=(t=(d=s).Lang,o=s.Reflect,i=(a=function(e){this.ns=new o.Namespace(this,null,""),this.ptr=this.ns,this.resolved=!1,this.result=null,this.files={},this.importRoot=null,this.options=e||{}}).prototype,a.isMessage=function(e){return"string"==typeof e.name&&void 0===e.values&&void 0===e.rpc},a.isMessageField=function(e){return"string"==typeof e.rule&&"string"==typeof e.name&&"string"==typeof e.type&&void 0!==e.id},a.isEnum=function(e){return"string"==typeof e.name&&!(void 0===e.values||!Array.isArray(e.values)||0===e.values.length)},a.isService=function(e){return!("string"!=typeof e.name||"object"!=typeof e.rpc||!e.rpc)},a.isExtend=function(e){return"string"==typeof e.ref},i.reset=function(){return this.ptr=this.ns,this},i.define=function(e){if("string"!=typeof e||!t.TYPEREF.test(e))throw Error("illegal namespace: "+e);return e.split(".").forEach(function(e){var t=this.ptr.getChild(e);null===t&&this.ptr.addChild(t=new o.Namespace(this,this.ptr,e)),this.ptr=t},this),this},i.create=function(e){if(!e)return this;if(Array.isArray(e)){if(0===e.length)return this;e=e.slice()}else e=[e];for(var t=[e];0<t.length;){if(e=t.pop(),!Array.isArray(e))throw Error("not a valid namespace: "+JSON.stringify(e));for(;0<e.length;){var i=e.shift();if(a.isMessage(i)){var n=new o.Message(this,this.ptr,i.name,i.options,i.isGroup,i.syntax),r={};i.oneofs&&Object.keys(i.oneofs).forEach(function(e){n.addChild(r[e]=new o.Message.OneOf(this,n,e))},this),i.fields&&i.fields.forEach(function(e){if(null!==n.getChild(0|e.id))throw Error("duplicate or invalid field id in "+n.name+": "+e.id);if(e.options&&"object"!=typeof e.options)throw Error("illegal field options in "+n.name+"#"+e.name);var t=null;if("string"==typeof e.oneof&&!(t=r[e.oneof]))throw Error("illegal oneof in "+n.name+"#"+e.name+": "+e.oneof);e=new o.Message.Field(this,n,e.rule,e.keytype,e.type,e.name,e.id,e.options,t,i.syntax),t&&t.fields.push(e),n.addChild(e)},this);var s=[];if(i.enums&&i.enums.forEach(function(e){s.push(e)}),i.messages&&i.messages.forEach(function(e){s.push(e)}),i.services&&i.services.forEach(function(e){s.push(e)}),i.extensions&&(n.extensions=i.extensions,n.extensions[0]<d.ID_MIN&&(n.extensions[0]=d.ID_MIN),n.extensions[1]>d.ID_MAX&&(n.extensions[1]=d.ID_MAX)),this.ptr.addChild(n),0<s.length){t.push(e),e=s,s=null,this.ptr=n,n=null;continue}s=null}else if(a.isEnum(i))n=new o.Enum(this,this.ptr,i.name,i.options,i.syntax),i.values.forEach(function(e){n.addChild(new o.Enum.Value(this,n,e.name,e.id))},this),this.ptr.addChild(n);else if(a.isService(i))n=new o.Service(this,this.ptr,i.name,i.options),Object.keys(i.rpc).forEach(function(e){var t=i.rpc[e];n.addChild(new o.Service.RPCMethod(this,n,e,t.request,t.response,!!t.request_stream,!!t.response_stream,t.options))},this),this.ptr.addChild(n);else{if(!a.isExtend(i))throw Error("not a valid definition: "+JSON.stringify(i));if(n=this.ptr.resolve(i.ref,!0))i.fields.forEach(function(e){if(null!==n.getChild(0|e.id))throw Error("duplicate extended field id in "+n.name+": "+e.id);if(e.id<n.extensions[0]||e.id>n.extensions[1])throw Error("illegal extended field id in "+n.name+": "+e.id+" ("+n.extensions.join(" to ")+" expected)");var t=e.name;this.options.convertFieldsToCamelCase&&(t=d.Util.toCamelCase(t));var i=new o.Message.ExtensionField(this,n,e.rule,e.type,this.ptr.fqn()+"."+t,e.id,e.options),r=new o.Extension(this,this.ptr,e.name,i);i.extension=r,this.ptr.addChild(r),n.addChild(i)},this);else if(!/\.?google\.protobuf\./.test(i.ref))throw Error("extended message "+i.ref+" is not defined")}n=i=null}e=null,this.ptr=this.ptr.parent}return this.resolved=!1,this.result=null,this},i.import=function(t,e){var i="/";if("string"==typeof e){if(d.Util.IS_NODE&&(e=h(44).resolve(e)),!0===this.files[e])return this.reset();this.files[e]=!0}else if("object"==typeof e){var r=e.root;d.Util.IS_NODE&&(r=h(44).resolve(r)),(0<=r.indexOf("\\")||0<=e.file.indexOf("\\"))&&(i="\\");var n=r+i+e.file;if(!0===this.files[n])return this.reset();this.files[n]=!0}if(t.imports&&0<t.imports.length){var s,o=!1;"object"==typeof e?(this.importRoot=e.root,o=!0,s=this.importRoot,e=e.file,(0<=s.indexOf("\\")||0<=e.indexOf("\\"))&&(i="\\")):"string"==typeof e?this.importRoot?s=this.importRoot:0<=e.indexOf("/")?""===(s=e.replace(/\/[^\/]*$/,""))&&(s="/"):0<=e.indexOf("\\")?(s=e.replace(/\\[^\\]*$/,""),i="\\"):s=".":s=null;for(var a=0;a<t.imports.length;a++)if("string"==typeof t.imports[a]){if(!s)throw Error("cannot determine import root");var l=t.imports[a];if("google/protobuf/descriptor.proto"===l)continue;if(l=s+i+l,!0===this.files[l])continue;/\.proto$/i.test(l)&&!d.DotProto&&(l=l.replace(/\.proto$/,".json"));var u=d.Util.fetch(l);if(null===u)throw Error("failed to import '"+l+"' in '"+e+"': file not found");/\.json$/i.test(l)?this.import(JSON.parse(u+""),l):this.import(d.DotProto.Parser.parse(u),l)}else e?/\.(\w+)$/.test(e)?this.import(t.imports[a],e.replace(/^(.+)\.(\w+)$/,function(e,t,i){return t+"_import"+a+"."+i})):this.import(t.imports[a],e+"_import"+a):this.import(t.imports[a]);o&&(this.importRoot=null)}t.package&&this.define(t.package),t.syntax&&function t(i){i.messages&&i.messages.forEach(function(e){e.syntax=i.syntax,t(e)}),i.enums&&i.enums.forEach(function(e){e.syntax=i.syntax})}(t);var c=this.ptr;return t.options&&Object.keys(t.options).forEach(function(e){c.options[e]=t.options[e]}),t.messages&&(this.create(t.messages),this.ptr=c),t.enums&&(this.create(t.enums),this.ptr=c),t.services&&(this.create(t.services),this.ptr=c),t.extends&&this.create(t.extends),this.reset()},i.resolveAll=function(){var e;if(null==this.ptr||"object"==typeof this.ptr.type)return this;if(this.ptr instanceof o.Namespace)this.ptr.children.forEach(function(e){this.ptr=e,this.resolveAll()},this);else if(this.ptr instanceof o.Message.Field){if(t.TYPE.test(this.ptr.type))this.ptr.type=d.TYPES[this.ptr.type];else{if(!t.TYPEREF.test(this.ptr.type))throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if(!(e=(this.ptr instanceof o.Message.ExtensionField?this.ptr.extension.parent:this.ptr.parent).resolve(this.ptr.type,!0)))throw Error("unresolvable type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if((this.ptr.resolvedType=e)instanceof o.Enum){if(this.ptr.type=d.TYPES.enum,"proto3"===this.ptr.syntax&&"proto3"!==e.syntax)throw Error("proto3 message cannot reference proto2 enum")}else{if(!(e instanceof o.Message))throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);this.ptr.type=e.isGroup?d.TYPES.group:d.TYPES.message}}if(this.ptr.map){if(!t.TYPE.test(this.ptr.keyType))throw Error("illegal key type for map field in "+this.ptr.toString(!0)+": "+this.ptr.keyType);this.ptr.keyType=d.TYPES[this.ptr.keyType]}}else if(this.ptr instanceof d.Reflect.Service.Method){if(!(this.ptr instanceof d.Reflect.Service.RPCMethod))throw Error("illegal service type in "+this.ptr.toString(!0));if(!((e=this.ptr.parent.resolve(this.ptr.requestName,!0))&&e instanceof d.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.requestName);if(this.ptr.resolvedRequestType=e,!((e=this.ptr.parent.resolve(this.ptr.responseName,!0))&&e instanceof d.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.responseName);this.ptr.resolvedResponseType=e}else if(!(this.ptr instanceof d.Reflect.Message.OneOf||this.ptr instanceof d.Reflect.Extension||this.ptr instanceof d.Reflect.Enum.Value))throw Error("illegal object in namespace: "+typeof this.ptr+": "+this.ptr);return this.reset()},i.build=function(e){if(this.reset(),this.resolved||(this.resolveAll(),this.resolved=!0,this.result=null),null===this.result&&(this.result=this.ns.build()),!e)return this.result;for(var t="string"==typeof e?e.split("."):e,i=this.result,r=0;r<t.length;r++){if(!i[t[r]]){i=null;break}i=i[t[r]]}return i},i.lookup=function(e,t){return e?this.ns.resolve(e,t):this.ns},i.toString=function(){return"Builder"},a.Message=function(){},a.Enum=function(){},a.Service=function(){},a),s.Map=function(e,o){var t=function(e,t){if(!e.map)throw Error("field is not a map");if(this.field=e,this.keyElem=new o.Element(e.keyType,null,!0,e.syntax),this.valueElem=new o.Element(e.type,e.resolvedType,!1,e.syntax),this.map={},Object.defineProperty(this,"size",{get:function(){return Object.keys(this.map).length}}),t)for(var i=Object.keys(t),r=0;r<i.length;r++){var n=this.keyElem.valueFromString(i[r]),s=this.valueElem.verifyValue(t[i[r]]);this.map[this.keyElem.valueToString(n)]={key:n,value:s}}},i=t.prototype;function n(e){var t=0;return{next:function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}}}return i.clear=function(){this.map={}},i.delete=function(e){var t=this.keyElem.valueToString(this.keyElem.verifyValue(e)),i=t in this.map;return delete this.map[t],i},i.entries=function(){for(var e,t=[],i=Object.keys(this.map),r=0;r<i.length;r++)t.push([(e=this.map[i[r]]).key,e.value]);return n(t)},i.keys=function(){for(var e=[],t=Object.keys(this.map),i=0;i<t.length;i++)e.push(this.map[t[i]].key);return n(e)},i.values=function(){for(var e=[],t=Object.keys(this.map),i=0;i<t.length;i++)e.push(this.map[t[i]].value);return n(e)},i.forEach=function(e,t){for(var i,r=Object.keys(this.map),n=0;n<r.length;n++)e.call(t,(i=this.map[r[n]]).value,i.key,this)},i.set=function(e,t){var i=this.keyElem.verifyValue(e),r=this.valueElem.verifyValue(t);return this.map[this.keyElem.valueToString(i)]={key:i,value:r},this},i.get=function(e){var t=this.keyElem.valueToString(this.keyElem.verifyValue(e));if(t in this.map)return this.map[t].value},i.has=function(e){return this.keyElem.valueToString(this.keyElem.verifyValue(e))in this.map},t}(0,s.Reflect),s.loadProto=function(e,t,i){return("string"==typeof t||t&&"string"==typeof t.file&&"string"==typeof t.root)&&(i=t,t=void 0),s.loadJson(s.DotProto.Parser.parse(e),t,i)},s.protoFromString=s.loadProto,s.loadProtoFile=function(t,i,r){if(i&&"object"==typeof i?(r=i,i=null):i&&"function"==typeof i||(i=null),i)return s.Util.fetch("string"==typeof t?t:t.root+"/"+t.file,function(e){if(null!==e)try{i(null,s.loadProto(e,r,t))}catch(e){i(e)}else i(Error("Failed to fetch file"))});var e=s.Util.fetch("object"==typeof t?t.root+"/"+t.file:t);return null===e?null:s.loadProto(e,r,t)},s.protoFromFile=s.loadProtoFile,s.newBuilder=function(e){return void 0===(e=e||{}).convertFieldsToCamelCase&&(e.convertFieldsToCamelCase=s.convertFieldsToCamelCase),void 0===e.populateAccessors&&(e.populateAccessors=s.populateAccessors),new s.Builder(e)},s.loadJson=function(e,t,i){return("string"==typeof t||t&&"string"==typeof t.file&&"string"==typeof t.root)&&(i=t,t=null),t&&"object"==typeof t||(t=s.newBuilder()),"string"==typeof e&&(e=JSON.parse(e)),t.import(e,i),t.resolveAll(),t},s.loadJsonFile=function(t,i,r){if(i&&"object"==typeof i?(r=i,i=null):i&&"function"==typeof i||(i=null),i)return s.Util.fetch("string"==typeof t?t:t.root+"/"+t.file,function(e){if(null!==e)try{i(null,s.loadJson(JSON.parse(e),r,t))}catch(e){i(e)}else i(Error("Failed to fetch file"))});var e=s.Util.fetch("object"==typeof t?t.root+"/"+t.file:t);return null===e?null:s.loadJson(JSON.parse(e),r,t)},s},t=[h(12)],void 0===(i="function"==typeof(e=n)?e.apply(o,t):e)||(s.exports=i)}).call(o,h(71))},function(gYa,hYa){var iYa;iYa=function(){return this}();try{iYa=iYa||Function("return this")()||eval("this")}catch(e){"object"==typeof window&&(iYa=window)}gYa.exports=iYa},function(e,t,i){var r,n;r=[i(0),i(1),i(4),i(15),i(2),i(84),i(83)],void 0===(n=function(u,c,n,s,d,o,a){"use strict";function e(e,t,i,r){c.isStringNotEmpty(e,"uri"),c.isString(t,"deviceId"),c.isStringNotEmpty(i,"version"),c.isObject(r,"logger"),this._deviceId=t,this._version=i,this._logger=r,this._mqWebSocket=new s.MQWebSocket(e,this._logger,[o,a],5),this._observableSessionId=new n.Observable(null).extend({rateLimit:0})}return e.prototype.onEvent=function(e,t){return this._mqWebSocket.onEvent(e,t)},e.prototype.disconnect=function(){return this._observableSessionId.setValue(null),this._mqWebSocket.disconnect()},e.prototype.authenticate=function(e,r){c.isStringNotEmpty(e,"authToken"),c.isFunction(r,"callback");var t={apiVersion:this._mqWebSocket.getApiVersion(),clientVersion:this._version,deviceId:this._deviceId,platform:d.browser,platformVersion:d.browserVersion.toString(),authenticationToken:e};this.getSessionId()&&(t.sessionId=this.getSessionId());var n=this;return this._mqWebSocket.sendRequest("pcast.Authenticate",t,function(e,t){if(t){var i=n._observableSessionId.getValue();i&&i!==t.sessionId&&n._mqWebSocket.disposeOfPendingRequests(),n._observableSessionId.setValue(t.sessionId)}return r(e,t)})},e.prototype.getSessionId=function(){return this._observableSessionId.getValue()},e.prototype.getObservableSessionId=function(){return this._observableSessionId},e.prototype.bye=function(e,t){c.isStringNotEmpty(e,"reason"),c.isFunction(t,"callback");var i={sessionId:this.getSessionId(),reason:e};return this._mqWebSocket.sendRequest("pcast.Bye",i,t)},e.prototype.setupStream=function(e,t,i,r,n){c.isStringNotEmpty(e,"streamType"),c.isStringNotEmpty(t,"streamToken"),c.isObject(i,"options"),c.isFunction(n,"callback");var s=d.browser||"UnknownBrowser",o=s+"-"+(d.browserVersion||0),a="rtt[http]="+r,l={streamToken:t,createStream:{sessionId:this.getSessionId(),options:["data-quality-notifications",a],connectUri:i.connectUri,connectOptions:i.connectOptions||[],tags:i.tags||[],userAgent:u.get(d,["global","navigator","userAgent"],o)}};return i.negotiate&&(l.createStream.createOfferDescription={streamId:"",options:[e,s,o],apiVersion:this._mqWebSocket.getApiVersion()},"undefined"!=typeof screen&&l.createStream.createOfferDescription.options.push("screen="+screen.width+"x"+screen.height)),!1===i.receiveAudio&&l.createStream.options.push("no-audio"),!1===i.receiveVideo&&l.createStream.options.push("no-video"),this._mqWebSocket.sendRequest("pcast.SetupStream",l,n)},e.prototype.setAnswerDescription=function(e,t,i){c.isStringNotEmpty(e,"streamId"),c.isStringNotEmpty(t,"sdp"),c.isFunction(i,"callback");var r={streamId:e,sessionDescription:{type:"Answer",sdp:t},apiVersion:this._mqWebSocket.getApiVersion()};return this._mqWebSocket.sendRequest("pcast.SetRemoteDescription",r,i)},e.prototype.addIceCandidates=function(e,t,i,r){c.isStringNotEmpty(e,"streamId"),c.isArray(t,"candidates"),c.isObject(i,"options"),c.isFunction(r,"callback");var n={streamId:e,candidates:u.map(t,function(e,t){return c.isStringNotEmpty(e.candidate,"candidate["+t+"].candidate"),c.isNumber(e.sdpMLineIndex,"candidate["+t+"].sdpMLineIndex"),c.isStringNotEmpty(e.sdpMid,"candidate["+t+"].sdpMid"),{candidate:e.candidate,sdpMLineIndex:e.sdpMLineIndex,sdpMid:e.sdpMid}}),options:i,apiVersion:this._mqWebSocket.getApiVersion()};return this._mqWebSocket.sendRequest("pcast.AddIceCandidates",n,r)},e.prototype.updateStreamState=function(e,t,i,r,n){c.isStringNotEmpty(e,"streamId"),c.isStringNotEmpty(t,"signalingState"),c.isStringNotEmpty(i,"iceGatheringState"),c.isStringNotEmpty(r,"iceConnectionState"),c.isFunction(n,"callback");var s={streamId:e,signalingState:t,iceGatheringState:i,iceConnectionState:r,apiVersion:this._mqWebSocket.getApiVersion()};return this._mqWebSocket.sendRequest("pcast.UpdateStreamState",s,n)},e.prototype.destroyStream=function(e,t,i){c.isStringNotEmpty(e,"streamId"),c.isString(t,"reason"),c.isFunction(i,"callback");var r={streamId:e,reason:t};return this._mqWebSocket.sendRequest("pcast.DestroyStream",r,i)},e.prototype.getRoomInfo=function(e,t,i){e?c.isString(e,"roomId"):c.isString(t,"alias"),c.isFunction(i,"callback");var r={roomId:e,alias:t,sessionId:this.getSessionId()};return this._mqWebSocket.sendRequest("chat.GetRoomInfo",r,i)},e.prototype.createRoom=function(e,t){c.isObject(e,"room"),c.isStringNotEmpty(e.name,"room.name"),c.isStringNotEmpty(e.type,"room.type"),c.isStringNotEmpty(e.description,"room.description"),c.isFunction(t,"callback");var i={sessionId:this.getSessionId(),room:e};return this._mqWebSocket.sendRequest("chat.CreateRoom",i,t)},e.prototype.enterRoom=function(e,t,i,r,n){e?c.isString(e,"roomId"):c.isString(t,"alias"),c.isObject(i,"member"),c.isNumber(r,"timestamp"),c.isFunction(n,"callback");var s={roomId:e,alias:t,sessionId:this.getSessionId(),member:i,timestamp:r};return this._mqWebSocket.sendRequest("chat.JoinRoom",s,n)},e.prototype.leaveRoom=function(e,t,i){c.isString(e,"roomId"),c.isNumber(t,"timestamp"),c.isFunction(i,"callback");var r={roomId:e,sessionId:this.getSessionId(),timestamp:t};return this._mqWebSocket.sendRequest("chat.LeaveRoom",r,i)},e.prototype.updateMember=function(e,t,i){c.isObject(e,"member"),c.isNumber(t,"timestamp"),c.isFunction(i,"callback"),e.updateStreams=e.hasOwnProperty("streams");var r={sessionId:this.getSessionId(),member:e,timestamp:t};return this._mqWebSocket.sendRequest("chat.UpdateMember",r,i)},e.prototype.updateRoom=function(e,t,i){c.isObject(e,"room"),c.isNumber(t,"timestamp"),c.isFunction(i,"callback");var r={sessionId:this.getSessionId(),room:e,timestamp:t};return this._mqWebSocket.sendRequest("chat.UpdateRoom",r,i)},e.prototype.sendMessageToRoom=function(e,t,i){c.isStringNotEmpty(e,"roomId"),c.isObject(t,"chatMessage");var r={roomId:e,chatMessage:t};return this._mqWebSocket.sendRequest("chat.SendMessageToRoom",r,i)},e.prototype.subscribeToRoomConversation=function(e,t,i,r){c.isStringNotEmpty(e,"sessionId"),c.isStringNotEmpty(t,"roomId"),c.isNumber(i,"batchSize");var n={sessionId:e,roomId:t,limit:i,options:["Subscribe"]};return this._mqWebSocket.sendRequest("chat.FetchRoomConversation",n,r)},e.prototype.getMessages=function(e,t,i,r,n,s){c.isStringNotEmpty(e,"sessionId"),c.isStringNotEmpty(t,"roomId"),n&&r||c.isNumber(i,"batchSize");var o={sessionId:e,roomId:t,limit:i||0,options:[]};return n&&(c.isStringNotEmpty(n,"beforeMessageId"),o.beforeMessageId=n),r&&(c.isStringNotEmpty(r,"afterMessageId"),o.afterMessageId=r),this._mqWebSocket.sendRequest("chat.FetchRoomConversation",o,s)},e.prototype.toString=function(){return"PCastProtocol["+this._mqWebSocket.toString()+"]"},e}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(1)],void 0===(n=function(h,p){"use strict";function e(e){p.isObject(e,"logger"),this._logger=e,this.init()}return e.prototype.init=function(){},e.prototype.onValue=function(e){this._callback=e},e.prototype.startDetection=function(e,t){return function(s,e){p.isObject(s,"audioVolumeMeter");var o=this,a=(e=e||{}).speakingHysteresisInterval||50,l=e.silenceHysteresisInterval||1500;p.isNumber(a,"options.speakingHysteresisInterval"),p.isNumber(l,"options.silenceHysteresisInterval");var u=!1,c=h.now()+a,d=h.now()+l;s.onValue(function(e){p.isObject(s,"audioVolumeMeter"),p.isNumber(e.date,"value.date"),p.isNumber(e.value,"value.value"),p.isNumber(e.smoothedValue,"value.smoothedValue"),p.isNumber(e.smoothedPeakValue,"value.smoothedPeakValue"),p.isNumber(e.clipped,"value.clipped");var t=.01<e.value&&e.value>2*e.smoothedValue&&e.value>.25*e.smoothedPeakValue,i=e.value>.8*e.smoothedValue,r=e.value<.5*e.smoothedValue,n=!t;(t||u&&i)&&c<e.date?(d=h.utc(e.date)+l,u||(u=!0,o._logger.info("Speaking detected"),o._callback&&o._callback("speaking"))):(r||!u&&n)&&d<e.date&&(c=h.utc(e.date)+a,u&&(u=!1,o._logger.info("Silence detected"),o._callback&&o._callback("silence")))})}.call(this,e,t)},e.prototype.toString=function(){return"AudioSpeakerDetection"},e}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(1)],void 0===(n=function(s,i){"use strict";function e(e){i.isObject(e,"logger"),this._logger=e}function r(e){for(var t=e.inputBuffer.getChannelData(0),i=0,r=0,n=0;n<t.length;n++)i+=t[n]*t[n],.99<Math.abs(t[n])&&r++;this._value=Math.sqrt(i/t.length),this._smoothedValue=this._alpha*this._value+(1-this._alpha)*this._smoothedValue,this._smoothedPeakValue=Math.max(this._value,this._alpha*this._value+(1-this._alpha)*this._smoothedPeakValue),this._clipped=r,this._callback&&this._callback.call(this,{date:s.now(),value:this._value,smoothedValue:this._smoothedValue,smoothedPeakValue:this._smoothedPeakValue,clipped:this._clipped})}return e.prototype.init=function(e,t){i.isObject(e,"context"),i.isFunction(e.createScriptProcessor,"context.createScriptProcessor"),t=parseFloat(t||1/16),i.isNumber(t,"alpha"),this._context=e,this._alpha=t,this._value=0,this._smoothedValue=0,this._smoothedPeakValue=0,this._clipped=0,this._scriptProcessor=e.createScriptProcessor(4096,1,1),s.addEventListener(this._scriptProcessor,"audioprocess",s.bind(r,this))},e.prototype.onValue=function(e){this._callback=e},e.prototype.getValue=function(){return this._value},e.prototype.getSmoothedValue=function(){return this._smoothedValue},e.prototype.getSmoothedPeakValue=function(){return this._smoothedPeakValue},e.prototype.setAlpha=function(e){i.isNumber(e,"alpha"),this._alpha=parseFloat(e)},e.prototype.connect=function(e){return function(e){i.isObject(e,"stream");0<e.getAudioTracks().length?(this._mediaStreamSource=this._context.createMediaStreamSource(e),this._mediaStreamSource.connect(this._scriptProcessor),this._scriptProcessor.connect(this._context.destination)):this._logger.info("Stream has no audio tracks")}.call(this,e)},e.prototype.stop=function(){return function(){this._mediaStreamSource&&this._mediaStreamSource.disconnect();this._scriptProcessor.disconnect()}.call(this)},e.prototype.toString=function(){return"AudioVolumeMeter"},e}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(1),i(76)],void 0===(n=function(e,t,i){"use strict";function r(e){t.isObject(e,"logger"),this._logger=e,this._audioVolumeMeters={}}return r.prototype.stopAllMeters=function(){e.forOwn(this._audioVolumeMeters,function(e){e.stop()})},r.prototype.getAudioVolumeMeter=function(e){return t.isObject(e,"stream"),t.isStringNotEmpty(e.id,"streamId"),this._audioVolumeMeters[e.id]||(this._audioVolumeMeters[e.id]=new i(this._logger)),this._audioVolumeMeters[e.id]},r.prototype.getAudioVolumeMeters=function(){return e.values(this._audioVolumeMeters)},r.prototype.toString=function(){return"AudioVolumeMeterFactory"},r}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(1)],void 0===(n=function(n,s){"use strict";function e(e){this.init(e)}function o(e,t){if(this._membersSubscription&&this._membersSubscription.dispose(),!t)return this._publisher.limitBandwidth(e);var i=t.getObservableMembers();this._membersSubscription=i.subscribe(n.bind(r,this,e),{initial:"notify"})}function r(e,t){if(t.length!==this._roomMemberCount){this._roomMemberCount=t.length;var i=e/Math.max(1,this._roomMemberCount-1);this._publisher.limitBandwidth(i)}}return e.prototype.init=function(e){s.isObject(e,"publisher"),this._publisher=e,this._roomMemberCount=0,this._roomSubscription=null,this._membersSubscription=null},e.prototype.connect=function(e,t){s.isObject(e,"roomService"),t=t||{};var i=e.getObservableActiveRoom(),r=t.roomBandwidthLimit||5e6;this._roomSubscription=i.subscribe(n.bind(o,this,r),{initial:"notify"})},e.prototype.close=function(){this._roomSubscription&&this._roomSubscription.dispose(),this._membersSubscription&&this._membersSubscription.dispose(),this._roomSubscription=null,this._membersSubscription=null},e.prototype.toString=function(){return"PublisherBandwidthAdjuster"},e}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(1),i(4),i(3),i(34)],void 0===(n=function(r,l,t,n,i){"use strict";function e(e){l.isObject(e,"pcast"),l.isFunction(e.getLogger,"pcast.getLogger"),l.isFunction(e.getProtocol,"pcast.getProtocol"),this._pcast=e,this._logger=e.getLogger(),this._protocol=e.getProtocol(),this._enabled=new t.Observable(!1),this._lastSubscribedSessionId=null,l.isObject(this._logger,"this._logger"),l.isObject(this._protocol,"this._protocol"),this._authService=new i(this._pcast)}function s(e){switch(l.isObject(e,"event"),l.isStringNotEmpty(e.roomId,"event.roomId"),l.isStringNotEmpty(e.eventType,"event.eventType"),l.isArray(e.chatMessages,"event.chatMessages"),e.eventType){case"Message":this._logger.debug("[%s] Room messages [%s]",e.roomId,e.chatMessages);var t=this._roomMessagesListeners[e.roomId];d(e.chatMessages),t&&t(null,{status:"ok",chatMessages:e.chatMessages});break;default:this._logger.warn("Unsupported room conversation event [%s]",e.eventType)}}function o(e){}function a(e){this._lastSubscribedSessionId&&this._lastSubscribedSessionId!==e&&function(){var i=this;r.forOwn(this._roomMessagesListeners,function(e,t){u.call(i,t,1)})}.call(this)}function u(n,e){l.isStringNotEmpty(n,"roomId"),l.isNumber(e,"batchSize"),c.call(this),this._authService.assertAuthorized();var t=this._authService.getPCastSessionId();this._lastSubscribedSessionId=t,this._logger.info("Subscribe to room [%s] conversation with batch size of [%s]",n,e);var s=this;this._protocol.subscribeToRoomConversation(t,n,e,function(e,t){var i=s._roomMessagesListeners[n];if(!i)return s._logger.warn("No subscription callback set for room [%s]",n);if(e)return s._logger.error("Subscribe to room conversation failed with error [%s]",e),i(e,null);var r={status:t.status};if("ok"!==t.status)return delete s._roomMessagesListeners[n],s._logger.warn("Subscribe to room conversation failed with status [%s]",t.status),i(null,r);r.chatMessages=t.chatMessages,d(r.chatMessages),i(null,r)})}function c(){if(!this._enabled.getValue())throw new Error("ChatService not Enabled. Please start before performing actions.")}function d(e){r.forEach(e,function(e){!function(e){e.timestamp&&(e.timestamp=r.utc(e.timestamp));e.from&&(e.from.lastUpdate=r.utc(e.from.lastUpdate))}(e)})}return e.prototype.start=function(){if(!this._enabled.getValue()){this._disposables=new n.DisposableList,this._roomMessagesListeners={},this._enabled.setValue(!0),function(){var e=this._authService.getObservableStatus().subscribe(r.bind(o,this)),t=this._authService.getObservableSessionId().subscribe(r.bind(a,this));this._disposables.add(e),this._disposables.add(t)}.call(this);var e=this._protocol.onEvent("chat.RoomConversationEvent",r.bind(s,this));this._disposables.add(e)}},e.prototype.stop=function(){this._enabled.getValue()&&this._disposables&&this._disposables.dispose()},e.prototype.getObservableChatEnabled=function(){return this._enabled},e.prototype.sendMessageToRoom=function(e,t,i,r,n,s){(function(e,t,i,r,n,s){l.isStringNotEmpty(e,"roomId"),l.isStringNotEmpty(t,"screenName"),l.isStringNotEmpty(i,"role"),l.isNumber(r,"lastUpdate"),l.isStringNotEmpty(n,"message"),l.isFunction(s,"callback"),c.call(this),this._authService.assertAuthorized();var o={messageId:"",timestamp:0,from:{sessionId:this._authService.getPCastSessionId(),screenName:t,role:i,lastUpdate:r},message:n};this._logger.info("Send message to room [%s] from [%s]",e,t);var a=this;return this._protocol.sendMessageToRoom(e,o,function(e,t){if(e)return a._logger.error("Send message to room failed with error [%s]",e),s(e,null);var i={status:t.status};"ok"!==t.status&&a._logger.warn("Send message to room failed with status [%s]",t.status),s(null,i)})}).call(this,e,t,i,r,n,s)},e.prototype.subscribeAndLoadMessages=function(e,t,i){var r=function(e,t){var i=this;this._roomMessagesListeners[e]=t;var r=new n.Disposable(function(){i._roomMessagesListeners[e]===t&&delete i._roomMessagesListeners[e]});return this._disposables.add(r),r}.call(this,e,i);return u.call(this,e,t),r},e.prototype.getMessages=function(e,t,i,r,n){(function(e,t,i,r,n){l.isStringNotEmpty(e,"roomId"),l.isFunction(n,"callback"),r&&i||l.isNumber(t,"batchSize");r&&l.isStringNotEmpty(r,"beforeMessageId");i&&l.isStringNotEmpty(i,"afterMessageId");c.call(this),this._authService.assertAuthorized();var s=this._authService.getPCastSessionId();this._logger.info("Get messages from room [%s] conversation with batch size of [%s], after [%s], and before [%s]",e,t,i,r);var o=this;this._protocol.getMessages(s,e,t,i,r,function(e,t){if(e)return o._logger.error("Get messages from room conversation failed with error [%s]",e),n(e,null);var i={status:t.status};if("ok"!==t.status)return o._logger.warn("Get messages from room conversation failed with status [%s]",t.status),n(null,i);i.chatMessages=t.chatMessages,d(i.chatMessages),n(null,i)})}).call(this,e,t,i,r,n)},e.prototype.toString=function(){return"ChatService"},e}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(1),i(4),i(3),i(79)],void 0===(n=function(n,t,i,r,s){"use strict";var o=100;function e(e){t.isObject(e,"roomService"),t.isObject(e._pcast,"roomService._pcast"),t.isObject(e._logger,"roomService._logger"),this._roomService=e,this._pcast=e._pcast,this._logger=e._logger,this._chatService=new s(this._pcast),this._chatMessages=new i.ObservableArray([]),this._latestMessageQueue=[],this._disposables=new r.DisposableList,this._chatRoomId=null}function a(e){e&&this._chatRoomId===e.getRoomId()||(u.call(this),e&&l.call(this))}function l(){u.call(this),this._roomChatSubscription=function(e){var t=this._roomService.getObservableActiveRoom().getValue().getRoomId();this._chatRoomId=t;var r=this;return this._chatMessages.setValue([]),this._chatService.subscribeAndLoadMessages(t,e,function(e,t){if(e)throw e;if("ok"!==t.status)throw new Error("Unable to subscribe to room chat. Status "+status);var i=r._chatMessages.getValue();n.forEach(t.chatMessages,function(e){i.push(e)}),i.length>o&&i.splice(0,i.length-o),r._chatMessages.setValue(i)})}.call(this,this._batchSize)}function u(){this._roomChatSubscription&&this._roomChatSubscription.dispose&&this._roomChatSubscription.dispose()}return e.prototype.start=function(e){this._batchSize=e||0,this._chatService.start(),function(){var e=this._roomService.getObservableActiveRoom().subscribe(n.bind(a,this));this._disposables.add(e)}.call(this),l.call(this)},e.prototype.stop=function(){this._chatService.stop(),u.call(this),this._disposables&&this._disposables.dispose()},e.prototype.getObservableChatMessages=function(){return this._chatMessages},e.prototype.getObservableChatEnabled=function(){return this._chatService.getObservableChatEnabled()},e.prototype.sendMessageToRoom=function(e,t){var i=this._roomService.getObservableActiveRoom().getValue().getRoomId(),r=this._roomService._self.getValue(),n=r.getObservableScreenName().getValue(),s=r.getObservableRole().getValue(),o=r.getLastUpdate();this._chatService.sendMessageToRoom(i,n,s,o,e,t)},e.prototype.getMessages=function(e,t,i,r){var n=this._roomService.getObservableActiveRoom().getValue().getRoomId();return this._chatService.getMessages(n,e,t,i,r)},e.prototype.toString=function(){return"RoomChatService"},e}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(1),i(2),i(8),i(15),i(37)],void 0===(n=function(u,c,t,i,r,n){function e(e){c.isString(e,"uri"),this._loggingUrl="/telemetry/logs",this._domain="object"==typeof location?location.hostname:t.browser+"-"+t.browserVersion+"-unknown",this._minLevel=i.level.TRACE,this._isEnabled=!0,this._browser=(t.browser||"Browser")+"/"+(t.browserVersion||"?"),this._mostRecentRuntime=0,this._batchHttpProtocol=new r.BatchHttpProto(e+this._loggingUrl,[n],"telemetry.StoreLogRecords",{maxAttempts:3,maxBufferedRecords:1e3,maxBatchSize:512}),this._batchHttpProtocol.on("capacity",u.bind(s,this))}function s(e){this._batchHttpProtocol.addRecordToBeginning({level:"Warn",timestamp:u.isoString(),category:"websdk/telemetryLogger",message:"Deleted "+e+" records",source:this._browser,fullQualifiedName:this._domain,sessionId:this._mostRecentSessionId,userId:this._mostRecentUserId,environment:this._mostRecentEnvironment,version:this._mostRecentVersion,runtime:this._mostRecentRuntime})}return e.prototype.setThreshold=function(e){c.isNumber(e,"level"),this._minLevel=e},e.prototype.getThreshold=function(){return this._minLevel},e.prototype.isEnabled=function(){return this._isEnabled},e.prototype.setEnabled=function(e){c.isBoolean(e,"enabled"),this._isEnabled=e},e.prototype.log=function(e,t,i,r,n,s,o,a,l){l.level<this._minLevel||!this._isEnabled||(c.isArray(r,"messages"),this._mostRecentRuntime=e,this._mostRecentSessionId=n,this._mostRecentUserId=s,this._mostRecentEnvironment=o,this._mostRecentVersion=a,function(e,t,i){this._batchHttpProtocol.addRecord({level:e,timestamp:u.isoString(),category:t,message:i.join(" "),source:this._browser,fullQualifiedName:this._domain,sessionId:this._mostRecentSessionId,userId:this._mostRecentUserId,environment:this._mostRecentEnvironment,version:this._mostRecentVersion,runtime:this._mostRecentRuntime})}.call(this,t,i,r))},e}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(1),i(35),i(81)],void 0===(n=function(e,t,r,n){var s={urls:{local:"",staging:"https://telemetry-stg.phenixrts.com",production:"https://telemetry.phenixrts.com"}};function i(){this._telemetryAppenders={}}return i.prototype.getAppender=function(e){var t=r.parseEnvFromPcastBaseUri(e||""),i=s.urls[t];return this._telemetryAppenders[t]||(this._telemetryAppenders[t]=function(e){var t=new n(e);e||t.setEnabled(!1);return t}.call(this,i)),this._telemetryAppenders[t]},new i}.apply(t,r))||(e.exports=n)},function(e,t,i){var r;void 0===(r=function(){"use strict";return{package:"chat",options:{optimize_for:"LITE_RUNTIME"},messages:[{name:"Room",fields:[{rule:"optional",type:"string",name:"roomId",id:1},{rule:"optional",type:"string",name:"alias",id:2},{rule:"required",type:"string",name:"name",id:3},{rule:"required",type:"string",name:"description",id:4},{rule:"required",type:"RoomType",name:"type",id:5},{rule:"repeated",type:"string",name:"options",id:6},{rule:"optional",type:"string",name:"bridgeId",id:7},{rule:"optional",type:"string",name:"pin",id:8}]},{name:"Stream",fields:[{rule:"required",type:"StreamType",name:"type",id:1},{rule:"required",type:"string",name:"uri",id:2},{rule:"required",type:"TrackState",name:"audioState",id:3},{rule:"required",type:"TrackState",name:"videoState",id:4}]},{name:"Member",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"screenName",id:2},{rule:"required",type:"MemberRole",name:"role",id:3},{rule:"repeated",type:"Stream",name:"streams",id:4},{rule:"required",type:"MemberState",name:"state",id:5},{rule:"required",type:"uint64",name:"lastUpdate",id:6}]},{name:"MemberUpdate",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"optional",type:"string",name:"screenName",id:2},{rule:"optional",type:"MemberRole",name:"role",id:3},{rule:"required",type:"bool",name:"updateStreams",id:7,options:{default:!1}},{rule:"repeated",type:"Stream",name:"streams",id:4},{rule:"optional",type:"MemberState",name:"state",id:5},{rule:"required",type:"uint64",name:"lastUpdate",id:6}]},{name:"ChatUser",fields:[{rule:"optional",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"screenName",id:2},{rule:"required",type:"MemberRole",name:"role",id:3},{rule:"required",type:"uint64",name:"lastUpdate",id:4}]},{name:"ChatMessage",fields:[{rule:"required",type:"string",name:"messageId",id:1},{rule:"required",type:"uint64",name:"timestamp",id:2},{rule:"required",type:"ChatUser",name:"from",id:3},{rule:"required",type:"string",name:"message",id:4}]},{name:"CreateRoom",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"Room",name:"room",id:2}]},{name:"CreateRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"Room",name:"room",id:2}]},{name:"JoinRoom",fields:[{rule:"optional",type:"string",name:"roomId",id:1},{rule:"optional",type:"string",name:"alias",id:2},{rule:"required",type:"string",name:"sessionId",id:3},{rule:"required",type:"Member",name:"member",id:4},{rule:"repeated",type:"string",name:"options",id:5},{rule:"required",type:"uint64",name:"timestamp",id:6}]},{name:"JoinRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"Room",name:"room",id:2},{rule:"repeated",type:"Member",name:"members",id:3},{rule:"optional",type:"Member",name:"self",id:5},{rule:"repeated",type:"string",name:"options",id:4}]},{name:"UpdateRoom",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"Room",name:"room",id:2},{rule:"required",type:"uint64",name:"timestamp",id:3}]},{name:"UpdateRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"UpdateMember",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"MemberUpdate",name:"member",id:2},{rule:"repeated",type:"string",name:"options",id:3},{rule:"required",type:"uint64",name:"timestamp",id:4}]},{name:"UpdateMemberResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"uint64",name:"lastUpdate",id:2}]},{name:"LeaveRoom",fields:[{rule:"required",type:"string",name:"roomId",id:1},{rule:"required",type:"string",name:"sessionId",id:2},{rule:"required",type:"uint64",name:"timestamp",id:3}]},{name:"LeaveRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"DestroyRoom",fields:[{rule:"required",type:"string",name:"roomId",id:1}]},{name:"DestroyRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"GetRoomInfo",fields:[{rule:"optional",type:"string",name:"roomId",id:1},{rule:"optional",type:"string",name:"alias",id:2},{rule:"optional",type:"string",name:"sessionId",id:3},{rule:"optional",type:"string",name:"applicationId",id:4},{rule:"optional",type:"string",name:"secret",id:5},{rule:"repeated",type:"string",name:"options",id:6}]},{name:"GetRoomInfoResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"Room",name:"room",id:2},{rule:"repeated",type:"Member",name:"members",id:3},{rule:"repeated",type:"string",name:"options",id:4}]},{name:"RoomEvent",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"roomId",id:2},{rule:"required",type:"RoomEventType",name:"eventType",id:3},{rule:"repeated",type:"Member",name:"members",id:4},{rule:"optional",type:"Room",name:"room",id:5},{rule:"repeated",type:"string",name:"options",id:6},{rule:"required",type:"uint64",name:"timestamp",id:7}]},{name:"SendMessageToRoom",fields:[{rule:"required",type:"string",name:"roomId",id:1},{rule:"required",type:"ChatMessage",name:"chatMessage",id:2}]},{name:"SendMessageToRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"FetchRoomConversation",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"roomId",id:2},{rule:"optional",type:"string",name:"afterMessageId",id:3},{rule:"optional",type:"string",name:"beforeMessageId",id:4},{rule:"required",type:"uint32",name:"limit",id:5},{rule:"repeated",type:"RoomConversationOption",name:"options",id:6}]},{name:"FetchRoomConversationResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"ChatMessage",name:"chatMessages",id:2}]},{name:"RoomConversationEvent",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"roomId",id:2},{rule:"required",type:"RoomConversationEventType",name:"eventType",id:3},{rule:"repeated",type:"ChatMessage",name:"chatMessages",id:4}]},{name:"RoomBridgeIdle",fields:[{rule:"required",type:"string",name:"roomId",id:1},{rule:"required",type:"string",name:"bridgeId",id:2}]}],enums:[{name:"RoomType",values:[{name:"DirectChat",id:0},{name:"MultiPartyChat",id:1},{name:"ModeratedChat",id:2},{name:"TownHall",id:3},{name:"Channel",id:4}]},{name:"MemberRole",values:[{name:"Participant",id:0},{name:"Moderator",id:1},{name:"Presenter",id:2},{name:"Audience",id:3}]},{name:"MemberState",values:[{name:"Active",id:0},{name:"Passive",id:1},{name:"HandRaised",id:2},{name:"Inactive",id:3},{name:"Offline",id:4}]},{name:"RoomEventType",values:[{name:"MemberJoined",id:0},{name:"MemberLeft",id:1},{name:"MemberUpdated",id:2},{name:"RoomUpdated",id:3},{name:"RoomEnded",id:4}]},{name:"TrackState",values:[{name:"TrackEnabled",id:0},{name:"TrackDisabled",id:1},{name:"TrackEnded",id:2}]},{name:"StreamType",values:[{name:"User",id:0},{name:"Presentation",id:1},{name:"Audio",id:2}]},{name:"RoomConversationOption",values:[{name:"Subscribe",id:0}]},{name:"RoomConversationEventType",values:[{name:"Message",id:0}]}]}}.apply(t,[]))||(e.exports=r)},function(e,t,i){var r;void 0===(r=function(){"use strict";return{package:"pcast",options:{optimize_for:"LITE_RUNTIME"},messages:[{name:"Authenticate",fields:[{rule:"optional",type:"uint32",name:"apiVersion",id:9,options:{default:0}},{rule:"required",type:"string",name:"clientVersion",id:1},{rule:"optional",type:"string",name:"device",id:12},{rule:"required",type:"string",name:"deviceId",id:2},{rule:"optional",type:"string",name:"manufacturer",id:13},{rule:"required",type:"string",name:"platform",id:3},{rule:"required",type:"string",name:"platformVersion",id:4},{rule:"required",type:"string",name:"authenticationToken",id:5},{rule:"optional",type:"string",name:"connectionId",id:6},{rule:"optional",type:"string",name:"connectionRouteKey",id:10},{rule:"optional",type:"string",name:"remoteAddress",id:11},{rule:"optional",type:"string",name:"sessionId",id:7},{rule:"optional",type:"string",name:"applicationId",id:8}]},{name:"AuthenticateResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"sessionId",id:2},{rule:"optional",type:"string",name:"redirect",id:3},{rule:"repeated",type:"string",name:"roles",id:4}]},{name:"Bye",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"reason",id:2}]},{name:"ByeResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"SessionDescription",fields:[{rule:"required",type:"Type",name:"type",id:1,options:{default:"Offer"}},{rule:"required",type:"string",name:"sdp",id:2}],enums:[{name:"Type",values:[{name:"Offer",id:0},{name:"Answer",id:1}]}]},{name:"CreateStream",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"optional",type:"string",name:"originStreamId",id:2},{rule:"repeated",type:"string",name:"originStreamIds",id:10},{rule:"repeated",type:"string",name:"options",id:3},{rule:"optional",type:"string",name:"connectUri",id:8},{rule:"repeated",type:"string",name:"connectOptions",id:9},{rule:"repeated",type:"string",name:"tags",id:4},{rule:"optional",type:"string",name:"userAgent",id:11},{rule:"optional",type:"SetRemoteDescription",name:"setRemoteDescription",id:5},{rule:"optional",type:"CreateOfferDescription",name:"createOfferDescription",id:6},{rule:"optional",type:"CreateAnswerDescription",name:"createAnswerDescription",id:7}]},{name:"IceServer",fields:[{rule:"repeated",type:"string",name:"urls",id:1},{rule:"optional",type:"string",name:"username",id:2},{rule:"optional",type:"string",name:"credential",id:3}]},{name:"RtcConfiguration",fields:[{rule:"optional",type:"BundlePolicy",name:"bundlePolicy",id:1},{rule:"optional",type:"uint32",name:"iceCandidatePoolSize",id:3},{rule:"repeated",type:"IceServer",name:"iceServers",id:4},{rule:"optional",type:"IceTransportPolicy",name:"iceTransportPolicy",id:5},{rule:"optional",type:"string",name:"peerIdentity",id:6},{rule:"optional",type:"RtcpMuxPolicy",name:"rtcpMuxPolicy",id:7}],enums:[{name:"BundlePolicy",values:[{name:"BundlePolicyBalanced",id:1},{name:"BundlePolicyMaxCompat",id:2},{name:"BundlePolicyMaxBundle",id:3}]},{name:"IceTransportPolicy",values:[{name:"IceTransportPolicyAll",id:1},{name:"IceTransportPolicyPublic",id:2},{name:"IceTransportPolicyRelay",id:3}]},{name:"RtcpMuxPolicy",values:[{name:"RtcpMuxPolicyNegotiate",id:1},{name:"RtcpMuxPolicyRequire",id:2}]}]},{name:"CreateStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"streamId",id:2},{rule:"optional",type:"string",name:"instanceRouteKey",id:5},{rule:"repeated",type:"string",name:"streamUris",id:8},{rule:"optional",type:"RtcConfiguration",name:"rtcConfiguration",id:9},{rule:"optional",type:"SetRemoteDescriptionResponse",name:"setRemoteDescriptionResponse",id:3},{rule:"optional",type:"CreateOfferDescriptionResponse",name:"createOfferDescriptionResponse",id:4},{rule:"optional",type:"CreateAnswerDescriptionResponse",name:"createAnswerDescriptionResponse",id:6},{rule:"repeated",type:"string",name:"options",id:7},{rule:"optional",type:"uint64",name:"offset",id:10,options:{default:0}}]},{name:"SetLocalDescription",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"required",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"optional",type:"uint32",name:"apiVersion",id:3,options:{default:0}}]},{name:"SetLocalDescriptionResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"string",name:"options",id:2}]},{name:"SetRemoteDescription",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"required",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"optional",type:"uint32",name:"apiVersion",id:3,options:{default:0}}]},{name:"SetRemoteDescriptionResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"repeated",type:"string",name:"options",id:3}]},{name:"CreateOfferDescription",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"repeated",type:"string",name:"options",id:2},{rule:"optional",type:"uint32",name:"apiVersion",id:3,options:{default:0}}]},{name:"CreateOfferDescriptionResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"repeated",type:"string",name:"options",id:3}]},{name:"CreateAnswerDescription",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"repeated",type:"string",name:"options",id:2},{rule:"optional",type:"uint32",name:"apiVersion",id:3,options:{default:0}}]},{name:"CreateAnswerDescriptionResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"repeated",type:"string",name:"options",id:3}]},{name:"IceCandidate",fields:[{rule:"required",type:"string",name:"candidate",id:1},{rule:"required",type:"uint32",name:"sdpMLineIndex",id:2},{rule:"required",type:"string",name:"sdpMid",id:3}]},{name:"AddIceCandidates",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"repeated",type:"IceCandidate",name:"candidates",id:2},{rule:"repeated",type:"string",name:"options",id:3},{rule:"optional",type:"uint32",name:"apiVersion",id:4,options:{default:0}}]},{name:"AddIceCandidatesResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"string",name:"options",id:2}]},{name:"UpdateStreamState",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"required",type:"string",name:"signalingState",id:2},{rule:"required",type:"string",name:"iceGatheringState",id:3},{rule:"required",type:"string",name:"iceConnectionState",id:4},{rule:"optional",type:"uint32",name:"apiVersion",id:5,options:{default:0}}]},{name:"UpdateStreamStateResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"string",name:"options",id:2}]},{name:"DestroyStream",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"optional",type:"string",name:"reason",id:2},{rule:"repeated",type:"string",name:"options",id:3}]},{name:"DestroyStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"ConnectionDisconnected",fields:[{rule:"required",type:"string",name:"connectionId",id:1},{rule:"required",type:"uint32",name:"reasonCode",id:2},{rule:"optional",type:"string",name:"description",id:3}]},{name:"ConnectionDisconnectedResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"StreamStarted",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"repeated",type:"string",name:"tags",id:3}]},{name:"SourceStreamStarted",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"repeated",type:"string",name:"capabilities",id:3},{rule:"repeated",type:"string",name:"tags",id:4}]},{name:"StreamEnded",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"string",name:"reason",id:3},{rule:"repeated",type:"string",name:"tags",id:4},{rule:"optional",type:"string",name:"continuationId",id:5},{rule:"optional",type:"string",name:"routeKey",id:6}]},{name:"SourceStreamEnded",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"string",name:"reason",id:3},{rule:"repeated",type:"string",name:"capabilities",id:4},{rule:"repeated",type:"string",name:"tags",id:5}]},{name:"StreamEndedResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"continuationId",id:2},{rule:"optional",type:"string",name:"routeKey",id:3}]},{name:"StreamIdle",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"repeated",type:"string",name:"options",id:3},{rule:"repeated",type:"string",name:"tags",id:4}]},{name:"StreamArchived",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"uint64",name:"startTime",id:4},{rule:"required",type:"string",name:"uri",id:3}]},{name:"SessionEnded",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"reason",id:2},{rule:"required",type:"float",name:"duration",id:3}]},{name:"ResourceIdle",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"routeKey",id:2}]},{name:"ResourceIdleResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"StreamPlaylist",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"PlaylistType",name:"playlistType",id:3},{rule:"required",type:"string",name:"uri",id:4},{rule:"required",type:"bool",name:"isVariant",id:5,options:{default:!0}}],enums:[{name:"PlaylistType",values:[{name:"Live",id:0},{name:"OnDemand",id:1}]}]},{name:"StreamRtmp",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"required",type:"string",name:"uri",id:2},{rule:"required",type:"uint32",name:"height",id:3},{rule:"required",type:"uint32",name:"bitrate",id:4}]},{name:"SendEventToClient",fields:[{rule:"required",type:"string",name:"connectionId",id:1},{rule:"required",type:"string",name:"type",id:2},{rule:"required",type:"bytes",name:"payload",id:3}]},{name:"SendEventToClientResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"SendRequestToClient",fields:[{rule:"required",type:"string",name:"connectionId",id:1},{rule:"required",type:"string",name:"type",id:2},{rule:"required",type:"bytes",name:"payload",id:3}]},{name:"SendRequestToClientResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"type",id:2},{rule:"optional",type:"bytes",name:"payload",id:3}]},{name:"SetupStream",fields:[{rule:"required",type:"string",name:"streamToken",id:1},{rule:"required",type:"CreateStream",name:"createStream",id:2}]},{name:"SetupStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"CreateStreamResponse",name:"createStreamResponse",id:2}]},{name:"SetupPlaylistStream",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamToken",id:2},{rule:"repeated",type:"string",name:"options",id:3},{rule:"repeated",type:"string",name:"tags",id:4}]},{name:"PlaylistStreamManifest",fields:[{rule:"required",type:"string",name:"manifest",id:1},{rule:"required",type:"bool",name:"isProtectedContent",id:2},{rule:"optional",type:"string",name:"drmToken",id:3}]},{name:"SetupPlaylistStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"PlaylistStreamManifest",name:"manifests",id:2},{rule:"optional",type:"uint64",name:"offset",id:3,options:{default:0}}]},{name:"StreamDataQuality",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"uint64",name:"timestamp",id:3},{rule:"required",type:"DataQualityStatus",name:"status",id:4},{rule:"required",type:"DataQualityReason",name:"reason",id:5}],enums:[{name:"DataQualityStatus",values:[{name:"NoData",id:0},{name:"AudioOnly",id:1},{name:"All",id:2}]},{name:"DataQualityReason",values:[{name:"None",id:0},{name:"UploadLimited",id:1},{name:"DownloadLimited",id:2},{name:"PublisherLimited",id:3},{name:"NetworkLimited",id:4}]}]},{name:"StreamDataQualityResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"CallbackEvent",fields:[{rule:"optional",type:"uint32",name:"apiVersion",id:1,options:{default:0}},{rule:"required",type:"string",name:"entity",id:2},{rule:"required",type:"string",name:"what",id:3},{rule:"required",type:"string",name:"data",id:4},{rule:"optional",type:"string",name:"sessionId",id:5}]},{name:"Uri",fields:[{rule:"optional",type:"string",name:"protocol",id:1,options:{default:"http"}},{rule:"required",type:"string",name:"host",id:2},{rule:"optional",type:"uint32",name:"port",id:3,options:{default:80}},{rule:"optional",type:"string",name:"method",id:4,options:{default:"POST"}},{rule:"optional",type:"string",name:"path",id:5,options:{default:"/"}}]},{name:"SetApplicationCallback",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"required",type:"Uri",name:"callback",id:3}]},{name:"SetApplicationCallbackResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"endpoint",id:2}]},{name:"IssueAuthenticationToken",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"repeated",type:"string",name:"capabilities",id:3}]},{name:"IssueAuthenticationTokenResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"authenticationToken",id:2}]},{name:"IssueStreamToken",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"required",type:"string",name:"sessionId",id:3},{rule:"optional",type:"string",name:"originStreamId",id:4},{rule:"repeated",type:"string",name:"alternateOriginStreamIds",id:6},{rule:"repeated",type:"string",name:"capabilities",id:5},{rule:"optional",type:"bool",name:"permissive",id:7,options:{default:!1}}]},{name:"IssueStreamTokenResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"streamToken",id:2}]},{name:"IssueDrmToken",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"optional",type:"string",name:"sessionId",id:3},{rule:"required",type:"string",name:"originStreamId",id:4},{rule:"repeated",type:"string",name:"capabilities",id:5}]},{name:"IssueDrmTokenResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"drmToken",id:2}]},{name:"TerminateStream",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"optional",type:"string",name:"streamId",id:3,oneof:"streamOrToken"},{rule:"optional",type:"string",name:"streamToken",id:5,oneof:"streamOrToken"},{rule:"optional",type:"string",name:"reason",id:4}],oneofs:{streamOrToken:[3,5]}},{name:"TerminateStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"DeleteStream",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"optional",type:"string",name:"streamId",id:3,oneof:"streamOrToken"},{rule:"optional",type:"string",name:"streamToken",id:5,oneof:"streamOrToken"},{rule:"optional",type:"string",name:"reason",id:4}],oneofs:{streamOrToken:[3,5]}},{name:"DeleteStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"Stream",fields:[{rule:"required",type:"string",name:"streamId",id:1}]},{name:"ListStreams",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"optional",type:"string",name:"start",id:3},{rule:"required",type:"uint32",name:"length",id:4},{rule:"repeated",type:"string",name:"options",id:5}]},{name:"ListStreamsResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"start",id:2},{rule:"optional",type:"uint32",name:"length",id:3},{rule:"repeated",type:"Stream",name:"streams",id:4}]},{name:"GetPlaylistUris",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"required",type:"string",name:"streamId",id:3},{rule:"repeated",type:"string",name:"options",id:4}]},{name:"GetPlaylistUrisResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"Playlist",name:"playlists",id:2},{rule:"optional",type:"StreamMetadata",name:"streamInfo",id:3}],messages:[{name:"PlaylistMetadata",fields:[{rule:"optional",type:"uint32",name:"bitrate",id:1},{rule:"optional",type:"uint32",name:"height",id:2},{rule:"optional",type:"float",name:"framesPerSecond",id:3}]},{name:"StreamMetadata",fields:[{rule:"required",type:"string",name:"startTime",id:1},{rule:"optional",type:"string",name:"endTime",id:2}]},{name:"Playlist",fields:[{rule:"required",type:"string",name:"name",id:1},{rule:"required",type:"PlaylistType",name:"type",id:2},{rule:"required",type:"string",name:"uri",id:3},{rule:"required",type:"bool",name:"isVariant",id:4},{rule:"required",type:"bool",name:"isProtected",id:5},{rule:"required",type:"PlaylistMetadata",name:"info",id:6}]}],enums:[{name:"PlaylistType",values:[{name:"Hls",id:0},{name:"Dash",id:1}]}]}]}}.apply(t,[]))||(e.exports=r)},function(e,t,i){var r,n;r=[i(0),i(1),i(38)],void 0===(n=function(r,n,s){"use strict";function e(e){n.isObject(e,"roomService"),this._roomService=e}function o(e,t,i){return i&&i.room&&(i.channel=new s(i.room),delete i.room),e(t,i)}return e.prototype.start=function(){return this._roomService.start.apply(this._roomService,arguments)},e.prototype.getChannelInfo=function(e,t,i){return e?n.isStringNotEmpty(e,"channelId"):n.isStringNotEmpty(t,"alias"),n.isFunction(i,"callback"),this._roomService.getRoomInfo(e,t,r.bind(o,null,i))},e.prototype.createChannel=function(e,t){return n.isObject(e,"channel"),n.isStringNotEmpty(e.name,"channel.name"),n.isStringNotEmpty(e.type,"channel.type"),n.isString(e.description,"channel.description"),n.isFunction(t,"callback"),this._roomService.createRoom(e,r.bind(o,null,t))},e.prototype.enterChannel=function(e,t,i){return e?n.isStringNotEmpty(e,"roomId"):n.isStringNotEmpty(t,"alias"),n.isFunction(i,"callback"),this._roomService.enterRoom(e,t,r.bind(o,null,i))},e.prototype.leaveChannel=function(){return this._roomService.leaveRoom.apply(this._roomService,arguments)},e.prototype.getChatService=function(){return this._roomService.getChatService.apply(this._roomService,arguments)},e.prototype.getSelf=function(){return this._roomService.getSelf.apply(this._roomService,arguments)},e.prototype.getObservableActiveChannel=function(){return this._roomService.getObservableActiveRoom.apply(this._roomService,arguments)},e.prototype.updateSelf=function(){return this._roomService.updateSelf.apply(this._roomService,arguments)},e.prototype.updateMember=function(){return this._roomService.updateMember.apply(this._roomService,arguments)},e.prototype.updateChannel=function(){return this._roomService.updateRoom.apply(this._roomService,arguments)},e.prototype.revertChannelChanges=function(){return this._roomService.revertRoomChanges.apply(this._roomService,arguments)},e.prototype.revertMemberChanges=function(){return this._roomService.revertMemberChanges.apply(this._roomService,arguments)},e.prototype.isInChannel=function(){return this._roomService.isInRoom.apply(this._roomService,arguments)},e.prototype.toString=function(){return"ChannelService"},e.prototype.stop=function(){return this._roomService.stop.apply(this._roomService,arguments)},e}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(1),i(4),i(40)],void 0===(n=function(t,e,i,u){"use strict";function r(e,t,i,r,n,s,o,a,l){this.init(e,t,i,r,n,s,o,a,l)}function n(){throw new Error("ImmutableRoom is Immutable")}function s(){throw new Error("Unable to subscribe to Immutable [ImmutableRoom]")}function c(e){t.isArray(e)?t.forEach(e,function(e){o(e)}):t.isObject(e)&&t.forOwn(e,function(e){o(e)})}function o(e){!function(e){if(e instanceof i.Observable||e instanceof i.ObservableArray){e.setValue=n,e.subscribe=s;var t=e.getValue();c(t)}}(e),c(e)}return r.prototype.init=function(e,t,i,r,n,s,o,a,l){this._room=new u(null,t,i,r,n,s,o,a,l),c(this._room)},r.prototype.getRoomId=function(){return this._room.getRoomId()},r.prototype.getObservableAlias=function(){return this._room.getObservableAlias()},r.prototype.getObservableName=function(){return this._room.getObservableName()},r.prototype.getObservableDescription=function(){return this._room.getObservableDescription()},r.prototype.getObservableType=function(){return this._room.getObservableType()},r.prototype.getObservableMembers=function(){return this._room.getObservableMembers()},r.prototype.getObservableBridgeId=function(){return this._room.getObservableBridgeId()},r.prototype.getObservablePin=function(){return this._room.getObservablePin()},r.prototype.toString=function(){return this._room.toString()},r.prototype.toJson=function(){return this._room.toJson()},r.prototype.commitChanges=n,r.prototype.reload=n,r.prototype._update=n,r.prototype._addMembers=n,r.prototype._removeMembers=n,r.prototype._updateMembers=n,r}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(1),i(2)],void 0===(n=function(s,o){"use strict";var a=/profile-level-id=[^;\n]*/;function e(){}return e.prototype.getH264ProfileIds=function(e){o.isStringNotEmpty(e,"offerSdp");for(var t=[],i=e.match(a),r=e;i;){var n=s.get(i,"0","");t.push(n.split("=")[1]),i=(r=r.substring(i.index+n.length,e.length)).match(a)}return t},e.prototype.replaceH264ProfileId=function(e,t,i){o.isStringNotEmpty(e,"offerSdp"),o.isStringNotEmpty(i,"newProfileId");var r=this.getH264ProfileIds(e);return s.includes(r,t)?e.replace("profile-level-id="+t,"profile-level-id="+i):e},e.prototype.getH264ProfileIdWithSameProfileAndEqualToOrHigherLevel=function(e,t){if(s.includes(e,t))return t;var i=s.reduce(e,function(e,t){var i=parseInt(e.substring(0,2),16),r=parseInt(e.substring(4,6),16),n=parseInt(t.substring(0,2),16),s=parseInt(t.substring(4,6),16);return i!==n?e:s<=r?e:t},t);return i===t?null:i},e.prototype.getH264ProfileIdWithSameOrHigherProfileAndEqualToOrHigherLevel=function(e,t){var i=this.getH264ProfileIdWithSameProfileAndEqualToOrHigherLevel(e,t);if(i)return i;var r=s.reduce(e,function(e,t){var i=parseInt(e.substring(0,2),16),r=parseInt(e.substring(4,6),16),n=parseInt(t.substring(0,2),16),s=parseInt(t.substring(4,6),16);return i<n?t:n<i?e:s<r?e:t},t);return r===t?null:r},new e}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(1),i(5),i(6),i(3),i(2),i(13),i(9),i(7)],void 0===(n=function(u,t,s,e,i,n,r,o,c){"use strict";var a=5e3,l=5,d=250,h=6e3,p=15e3;function f(e,t,i,r,n){this._logger=n,this._streamId=e,this._playlistUri=encodeURI(t).replace(/[#]/g,"%23"),this._bufferSizeHistory=[],this._streamTelemetry=i,this._options=r,this._element=null,this._dimensionsChangedMonitor=new o(n),this._lastProgress={time:0,buffered:null,averageLength:0,count:0,setupRetry:0,lastCurrentTime:0,lastCurrentTimeOccurenceTimestamp:0},this._namedEvents=new s.NamedEvents,this._onStalled=u.bind(v,this),this._onProgress=u.bind(y,this),this._onEnded=u.bind(b,this),this._onError=u.bind(g,this),this._onWaiting=u.bind(_,this)}function m(e){n.attachUriStream(e,this._playlistUri),!1===this._options.receiveAudio&&(e.muted=!0),u.addEventListener(e,"error",this._onError,!0),u.addEventListener(e,"stalled",this._onStalled,!1),u.addEventListener(e,"pause",this._onStalled,!1),u.addEventListener(e,"suspend",this._onStalled,!1),u.addEventListener(e,"progress",this._onProgress,!1),u.addEventListener(e,"ended",this._onEnded,!1),u.addEventListener(e,"waiting",this._onWaiting,!1),this._element=e,this._dimensionsChangedMonitor.start(this,this._element)}function g(e){var t=this,i=d*t._lastProgress.setupRetry*t._lastProgress.setupRetry,r=0===t._lastProgress.count,n=t._lastProgress.setupRetry<=l;if(4===u.get(this._element,["error","code"])&&r&&n)return setTimeout(function(){t._lastProgress.setupRetry++,E.call(t)},Math.max(i,d));this._namedEvents.fire(c.rendererEvents.error.name,["player",e])}function y(){if(this._lastProgress.time=u.now(),0===this._element.buffered.length)return this._logger.debug("[%s] Hls stream progress event fired without any buffered content",this._streamId);var e=this._element.buffered.end(this._element.buffered.length-1);if(this._lastProgress.buffered!==e){if(null!==this._lastProgress.buffered){var t=this._lastProgress.averageLength*this._lastProgress.count+(e-this._lastProgress.buffered);this._lastProgress.count+=1,this._lastProgress.averageLength=t/this._lastProgress.count,this._lastProgress.lastCurrentTime!==this._element.currentTime&&(this._lastProgress.lastCurrentTimeOccurenceTimestamp=u.now()),this._lastProgress.lastCurrentTimeOccurenceTimestamp&&u.now()-this._lastProgress.lastCurrentTimeOccurenceTimestamp>h&&this._element&&!this._element.paused&&w.call(this)&&(this._logger.warn("Reloading stream after current time has not changed for [%s] seconds due to unregistered stall.",h/1e3),S.call(this))}this._lastProgress.buffered=e,this._lastProgress.setupRetry=0,this._lastProgress.lastCurrentTime=this._element.currentTime}}function v(){if(this._logger.info("[%s] Loading Hls stream stalled.",this._streamId),this._lastProgress.setupRetry>l)return this._logger.warn("[%s] Unable to recover from stalled Hls Stream.",this._streamId);var e=this,t=this._element.currentTime;0===this._lastProgress.count?(this._lastProgress.setupRetry++,E.call(e)):(setTimeout(function(){0===e._lastProgress.count&&(e._lastProgress.setupRetry++,E.call(e))},T.call(e)),setTimeout(function(){e._element&&e._element.currentTime===t&&!e._element.paused&&w.call(e)&&(e._logger.warn("Reloading stream after being stalled for [%s] seconds",h/1e3),S.call(e))},h),setTimeout(u.bind(k,e),a))}function b(){this._logger.info("[%s] Hls stream ended",this._streamId),this.stop("ended")}function _(){this._logger.info("Time elapsed since last progress [%s]",u.now()-this._lastProgress.time),setTimeout(u.bind(k,this),T.call(this))}function w(){var e=!this._lastReloadTime||u.now()-this._lastReloadTime>p;return this._element&&!this._waitForLastChunk&&0!==this._element.buffered.length&&e}function S(){w.call(this)&&(this._logger.warn("Reloading unhealthy stream that was active for at least [%s] seconds",p/1e3),this._lastReloadTime=u.now(),E.call(this))}function E(){this._logger.info("[%s] Attempting to reload Hls stream.",this._streamId);try{this._element.setAttribute("src",""),this._element.setAttribute("src",this._playlistUri)}catch(e){this._logger.warn("Error while reloading Hls stream [%s]",e)}}function T(){return 1.5*this._lastProgress.averageLength<2e3?2e3:1.5*this._lastProgress.averageLength}function k(){u.now()-this._lastProgress.time>T.call(this)&&this._waitForLastChunk&&this.stop("ended")}function I(e){if(e){if(clearTimeout(this._backgroundTimeout),this._backgroundTimeout=null,!this._backgroundThrottled)return;return this._backgroundThrottled=!1,void this.start(this._element)}var t=this;this._backgroundTimeout=setTimeout(function(){r.isForeground()||function(e){if(e.muted)return!1;return 0<u.get(e,["webkitAudioDecodedByteCount"],0)||0<u.get(e,["audioTracks","length"],0)||e.webkitHasAudio}(t._element)||(t._logger.info("Detecting application [background] with muted video. Pausing playback until application focused again."),t._element.pause(),t._backgroundThrottled=!0)},3e3)}return f.prototype.on=function(e,t){return this._namedEvents.listen(e,t)},f.prototype.start=function(e){try{var t=u.now()-this._options.originStartTime;this._disposables=new i.DisposableList,this._disposables.add(r.onBackground(u.bind(I,this,!1))),this._disposables.add(r.onForeground(u.bind(I,this,!0))),this._streamTelemetry.recordTimeToFirstFrame(e),this._streamTelemetry.recordRebuffering(e),this._streamTelemetry.recordVideoResolutionChanges(this,e),t<6e3&&this._options.isDrmProtectedContent?setTimeout(u.bind(m,this,e),6e3):m.call(this,e)}catch(e){this._logger.error("[%s] Error while loading HLS live stream [%s]",this._streamId,e.code,e),this._namedEvents.fire(c.rendererEvents.error.name,["hls",e])}return e},f.prototype.stop=function(e,t){var i=this;if(!i._waitingForFinalization){if(t)return i._waitForLastChunk=!0;if(this._dimensionsChangedMonitor.stop(),this._streamTelemetry.stop(),this._disposables.dispose(),this._element){var r=function(){i._element&&(u.removeEventListener(i._element,"error",i._onError,!0),u.removeEventListener(i._element,"stalled",i._onStalled,!1),u.removeEventListener(i._element,"pause",i._onStalled,!1),u.removeEventListener(i._element,"suspend",i._onStalled,!1),u.removeEventListener(i._element,"progress",i._onProgress,!1),u.removeEventListener(i._element,"ended",i._onEnded,!1),u.removeEventListener(i._element,"waiting",i._onWaiting,!1),"Safari"===n.browser&&11<=n.browserVersion?i._element.setAttribute("src",""):i._element.src="",i._element=null);i._namedEvents.fire(c.rendererEvents.ended.name,[""])};try{i._element.pause(),i._logger.info("[%s] HLS live stream has been destroyed",i._streamId),r()}catch(e){i._logger.error("[%s] Error while destroying HLS live stream [%s]",i._streamId,e.code,e),r(),i._namedEvents.fire(c.rendererEvents.error.name,["hls",e])}i._waitingForFinalization=!0}}},f.prototype.getStats=function(){if(!this._element)return{width:0,height:0,currentTime:0,lag:0,networkState:c.networkStates.networkNoSource.id};var e=this._element&&this._element.currentTime||0,t=this._element&&this._element.buffered&&0<this._element.buffered.length?this._element.buffered.end(this._element.buffered.length-1):0,i=Math.max(0,t-e);this._bufferSizeHistory.push(i),15<this._bufferSizeHistory.length&&this._bufferSizeHistory.shift();for(var r=0,n=0,s=this._bufferSizeHistory.length;n<s;n++)r=Math.max(r,this._bufferSizeHistory[n]);var o=(u.now()-this._options.originStartTime)/1e3,a=4+r,l=o-a;return{width:this._element.videoWidth||this._element.width,height:this._element.videoHeight||this._element.height,currentTime:l,originTime:o,lag:a,networkState:this._element.networkState}},f.prototype.setDataQualityChangedCallback=function(e){t.isFunction(e,"callback"),this.dataQualityChangedCallback=e},f.prototype.getPlayer=function(){return null},f.prototype.addVideoDisplayDimensionsChangedCallback=function(e,t){this._dimensionsChangedMonitor.addVideoDisplayDimensionsChangedCallback(e,t)},f}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(1),i(5),i(2),i(93),i(88),i(90),i(7)],void 0===(n=function(e,i,a,t,r,n,s,o){"use strict";function l(e,t,i,r,n,s,o){this._type=e,this._streamId=t,this._uri=i,this._streamTelemetry=r,this._options=n,this._shaka=s,this._logger=o,this._renderer=null,this._element=null,this._dimensionsChangedMonitor=null,this._namedEvents=new a.NamedEvents}return l.prototype.on=function(e,t){this._namedEvents.listen(e,t)},l.prototype.createRenderer=function(){switch(this._type){case o.types.dash.name:this._shaka?this._renderer=new r(this._streamId,this._uri,this._streamTelemetry,this._options,this._shaka,this._logger):this._renderer=new s(this._streamId,this._uri,this._streamTelemetry,this._options,this._logger);break;case o.types.hls.name:s.isSupported()&&!this._options.useNativeHlsPlayer?this._renderer=new s(this._streamId,this._uri,this._streamTelemetry,this._options,this._logger):this._renderer=new n(this._streamId,this._uri,this._streamTelemetry,this._options,this._logger);break;default:throw new Error("Unsupported Live stream Type "+this._type)}var i=this;return this._renderer.on(o.rendererEvents.error.name,function(e,t){i._namedEvents.fire(o.streamEvents.playerError.name,[e,t])}),this._renderer.on(o.rendererEvents.ended.name,function(e){i._namedEvents.fire(o.streamEvents.playerEnded.name,[e])}),this._renderer},l.prototype.select=function(e){return this._logger.warn("[%s] selection of tracks not supported for [%s] live streams",this._streamId,this._type),this},l.prototype.setStreamEndedCallback=function(e){i.isFunction(e,"callback"),this.streamEndedCallback=e},l.prototype.setStreamErrorCallback=function(e){i.isFunction(e,"callback"),this.streamErrorCallback=e},l.prototype.stop=function(e){this.isActive()&&(this._logger.info("[%s] stop media stream",this._streamId),this._namedEvents.fire(o.streamEvents.stopped.name,[e]),this._isStopped=!0)},l.prototype.monitor=function(e,t){i.isObject(e,"options"),i.isFunction(t,"callback")},l.prototype.getMonitor=function(){return null},l.prototype.getStream=function(){return this._logger.debug("[%s] stream not available for [%s] live streams",this._streamId,this._type),null},l.prototype.isActive=function(){return!this._isStopped},l.prototype.getStreamId=function(){return this._streamId},l.prototype.getStats=function(){return this._logger.debug("[%s] stats not available for [%s] live streams",this._streamId,this._type),null},l.prototype.getRenderer=function(){return this._renderer},l}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(1),i(8),i(5),i(6),i(29),i(2),i(9),i(7)],void 0===(n=function(s,t,o,a,e,l,n,u,c){"use strict";var r=6e3,i=15e3;function d(e,t,i,r,n){this._logger=n,this._streamId=e,this._manifestUri=encodeURI(t).replace(/[#]/g,"%23"),this._streamTelemetry=i,this._options=r,this._renderer=null,this._element=null,this._dimensionsChangedMonitor=new u(n),this._lastProgress={time:0,buffered:null,averageLength:0,count:0,lastCurrentTime:0,lastCurrentTimeOccurenceTimestamp:0},this._namedEvents=new a.NamedEvents,this._onStalled=s.bind(g,this),this._onProgress=s.bind(m,this),this._onEnded=s.bind(v,this)}function h(e){if(f.call(this)&&e&&(3===e.code||e.severity===l.errors.severity.RECOVERABLE))return p.call(this);this._namedEvents.fire(c.rendererEvents.error.name,["phenix-player",e])}function p(){f.call(this)&&(this._logger.warn("Reloading unhealthy stream that was active for at least [%s] seconds",i/1e3),this._lastReloadTime=s.now(),function(){this._player.dispose(),this._player=null,this.start(this._element)}.call(this))}function f(){var e=!this._lastReloadTime||s.now()-this._lastReloadTime>i;return this._element&&!this._waitForLastChunk&&this._player&&0!==this._element.buffered.length&&e}function m(){if(this._lastProgress.time=s.now(),0===this._element.buffered.length)return this._logger.debug("[%s] Phenix live stream player progress event fired without any buffered content",this._streamId);var e=this._element.buffered.end(this._element.buffered.length-1);if(this._lastProgress.buffered!==e){if(null!==this._lastProgress.buffered){var t=this._lastProgress.averageLength*this._lastProgress.count+(e-this._lastProgress.buffered);this._lastProgress.count+=1,this._lastProgress.averageLength=t/this._lastProgress.count,this._lastProgress.lastCurrentTime!==this._element.currentTime&&(this._lastProgress.lastCurrentTimeOccurenceTimestamp=s.now()),this._lastProgress.lastCurrentTimeOccurenceTimestamp&&s.now()-this._lastProgress.lastCurrentTimeOccurenceTimestamp>r&&this._element&&!this._element.paused&&f.call(this)&&(this._logger.warn("Reloading stream after current time has not changed for [%s] seconds due to unregistered stall.",r/1e3),p.call(this))}this._lastProgress.buffered=e,this._lastProgress.lastCurrentTime=this._element.currentTime}}function g(e){var t=this;if(t._logger.info("[%s] Loading Phenix Live stream player stalled caused by [%s] event.",t._streamId,e.type),0!==t._lastProgress.time){var i=t._element.currentTime;setTimeout(function(){s.now()-t._lastProgress.time>y.call(t)&&t._waitForLastChunk&&t.stop("ended")},y.call(t)),setTimeout(function(){t._element&&t._element.currentTime===i&&!t._element.paused&&f.call(t)&&(t._logger.warn("Reloading stream after being stalled for [%s] seconds",r/1e3),p.call(t))},r)}}function y(){return 1.5*this._lastProgress.averageLength<2e3?2e3:1.5*this._lastProgress.averageLength}function v(){this._logger.info("[%s] Phenix live stream player ended.",this._streamId)}return d.isSupported=function(){return l.isSupported},d.prototype.on=function(e,t){return this._namedEvents.listen(e,t)},d.prototype.start=function(e){var t,i,r,n=(t=this._logger,i=t.getAppenders(),r=new o.Logger,s.forEach(i,function(e){e instanceof o.ConsoleAppender&&(e=new o.ConsoleAppender).setThreshold(o.level.INFO),r.addAppender(e)}),r.setUserId(t.getUserId()),r.setEnvironment(t.getEnvironment()),r.setApplicationVersion(t.getApplicationVersion()),r.setObservableSessionId(t.getObservableSessionId()),r);return this._throttledLogger=n,this._element=e,this._streamTelemetry.recordTimeToFirstFrame(e),this._streamTelemetry.recordRebuffering(e),this._streamTelemetry.recordVideoResolutionChanges(this,e),this._streamTelemetry.recordVideoPlayingAndPausing(e),function(){var e=this,t=s.assign({bandwidthToStartAt:3e6},e._options);s.isNumber(e._options.targetMinBufferSize)&&(t.targetMinBufferSize=e._options.targetMinBufferSize,t.targetBufferSizeInMS=1e3*e._options.targetMinBufferSize);s.includes(this._manifestUri,".mpd")&&e._options.isDrmProtectedContent&&(t.drm={"com.widevine.alpha":{serverCertificateUrl:e._options.widevineServiceCertificateUrl,mediaKeySystemConfiguration:{persistentState:"required"}},"com.microsoft.playready":{licenseServerUrl:e._options.playreadyLicenseUrl}});var i=new l.WebPlayer(this._throttledLogger,this._element,t);s.now()-this._options.originStartTime<6e3&&this._options.isDrmProtectedContent&&s.includes(this._manifestUri,".m3u8")?setTimeout(s.bind(i.start,i,e._manifestUri),6e3):i.start(e._manifestUri);e._player=i,s.addEventListener(e._player,"error",s.bind(h,e))}.call(this),!1===this._options.receiveAudio&&(e.muted=!0),s.addEventListener(e,"stalled",this._onStalled,!1),s.addEventListener(e,"pause",this._onStalled,!1),s.addEventListener(e,"suspend",this._onStalled,!1),s.addEventListener(e,"progress",this._onProgress,!1),s.addEventListener(e,"ended",this._onEnded,!1),this._dimensionsChangedMonitor.start(this,e),e},d.prototype.stop=function(e,t){var i=this;if(!i._waitingForFinalization){if(t)return i._waitForLastChunk=!0;if(this._dimensionsChangedMonitor.stop(),this._streamTelemetry.stop(),this._player){var r=function(){i._element&&(s.removeEventListener(i._element,"stalled",i._onStalled,!1),s.removeEventListener(i._element,"pause",i._onStalled,!1),s.removeEventListener(i._element,"suspend",i._onStalled,!1),s.removeEventListener(i._element,"progress",i._onProgress,!1),s.removeEventListener(i._element,"ended",i._onEnded,!1),"Edge"===n.browser&&(i._element.src="")),i._namedEvents.fire(c.rendererEvents.ended.name,[""]),i._player=null,i._element=null};i._waitingForFinalization=!0;try{i._player.dispose(),i._logger.info("[%s] Phenix live stream has been destroyed",i._streamId),r()}catch(e){i._logger.error("[%s] Error while destroying Phenix live stream player [%s]",i._streamId,e.code,e),r(),i._namedEvents.fire(c.rendererEvents.error.name,["phenix-player",e])}}}},d.prototype.getStats=function(){if(!this._player)return{width:0,height:0,currentTime:0,lag:0,networkState:c.networkStates.networkNoSource.id};var e=this._player.getStats(),t=e.currentTime||this._element.currentTime,i=(s.now()-this._options.originStartTime)/1e3;return e.isNative&&"Hls"===e.deliveryType&&(e.currentTime=i-e.lag),e.isNative||(e.lag=Math.max(0,i-t)),0<e.estimatedBandwidth?e.networkState=c.networkStates.networkLoading.id:0<e.playTime?e.networkState=c.networkStates.networkIdle.id:e.video?e.networkState=c.networkStates.networkEmpty.id:e.networkState=c.networkStates.networkNoSource.id,e},d.prototype.setDataQualityChangedCallback=function(e){t.isFunction(e,"callback"),this.dataQualityChangedCallback=e},d.prototype.getPlayer=function(){return this._player},d.prototype.addVideoDisplayDimensionsChangedCallback=function(e,t){this._dimensionsChangedMonitor.addVideoDisplayDimensionsChangedCallback(e,t)},d}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(1),i(5),i(6),i(2),i(9),i(7)],void 0===(n=function(s,t,o,e,i,a,r){"use strict";function n(e,t,i,r,n){this._logger=n,this._streamId=e,this._streamSrc=t,this._streamTelemetry=i,this._options=r,this._renderer=null,this._element=null,this._dimensionsChangedMonitor=new a(n),this._namedEvents=new o.NamedEvents,this._onStalled=s.bind(l,this),this._onEnded=s.bind(u,this)}function l(e){this._logger.info("[%s] Loading Phenix Real-Time stream player stalled caused by [%s] event.",this._streamId,e.type)}function u(){this._logger.info("[%s] Phenix Real-Time stream ended.",this._streamId)}return n.prototype.on=function(e,t){return this._namedEvents.listen(e,t)},n.prototype.start=function(e){var t=!!s.find(this._streamSrc.getTracks(),function(e){return"audio"===e.kind});return this._options.canPlaybackAudio||(this._options.disableAudioIfNoOutputFound&&this._options.forcedAudioDisabled?this._logger.warn("[%s] Missing audio playback device. Audio has been disabled on stream. Try setting up an audio device and re-subscribe in order to receive audio.",this._streamId):!this._options.disableAudioIfNoOutputFound&&t&&this._logger.warn("[%s] Missing audio playback device. May experience audio and/or video failure. Try setting up an audio device OR pass the [disableAudioIfNoOutputFound] option when subscribing to disable audio playback when no devices are attached.",this._streamId)),this._element=i.attachMediaStream(e,this._streamSrc),this._streamTelemetry.recordTimeToFirstFrame(e),this._streamTelemetry.recordRebuffering(e),this._streamTelemetry.recordVideoResolutionChanges(this,e),this._streamTelemetry.recordVideoPlayingAndPausing(e),!1===this._options.receiveAudio&&(e.muted=!0),s.addEventListener(e,"stalled",this._onStalled,!1),s.addEventListener(e,"pause",this._onStalled,!1),s.addEventListener(e,"suspend",this._onStalled,!1),s.addEventListener(e,"ended",this._onEnded,!1),this._dimensionsChangedMonitor.start(this,e),e},n.prototype.stop=function(e){this._dimensionsChangedMonitor.stop(),this._streamTelemetry.stop(),this._element&&(s.removeEventListener(this._element,"stalled",this._onStalled,!1),s.removeEventListener(this._element,"pause",this._onStalled,!1),s.removeEventListener(this._element,"suspend",this._onStalled,!1),s.removeEventListener(this._element,"ended",this._onEnded,!1),"function"==typeof this._element.pause&&this._element.pause(),"Edge"===i.browser&&(this._element.src=""),this._element.src&&"IE"===i.browser?this._element.src=null:this._element.src&&(this._element.src=""),this._element.srcObject&&(this._element.srcObject=null),this._element=null),this._logger.info("[%s] Phenix real-time renderer has been destroyed",this._streamId),this._namedEvents.fire(r.rendererEvents.ended.name,[e])},n.prototype.getStats=function(){if(!this._element)return{width:0,height:0,currentTime:0,lag:0,networkState:r.networkStates.networkNoSource.id};var e=(s.now()-this._options.originStartTime)/1e3,t=this._options.networkLag/1e3;return{width:this._element.videoWidth||this._element.width,height:this._element.videoHeight||this._element.height,currentTime:e,lag:t,networkState:this._element.networkState}},n.prototype.setDataQualityChangedCallback=function(e){t.isFunction(e,"callback"),this.dataQualityChangedCallback=e},n.prototype.addVideoDisplayDimensionsChangedCallback=function(e,t){this._dimensionsChangedMonitor.addVideoDisplayDimensionsChangedCallback(e,t)},n}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(1),i(5),i(2),i(42),i(43),i(91),i(7)],void 0===(n=function(o,a,l,u,r,n,e,c){"use strict";var t=5e3;function d(e,t,i,r,n,s){this._streamId=e,this._streamSrc=t,this._peerConnection=i,this._streamTelemetry=r,this._options=n,this._logger=s,this._renderer=null,this._element=null,this._dimensionsChangedMonitor=null,this._namedEvents=new l.NamedEvents,this._childrenStreams=[],o.addEventListener(i,"iceconnectionstatechange",o.bind(p,this))}function h(e){return o.reduce(e.getTracks(),function(e,t){return e&&(i=t,a.isObject(i,"track"),"ended"===i.readyState);var i},!0)}function p(){var e=this;switch(this._peerConnection.iceConnectionState){case"checking":case"connecting":if(o.isNumber(this._connectionSuccessTimeout))return;this._connectionStart=o.now(),this._connectionSuccessTimeout=setTimeout(function(){e._logger.warn("[%s] Stream has not connected withing [%s] ms.",e._streamId,t),e._namedEvents.fire(c.streamEvents.playerError.name,["real-time",new Error("connection-timeout")])},t);break;case"connected":o.isNumber(this._connectionSuccessTimeout)&&(clearTimeout(this._connectionSuccessTimeout),this._connectionSuccessTimeout=null),this._logger.info("[%s] Ice Connection completed after [%s] ms",this._streamId,o.now()-this._connectionStart),this._connectionStart=null}}return d.prototype.on=function(e,t){this._namedEvents.listen(e,t)},d.prototype.createRenderer=function(){var i=this;return this._renderer=new e(this._streamId,this._streamSrc,this._streamTelemetry,this._options,this._logger),this._renderer.on(c.rendererEvents.error.name,function(e,t){i._namedEvents.fire(c.streamEvents.playerError.name,[e,t])}),this._renderer.on(c.rendererEvents.ended.name,function(e){i._namedEvents.fire(c.streamEvents.playerEnded.name,[e])}),this._renderer},d.prototype.select=function(e){a.isFunction(e,"trackSelectCallback"),a.isFunction(u.global.MediaStream,"rtc.global.MediaStream");for(var t=this._streamSrc.getTracks(),i=new u.global.MediaStream,r=0;r<t.length;r++)e(t[r],r)&&i.addTrack(t[r]);if(0===i.getTracks().length)return this._logger.warn("No tracks selected");var n=this,s=new d(this._streamId,i,this._peerConnection,this._streamTelemetry,this._options,this._logger);return s.on(c.streamEvents.stopped.name,function(e){h(n._streamSrc)&&n._namedEvents.fire(c.streamEvents.stopped.name,[e])}),this._childrenStreams.push(s),s},d.prototype.setStreamEndedCallback=function(e){a.isFunction(e,"callback"),this._streamEndedCallback=e},d.prototype.setStreamErrorCallback=function(e){a.isFunction(e,"callback"),this._streamErrorCallback=e},d.prototype.streamEndedCallback=function(e,t,i){o.forEach(this._childrenStreams,function(e){e.streamEndedCallback(t,i)}),o.isFunction(this._streamEndedCallback)&&this._streamEndedCallback(this,t,i)},d.prototype.streamErrorCallback=function(e,t,i){o.forEach(this._childrenStreams,function(e){e.streamErrorCallback(t,i)}),o.isFunction(this._streamErrorCallback)&&this._streamErrorCallback(e,t,i)},d.prototype.stop=function(e){this.isActive()&&(!function(e){e&&o.isFunction(e.stop,"stream.stop")&&e.stop();o.forEach(e&&e.getTracks?e.getTracks():[],function(e){e.stop()})}(this._streamSrc),this._logger.info("[%s] stop media stream",this._streamId),this._namedEvents.fire(c.streamEvents.stopped.name,[e]),this._isStopped=!0)},d.prototype.monitor=function(e,i){a.isObject(e,"options"),a.isFunction(i,"callback");var r=this,t=new n(r._streamId,r._peerConnection,r._logger);return e.direction="inbound",t.start(e,function(){return r.isActive()},function(e,t){return e&&r._logger.warn("[%s] Media stream monitor triggered unrecoverable error [%s]",e),r._logger.warn("[%s] Media stream triggered monitor condition for [%s]",r._streamId,t.type),i(r,"client-side-failure",t)}),this._monitor=t},d.prototype.getMonitor=function(){return this._monitor},d.prototype.getStream=function(){return this._streamSrc},d.prototype.isActive=function(){return!this._isStopped&&!h(this._streamSrc)},d.prototype.getStreamId=function(){return this._streamId},d.prototype.getStats=function(t){a.isFunction(t,"callback"),this._lastStats||(this._lastStats={});var i=this;return u.getStats(this._peerConnection,null,function(e){t(r.convertPeerConnectionStats(e,i._lastStats))})},d.prototype.getRenderer=function(){return this._renderer},d}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(1),i(5),i(6),i(2),i(9),i(7)],void 0===(n=function(o,t,a,n,c,l,s){"use strict";var u=null;function e(e,t,i,r,n,s){this._logger=s,this._streamId=e,this._manifestUri=encodeURI(t).replace(/[#]/g,"%23"),this._streamTelemetry=i,this._options=r,this._renderer=null,this._element=null,this._dimensionsChangedMonitor=new l(s),this._lastProgress={time:0,buffered:null,averageLength:0,count:0},this._namedEvents=new a.NamedEvents,this._shaka=n,this._onStalled=o.bind(h,this),this._onProgress=o.bind(d,this),this._onEnded=o.bind(p,this)}function d(){if(this._lastProgress.time=o.now(),0===this._element.buffered.length)return this._logger.debug("[%s] Shaka live stream player progress event fired without any buffered content",this._streamId);var e=this._element.buffered.end(this._element.buffered.length-1);if(this._lastProgress.buffered!==e){if(null!==this._lastProgress.buffered){var t=this._lastProgress.averageLength*this._lastProgress.count+(e-this._lastProgress.buffered);this._lastProgress.count+=1,this._lastProgress.averageLength=t/this._lastProgress.count}this._lastProgress.buffered=e}}function h(){var e=this;e._logger.info("[%s] Loading Shaka live stream player stream stalled.",e._streamId),0!==e._lastProgress.time&&setTimeout(function(){o.now()-e._lastProgress.time>i.call(e)&&e._waitForLastChunk&&e.stop("ended")},i.call(e))}function i(){return 1.5*this._lastProgress.averageLength<2e3?2e3:1.5*this._lastProgress.averageLength}function p(){this._logger.info("[%s] Shaka live stream player ended.",this._streamId)}return e.prototype.on=function(e,t){return this._namedEvents.listen(e,t)},e.prototype.start=function(t){var i=this;i._player=new this._shaka.Player(t),i._streamTelemetry.recordTimeToFirstFrame(t),i._streamTelemetry.recordRebuffering(t),i._streamTelemetry.recordVideoResolutionChanges(this,t);var e={abr:{defaultBandwidthEstimate:2e6},manifest:{retryParameters:{timeout:1e4}},streaming:{rebufferingGoal:2,bufferingGoal:10,bufferBehind:30,retryParameters:{timeout:1e4,maxAttempts:10,backoffFactor:1.1}}};function r(e){i._player.configure(e),!1===i._options.receiveAudio&&(t.muted=!0),o.addEventListener(i._player,"error",function(e){i._namedEvents.fire(s.rendererEvents.error.name,["player",e])}),o.addEventListener(t,"stalled",i._onStalled,!1),o.addEventListener(t,"pause",i._onStalled,!1),o.addEventListener(t,"suspend",i._onStalled,!1),o.addEventListener(t,"progress",i._onProgress,!1),o.addEventListener(t,"ended",i._onEnded,!1),i._player.load(i._manifestUri).then(function(){i._logger.info("[%s] DASH live stream has been loaded",i._streamId),o.isFunction(t.play)&&t.play()}).catch(function(e){i._logger.error("[%s] Error while loading DASH live stream [%s]",i._streamId,e.code,e),i._namedEvents.fire(s.rendererEvents.error.name,["shaka",e])}),i._dimensionsChangedMonitor.start(this,t),i._element=t}return this._options.isDrmProtectedContent?(function(){var e;if(!o.isFunction(Uint8Array))throw e="Uint8Array support required for DRM",this._logger.error(e),new Error(e);if(!o.isFunction(c.global.atob))throw e="rtc.global.atob support required for DRM",this._logger.error(e),new Error(e)}.call(i),function(l){var u=this;l.getNetworkingEngine().registerResponseFilter(function(e,t){if(e.toString()===u._shaka.net.NetworkingEngine.RequestType.LICENSE.toString()){var i=new Uint8Array(t.data),r=String.fromCharCode.apply(null,i),n=JSON.parse(r),s=n.license,o=c.global.atob(s);t.data=new Uint8Array(o.length);for(var a=0;a<o.length;++a)t.data[a]=o.charCodeAt(a);n.trackRestrictions&&l.configure({restrictions:n.trackRestrictions})}})}.call(i,i._player),function(e,t,i){e.drm||(e.drm={});e.drm.advanced||(e.drm.advanced={});e.manifest||(e.manifest={});e.manifest.dash||(e.manifest.dash={});(function(i,e,r){function t(e,t){e?r(e):(u=t.data,i.drm.advanced["com.widevine.alpha"]={serverCertificate:function(e){for(var t=e.length,i=new Uint8Array(t),r=0;r<t;r++)i[r]=e.charCodeAt(r);return i}(t.data),persistentStateRequired:!0,distinctiveIdentifierRequired:!1},r(null,i))}i.manifest.dash.customScheme=function(e){if("com.phenixrts.widevine"===e.getAttribute("schemeIdUri")||"com.phenixp2p.widevine"===e.getAttribute("schemeIdUri"))return[{keySystem:"com.widevine.alpha",licenseServerUri:decodeURIComponent(e.getAttribute("widevineLicenseServerUrl"))}]},u?t(null,u):n.get(e.widevineServiceCertificateUrl,{mimeType:"text/plain; charset=x-user-defined"},t)}).call(this,e,t,i)}.call(i,e,i._options,function(e,t){if(e)throw i._logger.error("Failed to add DRM configuration to shaka player",e),e;r(t)})):r(e),t},e.prototype.stop=function(e,t){var i=this;if(!i._waitingForFinalization){if(t)return i._waitForLastChunk=!0;if(this._dimensionsChangedMonitor.stop(),this._streamTelemetry.stop(),this._player){var r=function(){i._element&&(o.removeEventListener(i._element,"stalled",i._onStalled,!1),o.removeEventListener(i._element,"pause",i._onStalled,!1),o.removeEventListener(i._element,"suspend",i._onStalled,!1),o.removeEventListener(i._element,"progress",i._onProgress,!1),o.removeEventListener(i._element,"ended",i._onEnded,!1),"Edge"===c.browser&&(i._element.src="")),i._namedEvents.fire(s.rendererEvents.ended.name,[""]),i._player=null,i._element=null};i._player.destroy().then(function(){i._logger.info("[%s] Shaka live stream player has been destroyed",i._streamId)}).then(function(){r()}).catch(function(e){i._logger.error("[%s] Error while destroying shaka live stream player [%s]",i._streamId,e.code,e),r(),i._namedEvents.fire(s.rendererEvents.error.name,["shaka",e])});i._waitingForFinalization=!0}}},e.prototype.getStats=function(){if(!this._player)return{width:0,height:0,currentTime:0,lag:0,networkState:s.networkStates.networkNoSource.id};var e=o.assign(this._player.getStats(),{currentTime:0,lag:0}),t=o.get(this._element,["currentTime"],0),i=(o.now()-this._options.originStartTime)/1e3,r=Math.max(0,i-t);return this._element&&(e.currentTime=t,e.lag=r),0<e.estimatedBandwidth?e.networkState=s.networkStates.networkLoading.id:0<e.playTime?e.networkState=s.networkStates.networkIdle.id:e.video?e.networkState=s.networkStates.networkEmpty.id:e.networkState=s.networkStates.networkNoSource.id,e},e.prototype.setDataQualityChangedCallback=function(e){t.isFunction(e,"callback"),this.dataQualityChangedCallback=e},e.prototype.getPlayer=function(){return this._player},e.prototype.addVideoDisplayDimensionsChangedCallback=function(e,t){this._dimensionsChangedMonitor.addVideoDisplayDimensionsChangedCallback(e,t)},e}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(1),i(7)],void 0===(n=function(n,s,o){"use strict";function e(e,t,i){s.isStringNotEmpty(e,"type"),s.isObject(t,"stream"),s.isObject(i,"logger"),this._type=e,this._stream=t,this._logger=i,this._onPlayerEnd=null;var r=this;this._stream.on(o.streamEvents.playerEnded.name,function(e){if(r._logger.info("[%s] [%s] player ended.",r._stream.getStreamId(),r._type),r._playerEnded=!0,r._onPlayerEnd)return r._onPlayerEnd();r.streamEndedCallback(function(e){switch(e){case"":case"none":case"ended":return"ended";case"server-error":case"session-error":case"not-ready":case"error":case"died":return"failed";case"censored":return"censored";case"maintenance":return"maintenance";case"capacity":return"capacity";case"app-background":return"app-background";default:return"custom"}}(e),e)})}return e.prototype.on=function(e,t){return this._stream.on(e,t)},e.prototype.streamErrorCallback=function(e,t){n.isFunction(this._stream.streamErrorCallback)?(this._logger.debug("[%s] [%s] live stream error event [%s]",this._stream.getStreamId(),this._type,t),this._stream.streamErrorCallback(this._stream,e,t)):this._logger.error("[%s] [%s] live stream error event [%s]",this._stream.getStreamId(),this._type,t)},e.prototype.streamEndedCallback=function(e,t,i){var r=this._stream.getRenderer();if(!this._isStreamEnded){if(i&&!this._onPlayerEnd&&this._stream.isActive()&&r&&!this._playerEnded)return this._onPlayerEnd=n.bind(this.streamEndedCallback,this,e,t),this._logger.info("[%s] [%s] stream ended. Waiting for end of player.",this._stream.getStreamId(),this._type),void(r&&r.stop(t,i));this._isStreamEnded=!0,n.isFunction(this._stream.streamEndedCallback)&&this._stream.streamEndedCallback(this._stream,e,t),this._stream.stop(),r&&r.stop(t,i)}},e.prototype.dataQualityChangedCallback=function(e,t){var i=this._stream.getRenderer();i&&"function"==typeof i.dataQualityChangedCallback&&i.dataQualityChangedCallback(i,e,t)},e.prototype.getPhenixMediaStream=function(){return this._stream},e}.apply(t,r))||(e.exports=n)},function(e,t,i){var r;void 0===(r=function(){"use strict";return{errorSeverity:{recoverable:{id:1,name:"RECOVERABLE"},critical:{id:2,name:"CRITICAL"}}}}.apply(t,[]))||(e.exports=r)},function(e,t,i){var r,n;r=[i(0),i(1),i(15),i(2),i(37)],void 0===(n=function(a,l,t,i,r){function e(e){l.isString(e,"uri"),this._loggingUrl="/telemetry/metrics",this._domain="object"==typeof location?location.hostname:i.browser+"-"+i.browserVersion+"-unknown",this._isEnabled=!0,this._browser=(i.browser||"Browser")+"/"+(i.browserVersion||"?"),this._batchHttpProtocol=new t.BatchHttpProto(e+this._loggingUrl,[r],"telemetry.SubmitMetricRecords",{maxAttempts:3,maxBufferedRecords:1e3,maxBatchSize:512}),this._batchHttpProtocol.on("capacity",a.bind(n,this))}function n(e){this._batchHttpProtocol.addRecordToBeginning({metric:"MetricDropped",value:{uint64:e},timestamp:a.isoString(),sessionId:this._mostRecentSessionId,streamId:this._mostRecentStreamId,source:this._browser,fullQualifiedName:this._domain,environment:this._mostRecentEnvironment,version:this._mostRecentVersion,runtime:this._mostRecentRuntime})}return e.prototype.isEnabled=function(){return this._isEnabled},e.prototype.setEnabled=function(e){l.isBoolean(e,"enabled"),this._isEnabled=e},e.prototype.submitMetric=function(e,t,i,r,n,s,o){this._isEnabled&&(l.isStringNotEmpty(e,"metric"),l.isObject(o,"value"),this._mostRecentRuntime=t,this._mostRecentSessionId=i,this._mostRecentStreamId=r,this._mostRecentEnvironment=n,this._mostRecentVersion=s,function(e,t){var i=a.assign({},t,{metric:e,timestamp:a.isoString(),sessionId:this._mostRecentSessionId,streamId:this._mostRecentStreamId,source:this._browser,fullQualifiedName:this._domain,environment:this._mostRecentEnvironment,version:this._mostRecentVersion,runtime:this._mostRecentRuntime});this._batchHttpProtocol.addRecord(i)}.call(this,e,o))},e}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(1),i(5),i(3),i(2)],void 0===(n=function(e,t,i,r,n){function s(e){if(t.isObject(e,"logger"),this._logger=e,this._namedEvents=new i.NamedEvents,this._disposables=new r.DisposableList,this._disposables.add(this._namedEvents),!this.isSupported())return this._logger.info("Network monitor is not supported.");this._lastNetworkStats=o.call(this),function(){var e=this;navigator.connection.addEventListener("change",function(){e._namedEvents.fireAsync("NetworkChange",[o.call(e),e._lastNetworkStats]),e._lastNetworkStats=o.call(e)})}.call(this)}function o(){return{downlinkThroughputCapacity:this.getDownlinkThroughputCapacity(),effectiveType:this.getEffectiveType(),rtt:this.getRoundTripTime()}}return s.prototype.isSupported=function(){return n.global.navigator&&n.global.navigator.connection},s.prototype.getDownlinkThroughputCapacity=function(){return this.isSupported()?n.global.navigator.connection.downlink||n.global.navigator.connection.downlinkMax:-1},s.prototype.getEffectiveType=function(){return this.isSupported()?n.global.navigator.connection.effectiveType||n.global.navigator.connection.type:"Unknown"},s.prototype.getRoundTripTime=function(){return this.isSupported()?n.global.navigator.connection.rtt||n.global.navigator.connection.type:-1},s.prototype.onNetworkChange=function(e){if(this.isSupported())return t.isFunction(e,"callback"),this._namedEvents.listen("NetworkChange",e)},s.prototype.dispose=function(){this._disposables.dispose()},s}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(1),i(3),i(13),i(97),i(2)],void 0===(n=function(s,o,i,r,n,a){"use strict";var e=a.global.__phenixPageLoadTime||a.global.__pageLoadTime||s.now();function t(e,t){this._environment="production",this._version="2018-05-15T23:23:03Z",this._sessionId=null,this._properties={resource:"Session",kind:"Event"},this._logger=e,this._metricsTransmitter=t,this._networkMonitor=new n(this._logger),this._start=s.now(),this._disposables=new i.DisposableList,this._records=[],this._disposables.add(r.onBackground(s.bind(l,this,!1))),this._disposables.add(r.onForeground(s.bind(l,this,!0))),this._networkMonitor.isSupported()&&(this._disposables.add(this._networkMonitor.onNetworkChange(s.bind(h,this))),this._disposables.add(this._networkMonitor),u.call(this),d.call(this),c.call(this))}function l(e,t){var i=e?"ApplicationForeground":"ApplicationBackground";this.recordMetric(i,{uint64:t}),p.call(this,"Application has gone into the [%s] after [%s] ms",e?"foreground":"background",t)}function u(){var e=this._networkMonitor.getEffectiveType();this.recordMetric("NetworkType",{string:e},null,{resource:a.browser}),p.call(this,"[%s] has started with Network effective type of [%s]",this._sessionId?"Session":"Application",e)}function c(e,t){var i=e||this._networkMonitor.getRoundTripTime(),r=t||-1;if(this.recordMetric("RoundTripTime",{uint32:i},{uint32:r},{resource:a.browser}),s.isNullOrUndefined(t))return p.call(this,"Network RTT [%s]",i);p.call(this,"Network RTT changed to [%s] from [%s]",i,r)}function d(e,t){var i=e||this._networkMonitor.getDownlinkThroughputCapacity(),r=t||-1;if(this.recordMetric("DownlinkThroughputCapacity",{uint64:i},{uint64:r},{resource:a.browser}),s.isNullOrUndefined(t))return p.call(this,"Network downlink throughput capacity [%s]",i);p.call(this,"Network downlink throughput capacity changed to [%s] from [%s]",i,r)}function h(e,t){t.downlinkThroughputCapacity!==e.downlinkThroughputCapacity&&d.call(this,e.downlinkThroughputCapacity,t.downlinkThroughputCapacity),t.rtt!==e.rtt&&c.call(this,e.rtt,t.rtt),t.effectiveType!==e.effectiveType&&function(e,t){var i=e||this._networkMonitor.getEffectiveType(),r=t;this.recordMetric("NetworkType",{string:i},{string:r},{resource:a.browser}),p.call(this,"Network effective type has changed to [%s] from [%s]",i,r||"New")}.call(this,e.effectiveType,t.effectiveType)}function p(){var e=Array.prototype.slice.call(arguments);if(0===e.length)throw new Error("Invalid logging arguments.");var t="[%s] [SessionTelemetry] [%s] "+e[0],i=e.slice(1),r=[t,this._sessionId,s.now()-this._start].concat(i);this._logger.debug.apply(this._logger,r)}function f(){return(s.now()-e)/1e3}function m(e,t){if(o.isStringNotEmpty(e.metric,"record.metric"),!this._sessionId)return this._records.push({record:e,since:t});var i=s.assign({},this._properties,e);this._metricsTransmitter.submitMetric(e.metric,t,this._sessionId,null,this._environment,this._version,i)}return t.prototype.setSessionId=function(e){!e&&this._sessionId&&m.call(this,{metric:"Stopped",elapsed:this.elapsed()},f()),(this._sessionId=e)&&(m.call(this,{metric:"Initialized",elapsed:this.elapsed()},f()),function(){if(!this._sessionId)return;var e=this._records.length;for(;0<e;){var t=this._records.splice(e-1,1);1===t.length&&m.call(this,t[0].record,t[0].since),e--}}.call(this),function(){var e=r.isForeground(),t=r.getTimeSinceLastChange(),i=e?"ApplicationForeground":"ApplicationBackground";this.recordMetric(i,{uint64:t}),p.call(this,"Session has started in the [%s] after [%s] ms",e?"foreground":"background",t)}.call(this),this._networkMonitor.isSupported()&&(u.call(this),d.call(this),c.call(this)))},t.prototype.setProperty=function(e,t){o.isStringNotEmpty(e,"name"),o.isStringNotEmpty(t,"value"),this._properties[e]=t},t.prototype.recordMetric=function(e,t,i,r){o.isStringNotEmpty(e,"metric");var n=s.assign({},{metric:e,elapsed:this.elapsed(),value:t,previousValue:i},r||{});m.call(this,n,f())},t.prototype.elapsed=function(){return s.now()-this._start},t.prototype.dispose=function(){this._disposables.dispose(),this.recordMetric("Stopped"),p.call(this,"Session telemetry stopped")},t}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(1),i(3),i(2)],void 0===(n=function(l,s,u,c){"use strict";var e=c.global.__phenixPageLoadTime||c.global.__pageLoadTime||l.now();function t(e,t,i){s.isStringNotEmpty(e,"sessionId"),this._environment="production",this._version="2018-05-15T23:23:03Z",this._sessionId=e,this._properties={},this._logger=t,this._metricsTransmitter=i,this._start=l.now(),this._disposables=new u.DisposableList,d.call(this,"Stream initializing")}function d(){var e=Array.prototype.slice.call(arguments);if(0===e.length)throw new Error("Invalid logging arguments.");var t="[%s] [StreamTelemetry] [%s] "+e[0],i=e.slice(1),r=[t,this._streamId,l.now()-this._start].concat(i);this._logger.debug.apply(this._logger,r)}function o(){return(l.now()-e)/1e3}function a(e,t){s.isStringNotEmpty(e.metric,"record.metric");var i=l.assign({},this._properties,e);this._metricsTransmitter.submitMetric(e.metric,t,this._sessionId,this._streamId,this._environment,this._version,i)}return t.prototype.setProperty=function(e,t){s.isStringNotEmpty(e,"name"),s.isStringNotEmpty(t,"value"),this._properties[e]=t},t.prototype.recordMetric=function(e,t,i,r){s.isStringNotEmpty(e,"metric");var n=l.assign({},{metric:e,elapsed:this.elapsed(),value:t,previousValue:i},r||{});a.call(this,n,o())},t.prototype.setStreamId=function(e){if(s.isStringNotEmpty(e,"streamId"),this._streamId)throw new Error("Stream ID can only be set once.");this._streamId=e;var t=l.now();a.call(this,{metric:"Initialized",elapsed:this.elapsed()-t+this._start},o()-(t-this._start)/1e3)},t.prototype.setStartOffset=function(e){if(s.isNumber(e,"startOffset"),this._startOffset)throw new Error("Start offset can only be set once.");this._startOffset=e,this.recordMetric("Offset",{uint64:e})},t.prototype.getStartOffset=function(){return this._startOffset},t.prototype.elapsed=function(){return l.now()-this._start},t.prototype.stop=function(){this._disposables.dispose(),this.recordMetric("Stopped"),d.call(this,"Stream stopped")},t.prototype.recordTimeToFirstFrame=function(e){var t,i=this,r=l.now(),n=function(){t||(t=l.now()-r,i.recordMetric("TimeToFirstFrame",{uint64:t}),d.call(i,"First frame [%s]",t),s.dispose())};l.addEventListener(e,"loadeddata",n);var s=new u.Disposable(function(){l.removeEventListener(e,"loadeddata",n)});this._disposables.add(s)},t.prototype.recordVideoResolutionChanges=function(e,t){var i=this,r={width:t.videoWidth,height:t.videoHeight};e.addVideoDisplayDimensionsChangedCallback(function(e,t){r.width===t.width&&r.height===t.height||(i.recordMetric("ResolutionChanged",{string:t.width+"x"+t.height},{string:r.width+"x"+r.height}),r={width:t.width,height:t.height},d.call(i,"Resolution changed: width [%s] height [%s]",t.width,t.height))})},t.prototype.recordRebuffering=function(n){var s,o,a=this,e=function(){s||(a.recordMetric("Stalled"),s=l.now(),d.call(a,"[buffering] Stream has stalled"))},t=function(e){var t=n.buffered.length,i=!("playing"===e.type||0<t)||("progress"===e.type||"timeupdate"===e.type)&&n.buffered.end(t-1)===o;if(s&&(t||"Edge"===c.browser)&&!i){"progress"===e.type&&(o=n.buffered.end(t-1));var r=l.now()-s;a.recordMetric("Buffering",{uint64:r}),d.call(a,"[buffering] Stream has recovered from stall after [%s] milliseconds",r),s=null}};l.addEventListener(n,"stalled",e),l.addEventListener(n,"pause",e),l.addEventListener(n,"suspend",e),l.addEventListener(n,"play",t),l.addEventListener(n,"playing",t),l.addEventListener(n,"progress",t),l.addEventListener(n,"timeupdate",t),this._disposables.add(new u.Disposable(function(){l.removeEventListener(n,"stalled",e),l.removeEventListener(n,"pause",e),l.removeEventListener(n,"suspend",e),l.removeEventListener(n,"play",t),l.removeEventListener(n,"playing",t),l.removeEventListener(n,"progress",t),l.removeEventListener(n,"timeupdate",t)}))},t.prototype.recordVideoPlayingAndPausing=function(e){var t=this,i=function(){e.paused?t.recordMetric("Playing",{boolean:!1}):t.recordMetric("Playing",{boolean:!0})};l.addEventListener(e,"pause",i),l.addEventListener(e,"playing",i),this._disposables.add(new u.Disposable(function(){l.removeEventListener(e,"pause",i),l.removeEventListener(e,"playing",i)}))},t}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(1),i(35),i(96)],void 0===(n=function(e,t,r,n){var s={urls:{local:"",staging:"https://telemetry-stg.phenixrts.com",production:"https://telemetry.phenixrts.com"}};function i(){this._metricsTransmitters={}}return i.prototype.createMetricsTransmitter=function(e){var t=r.parseEnvFromPcastBaseUri(e||""),i=s.urls[t];return this._metricsTransmitters[t]||(this._metricsTransmitters[t]=function(e){var t=new n(e);e||t.setEnabled(!1);return t}.call(this,i)),this._metricsTransmitters[t]},new i}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(1)],void 0===(n=function(d,r){"use strict";var h=[{"16x9":[{2160:3840},{1080:1920},{768:1366},{720:1280},{576:1024},{480:853},{360:640},{180:320}]},{"4x3":[{1200:1600},{1080:1440},{720:960},{600:800},{576:768},{480:640},{360:480},{288:352},{240:320},{144:176},{120:160}]}],n={fallbackToLower:{id:0,name:"fallbackToLower"},fallbackToHigher:{id:1,name:"fallbackToHigher"},fallbackToLowerThenHigher:{id:2,name:"fallbackToLowerThenHigher"},exact:{id:3,name:"exact"}};function e(e){r.isObject(e,"options"),e.resolutionSelectionStrategy&&r.isValidType(e.resolutionSelectionStrategy,n,"options.resolutionSelectionStrategy"),e.aspectRatio&&r.isStringNotEmpty(e.aspectRatio,"options.aspectRatio"),e.resolutionHeight&&r.isNumber(e.resolutionHeight,"options.resolutionHeight"),e.frameRate&&r.isNumber(e.frameRate,"options.frameRate"),this._resolutionSelectionStrategy=e.resolutionSelectionStrategy||n.fallbackToLowerThenHigher.name,this._defaultAspectRatio=e.aspectRatio||"16x9",this._defaultResolutionHeight=e.resolutionHeight||720,this._defaultFrameRate=e.frameRate||15}function i(e){return r.isNumber(e,"value"),2*Math.floor((e+1)/2)}function s(e,t){var i,r,n,s,o=p(t,h),a=f(t,h),l=f(e.toString(),o),u=0===l,c=h.length-1===a;if(d.isNumber(l)){if(u)return c?null:(r=p(i=m(++a,h),h),n=m(l=y(this._defaultResolutionHeight,r),o),s=this.calculateWidthByAspectRatio(n,i),{aspectRatio:i,height:parseInt(n),width:parseInt(s)});l--}else if(!(l=y(e,o)))return;return i=m(a,h),n=m(l,r=g(a,h)),s=r[l][n],{aspectRatio:i,height:parseInt(n),width:parseInt(s)}}function o(e,t){var i,r,n,s,o=p(t,h),a=f(t,h),l=f(e.toString(),o),u=l===o.length-1,c=h.length-1===a;if(d.isNumber(l)){if(u)return c?null:(i=m(++a,h),n=this._defaultResolutionHeight,s=this.calculateWidthByAspectRatio(n,i),{aspectRatio:i,height:parseInt(n),width:parseInt(s)});l++}else if(!(l=function(s,o){if(d.keys(o[o.length-1])[0]>s)return null;return d.reduce(o,function(e,t,i){if(!e)return i;var r=d.keys(o[e])[0],n=d.keys(t)[0];return s<n?e:Math.abs(s-n)<Math.abs(s-r)?i:e})}(e,o)))return;return i=m(a,h),n=m(l,r=g(a,h)),s=r[l][n],{aspectRatio:i,height:parseInt(n),width:parseInt(s)}}function p(t,e){var i=d.find(e,function(e){return e.hasOwnProperty(t)});return i?i[t]:null}function f(t,e){return d.findIndex(e,function(e){return e.hasOwnProperty(t)})}function m(e,t){return d.keys(t[e])[0]}function g(e,t){var i=d.keys(t[e]);return t[e][i[0]]}function y(s,o){return d.keys(o[0])[0]<s?null:d.reduce(o,function(e,t,i){if(!e)return i;var r=d.keys(o[e])[0],n=d.keys(t)[0];return n<s?e:Math.abs(s-n)<Math.abs(s-r)?i:e})}return e.prototype.getDefaultResolution=function(){var e=p(this._defaultAspectRatio,h),t=p(this._defaultResolutionHeight,e)||this.calculateWidthByAspectRatio(this._defaultResolutionHeight,this._defaultAspectRatio);return{height:this._defaultResolutionHeight,width:t,aspectRatio:this._defaultAspectRatio}},e.prototype.getDefaultFrameRate=function(){return this._defaultFrameRate},e.prototype.getNextResolution=function(e,t){switch(r.isNumber(e,"height"),r.isStringNotEmpty(t,"aspectRatio"),this._resolutionSelectionStrategy){case n.fallbackToLower.name:return o.call(this,e,t);case n.fallbackToHigher.name:return s.call(this,e,t);case n.fallbackToLowerThenHigher.name:var i=null;return e>this._defaultResolutionHeight?i=s.call(this,e,t):(i=o.call(this,e,t))&&i.height||(i=s.call(this,this._defaultResolutionHeight,this._defaultAspectRatio)),i;case n.exact.name:default:return}},e.prototype.canResolveNextResolution=function(){return this._resolutionSelectionStrategy!==n.exact.name},e.prototype.calculateWidthByAspectRatio=function(e,t){switch(t){case"16x9":return i(16/9*e);case"4x3":return i(4/3*e);default:throw new Error("Aspect Ratio not supported")}},e}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(1),i(4),i(2)],void 0===(n=function(n,i,r,o){"use strict";var s="icngjadgidcmifnehjcielbmiapkhjpn",a=n.freeze({url:"https://addons.mozilla.org/firefox/downloads/file/474686/pcast_screen_sharing-1.0.3-an+fx.xpi",iconUrl:"https://phenixp2p.com/public/images/phenix-logo-unicolor-64x64.png",hash:"sha256:4972e9718ea7f7c896abc12d1a9e664d5f3efe498539b082ab7694f9d7af4f3b"}),l=100,u=450,c=52;function e(e,t){e=e||{},i.isObject(e,"options"),i.isObject(t,"logger"),this._logger=t,this._screenSharingExtensionId=e.screenSharingExtensionId||function(){switch(o.browser){case"Chrome":return s;case"Firefox":default:return""}}(),this._screenSharingAddOn=e.screenSharingAddOn||a,this._screenSharingEnabled=!1,this._isInitializedObservable=new r.Observable(!1),"Chrome"===o.browser&&this._screenSharingExtensionId&&function(){var e=f.call(this);return void 0;for(var t="{}".getElementsByTagName("link"),i=0;i<t.length;i++)if(t[i].href===e)return;this._logger.debug("Adding Chrome Web Store link [%s]",e);var r="{}".createElement("link");r.rel="chrome-webstore-item",r.href=e,"{}".getElementsByTagName("head")[0].appendChild(r)}.call(this),h.call(this,n.bind(d,this))}function d(e){this._isInitializedObservable.setValue(!0),this._screenSharingEnabled=e}function h(t){var i=this;if("Chrome"===o.browser&&i._screenSharingExtensionId){var e=g.call(this);if(!e)return t(!1);try{e.sendMessage(i._screenSharingExtensionId,{type:"version"},function(e){e&&"ok"===e.status?(i._logger.info("Screen sharing enabled using version [%s]",e.version),t(!0)):(i._logger.info("Screen sharing NOT available"),t(!1))})}catch(e){e.message&&i._logger.warn(e.message,e),t(!1)}}else"Firefox"===o.browser&&o.browserVersion>=c?t(!0):"Firefox"===o.browser&&"object"==typeof o.global.PCastScreenSharing?t(!0):t(!1)}function p(e){if(this._isInitializedObservable.getValue())return e();var t=this._isInitializedObservable.subscribe(function(){return t.dispose(),e()})}function f(){return"https://chrome.google.com/webstore/detail/"+this._screenSharingExtensionId}function m(i,r){switch(o.browser){case"Chrome":return function(i){var r=this,e=g.call(this);if(!e)return i(new Error("not-available"));try{e.sendMessage(r._screenSharingExtensionId,{type:"get-desktop-media",sources:["screen","window","tab","audio"]},function(e){var t=!e;return t?h.call(r,function(e){return d.call(r,e),i(new Error("extension-failure"))}):"ok"!==e.status?i(new Error(e.status),e):void i(null,e)})}catch(e){e.message&&r._logger.warn(e.message),i(e,{status:"failed"})}}.call(this,function(e,t){if(e||t&&"ok"!==t.status)return r(e,t);t.data||t.options||(t.options={canRequestAudioTrack:!0}),t.data&&n.hasIndexOrKey(t.data,"hasAudio")&&!t.options&&(t.options={canRequestAudioTrack:t.data.hasAudio}),r(null,{status:"ok",constraints:function(e,t,i){var r={};n.isObject(e)&&n.isObject(e.screen)&&(r.video=e.screen);n.isObject(e)&&n.isObject(e.screenAudio)&&i.canRequestAudioTrack&&(r.audio=e.screenAudio);e.screen&&n.set(r,["video","mandatory"],{chromeMediaSource:"desktop",chromeMediaSourceId:t});e.screenAudio&&i.canRequestAudioTrack&&n.set(r,["audio","mandatory"],{chromeMediaSource:"system",chromeMediaSourceId:t});return r}(i,t.streamId,t.options)})});case"Firefox":r(null,{status:"ok",constraints:function(e,t){var i={video:{}};"object"==typeof e&&"object"==typeof e.screen&&(i.video=e.screen);t&&(i.video.mediaSourceId=t);return i.video.mediaSource=i.video.mediaSource||"window",i}(i)});break;default:r(new Error("not-supported"),{status:"not-supported"})}}function t(i){var r=this;if(!r._screenSharingEnabled){var e=function(e,t){return"cancelled"===t?i(null,{status:"cancelled"}):"ok"!==t?i(new Error("screen-sharing-installation-failed"),{status:t}):void h.call(r,function(e){if(r._screenSharingEnabled=e,!r._screenSharingEnabled)return i(new Error("screen-sharing-installation-failed"),{status:t});i(null,{status:"ok"})})};switch(o.browser){case"Chrome":(function(t){var i=this,e=f.call(this);try{chrome.webstore.install(e,function(){return t(null,"ok")},function(e){if(e){if(e.match(/cancelled/gi))return i._logger.info("User cancelled screen sharing"),t(new Error(e),"cancelled");i._logger.warn(e)}return t(new Error(e||"failed"),"failed")})}catch(e){e.message&&i._logger.warn(e.message),t(e,"failed")}}).call(r,e);break;case"Firefox":(function(t){try{var e,i={"PCast Screen Sharing":{URL:this._screenSharingAddOn.url,IconURL:this._screenSharingAddOn.iconUrl,Hash:this._screenSharingAddOn.hash,toString:function(){return this.URL}}},r=u,n=function(){e&&clearInterval(e),t(null,"ok")},s=function(){e&&clearInterval(e),t(new Error("failed"),"failed")};e=setInterval(function(){return"object"==typeof o.global.PCastScreenSharing?n():r--<0?s():void 0},l),InstallTrigger.install(i,function(e,t){0===t?n():s()})}catch(e){e.message&&this._logger.warn(e.message),t("failed",e)}}).call(r,e);break;default:i(new Error("not-supported"),{status:"not-supported"})}}}function g(){switch(o.browser){case"Chrome":return"undefined"!=typeof chrome&&chrome.runtime&&chrome.runtime.sendMessage?chrome.runtime:(this._logger.info("Screen sharing NOT available. Runtime not supported"),null);case"Firefox":default:return null}}return e.prototype.isScreenSharingEnabled=function(e){var t=this;return p.call(this,function(){return e(t._screenSharingEnabled)})},e.prototype.installExtension=function(e){return p.call(this,n.bind(t,this,e))},e.prototype.getScreenSharingConstraints=function(e,t){return p.call(this,n.bind(m,this,e,t))},e.prototype.toString=function(){return"ScreenShareExtensionManager["+o.browser+"]"},e}.apply(t,r))||(e.exports=n)},function(e,t,i){var r,n;r=[i(0),i(1),i(2)],void 0===(n=function(l,u,c){"use strict";var i=2e3;function e(e,t,i){u.isObject(e,"logger"),u.isObject(t,"screenShareExtensionManager"),i&&u.isFunction(i,"onScreenShare"),this._logger=e,this._screenShareExtensionManager=t,this._onScreenShare=i}function a(r,t,n){var s=this,o=function(e){n(d(e),void 0,e)},a=function(e){(function(r){var n={},s={},o=this;setTimeout(function e(){var t;(t=r,l.reduce(t.getTracks(),function(e,t){return e&&(i=t,u.isNotUndefined(i,"track"),"ended"===i.readyState);var i},!0))||(l.forEach(r.getTracks(),function(e){if(c.global.Event&&l.hasIndexOrKey(n,e.id)&&n[e.id]!==e.enabled){var t=new c.global.Event("trackenabledchange");(t.data=e).dispatchEvent(t),o._logger.info("[%s] Detected track [%s] enabled change to [%s]",r.id,e.id,e.enabled)}if(c.global.Event&&l.hasIndexOrKey(s,e.id)&&s[e.id]!==e.readyState){var i=new c.global.Event("readystatechange");(i.data=e).dispatchEvent(i),o._logger.info("[%s] Detected track [%s] Ready State change to [%s]",r.id,e.id,e.readyState)}n[e.id]=e.enabled,s[e.id]=e.readyState}),setTimeout(e,i))},i)}).call(s,e),t("ok",e)};return function(i,r){var n=this;if(i.screen)return n._screenShareExtensionManager.isScreenSharingEnabled(function(e){return e?n._screenShareExtensionManager.getScreenSharingConstraints(i,r):n._screenShareExtensionManager.installExtension(function(e,t){return e||t&&"ok"!==t.status?r(e,t):n._screenShareExtensionManager.getScreenSharingConstraints(i,r)})});var e={audio:i.audio||!1,video:i.video||!1};r(null,{status:"ok",constraints:e})}.call(this,r,function(e,t){if("ok"!==l.get(t,["status"]))return o(e);if("cancelled"!==t.status){var i=t.constraints;if(s._onScreenShare&&(r.screen||r.screenAudio)&&"Chrome"===c.browser&&!(i=s._onScreenShare(i)))throw new Error("onScreenShare must return an object of user media constraints");try{c.getUserMedia(i,a,o)}catch(e){o(e)}}else n("cancelled",null)})}e.prototype.getUserMedia=function(e,t){u.isObject(e,"options"),u.isFunction(t,"callback"),function(n,r){var s=this,i=function(e,t){s._gumStreams&&s._gumStreams.push(t),r(s,e,t)},o=function(e,t,i){n.screenAudio&&s._logger.warn("Screen capture with audio is only supported on Windows or Chrome OS."),r(s,e,t,i)},e=n.screen||n.screenAudio,t=n.video||n.audio;if(!e||!t)return a.call(s,n,i,o);return a.call(s,{screen:n.screen},function(e,r){return a.call(s,{audio:n.audio,video:n.video},function(e,t){!function(t,e){if(!t||!l.isFunction(t.addTrack))return;l.forEach(e,function(e){t.addTrack(e)})}(t,r.getTracks()),i(e,t)},function(e,t,i){!function(e){e&&l.isFunction(e.stop)&&e.stop();if(e&&l.isFunction(e.getTracks))for(var t=e.getTracks(),i=0;i<t.length;i++){var r=t[i];r.stop()}}(r),o(e,t,i)})},o)}.call(this,e,t)};var d=function(e){return"unavailable"===e.code?"conflict":"permission-denied"===e.message?"permission-denied":"PermissionDeniedError"===e.name?"permission-denied":"InternalError"===e.name&&"Starting video failed"===e.message?"conflict":"SourceUnavailableError"===e.name?"conflict":"SecurityError"===e.name&&"The operation is insecure."===e.message?"permission-denied":"failed"};return e}.apply(t,r))||(e.exports=n)},function(e,t){},function(e,t,i){"use strict";var r,n;r=[i(2),i(8),i(20),i(23),i(45),i(46),i(24),i(21),i(22),i(47)],void 0===(n=function(e,t,i,r,n,s,o,a,l,u){return{PCast:e.global.PhenixPCast=i,RoomService:r,AudioSpeakerDetector:n,BandwidthMonitor:s,UserMediaResolver:o,logging:t,RTC:e,express:{PCastExpress:a,RoomExpress:l,ChannelExpress:u}}}.apply(t,r))||(e.exports=n)}])});