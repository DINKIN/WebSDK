!function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b():"function"==typeof define&&define.amd?define("phenix-web-sdk",[],b):"object"==typeof exports?exports["phenix-web-sdk"]=b():a["phenix-web-sdk"]=b()}(this,function(){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,b),e.l=!0,e.exports}var c={};return b.m=a,b.c=c,b.i=function(a){return a},b.d=function(a,c,d){b.o(a,c)||Object.defineProperty(a,c,{configurable:!1,enumerable:!0,get:d})},b.n=function(a){var c=a&&a.__esModule?function(){return a["default"]}:function(){return a};return b.d(c,"a",c),c},b.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},b.p="",b(b.s=105)}([function(a,b,c){var d,e;d=[c(60)],e=function(a){"use strict";return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(50)],e=function(a){return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){!function(b,d){a.exports=d(c(0),c(25),c(1),c(4))}(this,function(a,b,c,d){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,b),e.l=!0,e.exports}var c={};return b.m=a,b.c=c,b.i=function(a){return a},b.d=function(a,c,d){b.o(a,c)||Object.defineProperty(a,c,{configurable:!1,enumerable:!0,get:d})},b.n=function(a){var c=a&&a.__esModule?function(){return a["default"]}:function(){return a};return b.d(c,"a",c),c},b.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},b.p="",b(b.s=10)}([function(a,b,c){(function(c){var d,e;d=[],e=function(){"use strict";var a=function(){return"object"==typeof window?window:"object"==typeof c?c:{}};return a()}.apply(b,d),!(void 0!==e&&(a.exports=e))}).call(b,c(9))},function(b,c){b.exports=a},function(a,c){a.exports=b},function(a,b,c){var d,e;d=[c(1),c(4),c(0)],e=function(a,b,c){"use strict";function d(a,c,d){var f=this;this._ghost=a,this._stream=c,this._isUsingPlugin=d,this._events={};var g=function(a){f._loaded=!0,f._enabled=a===!0,a?j.call(f):o("Failed to create Phenix video element"),f._onReady&&f._onReady(f._enabled)};try{if(this._video=e(d),this._video.className=this._ghost.className,this._video.height=this._ghost.height,this._video.width=this._ghost.width,this._ghost.style.cssText="visibility:hidden !important;width:0px !important;height:0px !important;margin:0px !important;padding:0px !important;border-style:none !important;border-width:0px !important;max-width:0px !important;max-height:0px !important;outline:none !important",this._video.onunload=function(){f._loaded=!1},l.call(this),"{}".body&&"{}".body.contains||n("document.body.contains is not supported"),"{}".body&&"{}".body.contains&&"{}".body.contains(this._ghost)&&this._ghost.parentNode.replaceChild(this._video,this._ghost),!d)return g(!0);var h=new b;h.waitForReady(this._video,g)}catch(i){o("Error while loading Phenix RTC"+i),g(!1)}}function e(a){var b="{}".createElement("video");return a&&(b="{}".createElement("object"),b.type="application/x-phenix-video"),b}function f(a,b,c){if(!this._isUsingPlugin)return this._video.addEventListener(a,b,c);var d=this._events[a];d||(d=this._events[a]=[],this._loaded&&h.call(this,a)),d.push(b)}function g(a,b,c){if(!this._isUsingPlugin)return this._video.removeEventListener(a,b,c);var d=this._events[a];if(d){var e=d.indexOf(b);e>=0&&(d=d.splice(e,1),d.length>0?this._events[a]=d:delete this._events[a])}}function h(a){function b(){var b=c._events[a];if(b)for(var d=0;d<b.length;d++)b[d].apply(c,arguments)}var c=this;c._video.phenixSetEventListener(a,b)}function i(a,b){var c;"{}".createEvent?(c="{}".createEvent("HTMLEvents"),c.initEvent(b,!0,!0)):(c="{}".createEventObject(),c.eventType=b),c.eventName=b,setTimeout(function(){"{}".createEvent?a.dispatchEvent(c):a.fireEvent("on"+c.eventType,c)})}function j(){for(var a=Object.keys(this._events),b=0;b<a.length;b++)h.call(this,a[b]);this.hookUpEvents(),k.call(this),this._video.id=this._ghost.id,this._video.style.cssText=this._ghost.cssText,this._video.className=this._ghost.className,this._video.innerHtml=this._ghost.innerHtml,this._video.width=this._ghost.width,this._video.height=this._ghost.height,this._video.autoplay=this._ghost.autoplay,this._video.muted=this._ghost.muted,this._video.defaultMuted=this._ghost.defaultMuted,this._video.volume=this._ghost.volume,this._stream&&(this._video.src=this._stream)}function k(){var b=this,d=["style"];if(a.get(c,["MutationObserver"])){var e=new MutationObserver(function(a){a.forEach(function(a){"attributes"===a.type&&a.target===b._ghost&&d.indexOf(a.attributeName)===-1&&(b._video[a.attributeName]=b._ghost[a.attributeName])})}),f={attributes:!0};e.observe(b._ghost,f)}else n("Falling back to use of DOM event listeners. This results in degraded performance for further DOM modifications and does not work for IE prior to version 9. See https://developer.mozilla.org/en-US/docs/Web/Guide/Events/Mutation_events for details."),b._ghost.addEventListener?b._ghost.addEventListener("DOMAttrModified",function(a){b._video[a.target.tagName]=b._ghost[a.target.tagName]},!1):b._ghost.attachEvent("onpropertychange",function(a){b._video[a.target.tagName]=b._ghost[a.target.tagName]})}function l(){var b=this;if(a.get(c,["MutationObserver"])){var d=new MutationObserver(function(a){a.forEach(function(a){if("childList"===a.type)for(var c=0;c<a.addedNodes.length;c++){var d=a.addedNodes[c];a.target!==b._video&&(d===b._ghost?(a.target.replaceChild(b._video,b._ghost),j.call(b)):m(a.target,b._ghost)&&(b._ghost.parentNode.replaceChild(b._video,b._ghost),j.call(b)))}})}),e={childList:!0,attributes:!1,characterData:!1,subtree:!0};d.observe("{}".body,e)}else n("Falling back to use of DOM event listeners. This results in degraded performance for further DOM modifications and does not work for IE prior to version 9. See https://developer.mozilla.org/en-US/docs/Web/Guide/Events/Mutation_events for details."),f(b._ghost,"DOMNodeInserted",function(){b._ghost.parentNode.replaceChild(b._video,b._ghost)},!1)}function m(a,b){for(var c=b.parentNode;null!==c;){if(c===a)return!0;c=c.parentNode}return!1}var n=function(){console.log.apply(console,arguments)}||function(){},o=function(){console.error.apply(console,arguments)}||n;return d.prototype.hookUpEvents=function(){var a=this,b=this._ghost;this.addEventListener("error",function(){i(b,"error")}),this.addEventListener("mute",function(){b.muted=a._video.muted,i(b,"mute")}),this.addEventListener("unmute",function(){b.muted=a._video.muted,i(b,"unmute")}),this.addEventListener("ended",function(){b.ended=a._video.ended,i(b,"ended")}),this.addEventListener("loadedmetadata",function(){b.width=a._video.width,b.height=a._video.height,i(b,"loadedmetadata")}),this.addEventListener("loadeddata",function(){b.width=a._video.width,b.height=a._video.height,i(b,"loadeddata")}),this.addEventListener("resize",function(){b.width=a._video.width,b.height=a._video.height,i(b,"resize")})},d.prototype.onReady=function(a){var b=this;this._loaded?setTimeout(function(){a(b._enabled)},1):this._onReady=a},d.prototype.getElement=function(){return this._video},d.prototype.addEventListener=function(a,b,c){f.call(this,a,b,c)},d.prototype.removeEventListener=function(a,b,c){g.call(this,a,b,c)},d}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(2)],e=function(a){"use strict";function b(a){this._timeout=a||15e3}var c=new a(navigator.userAgent).detect(),d=4,e=function(){console.error.apply(console,arguments)}||console.log;return b.prototype.waitForReadyWithTimeout=function(a,b,f){var g=!1,h=1,i=h,j=function(a){g||(g=!0,b(a))},k=function l(){a.readyState===d?j(!0):a.phenixVersion?j(!0):(h=Math.min(h+1e3,2*h),i+=h,i>f?(e("Timed out while waiting for <object> to load"),j(!1)):setTimeout(l,h))};a.hasOwnProperty&&a.hasOwnProperty("onload")||"IE"!==c.browser&&e("No means of detecting when <object> is loaded"),a.onload=function(){j(!0)},k()},b.prototype.waitForReady=function(a,b){a.phenixVersion?b(!0):this.waitForReadyWithTimeout(a,b,this._timeout)},b}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b){a.exports=c},function(a,b){a.exports=d},function(a,b,c){var d,e;d=[c(1),c(5),c(6),c(2),c(0),c(12),c(11)],e=function(a,b,c,d,e,f,g){"use strict";function h(){if(a.assign(j,f()),g.isSupported()){j.phenixSupported=!0;var b=new g,c=function(){j.RTCPeerConnection=b.getRTCPeerConnectionConstructor(),j.RTCSessionDescription=b.getRTCSessionDescriptionConstructor(),j.RTCIceCandidate=b.getRTCIceCandidateConstructor(),j.getSources=b.getSourcesDelegate(),j.getUserMedia=b.getUserMediaDelegate(),j.getStats=b.getStatsDelegate(),Function.prototype.bind?(j.attachMediaStream=b.attachMediaStream.bind(b),j.reattachMediaStream=b.reattachMediaStream.bind(b),j.isPhenixEnabled=b.isEnabled.bind(b)):(j.attachMediaStream=function(){b.attachMediaStream.apply(b,arguments)},j.reattachMediaStream=function(){b.reattachMediaStream.apply(b,arguments)},j.isPhenixEnabled=function(){return b.isEnabled()}),j.webrtcSupported=!0,j.phenixSupported=!0,j.phenixVersion=b.getVersion(),j.onLoaded&&j.onLoaded.call()};b.isEnabled()?c():b.onReady(function(a){a&&(c(),j.onload&&"function"==typeof j.onload&&j.onload())}),b.onLoaded(function(){c()})}else j.phenixSupported=!1;return j}var i=new d(navigator.userAgent).detect(),j={browser:i.browser,browserVersion:i.version,phenixSupported:!1,isPhenixEnabled:function(){return!1},onLoaded:void 0,global:e};return a.assign(h(),{shim:h})}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0)],e=function(a){"use strict";var b=function(b){a.RTCPeerConnection=b.RTCPeerConnection,a.RTCSessionDescription=b.RTCSessionDescription,a.RTCIceCandidate=b.RTCIceCandidate};return b}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b){var c;c=function(){return this}();try{c=c||Function("return this")()||(0,eval)("this")}catch(d){"object"==typeof window&&(c=window)}a.exports=c},function(a,b,c){"use strict";var d,e;d=[c(7),c(8)],e=function(a,b){return a.onLoaded=function(){b(a)},a.onLoaded(),a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(1),c(5),c(6),c(4),c(3)],e=function(a,b,c,d,e){"use strict";function f(){var a=this;this._root=h(),this._version="?";var b=function(b){a._loaded=!0,a._enabled=b===!0,a._version=a._phenixRTC.phenixVersion||"?.?.?.?",q(b?"Phenix RTC "+a._version:"No Phenix RTC"),a._onReady&&a._onReady(a._enabled)};try{this._phenixRTC=i(this._root),this._phenixRTC.onunload=function(){a._loaded=!1};var c=new d;c.waitForReady(this._phenixRTC,b)}catch(e){r("Error while loading Phenix RTC"+e)}}function g(){this._root&&"{}".getElementById("phenixRTC")!==this._root&&("{}".body.appendChild(this._root),this._onLoaded&&this._onLoaded.call(this))}function h(){var a="{}".createElement("div");return a.id="phenixRTC",a.style.cssText="visibility:hidden !important;width:0px !important;height:0px !important;margin:0px !important;padding:0px !important;border-style:none !important;border-width:0px !important;max-width:0px !important;max-height:0px !important;outline:none !important","{}".body.appendChild(a),a}function i(a){var b="{}".createElement("object");return b.type="application/x-phenix-rtc",a.appendChild(b),b}function j(a,b){if(!a)throw new Error("Can not attach a stream to a undefined element");if(a.phenixVersion)return a.src=b,a;var c=new e(a,b,(!0));return c.getElement().phenixPresenter=c,c.getElement()}function k(b){var c=function(){var c=null;switch(arguments.length){case 0:c=new b;break;case 1:c=new b(arguments[0]);break;case 2:c=new b(arguments[0],arguments[1]);break;case 3:c=new b(arguments[0],arguments[1],arguments[2]);break;case 4:c=new b(arguments[0],arguments[1],arguments[2],arguments[3]);break;case 5:c=new b(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]);break;default:throw new Error("Unsupported number of arguments in Phenix Object Constructor")}return c.phenixAddEventListener=a.bind(l,c),c.phenixRemoveEventListener=a.bind(m,c),c};return a.forOwn(b,function(a,b){c[b]=a}),c}function l(a,c){b.stringNotEmpty(a,"name"),b.isFunction(c,"listener"),n.call(this,a),o.call(this,a,c)}function m(a,b){p.call(this,a,b)}function n(b){if(!this.events||!this.events[b]){this.events||(this.events={});var d=this.events;d[b]={observable:(new c.Observable).extend({timeout:0}),subscription:null,listeners:[]},this.phenixSetEventListener(b,a.bind(d[b].observable.setValue,d[b].observable)),d[b].subscription=d[b].observable.subscribe(function(c){var e=d[b],f=e.listeners;a.forEach(f,function(a){a(c)})})}}function o(a,b){if(!this.events||!this.events[a])throw new Error("No event observable for event: "+name);this.events[a].listeners.push(b)}function p(b,c){this.events&&this.events.events[b]&&(this.events[b].listeners=a.filter(this.events[b].listeners,function(a){return c!==a}))}var q=function(){console.log.apply(console,arguments)}||function(){},r=function(){console.error.apply(console,arguments)}||q;return f.prototype.onReady=function(a){var b=this;this._loaded?setTimeout(function(){a(b._enabled)},1):this._onReady=a},f.prototype.onLoaded=function(a){this._onLoaded=a},f.prototype.isLoaded=function(){return this._loaded===!0},f.isSupported=function(){if(navigator.plugins)for(var a=navigator.plugins,b=0;b<a.length;b++)if(a[b].name.indexOf("PhenixRTC")>=0)return!0;if(navigator.userAgent&&(navigator.userAgent.match(/MSIE/)||navigator.userAgent.match(/Trident/)))try{return new window.ActiveXObject("PhenixP2P.RTC"),!0}catch(c){return!1}return!1},f.prototype.isEnabled=function(){return g.call(this),this._phenixRTC&&void 0!==this._phenixRTC.phenixVersion},f.prototype.getVersion=function(){return g.call(this),this._version},f.prototype.getRTCPeerConnectionConstructor=function(){return g.call(this),k(this._phenixRTC.RTCPeerConnection)},f.prototype.getRTCSessionDescriptionConstructor=function(){return g.call(this),k(this._phenixRTC.RTCSessionDescription)},f.prototype.getRTCIceCandidateConstructor=function(){return g.call(this),k(this._phenixRTC.RTCIceCandidate)},f.prototype.getSourcesDelegate=function(){var a=this;return function(b){return g.call(a),a._phenixRTC.getSources(b)}},f.prototype.getUserMediaDelegate=function(){var a=this;return function(b,c,d){return g.call(a),a._phenixRTC.getUserMedia(b,c,d)}},f.prototype.getStatsDelegate=function(){return function(a,b,c,d){return a.getStats(b,c,d)}},f.prototype.attachMediaStream=function(a,b){return g.call(this),j.call(this,a,b)},f.prototype.reattachMediaStream=function(a,b){return g.call(this),this.attachMediaStream(a,b.src)},f}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(1),c(2),c(13),c(0),c(3)],e=function(a,b,c,d,e){"use strict";function f(){if(v=d.RTCPeerConnection,w=d.RTCSessionDescription,x=d.RTCIceCandidate,navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(y=a.bind(k,null,"input")),navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(z=a.bind(k,null,"output")),(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||d.getUserMedia)&&(A=g),!d.RTCPeerConnection)return t("[%s] browser version [%s] does not appear to be WebRTC-capable",u.browser,u.version);switch(u.browser){case"Firefox":t("Firefox detected",u),C=function(a,b){t("Attaching media stream");var c=a.muted;return u.version>57&&(a.srcObject=b),a.mozSrcObject=b,a.play(),c===!0&&(a.muted=!0),a},E=function(a,b){t("Reattaching media stream");var c=a.muted;return u.version>57&&(a.srcObject=b.srcObject),a.mozSrcObject=b.mozSrcObject,a.play(),c===!0&&(a.muted=!0),a},B=function(b,c,d,e){b.getStats(c,a.bind(o,this,b,d),e)},F=!0;break;case"Opera":t("Opera detected",u),C=l,E=n,B=function(b,c,d,e){b.getStats(a.bind(o,this,b,d),c,e)},F=!0;break;case"Chrome":t("Webkit detected",u),C=l,E=n,B=function(b,c,d,e){b.getStats(a.bind(o,this,b,d),c,e)},F=!0;break;case"Edge":t("Edge detected",u),C=l,E=n,B=function(b,c,d,e){b.getStats(c,a.bind(o,this,b,d),e)},F=!0;break;case"Safari":t("Safari detected",u),C=function(b,c){return a.isObject(c)&&(b.__phenixHasPlayedWebRtc=!0),b=l(b,c)},D=function(a,b){return a.__phenixHasPlayedWebRtc?(a=new e(a,b,(!1)).getElement(),a.play(),a):m(a,b)},E=n,B=function(b,c,d,e){b.getStats(c).then(a.bind(o,this,b,d),e)},F=!0;break;case"ReactNative":t("React Native detected",u),C=function(){t("attachMediaStream not supported in React Native environment")},D=function(){t("attachUriStream not supported in React Native environment")},E=function(){t("reattachMediaStream not supported in React Native environment")},B=function(b,c,d,e){b.getStats(c).then(a.bind(o,this,b,d),e)},F=!0;break;default:t("Browser does not appear to be WebRTC-capable",u)}}function g(b,c,e){var f=a.bind(h,this,b,c,e);return navigator&&a.isFunction(navigator.getUserMedia)?navigator.getUserMedia(b,f,e):d&&a.isFunction(d.getUserMedia)?d.getUserMedia(b,f,e):void 0}function h(a,b,c,d){setTimeout(function(){for(var e=d.getTracks(),f=0;f<e.length;f++){var g=e[f];if(g.onended=function(a){t(a.timeStamp,"Track",g.id,g.label,"ended")},t("Track",g.id,g.label,e[f].kind,"readyState=",e[f].readyState),"ended"===g.readyState)return i("User media not available",c,e)}var h=(a.audio?1:0)+(a.video?1:0);return e.length!==h?i("Unable to get all requested user media.",c,e):void b(d)},100)}function i(a,b,c){try{var d=new Error(a);d.code="unavailable",b(d)}finally{j(c)}}function j(a){for(var b=0;b<a.length;b++)a[b].stop()}function k(a,b){if("input"!==a&&"output"!==a)throw new Error("Unsupported device type "+a);navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices().then(function(c){var d=[];c.forEach(function(b){b.kind==="audio"+a?d.push({kind:"audio",id:b.deviceId,label:b.label}):b.kind==="video"+a&&d.push({kind:"video",id:b.deviceId,label:b.label})}),b(d)})}function l(a,b){return"undefined"!=typeof a.srcObject?a.srcObject=b:"undefined"!=typeof a.mozSrcObject?a.mozSrcObject=b:"undefined"!=typeof a.src?a.src=URL.createObjectURL(b):t("Error attaching stream to element."),a.play(),a}function m(a,b){return a.src=b,a.play(),a}function n(a,b){return a.src=b.src,a}function o(a,b,c){b(p(a,c))}function p(b,c){switch(u.browser){case"Edge":c.forEach(function(a){a.mediaType=q(b,a.codecId),a.bytesSent=s(a.packetsSent,a.mediaType),a.bytesReceived=s(a.packetsReceived,a.mediaType)});break;case"Safari":c.forEach(function(b){a.includes(b.id.toLowerCase(),"audio")&&a.includes(b.id.toLowerCase(),"rtp")&&(b.mediaType="audio"),a.includes(b.id.toLowerCase(),"video")&&a.includes(b.id.toLowerCase(),"rtp")&&(b.mediaType="video")})}return c}function q(b,c){if(c){var d;return r(b,function(b){a.startsWith(b,"video")&&a.includes(b.toLowerCase(),c.toLowerCase())&&(d="video"),a.startsWith(b,"audio")&&a.includes(b.toLowerCase(),c.toLowerCase())&&(d="audio")}),d}}function r(b,c){var d=b.localDescription.sdp.split("m="),e=b.remoteDescription.sdp.split("m=");return d.length===e.length&&a.findIndex(d,function(a,b){return c(a,b,e)})}function s(a,b){var c=parseInt(a)||0;return"audio"===b?100*c:"video"===b?1080*c:void 0}var t=function(){console.log.apply(console,arguments)},u=new b(navigator.userAgent).detect(),v=d.RTCPeerConnection,w=d.RTCSessionDescription,x=d.RTCIceCandidate,y=null,z=null,A=null,B=null,C=null,D=null,E=null,F=!1;return function(){f();var a={RTCPeerConnection:v,RTCSessionDescription:w,RTCIceCandidate:x,getSources:y,getDestinations:z,getUserMedia:A,getStats:B,attachMediaStream:C,attachUriStream:D||m,reattachMediaStream:E,webrtcSupported:F};return a.exportGlobal=function(){d.RTCPeerConnection=a.RTCPeerConnection,d.RTCSessionDescription=a.RTCSessionDescription,d.RTCIceCandidate=a.RTCIceCandidate},a}}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";var a=function(){};return a}.apply(b,d),!(void 0!==e&&(a.exports=e))}])})},function(a,b,c){var d,e;d=[c(56),c(57)],e=function(a,b){return{Disposable:a,DisposableList:b}}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(28),c(64),c(65)],e=function(a,b,c){"use strict";return{Observable:a,ObservableArray:b,ObservableMonitor:c}}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(26),c(58)],e=function(a,b){return{Event:a,NamedEvents:b}}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(59)],e=function(a){"use strict";return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";var a={networkStates:{networkEmpty:{id:0,name:"NETWORK_EMPTY"},networkIdle:{id:1,name:"NETWORK_IDLE"},networkLoading:{id:2,name:"NETWORK_LOADING"},networkNoSource:{id:3,name:"NETWORK_NO_SOURCE"}},types:{realTime:{id:0,name:"RealTime"},dash:{id:1,name:"dash"},hls:{id:2,name:"hls"}},streamEvents:{playerEnded:{id:0,name:"playerended"},playerError:{id:1,name:"playererror"},stopped:{id:2,name:"stopped"}},rendererEvents:{ended:{id:0,name:"ended"},error:{id:1,name:"error"}}};return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(62),c(61),c(14)],e=function(a,b,c){"use strict";return{createLogger:function(){return new a},Logger:a,ConsoleAppender:b,level:c.level}}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(5)],e=function(a,b,c){"use strict";function d(a,b){if(!a)throw new Error("'logger' must be specified.");this._logger=a,this._dimensionsChangedEvent=new c.Event,this._dimensionsChangedIntervalId=null,this._toBeStarted=!1,this._videoElement=null,this._dimensionsChangedData={pollFrequency:h,previousWidth:0,previousHeight:0},b&&b.pollFrequency&&(this._dimensionsChangedData.pollFrequency=b.pollFrequency>=i?b.pollFrequency:i),this._renderer=null}function e(b,c){c&&!a.isUndefined(c.videoWidth)||this._logger.warn("Attempting to start dimensions changed monitor without providing proper 'video' element."),this._renderer=b,this._videoElement=c,this._toBeStarted=!0,g.call(this)}function f(){this._toBeStarted=!1,this._dimensionsChangedIntervalId&&(clearInterval(this._dimensionsChangedIntervalId),this._dimensionsChangedIntervalId=null),this._dimensionsChangedEvent.dispose()}function g(){if(this._toBeStarted&&!this._dimensionsChangedIntervalId&&0!==this._dimensionsChangedEvent.size()){var a=this;this._dimensionsChangedData.previousWidth=this._videoElement.videoWidth,this._dimensionsChangedData.previousHeight=this._videoElement.videoHeight,this._dimensionsChangedIntervalId=setInterval(function(){a._videoElement.videoWidth===a._dimensionsChangedData.previousWidth&&a._videoElement.videoHeight===a._dimensionsChangedData.previousHeight||(a._dimensionsChangedData.previousWidth=a._videoElement.videoWidth,a._dimensionsChangedData.previousHeight=a._videoElement.videoHeight,a._dimensionsChangedEvent.fireAsync([a._renderer,{width:a._videoElement.videoWidth,height:a._videoElement.videoHeight}]))},a._dimensionsChangedData.pollFrequency)}}var h=500,i=15;return d.prototype.start=function(a,b){e.call(this,a,b)},d.prototype.stop=function(){f.call(this)},d.prototype.addVideoDisplayDimensionsChangedCallback=function(a){return b.isFunction(a,"addVideoDisplayDimensionsChangedCallback"),g.call(this),this._dimensionsChangedEvent.listen(a)},d.prototype.toString=function(){return"DimensionsChangedMonitor[pollFrequency="+this._dimensionsChangedData.pollFrequency+", previousHeight="+this._dimensionsChangedData.previousHeight+", previousWidth="+this._dimensionsChangedData.previousHeight+", state="+(this._dimensionsChangedIntervalId?"running":"stopped")+"]"},d}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";var a={roles:{participant:{id:0,name:"Participant"},moderator:{id:1,name:"Moderator"},presenter:{id:2,name:"Presenter"},audience:{id:3,name:"Audience"}},states:{active:{id:0,name:"Active"},passive:{id:1,name:"Passive"},handRaised:{id:2,name:"HandRaised"},inactive:{id:3,name:"Inactive"},offline:{id:4,name:"Offline"}}};return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";var a={types:{directChat:{id:0,name:"DirectChat"},multiPartyChat:{id:1,name:"MultiPartyChat"},moderatedChat:{id:2,name:"ModeratedChat"},townHall:{id:3,name:"TownHall"},channel:{id:4,name:"Channel"}},events:{memberJoined:{id:0,name:"MemberJoined"},memberLeft:{id:1,name:"MemberLeft"},memberUpdated:{id:2,name:"MemberUpdated"},roomUpdated:{id:3,name:"RoomUpdated"},roomEnded:{id:4,name:"RoomEnded"}}};return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e,f;!function(g,h){e=[c(48)],d=h,f="function"==typeof d?d.apply(b,e):d,!(void 0!==f&&(a.exports=f))}(this,function(a){"use strict";function b(a){var b=0;return function(){return b<a.length?a.charCodeAt(b++):null}}function c(){var a=[],b=[];return function(){return 0===arguments.length?b.join("")+i.apply(String,a):(a.length+arguments.length>1024&&(b.push(i.apply(String,a)),a.length=0),void Array.prototype.push.apply(a,arguments))}}function d(a,b,c,d,e){var f,g,h=8*e-d-1,i=(1<<h)-1,j=i>>1,k=-7,l=c?e-1:0,m=c?-1:1,n=a[b+l];for(l+=m,f=n&(1<<-k)-1,n>>=-k,k+=h;k>0;f=256*f+a[b+l],l+=m,k-=8);for(g=f&(1<<-k)-1,f>>=-k,k+=d;k>0;g=256*g+a[b+l],l+=m,k-=8);if(0===f)f=1-j;else{if(f===i)return g?NaN:(n?-1:1)*(1/0);g+=Math.pow(2,d),f-=j}return(n?-1:1)*g*Math.pow(2,f-d)}function e(a,b,c,d,e,f){var g,h,i,j=8*f-e-1,k=(1<<j)-1,l=k>>1,m=23===e?Math.pow(2,-24)-Math.pow(2,-77):0,n=d?0:f-1,o=d?1:-1,p=b<0||0===b&&1/b<0?1:0;for(b=Math.abs(b),isNaN(b)||b===1/0?(h=isNaN(b)?1:0,g=k):(g=Math.floor(Math.log(b)/Math.LN2),b*(i=Math.pow(2,-g))<1&&(g--,i*=2),b+=g+l>=1?m/i:m*Math.pow(2,1-l),b*i>=2&&(g++,i/=2),g+l>=k?(h=0,g=k):g+l>=1?(h=(b*i-1)*Math.pow(2,e),g+=l):(h=b*Math.pow(2,l-1)*Math.pow(2,e),g=0));e>=8;a[c+n]=255&h,n+=o,h/=256,e-=8);for(g=g<<e|h,j+=e;j>0;a[c+n]=255&g,n+=o,g/=256,j-=8);a[c+n-o]|=128*p}var f=function(a,b,c){if("undefined"==typeof a&&(a=f.DEFAULT_CAPACITY),"undefined"==typeof b&&(b=f.DEFAULT_ENDIAN),"undefined"==typeof c&&(c=f.DEFAULT_NOASSERT),!c){if(a=0|a,a<0)throw RangeError("Illegal capacity");b=!!b,c=!!c}this.buffer=0===a?h:new ArrayBuffer(a),this.view=0===a?null:new Uint8Array(this.buffer),this.offset=0,this.markedOffset=-1,this.limit=a,this.littleEndian=b,this.noAssert=c};f.VERSION="5.0.1",f.LITTLE_ENDIAN=!0,f.BIG_ENDIAN=!1,f.DEFAULT_CAPACITY=16,f.DEFAULT_ENDIAN=f.BIG_ENDIAN,f.DEFAULT_NOASSERT=!1,f.Long=a||null;var g=f.prototype;g.__isByteBuffer__,Object.defineProperty(g,"__isByteBuffer__",{value:!0,enumerable:!1,configurable:!1});var h=new ArrayBuffer(0),i=String.fromCharCode;f.accessor=function(){return Uint8Array},f.allocate=function(a,b,c){return new f(a,b,c)},f.concat=function(a,b,c,d){"boolean"!=typeof b&&"string"==typeof b||(d=c,c=b,b=void 0);for(var e,g=0,h=0,i=a.length;h<i;++h)f.isByteBuffer(a[h])||(a[h]=f.wrap(a[h],b)),e=a[h].limit-a[h].offset,e>0&&(g+=e);if(0===g)return new f(0,c,d);var j,k=new f(g,c,d);for(h=0;h<i;)j=a[h++],e=j.limit-j.offset,e<=0||(k.view.set(j.view.subarray(j.offset,j.limit),k.offset),k.offset+=e);return k.limit=k.offset,k.offset=0,k},f.isByteBuffer=function(a){return(a&&a.__isByteBuffer__)===!0},f.type=function(){return ArrayBuffer},f.wrap=function(a,b,c,d){if("string"!=typeof b&&(d=c,c=b,b=void 0),"string"==typeof a)switch("undefined"==typeof b&&(b="utf8"),b){case"base64":return f.fromBase64(a,c);case"hex":return f.fromHex(a,c);case"binary":return f.fromBinary(a,c);case"utf8":return f.fromUTF8(a,c);case"debug":return f.fromDebug(a,c);default:throw Error("Unsupported encoding: "+b)}if(null===a||"object"!=typeof a)throw TypeError("Illegal buffer");var e;if(f.isByteBuffer(a))return e=g.clone.call(a),e.markedOffset=-1,e;if(a instanceof Uint8Array)e=new f(0,c,d),a.length>0&&(e.buffer=a.buffer,e.offset=a.byteOffset,e.limit=a.byteOffset+a.byteLength,e.view=new Uint8Array(a.buffer));else if(a instanceof ArrayBuffer)e=new f(0,c,d),a.byteLength>0&&(e.buffer=a,e.offset=0,e.limit=a.byteLength,e.view=a.byteLength>0?new Uint8Array(a):null);else{if("[object Array]"!==Object.prototype.toString.call(a))throw TypeError("Illegal buffer");e=new f(a.length,c,d),e.limit=a.length;for(var h=0;h<a.length;++h)e.view[h]=a[h]}return e},g.writeBitSet=function(a,b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if(!(a instanceof Array))throw TypeError("Illegal BitSet: Not an array");if("number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}var d,e=b,f=a.length,g=f>>3,h=0;for(b+=this.writeVarint32(f,b);g--;)d=1&!!a[h++]|(1&!!a[h++])<<1|(1&!!a[h++])<<2|(1&!!a[h++])<<3|(1&!!a[h++])<<4|(1&!!a[h++])<<5|(1&!!a[h++])<<6|(1&!!a[h++])<<7,this.writeByte(d,b++);if(h<f){var i=0;for(d=0;h<f;)d|=(1&!!a[h++])<<i++;this.writeByte(d,b++)}return c?(this.offset=b,this):b-e},g.readBitSet=function(a){var b="undefined"==typeof a;b&&(a=this.offset);var c,d=this.readVarint32(a),e=d.value,f=e>>3,g=0,h=[];for(a+=d.length;f--;)c=this.readByte(a++),h[g++]=!!(1&c),h[g++]=!!(2&c),h[g++]=!!(4&c),h[g++]=!!(8&c),h[g++]=!!(16&c),h[g++]=!!(32&c),h[g++]=!!(64&c),h[g++]=!!(128&c);if(g<e){var i=0;for(c=this.readByte(a++);g<e;)h[g++]=!!(c>>i++&1)}return b&&(this.offset=a),h},g.readBytes=function(a,b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+a>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+"+a+") <= "+this.buffer.byteLength)}var d=this.slice(b,b+a);return c&&(this.offset+=a),d},g.writeBytes=g.append,g.writeInt8=function(a,b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a|=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}b+=1;var d=this.buffer.byteLength;return b>d&&this.resize((d*=2)>b?d:b),b-=1,this.view[b]=a,c&&(this.offset+=1),this},g.writeByte=g.writeInt8,g.readInt8=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+1) <= "+this.buffer.byteLength)}var c=this.view[a];return 128===(128&c)&&(c=-(255-c+1)),b&&(this.offset+=1),c},g.readByte=g.readInt8,g.writeUint8=function(a,b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a>>>=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}b+=1;var d=this.buffer.byteLength;return b>d&&this.resize((d*=2)>b?d:b),b-=1,this.view[b]=a,c&&(this.offset+=1),this},g.writeUInt8=g.writeUint8,g.readUint8=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+1) <= "+this.buffer.byteLength)}var c=this.view[a];return b&&(this.offset+=1),c},g.readUInt8=g.readUint8,g.writeInt16=function(a,b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a|=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}b+=2;var d=this.buffer.byteLength;return b>d&&this.resize((d*=2)>b?d:b),b-=2,this.littleEndian?(this.view[b+1]=(65280&a)>>>8,this.view[b]=255&a):(this.view[b]=(65280&a)>>>8,this.view[b+1]=255&a),c&&(this.offset+=2),this},g.writeShort=g.writeInt16,g.readInt16=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");
if(a>>>=0,a<0||a+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+2) <= "+this.buffer.byteLength)}var c=0;return this.littleEndian?(c=this.view[a],c|=this.view[a+1]<<8):(c=this.view[a]<<8,c|=this.view[a+1]),32768===(32768&c)&&(c=-(65535-c+1)),b&&(this.offset+=2),c},g.readShort=g.readInt16,g.writeUint16=function(a,b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a>>>=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}b+=2;var d=this.buffer.byteLength;return b>d&&this.resize((d*=2)>b?d:b),b-=2,this.littleEndian?(this.view[b+1]=(65280&a)>>>8,this.view[b]=255&a):(this.view[b]=(65280&a)>>>8,this.view[b+1]=255&a),c&&(this.offset+=2),this},g.writeUInt16=g.writeUint16,g.readUint16=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+2) <= "+this.buffer.byteLength)}var c=0;return this.littleEndian?(c=this.view[a],c|=this.view[a+1]<<8):(c=this.view[a]<<8,c|=this.view[a+1]),b&&(this.offset+=2),c},g.readUInt16=g.readUint16,g.writeInt32=function(a,b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a|=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}b+=4;var d=this.buffer.byteLength;return b>d&&this.resize((d*=2)>b?d:b),b-=4,this.littleEndian?(this.view[b+3]=a>>>24&255,this.view[b+2]=a>>>16&255,this.view[b+1]=a>>>8&255,this.view[b]=255&a):(this.view[b]=a>>>24&255,this.view[b+1]=a>>>16&255,this.view[b+2]=a>>>8&255,this.view[b+3]=255&a),c&&(this.offset+=4),this},g.writeInt=g.writeInt32,g.readInt32=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+4) <= "+this.buffer.byteLength)}var c=0;return this.littleEndian?(c=this.view[a+2]<<16,c|=this.view[a+1]<<8,c|=this.view[a],c+=this.view[a+3]<<24>>>0):(c=this.view[a+1]<<16,c|=this.view[a+2]<<8,c|=this.view[a+3],c+=this.view[a]<<24>>>0),c|=0,b&&(this.offset+=4),c},g.readInt=g.readInt32,g.writeUint32=function(a,b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a>>>=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}b+=4;var d=this.buffer.byteLength;return b>d&&this.resize((d*=2)>b?d:b),b-=4,this.littleEndian?(this.view[b+3]=a>>>24&255,this.view[b+2]=a>>>16&255,this.view[b+1]=a>>>8&255,this.view[b]=255&a):(this.view[b]=a>>>24&255,this.view[b+1]=a>>>16&255,this.view[b+2]=a>>>8&255,this.view[b+3]=255&a),c&&(this.offset+=4),this},g.writeUInt32=g.writeUint32,g.readUint32=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+4) <= "+this.buffer.byteLength)}var c=0;return this.littleEndian?(c=this.view[a+2]<<16,c|=this.view[a+1]<<8,c|=this.view[a],c+=this.view[a+3]<<24>>>0):(c=this.view[a+1]<<16,c|=this.view[a+2]<<8,c|=this.view[a+3],c+=this.view[a]<<24>>>0),b&&(this.offset+=4),c},g.readUInt32=g.readUint32,a&&(g.writeInt64=function(b,c){var d="undefined"==typeof c;if(d&&(c=this.offset),!this.noAssert){if("number"==typeof b)b=a.fromNumber(b);else if("string"==typeof b)b=a.fromString(b);else if(!(b&&b instanceof a))throw TypeError("Illegal value: "+b+" (not an integer or Long)");if("number"!=typeof c||c%1!==0)throw TypeError("Illegal offset: "+c+" (not an integer)");if(c>>>=0,c<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}"number"==typeof b?b=a.fromNumber(b):"string"==typeof b&&(b=a.fromString(b)),c+=8;var e=this.buffer.byteLength;c>e&&this.resize((e*=2)>c?e:c),c-=8;var f=b.low,g=b.high;return this.littleEndian?(this.view[c+3]=f>>>24&255,this.view[c+2]=f>>>16&255,this.view[c+1]=f>>>8&255,this.view[c]=255&f,c+=4,this.view[c+3]=g>>>24&255,this.view[c+2]=g>>>16&255,this.view[c+1]=g>>>8&255,this.view[c]=255&g):(this.view[c]=g>>>24&255,this.view[c+1]=g>>>16&255,this.view[c+2]=g>>>8&255,this.view[c+3]=255&g,c+=4,this.view[c]=f>>>24&255,this.view[c+1]=f>>>16&255,this.view[c+2]=f>>>8&255,this.view[c+3]=255&f),d&&(this.offset+=8),this},g.writeLong=g.writeInt64,g.readInt64=function(b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+8) <= "+this.buffer.byteLength)}var d=0,e=0;this.littleEndian?(d=this.view[b+2]<<16,d|=this.view[b+1]<<8,d|=this.view[b],d+=this.view[b+3]<<24>>>0,b+=4,e=this.view[b+2]<<16,e|=this.view[b+1]<<8,e|=this.view[b],e+=this.view[b+3]<<24>>>0):(e=this.view[b+1]<<16,e|=this.view[b+2]<<8,e|=this.view[b+3],e+=this.view[b]<<24>>>0,b+=4,d=this.view[b+1]<<16,d|=this.view[b+2]<<8,d|=this.view[b+3],d+=this.view[b]<<24>>>0);var f=new a(d,e,(!1));return c&&(this.offset+=8),f},g.readLong=g.readInt64,g.writeUint64=function(b,c){var d="undefined"==typeof c;if(d&&(c=this.offset),!this.noAssert){if("number"==typeof b)b=a.fromNumber(b);else if("string"==typeof b)b=a.fromString(b);else if(!(b&&b instanceof a))throw TypeError("Illegal value: "+b+" (not an integer or Long)");if("number"!=typeof c||c%1!==0)throw TypeError("Illegal offset: "+c+" (not an integer)");if(c>>>=0,c<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}"number"==typeof b?b=a.fromNumber(b):"string"==typeof b&&(b=a.fromString(b)),c+=8;var e=this.buffer.byteLength;c>e&&this.resize((e*=2)>c?e:c),c-=8;var f=b.low,g=b.high;return this.littleEndian?(this.view[c+3]=f>>>24&255,this.view[c+2]=f>>>16&255,this.view[c+1]=f>>>8&255,this.view[c]=255&f,c+=4,this.view[c+3]=g>>>24&255,this.view[c+2]=g>>>16&255,this.view[c+1]=g>>>8&255,this.view[c]=255&g):(this.view[c]=g>>>24&255,this.view[c+1]=g>>>16&255,this.view[c+2]=g>>>8&255,this.view[c+3]=255&g,c+=4,this.view[c]=f>>>24&255,this.view[c+1]=f>>>16&255,this.view[c+2]=f>>>8&255,this.view[c+3]=255&f),d&&(this.offset+=8),this},g.writeUInt64=g.writeUint64,g.readUint64=function(b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+8) <= "+this.buffer.byteLength)}var d=0,e=0;this.littleEndian?(d=this.view[b+2]<<16,d|=this.view[b+1]<<8,d|=this.view[b],d+=this.view[b+3]<<24>>>0,b+=4,e=this.view[b+2]<<16,e|=this.view[b+1]<<8,e|=this.view[b],e+=this.view[b+3]<<24>>>0):(e=this.view[b+1]<<16,e|=this.view[b+2]<<8,e|=this.view[b+3],e+=this.view[b]<<24>>>0,b+=4,d=this.view[b+1]<<16,d|=this.view[b+2]<<8,d|=this.view[b+3],d+=this.view[b]<<24>>>0);var f=new a(d,e,(!0));return c&&(this.offset+=8),f},g.readUInt64=g.readUint64),g.writeFloat32=function(a,b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a)throw TypeError("Illegal value: "+a+" (not a number)");if("number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}b+=4;var d=this.buffer.byteLength;return b>d&&this.resize((d*=2)>b?d:b),b-=4,e(this.view,a,b,this.littleEndian,23,4),c&&(this.offset+=4),this},g.writeFloat=g.writeFloat32,g.readFloat32=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+4) <= "+this.buffer.byteLength)}var c=d(this.view,a,this.littleEndian,23,4);return b&&(this.offset+=4),c},g.readFloat=g.readFloat32,g.writeFloat64=function(a,b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a)throw TypeError("Illegal value: "+a+" (not a number)");if("number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}b+=8;var d=this.buffer.byteLength;return b>d&&this.resize((d*=2)>b?d:b),b-=8,e(this.view,a,b,this.littleEndian,52,8),c&&(this.offset+=8),this},g.writeDouble=g.writeFloat64,g.readFloat64=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+8) <= "+this.buffer.byteLength)}var c=d(this.view,a,this.littleEndian,52,8);return b&&(this.offset+=8),c},g.readDouble=g.readFloat64,f.MAX_VARINT32_BYTES=5,f.calculateVarint32=function(a){return a>>>=0,a<128?1:a<16384?2:a<1<<21?3:a<1<<28?4:5},f.zigZagEncode32=function(a){return((a|=0)<<1^a>>31)>>>0},f.zigZagDecode32=function(a){return a>>>1^-(1&a)|0},g.writeVarint32=function(a,b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a|=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}var d,e=f.calculateVarint32(a);b+=e;var g=this.buffer.byteLength;for(b>g&&this.resize((g*=2)>b?g:b),b-=e,a>>>=0;a>=128;)d=127&a|128,this.view[b++]=d,a>>>=7;return this.view[b++]=a,c?(this.offset=b,this):e},g.writeVarint32ZigZag=function(a,b){return this.writeVarint32(f.zigZagEncode32(a),b)},g.readVarint32=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+1) <= "+this.buffer.byteLength)}var c,d=0,e=0;do{if(!this.noAssert&&a>this.limit){var f=Error("Truncated");throw f.truncated=!0,f}c=this.view[a++],d<5&&(e|=(127&c)<<7*d),++d}while(0!==(128&c));return e|=0,b?(this.offset=a,e):{value:e,length:d}},g.readVarint32ZigZag=function(a){var b=this.readVarint32(a);return"object"==typeof b?b.value=f.zigZagDecode32(b.value):b=f.zigZagDecode32(b),b},a&&(f.MAX_VARINT64_BYTES=10,f.calculateVarint64=function(b){"number"==typeof b?b=a.fromNumber(b):"string"==typeof b&&(b=a.fromString(b));var c=b.toInt()>>>0,d=b.shiftRightUnsigned(28).toInt()>>>0,e=b.shiftRightUnsigned(56).toInt()>>>0;return 0==e?0==d?c<16384?c<128?1:2:c<1<<21?3:4:d<16384?d<128?5:6:d<1<<21?7:8:e<128?9:10},f.zigZagEncode64=function(b){return"number"==typeof b?b=a.fromNumber(b,!1):"string"==typeof b?b=a.fromString(b,!1):b.unsigned!==!1&&(b=b.toSigned()),b.shiftLeft(1).xor(b.shiftRight(63)).toUnsigned()},f.zigZagDecode64=function(b){return"number"==typeof b?b=a.fromNumber(b,!1):"string"==typeof b?b=a.fromString(b,!1):b.unsigned!==!1&&(b=b.toSigned()),b.shiftRightUnsigned(1).xor(b.and(a.ONE).toSigned().negate()).toSigned()},g.writeVarint64=function(b,c){var d="undefined"==typeof c;if(d&&(c=this.offset),!this.noAssert){if("number"==typeof b)b=a.fromNumber(b);else if("string"==typeof b)b=a.fromString(b);else if(!(b&&b instanceof a))throw TypeError("Illegal value: "+b+" (not an integer or Long)");if("number"!=typeof c||c%1!==0)throw TypeError("Illegal offset: "+c+" (not an integer)");if(c>>>=0,c<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}"number"==typeof b?b=a.fromNumber(b,!1):"string"==typeof b?b=a.fromString(b,!1):b.unsigned!==!1&&(b=b.toSigned());var e=f.calculateVarint64(b),g=b.toInt()>>>0,h=b.shiftRightUnsigned(28).toInt()>>>0,i=b.shiftRightUnsigned(56).toInt()>>>0;c+=e;var j=this.buffer.byteLength;switch(c>j&&this.resize((j*=2)>c?j:c),c-=e,e){case 10:this.view[c+9]=i>>>7&1;case 9:this.view[c+8]=9!==e?128|i:127&i;case 8:this.view[c+7]=8!==e?h>>>21|128:h>>>21&127;case 7:this.view[c+6]=7!==e?h>>>14|128:h>>>14&127;case 6:this.view[c+5]=6!==e?h>>>7|128:h>>>7&127;case 5:this.view[c+4]=5!==e?128|h:127&h;case 4:this.view[c+3]=4!==e?g>>>21|128:g>>>21&127;case 3:this.view[c+2]=3!==e?g>>>14|128:g>>>14&127;case 2:this.view[c+1]=2!==e?g>>>7|128:g>>>7&127;case 1:this.view[c]=1!==e?128|g:127&g}return d?(this.offset+=e,this):e},g.writeVarint64ZigZag=function(a,b){return this.writeVarint64(f.zigZagEncode64(a),b)},g.readVarint64=function(b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+1) <= "+this.buffer.byteLength)}var d=b,e=0,f=0,g=0,h=0;if(h=this.view[b++],e=127&h,128&h&&(h=this.view[b++],e|=(127&h)<<7,(128&h||this.noAssert&&"undefined"==typeof h)&&(h=this.view[b++],e|=(127&h)<<14,(128&h||this.noAssert&&"undefined"==typeof h)&&(h=this.view[b++],e|=(127&h)<<21,(128&h||this.noAssert&&"undefined"==typeof h)&&(h=this.view[b++],f=127&h,(128&h||this.noAssert&&"undefined"==typeof h)&&(h=this.view[b++],f|=(127&h)<<7,(128&h||this.noAssert&&"undefined"==typeof h)&&(h=this.view[b++],f|=(127&h)<<14,(128&h||this.noAssert&&"undefined"==typeof h)&&(h=this.view[b++],f|=(127&h)<<21,(128&h||this.noAssert&&"undefined"==typeof h)&&(h=this.view[b++],g=127&h,(128&h||this.noAssert&&"undefined"==typeof h)&&(h=this.view[b++],g|=(127&h)<<7,128&h||this.noAssert&&"undefined"==typeof h))))))))))throw Error("Buffer overrun");var i=a.fromBits(e|f<<28,f>>>4|g<<24,!1);return c?(this.offset=b,i):{value:i,length:b-d}},g.readVarint64ZigZag=function(b){var c=this.readVarint64(b);return c&&c.value instanceof a?c.value=f.zigZagDecode64(c.value):c=f.zigZagDecode64(c),c}),g.writeCString=function(a,c){var d="undefined"==typeof c;d&&(c=this.offset);var e,f=a.length;if(!this.noAssert){if("string"!=typeof a)throw TypeError("Illegal str: Not a string");for(e=0;e<f;++e)if(0===a.charCodeAt(e))throw RangeError("Illegal str: Contains NULL-characters");if("number"!=typeof c||c%1!==0)throw TypeError("Illegal offset: "+c+" (not an integer)");if(c>>>=0,c<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}f=k.calculateUTF16asUTF8(b(a))[1],c+=f+1;var g=this.buffer.byteLength;return c>g&&this.resize((g*=2)>c?g:c),c-=f+1,k.encodeUTF16toUTF8(b(a),function(a){this.view[c++]=a}.bind(this)),this.view[c++]=0,d?(this.offset=c,this):f},g.readCString=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+1) <= "+this.buffer.byteLength)}var d,e=a,f=-1;return k.decodeUTF8toUTF16(function(){if(0===f)return null;if(a>=this.limit)throw RangeError("Illegal range: Truncated data, "+a+" < "+this.limit);return f=this.view[a++],0===f?null:f}.bind(this),d=c(),!0),b?(this.offset=a,d()):{string:d(),length:a-e}},g.writeIString=function(a,c){var d="undefined"==typeof c;if(d&&(c=this.offset),!this.noAssert){if("string"!=typeof a)throw TypeError("Illegal str: Not a string");if("number"!=typeof c||c%1!==0)throw TypeError("Illegal offset: "+c+" (not an integer)");if(c>>>=0,c<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}var e,f=c;e=k.calculateUTF16asUTF8(b(a),this.noAssert)[1],c+=4+e;var g=this.buffer.byteLength;if(c>g&&this.resize((g*=2)>c?g:c),c-=4+e,this.littleEndian?(this.view[c+3]=e>>>24&255,this.view[c+2]=e>>>16&255,this.view[c+1]=e>>>8&255,this.view[c]=255&e):(this.view[c]=e>>>24&255,this.view[c+1]=e>>>16&255,this.view[c+2]=e>>>8&255,this.view[c+3]=255&e),c+=4,k.encodeUTF16toUTF8(b(a),function(a){this.view[c++]=a}.bind(this)),c!==f+4+e)throw RangeError("Illegal range: Truncated data, "+c+" == "+(c+4+e));return d?(this.offset=c,this):c-f},g.readIString=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+4) <= "+this.buffer.byteLength)}var c=a,d=this.readUint32(a),e=this.readUTF8String(d,f.METRICS_BYTES,a+=4);return a+=e.length,b?(this.offset=a,e.string):{string:e.string,length:a-c}},f.METRICS_CHARS="c",f.METRICS_BYTES="b",g.writeUTF8String=function(a,c){var d="undefined"==typeof c;if(d&&(c=this.offset),!this.noAssert){if("number"!=typeof c||c%1!==0)throw TypeError("Illegal offset: "+c+" (not an integer)");if(c>>>=0,c<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}var e,f=c;e=k.calculateUTF16asUTF8(b(a))[1],c+=e;var g=this.buffer.byteLength;return c>g&&this.resize((g*=2)>c?g:c),c-=e,k.encodeUTF16toUTF8(b(a),function(a){this.view[c++]=a}.bind(this)),d?(this.offset=c,this):c-f},g.writeString=g.writeUTF8String,f.calculateUTF8Chars=function(a){return k.calculateUTF16asUTF8(b(a))[0]},f.calculateUTF8Bytes=function(a){return k.calculateUTF16asUTF8(b(a))[1]},f.calculateString=f.calculateUTF8Bytes,g.readUTF8String=function(a,b,d){"number"==typeof b&&(d=b,b=void 0);var e="undefined"==typeof d;if(e&&(d=this.offset),"undefined"==typeof b&&(b=f.METRICS_CHARS),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal length: "+a+" (not an integer)");if(a|=0,"number"!=typeof d||d%1!==0)throw TypeError("Illegal offset: "+d+" (not an integer)");if(d>>>=0,d<0||d+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+d+" (+0) <= "+this.buffer.byteLength)}var g,h=0,i=d;if(b===f.METRICS_CHARS){if(g=c(),k.decodeUTF8(function(){return h<a&&d<this.limit?this.view[d++]:null}.bind(this),function(a){++h,k.UTF8toUTF16(a,g)}),h!==a)throw RangeError("Illegal range: Truncated data, "+h+" == "+a);return e?(this.offset=d,g()):{string:g(),length:d-i}}if(b===f.METRICS_BYTES){if(!this.noAssert){if("number"!=typeof d||d%1!==0)throw TypeError("Illegal offset: "+d+" (not an integer)");if(d>>>=0,d<0||d+a>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+d+" (+"+a+") <= "+this.buffer.byteLength)}var j=d+a;if(k.decodeUTF8toUTF16(function(){return d<j?this.view[d++]:null}.bind(this),g=c(),this.noAssert),d!==j)throw RangeError("Illegal range: Truncated data, "+d+" == "+j);return e?(this.offset=d,g()):{string:g(),length:d-i}}throw TypeError("Unsupported metrics: "+b)},g.readString=g.readUTF8String,g.writeVString=function(a,c){var d="undefined"==typeof c;if(d&&(c=this.offset),!this.noAssert){if("string"!=typeof a)throw TypeError("Illegal str: Not a string");if("number"!=typeof c||c%1!==0)throw TypeError("Illegal offset: "+c+" (not an integer)");if(c>>>=0,c<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}var e,g,h=c;e=k.calculateUTF16asUTF8(b(a),this.noAssert)[1],g=f.calculateVarint32(e),c+=g+e;var i=this.buffer.byteLength;if(c>i&&this.resize((i*=2)>c?i:c),c-=g+e,c+=this.writeVarint32(e,c),k.encodeUTF16toUTF8(b(a),function(a){this.view[c++]=a}.bind(this)),c!==h+e+g)throw RangeError("Illegal range: Truncated data, "+c+" == "+(c+e+g));return d?(this.offset=c,this):c-h},g.readVString=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+1) <= "+this.buffer.byteLength)}var c=a,d=this.readVarint32(a),e=this.readUTF8String(d.value,f.METRICS_BYTES,a+=d.length);return a+=e.length,b?(this.offset=a,e.string):{string:e.string,length:a-c}},g.append=function(a,b,c){"number"!=typeof b&&"string"==typeof b||(c=b,b=void 0);var d="undefined"==typeof c;if(d&&(c=this.offset),!this.noAssert){if("number"!=typeof c||c%1!==0)throw TypeError("Illegal offset: "+c+" (not an integer)");if(c>>>=0,c<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}a instanceof f||(a=f.wrap(a,b));var e=a.limit-a.offset;if(e<=0)return this;c+=e;var g=this.buffer.byteLength;return c>g&&this.resize((g*=2)>c?g:c),c-=e,this.view.set(a.view.subarray(a.offset,a.limit),c),a.offset+=e,d&&(this.offset+=e),this},g.appendTo=function(a,b){return a.append(this,b),this},g.assert=function(a){return this.noAssert=!a,this},g.capacity=function(){return this.buffer.byteLength},g.clear=function(){return this.offset=0,this.limit=this.buffer.byteLength,this.markedOffset=-1,this},g.clone=function(a){var b=new f(0,this.littleEndian,this.noAssert);return a?(b.buffer=new ArrayBuffer(this.buffer.byteLength),b.view=new Uint8Array(b.buffer)):(b.buffer=this.buffer,b.view=this.view),b.offset=this.offset,b.markedOffset=this.markedOffset,b.limit=this.limit,b},g.compact=function(a,b){if("undefined"==typeof a&&(a=this.offset),"undefined"==typeof b&&(b=this.limit),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal begin: Not an integer");if(a>>>=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal end: Not an integer");if(b>>>=0,a<0||a>b||b>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+b+" <= "+this.buffer.byteLength)}if(0===a&&b===this.buffer.byteLength)return this;var c=b-a;if(0===c)return this.buffer=h,this.view=null,this.markedOffset>=0&&(this.markedOffset-=a),this.offset=0,this.limit=0,this;var d=new ArrayBuffer(c),e=new Uint8Array(d);return e.set(this.view.subarray(a,b)),this.buffer=d,this.view=e,this.markedOffset>=0&&(this.markedOffset-=a),this.offset=0,this.limit=c,this},g.copy=function(a,b){if("undefined"==typeof a&&(a=this.offset),"undefined"==typeof b&&(b=this.limit),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal begin: Not an integer");if(a>>>=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal end: Not an integer");if(b>>>=0,a<0||a>b||b>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+b+" <= "+this.buffer.byteLength)}if(a===b)return new f(0,this.littleEndian,this.noAssert);var c=b-a,d=new f(c,this.littleEndian,this.noAssert);return d.offset=0,d.limit=c,d.markedOffset>=0&&(d.markedOffset-=a),this.copyTo(d,0,a,b),d},g.copyTo=function(a,b,c,d){var e,g;if(!this.noAssert&&!f.isByteBuffer(a))throw TypeError("Illegal target: Not a ByteBuffer");if(b=(g="undefined"==typeof b)?a.offset:0|b,c=(e="undefined"==typeof c)?this.offset:0|c,d="undefined"==typeof d?this.limit:0|d,b<0||b>a.buffer.byteLength)throw RangeError("Illegal target range: 0 <= "+b+" <= "+a.buffer.byteLength);if(c<0||d>this.buffer.byteLength)throw RangeError("Illegal source range: 0 <= "+c+" <= "+this.buffer.byteLength);var h=d-c;return 0===h?a:(a.ensureCapacity(b+h),a.view.set(this.view.subarray(c,d),b),e&&(this.offset+=h),g&&(a.offset+=h),this)},g.ensureCapacity=function(a){var b=this.buffer.byteLength;return b<a?this.resize((b*=2)>a?b:a):this},g.fill=function(a,b,c){var d="undefined"==typeof b;if(d&&(b=this.offset),"string"==typeof a&&a.length>0&&(a=a.charCodeAt(0)),"undefined"==typeof b&&(b=this.offset),"undefined"==typeof c&&(c=this.limit),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a|=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal begin: Not an integer");if(b>>>=0,"number"!=typeof c||c%1!==0)throw TypeError("Illegal end: Not an integer");if(c>>>=0,b<0||b>c||c>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+b+" <= "+c+" <= "+this.buffer.byteLength)}if(b>=c)return this;for(;b<c;)this.view[b++]=a;return d&&(this.offset=b),this},g.flip=function(){return this.limit=this.offset,this.offset=0,this},g.mark=function(a){if(a="undefined"==typeof a?this.offset:a,!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+0) <= "+this.buffer.byteLength)}return this.markedOffset=a,this},g.order=function(a){if(!this.noAssert&&"boolean"!=typeof a)throw TypeError("Illegal littleEndian: Not a boolean");return this.littleEndian=!!a,this},g.LE=function(a){return this.littleEndian="undefined"==typeof a||!!a,this},g.BE=function(a){return this.littleEndian="undefined"!=typeof a&&!a,this},g.prepend=function(a,b,c){"number"!=typeof b&&"string"==typeof b||(c=b,b=void 0);var d="undefined"==typeof c;if(d&&(c=this.offset),!this.noAssert){if("number"!=typeof c||c%1!==0)throw TypeError("Illegal offset: "+c+" (not an integer)");if(c>>>=0,c<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}a instanceof f||(a=f.wrap(a,b));var e=a.limit-a.offset;if(e<=0)return this;var g=e-c;if(g>0){var h=new ArrayBuffer(this.buffer.byteLength+g),i=new Uint8Array(h);i.set(this.view.subarray(c,this.buffer.byteLength),e),this.buffer=h,this.view=i,this.offset+=g,this.markedOffset>=0&&(this.markedOffset+=g),this.limit+=g,c+=g}else{new Uint8Array(this.buffer)}return this.view.set(a.view.subarray(a.offset,a.limit),c-e),a.offset=a.limit,d&&(this.offset-=e),this},g.prependTo=function(a,b){return a.prepend(this,b),this},g.printDebug=function(a){"function"!=typeof a&&(a=console.log.bind(console)),a(this.toString()+"\n-------------------------------------------------------------------\n"+this.toDebug(!0))},g.remaining=function(){return this.limit-this.offset},g.reset=function(){return this.markedOffset>=0?(this.offset=this.markedOffset,this.markedOffset=-1):this.offset=0,this},g.resize=function(a){if(!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal capacity: "+a+" (not an integer)");if(a|=0,a<0)throw RangeError("Illegal capacity: 0 <= "+a)}if(this.buffer.byteLength<a){var b=new ArrayBuffer(a),c=new Uint8Array(b);c.set(this.view),this.buffer=b,this.view=c}return this},g.reverse=function(a,b){if("undefined"==typeof a&&(a=this.offset),"undefined"==typeof b&&(b=this.limit),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal begin: Not an integer");if(a>>>=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal end: Not an integer");if(b>>>=0,a<0||a>b||b>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+b+" <= "+this.buffer.byteLength)}return a===b?this:(Array.prototype.reverse.call(this.view.subarray(a,b)),this)},g.skip=function(a){if(!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal length: "+a+" (not an integer)");a|=0}var b=this.offset+a;if(!this.noAssert&&(b<0||b>this.buffer.byteLength))throw RangeError("Illegal length: 0 <= "+this.offset+" + "+a+" <= "+this.buffer.byteLength);return this.offset=b,this},g.slice=function(a,b){if("undefined"==typeof a&&(a=this.offset),"undefined"==typeof b&&(b=this.limit),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal begin: Not an integer");if(a>>>=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal end: Not an integer");if(b>>>=0,a<0||a>b||b>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+b+" <= "+this.buffer.byteLength)}var c=this.clone();return c.offset=a,c.limit=b,c},g.toBuffer=function(a){var b=this.offset,c=this.limit;if(!this.noAssert){if("number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: Not an integer");if(b>>>=0,"number"!=typeof c||c%1!==0)throw TypeError("Illegal limit: Not an integer");if(c>>>=0,b<0||b>c||c>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+b+" <= "+c+" <= "+this.buffer.byteLength)}if(!a&&0===b&&c===this.buffer.byteLength)return this.buffer;if(b===c)return h;var d=new ArrayBuffer(c-b);return new Uint8Array(d).set(new Uint8Array(this.buffer).subarray(b,c),0),d},g.toArrayBuffer=g.toBuffer,g.toString=function(a,b,c){if("undefined"==typeof a)return"ByteBufferAB(offset="+this.offset+",markedOffset="+this.markedOffset+",limit="+this.limit+",capacity="+this.capacity()+")";switch("number"==typeof a&&(a="utf8",b=a,c=b),a){case"utf8":return this.toUTF8(b,c);case"base64":return this.toBase64(b,c);case"hex":return this.toHex(b,c);case"binary":return this.toBinary(b,c);case"debug":return this.toDebug();case"columns":return this.toColumns();default:throw Error("Unsupported encoding: "+a)}};var j=function(){for(var a={},b=[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,43,47],c=[],d=0,e=b.length;d<e;++d)c[b[d]]=d;return a.encode=function(a,c){for(var d,e;null!==(d=a());)c(b[d>>2&63]),e=(3&d)<<4,null!==(d=a())?(e|=d>>4&15,c(b[63&(e|d>>4&15)]),e=(15&d)<<2,null!==(d=a())?(c(b[63&(e|d>>6&3)]),c(b[63&d])):(c(b[63&e]),c(61))):(c(b[63&e]),c(61),c(61))},a.decode=function(a,b){function d(a){throw Error("Illegal character code: "+a)}for(var e,f,g;null!==(e=a());)if(f=c[e],"undefined"==typeof f&&d(e),null!==(e=a())&&(g=c[e],"undefined"==typeof g&&d(e),b(f<<2>>>0|(48&g)>>4),null!==(e=a()))){if(f=c[e],"undefined"==typeof f){if(61===e)break;d(e)}if(b((15&g)<<4>>>0|(60&f)>>2),null!==(e=a())){if(g=c[e],"undefined"==typeof g){if(61===e)break;d(e)}b((3&f)<<6>>>0|g)}}},a.test=function(a){return/^(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?$/.test(a)},a}();g.toBase64=function(a,b){if("undefined"==typeof a&&(a=this.offset),"undefined"==typeof b&&(b=this.limit),a=0|a,b=0|b,a<0||b>this.capacity||a>b)throw RangeError("begin, end");var d;return j.encode(function(){return a<b?this.view[a++]:null}.bind(this),d=c()),d()},f.fromBase64=function(a,c){if("string"!=typeof a)throw TypeError("str");var d=new f(a.length/4*3,c),e=0;return j.decode(b(a),function(a){d.view[e++]=a}),d.limit=e,d},f.btoa=function(a){return f.fromBinary(a).toBase64()},f.atob=function(a){return f.fromBase64(a).toBinary()},g.toBinary=function(a,b){if("undefined"==typeof a&&(a=this.offset),"undefined"==typeof b&&(b=this.limit),a|=0,b|=0,a<0||b>this.capacity()||a>b)throw RangeError("begin, end");if(a===b)return"";for(var c=[],d=[];a<b;)c.push(this.view[a++]),c.length>=1024&&(d.push(String.fromCharCode.apply(String,c)),c=[]);return d.join("")+String.fromCharCode.apply(String,c)},f.fromBinary=function(a,b){if("string"!=typeof a)throw TypeError("str");for(var c,d=0,e=a.length,g=new f(e,b);d<e;){if(c=a.charCodeAt(d),c>255)throw RangeError("illegal char code: "+c);g.view[d++]=c}return g.limit=e,g},g.toDebug=function(a){for(var b,c=-1,d=this.buffer.byteLength,e="",f="",g="";c<d;){if(c!==-1&&(b=this.view[c],e+=b<16?"0"+b.toString(16).toUpperCase():b.toString(16).toUpperCase(),a&&(f+=b>32&&b<127?String.fromCharCode(b):".")),++c,a&&c>0&&c%16===0&&c!==d){for(;e.length<51;)e+=" ";g+=e+f+"\n",e=f=""}e+=c===this.offset&&c===this.limit?c===this.markedOffset?"!":"|":c===this.offset?c===this.markedOffset?"[":"<":c===this.limit?c===this.markedOffset?"]":">":c===this.markedOffset?"'":a||0!==c&&c!==d?" ":""}if(a&&" "!==e){for(;e.length<51;)e+=" ";g+=e+f+"\n"}return a?g:e},f.fromDebug=function(a,b,c){for(var d,e,g=a.length,h=new f((g+1)/3|0,b,c),i=0,j=0,k=!1,l=!1,m=!1,n=!1,o=!1;i<g;){
switch(d=a.charAt(i++)){case"!":if(!c){if(l||m||n){o=!0;break}l=m=n=!0}h.offset=h.markedOffset=h.limit=j,k=!1;break;case"|":if(!c){if(l||n){o=!0;break}l=n=!0}h.offset=h.limit=j,k=!1;break;case"[":if(!c){if(l||m){o=!0;break}l=m=!0}h.offset=h.markedOffset=j,k=!1;break;case"<":if(!c){if(l){o=!0;break}l=!0}h.offset=j,k=!1;break;case"]":if(!c){if(n||m){o=!0;break}n=m=!0}h.limit=h.markedOffset=j,k=!1;break;case">":if(!c){if(n){o=!0;break}n=!0}h.limit=j,k=!1;break;case"'":if(!c){if(m){o=!0;break}m=!0}h.markedOffset=j,k=!1;break;case" ":k=!1;break;default:if(!c&&k){o=!0;break}if(e=parseInt(d+a.charAt(i++),16),!c&&(isNaN(e)||e<0||e>255))throw TypeError("Illegal str: Not a debug encoded string");h.view[j++]=e,k=!0}if(o)throw TypeError("Illegal str: Invalid symbol at "+i)}if(!c){if(!l||!n)throw TypeError("Illegal str: Missing offset or limit");if(j<h.buffer.byteLength)throw TypeError("Illegal str: Not a debug encoded string (is it hex?) "+j+" < "+g)}return h},g.toHex=function(a,b){if(a="undefined"==typeof a?this.offset:a,b="undefined"==typeof b?this.limit:b,!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal begin: Not an integer");if(a>>>=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal end: Not an integer");if(b>>>=0,a<0||a>b||b>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+b+" <= "+this.buffer.byteLength)}for(var c,d=new Array(b-a);a<b;)c=this.view[a++],c<16?d.push("0",c.toString(16)):d.push(c.toString(16));return d.join("")},f.fromHex=function(a,b,c){if(!c){if("string"!=typeof a)throw TypeError("Illegal str: Not a string");if(a.length%2!==0)throw TypeError("Illegal str: Length not a multiple of 2")}for(var d,e=a.length,g=new f(e/2|0,b),h=0,i=0;h<e;h+=2){if(d=parseInt(a.substring(h,h+2),16),!c&&(!isFinite(d)||d<0||d>255))throw TypeError("Illegal str: Contains non-hex characters");g.view[i++]=d}return g.limit=i,g};var k=function(){var a={};return a.MAX_CODEPOINT=1114111,a.encodeUTF8=function(a,b){var c=null;for("number"==typeof a&&(c=a,a=function(){return null});null!==c||null!==(c=a());)c<128?b(127&c):c<2048?(b(c>>6&31|192),b(63&c|128)):c<65536?(b(c>>12&15|224),b(c>>6&63|128),b(63&c|128)):(b(c>>18&7|240),b(c>>12&63|128),b(c>>6&63|128),b(63&c|128)),c=null},a.decodeUTF8=function(a,b){for(var c,d,e,f,g=function(a){a=a.slice(0,a.indexOf(null));var b=Error(a.toString());throw b.name="TruncatedError",b.bytes=a,b};null!==(c=a());)if(0===(128&c))b(c);else if(192===(224&c))null===(d=a())&&g([c,d]),b((31&c)<<6|63&d);else if(224===(240&c))(null===(d=a())||null===(e=a()))&&g([c,d,e]),b((15&c)<<12|(63&d)<<6|63&e);else{if(240!==(248&c))throw RangeError("Illegal starting byte: "+c);(null===(d=a())||null===(e=a())||null===(f=a()))&&g([c,d,e,f]),b((7&c)<<18|(63&d)<<12|(63&e)<<6|63&f)}},a.UTF16toUTF8=function(a,b){for(var c,d=null;;){if(null===(c=null!==d?d:a()))break;c>=55296&&c<=57343&&null!==(d=a())&&d>=56320&&d<=57343?(b(1024*(c-55296)+d-56320+65536),d=null):b(c)}null!==d&&b(d)},a.UTF8toUTF16=function(a,b){var c=null;for("number"==typeof a&&(c=a,a=function(){return null});null!==c||null!==(c=a());)c<=65535?b(c):(c-=65536,b((c>>10)+55296),b(c%1024+56320)),c=null},a.encodeUTF16toUTF8=function(b,c){a.UTF16toUTF8(b,function(b){a.encodeUTF8(b,c)})},a.decodeUTF8toUTF16=function(b,c){a.decodeUTF8(b,function(b){a.UTF8toUTF16(b,c)})},a.calculateCodePoint=function(a){return a<128?1:a<2048?2:a<65536?3:4},a.calculateUTF8=function(a){for(var b,c=0;null!==(b=a());)c+=b<128?1:b<2048?2:b<65536?3:4;return c},a.calculateUTF16asUTF8=function(b){var c=0,d=0;return a.UTF16toUTF8(b,function(a){++c,d+=a<128?1:a<2048?2:a<65536?3:4}),[c,d]},a}();return g.toUTF8=function(a,b){if("undefined"==typeof a&&(a=this.offset),"undefined"==typeof b&&(b=this.limit),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal begin: Not an integer");if(a>>>=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal end: Not an integer");if(b>>>=0,a<0||a>b||b>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+b+" <= "+this.buffer.byteLength)}var d;try{k.decodeUTF8toUTF16(function(){return a<b?this.view[a++]:null}.bind(this),d=c())}catch(e){if(a!==b)throw RangeError("Illegal range: Truncated data, "+a+" != "+b)}return d()},f.fromUTF8=function(a,c,d){if(!d&&"string"!=typeof a)throw TypeError("Illegal str: Not a string");var e=new f(k.calculateUTF16asUTF8(b(a),!0)[1],c,d),g=0;return k.encodeUTF16toUTF8(b(a),function(a){e.view[g++]=a}),e.limit=g,e},f})},function(a,b,c){var d,e;d=[c(49)],e=function(a){"use strict";return new a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";var a={level:{TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,FATAL:5}};return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(67),c(66),c(31)],e=function(a,b,c){return{MQWebSocket:a,BatchHttpProto:b,MQService:c}}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(6),c(3),c(54)],e=function(a,b,c,d){"use strict";function e(a,b,d,e){if("string"!=typeof a)throw new Error('Must pass a valid "version"');if("string"!=typeof b)throw new Error('Must pass a valid "baseUri"');if("object"!=typeof d)throw new Error('Must pass a valid "logger"');this._version=a,this._baseUri=b,this._logger=d,this._disposables=new c.DisposableList,this._sessionTelemetry=e}function f(a,b){if(0===a.lastIndexOf("wss:",0))b(void 0,{uri:a+"/ws",roundTripTime:0});else if(0===a.lastIndexOf("https:",0)){var c=this;g.call(c,a,function(a,e){if(a)return b(a);var f=new d(c._logger,c._version,b,function(a,b){return a?void c._logger.warn("An error occured in resolving an endpoint",a):void c._sessionTelemetry.recordMetric("RoundTripTime",{uint64:b.time},null,{resource:b.endPoint,kind:"https"})});f.resolveAll(e),c._disposables.add(f)})}else b(new Error("Uri not supported"))}function g(c,d){var e=b.getWithRetry(c+"/pcast/endPoints",{timeout:15e3,queryParameters:{version:"2018-04-17T00:14:18Z",_:a.now()},retryOptions:{maxAttempts:h}},function(a,b){if(a)return d(new Error("Failed to resolve an end point",a));var c=b.data.split(",");c.length<1&&d(new Error("Failed to discover end points")),d(void 0,c)});this._disposables.add(e)}var h=4;return e.DefaultPCastUri="https://pcast.phenixp2p.com",e.prototype.getBaseUri=function(){return this._baseUri},e.prototype.resolveUri=function(a){return f.call(this,this._baseUri,a)},e.prototype.dispose=function(){this._disposables.dispose()},e.prototype.toString=function(){return"PCastEndPoint["+this._baseUri+"]"},e}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(8),c(82)],e=function(a,b,c,d){"use strict";function e(){}return e.prototype.createPCastLogger=function(a,e){a&&b.isStringNotEmpty(a,"baseUri");var f=new c.Logger,g=d.getAppender(a);return g.setThreshold(c.level.INFO),e||f.addAppender(new c.ConsoleAppender),f.addAppender(g),f.isPCastLogger=!0,f},new e}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(4),c(19),c(41)],e=function(a,b,c,d,e){"use strict";function f(a,b,c,d){this.init(a,b,c,d)}function g(b){return a.includes(b,n)?n:o}function h(a,b){return f.parsePCastStreamIdFromStreamUri(a)===f.parsePCastStreamIdFromStreamUri(b)}function i(b){var c={},d=b.split("?");if(2!==d.length)return c;var e=d[1],f=e.split("&");return a.forEach(f,function(a){var b=a.split("="),d=b[0];c[d]=b[1]}),c}function j(b){if(b=a.getEnumName(l,b),!b)throw new Error('"type" must be a valid stream type');return b}function k(b){if(b=a.getEnumName(m,b),!b)throw new Error('"state" must be a valid track state');return b}var l=d.types,m=e.states,n="pcast://phenixp2p.com/",o="pcast://phenixrts.com/";return f.prototype.init=function(a,d,e,g){b.isString(a,"uri"),this._uri=new c.Observable(a),this._type=new c.Observable(d,j),this._audioState=new c.Observable(e||m.trackEnabled.name,k),this._videoState=new c.Observable(g||m.trackEnabled.name,k),this._streamId=f.parsePCastStreamIdFromStreamUri(a)},f.prototype.getUri=function(){return this._uri.getValue()},f.prototype.getType=function(){return this._type.getValue()},f.prototype.getObservableAudioState=function(){return this._audioState},f.prototype.getObservableVideoState=function(){return this._videoState},f.prototype.toJson=function(){return{uri:this._uri.getValue(),type:this._type.getValue(),audioState:this._audioState.getValue(),videoState:this._videoState.getValue()}},f.prototype._update=function(b){a.isObject(b)&&(b.hasOwnProperty("uri")&&b.uri!==this._uri.getValue()&&h(b.uri,this._uri.getValue())&&(this._uri.setValue(b.uri),this._streamId=f.parsePCastStreamIdFromStreamUri(b.uri)),b.hasOwnProperty("audioState")&&this._audioState.setValue(b.audioState),b.hasOwnProperty("videoState")&&this._videoState.setValue(b.videoState))},f.prototype.isPCastStream=function(){return!!this._streamId},f.prototype.getPCastStreamId=function(){return this._streamId},f.prototype.getInfo=function(){return i(this._uri.getValue())},f.getPCastPrefix=function(){return n},f.parsePCastStreamIdFromStreamUri=function(b){var c=a.includes(b,g(b));return c?b.replace(g(b),"").split("?")[0]:null},f.getInfoFromStreamUri=function(a){return i(a)},f}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";var a={types:{user:{id:0,name:"User"},presentation:{id:1,name:"Presentation"},audio:{id:2,name:"Audio"}}};return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(4),c(3),c(17),c(6),c(33),c(74),c(16),c(102),c(103),c(43),c(9),c(100),c(99),c(98),c(42),c(94),c(89),c(92),c(7),c(2),c(87)],e=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){"use strict";function x(f){f=f||{},b.isObject(f,"options"),f.streamingSourceMapping&&(b.isObject(f.streamingSourceMapping,"options.streamingSourceMapping"),b.isStringNotEmpty(f.streamingSourceMapping.replacement,"options.streamingSourceMapping.replacement"),f.streamingSourceMapping.patternToReplace instanceof RegExp||b.isStringNotEmpty(f.streamingSourceMapping.patternToReplace,"options.streamingSourceMapping.patternToReplace")),a.isNullOrUndefined(f.disableMultiplePCastInstanceWarning)||b.isBoolean(f.disableMultiplePCastInstanceWarning,"options.disableMultiplePCastInstanceWarning"),this._observableStatus=new c.Observable("offline"),this._baseUri=f.uri||i.DefaultPCastUri,this._deviceId=f.deviceId||"",this._version=$,this._logger=f.logger||e.createPCastLogger(this._baseUri,f.disableConsoleLogging),this._metricsTransmitter=f.metricsTransmitter||n.createMetricsTransmitter(this._baseUri),this._screenShareExtensionManager=new j(f,this._logger),this._shaka=f.shaka,this._videojs=f.videojs||v.global.videojs,this._status="offline",this._streamingSourceMapping=f.streamingSourceMapping,this._disposables=new d.DisposableList,this._disableMultiplePCastInstanceWarning=f.disableMultiplePCastInstanceWarning,this._canPlaybackAudio=!0;var g=this;a.addEventListener(v.global,"unload",function(){return g._logger.info("Window Unload Event Triggered"),g.stop()}),f.disableBeforeUnload||a.addEventListener(v.global,"beforeunload",function(){return g._logger.info("Window Before Unload Event Triggered"),g.stop()}),v.webrtcSupported||"ReactNative"!==v.browser||v.shim(),v.webrtcSupported&&(N.call(this),O.call(this))}function y(b){this._protocol=new h(b,this._deviceId,this._version,this._logger),this._protocol.onEvent("connected",a.bind(z,this)),this._protocol.onEvent("reconnecting",a.bind(A,this)),this._protocol.onEvent("reconnected",a.bind(B,this)),this._protocol.onEvent("disconnected",a.bind(D,this)),this._protocol.onEvent("pcast.StreamEnded",a.bind(G,this)),this._protocol.onEvent("pcast.StreamDataQuality",a.bind(H,this)),this._logger.setObservableSessionId&&this._logger.setObservableSessionId(this._protocol.getObservableSessionId()),this._sessionTelemetrySubscription&&(this._sessionTelemetrySubscription.dispose(),this._sessionTelemetry.setSessionId(null)),this._sessionTelemetrySubscription=this._protocol.getObservableSessionId().subscribe(a.bind(this._sessionTelemetry.setSessionId,this._sessionTelemetry))}function z(){if(E.call(this)&&"offline"===this._observableStatus.getValue())return this._logger.warn("[PCast] connected after being offline. Going offline."),T.call(this,"critical-network-issue"),this.stop();var a=this;this._connected=!0,a._stopped||a._protocol.authenticate(a._authToken,function(b,c){a._authenticationCallback&&(b?(a._logger.error("Failed to authenticate [%s]",b),T.call(a,"unauthorized"),a._authenticationCallback.call(a,a,"unauthorized","")):"ok"!==c.status?(a._logger.warn("Failed to authenticate, status [%s]",c.status),T.call(a,"unauthorized"),a._authenticationCallback.call(a,a,"unauthorized","")):(T.call(a,"online"),a._authenticationCallback.call(a,a,c.status,c.sessionId)))})}function A(){T.call(this,"reconnecting")}function B(){T.call(this,"reconnected"),this._logger.info("Attempting to re-authenticate after reconnect event"),C.call(this)}function C(){var a=this;a._stopped||a._protocol.authenticate(a._authToken,function(b,c){var d=a._connected===!0;if(b)return a._logger.error("Unable to authenticate after reconnect to WebSocket [%s]",b),T.call(a,"reconnect-failed");if("ok"!==c.status){a._logger.warn("Unable to authenticate after reconnect to WebSocket, status [%s]",c.status);var e="capacity"===c.status?c.status:"reconnect-failed";return T.call(a,e)}return a._connected=!0,a._logger.info("Successfully authenticated after reconnect to WebSocket"),T.call(a,"online",null,d)})}function D(){return E.call(this)&&"reconnecting"===this._observableStatus.getValue()?(this._logger.warn("[PCast] disconnected after attempting to reconnect. Going offline."),T.call(this,"critical-network-issue"),this.stop()):(this._connected=!1,void T.call(this,"offline"))}function E(){return a.reduce(this._peerConnections,function(a,b){return a?"closed"===b.iceConnectionState:a},!0)}function F(a){switch(a){case"":case"none":case"ended":return"ended";case"server-error":case"session-error":case"not-ready":case"error":case"died":return"failed";case"censored":return"censored";case"maintenance":return"maintenance";case"capacity":return"capacity";case"app-background":return"app-background";default:return"custom"}}function G(a){var b=a.streamId,c=a.reason;return I.call(this,b,c)}function H(a){var b=a.streamId,c=a.status,d=a.reason,e=this._mediaStreams[b];e&&e.dataQualityChangedCallback(c,d);var f=this._publishers[b];f&&"function"==typeof f.dataQualityChangedCallback&&f.dataQualityChangedCallback(f,c,d)}function I(a,b){this._logger.info("[%s] Stream ended with reason [%s]",a,b);var c=this._mediaStreams[a];c&&c.streamEndedCallback(F(b),b,!0),delete this._mediaStreams[a];var d=this._publishers[a];d&&"function"==typeof d.publisherEndedCallback&&d.publisherEndedCallback(d,F(b),b),delete this._publishers[a];var e=this._peerConnections[a];e&&V.call(this,a,e,"ended"),delete this._peerConnections[a]}function J(b,c,d,e,f,g){var h=this,i=function(i){if(!c.failed){var j=i.stream,k="real-time";if(!j)return c.failed=!0,h._logger.warn("[%s] No remote stream",b),f.call(h,void 0,"failed");h._logger.info("[%s] Got remote stream",b),e.setProperty("kind",k);var l=a.assign({networkLag:h._networkOneWayLatency},g),m=new t(b,j,d,e,l,h._logger),n=new r(k,m,h._logger),o=function(a,b){h._logger.warn("Phenix Real-Time Stream Error [%s] [%s]",a,b),n.streamErrorCallback(k,b)},p=function(a){c.stopped||(h._logger.info("[%s] stop media stream",b),V.call(h,b,d,"stop"),h._protocol.destroyStream(b,a||"",function(a,c){return a?void h._logger.error("[%s] failed to destroy stream [%s]",b,a):"ok"!==c.status?void h._logger.warn("[%s] failed to destroy stream, status [%s]",b,c.status):void h._logger.info("[%s] destroyed stream",b)}),c.stopped=!0)};n.on(u.streamEvents.playerError.name,o),n.on(u.streamEvents.stopped.name,p),h._mediaStreams[b]=n,f.call(h,m)}};a.addEventListener(d,"addstream",i)}function K(b,c,d){var e=this,f=function(a){var c=a.candidate;c?e._logger.debug("[%s] ICE candidate: [%s] [%s] [%s]",b,c.sdpMid,c.sdpMLineIndex,c.candidate):e._logger.info("[%s] ICE candidate discovery complete",b),d&&d(c)};a.addEventListener(c,"icecandidate",f)}function L(b,c){var d=this,e=function(a){d._logger.info("[%s] Negotiation needed")},f=function(a){d._logger.info("[%s] ICE connection state changed [%s]",b,c.iceConnectionState)},g=function(a){d._logger.info("[%s] ICE gathering state changed [%s]",b,c.iceGatheringState)},h=function(a){d._logger.info("[%s] Signaling state changed [%s]",b,c.signalingState)},i=function(a){d._logger.info("[%s] Connection state changed [%s]",b,c.connectionState)};a.addEventListener(c,"negotiationneeded",e),a.addEventListener(c,"iceconnectionstatechange",f),a.addEventListener(c,"icegatheringstatechange ",g),a.addEventListener(c,"signalingstatechange",h),a.addEventListener(c,"connectionstatechange",i)}function M(a,b,c){var d=this,e={stopped:!1},f={getStreamId:function(){return a},getStream:function(){return d._logger.debug("[%s] Unable to get stream on publisher of remote origin.",a),null},getStats:function(){return d._logger.debug("[%s] Unable to get stream stats on publisher of remote origin.",a),null},isActive:function(){return!e.stopped},hasEnded:function(){return e.stopped},stop:function(b){e.stopped||(d._protocol.destroyStream(a,b||"",function(b,c){return b?void d._logger.error("[%s] failed to destroy stream [%s]",a,b):"ok"!==c.status?void d._logger.warn("[%s] failed to destroy stream, status [%s]",a,c.status):void d._logger.info("[%s] destroyed stream",a)}),e.stopped=!0)},setPublisherEndedCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.publisherEndedCallback=a},setDataQualityChangedCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.dataQualityChangedCallback=a},getOptions:function(){return c},monitor:function(a,b){if("object"!=typeof a)throw new Error('"options" must be an object');if("function"!=typeof b)throw new Error('"callback" must be a function')},getMonitor:function(){return null}};d._publishers[a]=f,b(f)}function N(){var a=this,b=new v.RTCPeerConnection;"Safari"===v.browser&&v.browserVersion>10&&(b.addTransceiver("audio"),b.addTransceiver("video")),b.createOffer(function(b){var c=w.getH264ProfileId(b.sdp);return c?(a._logger.info("Found local h264 profile level id [%s]",c,b.sdp),void(a._h264ProfileId=c)):a._logger.info("Unable to find local h264 profile level id")},function(b){a._logger.error("Unable to create offer to get local h264 profile level id",b)},{offerToReceiveAudio:!0,offerToReceiveVideo:!0})}function O(b){var c=this;switch(v.browser){case"Edge":return v.getDestinations(function(d){var e=a.filter(d,function(a){return"audio"===a.kind});0===e.length?(c._canPlaybackAudio&&c._logger.info("Detected no audio devices attached to machine"),c._canPlaybackAudio=!1):c._canPlaybackAudio=!0,b&&b()});default:b&&b()}}function P(c,d,e,f,g,h,i,j){function k(){function c(c){m._logger.info("Created answer [%s]",c.sdp),m._protocol.setAnswerDescription(e,c.sdp,function(c,g){function i(){var c=/(b=AS:([0-9]*)[\n\r]*)/gi,g=/(mid:video)([\n\r]*)/gi;m._logger.info("Set local description (answer)");var i=0,k=c.exec(f);k&&k.length>=3&&(i=1e3*k[2]);var o={getStreamId:function(){return e},getStream:function(){return d},isActive:function(){return!n.stopped},hasEnded:function(){switch(r.iceConnectionState){case"new":case"checking":case"connected":case"completed":return!1;case"disconnected":case"failed":case"closed":return!0;default:return!0}},stop:function(a){n.stopped||(V.call(m,e,r,"closed"),m._protocol.destroyStream(e,a||"",function(a,b){return a?void m._logger.error("[%s] failed to destroy stream [%s]",e,a):"ok"!==b.status?void m._logger.warn("[%s] failed to destroy stream, status [%s]",e,b.status):void m._logger.info("[%s] destroyed stream",e)}),n.stopped=!0)},setPublisherEndedCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.publisherEndedCallback=a},setDataQualityChangedCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.dataQualityChangedCallback=a},limitBandwidth:function(a){if("Edge"===v.browser)return m._logger.warn("Limit bandwidth not support on [%s]",v.browser);if("number"!=typeof a)throw new Error('"bandwidthLimit" must be a number');var b=i?Math.min(a,i):a,d=r.remoteDescription;m._logger.info("Changing bandwidth limit to [%s]",b);var e=d.sdp.replace(c,"");e=e.replace(g,function(a,c,d,e,f){return[c,d,"b=AS:",Math.ceil(b/1e3),d].join("")});var f=new v.RTCSessionDescription({type:d.type,sdp:e});return r.setRemoteDescription(f),{dispose:function(){r.setRemoteDescription(d)}}},getMonitor:function(){return u},monitor:function p(b,c){if("object"!=typeof b)throw new Error('"options" must be an object');if("function"!=typeof c)throw new Error('"callback" must be a function');var p=new l(e,r,m._logger);return b.direction="outbound",p.start(b,function(){return m._publishers[e]===o&&!n.stopped},function(a,b){return a&&m._logger.warn("[%s] Publisher monitor triggered unrecoverable error [%s]",a),m._logger.warn("[%s] Publisher triggered monitor condition for [%s]",e,b.type),c(o,"client-side-failure",b)}),a.forEach(d.getTracks(),function(b){a.addEventListener(b,"readystatechange",function(){if("ended"===b.readyState)return m._logger.warn("[%s] Publisher track has failed [%s]",e,b),c(o,"camera-track-failure",{type:b.kind+"-track-ended",message:"Publisher "+b.kind+" track has ended in an unrecoverable way. This may require reconfiguring your camera or microphone."})})}),u=p,p},setRemoteMediaStreamCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.remoteMediaStreamCallback=a,s&&a(o,s)},getOptions:function(){return j},getStats:function(a){b.isFunction(a,"callback"),this._lastStats||(this._lastStats={});var c=this;return v.getStats(r,null,function(b){a(q.convertPeerConnectionStats(b,c._lastStats))})}};m._publishers[e]=o,h.call(m,o)}if(c)return m._logger.error("Failed to set answer description [%s]",c),x();if("ok"!==g.status)return m._logger.warn("Failed to set answer description, status [%s]",g.status),x(g.status);a.includes(g.options,"ice-candidates")&&(t=function(b){var c=[],d=[];b?c.push(b):d.push("completed"),m._protocol.addIceCandidates(e,c,d,function(b,c){return b?void m._logger.error("Failed to add ICE candidate [%s]",b):"ok"!==c.status?void m._logger.warn("Failed to add ICE candidate, status [%s]",c.status):void(a.includes(c.options,"cancel")&&(t=null))})});var k=new v.RTCSessionDescription({type:"answer",sdp:g.sessionDescription.sdp});r.setLocalDescription(k,i,x)})}m._logger.info("Set remote description (offer)");var g={mandatory:{}};"Chrome"===v.browser||"ReactNative"===v.browser?(g.mandatory.OfferToReceiveVideo=i.receiveVideo===!0,g.mandatory.OfferToReceiveAudio=i.receiveAudio===!0):(g.mandatory.offerToReceiveVideo=i.receiveVideo===!0,g.mandatory.offerToReceiveAudio=i.receiveAudio===!0),r.createAnswer(c,x,g)}var m=this,n={failed:!1,stopped:!1},o=f.match(/a=crypto:/i),p=f.match(/m=application /i),r=new v.RTCPeerConnection(c,{optional:[{DtlsSrtpKeyAgreement:!o},{RtpDataChannels:p}]}),s=null,t=null,u=null;if(m._peerConnections[e]=r,r.addStream(d),"Firefox"===v.browser||"Edge"===v.browser){if(f.match(/(\nm=video)/g)&&f.match(/(\nm=audio)/g)){var w=/(a=candidate)((.|\n)*)(?=m=)/g;f=f.replace(w,f.match(w)+"a=end-of-candidates\n")}f+="a=end-of-candidates",f=f.replace(/(\na=ice-options:trickle)/g,"")}var x=function(a){n.failed||(n.failed=!0,n.stopped=!0,delete m._peerConnections[e],V.call(m,e,r,"failure"),h.call(m,void 0,a||"failed"))};J.call(m,e,n,r,g,function(a){var b=m._publishers[e];s=a,b&&b.remoteMediaStreamCallback&&b.remoteMediaStreamCallback(b,a)},i),K.call(m,e,r,function(a){t&&t(a)}),L.call(m,e,r);var y=new v.RTCSessionDescription({type:"offer",sdp:f});r.setRemoteDescription(y,k,x)}function Q(b,c,d,e,f,g){function h(){function b(b){i._logger.info("Created answer [%s]",b.sdp),i._protocol.setAnswerDescription(c,b.sdp,function(b,d){function e(){i._logger.debug("Set local description (answer)")}if(b)return i._logger.error("Failed to set answer description [%s]",b),p();if("ok"!==d.status)return i._logger.warn("Failed to set answer description, status [%s]",d.status),p(d.status);a.includes(d.options,"ice-candidates")&&(n=function(b){var d=[],e=[];b?d.push(b):e.push("completed"),i._protocol.addIceCandidates(c,b,e,function(b,c){return b?void i._logger.error("Failed to add ICE candidate [%s]",b):"ok"!==c.status?void i._logger.warn("Failed to add ICE candidate, status [%s]",c.status):void(a.includes(c.options,"cancel")&&(n=null))})});var f=new v.RTCSessionDescription({type:"answer",sdp:d.sessionDescription.sdp});m.setLocalDescription(f,e,p)})}i._logger.debug("Set remote description (offer)");var d={mandatory:{}};"Chrome"===v.browser||"ReactNative"===v.browser?(d.mandatory.OfferToReceiveVideo=g.receiveVideo!==!1,d.mandatory.OfferToReceiveAudio=g.receiveAudio!==!1):(d.mandatory.offerToReceiveVideo=g.receiveVideo!==!1,d.mandatory.offerToReceiveAudio=g.receiveAudio!==!1),m.createAnswer(b,p,d)}if("IE"===v.browser)throw new Error("Subscribing in real-time not supported on IE without the PhenixP2P Plugin");var i=this,j={failed:!1,stopped:!1},k=d.match(/a=crypto:/i),l=d.match(/m=application /i),m=new v.RTCPeerConnection(b,{optional:[{DtlsSrtpKeyAgreement:!k},{RtpDataChannels:l}]}),n=null;if(i._peerConnections[c]=m,"Firefox"===v.browser||"Edge"===v.browser){if(d.match(/(\nm=video)/g)&&d.match(/(\nm=audio)/g)){var o=/(a=candidate)((.|\n)*)(?=m=)/g;d=d.replace(o,d.match(o)+"a=end-of-candidates\n")}d+="a=end-of-candidates",d=d.replace(/(\na=ice-options:trickle)/g,"")}"ReactNative"===v.browser&&(d=ca(d));var p=function(a){j.failed||(j.failed=!0,j.stopped=!0,delete i._peerConnections[c],V.call(i,c,m,"failure"),f.call(i,void 0,a||"failed"))};J.call(i,c,j,m,e,f,g),K.call(i,c,m,function(a){n&&n(a)}),L.call(i,c,m);var q=new v.RTCSessionDescription({type:"offer",sdp:d});m.setRemoteDescription(q,h,p)}function R(b,c,d,e,f){var g=this,h=c.match(/a=x-playlist:([^\n]*[.]mpd\??[^\s]*)/m),i=c.match(/a=x-playlist:([^\n]*[.]m3u8\??[^\s]*)/m),j=a.get(h,[1],""),k=a.get(i,[1],"");this._streamingSourceMapping&&(j=j.replace(this._streamingSourceMapping.patternToReplace,this._streamingSourceMapping.replacement),k=k.replace(this._streamingSourceMapping.patternToReplace,this._streamingSourceMapping.replacement));var l=ba()||"Safari"===v.browser;return h&&2===h.length&&!l?(f.isDrmProtectedContent=/[?&]drmToken=([^&]*)/.test(h[1])||/x-widevine-service-certificate/.test(c),f.isDrmProtectedContent&&(f.widevineServiceCertificateUrl=c.match(/a=x-widevine-service-certificate:([^\n][^\s]*)/m)[1],f.playreadyLicenseUrl=c.match(/a=x-playready-license-url:([^\n][^\s]*)/m)[1]),this._shaka&&!this._shaka.Player.isBrowserSupported()?(this._logger.warn("[%s] Shaka does not support this browser",b),e.call(this,void 0,"browser-unsupported")):S.call(g,b,j,u.types.dash.name,d,e,f)):(i&&2===i.length,g._logger.warn("[%s] Offer does not contain a supported manifest",b,c),e.call(g,void 0,"failed"))}function S(a,b,c,d,e,f){var g=this,h=new s(c,a,b,d,f,this._shaka,this._logger),i=new r(c,h,this._logger),j=function(a,b){g._logger.warn("Phenix Live Stream Player Error [%s] [%s]",a,b),i.streamErrorCallback(a,b)},k=function(b){g._protocol.destroyStream(a,b||"",function(b,c){return b?void g._logger.error("[%s] failed to destroy stream, [%s]",a,b):"ok"!==c.status?void g._logger.warn("[%s] failed to destroy stream, status [%s]",a,c.status):void 0})};d.setProperty("kind",c),i.on(u.streamEvents.playerError.name,j),i.on(u.streamEvents.stopped.name,k),this._mediaStreams[a]=i,e.call(this,i.getPhenixMediaStream())}function T(a,b,c){var d=this.getStatus();if(d!==a&&(!U(d)||"offline"!==a)){if(this._observableStatus.setValue(a),c)return;switch(a){case"connecting":case"reconnecting":case"reconnected":break;case"critical-network-issue":case"unauthorized":case"reconnect-failed":case"offline":return this._offlineCallback.call(this);case"online":return this._onlineCallback.call(this)}}}function U(a){return"critical-network-issue"===a||"offline"===a}function V(a,b,c){"closed"===b.signalingState||b.__closing||(this._logger.debug("[%s] close peer connection [%s]",a,c),b.close(),b.__closing=!0)}function W(b){if(!b)return b;var c=a.isArray(b)?[]:{},d=a.bind(X,null,c);return a.isArray(b)?a.forEach(b,d):a.forOwn(b,d),c}function X(b,c,d){if(null!==c){if(a.isObject(c)||a.isArray(c))return b[d]=W(c);if(!a.isString(c)||!a.isString(d))return b[d]=c;var e=a.startsWith(c.toLowerCase(),d.toLowerCase()),f=e?c.substring(d.length,c.length).toLowerCase():c;b[d]=f}}function Y(a){return"Firefox"===v.browser&&Z(a),a}function Z(b){return b?(a.forEach(b.iceServers,function(b){b.urls=a.filter(b.urls,function(b){return!a.startsWith(b,"turns")})}),b):b}var $="2018-04-17T00:14:18Z",_=!0;x.prototype.getBaseUri=function(){return this._baseUri},x.prototype.getStatus=function(){return this._observableStatus.getValue()},x.prototype.getObservableStatus=function(){return this._observableStatus},x.prototype.isStarted=function(){return this._started},x.prototype.reAuthenticate=function(a){return b.isStringNotEmpty(a,"authToken"),"online"===this._observableStatus.getValue()?this._logger.warn("Already authenticated. Denying request to re-authenticate"):(this._logger.info("Attempting to re-authenticate with new auth token [%s]",a),this._authToken=a,void B.call(this))},x.prototype.start=function(b,c,d,e){if("string"!=typeof b)throw new Error('"authToken" must be a string');if("function"!=typeof c)throw new Error('"authenticationCallback" must be a function');if("function"!=typeof d)throw new Error('"onlineCallback" must be a function');if("function"!=typeof e)throw new Error('"offlineCallback" must be a function');if(this._started)throw new Error('"Already started"');a.isNumber(v.global.__phenixInstantiatedPCastCount)?v.global.__phenixInstantiatedPCastCount++:v.global.__phenixInstantiatedPCastCount=1,v.global.__phenixInstantiatedPCastCount>1&&!this._disableMultiplePCastInstanceWarning&&this._logger.warn("Avoid using multiple instances of PCast as this uses unnecessary resources and will reduce performance. This is your [%s] simultaneous instance. Remember to dispose all resources when done with them by calling .stop() or .dispose()",v.global.__phenixInstantiatedPCastCount),this._stopped=!1,this._started=!0,this._authToken=b,this._authenticationCallback=c,this._onlineCallback=d,this._offlineCallback=e,this._sessionTelemetry=new p(this._logger,this._metricsTransmitter),this._endPoint=new i(this._version,this._baseUri,this._logger,this._sessionTelemetry),T.call(this,"connecting"),this._peerConnections={},this._mediaStreams={},this._publishers={},this._gumStreams=[],this._disposables.add(this._endPoint),this._disposables.add(this._sessionTelemetry);var f=this;f._endPoint.resolveUri(function(a,b){if(a){switch(f._logger.error("Failed to connect to [%s]",f._baseUri,a),T.call(f,"offline"),a.code){case 0:f._authenticationCallback.call(f,f,"network-unavailable","");break;case 503:f._authenticationCallback.call(f,f,"capacity","");break;default:f._authenticationCallback.call(f,f,"failed","")}return f._stopped=!0,void(f._started=!1)}f._logger.info("Discovered end point [%s] with RTT [%s]",b.uri,b.roundTripTime),f._networkOneWayLatency=b.roundTripTime/2,f._resolvedEndPoint=b.uri,y.call(f,b.uri)})},x.prototype.stop=function(){if(this._started){this._stopped=!0,this._started=!1,delete this._authenticationCallback;try{var b="",c=this;a.forOwn(this._mediaStreams,function(a,d){I.call(c,d,b)}),a.forOwn(this._publishers,function(d,e){I.call(c,e,b),a.includes(d.getOptions(),"detached")||d.stop(b,!0)}),a.forOwn(this._peerConnections,function(a,d){I.call(c,d,b)}),a.forEach(this._gumStreams,function(b){var c=b.getTracks();a.forEach(c,function(a){a.stop()})})}finally{this._protocol&&(this._protocol.disconnect(),this._protocol=null),this._logger.setObservableSessionId&&this._logger.setObservableSessionId(null),this._sessionTelemetrySubscription&&(this._sessionTelemetrySubscription.dispose(),
this._sessionTelemetry.setSessionId(null)),v.global.__phenixInstantiatedPCastCount--,this._disposables.dispose()}}},x.prototype.getUserMedia=function(a,c,d){if("IE"===v.browser)throw new Error("Publishing not supported on IE");b.isObject(a,"options"),b.isFunction(c,"callback"),d&&b.isFunction(d,"onScreenShare");var e=new k(this._logger,this._screenShareExtensionManager,d);return e.getUserMedia(a,c)},x.prototype.publish=function(b,c,d,e,f){if("IE"===v.browser)throw new Error("Publishing not supported on IE");if(!this._started)throw new Error("PCast not started. Unable to publish. Please start pcast first.");if("string"!=typeof b)throw new Error('"streamToken" must be a string');if("object"!=typeof c&&"string"!=typeof c)throw new Error('"streamToPublish" must be an object or URI');if("function"!=typeof d)throw new Error('"callback" must be a function');if(e=e||[],!Array.isArray(e))throw new Error('"tags" must be an array');if(f=f||{},"object"!=typeof f)throw new Error('"options" must be an object');var g=this,h="upload",i=a.assign({},f,{negotiate:!0});"string"==typeof c?(i.negotiate=!1,i.connectUri=c):i.connectUri=f.connectUri,e.length>0&&(i.tags=e);var j=new o(this.getProtocol().getSessionId(),this._logger,this._metricsTransmitter);j.setProperty("resource",h),this._protocol.setupStream(h,b,i,2*g._networkOneWayLatency,function(a,b){if(a)return g._logger.error("Failed to create uploader [%s]",a),d.call(g,g,"failed");if("ok"===b.status){var e=b.createStreamResponse.streamId;if(j.setStreamId(e),j.setStartOffset(b.createStreamResponse.offset),j.recordMetric("Provisioned"),j.recordMetric("RoundTripTime",{uint64:2*g._networkOneWayLatency},null,{resource:g._resolvedEndPoint,kind:"https"}),i.negotiate===!0){var h=b.createStreamResponse.createOfferDescriptionResponse.sessionDescription.sdp,k=Y(W(b.createStreamResponse.rtcConfiguration));return P.call(g,k,c,e,h,j,function(a,b){j.recordMetric("SetupCompleted",{string:b?"failed":"ok"}),b?d.call(g,g,"failed",null):d.call(g,g,"ok",a)},f,b.createStreamResponse.options)}return M.call(g,e,function(a,b){j.recordMetric("SetupCompleted",{string:b?"failed":"ok"}),b?d.call(g,g,"failed",null):d.call(g,g,"ok",a)},b.createStreamResponse.options)}switch(g._logger.warn("Failed to create uploader, status [%s]",b.status),b.status){case"timeout":case"capacity":case"unauthorized":return d.call(g,g,b.status);default:return d.call(g,g,"failed")}})},x.prototype.subscribe=function(b,c,d){if(!this._started)throw new Error("PCast not started. Unable to subscribe. Please start pcast first.");if("string"!=typeof b)throw new Error('"streamToken" must be a string');if("function"!=typeof c)throw new Error('"callback" must be a function');if(d=d||{},"object"!=typeof d)throw new Error('"options" must be an object');var e=this;O.call(e,function(){var f="download",g=a.assign({},d,{negotiate:d.negotiate!==!1}),h=new o(e.getProtocol().getSessionId(),e._logger,e._metricsTransmitter),i=a.assign({},{useNativeHlsPlayer:_},d);i.canPlaybackAudio=e._canPlaybackAudio,!e._canPlaybackAudio&&d.disableAudioIfNoOutputFound&&d.receiveAudio!==!1&&(g.receiveAudio=!1,i.receiveAudio=!1,i.forcedAudioDisabled=!0),h.setProperty("resource",f),e._protocol.setupStream(f,b,g,2*e._networkOneWayLatency,function(b,d){if(b)return e._logger.error("Failed to create downloader [%s]",b),c.call(e,e,"failed");if("ok"===d.status){var f=d.createStreamResponse.streamId,g=d.createStreamResponse.createOfferDescriptionResponse.sessionDescription.sdp,j=Y(W(d.createStreamResponse.rtcConfiguration)),k=a.bind(Q,e,j);if(g.match(/a=x-playlist:/)&&(k=R),h.setStreamId(f),h.setStartOffset(d.createStreamResponse.offset),h.recordMetric("Provisioned"),h.recordMetric("RoundTripTime",{uint64:2*e._networkOneWayLatency},null,{resource:e.getBaseUri(),kind:"https"}),i.originStartTime=a.now()-d.createStreamResponse.offset+e._networkOneWayLatency,"Chrome"===v.browser&&v.browserVersion>=62&&e._h264ProfileId&&aa()){var l=w.getH264ProfileId(g);l!==e._h264ProfileId&&(e._logger.info("[%s] Replacing h264 profile level id [%s] with new value [%s] in offer sdp",f,l,e._h264ProfileId),g=w.replaceH264ProfileId(g,e._h264ProfileId))}return k.call(e,f,g,h,function(a,b){h.recordMetric("SetupCompleted",{string:b?"failed":"ok"}),b?c.call(e,e,"failed",null):c.call(e,e,"ok",a)},i)}switch(e._logger.warn("Failed to create downloader, status [%s]",d.status),d.status){case"capacity":case"stream-ended":case"origin-stream-ended":case"streaming-not-available":case"unauthorized":case"timeout":return c.call(e,e,d.status);default:return c.call(e,e,"failed")}})})},x.prototype.getProtocol=function(){return this._protocol},x.prototype.getLogger=function(){return this._logger},x.prototype.toString=function(){var a=this.getProtocol(),b=a?a.getSessionId():"";return"PCast["+b||"unauthenticated,"+(a?a.toString():"uninitialized")+"]"};var aa=function(){var b=a.get(v,["global","navigator","userAgent"],"");return ba()||/Android|webOS|BlackBerry|IEMobile|Opera Mini|Mobile|mobile|CriOS/i.test(b)},ba=function(){var b=a.get(v,["global","navigator","userAgent"],"");return/iPad|iPhone|iPod/.test(b)&&!v.global.MSStream},ca=function(b){var c=b.match(/(?=a=group:BUNDLE).*/),d=a.get(a.get(c,[0],"").split("a=group:BUNDLE "),[1],""),e=d.split(" "),f=e.sort(function(a,c){return b.indexOf("m="+a)>b.indexOf("m="+c)});return f.length>0&&(b=b.replace(d,f.join(" "))),b};return x}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(4),c(29),c(32),c(24),c(20),c(2),c(95)],e=function(a,b,c,d,e,f,g,h,i){"use strict";function j(d){if(b.isObject(d,"options"),b.isStringNotEmpty(d.backendUri,"options.backendUri"),b.isObject(d.authenticationData,"options.authenticationData"),d.authToken&&b.isStringNotEmpty(d.authToken,"options.authToken"),d.onError&&b.isFunction(d.onError,"options.onError"),!a.isNullOrUndefined(d.onlineTimeout)&&(b.isNumber(d.onlineTimeout,"options.onlineTimeout"),d.onlineTimeout<0))throw new Error('"options.onlineTimeout" must be a positive number');d.reconnectOptions&&(b.isObject(d.reconnectOptions,"options.reconnectOptions"),b.isNumber(d.reconnectOptions.maxOfflineTime,"options.reconnectOptions.maxOfflineTime"),b.isNumber(d.reconnectOptions.maxReconnectFrequency,"options.reconnectOptions.maxReconnectFrequency")),this._pcastObservable=new c.Observable(null).extend({rateLimit:0}),this._subscribers={},this._publishers={},this._adminAPI=new e(d.backendUri,d.authenticationData),this._isInstantiated=!1,this._reauthCount=0,this._reconnectCount=0,this._authToken=d.authToken,this._onError=d.onError,this._options=d,this._onlineTimeout=a.isNumber(d.onlineTimeout)?d.onlineTimeout:D,this._reconnectOptions=d.reconnectOptions||E,this._logger=null,k.call(this)}function k(){var b=this;if(!this._pcastObservable.getValue()){var c=a.assign({logger:this._logger},this._options);this._pcastObservable.setValue(new g(c))}return this._logger||(this._logger=this._pcastObservable.getValue().getLogger()),this._pcastStatusSubscription||(this._pcastStatusSubscription=this._pcastObservable.getValue().getObservableStatus().subscribe(a.bind(l,this))),this._authToken?this._pcastObservable.getValue().start(this._authToken,a.noop,a.noop,a.noop):void this._adminAPI.createAuthenticationToken(function(c,d){return c&&"timeout"===c.message?l.call(b,c.message):c?o.call(b,c):"ok"!==d.status?l.call(b,d.status):b._pcastObservable.getValue()?void b._pcastObservable.getValue().start(d.authenticationToken,a.noop,a.noop,a.noop):b._logger.warn("Unable to authenticate. PCast not instantiated.")})}function l(a){var b=this;switch(a){case"timeout":case"critical-network-issue":return b._pcastObservable.getValue()&&(b._pcastObservable.getValue().stop("express-recovery"),b._pcastObservable.setValue(null)),b._pcastStatusSubscription&&(b._pcastStatusSubscription.dispose(),b._pcastStatusSubscription=null),b._reconnectCount++,m.call(b);case"reconnect-failed":case"unauthorized":return delete this._authToken,b._reauthCount++,b._reauthCount>1?o.call(this,new Error(a)):(b._logger.info("[Express] Attempting to create new authToken and re-connect after [%s] response",A),n.call(b));case"capacity":case"network-unavailable":return b._reconnectCount++,m.call(b);case"online":return b._reauthCount=0,b._reconnectCount=0,b._isInstantiated||b._logger.info("Express API successfully instantiated"),void(b._isInstantiated=!0);case"reconnecting":case"reconnected":case"connecting":break;case"offline":return;case"failed":default:return o.call(b,new Error(a))}}function m(){var a=this,b=Math.min(B*a._reconnectCount*a._reconnectCount,this._reconnectOptions.maxReconnectFrequency),c=Math.min(b/1e4,5),d=Math.random()*c*1e3,e=b+d;this._logger.info("Waiting for [%s] ms before continuing to attempt to reconnect to PCast",e),this._instantiatePCastTimeout=setTimeout(function(){return a._pcastObservable.getValue()&&a._pcastObservable.getValue().isStarted()?n.call(a):k.call(a)},e)}function n(){var a=this;this._adminAPI.createAuthenticationToken(function(b,c){return b&&"timeout"===b.message?l.call(a,b.message):b?o.call(a,b):"ok"!==c.status?l.call(a,c.status):a._pcastObservable.getValue()?void a._pcastObservable.getValue().reAuthenticate(c.authenticationToken):a._logger.warn("Unable to authenticate. PCast not instantiated.")})}function o(a){if(!this._onError)throw a;this._onError(a)}function p(c,d,e){var g=new f(c,{aspectRatio:d.aspectRatio,resolutionHeight:d.resolution,frameRate:d.frameRate,resolutionSelectionStrategy:d.resolutionSelectionStrategy,onScreenShare:function(c){return c=d.onScreenShare?d.onScreenShare(c):c,c.resolution&&b.isNumber(c.resolution,"clientOptions.resolution"),c.frameRate&&b.isNumber(c.frameRate,"screenOptions.frameRate"),c.aspectRatio&&b.isStringNotEmpty(c.aspectRatio,"screenOptions.aspectRatio"),a.assign({resolutionHeight:c.resolution},c)}});g.getUserMedia(d.mediaConstraints,function(b,c){return b?e(b):(d.onResolveMedia&&d.onResolveMedia(c.options),void e(null,a.assign({status:"ok"},c)))})}function q(a,c,d,e){var f=this;return b.isArray(c.capabilities,"options.capabilities"),c.streamToken?r.call(f,c.streamToken,a,c,d,e):void f.waitForOnline(function(b){if(b)return e(b);var g=f._pcastObservable.getValue().getProtocol().getSessionId();f._logger.info("Session Id [%s]",g),f._adminAPI.createStreamTokenForPublishing(g,c.capabilities,function(b,g){return b?e(b):"ok"!==g.status?e(null,g):void r.call(f,g.streamToken,a,c,d,e)})},c.isContinuation)}function r(c,d,e,f,g){var i=this,j=!1;e.tags&&b.isArray(e.tags,"options.tags"),e.connectOptions&&b.isArray(e.connectOptions,"options.connectOptions");var k=function(b,k,l){var m=function(b){var h=a.uniqueId(),j=a.assign({streamToken:c,isContinuation:!0},e);i._publishers[h]=!0,"camera-track-failure"===b?(l.stop(b,!1),i.publish(e,g)):(l.stop(b,!0),q.call(i,d,j,f,g)),delete i._publishers[h]};if(k===A&&e.streamToken||"timeout"===k){i._logger.info("[Express] Attempting to create new streamToken and re-publish after [%s] response",A);var n=a.assign({isContinuation:!0},e);return delete n.streamToken,q.call(i,d,n,f,g)}if("ok"!==k)return g(null,{status:k});i._publishers[l.getStreamId()]=l,e.videoElement&&!j&&(h.attachMediaStream(e.videoElement,d),j=!0);var o=!0,p=function(){},r=a.bind(z,i,p,m,o);if(e.monitor){var s=a.bind(y,i,e.monitor.callback,m);l.monitor(e.monitor.options||{},s),r=a.bind(z,i,e.monitor.callback,m,o)}l.setPublisherEndedCallback(r);var u=t.call(i,l,e.videoElement,f);g(null,{status:"ok",publisher:u})};i.waitForOnline(function(a){return a?g(a):void i._pcastObservable.getValue().publish(c,d,k,e.tags,{connectOptions:e.connectOptions})},e.isContinuation)}function s(b,c,e){var f=this,g=function(g,h,j){var k=function(d){var g=a.uniqueId(),h=a.assign({isContinuation:!0},c);f._subscribers[g]=!0,j.stop(d),f._logger.warn("[%s] Stream failure occurred with reason [%s]. Attempting to recover from failure.",c.streamId,d),s.call(f,b,h,e),delete f._subscribers[g]};if(h===A&&c.streamToken||"timeout"===h){f._logger.info("[%s] [Express] Attempting to create new streamToken and re-subscribe after [%s] response",c.streamId,A);var l=a.assign({isContinuation:!0},c);return delete l.streamToken,f.subscribe(l,e)}if("streaming-not-ready"===h)return e(null,{status:h,retry:a.bind(k,f,h)});if("ok"!==h)return e(null,{status:h});f._subscribers[j.getStreamId()]=j;var m;c.videoElement&&(m=j.createRenderer(),m.start(c.videoElement));var n=!1,o=a.noop,p=a.bind(z,f,o,k,n);if(c.monitor){var q=a.bind(y,f,c.monitor.callback,k);j.monitor(c.monitor.options||{},q),p=a.bind(z,f,c.monitor.callback,k,n)}j.setStreamEndedCallback(p);var r=u.call(f,j,m),t={status:"ok",mediaStream:r};j.setStreamErrorCallback(function(b,g,h){if("real-time"===g&&"connection-timeout"===h.message)return k.call(f,h.message);if("shaka"!==g||h.severity===i.errorSeverity.critical.id){if("phenix-player"===g&&h.severity===d.errors.severity.RECOVERABLE){var j=a.assign({isContinuation:!0},c);return delete j.streamToken,f.subscribe(j,e)}return f._logger.warn("[%s] Error while playing stream with Express API. Stopping stream.",r.getStreamId(),h),r.stop(),e(h)}}),m&&(t.renderer=m),e(null,t)};f.waitForOnline(function(a){return a?e(a):void f._pcastObservable.getValue().subscribe(b,g,c.subscriberOptions)},c.isContinuation)}function t(b,c,d){var e=a.bind(b.stop,b);return b.stop=function(a,f){if(e(a),c&&(c.src="",c.srcObject=null),d&&b.getStream()&&!f){var g=b.getStream();g&&g.getTracks().forEach(function(a){a.stop()})}},b.enableAudio=function(){return v(b.getStream(),!0)},b.disableAudio=function(){return v(b.getStream(),!1)},b.enableVideo=function(){return w(b.getStream(),!0)},b.disableVideo=function(){return w(b.getStream(),!1)},b.setPublisherEndedCallback=function(){},b}function u(b,c){var d=a.bind(b.stop,b);return b.stop=function(a){c&&c.stop(),d(a)},b.enableAudio=function(){return v(b.getStream(),!0)},b.disableAudio=function(){return v(b.getStream(),!1)},b.enableVideo=function(){return w(b.getStream(),!0)},b.disableVideo=function(){return w(b.getStream(),!1)},b.setStreamEndedCallback=function(){},b}function v(a,b){if(a)return x(a.getAudioTracks(),b),b}function w(a,b){if(a)return x(a.getVideoTracks(),b),b}function x(c,d){b.isArray(c,"tracks"),a.forEach(c,function(a){a.enabled=d})}function y(b,c,d,e,f){switch(e){case"camera-track-failure":case"client-side-failure":b(null,a.assign({status:e,retry:a.bind(c,null,e)},f))}}function z(a,b,c,d,e,f){var g={status:"stream-ended",reason:e,description:f};switch(e){case"ended":case"censored":var h={status:e,reason:e,description:f};return c?h.publisher=d:h.mediaStream=d,a(null,h);case"custom":return a(null,g);case"capacity":return setTimeout(function(){return b(e)},B);case"failed":case"maintenance":return b(e);case"app-background":default:return g.retry=b,a(null,g)}}var A="unauthorized",B=1e3,C=500,D=2e4,E={maxOfflineTime:18e4,maxReconnectFrequency:6e4};j.prototype.dispose=function(){this._listedForCriticalNetworkRecoveryDisposable&&(this._listedForCriticalNetworkRecoveryDisposable.dispose(),this._listedForCriticalNetworkRecoveryDisposable=null),this._pcastObservable.getValue()&&(this._pcastObservable.getValue().stop(),this._pcastObservable.setValue(null)),a.isNumber(this._instantiatePCastTimeout)&&(clearTimeout(this._instantiatePCastTimeout),this._instantiatePCastTimeout=null),this._adminAPI.dispose(),this._reconnectCount=0,this._reauthCount=0},j.prototype.getPCast=function(){return this._pcastObservable.getValue()},j.prototype.getPCastObservable=function(){return this._pcastObservable},j.prototype.getAdminAPI=function(){return this._adminAPI},j.prototype.getUserMedia=function(a,c){var d=this;if(b.isObject(a.mediaConstraints,"options.mediaConstraints"),b.isFunction(c,"callback"),a.resolution&&b.isNumber(a.resolution,"options.resolution"),a.frameRate&&b.isNumber(a.frameRate,"options.frameRate"),a.aspectRatio&&b.isStringNotEmpty(a.aspectRatio,"options.aspectRatio"),a.onResolveMedia&&b.isFunction(a.onResolveMedia,"options.onResolveMedia"),a.onScreenShare&&b.isFunction(a.onScreenShare,"options.onScreenShare"),d._pcastObservable.getValue())return p.call(d,d._pcastObservable.getValue(),a,c);var e=d._pcastObservable.subscribe(function(b){b&&(e.dispose(),p.call(d,b,a,c))})},j.prototype.publish=function(a,c){b.isObject(a,"options"),b.isFunction(c,"callback"),a.capabilities&&b.isArray(a.capabilities,"options.capabilities"),a.connectOptions&&b.isArray(a.connectOptions,"options.connectOptions"),a.mediaConstraints?b.isObject(a.mediaConstraints,"options.mediaConstraints"):b.isObject(a.userMediaStream,"options.userMediaStream"),a.videoElement&&b.isObject(a.videoElement,"options.videoElement"),a.monitor&&(b.isObject(a.monitor,"options.monitor"),b.isFunction(a.monitor.callback,"options.monitor.callback"),a.monitor.options&&b.isObject(a.monitor.options,"options.monitor.options")),a.streamToken&&b.isStringNotEmpty(a.streamToken,"options.streamToken");var d=this;this.waitForOnline(function(b){return b?c(b):a.userMediaStream?q.call(d,a.userMediaStream,a,!1,c):void d.getUserMedia(a,function(b,e){return b?c(b):"ok"!==e.status?c(null,e):void q.call(d,e.userMedia,a,!0,c)})},a.isContinuation)};var F=["streaming","low-latency","on-demand","uld","vvld","vld","ld","sd","hd","fhd","uhd"];return j.prototype.publishRemote=function(c,d){if(b.isObject(c,"options"),b.isFunction(d,"callback"),b.isStringNotEmpty(c.streamUri,"options.streamUri"),c.capabilities&&b.isArray(c.capabilities,"options.capabilities"),c.connectOptions&&b.isArray(c.connectOptions,"options.connectOptions"),c.mediaConstraints)throw new Error("Invalid argument, Media Constraints, for publishing remote.");if(c.videoElement)throw new Error("May not view remote stream publisher. Please subscribe to view.");c.prerollSkipDuration&&b.isNumber(c.prerollSkipDuration,"options.prerollSkipDuration"),c.monitor&&(b.isObject(c.monitor,"options.monitor"),b.isFunction(c.monitor.callback,"options.monitor.callback"),c.monitor.options&&b.isObject(c.monitor.options,"options.monitor.options")),c.frameRate&&(b.isObject(c.frameRate,"options.frameRate"),c.frameRate.exact&&b.isNumber(c.frameRate.exact,"options.frameRate.exact"),c.frameRate.max&&b.isNumber(c.frameRate.max,"options.frameRate.max")),c.streamToken&&b.isStringNotEmpty(c.streamToken,"options.streamToken");var e=this;this.waitForOnline(function(b){if(b)return d(b);var f=a.assign({connectOptions:[],capabilities:[]},c);a.includes(f.capabilities,"publish-uri")||f.capabilities.push("publish-uri"),a.forEach(F,function(b){a.includes(f.capabilities,b)&&f.connectOptions.push("publisher-capability="+b)}),c.frameRate&&c.frameRate.exact&&f.connectOptions.push("source-uri-video-fps="+c.frameRate.exact),c.frameRate&&c.frameRate.max&&f.connectOptions.push("source-uri-video-fps-max="+c.frameRate.max),f.connectOptions.push("source-uri-preroll-skip-duration="+(a.isNumber(c.prerollSkipDuration)?c.prerollSkipDuration:C).toString()),q.call(e,f.streamUri,f,!1,d)})},j.prototype.publishScreen=function(b,c){var d=a.assign({mediaConstraints:{screen:!0}},b);return a.set(d,["monitor","options"],a.assign({},{monitorFrameRate:!1,videoBitRateThreshold:100,conditionCountForNotificationThreshold:8},a.get(d,["monitor","options"],{}))),this.publish(d,c)},j.prototype.subscribe=function(a,c){b.isObject(a,"options"),b.isFunction(c,"callback"),b.isStringNotEmpty(a.streamId,"options.streamId"),b.isObject(a.capabilities,"options.capabilities"),a.videoElement&&b.isObject(a.videoElement,"options.videoElement"),a.monitor&&(b.isObject(a.monitor,"options.monitor"),b.isFunction(a.monitor.callback,"options.monitor.callback"),a.monitor.options&&b.isObject(a.monitor.options,"options.monitor.options")),a.streamToken&&b.isStringNotEmpty(a.streamToken,"options.streamToken"),a.subscriberOptions&&b.isObject(a.subscriberOptions,"options.subscriberOptions");var d=this;this.waitForOnline(function(b){return b?c(b):a.streamToken?s.call(d,a.streamToken,a,c):void d._adminAPI.createStreamTokenForSubscribing(d._pcastObservable.getValue().getProtocol().getSessionId(),a.capabilities,a.streamId,null,function(b,e){return b?c(b):"ok"!==e.status?c(null,e):void s.call(d,e.streamToken,a,c)})},a.isContinuation)},j.prototype.subscribeToScreen=function(b,c){var d=a.assign({},b);return a.set(d,["monitor","options"],a.assign({},{monitorFrameRate:!1,videoBitRateThreshold:100,conditionCountForNotificationThreshold:8},a.get(d,["monitor","options"],{}))),this.subscribe(d,c)},j.prototype.waitForOnline=function(c,d){if(b.isFunction(c,"callback"),this._pcastObservable.getValue()&&"online"===this._pcastObservable.getValue().getStatus())return c();var e=this,f=d?a.get(e._reconnectOptions,["maxOfflineTime"]):this._onlineTimeout,g=null,h=null,i=setTimeout(function(){e._logger.info("Disposing of Express Online listener after [%s] ms",f),g&&g.dispose(),h&&h.dispose(),c(new Error("timeout"))},f);this._logger.info("Waiting for Online status before continuing. Timeout set to [%s]",f);var j=function(a){h&&h.dispose(),a&&(h=a.getObservableStatus().subscribe(function(a){if("online"===a)return clearTimeout(i),h.dispose(),g.dispose(),c()},{initial:"notify"}))};this._pcastObservable.getValue()&&j(this._pcastObservable.getValue()),g=this._pcastObservable.subscribe(j)},j}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(4),c(3),c(32),c(21),c(23),c(36),c(18),c(11),c(10),c(19),c(41)],e=function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";function n(c){b.isObject(c,"options"),c.pcastExpress?b.isObject(c.pcastExpress,"options.pcastExpress"):(b.isStringNotEmpty(c.backendUri,"options.backendUri"),b.isObject(c.authenticationData,"options.authenticationData")),this._pcastExpress=c.pcastExpress||new f(c),this._shouldDisposeOfPCastExpress=!c.pcastExpress,this._roomServices={},this._roomServicePublishers={},this._activeRoomServices=[],this._membersSubscriptions={},this._logger=this._pcastExpress.getPCast().getLogger();var d=this;this._pcastExpress.getPCastObservable().subscribe(function(b){if(!b){var c=a.assign({},d._roomServices);a.forOwn(d._membersSubscriptions,function(a){a.dispose()}),d._pcastExpress.waitForOnline(function(){a.forOwn(c,function(a){a.stop()})},!0),d._membersSubscriptions={},d._roomServices={},d._activeRoomServices=[]}})}function o(){a.forOwn(this._membersSubscriptions,function(a){a.dispose()}),a.forOwn(this._roomServicePublishers,function(b){a.forEach(b,function(a){a.stop()})}),a.forOwn(this._roomServices,function(a){a.stop()}),this._membersSubscriptions={},this._roomServicePublishers={},this._roomServices={},this._activeRoomServices=[]}function p(b,c,d){var e=this,f=a.uniqueId();this._pcastExpress.waitForOnline(function(a){if(a)return d(a);var h=q.call(e,b,c);if(h)return d(null,{status:"ok",roomService:h});e._roomServices[f]=new g(e._pcastExpress.getPCast());var i=r.call(e,e._roomServices[f],f);d(null,{status:"ok",roomService:i})})}function q(b,c){return a.find(this._activeRoomServices,function(a){var d=a.getObservableActiveRoom().getValue();return d&&(d.getRoomId()===b||d.getObservableAlias().getValue()===c)})}function r(a,b){var c=this,d=a.stop,e=a.leaveRoom;return a.stop=function(){d.call(a),delete c._roomServices[b]},a.leaveRoom=function(b){var d=a.getObservableActiveRoom().getValue();e.call(a,function(e,f){return e?(a.stop(),b(e)):"ok"!==f.status&&"not-in-room"!==f.status?b(null,f):(d&&c._membersSubscriptions[d.getRoomId()]&&(c._membersSubscriptions[d.getRoomId()].dispose(),delete c._membersSubscriptions[d.getRoomId()]),c._logger.info("Successfully disposed of Express Room Service [%s]",d?d.getRoomId():"Uninitialized"),a.stop(),b(null,f))})},a}function s(b,c,d){var e=this,f=b.role,g=b.screenName||a.uniqueId();p.call(e,b.roomId,b.alias,function(a,h){if(a)return c(a);if("ok"!==h.status)return c(null,h);var i=h.roomService,j=i.getObservableActiveRoom(),k=j.getValue(),l=null;return k||i.start(f,g),b.streams&&B.call(e,b.streams,b.role,i,function(a){if(a)return c(a)}),k&&d?(c(null,{status:"ok",roomService:i}),j.subscribe(function(a){l&&(l.dispose(),l=null),a&&(l=a.getObservableMembers().subscribe(d,{initial:"notify"}))},{initial:"notify"})):void i.enterRoom(b.roomId,b.alias,function(a,b){if(a)return i.stop(),c(a);if("not-found"===b.status)return i.stop(),c(null,{status:"room-not-found"});if("ok"!==b.status&&"already-in-room"!==b.status)return i.stop(),c(null,b);var f=b.room;return e._activeRoomServices.push(i),c(null,{status:"ok",roomService:i}),d?(l=f.getObservableMembers().subscribe(d,{initial:"notify"}),j.subscribe(function(a){l&&(l.dispose(),l=null),a&&(l=a.getObservableMembers().subscribe(d,{initial:"notify"}))})):void 0})})}function t(b,c,d){var e=this,f=0,g=function(b,c){if(b)return d(b);if("ok"!==c.status&&"streaming-not-ready"!==c.status)return d(null,c);if(f++,"streaming-not-ready"===c.status&&f<3)return setTimeout(c.retry,f*f*1e3);if("streaming-not-ready"===c.status&&f>=3)return d(null,{status:c.status});var e=a.assign({},c,{status:"ok"});return f>1?(e.reason="stream-failure-recovered",d(null,e)):void d(null,e)};return c?e._pcastExpress.subscribeToScreen(b,g):e._pcastExpress.subscribe(b,g)}function u(b,c,d){var e,f,g=this,h=function(h,i){if(f&&e&&clearInterval(f),h)return d(h);if("ok"!==i.status)return d(null,i);v.call(g,i.publisher,c),w.call(g,e,c),e=i.publisher;var j=a.bind(e.stop,e);e.stop=function(){clearInterval(f),j.apply(e,arguments)},b.enableWildcardCapability&&(f=setInterval(function(){g._logger.debug("Refresh wildcard viewer stream token for [%s] interval of [%s] has expired. Creating new token.",e.getStreamId(),L);var a=q.call(g,c.getRoomId()),f=a?a.getObservableActiveRoom().getValue():c;x.call(g,b,e,f,function(a,b){(a||"ok"!==b.status)&&d(a,b)})},L)),x.call(g,b,i.publisher,c,d)};return a.get(b,["mediaConstraints","screen"],!1)?(a.set(b,["streamInfo","isScreen"],!0),this._pcastExpress.publishScreen(b,h)):void this._pcastExpress.publish(b,h)}function v(a,b){this._roomServicePublishers[b.getRoomId()]||(this._roomServicePublishers[b.getRoomId()]=[]),this._roomServicePublishers[b.getRoomId()].push(a)}function w(b,c){this._roomServicePublishers[c.getRoomId()]&&b&&(this._roomServicePublishers[c.getRoomId()]=a.filter(this._roomServicePublishers[c.getRoomId()],function(a){return a.getStreamId()!==b.getStreamId()}))}function x(b,c,d,e){var f,g=this,i=b.streamType,k=b.streamInfo,l="high-availability"===b.viewerStreamSelectionStrategy&&d.getObservableType().getValue()===j.types.channel.name,m=null,n=e;if(!b.enableWildcardCapability){var o=H(c,i,k),p=a.assign({},b,{streams:A.call(g,o,d)});return z.call(g,p,n,c,d)}if(l){var r=h.getSimilarMembers(b.screenName,d.getObservableMembers().getValue());m=y(r),n=function(i,j){e(i,j);var k=a.get(j,"roomService",q.call(g,d.getRoomId()));if(!i&&"ok"===j.status&&!f&&k){var l=k.getObservableActiveRoom().getValue();f=l.getObservableMembers().subscribe(function(d){var i=h.getSimilarMembers(b.screenName,d),j=y(i),k=j.length===m.length&&a.reduce(j,function(b,c){return b?a.includes(m,c):b},!0);k||(g._logger.debug("Members with similar content to stream [%s] have changed. Generating new wildcard viewer token",c.getStreamId()),f.dispose(),f=null,x.call(g,b,c,l,function(a,b){(a||"ok"!==b.status)&&e(a,b)}))})}}}m&&m.length>0?g._logger.debug("Creating [real-time] viewer wildcard stream token for published stream [%s] with [%s] additional streams",c.getStreamId(),m.length):g._logger.debug("Creating [real-time] viewer wildcard stream token for published stream [%s]",c.getStreamId()),g._pcastExpress.getAdminAPI().createStreamTokenForSubscribing("*",[],c.getStreamId(),m,function(f,h){return f?e(f):"ok"!==h.status?e(null,h):(m&&m.length>0?g._logger.debug("Creating [broadcast] viewer wildcard stream token for published stream [%s] with [%s] additional streams",c.getStreamId(),m.length):g._logger.debug("Creating [broadcast] viewer wildcard stream token for published stream [%s]",c.getStreamId()),void g._pcastExpress.getAdminAPI().createStreamTokenForSubscribing("*",["broadcast"],c.getStreamId(),m,function(f,j){if(f)return e(f);if("ok"!==j.status)return e(null,j);if(a.includes(b.capabilities,"streaming"))return m&&m.length>0?g._logger.debug("Creating [streaming] viewer wildcard stream token for published stream [%s] with [%s] additional streams",c.getStreamId(),m.length):g._logger.debug("Creating [streaming] viewer wildcard stream token for published stream [%s]",c.getStreamId()),g._pcastExpress.getAdminAPI().createStreamTokenForSubscribing("*",["streaming"],c.getStreamId(),m,function(f,l){if(f)return e(f);if("ok"!==l.status)return e(null,l);if(a.includes(b.capabilities,"drm"))return m&&m.length>0?g._logger.debug("Creating [drm-open-access] and [drm-hollywood] viewer wildcard stream token for published stream [%s] with [%s] additional streams",c.getStreamId(),m.length):g._logger.debug("Creating [drm-open-access] and [drm-hollywood] viewer wildcard stream token for published stream [%s]",c.getStreamId()),g._pcastExpress.getAdminAPI().createStreamTokenForSubscribing("*",["streaming","drm-open-access"],c.getStreamId(),m,function(f,o){return f?e(f):"ok"!==o.status?e(null,o):g._pcastExpress.getAdminAPI().createStreamTokenForSubscribing("*",["streaming","drm-hollywood"],c.getStreamId(),m,function(f,m){if(f)return e(f);if("ok"!==m.status)return e(null,m);var p=[o.streamToken,m.streamToken],q=H(c,i,k,h.streamToken,j.streamToken,l.streamToken,p),r=a.assign({},b,{streams:A.call(g,q,d)});z.call(g,r,n,c,d)})});var o=H(c,i,k,h.streamToken,j.streamToken,l.streamToken),p=a.assign({},b,{streams:A.call(g,o,d)});z.call(g,p,n,c,d)});var l=H(c,i,k,h.streamToken,j.streamToken),o=a.assign({},b,{streams:A.call(g,l,d)});z.call(g,o,n,c,d)}))})}function y(b){return a.reduce(b,function(b,c){var d=a.get(c.getObservableStreams().getValue(),"0"),e=d?d.getPCastStreamId():"";return e&&b.push(e),b},[])}function z(b,c,d,e){var f=this,g=q.call(f,e.getRoomId()),h={publisher:d,roomService:g},i=function(i,j){if(i)return c(i);if("ok"===j.status){g=q.call(f,e.getRoomId());var k=g.getSelf().getObservableStreams().getValue(),l=a.find(k,function(a){return a.getPCastStreamId()===d.getStreamId()});I.call(f,d.getStream(),l)}if("ok"===j.status&&!d._cleanUpRoomWrapper){var m=a.bind(d.stop,d);d._cleanUpRoomWrapper=!0,d.stop=function(){w.call(f,d,e);var a=A.call(f,null,e),g=q.call(f,e.getRoomId());m.apply(d,arguments),g&&C.call(f,a,b.memberRole,g,b,function(a){if(a)return c(a)})}}return c(null,a.assign({},h,j))};C.call(f,b.streams,b.memberRole,g,b,i)}function A(b,c){var d=q.call(this,c.getRoomId()),e=b?[b]:[];if(!d)return e;var f=d.getSelf();if(!f)return e;var g=a.map(f.getObservableStreams().getValue(),function(a){return a.toJson()}),h=this._roomServicePublishers[c.getRoomId()]||[],j=a.map(h,function(a){return a.getStreamId()});return g&&0!==g.length?(b&&(g=a.filter(g,function(a){var c=a.uri===b.uri,d=i.parsePCastStreamIdFromStreamUri(a.uri),e=!!d,f=e&&d===i.parsePCastStreamIdFromStreamUri(b.uri),g=a.type===b.type;return!c&&!f||!g}),g.push(b)),a.filter(g,function(b){return a.includes(j,i.parsePCastStreamIdFromStreamUri(b.uri)||b.uri)})):e}function B(a,b,c,d){var e=c?c.getObservableActiveRoom().getValue():null;if(a&&c&&c.getSelf().setStreams(a),b&&c&&c.getSelf().getObservableRole().setValue(b),e&&c.getSelf())return D.call(this,c.getSelf(),d)}function C(b,c,d,e,f){var g=q.call(this,e.room.roomId,e.room.alias),h=d?d.getObservableActiveRoom().getValue():null,i=!h&&!g,j=this;if(b&&g&&g.getSelf().setStreams(b),c&&g&&g.getSelf().getObservableRole().setValue(c),h&&g.getSelf())return D.call(this,g.getSelf(),f);if(i){var k=a.assign({role:c,alias:a.get(e,["room","alias"]),roomId:a.get(e,["room","roomId"])},e);s.call(j,k,function(a,b){return a?f(a):"ok"!==b.status&&"already-in-room"!==b.status?f(null,b):void f(a,b)})}}function D(a,b){var c=0,d=this,e=5;try{a.commitChanges(function g(f,h){return f&&c++,h&&"ok"!==h.status&&c++,h&&"ok"===h.status?(c=0,!b||b(null,h)):c>=e?(d._logger.warn("Unable to update self after [%s] attempts.",e),b(new Error("Unable to update self"))):c>0&&c<e?(d._logger.warn("Unable to update self after [%s] attempts. Retrying.",c),a.commitChanges(g)):void 0})}catch(f){b(f)}}function E(a,b,c){return b?a(b):c.retry?c.retry():void a(b,c)}function F(a){
switch(a){case j.types.channel.name:return"Room Channel";case j.types.moderatedChat.name:return"Moderated Chat";case j.types.multiPartyChat.name:return"Multi Party Chat";case j.types.townHall.name:return"Town Hall";case j.types.directChat.name:return"Direct Chat";default:throw new Error("Unsupported Room Type")}}function G(b,c){var d=i.getInfoFromStreamUri(b),e=(d.streamTokenForLiveStream||d.streamTokenStreaming)&&a.includes(c,"streaming");if(!a.includes(c,"drm-open-access")||!a.includes(c,"drm-hollywood"))return e&&d.streamTokenForLiveStreamWithDrmOpenAccess&&(a.includes(c,"drm-open-access")||K())?d.streamTokenForLiveStreamWithDrmOpenAccess:e&&d.streamTokenForLiveStreamWithDrmHollywood&&a.includes(c,"drm-hollywood")?d.streamTokenForLiveStreamWithDrmHollywood:!e||a.includes(c,"drm-open-access")||a.includes(c,"drm-hollywood")?d.streamTokenForBroadcastStream&&a.includes(c,"broadcast")?d.streamTokenForBroadcastStream:a.includes(c,"streaming")||a.includes(c,"broadcast")?void 0:d.streamToken:d.streamTokenForLiveStream||d.streamTokenStreaming}function H(c,d,e,f,g,h,j){var k=c.getStream(),l=k?k.getAudioTracks():null,n=k?k.getVideoTracks():null,o=l.length>0&&l[0].enabled,p=n.length>0&&n[0].enabled,q={uri:i.getPCastPrefix()+c.getStreamId(),type:d,audioState:o?m.states.trackEnabled.name:m.states.trackDisabled.name,videoState:p?m.states.trackEnabled.name:m.states.trackDisabled.name},r=a.assign({},e,{streamToken:f,streamTokenForBroadcastStream:g,streamTokenForLiveStream:h});f||delete r.streamToken,g||delete r.streamTokenForBroadcastStream,h||delete r.streamTokenForLiveStream,j&&(b.isArray(j,"drmStreamTokens"),r.streamTokenForLiveStreamWithDrmOpenAccess=j[0],r.streamTokenForLiveStreamWithDrmHollywood=j[1]);var s=a.reduce(r,function(a,b,c){var d=a?"&":"?";return a+d+c+"="+b},"");return s.length>0&&(q.uri=q.uri+s),q}function I(b,c){var d=b.getTracks(),e=this;a.forEach(d,function(d){a.addEventListener(d,"StateChange",function(){var a=d.enabled?m.states.trackEnabled.name:m.states.trackDisabled.name,f=J.call(e,c);e._logger.info("[%s] [%s] Track state changed to [%s], updating room member stream state [%s]",b.id,d.id,d.enabled,a),"video"===d.kind?c.getObservableVideoState().setValue(a):c.getObservableAudioState().setValue(a),f&&D.call(e,f)})})}function J(b){var c=a.find(this._activeRoomServices,function(c){var d=c.getSelf(),e=d?d.getObservableStreams().getValue():[];return a.find(e,function(a){return b===a})});return c?c.getSelf():null}function K(){return/(android)/i.test(navigator.userAgent)}var L=3e5,M=!0;return n.prototype.dispose=function(){o.call(this),this._shouldDisposeOfPCastExpress&&this._pcastExpress.dispose()},n.prototype.getPCastExpress=function(){return this._pcastExpress},n.prototype.createRoom=function(c,d){b.isFunction(d,"callback"),b.isObject(c.room,"options.room"),b.isStringNotEmpty(c.room.name,"options.room.name"),b.isStringNotEmpty(c.room.type,"options.room.type"),c.room.description&&b.isStringNotEmpty(c.room.description,"options.room.description");var e=c.room.description||F(c.room.type);p.call(this,null,null,function(b,f){if(b)return d(b);if("ok"!==f.status)return d(null,f);var g=f.roomService,h=a.assign({},c.room);h.description||(h.description=e),g.createRoom(h,function(a,b){return a?d(a):(g.stop(),d(null,b))})})},n.prototype.joinRoom=function(a,c,d){b.isObject(a,"options"),b.isFunction(c,"joinRoomCallback"),b.isStringNotEmpty(a.role,"options.role"),d&&b.isFunction(d,"membersChangedCallback"),a.screenName&&b.isStringNotEmpty(a.screenName,"options.screenName"),a.roomId&&b.isStringNotEmpty(a.roomId,"options.roomId"),a.alias&&b.isStringNotEmpty(a.alias,"options.alias"),a.streams&&b.isArray(a.streams,"options.streams");var e=this,f=function(b){b&&s.call(e,a,function(a,d){var e=d;if(e&&e.roomService){var f=e.roomService.leaveRoom;e.roomService.leaveRoom=function(a){g&&"offline"!==b.getObservableStatus()&&g.dispose(),f(a)}}c(a,d)},d)};if(this._pcastExpress.getPCastObservable())return f(this._pcastExpress.getPCastObservable());var g=this._pcastExpress.getPCastObservable().subscribe(f)},n.prototype.publishToRoom=function(c,d){b.isObject(c,"options"),b.isFunction(d,"callback"),b.isObject(c.room,"options.room"),c.streamUri?b.isStringNotEmpty(c.streamUri,"options.streamUri"):c.mediaConstraints?b.isObject(c.mediaConstraints,"options.mediaConstraints"):b.isObject(c.userMediaStream,"options.userMediaStream"),c.videoElement&&b.isObject(c.videoElement,"options.videoElement"),c.screenName&&b.isStringNotEmpty(c.screenName,"options.screenName"),c.capabilities&&b.isArray(c.capabilities,"options.capabilities"),c.tags&&b.isArray(c.tags,"options.tags"),c.streamInfo&&b.isObject(c.streamInfo,"options.streamInfo"),c.viewerStreamSelectionStrategy&&b.isStringNotEmpty(c.viewerStreamSelectionStrategy,"options.viewerStreamSelectionStrategy"),a.isUndefined(c.enableWildcardCapability)&&(c.enableWildcardCapability=M),b.isValidType(c.streamType,l.types,"options.streamType"),b.isValidType(c.memberRole,k.roles,"options.memberRole"),b.isBoolean(c.enableWildcardCapability,"options.enableWildcardCapability");var e=this,f=c.screenName||a.uniqueId();this.createRoom(c,function(b,g){if(b)return d(b);if("ok"!==g.status&&"already-exists"!==g.status)return d(null,g);var h=g.room,i=a.assign({monitor:{callback:a.bind(E,e,d),options:{conditionCountForNotificationThreshold:8}},streamInfo:{}},c);if(h.getObservableType().getValue()===j.types.channel.name?i.tags=["channelId:"+h.getRoomId()].concat(i.tags||[]):i.tags=["roomId:"+h.getRoomId()].concat(i.tags||[]),c.streamUri){var l=a.assign({connectOptions:[]},i),m=a.find(l.connectOptions,function(b){return a.startsWith(b,"room-id")});return m||(l.connectOptions=l.connectOptions.concat(["room-id="+h.getRoomId(),"member-role="+c.memberRole,"member-stream-type="+c.streamType,"screen-name="+f])),c.enableWildcardCapability&&l.connectOptions.concat(["member-stream-token-type=Wildcard","member-stream-token-refresh-interval="+L]),e._pcastExpress.publishRemote(l,d)}var n=a.assign({},c,{role:k.roles.audience.name,roomId:h.getRoomId()});s.call(e,n,function(a,b){if(a)return d(a);if("ok"!==b.status&&"already-in-room"!==b.status)return d(null,g);var c=b.roomService.getObservableActiveRoom().getValue();u.call(e,i,c,d)})})},n.prototype.publishScreenToRoom=function(b,c){var d=a.assign({},b,{mediaConstraints:{screen:!0}});this.publishToRoom(d,c)},n.prototype.subscribeToMemberStream=function(c,e,f){b.isObject(c,"memberStream"),b.isObject(e,"options"),b.isFunction(f,"callback");var g=c.getUri(),h=c.getPCastStreamId(),i=G(g,e.capabilities),j=a.get(c.getInfo(),["isScreen"],!1);if(!h)throw this._logger.error("Invalid Member Stream. Unable to parse streamId from uri"),new Error("Invalid Member Stream. Unable to parse streamId from uri");var k=a.assign({},{streamId:h,streamToken:i},e),l=new d.DisposableList;t.call(this,k,j,function(a,b){return l.dispose(),b&&"ok"===b.status&&b.mediaStream&&b.mediaStream.getStream()&&(l.add(c.getObservableAudioState().subscribe(function(a){var c=b.mediaStream.getMonitor(),d=b.mediaStream.getStream().getAudioTracks();c&&1===d.length&&c.setMonitorTrackState(d[0],a===m.states.trackEnabled.name)},{initial:"notify"})),l.add(c.getObservableVideoState().subscribe(function(a){var c=b.mediaStream.getMonitor(),d=b.mediaStream.getStream().getVideoTracks();c&&1===d.length&&c.setMonitorTrackState(d[0],a===m.states.trackEnabled.name)},{initial:"notify"}))),a&&6===parseInt(a.category)?f(a,{status:"device-insecure"}):void f(a,b)})},n}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(4),c(3),c(34),c(40),c(86),c(39),c(80),c(11),c(10)],e=function(a,b,c,d,e,f,g,h,i,j,k){"use strict";function l(a){b.isObject(a,"pcast"),b.isFunction(a.getLogger,"pcast.getLogger"),b.isFunction(a.getProtocol,"pcast.getProtocol"),this._pcast=a,this._logger=a.getLogger(),this._protocol=a.getProtocol(),this._self=new c.Observable(null),this._activeRoom=new c.Observable(null),this._cachedRoom=new c.Observable(null),this._roomChatService=null,b.isObject(this._logger,"this._logger"),b.isObject(this._protocol,"this._protocol"),this._authService=new e(this._pcast)}function m(){this._self.setValue(null),this._activeRoom.setValue(null),this._cachedRoom.setValue(null),this._roomChatService=null,this._disposables&&this._disposables.dispose(),this._disposables=null}function n(a){var b=this._self.getValue().toJson(),c=this;this._logger.info("Resetting self after sessionId changed to [%s]",a),this._self.setValue(new h(c,b.state,a||"",b.screenName,b.role,b.streams,b.lastUpdate))}function o(){var b=this,c=b._activeRoom.getValue(),d=b._self.getValue().getSessionId();if(a.isObject(c)&&d){var e=c.getRoomId(),f=c.getObservableAlias().getValue();b._logger.info("Leaving and re-entering room after reset of self model"),G.call(b,function(){F.call(b,e,f,function(){b._logger.info("Room Reset Completed")})})}}function p(c){b.isObject(c,"event"),b.isString(c.roomId,"event.roomId"),b.isString(c.eventType,"event.eventType"),b.isArray(c.members,"event.members"),a.forEach(c.members,function(a){b.isObject(a,"member")});var d=this;switch(c.eventType){case j.events.memberJoined.name:return d._logger.debug("[%s] Member joined [%s]",c.roomId,c.members),q.call(d,c.roomId,c.members);case j.events.memberLeft.name:return d._logger.debug("[%s] Member left [%s]",c.roomId,c.members),r.call(d,c.roomId,c.members);case j.events.memberUpdated.name:return d._logger.debug("[%s] Member updated [%s]",c.roomId,c.members),s.call(d,c.roomId,c.members);case j.events.roomUpdated.name:return d._logger.debug("[%s] Room updated [%s]",c.roomId,c.room),t.call(d,c.roomId,c.room);case j.events.roomEnded.name:d._logger.info("[%s] Room ended",c.roomId);break;default:d._logger.warn("Unsupported room event [%s]",c.eventType)}}function q(b,c){var d=this._activeRoom.getValue(),e=this._cachedRoom.getValue();if(d&&d.getRoomId()===b){d._removeMembers(c),d._addMembers(c),e._removeMembers(c),e._addMembers(c);var f=this,g=function(a){return a.sessionId===f.getSelf().getSessionId()},h=a.find(c,g);h&&(M.call(f,d),d._updateMembers([h])),this._logger.info("[%s] Room has now [%d] members",b,d.getObservableMembers().getValue().length)}}function r(a,b){var c=this._activeRoom.getValue(),d=this._cachedRoom.getValue();c&&c.getRoomId()===a&&(c._removeMembers(b),d._removeMembers(b),this._logger.info("[%s] Room has now [%d] members",a,c.getObservableMembers().getValue().length))}function s(a,b){var c=this._activeRoom.getValue(),d=this._cachedRoom.getValue();if(c&&c.getRoomId()===a){var e=z.call(this,b);c._updateMembers(e),d._updateMembers(e),this._logger.info("[%s] Room has [%d] updated members",a,b.length)}}function t(a,b){var c=this._activeRoom.getValue(),d=this._cachedRoom.getValue();c&&c.getRoomId()===a&&(d._update(b),c._update(b))}function u(a){this.getSelf()&&this.getSelf().getSessionId()===(a||"")||n.call(this,a)}function v(a,b){var c=b.getValue(),d=c.getObservableMembers().getValue();return w(a,d)}function w(b,c){return a.find(c,function(a){return b===a.getSessionId()})}function x(b){this._logger.info("PCast status changed to [%s]",b),"offline"!==b.toLowerCase()&&"offline"===this._lastPcastStatus||"offline"===b.toLowerCase()&&"offline"!==this._lastPcastStatus&&!a.isNullOrUndefined(this._lastPcastStatus),this._lastPcastStatus=b}function y(){var b=this._self.subscribe(a.bind(o,this)),c=this._authService.getObservableStatus().subscribe(a.bind(x,this)),d=this._authService.getObservableSessionId().subscribe(a.bind(u,this));this._disposables.add(b),this._disposables.add(c),this._disposables.add(d)}function z(b){var c=this;return a.map(b,function(a){var b=v(a.sessionId,c._cachedRoom),d=new h(null,a.state,a.sessionId,a.screenName,a.role,a.streams,a.lastUpdate),e=A(d,b);return e.lastUpdate=a.lastUpdate,e})}function A(b,c){var d=B(b,c);return d.sessionId=b.getSessionId(),d.lastUpdate=c?c.getLastUpdate():a.now(),d}function B(b,c){if(!c)return b.toJson();var d={},e=b.toJson(),f=c.toJson(),g=a.findDifferences(e,f,!0);return a.forEach(g,function(a){d[a]=e[a]}),d}function C(b,c,d){this._authService.assertAuthorized();var e=this;this._protocol.getRoomInfo(b,c,function(b,c){if(b)return e._logger.error("Request to get room info failed with error [%s]",b),d(b,null);var f={status:c.status};return"ok"!==c.status?(e._logger.warn("Request to get room info failed with status [%s]",c.status),d(null,f)):(f.room=a.freeze(J.call(this,c)),void d(null,f))})}function D(b,c){this._authService.assertAuthorized();var d=this,e=E(b);this._protocol.createRoom(e,function(b,e){if(b)return d._logger.error("Creating room failed with error [%s]",b),c(b,null);var f={status:e.status};return"ok"!==e.status&&"already-exists"!==e.status?(d._logger.warn("Creating room failed with status [%s]",e.status),c(null,f)):(f.room=a.freeze(J.call(this,e)),void c(null,f))})}function E(a){var b=this;return new f(b,"",a.alias,a.name,a.description,a.type,[],a.bridgeId,a.pin).toJson()}function F(b,c,d){var e=this._activeRoom.getValue();if(e){var f=b===e.getRoomId()||c===e.getObservableAlias().getValue();return this._logger.info("Unable to join room. Already in [%s]/[%s] room.",e.getRoomId(),e.getObservableAlias().getValue()),d(null,a.assign({room:e},f?O:P))}this._authService.assertAuthorized();var g=this._self.getValue(),h=g.getObservableScreenName().getValue(),i=g.getObservableRole().getValue(),j=A.call(this,g,null),k=a.now();this._logger.info("Enter room [%s]/[%s] with screen name [%s] and role [%s]",b,c,h,i);var l=this;this._protocol.enterRoom(b,c,j,k,function(a,b){if(a)return l._logger.error("Joining of room failed with error [%s]",a),d(a,null);var c={status:b.status};return"ok"!==b.status?(l._logger.warn("Joining of room failed with status [%s]",b.status),d(null,c)):(c.room=L.call(l,b),"ok"===b.status&&b.self&&l.getSelf()._update(b.self),void d(null,c))})}function G(b){if(!this._activeRoom.getValue())return this._logger.info("Unable to leave room. Not currently in a room."),b(null,N);if(!this._isLeavingRoom){this._authService.assertAuthorized();var c=this._activeRoom.getValue().getRoomId(),d=a.now();this._logger.info("Leave room [%s]",c);var e=this;this._isLeavingRoom=!0,this._protocol.leaveRoom(c,d,function(a,c){if(e._isLeavingRoom=!1,a)return e._logger.error("Leaving room failed with error [%s]",a),b(a,null);var d={status:c.status};return"ok"!==c.status?(e._logger.warn("Leaving room failed with status [%s]",c.status),b(null,d)):(e._roomChatService&&e._roomChatService.stop(),e._roomChatService=null,e._activeRoom.setValue(null),e._cachedRoom.setValue(null),void b(null,d))})}}function H(b,c){if(!this._activeRoom.getValue())return this._logger.warn("Not in a room. Please Enter a room before updating member."),c(null,N);this._authService.assertAuthorized();var d=b.getSessionId()===this.getSelf().getSessionId(),e=v(b.getSessionId(),this._cachedRoom),f=A.call(this,b,e),g=a.now(),h=d&&!e,i=d&&f.role===k.roles.audience.name;h&&(f.lastUpdate=b.getObservableLastUpdate().getValue()),this._logger.info("Updating member info for active room");var j=this;this._protocol.updateMember(f,g,function(a,b){if(a)return j._logger.error("Update of member failed with error [%s]",a),c(a,null);var d={status:b.status};"ok"!==b.status&&j._logger.warn("Update of member failed with status [%s]",b.status),"ok"===b.status&&i&&j.getSelf().getObservableLastUpdate().setValue(b.lastUpdate),c(null,d)})}function I(b){if(!this._activeRoom.getValue())return this._logger.warn("Not in a room. Please Enter a room before updating member."),b(null,N);this._authService.assertAuthorized();var c=this._activeRoom.getValue(),d=a.now(),e=this;this._protocol.updateRoom(c.toJson(),d,function(a,c){if(a)return e._logger.error("Update of room failed with error [%s]",a),b(a,null);var d={status:c.status};"ok"!==c.status&&e._logger.warn("Update of room failed with status [%s]",c.status),b(null,d)})}function J(a){var b=a.room,c=a.members||[],d=this;return new g(d,b.roomId,b.alias,b.name,b.description,b.type,c,b.bridgeId,b.pin)}function K(a){var b=a.room,c=a.members,d=this;return new f(d,b.roomId,b.alias,b.name,b.description,b.type,c,b.bridgeId,b.pin)}function L(a){var b=K.call(this,a),c=K.call(this,a);return M.call(this,b),this._activeRoom.setValue(b),this._cachedRoom.setValue(c),b}function M(b){var c=this._self.getValue(),d=b.getObservableMembers().getValue(),e=a.findIndex(d,function(a){return c.getSessionId()===a.getSessionId()});return a.isNumber(e)?(c._update(d[e].toJson()),d[e]=c,void b.getObservableMembers().setValue(d)):this._logger.info("Self not in server room model.")}var N=a.freeze({status:"not-in-room"}),O=a.freeze({status:"already-in-room"}),P=a.freeze({status:"in-another-room"});return l.prototype.start=function(e,f){if(this._started)return this._logger.warn("RoomService already started.");b.isStringNotEmpty(e,"role"),b.isStringNotEmpty(f,"screenName");var g=k.states.passive.name,i=this._authService.getPCastSessionId(),j=f,l=[],m=a.now(),n=this,o=new h(n,g,i,j,e,l,m);this._self=new c.Observable(o),this._disposables=new d.DisposableList;var q=this._protocol.onEvent("chat.RoomEvent",a.bind(p,this));return this._disposables.add(q),y.call(this),this._started=!0,o},l.prototype.getRoomInfo=function(a,c,d){a?b.isStringNotEmpty(a,"roomId"):b.isStringNotEmpty(c,"alias"),b.isFunction(d,"callback"),C.call(this,a,c,d)},l.prototype.createRoom=function(a,c){b.isObject(a,"room"),b.isStringNotEmpty(a.name,"room.name"),b.isStringNotEmpty(a.type,"room.type"),b.isString(a.description,"room.description"),b.isFunction(c,"callback"),D.call(this,a,c)},l.prototype.enterRoom=function(a,c,d){a?b.isStringNotEmpty(a,"roomId"):b.isStringNotEmpty(c,"alias"),b.isFunction(d,"callback"),F.call(this,a,c,d)},l.prototype.leaveRoom=function(a){var b=this;return G.call(b,a)},l.prototype.getChatService=function(){return!this._roomChatService&&this._activeRoom.getValue()&&(this._roomChatService=new i(this)),this._roomChatService},l.prototype.getSelf=function(){return this._self.getValue()},l.prototype.getObservableActiveRoom=function(){return this._activeRoom},l.prototype.updateSelf=function(a){b.isFunction(a,"callback"),H.call(this,this.getSelf(),a)},l.prototype.updateMember=function(a,c){b.isFunction(c,"callback"),b.isObject(a,"member"),H.call(this,a,c)},l.prototype.updateRoom=function(a){b.isFunction(a,"callback"),I.call(this,a)},l.prototype.revertRoomChanges=function(){var a=this._activeRoom.getValue(),b=this._cachedRoom.getValue();return a&&b?void a._update(b.toJson()):this._logger.warn("Unable to revert changes to room. Not currently in a room.")},l.prototype.revertMemberChanges=function(a){b.isObject(a,"member");var c=v(a.getSessionId(),this._cachedRoom),d=v(a.getSessionId(),this._activeRoom);return c&&d?void d._update(c.toJson()):this._logger.warn("Unable to revert changes to member. Member is currently not in room.")},l.prototype.isInRoom=function(){return!!this._activeRoom.getValue()},l.prototype.toString=function(){return"RoomService"},l.prototype.stop=function(){var a=this._activeRoom.getValue(),b=this;return a?this.leaveRoom(function(a,c){a&&b._logger.warn("Failure to stop room service. Unable to leave room",a),c&&"ok"!==c.status&&b._logger.warn("Failure to stop room service. Unable to leave room. Status: [%s]",c.status),c&&"ok"===c.status&&(m.call(b),b._started=!1)}):(m.call(this),void(b._started=!1))},l}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(2),c(101)],e=function(a,b,c,d){"use strict";function e(c,d){b.isObject(c,"pcast"),d&&b.isObject(d,"options"),d&&d.screenShare&&b.isFunction(d.screenShare,"options.screenShare"),this._pcast=c,this._logger=c.getLogger(),this._options=d||{},this._onScreenShare=a.get(d,["onScreenShare"])}function f(a,b,c){var d=a.video,e=a.audio,f=a.screen,g=b.width,h=b.height,i={};return d&&(i.video={height:{min:h,max:h,exact:h},width:{min:g,max:g,exact:g},frameRate:c},d.deviceId&&(i.video.deviceId=d.deviceId),d.facingMode&&(i.video.facingMode=d.facingMode),g||delete i.video.width,h||delete i.video.height,c||delete i.video.frameRate,g||h||c||d.deviceId||d.facingMode||(i.video=!0)),e&&(i.audio=!0,e.deviceId&&(i.audio={deviceId:e.deviceId})),f&&(i.screen=!0),i}function g(a,b,c){var d=a.video,e=a.audio,f=a.screen,g=a.screenAudio,h=b.width,i=b.height,j={};return d&&(j.video={height:{min:i,ideal:i,max:i},width:{min:h,ideal:h,max:h},frameRate:{ideal:c,max:c}},d.deviceId&&(j.video.deviceId={exact:d.deviceId}),d.facingMode&&(j.video.facingMode=d.facingMode),h||delete j.video.width,i||delete j.video.height,c||delete j.video.frameRate,h||i||c||d.deviceId||d.facingMode||(j.video=!0)),e&&(j.audio={},e.deviceId&&(j.audio.deviceId={exact:e.deviceId}),e.mediaSource&&(j.audio.mediaSource=e.mediaSource),e.mediaSourceId&&(j.audio.mediaSourceId=e.mediaSourceId),e.deviceId||e.mediaSource||e.mediaSourceId||(j.audio=!0)),g&&(j.screenAudio={},g.deviceId&&(j.screenAudio.deviceId={exact:g.deviceId}),g.mediaSource&&(j.screenAudio.mediaSource=g.mediaSource),g.mediaSourceId&&(j.screenAudio.mediaSourceId=g.mediaSourceId),g.deviceId||g.mediaSource||g.mediaSourceId||(j.screenAudio=!0)),f&&(j.screen={height:{min:i,ideal:i,max:i},width:{min:h,ideal:h,max:h},frameRate:{ideal:c,max:c}},h||delete j.screen.width,i||delete j.screen.height,c||delete j.screen.frameRate,f.mediaSource&&(j.screen.mediaSource=f.mediaSource),h||i||c||f.mediaSource||(j.screen=!0)),f&&d&&(j.screen=!0),j}function h(a,b,c){var d=a.video,e=a.audio,f=a.screen,g=a.screenAudio,h=b.width,i=b.height,j={};return d&&(j.video={mandatory:{minHeight:i,maxHeight:i,minWidth:h,maxWidth:h,maxFrameRate:c}},d.deviceId&&(j.video.mandatory.sourceId=d.deviceId),d.facingMode&&(j.video.facingMode=d.facingMode),d.mediaSource&&(j.video.mandatory.mediaSource=d.mediaSource),d.mediaSourceId&&(j.video.mandatory.mediaSourceId=d.mediaSourceId),h||(delete j.video.mandatory.minWidth,delete j.video.mandatory.maxWidth),i||(delete j.video.mandatory.minHeight,delete j.video.mandatory.maxHeight),c||delete j.video.mandatory.maxFrameRate,h||i||c||d.deviceId||d.facingMode||d.mediaSource||d.mediaSourceId||(j.video=!0)),e&&(j.audio={mandatory:{}},e.deviceId&&(j.audio.mandatory.sourceId=e.deviceId),e.mediaSource&&(j.audio.mandatory.mediaSource=e.mediaSource),e.mediaSourceId&&(j.audio.mandatory.mediaSourceId=e.mediaSourceId),e.deviceId||e.mediaSource||e.mediaSourceId||(j.audio=!0)),g&&(j.screenAudio={mandatory:{}},g.deviceId&&(j.screenAudio.mandatory.sourceId=g.deviceId),g.mediaSource&&(j.screenAudio.mandatory.mediaSource=g.mediaSource),g.mediaSourceId&&(j.screenAudio.mandatory.mediaSourceId=g.mediaSourceId),g.deviceId||g.mediaSource||g.mediaSourceId||(j.screenAudio=!0)),f&&(j.screen={mandatory:{minHeight:i,maxHeight:i,minWidth:h,maxWidth:h,maxFrameRate:c}},h||(delete j.screen.mandatory.minWidth,delete j.screen.mandatory.maxWidth),i||(delete j.screen.mandatory.minHeight,delete j.screen.mandatory.maxHeight),c||delete j.screen.mandatory.maxFrameRate,f.mediaSource&&(j.screen.mandatory.mediaSource=f.mediaSource),f.mediaSourceId&&(j.screen.mandatory.mediaSourceId=f.mediaSourceId),h||i||c||f.mediaSource||(j.screen=!0)),f&&d&&(j.screen=!0),j}function i(a,b,d,e,f){var g=this.getVendorSpecificConstraints(a,b||{},d),h=!!g.video,m=this;this._pcast.getUserMedia(g,function(g,j,k,n){if("ok"===j)return f(null,{userMedia:k,options:{frameRate:h?d:null,resolution:h?b.height:null,aspectRatio:h?b.aspectRatio:null}});var o=b,p=d,q=l(n);if(n&&("ConstraintNotSatisfiedError"===n.name||"OverconstrainedError"===n.name||"OverconstrainedError"===n.constructor.name||"unavailable"===n.code&&"Edge"===c.browser))switch(q.toLowerCase()){case"width":case"height":if(!b||!e.canResolveNextResolution())break;return m._logger.warn("Unable to get user media with constraint [%s] with height [%s] and width [%s]. Retrying with next closest resolution.",q,o.height,o.width),o=e.getNextResolution(b.height,b.aspectRatio),i.call(m,a,o,p,e,f);case"framerate":default:if(d)return m._logger.warn("Unable to get user media with constraint [%s] and framerate [%s]. Retrying without frame rate constraint.",q,d),p=null,i.call(m,a,o,p,e,f);if(!b||!e.canResolveNextResolution())break;return m._logger.warn("Unable to get user media with constraint [%s] with height [%s] and width [%s]. Retrying with next closest resolution.",q,o.height,o.width),o=e.getNextResolution(b.height,b.aspectRatio),i.call(m,a,o,p,e,f)}return m._logger.error("Unable to get user media with status [%s]",j,n),f(n)},function(a){var b=a;if(m._onScreenShare&&"Chrome"===c.browser){var d=j(a);b=m._onScreenShare(d);var f;b.resolutionHeight&&b.aspectRatio&&(f={width:e.calculateWidthByAspectRatio(b.resolution,b.aspectRatio),height:b.resolutionHeight}),b=k.call(m,d,f,b.frameRate)}return b})}function j(b){var c=a.get(b,["video","mandatory","chromeMediaSource"]),d=a.get(b,["audio","mandatory","chromeMediaSource"]),e=a.get(b,["video","mandatory","chromeMediaSourceId"]),f=a.get(b,["audio","mandatory","chromeMediaSourceId"]),g={};return(c||f)&&(a.set(g,["screen","mediaSource"],c),a.set(g,["screen","mediaSourceId"],e)),(d||f)&&(a.set(g,["screenAudio","mediaSource"],d),a.set(g,["screenAudio","mediaSourceId"],f)),g}function k(b,c,d){var e=this.getVendorSpecificConstraints(b,c,d);e.screen&&(e.video=e.screen,delete e.screen),e.screenAudio&&(e.audio=e.screenAudio,delete e.screenAudio);var f=a.get(e,["video","mandatory","mediaSource"]),g=a.get(e,["audio","mandatory","mediaSource"]),h=a.get(e,["video","mandatory","mediaSourceId"]),i=a.get(e,["audio","mandatory","mediaSourceId"]);return(f||h)&&(a.set(e,["video","mandatory","chromeMediaSource"],f),a.set(e,["video","mandatory","chromeMediaSourceId"],h),delete e.video.mandatory.mediaSource,delete e.video.mandatory.mediaSourceId),(g||i)&&(a.set(e,["audio","mandatory","chromeMediaSource"],g),a.set(e,["audio","mandatory","chromeMediaSourceId"],i),delete e.audio.mandatory.mediaSource,delete e.audio.mandatory.mediaSourceId),e}function l(a){return a.constraintName?a.constraintName:a.constraint?a.constraint:""}return e.prototype.getUserMedia=function(a,c){b.isObject(a,"deviceOptions");var e=new d(this._options),f=e.getDefaultResolution(),g=e.getDefaultFrameRate();i.call(this,a,f,g,e,c)},e.prototype.getVendorSpecificConstraints=function(a,b,d){if(b=b||{},!a||!a.audio&&!a.video&&!a.screen&&!a.screenAudio)throw new Error("Invalid device options. Must pass in at least one device option.");return"Firefox"===c.browser&&c.browserVersion>38||"Chrome"===c.browser&&c.browserVersion>52&&!a.screen&&!a.screenAudio||"Safari"===c.browser&&c.browserVersion>10||"Opera"===c.browser&&c.browserVersion>40?g(a,b,d):"Edge"===c.browser?f(a,b,d):h(a,b,d)},e}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(55)],e=function(a){return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(3)],e=function(a,b,c){"use strict";function d(){this._listeners=[]}function e(c,d,e){var f=this;a.isNullOrUndefined(c)&&(c=[]),b.isArray(c,"args");var g=function(){a.forEach(f._listeners,function(a){a.apply(d,c)})};e?setTimeout(function(){g(),e()},0):g()}return d.prototype.fire=function(a,b){e.call(this,a,b)},d.prototype.fireAsync=function(a,b,c){e.call(this,a,b,c||function(){})},d.prototype.listen=function(d){var e=this;return b.isFunction(d,"listener"),e._listeners.push(d),new c.Disposable(function(){e._listeners=a.remove(e._listeners,function(a){return a===d})})},d.prototype.size=function(){return this._listeners.length},d.prototype.dispose=function(){this._listeners=[]},d.prototype.toString=function(){return"Event|"+this.size()},d}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(63)],e=function(a){"use strict";return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(3)],e=function(a,b,c){"use strict";function d(a,b){this.latestValue=null,this.subscribeCallbacks={},this.subscriptionTimeout=100,this.subscriptionCount=0,this.resetOnChange=!1,this.lastChangeTime=0,this.isPendingChanges=!1,this.beforeChange=b,f.call(this,a)}function e(b){return"undefined"==typeof b||null===b?b:a.isArray(b)?b.slice():b}function f(a){var b=a;this.beforeChange&&(b=this.beforeChange(a)),this.latestValue=e(b)}function g(b,c){if(this.lastChangeTime=a.now(),!this.isPendingChanges&&0!==this.subscriptionCount){if(this.isPendingChanges=!0,c)return i.call(this);h.call(this,b)}}function h(b){var c=this;setTimeout(function(){var b=a.now()-c.lastChangeTime;c.resetOnChange&&b<c.subscriptionTimeout?h.call(c,c.subscriptionTimeout-b):i.call(c)},b)}function i(){try{j.call(this)}finally{this.isPendingChanges=!1}}function j(){var b=this;a.forOwn(b.subscribeCallbacks,function(c){a.isFunction(c)&&c(b.latestValue)})}return d.prototype.getValue=function(){return e(this.latestValue)},d.prototype.setValue=function(a){a!==this.latestValue&&(f.call(this,a),g.call(this,this.subscriptionTimeout))},d.prototype.subscribe=function(d,e){b.isFunction(d,"callback"),e&&b.isObject(e,"options");var f,h=this,i=a.uniqueId();return h.subscribeCallbacks[i]=d,h.subscriptionCount+=1,e&&("notify"===e.initial&&g.call(h,h.subscriptionTimeout,!0),e.listenForChanges&&(f=setInterval(function(){var a=e.listenForChanges.callback();a!==h.latestValue&&h.setValue(a)},e.listenForChanges.timeout))),new c.Disposable(function(){delete h.subscribeCallbacks[i],f&&(clearInterval(f),f=null),h.subscriptionCount-=1})},d.prototype.extend=function(c){switch(b.isObject(c,"options"),c.method){case"notifyWhenChangesStop":this.subscriptionTimeout=c.timeout,this.resetOnChange=!0;break;case"notifyAtFixedRate":this.subscriptionTimeout=c.timeout}return a.isNumber(c.rateLimit)&&(this.subscriptionTimeout=c.rateLimit),this},d}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){!function(b,d){a.exports=d(c(1),c(0),c(8),c(5),c(3),c(2),c(6),c(25),c(13))}(this,function(a,b,c,d,e,f,g,h,i){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,b),e.l=!0,e.exports}var c={};return b.m=a,b.c=c,b.d=function(a,c,d){b.o(a,c)||Object.defineProperty(a,c,{configurable:!1,enumerable:!0,get:d})},b.n=function(a){var c=a&&a.__esModule?function(){return a["default"]}:function(){return a};return b.d(c,"a",c),c},b.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},b.p="",b(b.s=21)}([function(b,c){b.exports=a},function(a,c){a.exports=b},function(a,b){a.exports=c},function(a,b){a.exports=d},function(a,b,c){var d,e;d=[c(1),c(0),c(2),c(3),c(10),c(7),c(22),c(23),c(13),c(14),c(26),c(5)],void 0!==(e=function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";function m(a,e){e&&b.isStringNotEmpty(e,"playlistUrl"),this.parsedPlaylist=null,this._logger=a||new c.Logger,this.playlistUrl=e,this.baseUrl=e?e.substring(0,e.lastIndexOf("/")+1):"",this._name=e?e.substring(e.lastIndexOf("/"),e.length):"",this._trackAddedEvent=new d.Event,this._playlistTracksByMimeType={},this._mimeTypes=[],this._deliveryType=o(this.playlistUrl),this._type=null,this._localToServerTimeOffset=0}function n(c,d){b.isInstanceOf(c,f,"track"),d=d||a.noop,b.isFunction(d,"eventCallback");var e=c.getMimeType();this._playlistTracksByMimeType[e]||(this._playlistTracksByMimeType[e]=[]),a.includes(this._playlistTracksByMimeType[e],c)||this._playlistTracksByMimeType[e].push(c),a.includes(this._mimeTypes,e)||this._mimeTypes.push(e),this._trackAddedEvent.fireAsync([c],this,d)}function o(a){return/[.]mpd\??[^\s]*/i.test(a)?"Dash":/[.]m3u8\??[^\s]*/i.test(a)?"Hls":null}function p(b,c,d){if(this._logger.error("Failed to load playlist [%s]. Status code: [%s] (status text: [%s])",this.playlistUrl,b.code,b.message),c&&c.attempts===r){var e="Failed to get playlist with max retries of ["+r+" after ["+a.get(c,["stats","totalResponseTimeForAllAttempts"],0)+"] ms";return d(q(l.name.playlistNotFound.name,l.severity.CRITICAL,e))}if(0===b.code){var f="Failed to get playlist with timeout after ["+a.get(c,["stats","totalResponseTimeForAllAttempts"],0)+"]";return d(q(l.name.timeout.name,l.severity.RECOVERABLE,f))}return d(q(l.name.error.name,l.severity.CRITICAL,b))}function q(a,b,c){return{category:l.category.PLAYLIST,name:a,severity:b,error:"Error"===c.constructor.name?c:new Error(c)
}}var r=5,s=0;return m.prototype.toString=function(){return"Playlist [playlistUrl="+this.playlistUrl+", baseUrl="+this.baseUrl+", mimeTypes="+this._mimeTypes+", trackAddedEvent(size)="+this._trackAddedEvent.size()+", playlistTracks="+this.getAllPlaylistTracks()+"]"},m.prototype.dispose=function(){a.forOwn(this._playlistTracksByMimeType,function(b){a.forEach(b,function(a){a.dispose()})}),this._playlistTracksByMimeType={},this._trackAddedEvent.dispose()},m.prototype.getPlaylistTracksByMimeType=function(a){return this._playlistTracksByMimeType[a]},m.prototype.fetch=function(b){(function(b){var c=this;e.getWithRetry(c.playlistUrl,{retryOptions:{backoff:1,delay:1e3,maxAttempts:r,additionalRetryErrorCodes:[s]}},function(d,f){return d?p.call(c,d,f,b):void function(b,c,d){var f=null,l=[],m=this;switch(m._initTime=a.now(),this._deliveryType){case"Dash":f=new i(m._logger,b);var q=new k(m._logger,f.timeSources,c);m.parsedPlaylist=f,m._playbackDurationSinceAvailable=m.parsedPlaylist.publishTime?m.parsedPlaylist.publishTime.getTime()-m.parsedPlaylist.availabilityStartTime.getTime():null,m._suggestedPresentationDelayTotalMillis=a.get(m.parsedPlaylist,["suggestedPresentationDelay","totalMillis"],null),m._totalMediaTimeInMillis=a.get(m.parsedPlaylist,["mediaPresentationDuration","totalMillis"],1/0),m._minBufferTimeTotalMillis=a.get(m.parsedPlaylist,["minBufferTime","totalMillis"],null),m._type=m.parsedPlaylist.type,l=function(b){var c=this;return a.map(b.representations,function(a){return{chunkDuration:a.duration,dataChunkUrlTemplate:a.media,codec:a.mseCodec,bandwidth:a.bandwidth,height:a.height,trackId:a.id,initUrl:a.initialization,mimeType:a.mimeType,totalNumberOfChunks:Math.ceil(c._totalMediaTimeInMillis/a.duration)}})}.call(m,m.parsedPlaylist),a.forEach(l,function(a){n.call(m,new g(m._logger,a))}),q.calculateOffset(function(a){m._localToServerTimeOffset=a,d()});break;case"Hls":f=new j(m._logger,m._name,b),m.parsedPlaylist=f,m._playbackDurationSinceAvailable=0,m._minBufferTimeTotalMillis=0,m._suggestedPresentationDelayTotalMillis=0,m._totalMediaTimeInMillis=1/0;var s=0;a.forEach(f.streamVariants,function(a){var b=m.baseUrl+a.name,c=new h(m._logger,{mediaSegmentPlaylistUrl:b,codecs:a.codecs.join("|"),bandwidth:a.bandwidth,trackId:a.name,mimeType:"application/octet-stream",height:null});e.getWithRetry(b,{retryOptions:{maxAttempts:r,backoff:1}},function(a,b){return a?p.call(m,a,b,d):(c.updateMediaSegments(b.data),n.call(m,c),++s===f.streamVariants.length&&(m._type=c.isComplete()?"static":"dynamic","static"===m._type&&(m._totalMediaTimeInMillis=1e3*c.getPlayableDuration()),d()),void 0)})});break;default:throw m._logger.error("[%s] Unsupported Delivery Type [%s]",m.playlistUrl,o(m.playlistUrl)),new Error("Unsupported Delivery Type "+o(m.playlistUrl))}}.call(c,f.data,f.stats.successResponseTime,function(){b(d,{raw:f,parsed:c.parsedPlaylist})})})}).call(this,b)},m.prototype.getType=function(){return this._type},m.prototype.getDeliveryType=function(){return this._deliveryType},m.prototype.getPlaylistTracksByBandwidthPerMimeType=function(c,d){b.isObject(d,"restrictions");var e=this;return a.map(this._mimeTypes,function(b){var f=function(b,c){return 0===a.keys(c).length?b:a.filter(b,function(b){return function(b,c){var d=b.getHeight()||0,e=b.getBandwidth()||0;return a.reduce(c,function(a,b,c){switch(c){case"maxHeight":return d<=b;case"minHeight":return d>=b;case"maxBandwidth":return e<=b;case"minBandwidth":return e>=b;default:throw new Error("Unknown restriction "+c)}},!1)}(b,c)})}(e.getPlaylistTracksByMimeType(b),d),g=a.reduce(f,function(a,b){return b.getBandwidth()>c?a:a&&a.getBandwidth()>b.getBandwidth()?a:b},null)||e.getPlaylistTrackByMimeTypeAndNextHighestBandwidth(0,b);if(g)return g;var h=a.get(a.filter(f,function(a){return!a.getBandwidth()}),"0");return h?(e._logger.debug("Unable to get track with bandwidth [%s]. Falling back to track [%s].",h.getTrackId()),h):void e._logger.warn("Unable to get track with bandwidth [%s]. No other tracks to fallback on.")})},m.prototype.getPlaylistTrackByBandwidthAndMimeType=function(b,c){return a.find(this.getPlaylistTracksByBandwidthPerMimeType(b,{}),function(a){return a.getMimeType()===c})},m.prototype.getPlaylistTrackByMimeTypeAndNextHighestBandwidth=function(b,c){return a.reduce(this.getPlaylistTracksByMimeType(c),function(a,c){return c.getBandwidth()<=b?a:a?a.getBandwidth()>c.getBandwidth()?c:a:c},null)},m.prototype.getAllPlaylistTracks=function(){return[].concat.apply([],a.values(this._playlistTracksByMimeType))},m.prototype.getMimeTypes=function(){return this._mimeTypes},m.prototype.getPlaybackDurationSinceAvailable=function(){return a.now()-this._initTime+this._playbackDurationSinceAvailable+this._localToServerTimeOffset},m.prototype.getSuggestedPresentationDelayTotalMillis=function(){return this._suggestedPresentationDelayTotalMillis},m.prototype.getTotalMediaTimeInMillis=function(){return this._totalMediaTimeInMillis},m.prototype.getMinBufferTimeTotalMillis=function(){return this._minBufferTimeTotalMillis},m.prototype.getLocalToServerTimeOffset=function(){return this._localToServerTimeOffset},m.prototype.addEventListener=function(a,c){switch(b.isString(a,"eventName"),b.isFunction(c,"listener"),a){case"trackadded":return this._trackAddedEvent.listen(c);default:throw new Error('Event "'+a+'" is unknown.')}},m}.apply(b,d))&&(a.exports=e)},function(a,b,c){var d;void 0!==(d=function(){"use strict";return{name:{chunkNotFound:{id:0,name:"chunk-not-found"},timeout:{id:1,name:"timeout"},error:{id:2,name:"error"},playlistNotFound:{id:3,name:"playlist-not-found"},progressTimeOut:{id:4,name:"progress-timeout"},hlsNativeError:{id:5,name:"hls-native-error"}},category:{PLAYLIST:4,STREAMING:5,DRM:6},severity:{RECOVERABLE:1,CRITICAL:2}}}.apply(b,[]))&&(a.exports=d)},function(a,b){a.exports=e},function(a,b,c){var d,e;d=[c(0),c(3),c(2)],void 0!==(e=function(a,b,c){"use strict";function d(a,b,c){}return d.prototype.toString=function(){throw new Error("Must be implemented")},d.prototype.dispose=function(){throw new Error("Must be implemented")},d.prototype.getMseCodec=function(){throw new Error("Must be implemented")},d.prototype.getTrackId=function(){throw new Error("Must be implemented")},d.prototype.getChunkDuration=function(){throw new Error("Must be implemented")},d.prototype.getBandwidth=function(){throw new Error("Must be implemented")},d.prototype.getHeight=function(){throw new Error("Must be implemented")},d.prototype.getMimeType=function(){throw new Error("Must be implemented")},d.prototype.getTotalNumberOfChunks=function(){throw new Error("Must be implemented")},d.prototype.getCurrentChunkId=function(){throw new Error("Must be implemented")},d.prototype.setCurrentChunkId=function(a){throw new Error("Must be implemented")},d.prototype.incrementCurrentChunkId=function(){throw new Error("Must be implemented")},d.prototype.addDataChunk=function(a,b,c){throw new Error("Must be implemented")},d.prototype.getChunks=function(){throw new Error("Must be implemented")},d.prototype.addEventListener=function(a,b){throw new Error("Must be implemented")},d}.apply(b,d))&&(a.exports=e)},function(a,b){a.exports=f},function(a,b,c){var d,e;d=[c(1),c(2)],void 0!==(e=function(a,b){"use strict";function c(a,c){this._options=c||{},this._logger=a||new b.Logger,this._rateDataPoints={},this._ewmaPeriods=c.ewmaPeriods||null,this._ewmaMultiplier=this._ewmaPeriods?2/(this._ewmaPeriods+1):null}function d(a,b,c,d,e){var f=(c*(a.length-1)+e(b))/a.length;if(d>0)for(;b.added-a[0].added>d;){var g=a.shift();f=(f*(a.length+1)-e(g))/a.length}return f}return c.prototype.toString=function(){var b=this;return"StatsProvider [rateDataPoints(keys)="+a.keys(this._rateDataPoints)+", rateDataPoints="+a.toString(a.map(this._rateDataPoints,function(a,c){return b.getRateAverages(c)}))+", options="+this._options+"]"},c.prototype.dispose=function(){delete this._rateDataPoints},c.prototype.addRateDataPoint=function(b,c,e,f){if(!a.isNullOrUndefined(this._rateDataPoints)){this._rateDataPoints[b]||(this._rateDataPoints[b]={tenSecDataPoints:[],thirtySecDataPoints:[],oneMinDataPoints:[],twoMinDataPoints:[],ewmaDataPoints:[],tenSecAverageRate:0,thirtySecAverageRate:0,oneMinAverageRate:0,twoMinAverageRate:0,ewmaRate:0,smaRate:0,tenSecAverageDuration:0,thirtySecAverageDuration:0,oneMinAverageDuration:0,twoMinAverageDuration:0,ewmaDuration:0,smaDuration:0});var g={duration:c,amount:e,durationToSecondsFactor:f,rate:e/(c*f),added:a.now()};(function(a,b){var c=function(a){return a.rate},e=function(a){return a.duration};a.tenSecDataPoints.push(b),a.thirtySecDataPoints.push(b),a.oneMinDataPoints.push(b),a.twoMinDataPoints.push(b),a.tenSecAverageRate=d.call(this,a.tenSecDataPoints,b,a.tenSecAverageRate,1e4,c),a.thirtySecAverageRate=d.call(this,a.thirtySecDataPoints,b,a.thirtySecAverageRate,3e4,c),a.oneMinAverageRate=d.call(this,a.oneMinDataPoints,b,a.oneMinAverageRate,6e4,c),a.twoMinAverageRate=d.call(this,a.twoMinDataPoints,b,a.twoMinAverageRate,12e4,c),a.tenSecAverageDuration=d.call(this,a.tenSecDataPoints,b,a.tenSecAverageDuration,1e4,e),a.thirtySecAverageDuration=d.call(this,a.thirtySecDataPoints,b,a.thirtySecAverageDuration,3e4,e),a.oneMinAverageDuration=d.call(this,a.oneMinDataPoints,b,a.oneMinAverageDuration,6e4,e),a.twoMinAverageDuration=d.call(this,a.twoMinDataPoints,b,a.twoMinAverageDuration,12e4,e),this._ewmaMultiplier&&(a.ewmaDataPoints.push(b),a.smaRate=d.call(this,a.ewmaDataPoints,b,a.smaRate,-1,c),a.smaDuration=d.call(this,a.ewmaDataPoints,b,a.smaDuration,-1,e),a.ewmaDataPoints.length>=this._ewmaPeriods&&(a.ewmaDataPoints.shift(),a.ewmaDataPoints.length===this._ewmaPeriods?(a.ewmaRate=a.smaRate,a.ewmaDuration=a.smaDuration):(a.ewmaRate=this._ewmaMultiplier*(a.smaRate-a.ewmaRate)+a.ewmaRate,a.ewmaDuration=this._ewmaMultiplier*(a.smaDuration-a.ewmaDuration)+a.ewmaDuration)))}).call(this,this._rateDataPoints[b],g)}},c.prototype.getRateAverages=function(b){if(!a.get(this,["_rateDataPoints",b]))return{tenSecAverageRate:0,thirtySecAverageRate:0,oneMinAverageRate:0,twoMinAverageRate:0,ewmaRate:0,tenSecAverageDuration:0,thirtySecAverageDuration:0,oneMinAverageDuration:0,twoMinAverageDuration:0,ewmaDuration:0};var c=this._rateDataPoints[b];return{tenSecAverageRate:c.tenSecAverageRate,thirtySecAverageRate:c.thirtySecAverageRate,oneMinAverageRate:c.oneMinAverageRate,twoMinAverageRate:c.twoMinAverageRate,ewmaRate:c.ewmaRate,tenSecAverageDuration:c.tenSecAverageDuration,thirtySecAverageDuration:c.thirtySecAverageDuration,oneMinAverageDuration:c.oneMinAverageDuration,twoMinAverageDuration:c.twoMinAverageDuration,ewmaDuration:c.ewmaDuration}},c}.apply(b,d))&&(a.exports=e)},function(a,b){a.exports=g},function(a,b){a.exports=h},function(a,b,c){var d;void 0!==(d=function(){"use strict";function a(a,b,c,d){}return a.prototype.toString=function(){throw new Error("Must be implemented")},a.prototype.dispose=function(){throw new Error("Must be implemented")},a.prototype.initialize=function(a,b,c,d){throw new Error("Must be implemented")},a.prototype.getStreamDurationBeforeInitialization=function(){throw new Error("Must be implemented")},a.prototype.getLocalToServerTimeOffset=function(){throw new Error("Must be implemented")},a.prototype.setActiveTracks=function(a){throw new Error("Must be implemented")},a.prototype.initializePlaylistTracks=function(a,b,c,d){throw new Error("Must be implemented")},a.prototype.startRequestingDataForActiveTracks=function(){throw new Error("Must be implemented")},a.prototype.isFetchingData=function(){throw new Error("Must be implemented")},a.prototype.seekToChunk=function(a){throw new Error("Must be implemented")},a.prototype.stopRequestingAllData=function(){throw new Error("Must be implemented")},a}.apply(b,[]))&&(a.exports=d)},function(a,b,c){var d,e;d=[c(1),c(0),c(25)],void 0!==(e=function(a,b,c){"use strict";function d(d,f){b.isStringNotEmpty(f,"mpdXml"),b.isObject(d,"logger"),this._mpdXml=f,this._logger=d,this.minBufferTime=0,this.type=null,this.publishTime=null,this.availabilityStartTime=null,this.timeShiftBufferDepth=0,this.suggestedPresentationDelay=0,this.minimumUpdatePeriod=0,this.maxSegmentDuration=0,this.profiles=null,this.moreInfoUrl=null,this.programInfoTitle=null,this.representations=[],function(){b.isStringNotEmpty(this._mpdXml,"mpdXml");var d,f=c.parseXml(this._mpdXml),j=f.getElementsByTagName("parsererror");if(j&&j.length>0)throw d="Failed to parse MPD Playlist XML: "+j.item(0).innerText+" (source xml: "+this._mpdXml+")",this._logger.error(d),new Error(d);if("MPD"!==f.documentElement.nodeName)throw d='Invalid MPD Playlist XML. Does not start with "MPD": '+this._mpdXml,this._logger.error(d),new Error(d);this.minBufferTime=e(h(f.documentElement,"minBufferTime")),this.type=h(f.documentElement,"type"),this.publishTime=g(h(f.documentElement,"publishTime")),this.availabilityStartTime=g(h(f.documentElement,"availabilityStartTime")),this.timeShiftBufferDepth=e(h(f.documentElement,"timeShiftBufferDepth")),this.suggestedPresentationDelay=e(h(f.documentElement,"suggestedPresentationDelay")),this.minimumUpdatePeriod=e(h(f.documentElement,"minimumUpdatePeriod")),this.maxSegmentDuration=e(h(f.documentElement,"maxSegmentDuration")),this.mediaPresentationDuration=e(h(f.documentElement,"mediaPresentationDuration")),this.profiles=h(f.documentElement,"profiles");var k=f.getElementsByTagName("ProgramInformation"),l=f.getElementsByTagName("UTCTiming");if(k&&k.length>=1){var m=k.item(0);this.programInfoTitle=i(m,"Title").childNodes[0].nodeValue,this.moreInfoUrl=h(m,"moreInformationURL")}var n=f.getElementsByTagName("ContentProtection");if(this.contentProtectionTags=[],n.length>0)for(var o=0;o<n.length;o++){var p=n.item(o),q=a.reduce(p.attributes,function(a,b){return a[b.name]=b.value,a},{});this.contentProtectionTags.push(q)}for(var r=f.getElementsByTagName("Representation"),s=0;s<r.length;s++){var t=function(a){var b={};if(b.id=h(a,"id"),b.mimeType=h(a,"mimeType"),b.codecs=h(a,"codecs"),b.mseCodec=c.getMSECodec(b.mimeType,b.codecs),b.isAudio=b.mimeType.indexOf("audio")>=0,b.isVideo=b.mimeType.indexOf("video")>=0,!c.isCodecSupported(b.mseCodec))return this._logger.debug("MPD representation has unsupported codec. Skipping stream id [%s] (mimeType=[%s], codecs=[%s])",b.id,b.mimeType,b.codecs),null;var d=h(a,"bandwidth");b.bandwidth=d?parseInt(d,10):null;var e=h(a,"height");b.height=e?parseInt(e,10):null;var f=i(a,"SegmentTemplate");return f&&(b.timescale=parseInt(h(f,"timescale")),b.media=h(f,"media"),b.startNumber=parseInt(h(f,"startNumber")),b.duration=parseInt(h(f,"duration")),b.initialization=h(f,"initialization")),b}.call(this,r.item(s));t&&this.representations.push(t)}this.timeSources=[];for(var u=0;u<l.length;u++){var v=l.item(u),w=h(v,"schemeIdUri"),x=h(v,"value"),y=g(x);this.timeSources.push({name:w,value:isNaN(y.getTime())?x:y.getTime()})}}.call(this)}function e(a){if(!a)return null;var b=/^(-)?P(?:(-?[0-9,.]*)Y)?(?:(-?[0-9,.]*)M)?(?:(-?[0-9,.]*)W)?(?:(-?[0-9,.]*)D)?(?:T(?:(-?[0-9,.]*)H)?(?:(-?[0-9,.]*)M)?(?:(-?[0-9,.]*)S)?)?$/.exec(a);if(b){var c="-"===b[1]?-1:1,d={year:f(b[2],c),month:f(b[3],c),week:f(b[4],c),day:f(b[5],c),hour:f(b[6],c),minute:f(b[7],c),second:f(b[8],c)};return d.totalMillis=1e3*(d.second+60*(d.minute+60*(d.hour+24*d.day))),d}return null}function f(a,b){var c=a&&parseFloat(a.replace(",","."));return(isNaN(c)?0:c)*b}function g(a){if(!a)return null;var b=new Date;return b.setTime(Date.parse(a)),b}function h(a,b){var c=a.attributes.getNamedItem(b);return c?c.value:null}function i(a,b){for(var c=0;c<a.childNodes.length;c++){var d=a.childNodes.item(c);if(d.nodeName===b)return d}return null}return d.prototype.toString=function(){return"Mpd [minBufferTime="+this.minBufferTime+", type="+this.type+", publishTime="+this.publishTime+", availabilityStartTime="+this.availabilityStartTime+", timeShiftBufferDepth="+this.timeShiftBufferDepth+", suggestedPresentationDelay="+this.suggestedPresentationDelay+", minimumUpdatePeriod="+this.minimumUpdatePeriod+", maxSegmentDuration="+this.maxSegmentDuration+", profiles="+this.profiles+", moreInfoUrl="+this.moreInfoUrl+", programInfoTitle="+this.programInfoTitle+", representations="+JSON.stringify(this.representations)+"]"},d}.apply(b,d))&&(a.exports=e)},function(a,b,c){var d,e;d=[c(1),c(0)],void 0!==(e=function(a,b){"use strict";function c(c,e,f){b.isStringNotEmpty(f,"M3u8VariantPlaylistString"),b.isStringNotEmpty(e,"name"),b.isObject(c,"logger"),this._rawM3u8VariantPlaylist=f,this._name=e,this._logger=c,function(b){var c=b.match(/[^\r\n]+/g),e=this;return a.forEach(c,function(b,f){var g=b.match(/(?!#)EXT.+?(?=[:\n\r])/),h=a.get(g,["0"],null),i=b.trim().substring(h?h.length+2:0,b.length);switch(h){case"EXT-X-STREAM-INF":e.streamVariants=e.streamVariants||[];var j=[i,c[f+1]];e.streamVariants.push(function(b){var c=(function(b){var c=a.get(b.match(/(?:CODECS=).*?",/),["0"],""),d=a.get(c.split("="),["1"],"");return d.substring(1,d.length-2)}(b[0])||"").split(","),e=(d(b[0],"FRAME-RATE")||"").trim();return{programId:d(b[0],"PROGRAM-ID"),codecs:c,bandwidth:parseInt(d(b[0],"BANDWIDTH")),averageBandwidth:parseInt(d(b[0],"AVERAGE-BANDWIDTH")),frameRate:parseInt(parseInt(e)||0),name:a.get(b,["1"],"").trim()}}(j));break;case"EXT-X-ALLOW-CACHE":e.allowCache="YES"===i;break;case"#EXT-X-COMBINED":e.combined="YES"===i;break;case"EXTM3U":case null:break;default:return e._logger.debug("[%s] [Variant] Playlist unsupported key type [%s]",e._name,h)}}),e}.call(this,this._rawM3u8VariantPlaylist)}function d(b,c){var d=new RegExp("(?:"+c+"=).*?(?=[,\n\r])"),e=new RegExp("(?:"+c+"=).*?$"),f=a.get(b.match(d)||b.match(e),["0"],"");return a.get(f.split("="),["1"])}return c.prototype.toString=function(){return"M3u8VariantPlaylist[name="+this._name+",numberOfStreamVariants="+this.streamVariants.length+"]"},c}.apply(b,d))&&(a.exports=e)},function(a,b,c){var d,e;d=[c(1),c(0),c(2),c(3),c(16),c(12),c(4),c(7),c(9),c(13),c(5)],void 0!==(e=function(a,b,c,d,e,f,g,h,i,j,k){"use strict";function l(f,h,k,l){b.isInstanceOf(h,g,"playlist"),b.isInstanceOf(h.parsedPlaylist,j,"playlist.parsedPlaylist"),b.isInstanceOf(k,i,"statsProvider"),b.isStringNotEmpty(h.playlistUrl,"playlist.playlistUrl"),b.isStringNotEmpty(h.baseUrl,"playlist.baseUrl"),l&&l.defaultPresentationDelay&&b.isNumber(l.defaultPresentationDelay,"options.defaultPresentationDelay"),l&&l.targetBufferSizeInMS&&b.isNumber(l.targetBufferSizeInMS,"options.targetBufferSizeInMS"),this._playlist=h,this._baseUrl=this._playlist.baseUrl,this._statsProvider=k,this._logger=f||new c.Logger,this._httpRequestManager=new e(this._logger),this._feederErrorEvent=new d.Event,this._activeTracks=[],this._currentPlaybackTimeInSeconds=0,this._keepFetchingData=!1,this._defaultPresentationDelay=a.get(l,"defaultPresentationDelay",w),this._targetBufferSizeInMS=a.get(l,"targetBufferSizeInMS",0),this._bufferSize=Math.max(this._playlist.getSuggestedPresentationDelayTotalMillis(),this._playlist.getMinBufferTimeTotalMillis(),this._defaultPresentationDelay),this._streamDurationBeforeInitialization=Math.max(this._playlist.getPlaybackDurationSinceAvailable()-this._bufferSize,0),this._timeOfChunkAvailabilityDelta={average:0,values:[],maxSize:10}}function m(c,d,e,f){e=e||a.noop,b.isArray(c,"tracks"),b.isFunction(e,"done");var g=0,i=this;a.forEach(c,function(a){b.isInstanceOf(a,h,"track"),a.setCurrentChunkId(function(a){var b=Math.max(this._targetBufferSizeInMS?this._targetBufferSizeInMS-a:0,0),c=Math.max(Math.floor((this._streamDurationBeforeInitialization-b)/a),0);return"static"===this._playlist.getType()&&(c=0),this._logger.trace("Getting chunk index to start: [%s], playbackTimePassed=[%s], duration=[%s]",c,this._streamDurationBeforeInitialization,a),c}.call(i,a.getChunkDuration())),function(a,b,c){var d=this;(function(a,b){var c=this;c._logger.trace("Fetching init chunk for [%s]: [%s], nextChunkId=[%s]",a.getMseCodec(),c._baseUrl+a.getInitUrl(),a.getCurrentChunkId()),s.call(c,c._baseUrl+a.getInitUrl(),null,500,function(d,e){c._logger.trace("DONE Fetching init chunk for [%s]: [%s], nextChunkId=[%s]",a.getMseCodec(),c._baseUrl+a.getInitUrl(),a.getCurrentChunkId()+(d?": FAILED: "+d.code:": data="+e.data.byteLength)),b(d,e.data)})}).call(d,a,function(e,f){if(e){var g=new Error("Failed to fetch init chunk of stream for config [%s]",a);return g.cause=e,d._logger.error("[%s] (Cause: [%s])",g.message,e),c(g)}if(a.setInitChunkData(f),b){var h=Math.min(Math.floor(d._bufferSize/a.getChunkDuration),1);return d._logger.debug("Got init chunk: data chunksToFetch=[%s], initBufferSize=[%s], chunkDuration=[%s]",h,d._bufferSize,a.getChunkDuration()),r.call(d,a,h,null,c)}c()})}.call(i,a,d,function(a){return a?f(a):void(++g===c.length&&e())})})}function n(){var b=this;a.forEach(b._activeTracks,function(a){a.setCurrentChunkId(o.call(b,a.getChunkDuration()))})}function o(a){var b=a/1e3;return Math.floor(this._currentPlaybackTimeInSeconds/b)}function p(b){var c=this,d=c._activeTracks.length;a.forEach(c._activeTracks,function(e,f){!function(e,f){if(a.find(c._activeTracks,function(a){return a.getMimeType()===e.getMimeType()})===e){var g=o.call(c,e.getChunkDuration()),h=g>=e.getTotalNumberOfChunks();if("static"===c._playlist.getType()&&h)return f===d-1&&(c._keepFetchingData=!1),c._logger.info("Finished getting chunks for [static] track [%s] [%s]",e.getTrackId(),e.getMimeType());a.isNullOrUndefined(b)&&"dynamic"===c._playlist.getType()&&(b=q.call(c,e)),r.call(c,e,1,b,function(a){if(a&&a.causes&&a.causes.length>0&&"not yet available"===a.causes[0].feederReason?c._logger.info("Failed to get next chunk (packet not yet available) for [%s]|[%s]. Trying to fetch again in [%s] ms.",e.getMseCodec(),e.getBandwidth(),v):(a&&c._logger.warn("Failed to get next chunk (# of errors=[%s], errors=[%s]). Moving on.",a.causes?a.causes.length:"n/a",a),d--),d<=0&&c._keepFetchingData){if("dynamic"===c._playlist.getType()){var b=q.call(c,e);return c._logger.debug("Done fetching chunk with index [%s] for each active track. Waiting for [%s] ms before moving on to next chunk.",g,b),p.call(c,b)}c._logger.debug("Done fetching chunk with index [%s] for each active track. Moving on to next chunk",g),p.call(c,null)}})}}(e,f)})}function q(a){var b=1e3*this._currentPlaybackTimeInSeconds+2*a.getChunkDuration()-this._playlist.getPlaybackDurationSinceAvailable(),c=Math.max(b,0);return Math.min(a.getChunkDuration(),c)+this._timeOfChunkAvailabilityDelta.average}function r(a,b,c,d){var e=this;(function(a,b,c){var d=this,e=function(a,b){return a.replace("$Number%05d$",("00000"+b).substr(-5))}(d._baseUrl+a.getDataChunkUrlTemplate(),a.getCurrentChunkId()),f=a.getCurrentChunkId();d._logger.trace("Fetching data chunk for [%s]: [%s], nextChunkId=[%s]",a.getMseCodec(),e,a.getCurrentChunkId());var g=a.getMseCodec();s.call(d,e,b,v,function(h,i){if(d._logger.trace("DONE Fetching data chunk for [%s] : [%s], nextChunkId=[%s]",g,e,a.getCurrentChunkId()+(h?": FAILED: "+h.code:": data="+i.data.byteLength)),!h){d._statsProvider.addRateDataPoint(g,i.stats.successResponseTime,i.data.byteLength,.001);var j=i.stats.totalResponseTimeForAllAttempts-i.stats.successResponseTime-Math.max(b,0);if(d._timeOfChunkAvailabilityDelta.values.push(j),d._timeOfChunkAvailabilityDelta.average=(d._timeOfChunkAvailabilityDelta.average*(d._timeOfChunkAvailabilityDelta.values.length-1)+j)/d._timeOfChunkAvailabilityDelta.values.length,d._timeOfChunkAvailabilityDelta.values.length>d._timeOfChunkAvailabilityDelta.maxSize){var k=d._timeOfChunkAvailabilityDelta.values.shift();d._timeOfChunkAvailabilityDelta.average=(d._timeOfChunkAvailabilityDelta.average*(d._timeOfChunkAvailabilityDelta.values.length+1)-k)/d._timeOfChunkAvailabilityDelta.values.length}}return h||f!==a.getCurrentChunkId()?void(h?(h.feederReason=404===h.code?"not yet available":"other",c(h)):c(null,i.data)):(a.incrementCurrentChunkId(),d._currentPlaybackTimeInSeconds=a.getChunkDuration()*a.getCurrentChunkId()/1e3,a.addDataChunk(i.data,f,function(){c(h)}))})}).call(e,a,c,function(f){return f&&e._logger.trace('Failed to fetch data chunk of stream for config [%s]". Error: [%s]',a,f),!f&&b>1&&r.call(e,a,b,c,d),d(f)})}function s(b,c,d,e){var f=this,g={responseType:"arraybuffer",retryOptions:{delay:d,maxAttempts:u},timeout:x};if(a.isNumber(c)&&0!==c)g.delay=c;else if(!a.isNullOrUndefined(c)&&0!==c)throw new Error('"delay" must be a positive number greater than or equal to 0 or null or undefined');return this._httpRequestManager.getWithRetry(b,g,function(c,d){if(c){if(f._logger.debug("Failed to load next stream data chunk. Status code: [%s] (status text: [%s]) for [%s]",c.code,c.message,b),d&&d.attempts===u){var g="Failed to get chunk with max retries of ["+u+" after ["+a.get(d,["stats","totalResponseTimeForAllAttempts"],0)+"] ms";return f._logger.warn(g),f._feederErrorEvent.fire([t(k.name.chunkNotFound.name,k.severity.CRITICAL,g)])}if(0===c.code){var h="Failed to get chunk with timeout after ["+a.get(d,["stats","totalResponseTimeForAllAttempts"],0)+"] ms with chunk timeout of ["+x+"]";return f._logger.warn(h),f._feederErrorEvent.fire([t(k.name.timeout.name,k.severity.RECOVERABLE,h)])}return f._feederErrorEvent.fire([t(k.name.error.name,k.severity.CRITICAL,c)])}e(c,d)})}function t(a,b,c){return{category:k.category.STREAMING,name:a,severity:b,error:"Error"===c.constructor.name?c:new Error(c)}}var u=15,v=150,w=0,x=5e3;return l.prototype=Object.create(f.prototype),l.prototype.constructor=l,l.prototype.toString=function(){return"MpdPlaylistChunkFeeder [mpdPlaylistUrl="+this._playlist.playlistUrl+", baseUrl="+this._baseUrl+", defaultPresentationDelay="+this._defaultPresentationDelay+"]"},l.prototype.addEventListener=function(a,c){switch(b.isString(a,"eventName"),b.isFunction(c,"listener"),a){case"error":return this._feederErrorEvent.listen(c);default:throw new Error('Event "'+a+'" is unknown.')}},l.prototype.dispose=function(){this.stopRequestingAllData(a.noop),this._httpRequestManager.dispose(),this._playlist.dispose(),this._statsProvider.dispose(),this._feederErrorEvent.dispose(),this._activeTracks=null,this._currentPlaybackTimeInSeconds=0},l.prototype.initialize=function(c,d,e,f,g){var h=this;e=e||a.noop,b.isFunction(e,"done"),this._initializedAt=a.now(),m.call(h,c,!0,e,function(a){return h._logger.error("Unable to initialize active tracks",a),g(a)}),m.call(h,d,!1,f,function(a){return h._logger.error("Unable to initialize alternate tracks",a),g(a)})},l.prototype.getStreamDurationBeforeInitialization=function(){return this._streamDurationBeforeInitialization},l.prototype.getLocalToServerTimeOffset=function(){return this._localToServerTimeOffset},l.prototype.setActiveTracks=function(a){this._activeTracks=a},l.prototype.getActiveTracks=function(){return this._activeTracks},l.prototype.startRequestingDataForActiveTracks=function(){return this.isFetchingData()?this._logger.debug("Unable to start requesting data. Feeder is already fetching data."):(this._keepFetchingData=!0,this._logger.debug("Starting requesting data at timestamp [%s]",this._currentPlaybackTimeInSeconds),n.call(this),p.call(this,null),void 0)},l.prototype.isFetchingData=function(){return this._keepFetchingData},l.prototype.seekToChunk=function(a){this._currentPlaybackTimeInSeconds=Math.floor(a),this._logger.debug("Seeking to timestamp [%s]",this._currentPlaybackTimeInSeconds),n.call(this)},l.prototype.seekToCurrent=function(){var b=a.reduce(this._activeTracks,function(a,b){return b.getChunkDuration()>a?b.getChunkDuration():a},0),c=(Math.max(this._playlist.getPlaybackDurationSinceAvailable()-this._bufferSize,0)-Math.max(this._targetBufferSizeInMS?this._targetBufferSizeInMS-b:0,b))/1e3;return this._logger.info("Seeking to most recent chunk"),this.seekToChunk(c),c},l.prototype.stopRequestingAllData=function(){this._keepFetchingData&&(this._keepFetchingData=!1,this._logger.debug("Pausing requesting of data at timestamp [%s]",this._currentPlaybackTimeInSeconds),this._httpRequestManager.disposePendingRequests())},l}.apply(b,d))&&(a.exports=e)},function(a,b,c){var d,e;d=[c(1),c(0),c(10),c(6)],void 0!==(e=function(a,b,c,d){"use strict";function e(a){b.isObject(a,"logger"),this._logger=a,this._requestDisposables=new d.DisposableList}return e.prototype.toString=function(){return"HttpRequestManager"},e.prototype.disposePendingRequests=function(){this._requestDisposables.dispose(),this._requestDisposables=new d.DisposableList},e.prototype.dispose=function(){this.disposePendingRequests()},e.prototype.getWithRetry=function(d,e,f){b.isStringNotEmpty(d,"url"),b.isObject(e,"options"),b.isFunction(f,"callback");var g=this;e.retryOptions=a.assign({delay:0,backoff:1,maxAttempts:1,additionalRetryErrorCodes:[404,0]},e.retryOptions),this._requestDisposables.add(c.getWithRetry(d,e,function(a,b){return a&&4e3===a.code?g._logger.debug("Request handler disposed of before response received for get [%s]",d):(a&&g._logger.debug("Status code: [%s] (status text: [%s]) for get [%s]",a.code,a.message,d),f(a,b))}))},e}.apply(b,d))&&(a.exports=e)},function(a,b,c){var d,e;d=[c(1),c(0),c(2),c(3),c(16),c(12),c(4),c(7),c(9),c(14),c(5)],void 0!==(e=function(a,b,c,d,e,f,g,h,i,j,k){"use strict";function l(f,h,i,k){b.isInstanceOf(h,g,"playlist"),b.isInstanceOf(h.parsedPlaylist,j,"playlist.parsedPlaylist"),b.isStringNotEmpty(h.playlistUrl,"playlist.playlistUrl"),b.isStringNotEmpty(h.baseUrl,"playlist.baseUrl"),k&&k.targetLatencyInMS&&b.isNumber(k.targetLatencyInMS,"options.targetLatencyInMS"),this._playlist=h,this._baseUrl=this._playlist.baseUrl,this._statsProvider=i,this._logger=f||new c.Logger,this._httpRequestManager=new e(this._logger),this._options=k,this._feederErrorEvent=new d.Event,this._activeTracks=[],this._currentPlaybackTimeInSeconds=0,this._keepFetchingData=!1,this._targetLatencyInMS=a.get(k,"targetLatencyInMS",0),this._targetBufferSizeInMS=a.get(k,"targetBufferSizeInMS",0),this._bufferSize=Math.max(this._playlist.getSuggestedPresentationDelayTotalMillis(),this._playlist.getMinBufferTimeTotalMillis(),this._defaultPresentationDelay),this._streamDurationBeforeInitialization=Math.max(this._playlist.getPlaybackDurationSinceAvailable()-this._bufferSize,0)}function m(){var b=this;a.isNumber(b._mediaSegmentRequestTimeout)||(b._mediaSegmentRequestTimeout=setTimeout(function(){(function(b){var c=this,d=0;a.forEach(this._activeTracks,function(e){var f=e.getMediaSegmentPlaylistUrlInfo(),g=a.assign({version:a.now()},f.queryParameters),h={retryOptions:{delay:t,maxAttempts:u},queryParameters:g};c._httpRequestManager.getWithRetry(f.url,h,function(a,g){return a?c._logger.debug("Unable to get media segment playlist [%s]",f.url):(g&&e.updateMediaSegments(g),void(++d===c._activeTracks.length&&b()))})},s)}).call(b,function(){a.isNullOrUndefined(b._mediaSegmentRequestTimeout)||(b._mediaSegmentRequestTimeout=null,m.call(b))})},s))}function n(b){var c=this,d=c._activeTracks.length;c._waitingForNextSegment=!1,a.forEach(c._activeTracks,function(e,f){!function(e){a.find(c._activeTracks,function(a){return a.getMimeType()===e.getMimeType()})!==e?c._logger.debug("Wrong track type [%s]. Pausing fetching for track [%s]",e.getMimeType(),e.getTrackId()):e.isLastMediaSegment(c._currentPlaybackTimeInSeconds)?("dynamic"===c._playlist.getType()&&(c._waitingForNextSegment=!0),c._logger.debug("No more chunks. Pausing fetching for track [%s]",e.getMimeType(),e.getTrackId())):o.call(c,e,1,b,function(a){if(a&&a.causes&&a.causes.length>0&&"not yet available"===a.causes[0].feederReason?c._logger.info("Failed to get next chunk (packet not yet available) for [%s]|[%s]. Trying to fetch again in [%s] ms.",e.getMseCodec(),e.getBandwidth(),r):(a&&c._logger.warn("Failed to get next chunk (# of errors=[%s], errors=[%s]). Moving on.",a.causes?a.causes.length:"n/a",JSON.stringify(a)),d--),d<=0){c._logger.debug("Done fetching chunk for timestamp [%s] for each active track. Moving on to next chunk. (keep fetching=[%s])",c._currentPlaybackTimeInSeconds,c._keepFetchingData);var b=e.isLastMediaSegment(c._currentPlaybackTimeInSeconds);if("static"===c._playlist.getType()&&b)return c._keepFetchingData=!1,c._logger.info("Finished getting chunks for [static] track [%s] [%s]",e.getTrackId(),e.getMimeType());
if(b)return c._waitingForNextSegment=!0,c._logger.debug("Waiting for new segment on the Segment Playlist for [dynaimic] track [%s] [%s]",e.getTrackId(),e.getMimeType());c._keepFetchingData&&n.call(c,null)}})}(e)})}function o(b,c,d,e){var f=this;(function(b,c,d){var e=this,f=b.getSegmentByTimestamp(e._currentPlaybackTimeInSeconds),g=e._baseUrl+f.name;e._logger.trace("Fetching data chunk for [%s]: [%s], next segment=[%s]",b.getMseCodec(),g,f.name);var h=b.getMseCodec();(function(b,c,d){var e=this,f={responseType:"arraybuffer",retryOptions:{delay:r,maxAttempts:q},timeout:v};if(a.isNumber(c))f.delay=c;else if(!a.isNullOrUndefined(c))throw new Error('"delay" must be a number or null or undefined');return this._httpRequestManager.getWithRetry(b,f,function(c,f){if(c){if(e._logger.debug("Failed to load next stream data chunk. Status code: [%s] (status text: [%s]) for [%s]",c.code,c.message,b),f&&f.attempts===q){var g="Failed to get chunk with max retries of ["+q+" after ["+a.get(f,["stats","totalResponseTimeForAllAttempts"],0)+"] ms";return e._feederErrorEvent.fire([p(k.name.chunkNotFound.name,k.severity.CRITICAL,g)])}if(0===c.code){var h="Failed to get chunk with timeout after ["+a.get(f,["stats","totalResponseTimeForAllAttempts"],0)+"] ms with chunk timeout of ["+v+"]";return e._feederErrorEvent.fire([p(k.name.timeout.name,k.severity.RECOVERABLE,h)])}return e._feederErrorEvent.fire([p(k.name.error.name,k.severity.CRITICAL,c)])}d(c,f)})}).call(e,g,c,function(a,c){return e._logger.trace("DONE Fetching data chunk for [%s] : [%s], next segment=[%s]",h,g,f.name+(a?": FAILED: "+a.code:": data="+c.data.byteLength)),a||e._statsProvider.addRateDataPoint(h,c.stats.successResponseTime,c.data.byteLength,.001),a?void(a?(a.feederReason=404===a.code?"not yet available":"other",d(a)):d(null,c.data)):(e._logger.debug("Finished fetching [%s]. Updating timestamp to fetch to [%s]",f.name,f.timestamp+f.duration),e._currentPlaybackTimeInSeconds=f.timestamp+f.duration,b.addDataChunk(c.data,f.name,function(){d(a)}))})}).call(f,b,d,function(a){return a&&f._logger.trace('Failed to fetch data chunk of stream for config [%s]". Error: [%s]',JSON.stringify(b),a),!a&&c>1&&o.call(f,b,c,d,e),e(a)})}function p(a,b,c){return{category:k.category.STREAMING,name:a,severity:b,error:"Error"===c.constructor.name?c:new Error(c)}}var q=15,r=700,s=200,t=10,u=2,v=5e3;return l.prototype=Object.create(f.prototype),l.prototype.constructor=l,l.prototype.toString=function(){return"M3u8PlaylistChunkFeeder [mpdPlaylistUrl="+this._playlist.playlistUrl+", baseUrl="+this._baseUrl+", defaultPresentationDelay="+this._defaultPresentationDelay+"]"},l.prototype.addEventListener=function(a,c){switch(b.isString(a,"eventName"),b.isFunction(c,"listener"),a){case"error":return this._feederErrorEvent.listen(c);default:throw new Error('Event "'+a+'" is unknown.')}},l.prototype.dispose=function(){this.stopRequestingAllData(a.noop),this._httpRequestManager.dispose(),this._playlist.dispose(),this._statsProvider.dispose(),this._activeTracks=null,this._currentPlaybackTimeInSeconds=0,this._segmentsReadyDisposable&&(this._segmentsReadyDisposable.dispose(),this._segmentsReadyDisposable=null)},l.prototype.initialize=function(c,d,e,f,g){e=e||a.noop,b.isFunction(e,"done"),this.setActiveTracks(c),"dynamic"===this._playlist.getType()&&m.call(this);var h=this,i=0,j=function(b){o.call(h,b,1,null,function(b){return b?g(b):void(++i===c.length&&(h._initializedAt=a.now(),e(),f()))})};a.forEach(c,function(a){return h._segmentsReadyDisposable=a.addEventListener("segmentsready",function(){if(h._waitingForNextSegment){if(h._logger.debug("Continuing fetching of track [%s] segments after wait",a.getTrackId()),!h._initializedAt)return h.seekToCurrent(),j(a);n.call(h,null)}}),a.hasSegments()?j(a):h._waitingForNextSegment=!0})},l.prototype.getStreamDurationBeforeInitialization=function(){return this._streamDurationBeforeInitialization},l.prototype.getLocalToServerTimeOffset=function(){return this._localToServerTimeOffset},l.prototype.setActiveTracks=function(b){this._activeTracks=b;var c=a.map(b,function(a){return a.getTrackId()});this._logger.debug("Setting active tracks [%s]",c)},l.prototype.getActiveTracks=function(){return this._activeTracks},l.prototype.startRequestingDataForActiveTracks=function(){return this.isFetchingData()?this._logger.debug("Unable to start requesting data. Feeder is already fetching data."):(this._keepFetchingData=!0,this._logger.debug("Starting requesting data at timestamp [%s]",this._currentPlaybackTimeInSeconds),"dynamic"===this._playlist.getType()&&m.call(this),n.call(this,null),void 0)},l.prototype.isFetchingData=function(){return this._keepFetchingData},l.prototype.seekToChunk=function(b){var c=a.get(this._activeTracks,["0"]),d=c.getClosestSegmentNotGreaterThanTimestamp(b),e=a.get(d,["timestamp"]);a.isUndefined(e)?c||(this._currentPlaybackTimeInSeconds=b):this._currentPlaybackTimeInSeconds=Math.floor(d.timestamp),this._logger.debug("Seeking to timestamp [%s]",this._currentPlaybackTimeInSeconds)},l.prototype.seekToCurrent=function(){var b=a.reduce(this._activeTracks,function(b,c){var d=a.get(c.getLastSegment(),["duration"],0);return d>b?d:b},0),c=(a.reduce(this._activeTracks,function(a,b){var c=b.getLastSegment().timestamp;return c<a?c:a},0)-Math.max(this._targetBufferSizeInMS?this._targetBufferSizeInMS-b:0,b))/1e3;return this._logger.info("Seeking to most recent chunk"),this.seekToChunk(c),c},l.prototype.stopRequestingAllData=function(){this._keepFetchingData&&(this._keepFetchingData=!1,this._waitingForNextSegment=!1,this._logger.debug("Pausing requesting of data at timestamp [%s]",this._currentPlaybackTimeInSeconds),this._httpRequestManager.disposePendingRequests(),clearTimeout(this._mediaSegmentRequestTimeout),this._mediaSegmentRequestTimeout=null)},l}.apply(b,d))&&(a.exports=e)},function(a,b,c){var d,e;d=[c(1),c(0),c(2),c(3),c(10),c(6),c(11),c(8),c(5)],void 0!==(e=function(a,b,c,d,e,f,g,h,i){"use strict";function j(e,g,j,l){b.isObject(g,"videoElement");var A=this;this._videoElement=g,this._logger=e||new c.Logger,this._mediaKeys=null,this._licenseRequestRetryTimeout=null,this._certificateRequestRetryTimeout=null,this._disposables=new f.DisposableList;var B=a.bind(z,this);"Safari"===p.browser&&(B=a.bind(function(b,c){var d=this;if(c=c||1,!this._fairplayServerCertificate){if(c<=w)return d._logger.debug("Attempt [%s] for checking if the certificate have been set",c),void(d._certificateRequestRetryTimeout=setTimeout(function(){z.call(d,b,c+1)},v));var e="Unable to find fairplay certificate after "+(c-1)+" attempts";return d._logger.warn(e),d._drmErrorEvent.fire([o("NoCertificate",i.severity.RECOVERABLE,e)])}this._logger.info("Key requested by Webkit browser"),d._fallbackLicenseUri=function(a){return"https://"+function(a){return String.fromCharCode.apply(null,new h.global.Uint16Array(a.buffer))}(a).split("skd://")[1]}(b.initData);var g="phenix-fairplay-"+a.now(),j=function(a,b,c){var d=function(a){for(var b=new h.global.ArrayBuffer(2*a.length),c=new h.global.Uint16Array(b),d=0,e=a.length;d<e;d++)c[d]=a.charCodeAt(d);return c}(b),e=0,f=new h.global.ArrayBuffer(a.byteLength+4+d.byteLength+4+c.byteLength),g=new h.global.DataView(f);new Uint8Array(f,e,a.byteLength).set(a),e+=a.byteLength,g.setUint32(e,d.byteLength,!0),e+=4;var i=new h.global.Uint16Array(f,e,d.length);return i.set(d),e+=i.byteLength,g.setUint32(e,c.byteLength,!0),e+=4,new Uint8Array(f,e,c.byteLength).set(c),new Uint8Array(f,0,f.byteLength)}(b.initData,g,d._fairplayServerCertificate);if(d._videoElement.webkitKeys||d._videoElement.webkitSetMediaKeys(new h.global.WebKitMediaKeys(t)),!d._videoElement.webkitKeys)return d._drmErrorEvent.fire([o("webkitKeys",i.severity.RECOVERABLE,new Error("Could not create MediaKeys"))]);var l=d._videoElement.webkitKeys.createSession("video/mp4",j);if(!l)return d._drmErrorEvent.fire([o("webkitKeySession",i.severity.RECOVERABLE,new Error("Could not create key session"))]);var m=a.bind(k,d);l.addEventListener("webkitkeymessage",m,!1),d._disposables.add(new f.Disposable(function(){l.removeEventListener("webkitkeymessage",m,!1)}));var n=function(){d._logger.info("Decryption key was added")};l.addEventListener("webkitkeyadded",n,!1),d._disposables.add(new f.Disposable(function(){l.removeEventListener("webkitkeyadded",n,!1)}));var p=function(a){d._drmErrorEvent.fire([o("webkitkeyerror",i.severity.RECOVERABLE,a)])};l.addEventListener("webkitkeyerror",p,!1),d._disposables.add(new f.Disposable(function(){l.removeEventListener("webkitkeyerror",p,!1)}))},this)),this._videoElement.addEventListener(y,B,!1),this._disposables.add(new f.Disposable(function(){A._videoElement.removeEventListener(y,B,!1)})),this._disposables.add(new f.Disposable(function(){null!==A._licenseRequestRetryTimeout&&h.global.clearTimeout(A._licenseRequestRetryTimeout)})),this._disposables.add(new f.Disposable(function(){null!==A._certificateRequestRetryTimeout&&h.global.clearTimeout(A._certificateRequestRetryTimeout)})),this._defaultMediaKeySystemConfig={initDataTypes:["cenc"],videoCapabilities:[{contentType:'video/mp4; codecs="avc1.42c01f"'}],audioCapabilities:[{contentType:'audio/mp4; codecs="mp4a.40.2"'}],persistentState:"optional",distinctiveIdentifier:"optional"},this._config={},"Edge"===p.browser||"IE"===p.browser?this._selectedKeySystem=r:"Safari"===p.browser?this._selectedKeySystem=t:this._selectedKeySystem=q,function(b,c){var d=this,e=function(b){return a.keys(a.reduce(b,function(a,b){return a[b]=1,a},{}))}(a.keys(b).concat(a.keys(c)));a.forEach(e,function(e){a.set(d._config,[e],a.assign({},a.get(b,[e],{}),a.get(c,[e],{}))),a.set(d._config,[e,"mediaKeySystemConfiguration"],a.assign({},d._defaultMediaKeySystemConfig,a.get(b,[e,"mediaKeySystemConfiguration"],{}),a.get(c,[e,"mediaKeySystemConfiguration"],{})))})}.call(this,function(b){return a.reduce(b,function(b,c){var d="com.phenixp2p.widevine"===c.schemeIdUri||"com.phenixrts.widevine"===c.schemeIdUri?q:c.schemeIdUri===s?r:c.schemeIdUri;return b[d]={licenseServerUrl:"com.phenixp2p.widevine"===c.schemeIdUri||"com.phenixrts.widevine"===c.schemeIdUri?decodeURIComponent(c.widevineLicenseServerUrl):c.licenseServerUrl,serverCertificateUrl:c.serverCertificateUrl},a.forOwn(c,function(c,e){a.startsWith(e,"mediaKeySystemConfiguration.")&&a.set(b[d],e,c)}),b},{})}(j),l||{}),function(){b.isObject(this._config,"this._config");var c=this;a.forOwn(this._config,function(a,d){b.isValidType(d,u,d),d===c._selectedKeySystem&&(d!==q&&d!==t||b.isStringNotEmpty(a.serverCertificateUrl,d+"[serverCertificateUrl]"),b.isObject(a.mediaKeySystemConfiguration,d+"[mediaKeySystemConfiguration]"),b.isArrayOfString(a.mediaKeySystemConfiguration.initDataTypes,d+"[mediaKeySystemConfiguration][initDataTypes]"),b.isArray(a.mediaKeySystemConfiguration.videoCapabilities,d+"[mediaKeySystemConfiguration][videoCapabilities]"),b.isArray(a.mediaKeySystemConfiguration.audioCapabilities,d+"[mediaKeySystemConfiguration][audioCapabilities]"),b.isStringNotEmpty(a.mediaKeySystemConfiguration.persistentState,d+"[mediaKeySystemConfiguration][persistentState]"),b.isStringNotEmpty(a.mediaKeySystemConfiguration.distinctiveIdentifier,d+"[mediaKeySystemConfiguration][distinctiveIdentifier]"))})}.call(this),this._drmErrorEvent=new d.Event,this._drmTrackEventRestrictionsAvailableEvent=new d.Event,this._disposables.add(this._drmErrorEvent),this._disposables.add(this._drmTrackEventRestrictionsAvailableEvent),x&&function(){var b=this;if(!this._videoElement.mediaKeys){var c=a.get(this._config,[this._selectedKeySystem,"mediaKeySystemConfiguration"]);h.global.navigator.requestMediaKeySystemAccess(this._selectedKeySystem,[c]).then(function(c){c.createMediaKeys()["catch"](function(a){b._drmErrorEvent.fire([o("CreateMediaKeys",i.severity.CRITICAL,a)]),b._logger.error("Unable to create MediaKeys",a)}).then(function(a){return b._mediaKeys=a,b._videoElement.setMediaKeys(a)})["catch"](function(a){b._drmErrorEvent.fire([o("SetMediaKeys",i.severity.CRITICAL,a)]),b._logger.error("Unable to set MediaKeys",a)}).then(function(){return new h.global.Promise(function(c){var d=a.get(b._config,[b._selectedKeySystem,"serverCertificateUrl"]);return d?void m(d,function(a,d){if(a)return b._logger.warn("Failed to get service certificate",a),c();var e=n(d.data);return b._mediaKeys.setServerCertificate(e).then(c)["catch"](function(a){b._logger.warn("Failed to set service certificate",a)})}):(b._logger.info("Not fetching server certificate because [%s] -> [serverCertificateUrl] is not set",b._selectedKeySystem),c())})})})["catch"](function(a){b._drmErrorEvent.fire([o("RequestMediaKeySystemAccess",i.severity.CRITICAL,a)]),b._logger.error("Unable to request MediaKeySystemAccess with error [%s]",a)})}}.call(this),"Safari"===p.browser&&(h.global.WebKitMediaKeys.isTypeSupported("com.apple.fps.1_0","video/mp4")||A._drmErrorEvent.fire([o("isTypeSupported",i.severity.CRITICAL,new Error("com.apple.fps.1_0 Key System not supported"))]),m(a.get(A._config,[A._selectedKeySystem,"serverCertificateUrl"]),function(a,b){a&&(A._drmErrorEvent.fire([o("getServerCertificateFairplay",i.severity.CRITICAL,a)]),A._logger.error("[Fairplay] Failed to get service certificate",a)),A._fairplayServerCertificate=n(b.data)}))}function k(a){var b=this,c=a.target;l.call(this,a.message,function(a,d){if(a)return b._drmErrorEvent.fire([o("LicenseRetrieval",i.severity.RECOVERABLE,a)]);try{var e=c.update(d)}catch(f){return b._drmErrorEvent.fire([o("KeySessionUpdate",i.severity.CRITICAL,f)])}f.isFunction(f.get(e,["catch"]))&&e["catch"](function(a){b._drmErrorEvent.fire([o("KeySessionUpdate",i.severity.CRITICAL,a)]),b._logger.error("Update of keySession with license failed [%s]",a)})})}function l(c,d){var f,g=this,i=a.get(this._config,[this._selectedKeySystem,"licenseServerUrl"],this._fallbackLicenseUri),j={};if(b.isStringNotEmpty(i,"licenseServerUrl"),this._selectedKeySystem===r){var k=(new DOMParser).parseFromString(String.fromCharCode.apply(null,new h.global.Uint16Array(c)),"application/xml");if(!k.getElementsByTagName("Challenge")[0])return d(new Error("[Playready] Cannot find `challenge` in key message"));f=atob(k.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue);var l=k.getElementsByTagName("name"),m=k.getElementsByTagName("value");if(l.length!==m.length)return d(new Error("[Playready] Mismatched header name/value pair in key message"));j.headers={};for(var n=0;n<l.length;n++){var o=a.get(l,[n,"childNodes",0,"nodeValue"]),p=a.get(m,[n,"childNodes",0,"nodeValue"]);o&&p&&(j.headers[o]=p)}j.responseType="arraybuffer"}else j.contentType="application/octet-stream",f=c;e.post(i,f,j,function(a,b){if(a)return g._logger.error("Failed to get license with [%s] [%s]",a,b),d(a);if(g._selectedKeySystem===r)return d(null,b.data);var c=b.data,e=null,f=null;try{g._logger.debug("Attempting to unwrap license response"),e=(c=JSON.parse(c)).license||c.ckc,c.trackRestrictions&&g._drmTrackEventRestrictionsAvailableEvent.fire([c.trackRestrictions])}catch(a){if(!(a instanceof SyntaxError))return g._logger.error("Unexpected error [%s]",a),d(a);g._logger.debug("Unwrapping of license failed. Assuming that license response is already unwrapped"),e=c}"<ckc>"===e.substr(0,5)&&"</ckc>"===e.substr(-6)&&(e=e.slice(5,-6));try{f=function(a){for(var b=h.global.atob(a),c=new Uint8Array(b.length),d=0;d<b.length;++d)c[d]=b.charCodeAt(d);return c}(e)}catch(a){g._logger.error("Failed to convert base64 license string [%s] to binary",e),d(a)}d(null,f)})}function m(a,b){e.get(a,{mimeType:"text/plain; charset=x-user-defined"},b)}function n(a){for(var b=a.length,c=new h.global.Uint8Array(b),d=0;d<b;d++)c[d]=a.charCodeAt(d);return c}function o(a,b,c){return{category:i.category.DRM,name:a,severity:b,error:"Error"===c.constructor.name?c:new Error(c)}}var p=new g(h.global.navigator.userAgent).detect(),q="com.widevine.alpha",r="com.microsoft.playready",s="urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95",t="com.apple.fps.1_0",u=a.freeze([{id:1,name:"org.w3.clearkey"},{id:2,name:q},{id:3,name:r},{id:4,name:s},{id:5,name:t}]),v=200,w=20,x=!!h.global.navigator.requestMediaKeySystemAccess,y="encrypted";x||"Edge"!==p.browser&&"IE"!==p.browser||(y="msneedkey"),"Safari"===p.browser&&(y="webkitneedkey"),j.isSupported=function(){return!(("IE"!==p.browser||11!==p.version)&&("Safari"===p.browser?a.isNullOrUndefined(h.global.WebKitMediaKeys)||a.isNullOrUndefined(h.global.Uint16Array)||a.isNullOrUndefined(h.global.Uint8Array)||a.isNullOrUndefined(h.global.ArrayBuffer)||a.isNullOrUndefined(h.global.DataView):a.isNullOrUndefined(h.global.navigator.requestMediaKeySystemAccess)||a.isNullOrUndefined(h.global.Promise)||a.isNullOrUndefined(h.global.Uint8Array)||a.isNullOrUndefined(h.global.atob)))},j.prototype.addEventListener=function(a,c){switch(b.isString(a,"eventName"),b.isFunction(c,"listener"),a){case"trackRestrictionsAvailable":return this._drmTrackEventRestrictionsAvailableEvent.listen(c);case"error":return this._drmErrorEvent.listen(c);default:throw new Error('Event "'+a+'" is unknown.')}},j.prototype.toString=function(){return"EncryptedMediaHandler [config="+JSON.stringify(this._config)+"]"},j.prototype.dispose=function(){this._disposables.dispose(),delete this._mediaKeys};var z=function(b,c){var d=this;if(c=c||1,!x)try{this._videoElement.msSetMediaKeys(new h.global.MSMediaKeys(this._selectedKeySystem))}catch(e){return d._drmErrorEvent.fire([o("RequestMediaKeySystemAccess",i.severity.CRITICAL,new Error('Unable to create MediaKeys ("'+this._selectedKeySystem+'"). Error: '+e.message))])}if(!this._mediaKeys&&!d._videoElement.msKeys){if(c<=20)return d._logger.debug("Attempt [%s] for checking if the media keys have been set",c),void(d._licenseRequestRetryTimeout=setTimeout(function(){z.call(d,b,c+1)},v));var e="Unable to find media keys after "+(c-1)+" attempts";return d._logger.warn(e),d._drmErrorEvent.fire([o("NoMediaKeys",i.severity.RECOVERABLE,e)])}if(d._videoElement.msKeys){var g=d._videoElement.msKeys.createSession("video/mp4",b.initData);g||d._drmErrorEvent.fire([o("NoKeySession",i.severity.CRITICAL,new Error("Could not create key session"))]);var j=function(a){l.call(d,a.message.buffer,function(a,b){return a?d._drmErrorEvent.fire([o("getLicense",i.severity.RECOVERABLE,a)]):void g.update(new Uint8Array(b))})};g.addEventListener("mskeymessage",j,!1),d._disposables.add(new f.Disposable(function(){g.removeEventListener("mskeymessage",j,!1)}));var m=function(){d._drmErrorEvent.fire([o("MicrosoftKeyError",i.severity.CRITICAL,new Error("Unexpected `keyerror` event from key session. Code: "+g.error.code+", systemCode: "+g.error.systemCode))])};return g.addEventListener("mskeyerror",m,!1),void d._disposables.add(new f.Disposable(function(){g.removeEventListener("mskeyerror",m,!1)}))}var n=d._mediaKeys.createSession(),p=a.bind(k,d);return n.addEventListener("message",p,!1),d._disposables.add(new f.Disposable(function(){n.removeEventListener("message",p,!1)})),n.generateRequest(b.initDataType,b.initData).then(function(){d._logger.info("passing the media data to CDM")})["catch"](function(a){d._drmErrorEvent.fire([o("InitKeySessionFailure",i.severity.CRITICAL,a)]),d._logger.error("Unable to create or initialize key session [%s]",a)})};return j}.apply(b,d))&&(a.exports=e)},function(a,b){a.exports=i},function(a,b,c){var d,e;d=[c(1),c(0),c(2),c(6),c(19),c(4),c(9)],void 0!==(e=function(a,b,c,d,e,f,g){"use strict";function h(h,m,q,r){b.isInstanceOf(m,f,"playlist"),b.isNotUndefined(q,"webPlayer"),b.isInstanceOf(r,g,"statsProvider"),this._playlist=m,this._webPlayer=q,this._statsProvider=r,this._logger=h||new c.Logger,this._bandwidthChangeDetails={nextSwitchCheckTime:a.now()+5e3,oldBandwidth:-1},this._disposables=new d.DisposableList,this._webPlayer.addEventListener("started",a.bind(function(){var b=this;this._bandwidthLimits=a.reduce(this._playlist.getMimeTypes(),function(c,d){var e=b._playlist.getPlaylistTracksByMimeType(d)||[],f=a.filter(e,function(b){return a.isNumber(b.getBandwidth())}),g=a.map(f,function(a){return a.getBandwidth()});return e.length>f.length&&b._logger.info("Excluding [%s] tracks without Bandwidth from ABR switching.",e.length-f.length),c[d]={max:Math.max.apply(null,g),min:Math.min.apply(null,g)},c},{}),this._logger.debug("Listening for bandwidth changes with max and min bandwidths of [%s]",this._bandwidthLimits),this._webPlayer.addEventListener("playbacktimeleft",a.bind(function(b,c){if(!this._bandwidthChangeDetails.isInProgress&&e.isForeground()){var d=this._bandwidthLimits[c.getMimeType()],f=this;if(this._bandwidthChangeDetails.nextSwitchCheckTime>0){if(this._bandwidthChangeDetails.nextSwitchCheckTime>a.now())return;this._bandwidthChangeDetails.nextSwitchCheckTime=0,this._bandwidthChangeDetails.oldBandwidth=-1}var g=a.bind(function(){this._bandwidthChangeDetails.isInProgress=!1},this);if(i.call(f,c,b)&&c.getBandwidth()<d.max){this._bandwidthChangeDetails.isInProgress=!0;var h=this._playlist.getPlaylistTrackByMimeTypeAndNextHighestBandwidth(c.getBandwidth(),c.getMimeType());this._playbackTimeout=setTimeout(function(){i.call(f,c,f._webPlayer.getTimeLeft())?(f._logger.info("Switching to higher quality track with [%s] time left in buffer and ewma of [%s].",f._webPlayer.getTimeLeft(),k.call(f,c)),f._bandwidthChangeDetails.nextSwitchCheckTime=a.now()+1e3*b+n,f._bandwidthChangeDetails.oldBandwidth=c.getBandwidth(),f._webPlayer.changeBandwidthLimit(h.getBandwidth(),g)):f._bandwidthChangeDetails.isInProgress=!1},p)}else if(j.call(f,c,b)&&c.getBandwidth()>d.min){this._bandwidthChangeDetails.isInProgress=!0;var l=this._playlist.getPlaylistTrackByBandwidthAndMimeType(c.getBandwidth()-1,c.getMimeType());this._playbackTimeout=setTimeout(function(){j.call(f,c,f._webPlayer.getTimeLeft())?(f._logger.info("Switching to lower quality track with [%s] time left in buffer and ewma of [%s].",f._webPlayer.getTimeLeft(),k.call(f,c)),f._bandwidthChangeDetails.nextSwitchCheckTime=a.now()+1e3*b+o,f._bandwidthChangeDetails.oldBandwidth=c.getBandwidth(),f._webPlayer.changeBandwidthLimit(l.getBandwidth(),g)):f._bandwidthChangeDetails.isInProgress=!1},p)}}},this))},this)),this._disposables.add(e.onBackground(a.bind(l,this,!1))),this._disposables.add(e.onForeground(a.bind(l,this,!0))),this._backgroundTimeout=null,this._foregroundBandwidth=null}function i(a,b){var c=this._statsProvider.getRateAverages(a.getMseCodec()).ewmaDuration,d=a.getChunkDuration();return b>3.5||c>0&&c<=3*d/4&&b/(d/1e3)>2}function j(a,b){var c=this._statsProvider.getRateAverages(a.getMseCodec()).ewmaDuration,d=a.getChunkDuration();return b<.7||c>0&&c>=7*d/8&&b/(d/1e3)<=1.5}function k(a){return this._statsProvider.getRateAverages(a.getMseCodec()).ewmaDuration}function l(b){null!==this._playbackTimeout&&(clearTimeout(this._playbackTimeout),this._playbackTimeout=null);var c=this._webPlayer.getVideoElement();if(b){if(clearTimeout(this._backgroundTimeout),this._backgroundTimeout=null,null===this._foregroundBandwidth)return;var d=this._foregroundBandwidth;return this._foregroundBandwidth=null,d!==this._webPlayer.getBandwidthLimit()&&(this._bandwidthChangeDetails.nextSwitchCheckTime=a.now()+n,this._logger.info("Detected change to [foreground] for tab. Reverting to [%s] previous bandwidth limit from [%s]",d,this._webPlayer.getBandwidthLimit()),this._webPlayer.changeBandwidthLimit(d)),void(m(c)||"dynamic"!==this._playlist.getType()||(this._logger.info("Detecting application [foreground] with muted video. Resuming playback at most recent available chunk."),this._webPlayer.play()))}var f=this;this._backgroundTimeout=setTimeout(function(){e.isForeground()||(f._foregroundBandwidth=f._webPlayer.getBandwidthLimit(),m(c)||"dynamic"!==f._playlist.getType()||(f._logger.info("Detecting application [background] with muted video. Pausing playback until application focused again."),f._webPlayer.pause()))},q)}function m(b){return!b.muted&&0!==b.volume&&(a.get(b,["webkitAudioDecodedByteCount"],0)>0||a.get(b,["audioTracks","length"],0)>0||b.mozHasAudio||b.hasAudio||b.webkitHasAudio)}var n=15e3,o=5e3,p=500,q=3e3;return h.prototype.dispose=function(){null!==this._playbackTimeout&&clearTimeout(this._playbackTimeout),null!==this._backgroundTimeout&&clearTimeout(this._backgroundTimeout),this._disposables.dispose(),this._backgroundTimeout=null,this._playbackTimeout=null},h}.apply(b,d))&&(a.exports=e)},function(a,b,c){"use strict";var d,e;d=[c(4),c(15),c(17),c(27),c(9),c(20),c(5)],void 0!==(e=function(a,b,c,d,e,f,g){return{Playlist:a,MpdPlaylistChunkFeeder:b,M3u8PlaylistChunkFeeder:c,WebPlayer:d,StatsProvider:e,AdaptiveStreamingManager:f,isSupported:d.isSupported,errors:g}}.apply(b,d))&&(a.exports=e)},function(a,b,c){var d,e;d=[c(0),c(3),c(2),c(7)],void 0!==(e=function(a,b,c,d){"use strict";function e(d,e,h){if(a.isObject(d,"logger"),a.isObject(e,"playlistTrackConfig"),a.isStringNotEmpty(e.codec,"playlistTrackConfig.codec"),a.isStringNotEmpty(e.mimeType,"playlistTrackConfig.mimeType"),a.isNumber(e.bandwidth,"playlistTrackConfig.bandwidth"),a.isNumber(e.chunkDuration,"playlistTrackConfig.chunkDuration"),a.isStringNotEmpty(e.trackId,"playlistTrackConfig.trackId"),a.isStringNotEmpty(e.initUrl,"playlistTrackConfig.initUrl"),a.isStringNotEmpty(e.dataChunkUrlTemplate,"playlistTrackConfig.dataChunkUrlTemplate"),a.isNumber(e.chunkDuration,"playlistTrackConfig.chunkDuration"),h=h||{},this._logger=d||new c.Logger,this._mseCodec=e.codec,this._chunkDuration=e.chunkDuration,this._bandwidth=e.bandwidth,this._height=e.height,this._trackId=e.trackId,this._mimeType=e.mimeType,this._initUrl=e.initUrl,this._dataChunkUrlTemplate=e.dataChunkUrlTemplate,this._totalNumberOfChunks=e.totalNumberOfChunks,this._currentChunkId=null,this._maxChunksToCache=h.maxChunksToCache||f,this._lowWaterMaxChunks=h.lowWaterMaxChunks||g,a.isNumber(this._maxChunksToCache,"options.maxChunksToCache"),a.isNumber(this._lowWaterMaxChunks,"options.lowWaterMaxChunks"),this._lowWaterMaxChunks>=this._maxChunksToCache)throw new Error('The "maxChunksToCache" cannot be less than or equal to the "lowWaterMaxChunks"');this._initChunk=null,this._dataChunks=[],this._chunkAddedEvent=new b.Event}var f=20,g=15;return e.prototype=Object.create(d.prototype),e.prototype.constructor=e,e.prototype.toString=function(){return"MpdPlaylistTrack [mseCodec="+this._mseCodec+", maxChunksToCache="+this._maxChunksToCache+", lowWaterMaxChunks="+this._lowWaterMaxChunks+", initChunk="+this._initChunk+", dataChunks(size)="+this._dataChunks.length+", chunkAddedEvent(size)="+this._chunkAddedEvent.size()+", trackId="+(this._trackId?this._trackId:"n/a")+", bandwidth="+(this.bandwidth?this.bandwidth:"n/a")+"]"},e.prototype.dispose=function(){this._dataChunks=[],this._chunkAddedEvent.dispose()},e.prototype.getMseCodec=function(){return this._mseCodec},e.prototype.getTrackId=function(){return this._trackId},e.prototype.getChunkDuration=function(){return this._chunkDuration},e.prototype.getBandwidth=function(){return this._bandwidth},e.prototype.getHeight=function(){return this._height},e.prototype.getMimeType=function(){return this._mimeType},e.prototype.getTotalNumberOfChunks=function(){return this._totalNumberOfChunks},e.prototype.getInitChunkData=function(){return this._initChunk},e.prototype.setInitChunkData=function(a){this._initChunk=a},e.prototype.getCurrentChunkId=function(){return this._currentChunkId},e.prototype.setCurrentChunkId=function(a){this._currentChunkId=a},e.prototype.incrementCurrentChunkId=function(){null===this._currentChunkId&&this._logger.error("[%s] Attempting to increment `CurrentChunkId` that is not initialized",this._trackId),this._currentChunkId++},e.prototype.getInitUrl=function(){return this._initUrl},e.prototype.getDataChunkUrlTemplate=function(){return this._dataChunkUrlTemplate},e.prototype.addDataChunk=function(b,c,d){a.isNotUndefined(b,"dataChunk"),d=d||function(){},a.isFunction(d,"eventCallback");var e={data:b,chunkId:c,timestamp:c*this._chunkDuration/1e3};if(this._dataChunks.push(e),this._dataChunks.length>this._maxChunksToCache)for(;this._dataChunks.length>this._lowWaterMaxChunks;)this._dataChunks.shift();this._chunkAddedEvent.fireAsync([e],this,d)},e.prototype.getChunks=function(){return this._dataChunks},e.prototype.addEventListener=function(b,c){if(a.isString(b,"eventName"),a.isFunction(c,"listener"),"chunkadded"!==b)throw new Error('Event "'+b+'" is unknown.');return this._chunkAddedEvent.listen(c)},e}.apply(b,d))&&(a.exports=e)},function(a,b,c){var d,e;d=[c(1),c(0),c(3),c(2),c(7),c(24)],void 0!==(e=function(a,b,c,d,e,f){"use strict";function g(e,f,g){if(b.isObject(e,"logger"),b.isObject(f,"playlistTrackConfig"),b.isStringNotEmpty(f.codecs,"playlistTrackConfig.codecs"),b.isNumber(f.bandwidth,"playlistTrackConfig.bandwidth"),b.isStringNotEmpty(f.trackId,"playlistTrackConfig.trackId"),g=g||{},this._logger=e||new d.Logger,this._mseCodec=function(a){return a.split("|").length>1?"video/mp4":"audio/mp4"}(f.codecs),this._bandwidth=f.bandwidth,this._height=f.height,this._trackId=f.trackId,this._mimeType=f.mimeType,this._totalNumberOfChunks=f.totalNumberOfChunks,this._mediaSegments=[],this._isComplete=!1,this._playableDuration=0,this._chunkDuration=0,this._mediaSegmentPlaylistUrlInfo=function(b){var c=b.split("?")[0],d=a.get(b.split("?"),[1],""),e=a.reduce(d.split("&"),function(a,b){var c=b.split("=")[0];return c&&(a[c]=b.split("=")[1]),a},{});return{url:c,queryParameters:e}}(f.mediaSegmentPlaylistUrl),this._currentChunkId=null,this._maxChunksToCache=g.maxChunksToCache||h,this._lowWaterMaxChunks=g.lowWaterMaxChunks||i,b.isNumber(this._maxChunksToCache,"options.maxChunksToCache"),b.isNumber(this._lowWaterMaxChunks,"options.lowWaterMaxChunks"),this._lowWaterMaxChunks>=this._maxChunksToCache)throw new Error('The "maxChunksToCache" cannot be less than or equal to the "lowWaterMaxChunks"');this._initChunk=null,this._dataChunks=[],this._chunkAddedEvent=new c.Event,this._segmentsReadyEvent=new c.Event}var h=20,i=15;return g.prototype=Object.create(e.prototype),g.prototype.constructor=g,g.prototype.toString=function(){return"M3u8PlaylistTrack"},g.prototype.dispose=function(){this._dataChunks=[],this._chunkAddedEvent.dispose()},g.prototype.getMseCodec=function(){return this._mseCodec},g.prototype.getTrackId=function(){return this._trackId},g.prototype.getChunkDuration=function(){return this._chunkDuration},g.prototype.getBandwidth=function(){return this._bandwidth},g.prototype.getHeight=function(){return this._height},g.prototype.getMimeType=function(){return this._mimeType},g.prototype.getTotalNumberOfChunks=function(){return this._totalNumberOfChunks},g.prototype.getPlayableDuration=function(){return this._playableDuration},g.prototype.isComplete=function(){return this._isComplete},g.prototype.hasSegments=function(){return this._mediaSegments.length>0},g.prototype.getSegmentByTimestamp=function(b){return a.find(this._mediaSegments,function(a){return a.timestamp<=b&&b<a.timestamp+a.duration})},g.prototype.getLastSegment=function(){return a.get(this._mediaSegments,[this._mediaSegments.length-1],null)},g.prototype.getMediaSegmentPlaylistUrlInfo=function(){return this._mediaSegmentPlaylistUrlInfo},g.prototype.getClosestSegmentNotGreaterThanTimestamp=function(a){return a>this._playableDuration?this._mediaSegments[this._mediaSegments.length-1]:this.getSegmentByTimestamp(a)},g.prototype.isLastMediaSegment=function(b){var c=this.getSegmentByTimestamp(b),d=!this._isComplete&&a.get(c,["timestamp"],0)+a.get(c,["duration"],0)===this._playableDuration,e=!this._isComplete&&b>this._playableDuration;return this._playableDuration===b||d||e},g.prototype.updateMediaSegments=function(b){var c=new f(this._logger,this._trackId,b),d=this._totalNumberOfChunks||0,e=a.map(this._mediaSegments,function(a){return a.name}),g=this,h=a.get(this._mediaSegments,[this._mediaSegments.length-1]),i=a.get(h,["timestamp"])+a.get(h,["duration"])||void 0;a.forEach(c.mediaSegments,function(b){a.includes(e,b.name)||(b.timestamp=a.isUndefined(i)?0:i,g._mediaSegments.push(b),g._playableDuration+=b.duration,i=b.timestamp+b.duration,b.duration>g._chunkDuration&&(g._chunkDuration=b.duration),g._logger.trace("[%s]:[%s]:[%s] Got new segment from playlist [%s]",(new Date).getHours(),(new Date).getMinutes(),(new Date).getSeconds(),b.name));
}),d!==this._mediaSegments.length&&(this._isComplete=c.isComplete,this._totalNumberOfChunks=this._mediaSegments.length,this._segmentsReadyEvent.fireAsync([this._mediaSegments],null,a.noop))},g.prototype.addDataChunk=function(a,c,d){b.isNotUndefined(a,"dataChunk"),d=d||function(){},b.isFunction(d,"eventCallback");var e={data:a,chunkId:c,timestamp:c*this._chunkDuration/1e3};if(this._dataChunks.push(e),this._dataChunks.length>this._maxChunksToCache)for(;this._dataChunks.length>this._lowWaterMaxChunks;)this._dataChunks.shift();this._chunkAddedEvent.fireAsync([e],this,d)},g.prototype.getChunks=function(){return this._dataChunks},g.prototype.addEventListener=function(a,c){switch(b.isString(a,"eventName"),b.isFunction(c,"listener"),a){case"chunkadded":return this._chunkAddedEvent.listen(c);case"segmentsready":return this._segmentsReadyEvent.listen(c);default:throw new Error('Event "'+a+'" is unknown.')}},g}.apply(b,d))&&(a.exports=e)},function(a,b,c){var d,e;d=[c(1),c(0)],void 0!==(e=function(a,b){"use strict";function c(c,e,f){b.isStringNotEmpty(f,"m3u8String"),b.isObject(c,"logger"),this._rawM3U8=f,this._logger=c,this._name=e,this.mediaSegments=[],function(b){var c=b.match(/[^\r\n]+/g),e=this;return a.forEach(c,function(b,f){var g=b.match(/(?!#)EXT.+?(?=[:\n\r])/),h=a.get(g,["0"],null),i=b.trim().substring(h?h.length+2:0,b.length);switch("#EXT-X-ENDLIST"===b&&(h="EXT-X-ENDLIST"),h){case"EXT-X-VERSION":e.version=parseFloat(i);break;case"EXT-X-PROGRAM-DATE-TIME":e.programDateTime=function(a){return a?new Date(a.trim()):null}(i);break;case"EXT-X-TARGETDURATION":e.targetDuration=1e3*parseFloat(i)||0;break;case"EXT-X-MEDIA-SEQUENCE":e.mediaSequence=parseInt(i);break;case"EXTINF":var j=[i,c[f+1]];e.mediaSegments.push(d(j,e.mediaSegments+1));break;case"EXT-X-ENDLIST":e.isComplete=!0;break;case"EXTM3U":case null:break;default:return e._logger.debug("[%s] [Segment] Playlist unsupported key type [%s]",e._name,h)}}),e}.call(this,this._rawM3U8);var g=0;a.forEach(this.mediaSegments,function(a){a.timestamp=g,g+=a.duration}),this.playableDuration=g,this.isComplete=!!this.isComplete}c.prototype.toString=function(){return"vod"};var d=function(b){var c=a.get(b,["0"],"").split(","),d=a.get(c,["0"],0),e=a.get(c,["1"],"").trim(),f=a.get(b,["1"],"").trim();return{duration:parseFloat(d),title:e,name:f}};return c}.apply(b,d))&&(a.exports=e)},function(a,b,c){var d,e;d=[c(0),c(8)],void 0!==(e=function(a,b){"use strict";function c(){}return c.prototype.isCodecSupported=function(c){return a.isStringNotEmpty(c,"codec"),b.global.MediaSource&&"function"==typeof b.global.MediaSource.isTypeSupported&&b.global.MediaSource.isTypeSupported(c)},c.prototype.parseXml=function(c){if(a.isStringNotEmpty(c,"xmlString"),void 0!==b.global.DOMParser)return(new b.global.DOMParser).parseFromString(c,"text/xml");if(void 0!==b.global.ActiveXObject&&new b.global.ActiveXObject("Microsoft.XMLDOM")){var d=new b.global.ActiveXObject("Microsoft.XMLDOM");return d.async="false",d.loadXML(c),d}throw new Error("No XML parser found")},c.prototype.getMSECodec=function(b,c){return a.isStringNotEmpty(b,"mpdMimeType"),a.isStringNotEmpty(c,"mpdCodecs"),b+'; codecs="'+c+'"'},new c}.apply(b,d))&&(a.exports=e)},function(a,b,c){var d,e;d=[c(1),c(0),c(10)],void 0!==(e=function(a,b,c){"use strict";function d(a,c,d){b.isObject(a,"logger"),this._logger=a,this._timeSources=function(a){return a.sort(function(a,b){return f[a.name]-f[b.name]})}(c),this._directSourceOffset=d}function e(b,d){d=d||0;var f=this,g=a.get(this._timeSources,[d],{});(function(b,d){var e=this;switch(b.name){case"urn:mpeg:dash:utc:http-head:2014":return c.get(b.value,{contentType:"text/plain"},function(c,f){var g=a.get(f,["headers","date"],""),h=new Date(g).getTime();if(c||isNaN(h))return e._logger.warn("Unable to resolve dash timing via [%s]",b.value),d();var i=a.now()-h-f.stats.successResponseTime/2;return e._logger.info("Resolved [%s] local to server timestamp offset [%s]",b.name,i),d(i)});case"urn:mpeg:dash:utc:direct:2014":var f=a.now()-b.value-this._directSourceOffset/2;return e._logger.info("Resolved [%s] local to server timestamp offset [%s]",b.name,f),d(f);default:return e._logger.info("Unable to resolve mpd Timing Sources. Defaulting to local time"),d(0)}}).call(this,g,function(c){return a.isNumber(c)?void b(c):e.call(f,b,d+1)})}var f={"urn:mpeg:dash:utc:http-head:2014":0,"urn:mpeg:dash:utc:direct:2014":1};return d.prototype.calculateOffset=function(a){e.call(this,a)},d.prototype.toString=function(){return"MpdTimeSync [Time Source Number: "+this._timeSources.length+", Direct Source Offset: "+this._directSourceOffset+"]"},d}.apply(b,d))&&(a.exports=e)},function(a,b,c){var d,e;d=[c(1),c(0),c(2),c(3),c(6),c(11),c(8),c(28),c(29),c(4),c(9),c(20),c(15),c(17)],void 0!==(e=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";function o(a,h,i){b.isNotUndefined(h,"videoElement"),b.isNotUndefined(h.videoWidth,"videoElement.videoWidth"),this._logger=a||new c.Logger,this._options=i,this._videoElement=h,this._disposables=new e.DisposableList,this._browserDetails=new f(g.global.navigator.userAgent).detect(),this._preferNative=this._options.preferNative||!1,this._player=null,this._playbackStarted=!1,this._isWaiting=!1,this._playbackStarted=!1,this._playbackTimeLeftEvent=new d.Event,this._playerStartedEvent=new d.Event,this._playerErrorEvent=new d.Event,this._disposables.add(this._playbackTimeLeftEvent),this._disposables.add(this._playerStartedEvent),this._disposables.add(this._playerErrorEvent)}function p(){var a=this;"Edge"===a._browserDetails.browser||"IE"===a._browserDetails.browser?(a._videoElement.play(),a._playbackStarted=!0,a._playerStartedEvent.fireAsync([],a),a._logger.debug("Playback Started")):a._videoElement.play().then(function(){a._playbackStarted=!0,a._playerStartedEvent.fireAsync([],a),a._logger.debug("Playback Started")})["catch"](function(b){a._logger.error("Playback Failed [%s]",b)})}return o.prototype.toString=function(){return a.toString(this)},o.prototype.start=function(a){if(b.isStringNotEmpty(a,"uri"),this._player)return this._logger.warn("Already started Phenix Web Player");var c=this;if(this._preferNative||!h.isSupported)return this._player=new i(this._logger,this._videoElement,this._options),this._player.addEventListener("error",function(a){c._playerErrorEvent.fire([a])}),this._disposables.add(this._player),this._player.start(a,function(){p.call(c)});var d=new j(this._logger,a);c._disposables.add(d),d.fetch(function(a){if(a)return c._playerErrorEvent.fire([a]);var b,e=new k(c._logger,{ewmaPeriods:30});"Dash"===d.getDeliveryType()?b=new m(c._logger,d,e,c._options):"Hls"===d.getDeliveryType()&&(b=new n(c._logger,d,e,c._options));var f=new h(c._logger,d,c._videoElement,b,c._options),g=new l(c._logger,d,c,e);f.start(),p.call(c),c._player=f,c._player.addEventListener("playbacktimeleft",function(a,b){c._playbackTimeLeftEvent.fire([a,b])}),c._player.addEventListener("error",function(a){c._playerErrorEvent.fire([a])}),c._disposables.add(c._player),c._disposables.add(e),c._disposables.add(g)})},o.prototype.play=function(){p.call(this),this._player&&this._player.play()},o.prototype.pause=function(){this._logger.info("Pausing web player"),this._player&&this._player.pause()},o.prototype.getVideoElement=function(){return this._videoElement},o.prototype.dispose=function(){this._disposables.dispose(),this._videoElement&&(this._videoElement.load(),this._videoElement.src="",this._videoElement.mediaKeys&&this._videoElement.setMediaKeys(null)),this._player=null,this._videoElement=null},o.prototype.getBandwidthLimit=function(){this._player.getBandwidthLimit()},o.prototype.getTimeLeft=function(){return this._videoElement?function(b){var c=this._videoElement.currentTime,d=this._videoElement.duration,e=function(a,b){for(var c=0;c<a.buffered.length;c++){var d=a.buffered.start(c),e=a.buffered.end(c);if(d<=b&&b<=e)return c}}(b,c),f=a.isNumber(e)?b.buffered.end(e):0,g=0===f?0:f-c;return{bufferedLength:b.buffered.length,current:c,bufferEnd:f,timeBufferedButNotPlayed:g,duration:d,timestampOffset:b.timestampOffset}}.call(this,this._videoElement).timeBufferedButNotPlayed:0},o.prototype.changeBandwidthLimit=function(a,b){this._player.changeBandwidthLimit(a,b)},o.prototype.addEventListener=function(c,d){switch(b.isString(c,"eventName"),b.isFunction(d,"listener"),c){case"playbacktimeleft":return this._playbackTimeLeftEvent.listen(d);case"started":var e=this._playerStartedEvent.listen(d);return this._playbackStarted&&setTimeout(a.bind(d,this),0),e;case"error":return this._playerErrorEvent.listen(d);default:throw new Error('Event "'+c+'" is unknown.')}},o.prototype.getStats=function(){return this._player?this._player.getStats():{}},o.isSupported=i.isSupported||h.isSupported,o}.apply(b,d))&&(a.exports=e)},function(a,b,c){var d,e;d=[c(1),c(0),c(2),c(3),c(6),c(11),c(8),c(4),c(12),c(18)],void 0!==(e=function(a,b,c,d,e,f,g,h,i,j){"use strict";function k(k,m,n,o,p){b.isInstanceOf(m,h,"playlist"),b.isNotUndefined(n,"videoElement"),b.isNotUndefined(n.videoWidth,"videoElement.videoWidth"),b.isNotUndefined(o,"playlistChunkFeeder"),b.isInstanceOf(o,i,"playlistChunkFeeder"),a.isUndefined(a.get(p,"bandwidthToStartAt"))||b.isNumber(p.bandwidthToStartAt,"options.bandwidthToStartAt"),a.isUndefined(a.get(p,"trackRestrictions"))||b.isObject(p.trackRestrictions,"options.trackRestrictions"),a.isUndefined(a.get(p,"bufferSizeToPauseFetch"))||b.isNumber(p.bufferSizeToPauseFetch,"options.bufferSizeToPauseFetch"),a.isUndefined(a.get(p,"bufferSizeToResumeFetch"))||b.isNumber(p.bufferSizeToResumeFetch,"options.bufferSizeToResumeFetch"),a.isUndefined(a.get(p,"maximumFrequencyForAlteringPlaybackRate"))||b.isNumber(p.maximumFrequencyForAlteringPlaybackRate,"options.maximumFrequencyForAlteringPlaybackRate"),a.isUndefined(a.get(p,"playbackRateToRecover"))||b.isNumber(p.playbackRateToRecover,"options.playbackRateToRecover"),a.isUndefined(a.get(p,"targetMinBufferSize"))||b.isNumber(p.targetMinBufferSize,"options.targetMinBufferSize");var q=this;this._options=p,this._videoElement=n,this._feeder=o,this._playlist=m,this._disposables=new e.DisposableList,this._logger=k||new c.Logger,this._bandwidthLimit=a.get(p,"bandwidthToStartAt",w),this._trackRestrictions=a.get(p,"trackRestrictions",{}),this._bufferSizeToPauseFetch=a.get(p,"bufferSizeToPauseFetch",x),this._bufferSizeToResumeFetch=a.get(p,"bufferSizeToResumeFetch",y),this._maximumFrequencyForAlteringPlaybackRate=a.get(p,"maximumFrequencyForAlteringPlaybackRate",C),this._targetMinBufferSize=a.get(p,"targetMinBufferSize",E),this._playbackRateToDecreaseBuffer=a.get(p,"playbackRateToDecreaseBuffer",A),this._playbackRateToIncreaseBuffer=a.get(p,"playbackRateToIncreaseBuffer",B),this._targetBufferSizeToStartFastForward=this._targetMinBufferSize+3.5,this._maxBufferSizeWhileRecoveringBufferWithSlowMotion=this._targetMinBufferSize+2,this._playbackStarted=!1,this._isWaiting=!1,this._bufferStats=[],this._browserDetails=new f(g.global.navigator.userAgent).detect(),function(){var b=this,c=a.get(this._playlist,["parsedPlaylist","contentProtectionTags"],[]);if(0!==c.length)return j.isSupported()?(this._encryptedMediaHandler=new j(this._logger,this._videoElement,c,a.get(this._options,"drm")),this._encryptedMediaHandler.addEventListener("error",function(a){b._playerErrorEvent.fire([a])}),this._encryptedMediaHandler.addEventListener("trackRestrictionsAvailable",function(c){a.keys(c).length>0&&(b._trackRestrictions=c,l.call(b),b._videoElement.play())}),this._disposables.add(this._encryptedMediaHandler),void 0):this._logger.error("DRM not supported by the browser")}.call(this),this._playbackStarted=!1,this._mediaSourceBuffers={},this._bufferDetails={},this._playbackTimeLeftEvent=new d.Event,this._playerErrorEvent=new d.Event,this._feeder.addEventListener("error",function(a){q._playerErrorEvent.fire([a])}),this._disposables.add(this._feeder),this._disposables.add(this._playbackTimeLeftEvent),this._disposables.add(this._playerErrorEvent),this._disposables.add(new e.Disposable(function(){null!==q._switchTrackDisposable&&g.global.clearTimeout(q._switchTrackDisposable)}))}function l(){var a=this._playlist.getPlaylistTracksByBandwidthPerMimeType(this._bandwidthLimit,this._trackRestrictions);return this._feeder.setActiveTracks(a),a}function m(a,b,c){this._logger.debug("VIDEO EVENT: [%s]",a),b&&b.call(this,c)}function n(b,c){var d=a.bind(m,this,"durationchange",function(){var e=this;return"dynamic"!==e._playlist.getType()?(e._videoElement.removeEventListener("durationchange",d,!1),e._ready=!0):void(0!==a.get(e,["_videoElement","buffered","length"],0)&&function(b,c){var d=this;b=a.isNumber(b)?b:d._playlist.getPlaybackDurationSinceAvailable()/1e3-1,"Firefox"===this._browserDetails.browser&&(b-=1),setTimeout(function(){var a=d._videoElement.buffered.start(d._videoElement.buffered.length-1),e=d._videoElement.buffered.end(d._videoElement.buffered.length-1),f=d._videoElement.currentTime<b||d._videoElement.currentTime>b+1,g=a<=b&&b<=e,h=d._durationChangeCount>=G;g||h||!d._initialized?(!f||d._setTimeoutOnce||!g&&!h&&d._initialized||(d._initialized||g?d._videoElement.currentTime=h?(e-a)/2+a:a:d._videoElement.currentTime=a,d._setTimeoutOnce=!0,d._initialized||(d._initialized=!0)),a<=d._videoElement.currentTime&&d._videoElement.currentTime<=e&&(g||h)&&(d._ready=!0,d._setTimeoutOnce=!1,c())):d._durationChangeCount++},10)}.call(e,b,function(){e._videoElement.removeEventListener("durationchange",d,!1),c&&c()}))});return this._durationChangeCount=0,d}function o(b){var c=this._videoElement.currentTime,d=this._videoElement.duration,e=p(b,c),f=a.isNumber(e)?b.buffered.end(e):0,g=0===f?0:f-c;return{bufferedLength:b.buffered.length,current:c,bufferEnd:f,timeBufferedButNotPlayed:g,duration:d,timestampOffset:b.timestampOffset}}function p(a,b){for(var c=0;c<a.buffered.length;c++){var d=a.buffered.start(c),e=a.buffered.end(c);if(d<=b&&b<=e)return c}}function q(){var b=!0,c=!1;a.forOwn(this._mediaSourceBuffers,a.bind(function(a){var d=o.call(this,a.buffer),e=parseFloat(d.timeBufferedButNotPlayed);e<this._bufferSizeToPauseFetch&&(b=!1),e<this._bufferSizeToResumeFetch&&(c=!0)},this)),b&&this._feeder.isFetchingData()&&(this._logger.debug("Pausing feeder due to excess buffer"),H.call(this)),!c||this._feeder.isFetchingData()||this._pausedAt||(this._logger.debug("Starting feeder due to limited buffer"),I.call(this))}function r(b,c){var d=this._mediaSourceBuffers[u(b)],e=this._bufferDetails[v(b)];if(!e)return this._logger.warn("Unable to add chunk for non existent buffer");if("dynamic"===this._playlist.getType()&&this._pausedAt&&!this._reset&&d.buffer.buffered.length>0)d.buffer.remove(0,d.buffer.buffered.end(d.buffer.buffered.length-1)),d.cleared=!0,a.reduce(this._mediaSourceBuffers,function(a,b){return a?b.cleared:a},!0)&&(this._initialized=!1,this._ready=!1,this._setTimeoutOnce=!1,this._reset=!0);else if(e.chunks.length>0){if(this._videoElement.error)return this._logger.error("Unable to continue appending to buffer. Video element error code [%s] and message [%s]",this._videoElement.error.code,this._videoElement.error.message),H.call(this),this._playerErrorEvent.fire([this._videoElement.error]);var f=e.chunks.shift();d.cleared=!1,this._logger.debug("Appending chunk to buffer for track [%s]",b.getTrackId()),d.buffer.appendBuffer(new Uint8Array(f))}else c&&(q.call(this),e.chunkAddRequested=!0)}function s(b){var c=this._mediaSourceBuffers[u(b)],d=a.bind(function(a){this._logger.warn("Buffer Error [%s]",a)},this),e=!!c.track;if(c.track!==b){var f=this._bufferDetails[v(b)];if(c.track&&c.track!==b&&e&&(c.buffer.removeEventListener("updateend",c.updateEndListener),c.buffer.removeEventListener("error",d),f&&(f.addInitChunkFirst=!0,f.chunkAddRequested=!0,f.chunks=[])),c.track=b,c.updateEndListener=a.bind(c.updateEnd,this,b),c.buffer.addEventListener("updateend",c.updateEndListener),c.buffer.addEventListener("error",d),c.buffer.onerror=d,!e){var g="Dash"===this._playlist.getDeliveryType()?[b.getInitChunkData()]:[];f.chunks=[].concat(g,a.map(b.getChunks(),function(a){return a.data})),"static"===this._playlist.getType()&&"Edge"!==this._browserDetails.browser&&"IE"!==this._browserDetails.browser&&this._mediaSource.setLiveSeekableRange(0,this._playlist.getTotalMediaTimeInMillis()/1e3),r.call(this,b,!1)}}}function t(b){this._logger.debug("Creating MSE buffers for all tracks."),a.forEach(b,a.bind(function(b){(function(b){var c=this,d={track:b,chunks:[],chunkAddRequested:!1},f=u(b),g=!a.includes(a.keys(c._mediaSourceBuffers),f),h=g?c._mediaSource.addSourceBuffer(b.getMseCodec()):c._mediaSourceBuffers[f].buffer,i=v(b);c._bufferDetails[i]=d,g&&(h.mode="segments","static"===c._playlist.getType()&&(h.appendWindowEnd=c._playlist.getTotalMediaTimeInMillis()/1e3),c._logger.debug("Creating MSE Buffer for [%s] with mode [%s]",c._playlist.getType(),h.mode),c._mediaSourceBuffers[f]={buffer:h,updateEnd:function(a){h.updating||r.call(this,a,!0)}},c._disposables.add(new e.Disposable(function(){c._logger.debug("Cleaning up sourceBuffer [%s]",f),c._mediaSource.removeSourceBuffer(h)})));var j=b.addEventListener("chunkadded",a.bind(function(b,e){d.addInitChunkFirst&&"Dash"===c._playlist.getDeliveryType()&&(d.addInitChunkFirst=!1,this._logger.debug("Pushing track [%s] chunk [%s] into buffer",b.getTrackId(),"Init"),d.chunks.push(b.getInitChunkData())),this._logger.debug("Pushing track [%s] chunk [%s] into buffer",b.getTrackId(),e.chunkId),d.chunks.push(e.data),d.chunkAddRequested&&(d.chunkAddRequested=!1,h.updating||r.call(this,b,!1));var f=a.now()-this._lastUpdate>=z,g=a.now()-this._lastPlayAttempt>=500;this._isWaiting&&f&&g&&!this._videoElement.paused&&!this._pausedAt&&(this._logger.trace("Starting after wait [%s]",a.now()-this._lastUpdate),this._lastPlayAttempt=a.now(),this._videoElement.play())},c,b));c._disposables.add(j)}).call(this,b)},this))}function u(a){return a.getMseCodec().indexOf("video")>=0?"video":a.getMseCodec().indexOf("audio")>=0?"audio":"other"}function v(a){return a.getTrackId()+"_"+a.getMseCodec()}var w=2e6,x=60,y=30,z=1e3,A=1.03,B=.97,C=300,D=300,E=2,F=3e5,G=2;k.prototype.toString=function(){return a.toString(this)},k.prototype.play=function(){if("dynamic"===this._playlist.getType()){var a=this._feeder.seekToCurrent();I.call(this);var b=this,c=n.call(this,a,function(){b._pausedAt=0,b._videoElement&&b._videoElement.play()});return setTimeout(function(){b._videoElement.addEventListener("durationchange",c,!1)},300),this._disposables.add(new e.Disposable(function(){b._videoElement.removeEventListener("durationchange",c,!1)}))}I.call(this),this._videoElement&&this._videoElement.play()},k.prototype.pause=function(){this._logger.info("Pausing web player"),H.call(this);var b=this;this._videoElement&&(this._videoElement.pause(),this._pausedAt=a.now(),this._reset=!1,a.forOwn(this._feeder.getActiveTracks(),function(a){b._mediaSourceBuffers[u(a)].buffer.updating||r.call(b,a,!1)}))},k.prototype.dispose=function(){this._disposables.dispose(),this._playbackStarted=!1,this._mediaSourceBuffers={},this._bufferDetails={},this._bufferStats=[],this._mediaSource=null,this._playlist=null,this._videoElement=null},k.prototype.start=function(b){(function(b){var c=this;c._mediaSource=new MediaSource;var d=function(){(function(b){var c=this,d=l.call(this),f=c._playlist.getAllPlaylistTracks().sort(function(a,b){return-1*(a.getBandwidth()-b.getBandwidth())}),g=a.filter(f,function(b){return!a.includes(d,b)});if(this._logger.info("Initializing feeder with [%s] [%s] playlist of duration [%s]",c._playlist.getType(),c._playlist.getDeliveryType(),c._playlist.getTotalMediaTimeInMillis()/1e3),"static"===c._playlist.getType())c._mediaSource.duration=c._playlist.getTotalMediaTimeInMillis()/1e3;else if("Hls"===c._playlist.getDeliveryType()){c._mediaSource.duration=1/0;var h=a.reduce(d,function(b,c){var d=a.get(c.getLastSegment(),["timestamp"],0);return a.isNullOrUndefined(b)?d:d<b?d:b})||0;c._feeder.seekToChunk(h)}this._logger.debug("Loading tracks: numberOfTracksToInitialize=[%s], all tracks: [%s]",d.length,f),this._feeder.initialize(d,g,function(){t.call(c,d);var f=l.call(c);a.forEach(f,function(a){s.call(c,a)}),function(b){var c=this,d=a.bind(function(){this._isWaiting=!1,this._lastUpdate=a.now();var b;a.forOwn(this._mediaSourceBuffers,a.bind(function(a){var c=o.call(this,a.buffer);(!b||b>c.timeBufferedButNotPlayed)&&(b=c.timeBufferedButNotPlayed),this._playbackTimeLeftEvent.fire([c.timeBufferedButNotPlayed,a.track],this)},this)),q.call(this),function(b){this._bufferStats.push({size:b,timestamp:a.now()});for(var c=a.get(this._bufferStats,[0,"timestamp"],a.now());a.now()-c>F;)this._bufferStats.shift(),c=a.get(this._bufferStats,[0,"timestamp"],a.now());this._bufferStatsMin=Math.min.apply(null,a.map(this._bufferStats,function(a){return a.size}))}.call(this,b),function(b){if("Dash"===this._playlist.getDeliveryType()||"dynamic"===this._playlist.getType()){var c=this._targetBufferSizeToStartFastForward,d=this._lastPlaybackRateChange,e=a.now()-this._startTime>D,f=!d||a.now()-d>1e3*this._maximumFrequencyForAlteringPlaybackRate,g=this._bufferStatsMin>this._targetMinBufferSize,h=this._bufferStatsMin<=this._targetMinBufferSize+.1&&this._bufferStatsMin>=this._targetMinBufferSize-.1,i=b>=this._maxBufferSizeWhileRecoveringBufferWithSlowMotion&&this._videoElement.playbackRate===this._playbackRateToIncreaseBuffer;b>=c&&g&&this._videoElement.playbackRate<=1&&e&&f?(this._logger.info("Adjusting playback rate to [%s] to reduce buffer size from [%s] with minimum buffer size of [%s]",this._playbackRateToDecreaseBuffer,b,this._bufferStatsMin),this._videoElement.playbackRate=this._playbackRateToDecreaseBuffer):!g&&!h&&this._videoElement.playbackRate>=1&&f?(this._logger.info("Adjusting playback rate to [%s] to increase buffer size from [%s] with minimum buffer size of [%s]",this._playbackRateToIncreaseBuffer,b,this._bufferStatsMin),this._videoElement.playbackRate=this._playbackRateToIncreaseBuffer):(i||h)&&1!==this._videoElement.playbackRate&&(this._logger.info("Resuming normal playback rate with buffer size of [%s] and minimum buffer size of [%s]",b,this._bufferStatsMin),this._videoElement.playbackRate=1,this._lastPlaybackRateChange=a.now())}}.call(this,b||0)},c),f=a.bind(m,c,"stalled",null),g=a.bind(m,c,"suspend",null),h=a.bind(m,c,"ended",null),i=a.bind(m,c,"error",null),j=a.bind(m,c,"pause",null),k=a.bind(m,c,"play",function(){this._pausedAt&&this._videoElement.pause()}),l=a.bind(m,c,"waiting",function(){this._playbackStarted&&(this._logger.debug("Waiting for new chunk or end of track"),this._isWaiting=!0)}),r=a.bind(m,c,"seeking",function(b){var c=a.keys(this._mediaSourceBuffers),d=a.get(c,"0",null),e=this._mediaSourceBuffers[d],f=this;if(e&&this._ready&&"Hls"!==this._playlist.getDeliveryType()){var g=p(e.buffer,b.timeStamp/1e3),h=p(e.buffer,this._videoElement.currentTime),i=a.reduce(this._mediaSourceBuffers,function(b,c){var d=p(c.buffer,f._videoElement.currentTime),e=a.isNumber(d)?c.buffer.buffered.end(d):0;return b?e<b?e:b:e})||this._videoElement.currentTime;if(this._feeder.stopRequestingAllData(),this._logger.debug("Pausing of feeder completed."),this._feeder.seekToChunk("dynamic"===this._playlist.getType()?this._videoElement.currentTime:i),g!==h||a.isNullOrUndefined(h)){if(this._feeder.isFetchingData())return;this._feeder.startRequestingDataForActiveTracks(this._bandwidthLimit)}}}),s=n.call(c);c._videoElement.addEventListener("timeupdate",d,!1),c._videoElement.addEventListener("ended",h,!1),c._videoElement.addEventListener("error",i,!1),c._videoElement.addEventListener("pause",j,!1),c._videoElement.addEventListener("stalled",f,!1),c._videoElement.addEventListener("suspend",g,!1),c._videoElement.addEventListener("play",k,!1),c._videoElement.addEventListener("waiting",l,!1),c._videoElement.addEventListener("seeking",r,!1),c._videoElement.addEventListener("durationchange",s,!1),c._disposables.add(new e.Disposable(function(){c._logger.debug("Cleaning up videoElement listeners"),c._videoElement.removeEventListener("timeupdate",d,!1),c._videoElement.removeEventListener("ended",h,!1),c._videoElement.removeEventListener("error",i,!1),c._videoElement.removeEventListener("pause",j,!1),c._videoElement.removeEventListener("stalled",f,!1),c._videoElement.removeEventListener("suspend",g,!1),c._videoElement.removeEventListener("play",k,!1),c._videoElement.removeEventListener("waiting",l,!1),c._videoElement.removeEventListener("seeking",r,!1),c._videoElement.removeEventListener("durationchange",s,!1)})),I.call(c),c._lastPlayAttempt=a.now(),a.isFunction(b)&&b()}.call(c,b)},function(){"Hls"!==c._playlist.getDeliveryType()&&t.call(c,g)},function(a){return c._logger.error("Unable to initialize playlist chunk feeder",a),c._playerErrorEvent.fire([a])})}).call(c,b)};c._mediaSource.addEventListener("sourceopen",d),c._disposables.add(new e.Disposable(function(){c._logger.debug("Cleaning up sourceopen listener"),c._mediaSource.removeEventListener("sourceopen",d)})),c._videoElement.src=g.global.URL.createObjectURL(c._mediaSource)}).call(this,b),this._startTime=a.now()},k.prototype.getBandwidthLimit=function(){return this._bandwidthLimit},k.prototype.changeBandwidthLimit=function(b,c){this._logger.debug("Changing playback bandwidth limit: [%s], current limit: [%s]",b,this._bandwidthLimit),this._bandwidthLimit=b,this._switchTrackDisposable=setTimeout(a.bind(function(b){var c=this,d=this._feeder.getActiveTracks(),e=l.call(this),f=a.filter(e,function(b){return!a.find(d,function(a){return a.getTrackId()===b.getTrackId()})});a.forEach(f,function(a){s.call(c,a),c._logger.info("Switched [%s] to track [%s] with [%s] bandwidth limit",u(a),a.getTrackId(),c._bandwidthLimit)});var g=a.reduce(e,function(b,d){var e=c._mediaSourceBuffers[u(d)],f=p(e.buffer,c._videoElement.currentTime),g=d.getChunkDuration()/1e3;if(!a.isNumber(f))return!a.isNumber(b)||b>c._videoElement.currentTime?c._videoElement.currentTime:b;var h=Math.round(e.buffer.buffered.end(f)/g)*g;return!a.isNumber(b)||b>h?h:b});a.isNumber(g)||(g=c._videoElement.currentTime),this._feeder.stopRequestingAllData(),this._feeder.seekToChunk(g),this._logger.debug("Pausing of feeder completed."),this._feeder.isFetchingData()||(this._feeder.startRequestingDataForActiveTracks(this._bandwidthLimit),b())},this,c||a.noop),250)},k.prototype.addEventListener=function(a,c){switch(b.isString(a,"eventName"),b.isFunction(c,"listener"),a){case"playbacktimeleft":return this._playbackTimeLeftEvent.listen(c);case"error":return this._playerErrorEvent.listen(c);default:throw new Error('Event "'+a+'" is unknown.')}},k.prototype.getStats=function(){return{currentTime:a.get(this._element,["currentTime"],0),width:a.get(this._element,["videoWidth"],0)||a.get(this._element,["width"],0),height:a.get(this._element,["videoHeight"],0)||a.get(this._element,["height"],0),lag:0,deliveryType:this._playlist.getDeliveryType(),isNative:!1}},k.isSupported=!!g.global.MediaSource;var H=function(){this._feeder.stopRequestingAllData(),this._logger.debug("Pausing of feeder completed.")},I=function(){return this._feeder.isFetchingData()?this._logger.debug("Unable to start requesting data. Feeder is already fetching data."):void this._feeder.startRequestingDataForActiveTracks()};return k}.apply(b,d))&&(a.exports=e)},function(a,b,c){var d,e;d=[c(1),c(0),c(2),c(3),c(6),c(11),c(19),c(8),c(4),c(18),c(5)],void 0!==(e=function(a,b,c,d,e,f,g,h,i,j,k){"use strict";function l(g,l,q){b.isNotUndefined(l,"videoElement"),b.isNotUndefined(l.videoWidth,"videoElement.videoWidth"),this._options=q,this._videoElement=l,this._disposables=new e.DisposableList,this._logger=g||new c.Logger,this._browserDetails=new f(h.global.navigator.userAgent).detect(),this._playerErrorEvent=new d.Event,this._disposables.add(this._playerErrorEvent),this._onStalled=a.bind(function(){var a=this,b=this._element.currentTime,c=function(){return 1.5*this._lastProgress.averageLength<2e3?2e3:1.5*this._lastProgress.averageLength}.call(a);setTimeout(function(){if(0===a._lastProgress.count){var b="Stream has not started within ["+c/1e3+"] seconds";a._logger.warn(b),o.call(a,k.name.progressTimeOut.name,b)}},c),setTimeout(function(){if(a._element&&a._element.currentTime===b&&!a._element.paused&&m.call(a)){var c="Stream has been stalled for ["+s/1e3+"] seconds";a._logger.warn(c),n.call(a,k.name.progressTimeOut.name,c)}},s)},this),this._onProgress=a.bind(function(){if(this._lastProgress.time=a.now(),0===this._element.buffered.length)return this._logger.debug("[%s] Hls stream progress event fired without any buffered content",this._uri);var b=this._element.buffered.end(this._element.buffered.length-1);if(this._lastProgress.buffered!==b){if(null!==this._lastProgress.buffered){var c=this._lastProgress.averageLength*this._lastProgress.count+(b-this._lastProgress.buffered);if(this._lastProgress.count+=1,this._lastProgress.averageLength=c/this._lastProgress.count,this._lastProgress.lastCurrentTime!==this._element.currentTime&&(this._lastProgress.lastCurrentTimeOccurrenceTimestamp=a.now()),this._lastProgress.lastCurrentTimeOccurrenceTimestamp&&a.now()-this._lastProgress.lastCurrentTimeOccurrenceTimestamp>s&&this._element&&!this._element.paused&&m.call(this)){var d="Reloading stream after current time has not changed for ["+s/1e3+"] seconds due to unregistered stall.";this._logger.warn(d),n.call(this,k.name.progressTimeOut.name,d)}}this._lastProgress.buffered=b,this._lastProgress.lastCurrentTime=this._element.currentTime}},this),this._onEnded=a.bind(function(){this._logger.info("[%s] Hls stream ended",this._streamId),this.stop("ended")},this),this._onError=a.bind(function(b){var c=this,d=0===c._lastProgress.count;4===a.get(this._element,["error","code"])&&d&&o.call(c,k.name.hlsNativeError.name,b),p.call(this,k.name.hlsNativeError.name,b)},this),this._lastProgress={time:0,buffered:null,averageLength:0,count:0,lastCurrentTime:0,lastCurrentTimeOccurrenceTimestamp:0},this._bufferSizeHistory=[],function(){var b=this;return j.isSupported()?(this._encryptedMediaHandler=new j(this._logger,this._videoElement,[],a.get(this._options,"drm")),this._encryptedMediaHandler.addEventListener("error",function(a){b._playerErrorEvent.fire([a])}),this._encryptedMediaHandler.addEventListener("trackRestrictionsAvailable",function(c){a.keys(c).length>0&&(b._trackRestrictions=c)}),this._disposables.add(this._encryptedMediaHandler),void 0):this._logger.error("DRM not supported by the browser")}.call(this),setTimeout(a.bind(function(){this._playlist=new i(this._logger,this._uri),this._disposables.add(this._playlist),this._playlist.fetch(a.noop)},this),u)}function m(){return this._element&&0!==this._element.buffered.length}function n(a,b){return m.call(this)?void o.call(this,a,b):p.call(this,a,b)}function o(a,b){this._playerErrorEvent.fire([r(a,k.severity.RECOVERABLE,b)])}function p(a,b){this._playerErrorEvent.fire([r(a,k.severity.CRITICAL,b)])}function q(b){if(b){if(clearTimeout(this._backgroundTimeout),this._backgroundTimeout=null,!this._backgroundThrottled)return;return this._backgroundThrottled=!1,void this.start(this._element)}var c=this;this._backgroundTimeout=setTimeout(function(){g.isForeground()||function(b){return!b.muted&&(a.get(b,["webkitAudioDecodedByteCount"],0)>0||a.get(b,["audioTracks","length"],0)>0||b.webkitHasAudio)}(c._element)||(c._logger.info("Detecting application [background] with muted video. Pausing playback until application focused again."),c._element.pause(),c._backgroundThrottled=!0)},t)}function r(a,b,c){return{category:k.category.STREAMING,name:a,severity:b,error:"Error"===c.constructor.name?c:new Error(c)}}var s=6e3,t=3e3,u=2e3;return l.prototype.toString=function(){return a.toString(this)},l.prototype.play=function(){this._videoElement.play()},l.prototype.pause=function(){this._videoElement.pause()},l.prototype.dispose=function(){this._disposables.dispose()},l.prototype.start=function(b){return this._uri?this._logger.warn("Already started player"):(this._uri=b,this._disposables.add(g.onBackground(a.bind(q,this,!1))),this._disposables.add(g.onForeground(a.bind(q,this,!0))),function(b){h.attachUriStream(b,this._uri),
!1===this._options.receiveAudio&&(b.muted=!0),a.addEventListener(b,"error",this._onError,!0),a.addEventListener(b,"stalled",this._onStalled,!1),a.addEventListener(b,"pause",this._onStalled,!1),a.addEventListener(b,"suspend",this._onStalled,!1),a.addEventListener(b,"progress",this._onProgress,!1),a.addEventListener(b,"ended",this._onEnded,!1),this._element=b}.call(this,this._videoElement),void 0)},l.prototype.getBandwidthLimit=function(){return this._logger.warn("getBandwidthLimit not supported for HLS Native")},l.prototype.changeBandwidthLimit=function(){return this._logger.warn("changeBandwidthLimit not supported for HLS Native")},l.prototype.addEventListener=function(a,c){switch(b.isString(a,"eventName"),b.isFunction(c,"listener"),a){case"error":return this._playerErrorEvent.listen(c);default:throw new Error('Event "'+a+'" is unknown.')}},l.prototype.getStats=function(){if(!this._videoElement)return{width:0,height:0,currentTime:0,lag:0,deliveryType:"Hls",isNative:!0};var b=a.get(this._element,["currentTime"],0),c=this._element&&this._element.buffered&&this._element.buffered.length>0?this._element.buffered.end(this._element.buffered.length-1):0,d=Math.max(0,c-b);this._bufferSizeHistory.push(d),this._bufferSizeHistory.length>15&&this._bufferSizeHistory.shift();for(var e=0,f=0,g=this._bufferSizeHistory.length;f<g;f++)e=Math.max(e,this._bufferSizeHistory[f]);var h=2;this._playlist&&this._playlist.getAllPlaylistTracks().length>0&&(h=this._playlist.getAllPlaylistTracks()[0].getChunkDuration());var i=2*h+e;return{width:this._element.videoWidth||this._element.width,height:this._element.videoHeight||this._element.height,currentTime:b,lag:i,deliveryType:"Hls",isNative:!0}},l.isSupported=!1,l}.apply(b,d))&&(a.exports=e)}])})},function(a,b,c){var d,e;d=[c(0),c(72),c(68)],e=function(a,b,c){"use strict";function d(d,e){var f=b.loadJson(c);a.forEach(d,function(a){f=b.loadJson(a,f)}),this._builders=f.build(),this._apiVersion=e||3}function e(a){for(var b=a.split("."),c=this._builders,d=0;d<b.length-1;d++)if(c=c[b[d]],!c)throw new Error('Unsupported type "'+a+'"');if(c=c[b[b.length-1]],"function"!=typeof c)throw new Error('Unsupported type "'+a+'"');return c}function f(b){if(b&&b.$type&&b.$type.children)a.forOwn(b.$type.children,function(c){var d=b[c.name],e=c&&c.element?c.element.resolvedType:null;if(a.isArray(d))b[c.name]=[],a.forEach(d,function(a){b[c.name].push(f(a))});else if(e&&"Message"===e.className&&e.children)b[c.name]=f(d);else if(e&&"Enum"===e.className&&e.children){var g=a.getEnumName(e.children,d);g&&(b[c.name]=g)}else d&&a.isFunction(d.toNumber)&&(b[c.name]=d.toNumber())});else if(b&&a.isFunction(b.toNumber))return b.toNumber();return b}return d.prototype.getApiVersion=function(){return this._apiVersion},d.prototype.encode=function(a,b){if("string"!=typeof a)throw new Error("'type' must be a string");if("object"!=typeof b)throw new Error("'data' must be an object");var c=e.call(this,a);return c.encode(b)},d.prototype.decode=function(a,b){if("string"!=typeof a)throw new Error("'type' must be a string");var c=e.call(this,a);return f(c.decode(b))},d}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(5),c(3),c(30),c(12)],e=function(a,b,c,d,e,f){"use strict";function g(d,f,g,h,j){b.isObject(d,"logger"),b.isFunction(f,"sendCallback"),b.isFunction(g,"receiveCallback"),this._logger=d,this._mqProtocol=new e(h,j),this._nextRequestId=0,this._namedEvents=new c.NamedEvents,this._requests={},this._responses={},this._requestListeners={},this._requestTimeouts={},this._requestTimestamps={},this._continuationTimeouts={},this._receiveCallback=g,this._sendCallback=f,g(a.bind(i,this))}function h(a,b){this._namedEvents.fire(a,b,this)}function i(b){if(this._disposed)return this._logger.warn("Proto already disposed of. Unable process message");var c,d,e;try{c=this._mqProtocol.decode("mq.Message",f.wrap(b.data,"base64")),e=this._requests[c.requestId],this._logger.info(">> [%s] [%s]",c.messageType,c.type),d=this._mqProtocol.decode(c.type,c.payload)}catch(g){if(this._logger.error(g),e)return e(g);throw g}switch(p.call(this,c,d,b.data.length),c.messageType){case"Response":if(d.status!==t&&delete this._requests[c.requestId],clearTimeout(this._requestTimeouts[c.requestId]),delete this._requestTimeouts[c.requestId],!e)return;if("mq.Error"===c.type){var i=d;return e(i,null)}return e(null,d);case"Request":var j=a.bind(this.sendResponse,this,c.requestId,c.type+"Response"),k=this._requestListeners[c.type];this._responses[c.requestId]=a.now(),k?k(d,j):this._logger.info("Received request without a subscribed listener");break;case"Event":return h.call(this,c.type,[d]);default:return this._logger.warn(">> Unsupported message type [%s]",c.messageType)}}function j(a,b,c,d,e,f,g){return g&&g.status===t?(!this._continuationTimeouts[a]&&this._requests[a]&&(this._continuationTimeouts[a]=n.call(this,a,e)),k.call(this,a,b,c,g,d,e)):(clearTimeout(this._continuationTimeouts[a]),delete this._continuationTimeouts[a],e(f,g))}function k(b,c,d,e,f,g){if(!e||!e.continuationId&&!e.routeKey)return this._logger.warn("Received request for continuation without a continuationId or routeKey"),g();var h=a.assign({},d,{continuationId:e.continuationId,routeKey:e.routeKey}),i={requestId:b,type:c,payload:this._mqProtocol.encode(c,h),messageType:"Request"},j=this;return setTimeout(function(){if(j._requests[b])return l.call(j,b,i,h,f,g)},u)}function l(b,c,d,e,f){this._requestTimeouts[b]&&clearTimeout(this._requestTimeouts[b]);var g=e||w;return this._requestTimeouts[b]=setTimeout(a.bind(o,this,b,g,f),g),m.call(this,c,d)}function m(a,b){var c=this._mqProtocol.encode("mq.Message",a).toString("base64");return q.call(this,a,b,c.length),this._sendCallback(c)}function n(b,c){return setTimeout(a.bind(o,this,b,v,c),v)}function o(a,b,c){if(this._requests[a])return r.call(this,a,b),this._logger.warn("Request [%s] has not completed in [%s] ms. Dropping request.",a,b),delete this._requests[a],c(null,{status:"timeout"})}function p(b,c,d){var e=a.now(),f=this._requestTimestamps[b.requestId];if(a.isNumber(f)){var g=e-f;b.wallTime=[g].concat(b.wallTime)}this._namedEvents.fireAsync("received",[{key:b.requestId,messageType:b.messageType,type:b.type,wallTime:b.wallTime,received:e,bytes:d,payload:c}]),delete this._requestTimestamps[b.requestId]}function q(b,c,d){var e=a.now();this._requestTimestamps[b.requestId]=e,this._namedEvents.fireAsync("sent",[{key:b.requestId,messageType:b.messageType,type:b.type,received:e,bytes:d,payload:c}])}function r(a,b){this._namedEvents.fireAsync("timeout",[{key:a,timeout:b}]),delete this._requestTimestamps[a]}var s="C",t="continuation",u=2e3,v=3e5,w=18e3;return g.prototype.onEvent=function(a,c){return this._disposed?this._logger.warn("Proto already disposed of. Unable to listen for event"):(b.isStringNotEmpty(a,"eventName"),b.isFunction(c,"handler"),this._namedEvents.listen(a,c))},g.prototype.onRequest=function(a,c){if(this._disposed)return this._logger.warn("Proto already disposed of. Unable to listen for request");b.isStringNotEmpty(a,"requestName"),b.isFunction(c,"handler"),this._requestListeners[a]&&this._logger.warn("May not set multiple handlers for the same request. Overriding existing handlers for request [%s]",a),this._requestListeners[a]=c;var e=this;return new d.Disposable(function(){e._requestListeners[a]=null})},g.prototype.sendRequest=function(c,d,e,f){if(this._disposed)return this._logger.warn("Proto already disposed of. Unable to send request"),e(null,{status:"proto-disposed"});f=f||{},b.isStringNotEmpty(c,"type"),b.isObject(d,"message"),b.isObject(f,"settings"),e&&b.isFunction(e,"callback"),f.timeout&&b.isNumber(f.timeout,"settings.timeout");var g=s+(this._nextRequestId++).toString(),h={requestId:g,type:c,payload:this._mqProtocol.encode(c,d),messageType:"Request"};return this._requests[g]=a.bind(j,this,g,c,d,f.timeout,e),l.call(this,g,h,d,f.timeout,e)},g.prototype.sendResponse=function(c,d,e,f){if(this._disposed)return this._logger.warn("Proto already disposed of. Unable to send response"),f(null,{status:"proto-disposed"});b.isStringNotEmpty(c,"requestId"),b.isStringNotEmpty(d,"type"),b.isObject(e,"message");var g=this._responses[c];g||(this._logger.error("Already responded to request [%s]",c),f(new Error("no-response-handler")));var h={requestId:c,type:d,payload:this._mqProtocol.encode(d,e),messageType:"Response",wallTime:[a.now()-g]};return m.call(this,h,e),delete this._responses[c],f(null,{status:"ok"})},g.prototype.disposeOfRequests=function(){a.forOwn(this._requestTimeouts,function(a){clearTimeout(a)}),a.forOwn(this._continuationTimeouts,function(a){clearTimeout(a)}),this._requests={},this._responses={},this._requestListeners={},this._requestTimeouts={},this._requestTimestamps={},this._continuationTimeouts={}},g.prototype.dispose=function(){this._disposed=!0,this._receiveCallback=null,this._sendCallback=null,this.disposeOfRequests(),this._namedEvents.dispose()},g.prototype.getApiVersion=function(){return this._mqProtocol.getApiVersion()},g.prototype.toString=function(){return"Proto["+this._webSocket.toString()+"]"},g}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(6),c(3)],e=function(a,b,c,d){"use strict";function e(a,c){b.isStringNotEmpty(a,"backendUri"),b.isObject(c,"authenticationData"),this._backendUri=a,this._authenticationData=c,this._disposables=new d.DisposableList}function f(b,c){var e=null,f=b(a.bind(h,this,function(a,b){clearTimeout(e),c(a,b)}));e=setTimeout(function(){f.dispose(),c(new Error("timeout"))},j),this._disposables.add(f),this._disposables.add(new d.Disposable(function(){clearTimeout(e)}))}function g(b){return a.assign({},b,this._authenticationData)}function h(a,b,c){if(b)return a(b,{});var d=JSON.parse(c.data);return"ok"!==d.status?a(null,{status:d.status}):a(null,d)}var i=0,j=2e4,k={timeout:j,retryOptions:{backoff:1.5,delay:1e3,maxAttempts:3,additionalRetryErrorCodes:[i]}};return e.prototype.dispose=function(){return this._disposables.dispose()},e.prototype.createAuthenticationToken=function(b){var d=g.call(this,{}),e=a.bind(c.postWithRetry,c,this._backendUri+"/auth",JSON.stringify(d),k);return f.call(this,e,b)},e.prototype.createStreamTokenForPublishing=function(d,e,h){b.isStringNotEmpty(d,"sessionId"),b.isObject(e,"capabilities");var i=g.call(this,{sessionId:d,capabilities:e}),j=a.bind(c.postWithRetry,c,this._backendUri+"/stream",JSON.stringify(i),k);return f.call(this,j,h)},e.prototype.createStreamTokenForSubscribing=function(d,e,h,i,j){b.isStringNotEmpty(d,"sessionId"),b.isObject(e,"capabilities"),a.isNullOrUndefined(i)||(b.isArray(i,"additionalStreamIds"),a.forEach(i,function(a){b.isStringNotEmpty(a,"alternateOriginStreamId")}));var l=g.call(this,{sessionId:d,capabilities:e,originStreamId:h});i&&i.length>0&&(l.alternateOriginStreamIds=i);var m=a.bind(c.postWithRetry,c,this._backendUri+"/stream",JSON.stringify(l),k);return f.call(this,m,j)},e.prototype.getStreams=function(b){var d=a.bind(c.getWithRetry,c,this._backendUri+"/streams",k);return f.call(this,d,b)},e}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(2)],e=function(a){"use strict";function b(){this.init()}return b.prototype.init=function(){if(!a.global.AudioContext&&!a.global.webkitAudioContext)throw new Error("Browser does not support AudioContext");this._audioContext=new(a.global.AudioContext||a.global.webkitAudioContext)},b.prototype.getNativeAudioContext=function(){return this._audioContext},b.prototype.toString=function(){return"AudioContext"},b}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1)],e=function(a,b){"use strict";function c(a){b.isObject(a,"pcast"),b.isFunction(a.getObservableStatus,"pcast.getObservableStatus"),b.isFunction(a.getLogger,"pcast.getLogger"),b.isFunction(a.getProtocol,"pcast.getProtocol"),this._pcast!==a&&(this._pcast=a,this._logger=a.getLogger(),this._protocol=a.getProtocol(),b.isObject(this._logger,"this._logger"),b.isObject(this._protocol,"this._protocol"),b.isFunction(this._protocol.getObservableSessionId,"this._protocol.getObservableSessionId"),b.isFunction(this._pcast.getObservableStatus,"this._pcast.getObservableStatus"),this._sessionId=this._protocol.getObservableSessionId(),this._status=this._pcast.getObservableStatus())}function d(a){return null!==a&&void 0!==a&&""!==a}function e(a){return null!==a&&void 0!==a&&""!==a&&"offline"!==a.toLowerCase()}return c.prototype.assertAuthorized=function(){if(!e(this.getPCastStatus()))throw new Error("Unable to perform action. Status [%s]. Please wait to reconnect.",this.getPCastStatus());if(!d(this.getPCastSessionId()))throw new Error("Unable to perform action. Invalid sessionId [%s]",this.getPCastSessionId())},c.prototype.getObservableSessionId=function(){return this._sessionId},c.prototype.getObservableStatus=function(){return this._status},c.prototype.getPCastSessionId=function(){return this._sessionId.getValue()},c.prototype.getPCastStatus=function(){return this._status.getValue()},c}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0)],e=function(a){"use strict";var b={};return b.parseEnvFromPcastBaseUri=function(b){return b=b.toLowerCase(),a.includes(b,"local")?"local":a.includes(b,"stg")?"staging":"production"},b}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1)],e=function(a,b){"use strict";function c(a,c){a&&b.isStringNotEmpty(a,"selectionStrategy"),b.isObject(c,"logger"),this._selectionStrategy=a||p,this._logger=c,this._lastSelectedMember=null,this._blackListedMembers=[]}function d(b){return!!a.find(this._blackListedMembers,function(a){return a.key===g(b)})}function e(b){b&&this._blackListedMembers.push({key:g(b),timestamp:a.now()})}function f(){var b=a.reduce(this._blackListedMembers,function(b,c){return b+a.now()-c.timestamp},0);return b>r}function g(a){return a?a.getSessionId()+a.getObservableScreenName().getValue():""}function h(b,c){switch(this._selectionStrategy){case p:return i(b);case q:if(this._lastSelectedMember&&!c)return this._lastSelectedMember;var d=n.call(this,b);c&&(d=o(d,this._lastSelectedMember));var e=a.filter(d,j);return 0===e.length&&(e=a.filter(d,k)),0===e.length&&(e=d),a.sample(e);default:throw new Error("Invalid Selection Strategy")}}function i(b){return a.reduce(b,function(a,b){return a&&a.getLastUpdate()>b.getLastUpdate()?a:b})}function j(a){var b=a.getObservableScreenName().getValue();return l(b)}function k(a){var b=a.getObservableScreenName().getValue();return m(b)}function l(a){var b=/primary/i;return b.test(a)}function m(a){var b=/alternate/i;return b.test(a)}function n(b){var c=this;return a.filter(b,function(a){return!d.call(c,a)})}function o(b,c){return a.filter(b,function(a){return g(a)!==g(c)})}var p="most-recent",q="high-availability",r=18e4;return c.prototype.getNext=function(a,b){var c=h.call(this,a,b);return this.getNumberOfBlackListedMembers()>0&&f.call(this)&&!c?(this._logger.info("Unable to select new member. Clearing [%s] black-listed members and trying again",this.getNumberOfBlackListedMembers()),this.clearBlackListedMembers(),this.getNext(a,b)):(this._lastSelectedMember!==c&&(c?this._logger.info("Selecting new Member [%s]/[%s]",c.getSessionId(),c.getObservableScreenName().getValue()):this._logger.info("Unable to select new member"),this._lastSelectedMember&&!d.call(this,this._lastSelectedMember)&&e.call(this,this._lastSelectedMember)),this._lastSelectedMember=c,c)},c.prototype.getStrategy=function(){return this._selectionStrategy},c.prototype.clearBlackListedMembers=function(){this._blackListedMembers=[]},c.prototype.getNumberOfBlackListedMembers=function(){return this._blackListedMembers.length},c.prototype.dispose=function(){this._lastSelectedMember=null,this._blackListedMembers=[]},c.getSimilarMembers=function(b,c){var d=a.filter(c,function(a){return a.getObservableScreenName().getValue()!==b}),e=a.filter(d,j),f=a.filter(d,k);return l(b)?e||f||d:m(b)?f||e||d:d||e||f},c}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";var a={"package":"telemetry",messages:[{name:"LogData",fields:[{rule:"required",type:"LogLevel",name:"level",id:1},{rule:"required",type:"string",name:"timestamp",id:2},{rule:"required",type:"string",name:"category",id:3},{rule:"required",type:"string",name:"message",id:4},{rule:"optional",type:"string",name:"source",id:5},{rule:"optional",type:"string",name:"fullQualifiedName",id:11},{rule:"optional",type:"string",name:"sessionId",id:6},{rule:"optional",type:"string",name:"userId",id:7},{rule:"optional",type:"string",name:"environment",id:8},{rule:"optional",type:"string",name:"version",id:9},{rule:"optional",type:"float",name:"runtime",id:10}]},{name:"StoreLogRecords",fields:[{rule:"repeated",type:"LogData",name:"records",id:1}]},{name:"StoreLogRecordsResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"required",type:"uint64",name:"storedRecords",id:2}]},{name:"MetricValue",fields:[{rule:"optional",type:"string",name:"string",id:1},{rule:"optional",type:"float",name:"float",id:2},{rule:"optional",type:"uint64",name:"uint64",id:3},{rule:"optional",type:"int64",name:"int64",id:4},{rule:"optional",type:"bool",name:"boolean",id:5},{rule:"optional",type:"string",name:"timestamp",id:6}]},{name:"MetricData",fields:[{rule:"required",type:"string",name:"timestamp",id:1},{rule:"optional",type:"string",name:"sessionId",id:2},{rule:"optional",type:"string",name:"streamId",id:3},{rule:"optional",type:"string",name:"source",id:4},{rule:"optional",type:"string",name:"resource",id:5},{rule:"optional",type:"string",name:"kind",id:6},{rule:"required",type:"Metric",name:"metric",id:7},{rule:"optional",type:"MetricValue",name:"value",id:8},{rule:"optional",type:"MetricValue",name:"previousValue",id:9},{rule:"optional",type:"uint64",name:"elapsed",id:10},{rule:"optional",type:"string",name:"fullQualifiedName",id:11},{rule:"optional",type:"string",name:"environment",id:12},{rule:"optional",type:"string",name:"version",id:13},{rule:"optional",type:"string",name:"tool",id:14},{rule:"optional",type:"string",name:"toolVersion",id:15},{rule:"required",type:"float",name:"runtime",id:16}]},{name:"SubmitMetricRecords",fields:[{rule:"repeated",type:"MetricData",name:"records",id:1}]},{name:"SubmitMetricRecordsResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"required",type:"uint64",name:"storedRecords",id:2}]}],enums:[{name:"LogLevel",values:[{name:"Trace",id:0},{name:"Debug",id:1},{name:"Info",id:2},{name:"Warn",id:3},{name:"Error",id:4},{name:"Fatal",id:5}]},{name:"Metric",values:[{name:"RoundTripTime",id:0},{name:"DownlinkThroughputCapacity",id:26},{name:"Initialized",id:1},{name:"Provisioned",id:2},{name:"SetupCompleted",id:3},{name:"Offset",id:4},{name:"TimeToFirstFrame",id:5},{name:"Playing",id:6},{name:"Stalled",id:7},{name:"Buffering",id:8},{name:"Seeking",id:22},{name:"Stopped",id:9},{name:"BitRateAdaptation",id:10},{name:"ResolutionChanged",id:11},{name:"DisplayResolutionChanged",id:23},{name:"VideoBitRate",id:28},{name:"AudioBitRate",id:29},{name:"FrameRateChanged",id:12},{name:"FramesDropped",id:13},{name:"PacketsLost",id:14},{name:"PictureLost",id:15},{name:"PlayoutDelayChanged",id:16},{name:"CodecChanged",id:17},{name:"PlayerEvent",id:21},{name:"MetricDropped",id:18},{name:"NetworkOffline",id:19},{name:"NetworkOnline",id:20},{name:"NetworkType",id:27},{name:"ApplicationForeground",id:24},{name:"ApplicationBackground",id:25}]}]};return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1)],e=function(a,b){"use strict";function c(a){b.isObject(a,"room"),this._room=a}return c.prototype.getChannelId=function(){return this._room.getRoomId.apply(this._room,arguments)},c.prototype.getObservableAlias=function(){return this._room.getObservableAlias.apply(this._room,arguments)},c.prototype.getObservableName=function(){return this._room.getObservableName.apply(this._room,arguments)},c.prototype.getObservableDescription=function(){return this._room.getObservableDescription.apply(this._room,arguments)},c.prototype.getObservableType=function(){return this._room.getObservableType.apply(this._room,arguments)},c.prototype.getObservableMembers=function(){return this._room.getObservableMembers.apply(this._room,arguments)},c.prototype.getObservableBridgeId=function(){return this._room.getObservableBridgeId.apply(this._room,arguments)},c.prototype.getObservablePin=function(){return this._room.getObservablePin.apply(this._room,arguments)},c.prototype.toString=function(){return this._room.toString.apply(this._room,arguments)},c.prototype.toJson=function(){return{channelId:this._room.getRoomId(),alias:this._room.getObservableAlias().getValue(),name:this._room.getObservableName().getValue(),description:this._room.getObservableDescription().getValue(),type:this._room.getObservableType().getValue(),pin:this._room.getObservablePin().getValue(),bridgeId:this._room.getObservableBridgeId().getValue()}},c.prototype.commitChanges=function(){return this._room.commitChanges.apply(this._room,arguments)},c.prototype.reload=function(){return this._room.reload.apply(this._room,arguments)},c.prototype._update=function(){return this._room._update.apply(this._room,arguments)},c.prototype._addMembers=function(){return this._room._addMembers.apply(this._room,arguments)},c.prototype._removeMembers=function(){return this._room._removeMembers.apply(this._room,arguments)},c.prototype._updateMembers=function(){return this._room._updateMembers.apply(this._room,arguments)},c}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(4),c(18),c(10)],e=function(a,b,c,d,e){"use strict";function f(a,b,c,d,e,f,g){this.init(a,b,c,d,e,f,g)}function g(a){return new d(a.uri,a.type,a.audioState,a.videoState)}function h(b){var c=this._streams.getValue(),e=[];a.forEach(b,function(b){var f=d.parsePCastStreamIdFromStreamUri(b.uri),h=a.find(c,function(a){var c=a.getUri()===b.uri,d=a.isPCastStream()&&a.getPCastStreamId()===f,e=c||d;return a.getType()===b.type&&e});h?h._update(b):h=g(b),e.push(h)}),this._streams.setValue(e)}function i(b){if(b=a.getEnumName(k,b),!b)throw new Error('"role" must be a valid member role');return b}function j(b){if(b=a.getEnumName(l,b),!b)throw new Error('"state" must be a valid member state');return b}var k=e.roles,l=e.states;return f.prototype.init=function(d,e,f,g,h,k,l){b.isString(f,"sessionId"),b.isString(g,"screenName"),b.isArray(k,"streams"),b.isNumber(a.utc(l),"lastUpdate"),d&&b.isObject(d,"roomService"),this._sessionId=new c.Observable(f),this._screenName=new c.Observable(g),this._streams=new c.ObservableArray([]),this._state=new c.Observable(e,j).extend({rateLimit:500}),this._role=new c.Observable(h,i),this._lastUpdate=new c.Observable(l,a.utc),this._roomService=d,this.setStreams(k)},f.prototype.getObservableState=function(){return this._state},f.prototype.getSessionId=function(){return this._sessionId.getValue()},f.prototype.getObservableScreenName=function(){return this._screenName},f.prototype.getObservableRole=function(){return this._role},f.prototype.getObservableStreams=function(){return this._streams},f.prototype.getObservableLastUpdate=function(){return this._lastUpdate},f.prototype.getLastUpdate=function(){return this._lastUpdate.getValue()},f.prototype.getStreams=function(){return a.map(this._streams.getValue(),function(a){return a.toJson()})},f.prototype.commitChanges=function(a){b.isObject(this._roomService,"this._roomService"),this._roomService.updateMember(this,a)},f.prototype.reload=function(){b.isObject(this._roomService,"this._roomService"),this._roomService.revertMemberChanges(this)},f.prototype.setStreams=function(b){var c=a.map(b,function(a){return g(a)});this._streams.setValue(c)},f.prototype.toString=function(){return this.getObservableRole().getValue()+"["+this.getObservableScreenName().getValue()+","+this.getSessionId()+"]"},f.prototype.toJson=function(){var b={sessionId:this._sessionId.getValue(),screenName:this._screenName.getValue(),role:this._role.getValue(),state:this._state.getValue(),streams:[],lastUpdate:this._lastUpdate.getValue()};return a.forEach(this._streams.getValue(),function(a){b.streams.push(a.toJson())}),b},f.prototype._update=function(b){a.isObject(b)&&(b.hasOwnProperty("state")&&this._state.setValue(b.state),b.hasOwnProperty("screenName")&&this._screenName.setValue(b.screenName),b.hasOwnProperty("role")&&this._role.setValue(b.role),b.hasOwnProperty("lastUpdate")&&this._lastUpdate.setValue(b.lastUpdate),b.hasOwnProperty("streams")&&h.call(this,b.streams))},f}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(4),c(39),c(11)],e=function(a,b,c,d,e){"use strict";function f(a,b,c,d,e,f,g,h,i){this.init(a,b,c,d,e,f,g,h,i)}function g(a){var b=h(a,this._roomService);this._members.setValue(b)}function h(b,c){return a.map(b,function(a){return new d(c,a.state,a.sessionId,a.screenName,a.role,a.streams,a.lastUpdate)})}function i(b){if(b=a.getEnumName(j,b),!b)throw new Error('"type" must be a valid room type');return b}var j=e.types;return f.prototype.init=function(a,d,e,f,h,j,k,l,m){b.isStringNotEmpty(f,"name"),b.isStringNotEmpty(h,"description"),b.isArray(k,"members"),d&&b.isStringNotEmpty(d,"id"),e&&b.isStringNotEmpty(e,"alias"),l&&b.isStringNotEmpty(l,"bridgeId"),m&&b.isStringNotEmpty(m,"pin"),a&&b.isObject(a,"roomService"),this._roomId=new c.Observable(d),this._alias=new c.Observable(e),this._name=new c.Observable(f),this._description=new c.Observable(h),this._type=new c.Observable(j,i),this._members=new c.ObservableArray([]).extend({method:"notifyWhenChangesStop",timeout:400}),this._options=new c.ObservableArray,this._bridgeId=new c.Observable(l),this._pin=new c.Observable(m),this._roomService=a,g.call(this,k)},f.prototype.getRoomId=function(){return this._roomId.getValue()},f.prototype.getObservableAlias=function(){return this._alias},f.prototype.getObservableName=function(){return this._name},f.prototype.getObservableDescription=function(){return this._description},f.prototype.getObservableType=function(){return this._type},f.prototype.getObservableMembers=function(){return this._members},f.prototype.getObservableBridgeId=function(){return this._bridgeId},f.prototype.getObservablePin=function(){return this._pin},f.prototype.toString=function(){return this._type.getValue()+"["+this._roomId.getValue()+"]"},f.prototype.toJson=function(){return{roomId:this._roomId.getValue(),alias:this._alias.getValue(),name:this._name.getValue(),description:this._description.getValue(),type:this._type.getValue(),pin:this._pin.getValue(),bridgeId:this._bridgeId.getValue()}},f.prototype.commitChanges=function(a){b.isObject(this._roomService,"this._roomService"),this._roomService.updateRoom(this,a)},f.prototype.reload=function(){b.isObject(this._roomService,"this._roomService"),this._roomService.revertRoomChanges(this)},f.prototype._update=function(b){a.isObject(b)&&(b.roomId&&this._roomId.setValue(b.roomId),b.alias&&this._alias.setValue(b.alias),b.name&&this._name.setValue(b.name),b.description&&this._description.setValue(b.description),b.type&&this._type.setValue(b.type),b.options&&this._options.setValue(b.options),b.bridgeId&&this._bridgeId.setValue(b.bridgeId),b.pin&&this._pin.setValue(b.pin),b.members)},f.prototype._addMembers=function(b){var c=this,d=h(b);a.forEach(d,function(a){c._members.push(a)})},f.prototype._removeMembers=function(b){var c=this;a.forEach(b,function(a){c._members.remove(function(b){return a.sessionId===b.getSessionId()&&a.lastUpdate>=b.getObservableLastUpdate().getValue()})})},f.prototype._updateMembers=function(b){a.forEach(this._members.getValue(),function(c){var d=a.find(b,function(a){return c.getSessionId()===a.sessionId&&a.lastUpdate>c.getObservableLastUpdate().getValue()});d&&c._update(d)})},f}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";var a={states:{trackEnabled:{id:0,name:"TrackEnabled"},trackDisabled:{id:1,name:"TrackDisabled"},trackEnded:{id:2,name:"TrackEnded"}}};return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0)],e=function(a){"use strict";function b(){}function c(b,c){if(!b)return null;var f=[],g=function(b,g,h,i,j,k){if(b){a.hasIndexOrKey(c,b)||(c[b]={timestamp:0});var l=parseFloat(h)-c[b].timestamp,m=d(parseFloat(i),c[b].bytesSent,l),n=e(parseFloat(j),c[b].bytesReceived,l);c[b].bytesSent=parseFloat(i),c[b].bytesReceived=parseFloat(j),c[b].timestamp=parseFloat(h),f.push({uploadRate:m,downloadRate:n,mediaType:g,ssrc:b,direction:k})}};return a.isFunction(b.result)?a.forEach(b.result(),function(a){if("ssrc"===a.type){var b=a.stat("ssrc"),c=a.stat("bytesSent"),d=a.stat("bytesReceived"),e=a.stat("mediaType"),f=a.timestamp.getTime(),h=a.id.indexOf("send")>-1?"upload":"download";g(b,e,f,c,d,h)}}):a.isFunction(b.values)?a.forEach(Array.from(b.values()),function(b){if(a.hasIndexOrKey(b,"ssrc")){if(!b.ssrc||a.includes(b.id,"rtcp"))return;var c=b.type.indexOf("outbound")>-1?"upload":"download";g(b.ssrc,b.mediaType,b.timestamp,b.bytesSent,b.bytesReceived,c)}}):a.forEach(b,function(b){if(a.hasIndexOrKey(b,"ssrc")){if(!b.ssrc||a.includes(b.id,"rtcp"))return;var c=b.type.indexOf("outbound")>-1?"upload":"download";g(b.ssrc,b.mediaType,b.timestamp,b.bytesSent,b.bytesReceived,c)}}),f}function d(a,b,c){if(a){var d=b||0,e=8e3*(a-d)/c;return Math.round(e/1e3)}return 0}function e(a,b,c){if(a){var d=b||0,e=8e3*(a-d)/c;return Math.round(e/1e3)}return 0}return b.convertPeerConnectionStats=function(a,b){return c(a,b)},b}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(2)],e=function(a,b,c){"use strict";function d(a,c,d){b.isString(a,"name"),b.isObject(c,"peerConnection"),b.isObject(d,"logger"),this._name=a,this._peerConnection=c,this._logger=d}function e(b,d,e,g,m){function r(C){var D=null;h.call(s,d,D,g,function(h){function D(a,d){var g=a.id||a.ssrc,h=null;if(a.framesEncoded){var i=new f(a.framesEncoded);a.framerateMean=n(i,A[g],2*s._frameRateFailureThreshold),A[g]=i}switch(c.browser){case"Safari":case"Firefox":case"Edge":case"IE":if(I=H|=a.selected&&"succeeded"===a.state||"IE"===c.browser||"Edge"===c.browser||"Safari"===c.browser,"outbound"===e.direction&&("outboundrtp"===a.type||"outbound-rtp"===a.type||"kOutboundRtp"===a.type))switch(h=new f(a.bytesSent),a.mediaType){case"video":s._logger.debug("[%s] Outbound [%s] [%s] with bitrate [%s], droppedFrames [%s] and frame rate [%s]",b,a.mediaType,a.ssrc,a.bitrateMean,a.droppedFrames,a.framerateMean),E=!0,u=a.framerateMean||0,F=!0,v=o(h,z[g],2*s._videoBitRateFailureThreshold),z[g]=h,"Edge"===c.browser&&(E=!1);break;case"audio":s._logger.debug("[%s] Outbound [%s] [%s]",b,a.mediaType,a.ssrc),G=!0,w=o(h,y[g],2*s._audioBitRateFailureThreshold),y[g]=h}if("inbound"===e.direction&&("inboundrtp"===a.type||"inbound-rtp"===a.type||"kInboundRtp"===a.type))switch(h=new f(a.bytesReceived),a.mediaType){case"video":s._logger.debug("[%s] Inbound [%s] [%s] with framerate [%s] and jitter [%s]",b,a.mediaType,a.ssrc,a.framerateMean,a.jitter),F=!0,v=o(h,z[g],2*s._videoBitRateFailureThreshold),z[g]=h;break;case"audio":s._logger.debug("[%s] Inbound [%s] [%s] with jitter [%s]",b,a.mediaType,a.ssrc,a.jitter),G=!0,w=o(h,y[g],2*s._audioBitRateFailureThreshold),y[g]=h}break;case"Chrome":default:if("true"===a.googWritable&&(I=!0),"true"===a.googReadable&&(H=!0),"ssrc"!==a.type)return;if("outbound"===e.direction)switch(h=new f(a.bytesSent),a.mediaType){case"video":s._logger.debug("[%s] Outbound [%s] [%s] with average encoding time [%s] ms (CPU limited=[%s]) and RTT [%s]",b,a.mediaType,a.ssrc,a.googAvgEncodeMs,a.googCpuLimitedResolution,a.googRtt),E=!0,u=a.googFrameRateSent||0,F=!0,v=o(h,z[g],2*s._videoBitRateFailureThreshold),z[g]=h;break;case"audio":s._logger.debug("[%s] Outbound [%s] [%s] with audio input level [%s] and RTT [%s] and jitter [%s]",b,a.mediaType,a.ssrc,a.audioInputLevel,a.googRtt,a.googJitterReceived),G=!0,w=o(h,y[g],2*s._audioBitRateFailureThreshold),y[g]=h}else if("inbound"===e.direction)switch(h=new f(a.bytesReceived),
a.mediaType){case"video":s._logger.debug("[%s] Inbound [%s] [%s] with current delay [%s] ms and target delay [%s] ms",b,a.mediaType,a.ssrc,a.googCurrentDelayMs,a.googTargetDelayMs),E=!0,u=a.googFrameRateReceived||0,F=!0,v=o(h,z[g],2*s._videoBitRateFailureThreshold),z[g]=h;break;case"audio":s._logger.debug("[%s] Inbound [%s] [%s] with output level [%s] and jitter [%s] and jitter buffer [%s] ms",b,a.mediaType,a.ssrc,a.audioOutputLevel,a.googJitterReceived,a.googJitterBufferMs),G=!0,w=o(h,y[g],2*s._audioBitRateFailureThreshold),y[g]=h}}}var E=!1,F=!1,G=!1,H=!1,I=!1;if(!g())return s._logger.info("[%s] Finished monitoring of peer connection",b);if(!h)throw new Error("Report must be a valid PeerConnection.getStats Report");h.forEach?h.forEach(D):a.forOwn(h,function(a,b){D(a,b)});var J=k(d),K=l(d);if((F&&0===v||G&&0===w||E&&0===u)&&(F=F&&K,G=G&&J,E=E&&K,H=H||!(K||J),I=I||!(K||J)),(G||F||E)&&s._logger.debug("[%s] Current bit rate is [%s] bps for audio and [%s] bps for video with [%s] FPS",b,Math.ceil(w||0),Math.ceil(v||0),u||"?"),!s._monitorState||"closed"!==d.connectionState&&"failed"!==d.connectionState&&"failed"!==d.iceConnectionState)s._monitorFrameRate&&E&&u<=s._frameRateFailureThreshold&&!q.call(s,"video")?t++:s._monitorBitRate&&G&&w<=s._audioBitRateFailureThreshold&&!q.call(s,"audio")?t++:s._monitorBitRate&&F&&v<=s._videoBitRateFailureThreshold&&!q.call(s,"video")?t++:H&&I?t=0:t++;else{var L=J&&K,M=i.call(s,d);if(!L&&j(d))return void s._logger.info("[%s] Finished monitoring of peer connection with [%s] inactive tracks",b,M.length);t++}var N=!(0!==v&&F||0!==w&&G||p.call(s));N&&!B?B=setTimeout(a.bind(r,this,!0),x):N||(clearTimeout(B),B=null);var O=C&&N&&B,P=function(){s._logger.info("[%s] Failure has been acknowledged",b),t=Number.MIN_VALUE,setTimeout(r,s._monitoringInterval)};if(t>=s._conditionCountForNotificationThreshold||O){var Q="["+b+"] Failure detected with frame rate ["+u+"] FPS, audio bit rate ["+w+"] bps, and video bit rate ["+v+"] bps",R="["+b+"] Failure detected with 0 bps audio and video for ["+x/1e3+"] seconds",S=O?R:Q,T={type:"condition",message:S,report:h,frameRate:u,videoBitRate:v,audioBitRate:w,acknowledgeFailure:P};m(null,T)?P():s._logger.error(S+": [%s]",h)}else setTimeout(r,t>0?s._conditionMonitoringInterval:s._monitoringInterval)},function(a){m(a,{type:"error",message:"Unable to get Connection statistics. Connection may have failed."})})}var s=this,t=0,u=void 0,v=void 0,w=void 0,y={},z={},A={},B=null;setTimeout(r,s._monitoringInterval)}function f(b){this.time=a.now(),this.value=b||0}function g(b){var d={};switch(c.browser){case"Firefox":return b;case"IE":return a.forOwn(b,function(b,c){a.startsWith(c,"ssrc")&&(d[b.id]=b)}),d;case"Safari":case"Edge":return b.forEach(function(a){d[a.id]=a}),d;case"ReactNative":var e=a.isString(b)?JSON.parse(b):b;return e.forEach(function(b){var c={id:b.id,type:b.type};b.values.forEach(function(b){a.keys(b).forEach(function(a){c[a]=b[a]})}),d[c.id]=c}),d;case"Chrome":default:return b.result().forEach(function(a){var b={id:a.id,type:a.type};a.names().forEach(function(c){b[c]=a.stat(c)}),d[b.id]=b}),d}}function h(a,b,d,e,f){return d()?void c.getStats(a,null,function(a){var b=g(a);e(b)},function(a){f(a)}):this._logger.info("[%s] Finished monitoring of peer connection",this._name)}function i(b){var c=b.getLocalStreams?b.getLocalStreams():[],d=b.getRemoteStreams?b.getRemoteStreams():[],e=[],f=[];if(a.forEach(c,function(a){e=e.concat(a.getTracks())}),a.forEach(d,function(a){f=f.concat(a.getTracks())}),0!==e.length&&0!==f.length)throw this._logger.error("Invalid State. PeerConnection contains [%s] local and [%s] remote streams.",c.length,d.length),new Error("Invalid State. PeerConnection contains both local and remote streams.");return 0!==e.length?e:0!==f.length?f:[]}function j(b){var c=m(b,function(b){return a.startsWith(b,"video")||a.startsWith(b,"audio")});return a.isNumber(c)}function k(b){var c=m(b,function(b,c,d){return!!a.startsWith(b,"audio")&&(!a.includes(b,"a=inactive")&&!a.includes(d[c],"a=inactive"))});return a.isNumber(c)}function l(b){var c=m(b,function(b,c,d){return!!a.startsWith(b,"video")&&(!a.includes(b,"a=inactive")&&!a.includes(d[c],"a=inactive"))});return a.isNumber(c)}function m(b,c){var d=b.localDescription.sdp.split("m="),e=b.remoteDescription.sdp.split("m=");return d.length===e.length&&a.findIndex(d,function(a,b){return c(a,b,e)})}function n(a,b,c){return b?(a.value-b.value)/((a.time-b.time)/1e3):c}function o(a,b,c){return b?8*(a.value-b.value)/((a.time-b.time)/1e3):c}function p(){var b=this;return a.reduce(i(this._peerConnection),function(c,d){if(!c)return c;var e=!!a.find(b._pausedTracks,function(a){return a.id===d.id});return!d.enabled||e},!0)}function q(b){var c=i(this._peerConnection),d=a.filter(c,function(a){return a.kind===b}),e=a.filter(this._pausedTracks,function(a){return a.kind===b});return a.reduce(d,function(b,c){if(!b)return b;var d=!!a.find(e,function(a){return a.id===c.id});return!c.enabled||d},!0)}var r=4e3,s=1500,t=2,u=5e3,v=6e3,w=3,x=5e3,y=6e3,z=2;return d.prototype.start=function(a,d,f){if(b.isObject(a,"options"),b.isFunction(d,"activeCallback"),b.isFunction(f,"monitorCallback"),"inbound"!==a.direction&&"outbound"!==a.direction)throw new Error("Invalid monitoring direction");if(this._frameRateFailureThreshold=a.frameRateThreshold||t,this._videoBitRateFailureThreshold=a.videoBitRateThreshold||v,this._audioBitRateFailureThreshold=a.audioBitRateThreshold||u,this._conditionCountForNotificationThreshold=a.conditionCountForNotificationThreshold||w,this._monitoringInterval=a.monitoringInterval||r,this._conditionMonitoringInterval=a.monitoringInterval||s,this._monitorFrameRate=!a.hasOwnProperty("monitorFrameRate")||a.monitorFrameRate,this._monitorBitRate=!a.hasOwnProperty("monitorBitRate")||a.monitorBitRate,this._monitorState=!a.hasOwnProperty("monitorState")||a.monitorState,this._pausedTracks=[],"Edge"===c.browser){var g=this._conditionMonitoringInterval*this._conditionCountForNotificationThreshold;this._monitoringInterval=Math.max(this._monitoringInterval,y),this._conditionMonitoringInterval=Math.max(this._conditionMonitoringInterval,y),this._conditionCountForNotificationThreshold=Math.max(Math.ceil(g/this._monitoringInterval),z),this._logger.info("Using modified options for optimal monitoring of PeerConnection on [Edge]. Monitor Interval [%s], Condition Monitor Interval [%s], Condition Count For Notification [%s]",this._monitoringInterval,this._conditionMonitoringInterval,this._conditionCountForNotificationThreshold)}return e.call(this,this._name,this._peerConnection,a,d,f)},d.prototype.setMonitorTrackState=function(c,d){b.isObject(c,"track"),b.isBoolean(d,"state");var e=i(this._peerConnection),f=!!a.find(e,function(a){return a.id===c.id});if(!f)return this._logger.warn("[%s] Unable to find track [%s] [%s] in peer connection",this._name,c.kind,c.id);if(!d)return this._logger.info("[%s] Pausing monitoring of track [%s] [%s]",this._name,c.kind,c.id),this._pausedTracks.push(c);var g=this._pausedTracks.length;this._pausedTracks=a.filter(this._pausedTracks,function(a){return a.id!==c.id}),g!==this._pausedTracks.length&&this._logger.info("[%s] Starting monitoring of track [%s] [%s] after it was paused",this._name,c.kind,c.id)},d.prototype.toString=function(){return"PeerConnectionMonitor["+this._name+"]"},d}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b){},function(a,b,c){var d,e;d=[c(0),c(1),c(17),c(16),c(33),c(77),c(75)],e=function(a,b,c,d,e,f,g){"use strict";function h(g,h){b.isArray(g,"userMediaStreams"),h=h||{},this._baseUri=h.uri||d.DefaultPCastUri,this._logger=h.logger||c.createPCastLogger(this._baseUri),this._audioContext=h.audioContext||new e,this._nativeAudioContext=this._audioContext.getNativeAudioContext(),this._onSpeakingChanged=null,this._userMediaStreams=g,this._disposeOfAudioContext=!a.isObject(h.audioContext),this._audioVolumeMeterFactory=new f(this._logger),a.forEach(this._userMediaStreams,a.bind(i,this,h))}function i(a,c){b.isObject(c,"stream"),b.isObject(a,"options");var d=this._audioVolumeMeterFactory.getAudioVolumeMeter(c);d.init(this._nativeAudioContext,a.alpha),d.connect(c)}function j(a,c){b.isObject(c,"stream"),b.isObject(a,"options");var d=this._audioVolumeMeterFactory.getAudioVolumeMeter(c),e=new g(this._logger);a.alpha&&d.setAlpha(a.alpha),e.onValue(this._onSpeakingChanged),e.startDetection(d,a)}return h.prototype.start=function(c,d){b.isFunction(d,"callback"),this._onSpeakingChanged=d,c=c||{},a.forEach(this._userMediaStreams,a.bind(j,this,c))},h.prototype.stop=function(){a.forEach(this.getAudioVolumeMeters(),function(a){a.onValue(function(){})}),this._onSpeakingChanged=null},h.prototype.getAudioVolumeMeter=function(a){return b.isObject(a,"stream"),this._audioVolumeMeterFactory.getAudioVolumeMeter(a)},h.prototype.getAudioVolumeMeters=function(){return this._audioVolumeMeterFactory.getAudioVolumeMeters()},h.prototype.dispose=function(){this._disposeOfAudioContext&&this._nativeAudioContext.close(),this._audioVolumeMeterFactory.stopAllMeters(),this._userMediaStreams=null},h.prototype.toString=function(){return"AudioSpeakerDetector"},h}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(17),c(16),c(78)],e=function(a,b,c,d,e){"use strict";function f(a,e){b.isArray(a,"userMediaStreams"),e=e||{},this._baseUri=e.uri||d.DefaultPCastUri,this._logger=e.logger||c.createPCastLogger(this._baseUri),this._publisherAdjusters=[],this._publishers=a}function g(a,b,c){var d=new e(c);d.connect(a,b),this._publisherAdjusters.push(d)}return f.prototype.start=function(b,c){c=c||{},a.forEach(this._publishers,a.bind(g,this,b,c))},f.prototype.stop=function(){a.forEach(this._publisherAdjusters,function(a){a.close()}),this._publisherAdjusters=[]},f.prototype.toString=function(){return"BandwidthMonitor"},f}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(4),c(3),c(22),c(85),c(38),c(36),c(18),c(11),c(10),c(19)],e=function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";function m(c){b.isObject(c,"options"),c.roomExpress?b.isObject(c.roomExpress,"options.roomExpress"):(b.isStringNotEmpty(c.backendUri,"options.backendUri"),b.isObject(c.authenticationData,"options.authenticationData"));var d=a.assign({reconnectOptions:p},c);this._roomExpress=c.roomExpress||new e(d),this._shouldDisposeOfRoomExpress=!c.roomExpress,this._logger=this._roomExpress.getPCastExpress().getPCast().getLogger()}function n(b){var c=!0,d=i.getInfoFromStreamUri(b);return 0===a.values(d).length?c:!!d.streamTokenForLiveStream||!!d.streamTokenStreaming}function o(a,b,c){c&&c.roomService&&(c.channelService=new f(c.roomService),delete c.roomService),c&&c.room&&(c.channel=new g(c.room),delete c.room),a(b,c)}var p={maxOfflineTime:864e5,maxReconnectFrequency:6e4};return m.prototype.dispose=function(){this._shouldDisposeOfRoomExpress&&this._roomExpress.dispose()},m.prototype.getRoomExpress=function(){return this._roomExpress},m.prototype.getPCastExpress=function(){return this._roomExpress.getPCastExpress()},m.prototype.createChannel=function(c,d){b.isObject(c,"options"),b.isObject(c.channel,"options.channel");var e=a.assign({room:c.channel},c);e.room.type=j.types.channel.name,delete e.channel,this._roomExpress.createRoom(e,a.bind(o,null,d))},m.prototype.joinChannel=function(c,d,e){b.isObject(c,"options"),b.isFunction(d,"joinChannelCallback"),b.isFunction(e,"subscriberCallback"),c.videoElement&&b.isObject(c.videoElement,"options.videoElement"),c.streamSelectionStrategy&&b.isStringNotEmpty(c.streamSelectionStrategy,"options.streamSelectionStrategy");var f,g,i,l=a.assign({type:j.types.channel.name,role:k.roles.audience.name},c),m=new h(c.streamSelectionStrategy,this._logger),p="",q=this;l.channelId&&(l.roomId=l.channelId),delete l.channelId;var r=function(b,c){var e=!c||a.assign({},c);if(c&&c.roomService){var g=c.roomService.leaveRoom,h=c.roomService.getObservableActiveRoom().getValue();i=c.roomService,p=h?h.getRoomId():"",q._logger.info("Joined channel [%s] with [%s] selection strategy",p,m.getStrategy()),e.roomService.leaveRoom=function(a){f&&f.stop(),g(a)}}o(d,b,e)};q._roomExpress.joinRoom(l,r,function s(b,d){function h(a,b,c){if(g===a)return b?u("unable-to-subscribe"):"app-background"===c.reason?e(b,c):c.retry&&"high-availability"!==m.getStrategy()?c.retry():"ok"!==c.status?u(c.status):void 0}var j=a.filter(b,function(a){return a.getObservableRole().getValue()===k.roles.presenter.name&&a.getObservableStreams().getValue().length>0}),l=!!d||!f||!g,o=m.getNext(j,l),r=o?o.getObservableStreams().getValue()[0]:null,t=r?r.getPCastStreamId():"";if(!o||!r)return 0===j.length?e(null,{status:"no-stream-playing"}):d?(q._logger.info("Unable to find a new presenter to replace stream [%s] that ended in channel [%s] with status [%s] and [%s] black-listed members",g,p,d,m.getNumberOfBlackListedMembers()),e(null,{status:d||"unable-to-recover"})):e(null,{status:"no-stream-playing"});if(!n(r.getUri())&&a.includes(c.capabilities,"streaming"))return e(null,{status:"streaming-not-available"});if(!t)return q._logger.info("Channel [%s] presenter has no stream",p),e(null,{status:"no-stream-playing"});if(t!==g){g&&f&&f.stop();var u=function(a){var b=i?i.getObservableActiveRoom().getValue():null,c=b?b.getObservableMembers().getValue():[];if(b)return s(c,a)},v=a.assign({},{monitor:{callback:a.bind(h,this,t),options:{conditionCountForNotificationThreshold:8}}},c),w=d?"recovered-from-failure":"stream-override",x=g?w:"stream-started";g=t;var y=function(a,b,c){if(g===a){if(c&&"ok"===c.status&&(c.reason=x),b||c&&"ok"!==c.status)return q._logger.info("[%s] Issue with stream [%s]. Trying next member",a,c?c.status:"",b),u(c?c.status:"");c&&c.mediaStream?f=c.mediaStream:(g=null,f=null),e(b,c)}};q._roomExpress.subscribeToMemberStream(r,v,a.bind(y,this,t))}else if(d)return q._logger.info("Unable to find a new presenter to replace stream [%s] that ended in channel [%s] with status [%s]",g,p,d),e(null,{status:d||"unable-to-recover"})})},m.prototype.publishToChannel=function(c,d){b.isObject(c,"options"),b.isFunction(d,"callback");var e=a.assign({memberRole:k.roles.presenter.name,streamType:l.types.presentation.name,room:c.channel},c);e.room.type=j.types.channel.name,delete e.channel,this._roomExpress.publishToRoom(e,a.bind(o,null,d))},m.prototype.publishScreenToChannel=function(c,d){b.isObject(c,"options"),b.isFunction(d,"callback");var e=a.assign({memberRole:k.roles.presenter.name,streamType:l.types.presentation.name,room:c.channel},c);e.room.type=j.types.channel.name,delete e.channel,this._roomExpress.publishScreenToRoom(e,a.bind(o,null,d))},m}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e,f;!function(c,g){e=[],d=g,f="function"==typeof d?d.apply(b,e):d,!(void 0!==f&&(a.exports=f))}(this,function(){"use strict";function a(a,b,c){this.low=0|a,this.high=0|b,this.unsigned=!!c}function b(a){return(a&&a.__isLong__)===!0}function c(a,b){var c,d,f;return b?(a>>>=0,(f=0<=a&&a<256)&&(d=i[a])?d:(c=e(a,(0|a)<0?-1:0,!0),f&&(i[a]=c),c)):(a|=0,(f=-128<=a&&a<128)&&(d=h[a])?d:(c=e(a,a<0?-1:0,!1),f&&(h[a]=c),c))}function d(a,b){if(isNaN(a)||!isFinite(a))return b?q:p;if(b){if(a<0)return q;if(a>=m)return v}else{if(a<=-n)return w;if(a+1>=n)return u}return a<0?d(-a,b).neg():e(a%l|0,a/l|0,b)}function e(b,c,d){return new a(b,c,d)}function f(a,b,c){if(0===a.length)throw Error("empty string");if("NaN"===a||"Infinity"===a||"+Infinity"===a||"-Infinity"===a)return p;if("number"==typeof b?(c=b,b=!1):b=!!b,c=c||10,c<2||36<c)throw RangeError("radix");var e;if((e=a.indexOf("-"))>0)throw Error("interior hyphen");if(0===e)return f(a.substring(1),b,c).neg();for(var g=d(j(c,8)),h=p,i=0;i<a.length;i+=8){var k=Math.min(8,a.length-i),l=parseInt(a.substring(i,i+k),c);if(k<8){var m=d(j(c,k));h=h.mul(m).add(d(l))}else h=h.mul(g),h=h.add(d(l))}return h.unsigned=b,h}function g(b){return b instanceof a?b:"number"==typeof b?d(b):"string"==typeof b?f(b):e(b.low,b.high,b.unsigned)}a.prototype.__isLong__,Object.defineProperty(a.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1}),a.isLong=b;var h={},i={};a.fromInt=c,a.fromNumber=d,a.fromBits=e;var j=Math.pow;a.fromString=f,a.fromValue=g;var k=1<<24,l=4294967296,m=0x10000000000000000,n=m/2,o=c(k),p=c(0);a.ZERO=p;var q=c(0,!0);a.UZERO=q;var r=c(1);a.ONE=r;var s=c(1,!0);a.UONE=s;var t=c(-1);a.NEG_ONE=t;var u=e(-1,2147483647,!1);a.MAX_VALUE=u;var v=e(-1,-1,!0);a.MAX_UNSIGNED_VALUE=v;var w=e(0,-2147483648,!1);a.MIN_VALUE=w;var x=a.prototype;return x.toInt=function(){return this.unsigned?this.low>>>0:this.low},x.toNumber=function(){return this.unsigned?(this.high>>>0)*l+(this.low>>>0):this.high*l+(this.low>>>0)},x.toString=function(a){if(a=a||10,a<2||36<a)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(w)){var b=d(a),c=this.div(b),e=c.mul(b).sub(this);return c.toString(a)+e.toInt().toString(a)}return"-"+this.neg().toString(a)}for(var f=d(j(a,6),this.unsigned),g=this,h="";;){var i=g.div(f),k=g.sub(i.mul(f)).toInt()>>>0,l=k.toString(a);if(g=i,g.isZero())return l+h;for(;l.length<6;)l="0"+l;h=""+l+h}},x.getHighBits=function(){return this.high},x.getHighBitsUnsigned=function(){return this.high>>>0},x.getLowBits=function(){return this.low},x.getLowBitsUnsigned=function(){return this.low>>>0},x.getNumBitsAbs=function(){if(this.isNegative())return this.eq(w)?64:this.neg().getNumBitsAbs();for(var a=0!=this.high?this.high:this.low,b=31;b>0&&0==(a&1<<b);b--);return 0!=this.high?b+33:b+1},x.isZero=function(){return 0===this.high&&0===this.low},x.isNegative=function(){return!this.unsigned&&this.high<0},x.isPositive=function(){return this.unsigned||this.high>=0},x.isOdd=function(){return 1===(1&this.low)},x.isEven=function(){return 0===(1&this.low)},x.equals=function(a){return b(a)||(a=g(a)),(this.unsigned===a.unsigned||this.high>>>31!==1||a.high>>>31!==1)&&(this.high===a.high&&this.low===a.low)},x.eq=x.equals,x.notEquals=function(a){return!this.eq(a)},x.neq=x.notEquals,x.lessThan=function(a){return this.comp(a)<0},x.lt=x.lessThan,x.lessThanOrEqual=function(a){return this.comp(a)<=0},x.lte=x.lessThanOrEqual,x.greaterThan=function(a){return this.comp(a)>0},x.gt=x.greaterThan,x.greaterThanOrEqual=function(a){return this.comp(a)>=0},x.gte=x.greaterThanOrEqual,x.compare=function(a){if(b(a)||(a=g(a)),this.eq(a))return 0;var c=this.isNegative(),d=a.isNegative();return c&&!d?-1:!c&&d?1:this.unsigned?a.high>>>0>this.high>>>0||a.high===this.high&&a.low>>>0>this.low>>>0?-1:1:this.sub(a).isNegative()?-1:1},x.comp=x.compare,x.negate=function(){return!this.unsigned&&this.eq(w)?w:this.not().add(r)},x.neg=x.negate,x.add=function(a){b(a)||(a=g(a));var c=this.high>>>16,d=65535&this.high,f=this.low>>>16,h=65535&this.low,i=a.high>>>16,j=65535&a.high,k=a.low>>>16,l=65535&a.low,m=0,n=0,o=0,p=0;return p+=h+l,o+=p>>>16,p&=65535,o+=f+k,n+=o>>>16,o&=65535,n+=d+j,m+=n>>>16,n&=65535,m+=c+i,m&=65535,e(o<<16|p,m<<16|n,this.unsigned)},x.subtract=function(a){return b(a)||(a=g(a)),this.add(a.neg())},x.sub=x.subtract,x.multiply=function(a){if(this.isZero())return p;if(b(a)||(a=g(a)),a.isZero())return p;if(this.eq(w))return a.isOdd()?w:p;if(a.eq(w))return this.isOdd()?w:p;if(this.isNegative())return a.isNegative()?this.neg().mul(a.neg()):this.neg().mul(a).neg();if(a.isNegative())return this.mul(a.neg()).neg();if(this.lt(o)&&a.lt(o))return d(this.toNumber()*a.toNumber(),this.unsigned);var c=this.high>>>16,f=65535&this.high,h=this.low>>>16,i=65535&this.low,j=a.high>>>16,k=65535&a.high,l=a.low>>>16,m=65535&a.low,n=0,q=0,r=0,s=0;return s+=i*m,r+=s>>>16,s&=65535,r+=h*m,q+=r>>>16,r&=65535,r+=i*l,q+=r>>>16,r&=65535,q+=f*m,n+=q>>>16,q&=65535,q+=h*l,n+=q>>>16,q&=65535,q+=i*k,n+=q>>>16,q&=65535,n+=c*m+f*l+h*k+i*j,n&=65535,e(r<<16|s,n<<16|q,this.unsigned)},x.mul=x.multiply,x.divide=function(a){if(b(a)||(a=g(a)),a.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?q:p;var c,e,f;if(this.unsigned){if(a.unsigned||(a=a.toUnsigned()),a.gt(this))return q;if(a.gt(this.shru(1)))return s;f=q}else{if(this.eq(w)){if(a.eq(r)||a.eq(t))return w;if(a.eq(w))return r;var h=this.shr(1);return c=h.div(a).shl(1),c.eq(p)?a.isNegative()?r:t:(e=this.sub(a.mul(c)),f=c.add(e.div(a)))}if(a.eq(w))return this.unsigned?q:p;if(this.isNegative())return a.isNegative()?this.neg().div(a.neg()):this.neg().div(a).neg();if(a.isNegative())return this.div(a.neg()).neg();f=p}for(e=this;e.gte(a);){c=Math.max(1,Math.floor(e.toNumber()/a.toNumber()));for(var i=Math.ceil(Math.log(c)/Math.LN2),k=i<=48?1:j(2,i-48),l=d(c),m=l.mul(a);m.isNegative()||m.gt(e);)c-=k,l=d(c,this.unsigned),m=l.mul(a);l.isZero()&&(l=r),f=f.add(l),e=e.sub(m)}return f},x.div=x.divide,x.modulo=function(a){return b(a)||(a=g(a)),this.sub(this.div(a).mul(a))},x.mod=x.modulo,x.not=function(){return e(~this.low,~this.high,this.unsigned)},x.and=function(a){return b(a)||(a=g(a)),e(this.low&a.low,this.high&a.high,this.unsigned)},x.or=function(a){return b(a)||(a=g(a)),e(this.low|a.low,this.high|a.high,this.unsigned)},x.xor=function(a){return b(a)||(a=g(a)),e(this.low^a.low,this.high^a.high,this.unsigned)},x.shiftLeft=function(a){return b(a)&&(a=a.toInt()),0===(a&=63)?this:a<32?e(this.low<<a,this.high<<a|this.low>>>32-a,this.unsigned):e(0,this.low<<a-32,this.unsigned)},x.shl=x.shiftLeft,x.shiftRight=function(a){return b(a)&&(a=a.toInt()),0===(a&=63)?this:a<32?e(this.low>>>a|this.high<<32-a,this.high>>a,this.unsigned):e(this.high>>a-32,this.high>=0?0:-1,this.unsigned)},x.shr=x.shiftRight,x.shiftRightUnsigned=function(a){if(b(a)&&(a=a.toInt()),a&=63,0===a)return this;var c=this.high;if(a<32){var d=this.low;return e(d>>>a|c<<32-a,c>>>a,this.unsigned)}return 32===a?e(c,0,this.unsigned):e(c>>>a-32,0,this.unsigned)},x.shru=x.shiftRightUnsigned,x.toSigned=function(){return this.unsigned?e(this.low,this.high,!1):this},x.toUnsigned=function(){return this.unsigned?this:e(this.low,this.high,!0)},x.toBytes=function(a){return a?this.toBytesLE():this.toBytesBE()},x.toBytesLE=function(){var a=this.high,b=this.low;return[255&b,b>>>8&255,b>>>16&255,b>>>24&255,255&a,a>>>8&255,a>>>16&255,a>>>24&255]},x.toBytesBE=function(){var a=this.high,b=this.low;return[a>>>24&255,a>>>16&255,a>>>8&255,255&a,b>>>24&255,b>>>16&255,b>>>8&255,255&b]},a})},function(a,b,c){var d,e;d=[c(0),c(1),c(5),c(3)],e=function(a,b,c,d){"use strict";function e(){this._namedEvents=new c.NamedEvents,this._timeOfLastTabFocusChange=a.now(),this._disposables=new d.DisposableList,this._isForeground=!0,this._disposables.add(this._namedEvents),f.call(this)}function f(){return g()?h.call(this):void i.call(this)}function g(){return"undefined"!=typeof chrome&&chrome.extension&&chrome.extension.onRequest}function h(){if(g()){var a=this;chrome.extension.onRequest.addListener(function(b,c,d){"is_selected"===b&&chrome.tabs.getSelected(null,function(b){var e=b.id===c.tab.id;j.call(a,e),d(e?!0:!1)})})}}function i(){}function j(a){if(b.isBoolean(a,"isForeground"),this._isForeground!==a)return a?(this._isForeground=!0,k.call(this,"foreground")):(this._isForeground=!1,k.call(this,"background"))}function k(b){var c=a.now(),d=c-this._timeOfLastTabFocusChange;this._timeOfLastTabFocusChange=c,this._namedEvents.fire(b,[d])}return e.prototype.isForeground=function(){return this._isForeground},e.prototype.getTimeSinceLastChange=function(){return a.now()-this._timeOfLastTabFocusChange},e.prototype.onForeground=function(a){return b.isFunction(a,"callback"),this._namedEvents.listen("foreground",a)},e.prototype.onBackground=function(a){return b.isFunction(a,"callback"),this._namedEvents.listen("background",a)},e}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0)],e=function(a){var b=function(){};return b.prototype.isObject=function(c,d){b.prototype.isString("name",d);var e='"'+d+'" must be an object';if(!a.isObject(c))throw new Error(e)},b.prototype.isArray=function(c,d){b.prototype.isString("name",d);var e='"'+d+'" must be an array';if(!a.isArray(c))throw new Error(e)},b.prototype.isString=function(b,c){var d='"'+c+'" must be a string';if(!a.isString(c))throw new Error('"name" must be a string');if(!a.isString(b))throw new Error(d)},b.prototype.isBoolean=function(c,d){b.prototype.isString("name",d);var e='"'+d+'" must be a boolean';if(!a.isBoolean(c))throw new Error(e)},b.prototype.isNumber=function(c,d){b.prototype.isString("name",d);var e='"'+d+'" must be a number';if(!a.isNumber(c))throw new Error(e)},b.prototype.isFunction=function(c,d){b.prototype.isString("name",d);var e='"'+d+'" must be a function';if(!a.isFunction(c))throw new Error(e)},b.prototype.stringNotEmpty=function(a,c){b.prototype.isStringNotEmpty(a,c)},b.prototype.isStringNotEmpty=function(a,c){b.prototype.isString("name",c);var d='"'+c+'" must not be empty';if(b.prototype.isString(a,c),""===a)throw new Error(d)},b.prototype.isInstanceOf=function(c,d,e){if(b.prototype.isString("name",e),!a.isObject(c))throw new Error('"'+e+'" must be an instance');if(!(c instanceof d))throw new Error('"'+e+'" must be a valid instance of class')},b.prototype.isNotUndefined=function(c,d){if(b.prototype.isString("name",d),a.isUndefined(c))throw new Error('"'+d+'" must not be undefined')},b.prototype.isValidType=function(c,d,e){if(b.prototype.isStringNotEmpty(e,"name"),c=a.getEnumName(d,c),a.isNullOrUndefined(c))throw new Error('"'+e+'" must be a valid type');return c},b.prototype.isArrayOfString=function(c,d){b.prototype.isString(d,"name"),b.prototype.isArray(c,d),a.forEach(c,function(a,c){b.prototype.isString(a,d+"["+c+"]")})},new b}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(5),c(27),c(6),c(4),c(3)],e=function(a,b,c,d,e,f,g){function h(d,e,h,i){b.isStringNotEmpty(d,"uri"),e=e||{},b.isObject(e,"options"),e.requestType&&b.isStringNotEmpty(e.requestType,"options.requestType"),e.maxAttempts&&b.isNumber(e.maxAttempts,"options.maxAttempts"),e.maxBufferedRecords&&b.isNumber(e.maxBufferedRecords,"options.maxBufferedRecords"),e.maxBatchSize&&b.isNumber(e.maxBatchSize,"options.maxBatchSize"),e.contentType&&b.isStringNotEmpty(e.contentType,"options.maxBatchSize"),h&&b.isFunction(h,"serializeRequest"),i&&b.isFunction(i,"deserializeResponse"),this._localStoreKey=q+"|"+d,this._requestType=e.requestType||"POST",this._requestTimeout=e.requestTimeout||3e4,this._maxAttempts=e.maxAttempts||5,this._maxBufferedRecords=e.maxBufferedRecords||1e3,this._maxBatchSize=e.maxBatchSize||100,this._contentType=e.contentType||"application/json",this._serializeRequest=h,this._deserializeResponse=i,this._uri=d,this._records=r.call(this)||[],this._isEnabled=!0,this._namedEvents=new c.NamedEvents,this._canSendRequestObservable=new f.Observable((!0)),this._disposables=new g.DisposableList,this._pending=!1,this._unloadTriggered=!1,this._disposables.add(this._canSendRequestObservable.subscribe(a.bind(j,this))),this._disposables.add(k.call(this)),this._disposables.add(this._namedEvents),t.call(this,[]),j.call(this);var l=this;a.addEventListener(window,"beforeunload",function(){s.call(l,l._records),l._unloadTriggered=!0,l._records=[]})}function i(){if(this._records.length>this._maxBufferedRecords){var a=this._records.length-this._maxBufferedRecords/2;this._records=this._records.slice(a),this._namedEvents.fireAsync(p.capacity,[null,{numberOfDeletedRecords:a}])}}function j(){if(this._canSendRequestObservable.getValue()&&0!==this._records.length){n.call(this,!0);var b={records:a.take(this._records,this._maxBatchSize)};this._records=this._records.slice(this._maxBatchSize);var c=this;try{l.call(this,this._uri,b,function(){setTimeout(function(){c._records=c._records.concat(b.records),n.call(c,!1)},o)})}catch(d){setTimeout(function(){return n.call(c,!1),c._namedEvents.fire(p.error,[d])},o)}}}function k(){function a(){n.call(b,b._pending)}var b=this;return d.listenForNetworkChange(a)}function l(b,c,d){function f(a,b){if(a)return"timeout"!==a.message||m.call(g)?(n.call(g,!1),g._namedEvents.fire(p.error,[a])):d();n.call(g,!1);var c=g._deserializeResponse?g._deserializeResponse(b.data):b.data;return g._namedEvents.fire(p.response,[c])}var g=this,h=this._serializeRequest?this._serializeRequest(a.assign({},c)):c;switch(this._requestType){case"POST":return e.postWithRetry(b,h,{timeout:this._requestTimeout,contentType:this._contentType,retryOptions:{maxAttempts:this._maxAttempts,additionalRetryErrorCodes:[0]}},f);default:throw new Error("Invalid request type")}}function m(){return this._records.length>=this._maxBufferedRecords}function n(a){this._pending=a,this._canSendRequestObservable.setValue(!a&&d.isOnline())}var o=0,p={capacity:"capacity",error:"error",response:"response"},q="__phenixBatchHttpMessages";h.prototype.on=function(a,c){return b.isStringNotEmpty(a,"eventName"),b.isFunction(c,"callback"),this._namedEvents.listen(a,c)},h.prototype.addRecord=function(a){return this._unloadTriggered?s.call(this,[a]):(this._records.push(a),j.call(this),void i.call(this))},h.prototype.addRecordToBeginning=function(a){this._records.unshift(a),j.call(this),i.call(this)},h.prototype.dispose=function(){this._records=[],this._disposables.dispose()};var r=function(){if(!window.localStorage)return null;var a=window.localStorage.getItem(this._localStoreKey);return a?JSON.parse(a):[]},s=function(a){if(!window.localStorage||!a||0===a.length)return null;var b=r.call(this).concat(a);return t.call(this,b)},t=function(a){return window.localStorage&&a?window.localStorage.setItem(this._localStoreKey,JSON.stringify(a)):null};return h}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(51)],e=function(a){"use strict";return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(6),c(3)],e=function(a,b,c,d){"use strict";function e(a,c,e,f){b.isObject(a,"logger"),b.isStringNotEmpty(c,"version"),b.isFunction(e,"onClosestEndpointFound"),f&&b.isFunction(f,"onAnEndpointResolved"),this._logger=a,this._version=c,this._onClosestEndpointFound=e,f&&(this._onAnEndpointResolved=f),this._done=!1,this._minTime=Number.MAX_VALUE,this._minResponseText="",this._disposables=new d.DisposableList}var f=4,g=30;return e.prototype.isResolved=function(){return this._done},e.prototype.dispose=function(){this._disposables.dispose()},e.prototype.measurementCallback=function(a,b,c){return b<this._minTime&&(this._logger.info("Current closest end point is [%s] with latency of [%s] ms",c,b),this._minTime=b,this._minResponseText=c),this.isResolved()},e.prototype.completeCallback=function(a){if(this._minResponseText&&this._minTime<Number.MAX_VALUE&&!this.isResolved())return this._done=!0,this._onClosestEndpointFound(null,{uri:this._minResponseText,roundTripTime:this._minTime})},e.prototype.resolveAll=function(a){for(var b=0;b<a.length;b++)this.resolve(a[b],f)},e.prototype.resolve=function(b,d){var e=this,f=1,h=0,i=function j(b){var i=1,k=a.now();e._logger.info("[%s] Checking end point [%s]",f,b);var l=c.getWithRetry(b,{timeout:15e3,queryParameters:{version:e._version,_:a.now()},retryOptions:{maxAttempts:i}},function(c,i){var l=a.now(),m=l-k,n=m>g;if(e._onAnEndpointResolved&&(c?e._onAnEndpointResolved(c):e._onAnEndpointResolved(null,{time:m,endPoint:b})),f++,!c){if(e.measurementCallback(b,m,i.data))return;h++}return f<=d&&!e.isResolved()&&(n||c)?(c&&e._logger.info("Retrying after failure to resolve end point [%s] with [%s]",b,c),j(b)):0===h?e._logger.warn("Unable to resolve end point [%s] with [%s]",b,c):e.completeCallback(b)});e._disposables.add(l)};i(b)},e}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(53)],e=function(a){return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0)],e=function(a){"use strict";function b(a){this._userAgent=a||""}return b.prototype.detect=function(){var b="Unknown",c="?",d=this._userAgent.match(/(Chrome|Chromium|Firefox|Opera|Safari)+\//),e=this._userAgent.match(/(Chrome|Chromium|Firefox|Version)+\/([0-9]+)\./),f=!1;return d&&d.length>=2?b=d[1]:this._userAgent.match(/^\(?Mozilla/)&&(b="Mozilla",(this._userAgent.match(/MSIE/)||this._userAgent.match(/; Trident\/.*rv:[0-9]+/))&&(b="IE",(e=this._userAgent.match(/MSIE ([0-9]+)/))?(c=parseInt(e[1],10),(e=this._userAgent.match(/MSIE [0-9]+.*MSIE ([0-9]+)/))&&(c=parseInt(e[1],10))):(e=this._userAgent.match(/rv:([0-9]+)/))&&(c=parseInt(e[1],10)))),
"Chrome"===b&&this._userAgent.match(/OPR\//)?(b="Opera",e=this._userAgent.match(/(OPR)\/([0-9]+)\./)):"Chrome"===b&&this._userAgent.match(/Edge\//)?(b="Edge",e=this._userAgent.match(/(Edge)\/([0-9]+)\./)):"Firefox"!==b&&"IE"!==b||!this._userAgent.match(/Opera/)?"Mozilla"===b&&this._userAgent.match(/iphone|ipod|ipad/i)&&(b="Safari",c=parseInt(a.get(this._userAgent.match(/OS\s([0-9]+)/),[1]),10),f=!0):(b="Opera",e=this._userAgent.match(/(Opera) ([0-9]+)\./)),"Chrome"===b&&(this._userAgent.match(/; wv/)||this._userAgent.match(/Android/)&&this._userAgent.match(/Version\/[0-9].[0-9]/))&&(f=!0),"IE"!==b&&e&&e.length>=3&&(c=parseInt(e[2],10)),"ReactNative"===navigator.product&&(b="ReactNative",c=navigator.productSub||"?"),{browser:b,version:c,isWebview:f}},b}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1)],e=function(a,b){"use strict";function c(a){b.isFunction(a,"cleanup"),this._cleanup=a}return c.prototype.dispose=function(){return this._cleanup.call()},c.prototype.toString=function(){return a.toString(this)},c}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0)],e=function(a){"use strict";function b(){this._list=[]}return b.prototype.add=function(b){if(!b||!a.isFunction(b.dispose))throw new Error('"disposable" must be a disposable or implement dispose');this._list.push(b)},b.prototype.dispose=function(){var b=[];return a.forEach(this._list,function(a){b.push(a.dispose())}),this._list=[],b},b.prototype.toString=function(){return a.toString(this)},b}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(26)],e=function(a,b,c){"use strict";function d(){this._events={}}return d.prototype.fire=function(c,d,e){b.isStringNotEmpty(c,"name"),a.includes(a.keys(this._events),c)&&this._events[c].fire(d,e)},d.prototype.fireAsync=function(c,d,e){b.isStringNotEmpty(c,"name"),a.includes(a.keys(this._events),c)&&this._events[c].fireAsync(d,e)},d.prototype.listen=function(d,e){b.isStringNotEmpty(d,"name");var f=a.includes(a.keys(this._events),d)?this._events[d]:this._events[d]=new c;return f.listen(e)},d.prototype.size=function(b){return a.includes(a.keys(this._events),b)?this._events[b].size():0},d.prototype.dispose=function(){a.forOwn(this._events,function(a){a.dispose()}),this._events={}},d.prototype.toString=function(){return"NamedEvents|"+a.keys(this._events).length},d}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(3)],e=function(a,b,c){"use strict";function d(){}function e(b,c,d,e,f){e=e||{},g(e);var m=h(e.queryParameters||{},c),o=i(b,m,f),p=a.bind(n,this,a.now(),f);return o?(e.responseType&&(o.responseType=e.responseType),k(o,e),o.addEventListener("readystatechange",a.bind(l,this,o,e,p)),o.timeout=e.timeout||15e3,void o.send(d)):f(j())}function f(b,c,d,e,f){var g=a.bind(b,this,c,d,e),h={startTime:a.now(),isDisposed:!1};return p.call(this,c,e,g,h,f)}function g(c){b.isObject(c,"settings"),c.queryParameters&&b.isObject(c.queryParameters,"settings.queryParameters"),c.mimeType&&b.stringNotEmpty(c.mimeType,"settings.mimeType"),c.accept&&b.stringNotEmpty(c.accept,"settings.accept"),c.contentType&&b.stringNotEmpty(c.contentType,"settings.contentType"),c.responseType&&b.stringNotEmpty(c.responseType,"settings.responseType"),a.isNullOrUndefined(c.timeout)||b.isNumber(c.timeout,"settings.timeout")}function h(b,c){var d=a.reduce(b,function(a,b,c){return a+=a?"&":"?",a+c.toString()+"="+b.toString()},"");return d.length>0?c+d:c}function i(a,b){var c=new XMLHttpRequest;if("withCredentials"in c)c.open(a,b,!0);else{if("undefined"==typeof XDomainRequest)return;c=new XDomainRequest,c.open(a,b)}return c}function j(){var a=new Error("unsupported");return a.code="unsupported",a}function k(b,c){var d=c.contentType||"application/json",e=c.accept||d,f=a.assign({},{"Content-Type":d,Accept:e},a.get(c,["headers"],{}));a.forOwn(f,function(a,c){b.setRequestHeader(c,a)})}function l(c,d,e){if(4===c.readyState)if(200===c.status){var f=m(c),g={data:c.response||c.responseText,headers:f,rawXhr:c};e(null,g)}else{var h=new Error(0===c.status?"timeout":c.statusText),i=a.get(d,["retryOptions","additionalRetryErrorCodes"],[]);a.forEach(i,function(a){b.isNumber(a,"additionalRetryErrorCode")}),h.code=c.status,(c.status>=500&&c.status<600||a.includes(i,c.status))&&(h.retryable=!0),e(h)}}function m(b){var c=b.getAllResponseHeaders();return a.reduce(c.trim().split(/[\r\n]+/),function(a,b){var c=b.split(": "),d=c.shift(),e=c.join(": ");return d&&(a[d]=e),a},{})}function n(b,c,d,e){e&&a.set(e,["stats","successResponseTime"],a.now()-b),c(d,e)}function o(b,c,d,e,f){f&&(a.set(f,["stats","totalResponseTimeForAllAttempts"],a.now()-b),a.set(f,["stats","attempts"],c)),d(e,f)}function p(b,d,e,f,g,h){h=h||1;var i=this,j=a.get(d,["delay"],null),k=a.get(d,["retryOptions","delay"],w),l=a.get(d,["retryOptions","backoff"],v),m=a.get(d,["retryOptions","maxAttempts"],u),n=h>1?k*Math.pow(h,l):j,s=function(a,c){return f.isDisposed?g(r(x.clientAborted)):a&&a.retryable&&h<m?p.call(i,b,d,e,f,g,h+1):o.call(i,f.startTime,h,g,a,c)},t=new c.Disposable(function(){a.isNumber(f.mostRecentTimeout)&&clearTimeout(f.mostRecentTimeout),f.isDisposed=!0});return!a.isNumber(j)&&1===h||a.get(d,["retryOptions","sync"],!1)?(e.call(i,s),t):(q.call(i,b,d,e,f,n,s),t)}function q(a,b,c,d,e,f){var g=this;d.mostRecentTimeout=setTimeout(function(){return d.isDisposed?f(r(x.clientAborted)):void c.call(g,f)},e)}function r(a){var b=new Error(a.name);return b.code=a.id,b}var s={get:"GET",post:"POST",put:"PUT","delete":"DELETE"},t=3e3,u=1,v=2,w=1500,x={clientAborted:{id:4e3,name:"Aborted by Client"}};return d.prototype.get=function(b,c,d){c=c||{},g(c);var e=h(c.queryParameters||{},b),f=i(s.get,e,d),m=a.bind(n,this,a.now(),d);return f?(c.mimeType&&f.overrideMimeType(c.mimeType),c.responseType&&(f.responseType=c.responseType),k(f,c),f.addEventListener("readystatechange",a.bind(l,this,f,c,m)),f.timeout=c.timeout||t,void f.send()):d(j())},d.prototype.post=function(a,b,c,d){return e.call(this,s.post,a,b,c,d)},d.prototype.put=function(a,b,c,d){return e.call(this,s.put,a,b,c,d)},d.prototype["delete"]=function(a,b,c,d){return e.call(this,s["delete"],a,b,c,d)},d.prototype.getWithRetry=function(b,c,d){var e=a.bind(this.get,this,b,c),f={startTime:a.now(),isDisposed:!1};return p.call(this,b,c,e,f,d)},d.prototype.postWithRetry=function(a,b,c,d){return f.call(this,this.post,a,b,c,d)},d.prototype.putWithRetry=function(a,b,c,d){return f.call(this,this.put,a,b,c,d)},d.prototype.deleteWithRetry=function(a,b,c,d){return f.call(this,this["delete"],a,b,c,d)},new d}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";function a(a){var c=a.split("."),d=[];return e.forEach(c,function(a){d=d.concat(b(a))}),d}function b(a){for(var b="",c=[],d=0,f=0;f<a.length;f++)if("["===a[f]){if(d++,!e.isString(b)||d>1)return[a];b&&(c.push(b),b="")}else if("]"===a[f]){if(d--,0!==d)return[a];c.push(b),b=""}else{if(f===a.length-1)return[a];b+=a[f]}return c}function c(a,b,c,d){if(a.length-1===b)return d;var f=a[b],g=a[b+1];if(e.isArray(c[f])||e.isObject(c[f]))return c[f];if(!e.isArray(c[f])&&e.isNumber(parseInt(g)))return[];if(!e.isObject(c[f])&&e.isString(g))return{};throw new Error("Unsupported type "+typeof f+" when setting property or index")}function d(a,b,c){if(e.isNumber(parseInt(b))&&e.isArray(a))return a[b]=c;if(e.isString(b)&&e.isObject(a))return a[b]=c;throw new Error("Unsupported type "+typeof b+" when setting property or index")}var e=function(){};e.get=function(b,c,d){if(e.isNullOrUndefined(b))return d;h(b,"objectToTraverse");var f=c;if(e.isString(f))f=a(c);else if(!e.isArray(f))throw new Error("Unsupported path type "+typeof c);var g=e.reduce(f,function(a,b){if(e.isObject(a)||e.isArray(a))return a[b]},b);return e.isUndefined(g)?d:g},e.set=function(b,f,g){if(!e.isObject(b))return b;h(b,"objectToTraverse");var i=b,j=f;if(e.isString(j))j=a(f);else if(!e.isArray(j))throw new Error("Unsupported path type "+typeof f);return e.forEach(j,function(a,b){d(i,a,c(j,b,i,g)),i=i[a]}),b},e.bind=function(a,b){var c=Array.prototype.slice.call(arguments,2);return function(){if(!e.isFunction(a))throw new TypeError("_.bind - callback must be a function");var d=c.concat(Array.prototype.slice.call(arguments));return a.apply(b,d)}},e.now=function(){return(new Date).getTime()},e.utc=function(a){return e.isNumber(a)?a:a?Math.floor(a):NaN},e.isoString=function(){var a=new Date;return a.toISOString?a.toISOString():a.getUTCFullYear()+"-"+e.pad(a.getUTCMonth()+1,2)+"-"+e.pad(a.getUTCDate(),2)+"T"+e.pad(a.getUTCHours(),2)+":"+e.pad(a.getUTCMinutes(),2)+":"+e.pad(a.getUTCSeconds(),2)+"."+(a.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"},e.map=function(a,b){h(a,"collection");var c=[];return a.constructor===Array?e.forEach(a,function(a,d){e.isString(b)&&e.isObject(a)?c.push(a[b]):e.isFunction(b)&&c.push(b(a,d))}):e.forOwn(a,function(a,d){e.isFunction(b)&&c.push(b(a,d))}),c},e.values=function(a){if(!e.isObject(a)||e.isArray(a))throw new Error("Collection must be an object.");return e.map(a,function(a){return a})},e.keys=function(a){if(!e.isObject(a)||e.isArray(a))throw new Error("Collection must be an object.");return e.map(a,function(a,b){return b})},e.forEach=function(a,b){if(!e.isFunction(b))throw new Error("Callback must be a function");f(a,"collection");for(var c=0;c<a.length;c++){var d=b(a[c],c);if(d===!1)return}},e.forOwn=function(a,b){if(!e.isFunction(b))throw new Error("Callback must be a function");h(a,"objectWithProperties");for(var c=Object.keys(a),d=0;d<c.length;d++){var f=c[d];(a.hasOwnProperty(f)||Object.prototype.hasOwnProperty.call(a,f))&&b(a[f],f)}},e.argumentsToArray=function(a){if(!e.isObject(a)||!a.length)throw new Error("Collection must be arguments");for(var b=[],c=0;c<a.length;c++)b.push(a[c]);return b},e.assign=function(a){h(a,"target");var b=e.argumentsToArray(arguments);return b.shift(),e.forEach(b,function(b,c){h(b,"source "+c),e.forOwn(b,function(b,c){a[c]=b})}),a},e.includes=function(a,b){if(e.isString(a))return j(b,"Includes value and search parameter"),a.indexOf(b)>-1;if(e.isUndefined(a)||e.isUndefined(b))return!1;h(a,"collection");var c=!1,d=function(a){a===b&&(c=!0)};return a.constructor===Array?e.forEach(a,d):e.forOwn(a,d),c},e.reduce=function(a,b,c){h(a,"collection");var d=c===e.noop()?null:c;return a.constructor===Array?e.forEach(a,function(a,c){d=b(d,a,c)}):e.forOwn(a,function(a,c){d=b(d,a,c)}),d},e.sample=function(a){return f(a,"collection"),a[Math.floor(Math.random()*a.length)]},e.uniqueId=function(){return(e.now()*Math.random()).toString()},e.find=function(a,b,c){f(a,"collection");var d;return e.forEach(a,function(a,e){if(b(a)&&e>=(c||0))return d=a}),d},e.findIndex=function(a,b,c){f(a,"collection");var d;return e.forEach(a,function(a,e){if(b(a,e)&&e>=(c||0))return d=e}),d},e.filter=function(a,b){f(a,"collection");var c=[];return e.forEach(a,function(a){b(a)&&c.push(a)}),c},e.remove=function(a,b){f(a,"collection");var c=function(a){return!b(a)};return e.filter(a,c)},e.take=function(a,b){return f(a,"collection"),a.slice(0,b)},e.hasDifferences=function(a,b,c){return e.findDifferences(a,b,c).length>0},e.findDifferences=function(a,b,c){function d(d,h){g[h]=1,(e.isObject(d)||e.isArray(d))&&c?e.hasIndexOrKey(b,h)&&e.sameTypes(a[h],b[h])?e.hasDifferences(a[h],b[h],c)&&f.push(h):f.push(h):a[h]!==b[h]&&f.push(h)}var f=[],g={};if(e.isArray(a)&&e.isArray(b))a.length>b.length?e.forEach(a,d):e.forEach(b,d);else{if(!e.isObject(a)||!e.isObject(b)||e.isArray(a)||e.isArray(b))throw new Error("Object types do not match");e.forOwn(a,d),e.forOwn(b,function(a,b){g.hasOwnProperty(b)||f.push(b)})}return f},e.hasIndexOrKey=function(a,b){return e.isArray(a)?a.length>parseInt(b):!!e.isObject(a)&&a.hasOwnProperty(b)},e.startsWith=function(a,b){return j(a,"value"),j(b,"prefix"),0===a.indexOf(b)},e.sameTypes=function(a,b){return e.isNullOrUndefined(a)||e.isNullOrUndefined(b)?e.isNullOrUndefined(a)&&e.isNullOrUndefined(b):e.isArray(a)||e.isArray(b)?e.isArray(a)&&e.isArray(b):typeof a==typeof b},e.freeze=function(a){return"freeze"in Object?Object.freeze(a):a},e.noop=function(){},e.isObject=function(a){return null!==a&&"object"==typeof a},e.isArray=function(a){return!!e.isObject(a)&&a.constructor===Array},e.isString=function(a){return"string"==typeof a},e.isNumber=function(a){return!isNaN(a)&&"number"==typeof a},e.isBoolean=function(a){return"boolean"==typeof a},e.isFunction=function(a){return"function"==typeof a},e.isNullOrUndefined=function(a){return null===a||e.isUndefined(a)},e.isUndefined=function(a){return"undefined"==typeof a},e.getEnumName=function(a,b){var c=null,d=e.map(a,function(a){return a});return e.isNumber(b)?c=e.find(d,function(a){return a.id===b}):e.isString(b)&&(c=e.find(d,function(a){return a.name.toLowerCase()===b.toLowerCase()})),c?c.name:null},e.toString=function(a){if(e.isString(a))return a;if(e.isBoolean(a))return a?"true":"false";if(e.isNumber(a))return a.toString();var b="";if(a)if(e.isFunction(a.toString))b=a.toString();else if(e.isObject(a.toString))try{b=a.toString()}catch(c){b="[object invalid toString()]"}if(0!==b.indexOf("[object"))return b;var d=[];return b+JSON.stringify(a,function(a,b){if(e.isObject(b)&&!e.isNullOrUndefined(b)){if(e.includes(d,b))return"<recursive>";d.push(b)}return""===a?b:e.toString(b)})},e.pad=function(a,b){g(a,"value"),g(b,"numberToPad");for(var c=a.toString().length,d=0;d<b-c;d++)a="0"+a.toString();return a.toString()},e.addEventListener=function(a,b,c,d){h(a,"target"),j(b,"eventName"),i(c,"listener"),a.phenixAddEventListener?a.phenixAddEventListener.call(a,b,c,!!d):a.addEventListener?a.addEventListener(b,c,!!d):a.attachEvent&&a.attachEvent("on"+b,c)},e.removeEventListener=function(a,b,c,d){h(a,"target"),j(b,"eventName"),i(c,"listener"),a.phenixRemoveEventListener?a.phenixRemoveEventListener.call(a,b,c,!!d):a.removeEventListener?a.removeEventListener(b,c,!!d):a.detachEvent&&a.detachEvent("on"+b,c)};var f=function(a){if(!e.isArray(a))throw new Error("Input must be an array.")},g=function(a,b){if(j(b,"name"),!e.isNumber(a))throw new Error(b+" must be a number.")},h=function(a,b){if(j(b,"name"),!e.isObject(a))throw new Error("collection type not supported - "+b+" must be an array or object.")},i=function(a,b){if(j(b,"name"),!e.isFunction(a))throw new Error(b+" must be a function.")},j=function(a,b){if(!e.isString(b))throw new Error("Name must be a string.");if(!e.isString(a))throw new Error(b+" must be a string.")};return e}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(14)],e=function(a,b,c){"use strict";function d(){this._minLevel=c.level.TRACE}d.prototype.setThreshold=function(a){b.isNumber(a,"level"),this._minLevel=a},d.prototype.getThreshold=function(){return this._minLevel},d.prototype.log=function(a,b,d,g,h,i,j,k,l){l.level<this._minLevel||(g[0]=a+" ["+d+"] "+b+" "+g[0],l.level>c.level.INFO?f(g):e(g))};var e=function(a){console.log.apply(console,a)}||function(){},f=function(a){console.error.apply(console,a)}||e;return d}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){(function(d){var e,f;e=[c(0),c(1),c(14)],f=function(a,b,c){"use strict";function e(){this._appenders=[],this._userId=null,this._sessionId=null,this._environment=l,this._applicationVersion=m}function f(a){this._sessionId=a,a?this.info("Session started on websdk version [%s] ([%s]), user agent [%s]",m,n,navigator.userAgent):this.info("Websdk version [%s] ([%s]), user agent [%s]",m,n,navigator.userAgent)}function g(b,c){var d=a.now(),e=(d-k)/1e3,f=h(c.level),g=c.name||j,i=this;a.forEach(this._appenders,function(a){try{a.log(e,f,g,o(Array.prototype.slice.call(b)),i._sessionId,i._userId,i._environment,i._applicationVersion,c)}catch(d){}})}function h(a){switch(a){case c.level.TRACE:return"Trace";case c.level.DEBUG:return"Debug";case c.level.INFO:return"Info";case c.level.WARN:return"Warn";case c.level.ERROR:return"Error";case c.level.FATAL:return"Fatal";default:throw new Error("Unsupported Logging Level "+a)}}function i(){return"object"==typeof window?window:"object"==typeof d?d:{}}var j="websdk",k=i().__phenixPageLoadTime||i().__pageLoadTime||a.now(),l="production",m="2018-04-17T00:14:18Z",n="2018.2.3";e.prototype.trace=function(){return g.call(this,arguments,{level:c.level.TRACE})},e.prototype.debug=function(){return g.call(this,arguments,{level:c.level.DEBUG})},e.prototype.info=function(){return g.call(this,arguments,{level:c.level.INFO})},e.prototype.warn=function(){return g.call(this,arguments,{level:c.level.WARN})},e.prototype.error=function(){return g.call(this,arguments,{level:c.level.ERROR})},e.prototype.fatal=function(){return g.call(this,arguments,{level:c.level.FATAL})},e.prototype.addAppender=function(a){b.isObject(a,"appender"),b.isFunction(a.log,"appender.log"),this._appenders.push(a)},e.prototype.getAppenders=function(){return this._appenders},e.prototype.getUserId=function(){return this._userId},e.prototype.setUserId=function(a){this._userId=a},e.prototype.getEnvironment=function(){return this._environment},e.prototype.setEnvironment=function(a){this._environment=a},e.prototype.getApplicationVersion=function(){return this._applicationVersion},e.prototype.setApplicationVersion=function(a){this._applicationVersion=a},e.prototype.getObservableSessionId=function(){return this._observableSessionId},e.prototype.setObservableSessionId=function(c){this._observableSessionId=c,this._sessionIdSubscription&&this._sessionIdSubscription.dispose(),c&&(b.isObject(c,"observableSessionId"),this._sessionIdSubscription=this._observableSessionId.subscribe(a.bind(f,this),{initial:"notify"}))};var o=function(b){if(0!==b.length){var c=[],d=[];return a.forEach(b,function(b){c.push(a.toString(b)),b instanceof Error&&d.push(b.stack)}),p(c.concat(d))}},p=function(a){for(var b=a[0],c=0;b.indexOf&&a.length>1&&c>=0;)if(c=b.indexOf("%",c),c>0){var d=b.substring(c+1,c+2);switch(d){case"%":b=b.substring(0,c)+b.substring(c+1),c++;break;case"s":case"d":a[0]=b=b.substring(0,c)+a[1]+b.substring(c+2),a.splice(1,1);break;default:return a}}return a};return e}.apply(b,e),!(void 0!==f&&(a.exports=f))}).call(b,c(73))},function(a,b,c){var d,e;d=[c(0),c(5),c(4),c(3)],e=function(a,b,c,d){"use strict";function e(){var d="undefined"==typeof navigator||navigator.onLine;this._onlineObservable=new c.Observable(d).extend({timeout:0}),this._namedEvents=new b.NamedEvents,"undefined"!=typeof window&&(a.addEventListener(window,"online",a.bind(this._namedEvents.fire,this._namedEvents,"online",[])),a.addEventListener(window,"offline",a.bind(this._namedEvents.fire,this._namedEvents,"offline",[])),a.addEventListener(window,"unload",a.bind(this._namedEvents.dispose,this._namedEvents))),this._namedEvents.listen("online",a.bind(this._onlineObservable.setValue,this._onlineObservable,!0)),this._namedEvents.listen("offline",a.bind(this._onlineObservable.setValue,this._onlineObservable,!1))}function f(b,c){var d=this;return this._onlineObservable.setValue(!1),a.isNumber(c)?void(d.offlineTimeout=setTimeout(function(){b&&!d._onlineObservable.getValue()&&b(!1)},c)):b(!1)}function g(a){this._onlineObservable.setValue(!0),a&&a(!0)}return e.prototype.listenForNetworkChange=function(b,c){var e=new d.DisposableList,h=a.bind(g,this,b),i=a.bind(f,this,b,c);return e.add(this._namedEvents.listen("online",h)),e.add(this._namedEvents.listen("offline",i)),e},e.prototype.isOnline=function(){return this._onlineObservable.getValue()},new e}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(28)],e=function(a,b,c){"use strict";function d(a,d){var e=a;void 0!==e&&null!==e||(e=[]),b.isArray(e,"valuesToSet"),this.observableArray=new c(e,d)}return d.prototype.getValue=function(){return this.observableArray.getValue()},d.prototype.setValue=function(a){return void 0!==a&&null!==a||(a=[]),void 0!==a&&b.isArray(a,"values"),this.observableArray.setValue(a)},d.prototype.subscribe=function(a,b){return this.observableArray.subscribe(a,b)},d.prototype.push=function(a){var b=this.observableArray.getValue();b.push(a),this.observableArray.setValue(b)},d.prototype.pop=function(){var a=this.observableArray.getValue(),b=a.pop();return this.observableArray.setValue(a),b},d.prototype.remove=function(b){var c=this.observableArray.getValue(),d=function(c){return a.isFunction(b)?b(c):c===b},e=a.filter(c,d);return e.length>0&&this.observableArray.setValue(a.remove(c,d)),e},d.prototype.removeAll=function(){var a=this.observableArray.getValue();return this.observableArray.setValue([]),a},d.prototype.extend=function(a){return this.observableArray.extend(a),this},d}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1)],e=function(a,b){"use strict";function c(a){b.isObject(a,"observable"),this._observable=a,this._listenerSubscription=null,this._isEnabled=!1}return c.prototype.start=function(b,c){this._isEnabled=!0,this._listenerSubscription=this._observable.subscribe(a.noop,{listenForChanges:{callback:b,timeout:c||500}})},c.prototype.stop=function(){this._isEnabled=!1,this._listenerSubscription&&this._listenerSubscription.dispose(),this._listenerSubscription=null},c.prototype.isEnabled=function(){return this._isEnabled},c}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(52),c(30),c(12)],e=function(a,b,c,d,e){function f(e,f,i,j,k){b.isStringNotEmpty(e,"uri"),b.isArray(f,"protocols"),b.isStringNotEmpty(i,"type"),b.isObject(j,"options");var l=a.assign({},j||{},{contentType:"application/protobuf"}),m=new d(f,k);return new c(e,l,a.bind(g,this,m,i),a.bind(h,this,m,i))}function g(a,b,c){return a.encode(b,c).toBinary()}function h(a,b,c){return a.decode(b+"Response",e.fromBinary(c))}return f}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(5),c(70),c(31)],e=function(a,b,c,d,e){"use strict";function f(f,g,o,p){b.isStringNotEmpty(f,"uri"),b.isObject(g,"logger"),b.isArray(o,"protocols"),this._uri=f,this._logger=g,this._logger.info("Connecting to [%s]",f),this._webSocket=new d(this._uri,this._logger),this._mqService=new e(this._logger,a.bind(n,this),a.bind(m,this),o,p),this._namedEvents=new c.NamedEvents,this._webSocket.onconnected=a.bind(i,this),this._webSocket.onreconnecting=a.bind(h,this),this._webSocket.onreconnected=a.bind(j,this),this._webSocket.ondisconnected=a.bind(k,this),this._webSocket.onerror=a.bind(l,this),this._disconnected=!1}function g(a,b){this._namedEvents.fire(a,b,this)}function h(a){g.call(this,"reconnecting")}function i(a){g.call(this,"connected")}function j(a){g.call(this,"reconnected")}function k(a){g.call(this,"disconnected",[a.code,a.reason]),this._disconnected&&(this._namedEvents.dispose(),this._mqService.dispose())}function l(a){g.call(this,"error",[a.data])}function m(a){this._webSocket.onmessage=a}function n(a){this._webSocket&&this._webSocket.send(a)}return f.prototype.onEvent=function(a,b){return this._namedEvents.listen(a,b),this._mqService.onEvent(a,b)},f.prototype.onRequest=function(a,b){return this._mqService.onRequest(a,b)},f.prototype.sendRequest=function(a,b,c,d){return this._mqService.sendRequest(a,b,c,d)},f.prototype.sendResponse=function(a,b,c,d){return this._mqService.sendResponse(a,b,c,d)},f.prototype.disconnect=function(){return this._disconnected=!0,this._webSocket.disconnect()},f.prototype.disposeOfPendingRequests=function(){return this._logger.info("Disposing of pending MQ WebSocket requests"),this._mqService.disposeOfRequests()},f.prototype.getApiVersion=function(){return this._mqService.getApiVersion()},f.prototype.toString=function(){return"MQWebSocket["+this._webSocket.toString()+"]"},f}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";var a={"package":"mq",messages:[{name:"Message",fields:[{rule:"optional",type:"MessageType",name:"messageType",id:7,options:{"default":"Request"}},{rule:"optional",type:"string",name:"sessionId",id:1},{rule:"optional",type:"string",name:"requestId",id:2},{rule:"required",type:"string",name:"type",id:3},{rule:"optional",type:"string",name:"encoding",id:4},{rule:"required",type:"bytes",name:"payload",id:5},{rule:"repeated",type:"double",name:"wallTime",id:6}],enums:[{name:"MessageType",values:[{name:"Request",id:0},{name:"Response",id:1},{name:"Event",id:2}]}]},{name:"Error",fields:[{rule:"required",type:"string",name:"reason",id:1}]},{name:"PingPong",fields:[{rule:"required",type:"uint64",name:"originTimestamp",id:1},{rule:"optional",type:"uint64",name:"count",id:2}]}]};return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(27)],e=function(a,b,c){"use strict";function d(d,e,g,h){b.isStringNotEmpty(d,"uri"),b.isObject(e,"logger"),a.isNullOrUndefined(g)?g=v:b.isNumber(g,"maxReconnectAttempts"),this._uri=d,this._logger=e,this._maxReconnectAttempts=g,this._reconnectBackoffInterval=h||u,this._hasAttemptedReconnect=!1,this._stopped=!1,this._queuedMessages=[],this._connectionState="connecting",this._logger.info("Connecting WebSocket to [%s]",d),this._webSocket=f.call(this,k,i);var l=this;this._disconnectTimeoutId=null,this._networkConnectionMonitorDisposable=c.listenForNetworkChange(function(b){return b?(a.isNumber(l._disconnectTimeoutId)&&(clearTimeout(l._disconnectTimeoutId),l._disconnectTimeoutId=null),p.call(l)):void(a.isNumber(l._disconnectTimeoutId)||(j.call(l),l._disconnectTimeoutId=setTimeout(function(){return q.call(l)},s)))},0)}function e(a){return this._webSocket.readyState===x.closed.code?i.call(this,a):this._webSocket.close(a.code,a.reason)}function f(b,c){var d=new WebSocket(this._uri);return d.onopen=a.bind(b,this),d.onclose=a.bind(c,this),d.onmessage=a.bind(o,this),d.onerror=a.bind(n,this),d}function g(a){var b=this;return setTimeout(function(){h.call(b,a)},a*a*this._reconnectBackoffInterval)}function h(a){this._webSocket.readyState!==x.open.code&&this.reconnect(a+1)}function i(a){switch(a.code){case w.reconnecting.code:return;case w.byebye.code:case w.backoffLimitReached.code:case w.networkDisconnect.code:return m.call(this,a);default:if(this._hasAttemptedReconnect)return;return j.call(this,a),this._logger.info("Attempting to re-establish socket connection after disconnect event with code [%s] and reason [%s]",a.code,a.reason),this.reconnect()}}function j(a){this._logger.info("WebSocket is reconnecting"),this._connectionState="reconnecting",this.onreconnecting&&this.onreconnecting(a)}function k(a){this._logger.info("WebSocket Connected"),r.call(this),this._connectionState="connected",this.onconnected&&this.onconnected(a)}function l(a){this._logger.info("Successfully reconnected to WebSocket"),this._connectionState="reconnected",this.onreconnected&&this.onreconnected(a)}function m(a){this._logger.info("WebSocket Disconnected [%s]: [%s]",a.code,a.reason),this._connectionState="disconnected",this.ondisconnected&&this.ondisconnected(a)}function n(a){this._logger.error("An error occurred on the WebSocket connection [%s]",a.data||a),this.onerror&&this.onerror(a)}function o(a){this._logger.debug(">> [%s]",a.data),this.onmessage&&this.onmessage(a)}function p(){var a=this;setTimeout(function(){return a._stopped?a._logger.info("Unable to go back online after network reconnect. Client has stopped WebSocket."):a._webSocket.readyState!==x.open.code?(a._logger.info("Network Reconnected. Attempting to reconnect WebSocket."),a.reconnect()):a._didGoOfflineDueToDisconnect?(a._logger.info("Network Reconnected with WebSocket status of [%s].",x.open.state),k.call(a)):("online"===a._connectionState&&"reconnected"===this._connectionState||l.call(a),void a._logger.info("Network Reconnected."))},t)}function q(){this._logger.warn("Network not reconnected after [%s]. Going Offline and disconnecting WebSocket connection.",s),this._didGoOfflineDueToDisconnect=!0,m.call(this,w.networkDisconnect)}function r(){var a=this._queuedMessages.length;if(0!==a)for(this._logger.info("Sending [%s] queued messages",a);a>0;){a--;var b=this._queuedMessages.shift();this.send(b)}}var s=15e3,t=1e3,u=1e3,v=4,w={byebye:{code:1e3,reason:"byebye",desc:"Client closed"},backoffLimitReached:{code:4e3,reason:"backoff-limit-reached",desc:"Reached the limit in terms of the number of reconnects"},networkDisconnect:{code:4001,reason:"network-disconnect",desc:"Network connection monitor determined loss to internet connectivity"},reconnecting:{code:4002,reason:"reconnecting",desc:"Closing WebSocket in order to attempt to establish another connection"}},x={connecting:{code:0,state:"CONNECTING",desc:"The connection is not yet open"},open:{code:1,state:"OPEN",desc:"The connection is open and ready to communicate"},closing:{code:2,state:"CLOSING",desc:"The connection is in the process of closing"},closed:{code:3,state:"CLOSED",desc:"The connection is closed or could not be opened"}};return d.prototype.onmessage=null,d.prototype.onconnected=null,d.prototype.onreconnecting=null,d.prototype.onreconnected=null,d.prototype.ondisconnected=null,d.prototype.onerror=null,d.prototype.send=function(a){return!c.isOnline(),this._webSocket.send(a)},d.prototype.reconnect=function(b){this._webSocket.onclose=null,this._webSocket.onerror=null,this._hasAttemptedReconnect=!0;var c,d=this;if(a.isNumber(b)||(b=1),this._stopped)return this._logger.info("Client has stopped WebSocket after [%s] reconnect attempts",b-1);if(b>this._maxReconnectAttempts)return this._logger.warn("Unable to reconnect WebSocket after [%s] attempts",this._maxReconnectAttempts),e.call(this,w.backoffLimitReached);e.call(this,w.reconnecting);try{this._webSocket=f.call(d,function(){return c&&clearTimeout(c),d._hasAttemptedReconnect=!1,d._webSocket.onclose=a.bind(i,d),l.call(d)},function(){b+1>d._maxReconnectAttempts&&(c&&clearTimeout(c),h.call(d,b))})}catch(j){this._logger.warn("Unable to create WebSocket connection [%s]",j)}c=g.call(this,b)},d.prototype.disconnect=function(){return this._networkConnectionMonitorDisposable.dispose(),this._stopped=!0,a.isNumber(this._disconnectTimeoutId)&&(clearTimeout(this._disconnectTimeoutId),this._disconnectTimeoutId=null),this._webSocket.close(w.byebye.code,w.byebye.reason)},d.prototype.toString=function(){return"ReconnectedWebSocket["+this._uri+","+this._webSocket.readyState+"]"},d}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(69)],e=function(a){"use strict";return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b){function c(){throw new Error("setTimeout has not been defined")}function d(){throw new Error("clearTimeout has not been defined")}function e(a){if(k===setTimeout)return setTimeout(a,0);if((k===c||!k)&&setTimeout)return k=setTimeout,setTimeout(a,0);try{return k(a,0)}catch(b){try{return k.call(null,a,0)}catch(b){return k.call(this,a,0)}}}function f(a){if(l===clearTimeout)return clearTimeout(a);if((l===d||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(a);try{return l(a)}catch(b){try{return l.call(null,a)}catch(b){return l.call(this,a)}}}function g(){p&&n&&(p=!1,n.length?o=n.concat(o):q=-1,o.length&&h())}function h(){if(!p){var a=e(g);p=!0;for(var b=o.length;b;){for(n=o,o=[];++q<b;)n&&n[q].run();q=-1,b=o.length}n=null,p=!1,f(a)}}function i(a,b){this.fun=a,this.array=b}function j(){}var k,l,m=a.exports={};!function(){try{k="function"==typeof setTimeout?setTimeout:c}catch(a){k=c}try{l="function"==typeof clearTimeout?clearTimeout:d}catch(a){l=d}}();var n,o=[],p=!1,q=-1;m.nextTick=function(a){var b=new Array(arguments.length-1);if(arguments.length>1)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];o.push(new i(a,b)),1!==o.length||p||e(h)},i.prototype.run=function(){this.fun.apply(null,this.array)},m.title="browser",m.browser=!0,m.env={},m.argv=[],m.version="",m.versions={},m.on=j,m.addListener=j,m.once=j,m.off=j,m.removeListener=j,m.removeAllListeners=j,m.emit=j,m.prependListener=j,m.prependOnceListener=j,m.listeners=function(a){return[]},m.binding=function(a){throw new Error("process.binding is not supported")},m.cwd=function(){return"/"},m.chdir=function(a){throw new Error("process.chdir is not supported")},m.umask=function(){return 0}},function(a,b,c){(function(d){var e,f,g;!function(d,h){
f=[c(12)],e=h,g="function"==typeof e?e.apply(b,f):e,!(void 0!==g&&(a.exports=g))}(this,function(a,b){"use strict";var e={};return e.ByteBuffer=a,e.Long=a.Long||null,e.VERSION="5.0.0",e.WIRE_TYPES={},e.WIRE_TYPES.VARINT=0,e.WIRE_TYPES.BITS64=1,e.WIRE_TYPES.LDELIM=2,e.WIRE_TYPES.STARTGROUP=3,e.WIRE_TYPES.ENDGROUP=4,e.WIRE_TYPES.BITS32=5,e.PACKABLE_WIRE_TYPES=[e.WIRE_TYPES.VARINT,e.WIRE_TYPES.BITS64,e.WIRE_TYPES.BITS32],e.TYPES={int32:{name:"int32",wireType:e.WIRE_TYPES.VARINT,defaultValue:0},uint32:{name:"uint32",wireType:e.WIRE_TYPES.VARINT,defaultValue:0},sint32:{name:"sint32",wireType:e.WIRE_TYPES.VARINT,defaultValue:0},int64:{name:"int64",wireType:e.WIRE_TYPES.VARINT,defaultValue:e.Long?e.Long.ZERO:void 0},uint64:{name:"uint64",wireType:e.WIRE_TYPES.VARINT,defaultValue:e.Long?e.Long.UZERO:void 0},sint64:{name:"sint64",wireType:e.WIRE_TYPES.VARINT,defaultValue:e.Long?e.Long.ZERO:void 0},bool:{name:"bool",wireType:e.WIRE_TYPES.VARINT,defaultValue:!1},"double":{name:"double",wireType:e.WIRE_TYPES.BITS64,defaultValue:0},string:{name:"string",wireType:e.WIRE_TYPES.LDELIM,defaultValue:""},bytes:{name:"bytes",wireType:e.WIRE_TYPES.LDELIM,defaultValue:null},fixed32:{name:"fixed32",wireType:e.WIRE_TYPES.BITS32,defaultValue:0},sfixed32:{name:"sfixed32",wireType:e.WIRE_TYPES.BITS32,defaultValue:0},fixed64:{name:"fixed64",wireType:e.WIRE_TYPES.BITS64,defaultValue:e.Long?e.Long.UZERO:void 0},sfixed64:{name:"sfixed64",wireType:e.WIRE_TYPES.BITS64,defaultValue:e.Long?e.Long.ZERO:void 0},"float":{name:"float",wireType:e.WIRE_TYPES.BITS32,defaultValue:0},"enum":{name:"enum",wireType:e.WIRE_TYPES.VARINT,defaultValue:0},message:{name:"message",wireType:e.WIRE_TYPES.LDELIM,defaultValue:null},group:{name:"group",wireType:e.WIRE_TYPES.STARTGROUP,defaultValue:null}},e.MAP_KEY_TYPES=[e.TYPES.int32,e.TYPES.sint32,e.TYPES.sfixed32,e.TYPES.uint32,e.TYPES.fixed32,e.TYPES.int64,e.TYPES.sint64,e.TYPES.sfixed64,e.TYPES.uint64,e.TYPES.fixed64,e.TYPES.bool,e.TYPES.string,e.TYPES.bytes],e.ID_MIN=1,e.ID_MAX=536870911,e.convertFieldsToCamelCase=!1,e.populateAccessors=!0,e.populateDefaults=!0,e.Util=function(){var a={};return a.IS_NODE=!("object"!=typeof d||d+""!="[object process]"||d.browser),a.XHR=function(){for(var a=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],b=null,c=0;c<a.length;c++){try{b=a[c]()}catch(d){continue}break}if(!b)throw Error("XMLHttpRequest is not supported");return b},a.fetch=function(b,d){if(d&&"function"!=typeof d&&(d=null),a.IS_NODE){var e=c(104);if(d)e.readFile(b,function(a,b){d(a?null:""+b)});else try{return e.readFileSync(b)}catch(f){return null}}else{var g=a.XHR();if(g.open("GET",b,!!d),g.setRequestHeader("Accept","text/plain"),"function"==typeof g.overrideMimeType&&g.overrideMimeType("text/plain"),!d)return g.send(null),200==g.status||0==g.status&&"string"==typeof g.responseText?g.responseText:null;if(g.onreadystatechange=function(){4==g.readyState&&d(200==g.status||0==g.status&&"string"==typeof g.responseText?g.responseText:null)},4==g.readyState)return;g.send(null)}},a.toCamelCase=function(a){return a.replace(/_([a-zA-Z])/g,function(a,b){return b.toUpperCase()})},a}(),e.Lang={DELIM:/[\s\{\}=;:\[\],'"\(\)<>]/g,RULE:/^(?:required|optional|repeated|map)$/,TYPE:/^(?:double|float|int32|uint32|sint32|int64|uint64|sint64|fixed32|sfixed32|fixed64|sfixed64|bool|string|bytes)$/,NAME:/^[a-zA-Z_][a-zA-Z_0-9]*$/,TYPEDEF:/^[a-zA-Z][a-zA-Z_0-9]*$/,TYPEREF:/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)+$/,FQTYPEREF:/^(?:\.[a-zA-Z][a-zA-Z_0-9]*)+$/,NUMBER:/^-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+|([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?)|inf|nan)$/,NUMBER_DEC:/^(?:[1-9][0-9]*|0)$/,NUMBER_HEX:/^0[xX][0-9a-fA-F]+$/,NUMBER_OCT:/^0[0-7]+$/,NUMBER_FLT:/^([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?|inf|nan)$/,BOOL:/^(?:true|false)$/i,ID:/^(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,NEGID:/^\-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,WHITESPACE:/\s/,STRING:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")|(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,STRING_DQ:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,STRING_SQ:/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g},e.DotProto=function(a,b){function c(a,c){var d=-1,e=1;if("-"==a.charAt(0)&&(e=-1,a=a.substring(1)),b.NUMBER_DEC.test(a))d=parseInt(a);else if(b.NUMBER_HEX.test(a))d=parseInt(a.substring(2),16);else{if(!b.NUMBER_OCT.test(a))throw Error("illegal id value: "+(e<0?"-":"")+a);d=parseInt(a.substring(1),8)}if(d=e*d|0,!c&&d<0)throw Error("illegal id value: "+(e<0?"-":"")+a);return d}function d(a){var c=1;if("-"==a.charAt(0)&&(c=-1,a=a.substring(1)),b.NUMBER_DEC.test(a))return c*parseInt(a,10);if(b.NUMBER_HEX.test(a))return c*parseInt(a.substring(2),16);if(b.NUMBER_OCT.test(a))return c*parseInt(a.substring(1),8);if("inf"===a)return c*(1/0);if("nan"===a)return NaN;if(b.NUMBER_FLT.test(a))return c*parseFloat(a);throw Error("illegal number value: "+(c<0?"-":"")+a)}function e(a,b,c){"undefined"==typeof a[b]?a[b]=c:(Array.isArray(a[b])||(a[b]=[a[b]]),a[b].push(c))}var f={},g=function(a){this.source=a+"",this.index=0,this.line=1,this.stack=[],this._stringOpen=null},h=g.prototype;h._readString=function(){var a='"'===this._stringOpen?b.STRING_DQ:b.STRING_SQ;a.lastIndex=this.index-1;var c=a.exec(this.source);if(!c)throw Error("unterminated string");return this.index=a.lastIndex,this.stack.push(this._stringOpen),this._stringOpen=null,c[1]},h.next=function(){if(this.stack.length>0)return this.stack.shift();if(this.index>=this.source.length)return null;if(null!==this._stringOpen)return this._readString();var a,c,d;do{for(a=!1;b.WHITESPACE.test(d=this.source.charAt(this.index));)if("\n"===d&&++this.line,++this.index===this.source.length)return null;if("/"===this.source.charAt(this.index))if(++this.index,"/"===this.source.charAt(this.index)){for(;"\n"!==this.source.charAt(++this.index);)if(this.index==this.source.length)return null;++this.index,++this.line,a=!0}else{if("*"!==(d=this.source.charAt(this.index)))return"/";do{if("\n"===d&&++this.line,++this.index===this.source.length)return null;c=d,d=this.source.charAt(this.index)}while("*"!==c||"/"!==d);++this.index,a=!0}}while(a);if(this.index===this.source.length)return null;var e=this.index;b.DELIM.lastIndex=0;var f=b.DELIM.test(this.source.charAt(e++));if(!f)for(;e<this.source.length&&!b.DELIM.test(this.source.charAt(e));)++e;var g=this.source.substring(this.index,this.index=e);return'"'!==g&&"'"!==g||(this._stringOpen=g),g},h.peek=function(){if(0===this.stack.length){var a=this.next();if(null===a)return null;this.stack.push(a)}return this.stack[0]},h.skip=function(a){var b=this.next();if(b!==a)throw Error("illegal '"+b+"', '"+a+"' expected")},h.omit=function(a){return this.peek()===a&&(this.next(),!0)},h.toString=function(){return"Tokenizer ("+this.index+"/"+this.source.length+" at line "+this.line+")"},f.Tokenizer=g;var i=function(a){this.tn=new g(a),this.proto3=!1},j=i.prototype;return j.parse=function(){var a,c={name:"[ROOT]","package":null,messages:[],enums:[],imports:[],options:{},services:[]},d=!0;try{for(;a=this.tn.next();)switch(a){case"package":if(!d||null!==c["package"])throw Error("unexpected 'package'");if(a=this.tn.next(),!b.TYPEREF.test(a))throw Error("illegal package name: "+a);this.tn.skip(";"),c["package"]=a;break;case"import":if(!d)throw Error("unexpected 'import'");a=this.tn.peek(),"public"===a&&this.tn.next(),a=this._readString(),this.tn.skip(";"),c.imports.push(a);break;case"syntax":if(!d)throw Error("unexpected 'syntax'");this.tn.skip("="),"proto3"===(c.syntax=this._readString())&&(this.proto3=!0),this.tn.skip(";");break;case"message":this._parseMessage(c,null),d=!1;break;case"enum":this._parseEnum(c),d=!1;break;case"option":this._parseOption(c);break;case"service":this._parseService(c);break;case"extend":this._parseExtend(c);break;default:throw Error("unexpected '"+a+"'")}}catch(e){throw e.message="Parse error at line "+this.tn.line+": "+e.message,e}return delete c.name,c},i.parse=function(a){return new i(a).parse()},j._readString=function(){var a,b,c="";do{if(b=this.tn.next(),"'"!==b&&'"'!==b)throw Error("illegal string delimiter: "+b);c+=this.tn.next(),this.tn.skip(b),a=this.tn.peek()}while('"'===a||'"'===a);return c},j._readValue=function(a){var c=this.tn.peek();if('"'===c||"'"===c)return this._readString();if(this.tn.next(),b.NUMBER.test(c))return d(c);if(b.BOOL.test(c))return"true"===c.toLowerCase();if(a&&b.TYPEREF.test(c))return c;throw Error("illegal value: "+c)},j._parseOption=function(a,c){var d=this.tn.next(),e=!1;if("("===d&&(e=!0,d=this.tn.next()),!b.TYPEREF.test(d))throw Error("illegal option name: "+d);var f=d;e&&(this.tn.skip(")"),f="("+f+")",d=this.tn.peek(),b.FQTYPEREF.test(d)&&(f+=d,this.tn.next())),this.tn.skip("="),this._parseOptionValue(a,f),c||this.tn.skip(";")},j._parseOptionValue=function(a,c){var d=this.tn.peek();if("{"!==d)e(a.options,c,this._readValue(!0));else for(this.tn.skip("{");"}"!==(d=this.tn.next());){if(!b.NAME.test(d))throw Error("illegal option name: "+c+"."+d);this.tn.omit(":")?e(a.options,c+"."+d,this._readValue(!0)):this._parseOptionValue(a,c+"."+d)}},j._parseService=function(a){var c=this.tn.next();if(!b.NAME.test(c))throw Error("illegal service name at line "+this.tn.line+": "+c);var d=c,e={name:d,rpc:{},options:{}};for(this.tn.skip("{");"}"!==(c=this.tn.next());)if("option"===c)this._parseOption(e);else{if("rpc"!==c)throw Error("illegal service token: "+c);this._parseServiceRPC(e)}this.tn.omit(";"),a.services.push(e)},j._parseServiceRPC=function(a){var c="rpc",d=this.tn.next();if(!b.NAME.test(d))throw Error("illegal rpc service method name: "+d);var e=d,f={request:null,response:null,request_stream:!1,response_stream:!1,options:{}};if(this.tn.skip("("),d=this.tn.next(),"stream"===d.toLowerCase()&&(f.request_stream=!0,d=this.tn.next()),!b.TYPEREF.test(d))throw Error("illegal rpc service request type: "+d);if(f.request=d,this.tn.skip(")"),d=this.tn.next(),"returns"!==d.toLowerCase())throw Error("illegal rpc service request type delimiter: "+d);if(this.tn.skip("("),d=this.tn.next(),"stream"===d.toLowerCase()&&(f.response_stream=!0,d=this.tn.next()),f.response=d,this.tn.skip(")"),d=this.tn.peek(),"{"===d){for(this.tn.next();"}"!==(d=this.tn.next());){if("option"!==d)throw Error("illegal rpc service token: "+d);this._parseOption(f)}this.tn.omit(";")}else this.tn.skip(";");"undefined"==typeof a[c]&&(a[c]={}),a[c][e]=f},j._parseMessage=function(a,d){var e=!!d,f=this.tn.next(),g={name:"",fields:[],enums:[],messages:[],options:{},services:[],oneofs:{}};if(!b.NAME.test(f))throw Error("illegal "+(e?"group":"message")+" name: "+f);for(g.name=f,e&&(this.tn.skip("="),d.id=c(this.tn.next()),g.isGroup=!0),f=this.tn.peek(),"["===f&&d&&this._parseFieldOptions(d),this.tn.skip("{");"}"!==(f=this.tn.next());)if(b.RULE.test(f))this._parseMessageField(g,f);else if("oneof"===f)this._parseMessageOneOf(g);else if("enum"===f)this._parseEnum(g);else if("message"===f)this._parseMessage(g);else if("option"===f)this._parseOption(g);else if("service"===f)this._parseService(g);else if("extensions"===f)this._parseExtensions(g);else if("extend"===f)this._parseExtend(g);else if("reserved"===f)this._parseMessageReserved(g);else{if(!b.TYPEREF.test(f))throw Error("illegal message token: "+f);if(!this.proto3)throw Error("illegal field rule: "+f);this._parseMessageField(g,"optional",f)}return this.tn.omit(";"),a.messages.push(g),g},j._parseMessageReserved=function(a){for(;";"!==this.tn.peek();)this.tn.next();this.tn.skip(";")},j._parseMessageField=function(a,d,e){if(!b.RULE.test(d))throw Error("illegal message field rule: "+d);var f,g={rule:d,type:"",name:"",options:{},id:0};if("map"===d){if(e)throw Error("illegal type: "+e);if(this.tn.skip("<"),f=this.tn.next(),!b.TYPE.test(f)&&!b.TYPEREF.test(f))throw Error("illegal message field type: "+f);if(g.keytype=f,this.tn.skip(","),f=this.tn.next(),!b.TYPE.test(f)&&!b.TYPEREF.test(f))throw Error("illegal message field: "+f);if(g.type=f,this.tn.skip(">"),f=this.tn.next(),!b.NAME.test(f))throw Error("illegal message field name: "+f);g.name=f,this.tn.skip("="),g.id=c(this.tn.next()),f=this.tn.peek(),"["===f&&this._parseFieldOptions(g),this.tn.skip(";")}else if(e="undefined"!=typeof e?e:this.tn.next(),"group"===e){var h=this._parseMessage(a,g);if(!/^[A-Z]/.test(h.name))throw Error("illegal group name: "+h.name);g.type=h.name,g.name=h.name.toLowerCase(),this.tn.omit(";")}else{if(!b.TYPE.test(e)&&!b.TYPEREF.test(e))throw Error("illegal message field type: "+e);if(g.type=e,f=this.tn.next(),!b.NAME.test(f))throw Error("illegal message field name: "+f);g.name=f,this.tn.skip("="),g.id=c(this.tn.next()),f=this.tn.peek(),"["===f&&this._parseFieldOptions(g),this.tn.skip(";")}return a.fields.push(g),g},j._parseMessageOneOf=function(a){var c=this.tn.next();if(!b.NAME.test(c))throw Error("illegal oneof name: "+c);var d,e=c,f=[];for(this.tn.skip("{");"}"!==(c=this.tn.next());)d=this._parseMessageField(a,"optional",c),d.oneof=e,f.push(d.id);this.tn.omit(";"),a.oneofs[e]=f},j._parseFieldOptions=function(a){this.tn.skip("[");for(var b,c=!0;"]"!==(b=this.tn.peek());)c||this.tn.skip(","),this._parseOption(a,!0),c=!1;this.tn.next()},j._parseEnum=function(a){var d={name:"",values:[],options:{}},e=this.tn.next();if(!b.NAME.test(e))throw Error("illegal name: "+e);for(d.name=e,this.tn.skip("{");"}"!==(e=this.tn.next());)if("option"===e)this._parseOption(d);else{if(!b.NAME.test(e))throw Error("illegal name: "+e);this.tn.skip("=");var f={name:e,id:c(this.tn.next(),!0)};e=this.tn.peek(),"["===e&&this._parseFieldOptions({options:{}}),this.tn.skip(";"),d.values.push(f)}this.tn.omit(";"),a.enums.push(d)},j._parseExtensions=function(b){var c=this.tn.next(),e=[];"min"===c?e.push(a.ID_MIN):"max"===c?e.push(a.ID_MAX):e.push(d(c)),this.tn.skip("to"),c=this.tn.next(),"min"===c?e.push(a.ID_MIN):"max"===c?e.push(a.ID_MAX):e.push(d(c)),this.tn.skip(";"),b.extensions=e},j._parseExtend=function(a){var c=this.tn.next();if(!b.TYPEREF.test(c))throw Error("illegal extend reference: "+c);var d={ref:c,fields:[]};for(this.tn.skip("{");"}"!==(c=this.tn.next());)if(b.RULE.test(c))this._parseMessageField(d,c);else{if(!b.TYPEREF.test(c))throw Error("illegal extend token: "+c);if(!this.proto3)throw Error("illegal field rule: "+c);this._parseMessageField(d,"optional",c)}return this.tn.omit(";"),a.messages.push(d),d},j.toString=function(){return"Parser at line "+this.tn.line},f.Parser=i,f}(e,e.Lang),e.Reflect=function(b){function c(c){if("string"==typeof c&&(c=b.TYPES[c]),"undefined"==typeof c.defaultValue)throw Error("default value for type "+c.name+" is not supported");return c==b.TYPES.bytes?new a(0):c.defaultValue}function d(a,c){if(a&&"number"==typeof a.low&&"number"==typeof a.high&&"boolean"==typeof a.unsigned&&a.low===a.low&&a.high===a.high)return new b.Long(a.low,a.high,"undefined"==typeof c?a.unsigned:c);if("string"==typeof a)return b.Long.fromString(a,c||!1,10);if("number"==typeof a)return b.Long.fromNumber(a,c||!1);throw Error("not convertible to Long")}function e(a,c){var d=c.readVarint32(),f=7&d,g=d>>>3;switch(f){case b.WIRE_TYPES.VARINT:do d=c.readUint8();while(128===(128&d));break;case b.WIRE_TYPES.BITS64:c.offset+=8;break;case b.WIRE_TYPES.LDELIM:d=c.readVarint32(),c.offset+=d;break;case b.WIRE_TYPES.STARTGROUP:e(g,c);break;case b.WIRE_TYPES.ENDGROUP:if(g===a)return!1;throw Error("Illegal GROUPEND after unknown group: "+g+" ("+a+" expected)");case b.WIRE_TYPES.BITS32:c.offset+=4;break;default:throw Error("Illegal wire type in unknown group "+a+": "+f)}return!0}var f={},g=function(a,b,c){this.builder=a,this.parent=b,this.name=c,this.className},h=g.prototype;h.fqn=function(){for(var a=this.name,b=this;;){if(b=b.parent,null==b)break;a=b.name+"."+a}return a},h.toString=function(a){return(a?this.className+" ":"")+this.fqn()},h.build=function(){throw Error(this.toString(!0)+" cannot be built directly")},f.T=g;var i=function(a,b,c,d,e){g.call(this,a,b,c),this.className="Namespace",this.children=[],this.options=d||{},this.syntax=e||"proto2"},j=i.prototype=Object.create(g.prototype);j.getChildren=function(a){if(a=a||null,null==a)return this.children.slice();for(var b=[],c=0,d=this.children.length;c<d;++c)this.children[c]instanceof a&&b.push(this.children[c]);return b},j.addChild=function(a){var b;if(b=this.getChild(a.name))if(b instanceof m.Field&&b.name!==b.originalName&&null===this.getChild(b.originalName))b.name=b.originalName;else{if(!(a instanceof m.Field&&a.name!==a.originalName&&null===this.getChild(a.originalName)))throw Error("Duplicate name in namespace "+this.toString(!0)+": "+a.name);a.name=a.originalName}this.children.push(a)},j.getChild=function(a){for(var b="number"==typeof a?"id":"name",c=0,d=this.children.length;c<d;++c)if(this.children[c][b]===a)return this.children[c];return null},j.resolve=function(a,b){var c="string"==typeof a?a.split("."):a,d=this,e=0;if(""===c[e]){for(;null!==d.parent;)d=d.parent;e++}var g;do{do{if(!(d instanceof f.Namespace)){d=null;break}if(g=d.getChild(c[e]),!g||!(g instanceof f.T)||b&&!(g instanceof f.Namespace)){d=null;break}d=g,e++}while(e<c.length);if(null!=d)break;if(null!==this.parent)return this.parent.resolve(a,b)}while(null!=d);return d},j.qn=function(a){var b=[],c=a;do b.unshift(c.name),c=c.parent;while(null!==c);for(var d=1;d<=b.length;d++){var e=b.slice(b.length-d);if(a===this.resolve(e,a instanceof f.Namespace))return e.join(".")}return a.fqn()},j.build=function(){for(var a,b={},c=this.children,d=0,e=c.length;d<e;++d)a=c[d],a instanceof i&&(b[a.name]=a.build());return Object.defineProperty&&Object.defineProperty(b,"$options",{value:this.buildOpt()}),b},j.buildOpt=function(){for(var a={},b=Object.keys(this.options),c=0,d=b.length;c<d;++c){var e=b[c],f=this.options[b[c]];a[e]=f}return a},j.getOption=function(a){return"undefined"==typeof a?this.options:"undefined"!=typeof this.options[a]?this.options[a]:null},f.Namespace=i;var k=function(a,c,d,e){if(this.type=a,this.resolvedType=c,this.isMapKey=d,this.syntax=e,d&&b.MAP_KEY_TYPES.indexOf(a)<0)throw Error("Invalid map key type: "+a.name)},l=k.prototype;k.defaultFieldValue=c,l.verifyValue=function(c){var e=function(a,b){throw Error("Illegal value for "+this.toString(!0)+" of type "+this.type.name+": "+a+" ("+b+")")}.bind(this);switch(this.type){case b.TYPES.int32:case b.TYPES.sint32:case b.TYPES.sfixed32:return("number"!=typeof c||c===c&&c%1!==0)&&e(typeof c,"not an integer"),c>4294967295?0|c:c;case b.TYPES.uint32:case b.TYPES.fixed32:return("number"!=typeof c||c===c&&c%1!==0)&&e(typeof c,"not an integer"),c<0?c>>>0:c;case b.TYPES.int64:case b.TYPES.sint64:case b.TYPES.sfixed64:if(b.Long)try{return d(c,!1)}catch(f){e(typeof c,f.message)}else e(typeof c,"requires Long.js");case b.TYPES.uint64:case b.TYPES.fixed64:if(b.Long)try{return d(c,!0)}catch(f){e(typeof c,f.message)}else e(typeof c,"requires Long.js");case b.TYPES.bool:return"boolean"!=typeof c&&e(typeof c,"not a boolean"),c;case b.TYPES["float"]:case b.TYPES["double"]:return"number"!=typeof c&&e(typeof c,"not a number"),c;case b.TYPES.string:return"string"==typeof c||c&&c instanceof String||e(typeof c,"not a string"),""+c;case b.TYPES.bytes:return a.isByteBuffer(c)?c:a.wrap(c,"base64");case b.TYPES["enum"]:var g=this.resolvedType.getChildren(b.Reflect.Enum.Value);for(i=0;i<g.length;i++){if(g[i].name==c)return g[i].id;if(g[i].id==c)return g[i].id}if("proto3"===this.syntax)return("number"!=typeof c||c===c&&c%1!==0)&&e(typeof c,"not an integer"),(c>4294967295||c<0)&&e(typeof c,"not in range for uint32"),c;e(c,"not a valid enum value");case b.TYPES.group:case b.TYPES.message:if(c&&"object"==typeof c||e(typeof c,"object expected"),c instanceof this.resolvedType.clazz)return c;if(c instanceof b.Builder.Message){var h={};for(var i in c)c.hasOwnProperty(i)&&(h[i]=c[i]);c=h}return new this.resolvedType.clazz(c)}throw Error("[INTERNAL] Illegal value for "+this.toString(!0)+": "+c+" (undefined type "+this.type+")")},l.calculateLength=function(c,d){if(null===d)return 0;var e;switch(this.type){case b.TYPES.int32:return d<0?a.calculateVarint64(d):a.calculateVarint32(d);case b.TYPES.uint32:return a.calculateVarint32(d);case b.TYPES.sint32:return a.calculateVarint32(a.zigZagEncode32(d));case b.TYPES.fixed32:case b.TYPES.sfixed32:case b.TYPES["float"]:return 4;case b.TYPES.int64:case b.TYPES.uint64:return a.calculateVarint64(d);case b.TYPES.sint64:return a.calculateVarint64(a.zigZagEncode64(d));case b.TYPES.fixed64:case b.TYPES.sfixed64:return 8;case b.TYPES.bool:return 1;case b.TYPES["enum"]:return a.calculateVarint32(d);case b.TYPES["double"]:return 8;case b.TYPES.string:return e=a.calculateUTF8Bytes(d),a.calculateVarint32(e)+e;case b.TYPES.bytes:if(d.remaining()<0)throw Error("Illegal value for "+this.toString(!0)+": "+d.remaining()+" bytes remaining");return a.calculateVarint32(d.remaining())+d.remaining();case b.TYPES.message:return e=this.resolvedType.calculate(d),a.calculateVarint32(e)+e;case b.TYPES.group:return e=this.resolvedType.calculate(d),e+a.calculateVarint32(c<<3|b.WIRE_TYPES.ENDGROUP)}throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+d+" (unknown type)")},l.encodeValue=function(c,d,e){if(null===d)return e;switch(this.type){case b.TYPES.int32:d<0?e.writeVarint64(d):e.writeVarint32(d);break;case b.TYPES.uint32:e.writeVarint32(d);break;case b.TYPES.sint32:e.writeVarint32ZigZag(d);break;case b.TYPES.fixed32:e.writeUint32(d);break;case b.TYPES.sfixed32:e.writeInt32(d);break;case b.TYPES.int64:case b.TYPES.uint64:e.writeVarint64(d);break;case b.TYPES.sint64:e.writeVarint64ZigZag(d);break;case b.TYPES.fixed64:e.writeUint64(d);break;case b.TYPES.sfixed64:e.writeInt64(d);break;case b.TYPES.bool:"string"==typeof d?e.writeVarint32("false"===d.toLowerCase()?0:!!d):e.writeVarint32(d?1:0);break;case b.TYPES["enum"]:e.writeVarint32(d);break;case b.TYPES["float"]:e.writeFloat32(d);break;case b.TYPES["double"]:e.writeFloat64(d);break;case b.TYPES.string:e.writeVString(d);break;case b.TYPES.bytes:if(d.remaining()<0)throw Error("Illegal value for "+this.toString(!0)+": "+d.remaining()+" bytes remaining");var f=d.offset;e.writeVarint32(d.remaining()),e.append(d),d.offset=f;break;case b.TYPES.message:var g=(new a).LE();this.resolvedType.encode(d,g),e.writeVarint32(g.offset),e.append(g.flip());break;case b.TYPES.group:this.resolvedType.encode(d,e),e.writeVarint32(c<<3|b.WIRE_TYPES.ENDGROUP);break;default:throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+d+" (unknown type)")}return e},l.decode=function(a,c,d){if(c!=this.type.wireType)throw Error("Unexpected wire type for element");var e,f;switch(this.type){case b.TYPES.int32:return 0|a.readVarint32();case b.TYPES.uint32:return a.readVarint32()>>>0;case b.TYPES.sint32:return 0|a.readVarint32ZigZag();case b.TYPES.fixed32:return a.readUint32()>>>0;case b.TYPES.sfixed32:return 0|a.readInt32();case b.TYPES.int64:return a.readVarint64();case b.TYPES.uint64:return a.readVarint64().toUnsigned();case b.TYPES.sint64:return a.readVarint64ZigZag();case b.TYPES.fixed64:return a.readUint64();case b.TYPES.sfixed64:return a.readInt64();case b.TYPES.bool:return!!a.readVarint32();case b.TYPES["enum"]:return a.readVarint32();case b.TYPES["float"]:return a.readFloat();case b.TYPES["double"]:return a.readDouble();case b.TYPES.string:return a.readVString();case b.TYPES.bytes:if(f=a.readVarint32(),a.remaining()<f)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+f+" required but got only "+a.remaining());return e=a.clone(),e.limit=e.offset+f,a.offset+=f,e;case b.TYPES.message:return f=a.readVarint32(),this.resolvedType.decode(a,f);case b.TYPES.group:return this.resolvedType.decode(a,-1,d)}throw Error("[INTERNAL] Illegal decode type")},l.valueFromString=function(c){if(!this.isMapKey)throw Error("valueFromString() called on non-map-key element");switch(this.type){case b.TYPES.int32:case b.TYPES.sint32:case b.TYPES.sfixed32:case b.TYPES.uint32:case b.TYPES.fixed32:return this.verifyValue(parseInt(c));case b.TYPES.int64:case b.TYPES.sint64:case b.TYPES.sfixed64:case b.TYPES.uint64:case b.TYPES.fixed64:return this.verifyValue(c);case b.TYPES.bool:return"true"===c;case b.TYPES.string:return this.verifyValue(c);case b.TYPES.bytes:return a.fromBinary(c)}},l.valueToString=function(a){if(!this.isMapKey)throw Error("valueToString() called on non-map-key element");return this.type===b.TYPES.bytes?a.toString("binary"):a.toString()},f.Element=k;var m=function(a,c,d,e,f,g){i.call(this,a,c,d,e,g),this.className="Message",this.extensions=[b.ID_MIN,b.ID_MAX],this.clazz=null,this.isGroup=!!f,this._fields=null,this._fieldsById=null,this._fieldsByName=null},n=m.prototype=Object.create(i.prototype);n.build=function(c){if(this.clazz&&!c)return this.clazz;var d=function(b,c){function d(c,e,f,g){if(null===c||"object"!=typeof c){if(g&&g instanceof b.Reflect.Enum){var h=b.Reflect.Enum.getName(g.object,c);if(null!==h)return h}return c}if(a.isByteBuffer(c))return e?c.toBase64():c.toBuffer();if(b.Long.isLong(c))return f?c.toString():b.Long.fromValue(c);var i;if(Array.isArray(c))return i=[],c.forEach(function(a,b){i[b]=d(a,e,f,g)}),i;if(i={},c instanceof b.Map){for(var j=c.entries(),k=j.next();!k.done;k=j.next())i[c.keyElem.valueToString(k.value[0])]=d(k.value[1],e,f,c.valueElem.resolvedType);return i}var l=c.$type,m=void 0;for(var n in c)c.hasOwnProperty(n)&&(l&&(m=l.getChild(n))?i[n]=d(c[n],e,f,m.resolvedType):i[n]=d(c[n],e,f));return i}var e=c.getChildren(b.Reflect.Message.Field),f=c.getChildren(b.Reflect.Message.OneOf),g=function(d,h){b.Builder.Message.call(this);for(var i=0,j=f.length;i<j;++i)this[f[i].name]=null;for(i=0,j=e.length;i<j;++i){var k=e[i];this[k.name]=k.repeated?[]:k.map?new b.Map(k):null,!k.required&&"proto3"!==c.syntax||null===k.defaultValue||(this[k.name]=k.defaultValue)}if(arguments.length>0){var l;if(1!==arguments.length||null===d||"object"!=typeof d||!("function"!=typeof d.encode||d instanceof g)||Array.isArray(d)||d instanceof b.Map||a.isByteBuffer(d)||d instanceof ArrayBuffer||b.Long&&d instanceof b.Long)for(i=0,j=arguments.length;i<j;++i)"undefined"!=typeof(l=arguments[i])&&this.$set(e[i].name,l);else this.$set(d)}},h=g.prototype=Object.create(b.Builder.Message.prototype);h.add=function(a,d,e){var f=c._fieldsByName[a];if(!e){if(!f)throw Error(this+"#"+a+" is undefined");if(!(f instanceof b.Reflect.Message.Field))throw Error(this+"#"+a+" is not a field: "+f.toString(!0));if(!f.repeated)throw Error(this+"#"+a+" is not a repeated field");d=f.verifyValue(d,!0)}return null===this[a]&&(this[a]=[]),this[a].push(d),this},h.$add=h.add,h.set=function(a,d,e){if(a&&"object"==typeof a){e=d;for(var f in a)a.hasOwnProperty(f)&&"undefined"!=typeof(d=a[f])&&this.$set(f,d,e);return this}var g=c._fieldsByName[a];if(e)this[a]=d;else{if(!g)throw Error(this+"#"+a+" is not a field: undefined");if(!(g instanceof b.Reflect.Message.Field))throw Error(this+"#"+a+" is not a field: "+g.toString(!0));this[g.name]=d=g.verifyValue(d)}if(g&&g.oneof){var h=this[g.oneof.name];null!==d?(null!==h&&h!==g.name&&(this[h]=null),this[g.oneof.name]=g.name):h===a&&(this[g.oneof.name]=null)}return this},h.$set=h.set,h.get=function(a,d){if(d)return this[a];var e=c._fieldsByName[a];if(!(e&&e instanceof b.Reflect.Message.Field))throw Error(this+"#"+a+" is not a field: undefined");if(!(e instanceof b.Reflect.Message.Field))throw Error(this+"#"+a+" is not a field: "+e.toString(!0));return this[e.name]},h.$get=h.get;for(var i=0;i<e.length;i++){var j=e[i];j instanceof b.Reflect.Message.ExtensionField||c.builder.options.populateAccessors&&function(a){var b=a.originalName.replace(/(_[a-zA-Z])/g,function(a){return a.toUpperCase().replace("_","")});b=b.substring(0,1).toUpperCase()+b.substring(1);var d=a.originalName.replace(/([A-Z])/g,function(a){return"_"+a}),e=function(b,c){return this[a.name]=c?b:a.verifyValue(b),this},f=function(){return this[a.name]};null===c.getChild("set"+b)&&(h["set"+b]=e),null===c.getChild("set_"+d)&&(h["set_"+d]=e),null===c.getChild("get"+b)&&(h["get"+b]=f),null===c.getChild("get_"+d)&&(h["get_"+d]=f)}(j)}h.encode=function(b,d){"boolean"==typeof b&&(d=b,b=void 0);var e=!1;b||(b=new a,e=!0);var f=b.littleEndian;try{return c.encode(this,b.LE(),d),(e?b.flip():b).LE(f)}catch(g){throw b.LE(f),g}},g.encode=function(a,b,c){return new g(a).encode(b,c)},h.calculate=function(){return c.calculate(this)},h.encodeDelimited=function(b){var d=!1;b||(b=new a,d=!0);var e=(new a).LE();return c.encode(this,e).flip(),b.writeVarint32(e.remaining()),b.append(e),d?b.flip():b},h.encodeAB=function(){try{return this.encode().toArrayBuffer()}catch(a){throw a.encoded&&(a.encoded=a.encoded.toArrayBuffer()),a}},h.toArrayBuffer=h.encodeAB,h.encodeNB=function(){try{return this.encode().toBuffer()}catch(a){throw a.encoded&&(a.encoded=a.encoded.toBuffer()),a}},h.toBuffer=h.encodeNB,h.encode64=function(){try{return this.encode().toBase64()}catch(a){throw a.encoded&&(a.encoded=a.encoded.toBase64()),a}},h.toBase64=h.encode64,h.encodeHex=function(){try{return this.encode().toHex()}catch(a){throw a.encoded&&(a.encoded=a.encoded.toHex()),a}},h.toHex=h.encodeHex,h.toRaw=function(a,b){return d(this,!!a,!!b,this.$type)},h.encodeJSON=function(){return JSON.stringify(d(this,!0,!0,this.$type))},g.decode=function(b,d){"string"==typeof b&&(b=a.wrap(b,d?d:"base64")),b=a.isByteBuffer(b)?b:a.wrap(b);var e=b.littleEndian;try{var f=c.decode(b.LE());return b.LE(e),f}catch(g){throw b.LE(e),g}},g.decodeDelimited=function(b,d){if("string"==typeof b&&(b=a.wrap(b,d?d:"base64")),b=a.isByteBuffer(b)?b:a.wrap(b),b.remaining()<1)return null;var e=b.offset,f=b.readVarint32();if(b.remaining()<f)return b.offset=e,null;try{var g=c.decode(b.slice(b.offset,b.offset+f).LE());return b.offset+=f,g}catch(h){throw b.offset+=f,h}},g.decode64=function(a){return g.decode(a,"base64")},g.decodeHex=function(a){return g.decode(a,"hex")},g.decodeJSON=function(a){return new g(JSON.parse(a))},h.toString=function(){return c.toString()};return Object.defineProperty&&(Object.defineProperty(g,"$options",{value:c.buildOpt()}),Object.defineProperty(h,"$options",{value:g.$options}),Object.defineProperty(g,"$type",{value:c}),Object.defineProperty(h,"$type",{value:c})),g}(b,this);this._fields=[],this._fieldsById={},this._fieldsByName={};for(var e,f=0,g=this.children.length;f<g;f++)if(e=this.children[f],e instanceof s||e instanceof m||e instanceof w){if(d.hasOwnProperty(e.name))throw Error("Illegal reflect child of "+this.toString(!0)+": "+e.toString(!0)+" cannot override static property '"+e.name+"'");d[e.name]=e.build()}else if(e instanceof m.Field)e.build(),this._fields.push(e),this._fieldsById[e.id]=e,this._fieldsByName[e.name]=e;else if(!(e instanceof m.OneOf||e instanceof v))throw Error("Illegal reflect child of "+this.toString(!0)+": "+this.children[f].toString(!0));return this.clazz=d},n.encode=function(a,b,c){for(var d,e,f=null,g=0,h=this._fields.length;g<h;++g)d=this._fields[g],e=a[d.name],d.required&&null===e?null===f&&(f=d):d.encode(c?e:d.verifyValue(e),b,a);if(null!==f){var i=Error("Missing at least one required field for "+this.toString(!0)+": "+f);throw i.encoded=b,i}return b},n.calculate=function(a){for(var b,c,d=0,e=0,f=this._fields.length;e<f;++e){if(b=this._fields[e],c=a[b.name],b.required&&null===c)throw Error("Missing at least one required field for "+this.toString(!0)+": "+b);d+=b.calculate(c,a)}return d},n.decode=function(a,c,d){c="number"==typeof c?c:-1;for(var f,g,h,i,j=a.offset,k=new this.clazz;a.offset<j+c||c===-1&&a.remaining()>0;){if(f=a.readVarint32(),g=7&f,h=f>>>3,g===b.WIRE_TYPES.ENDGROUP){if(h!==d)throw Error("Illegal group end indicator for "+this.toString(!0)+": "+h+" ("+(d?d+" expected":"not a group")+")");break}if(i=this._fieldsById[h]){if(i.repeated&&!i.options.packed)k[i.name].push(i.decode(g,a));else if(i.map){var l=i.decode(g,a);k[i.name].set(l[0],l[1])}else if(k[i.name]=i.decode(g,a),i.oneof){var m=k[i.oneof.name];null!==m&&m!==i.name&&(k[m]=null),k[i.oneof.name]=i.name}}else switch(g){case b.WIRE_TYPES.VARINT:a.readVarint32();break;case b.WIRE_TYPES.BITS32:a.offset+=4;
break;case b.WIRE_TYPES.BITS64:a.offset+=8;break;case b.WIRE_TYPES.LDELIM:var n=a.readVarint32();a.offset+=n;break;case b.WIRE_TYPES.STARTGROUP:for(;e(h,a););break;default:throw Error("Illegal wire type for unknown field "+h+" in "+this.toString(!0)+"#decode: "+g)}}for(var o=0,p=this._fields.length;o<p;++o)if(i=this._fields[o],null===k[i.name])if("proto3"===this.syntax)k[i.name]=i.defaultValue;else{if(i.required){var q=Error("Missing at least one required field for "+this.toString(!0)+": "+i.name);throw q.decoded=k,q}b.populateDefaults&&null!==i.defaultValue&&(k[i.name]=i.defaultValue)}return k},f.Message=m;var o=function(a,c,d,e,f,h,i,j,k,l){g.call(this,a,c,h),this.className="Message.Field",this.required="required"===d,this.repeated="repeated"===d,this.map="map"===d,this.keyType=e||null,this.type=f,this.resolvedType=null,this.id=i,this.options=j||{},this.defaultValue=null,this.oneof=k||null,this.syntax=l||"proto2",this.originalName=this.name,this.element=null,this.keyElement=null,!this.builder.options.convertFieldsToCamelCase||this instanceof m.ExtensionField||(this.name=b.Util.toCamelCase(this.name))},p=o.prototype=Object.create(g.prototype);p.build=function(){this.element=new k(this.type,this.resolvedType,(!1),this.syntax),this.map&&(this.keyElement=new k(this.keyType,(void 0),(!0),this.syntax)),"proto3"!==this.syntax||this.repeated||this.map?"undefined"!=typeof this.options["default"]&&(this.defaultValue=this.verifyValue(this.options["default"])):this.defaultValue=k.defaultFieldValue(this.type)},p.verifyValue=function(a,c){c=c||!1;var d=function(a,b){throw Error("Illegal value for "+this.toString(!0)+" of type "+this.type.name+": "+a+" ("+b+")")}.bind(this);if(null===a)return this.required&&d(typeof a,"required"),"proto3"===this.syntax&&this.type!==b.TYPES.message&&d(typeof a,"proto3 field without field presence cannot be null"),null;var e;if(this.repeated&&!c){Array.isArray(a)||(a=[a]);var f=[];for(e=0;e<a.length;e++)f.push(this.element.verifyValue(a[e]));return f}return this.map&&!c?a instanceof b.Map?a:(a instanceof Object||d(typeof a,"expected ProtoBuf.Map or raw object for map field"),new b.Map(this,a)):(!this.repeated&&Array.isArray(a)&&d(typeof a,"no array expected"),this.element.verifyValue(a))},p.hasWirePresence=function(a,c){if("proto3"!==this.syntax)return null!==a;if(this.oneof&&c[this.oneof.name]===this.name)return!0;switch(this.type){case b.TYPES.int32:case b.TYPES.sint32:case b.TYPES.sfixed32:case b.TYPES.uint32:case b.TYPES.fixed32:return 0!==a;case b.TYPES.int64:case b.TYPES.sint64:case b.TYPES.sfixed64:case b.TYPES.uint64:case b.TYPES.fixed64:return 0!==a.low||0!==a.high;case b.TYPES.bool:return a;case b.TYPES["float"]:case b.TYPES["double"]:return 0!==a;case b.TYPES.string:return a.length>0;case b.TYPES.bytes:return a.remaining()>0;case b.TYPES["enum"]:return 0!==a;case b.TYPES.message:return null!==a;default:return!0}},p.encode=function(c,d,e){if(null===this.type||"object"!=typeof this.type)throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===c||this.repeated&&0==c.length)return d;try{if(this.repeated){var f;if(this.options.packed&&b.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0){d.writeVarint32(this.id<<3|b.WIRE_TYPES.LDELIM),d.ensureCapacity(d.offset+=1);var g=d.offset;for(f=0;f<c.length;f++)this.element.encodeValue(this.id,c[f],d);var h=d.offset-g,i=a.calculateVarint32(h);if(i>1){var j=d.slice(g,d.offset);g+=i-1,d.offset=g,d.append(j)}d.writeVarint32(h,g-i)}else for(f=0;f<c.length;f++)d.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,c[f],d)}else this.map?c.forEach(function(c,e,f){var g=a.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,e)+a.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,c);d.writeVarint32(this.id<<3|b.WIRE_TYPES.LDELIM),d.writeVarint32(g),d.writeVarint32(8|this.keyType.wireType),this.keyElement.encodeValue(1,e,d),d.writeVarint32(16|this.type.wireType),this.element.encodeValue(2,c,d)},this):this.hasWirePresence(c,e)&&(d.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,c,d))}catch(k){throw Error("Illegal value for "+this.toString(!0)+": "+c+" ("+k+")")}return d},p.calculate=function(c,d){if(c=this.verifyValue(c),null===this.type||"object"!=typeof this.type)throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===c||this.repeated&&0==c.length)return 0;var e=0;try{if(this.repeated){var f,g;if(this.options.packed&&b.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0){for(e+=a.calculateVarint32(this.id<<3|b.WIRE_TYPES.LDELIM),g=0,f=0;f<c.length;f++)g+=this.element.calculateLength(this.id,c[f]);e+=a.calculateVarint32(g),e+=g}else for(f=0;f<c.length;f++)e+=a.calculateVarint32(this.id<<3|this.type.wireType),e+=this.element.calculateLength(this.id,c[f])}else this.map?c.forEach(function(c,d,f){var g=a.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,d)+a.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,c);e+=a.calculateVarint32(this.id<<3|b.WIRE_TYPES.LDELIM),e+=a.calculateVarint32(g),e+=g},this):this.hasWirePresence(c,d)&&(e+=a.calculateVarint32(this.id<<3|this.type.wireType),e+=this.element.calculateLength(this.id,c))}catch(h){throw Error("Illegal value for "+this.toString(!0)+": "+c+" ("+h+")")}return e},p.decode=function(a,c,d){var e,f,g=!this.map&&a==this.type.wireType||!d&&this.repeated&&this.options.packed&&a==b.WIRE_TYPES.LDELIM||this.map&&a==b.WIRE_TYPES.LDELIM;if(!g)throw Error("Illegal wire type for field "+this.toString(!0)+": "+a+" ("+this.type.wireType+" expected)");if(a==b.WIRE_TYPES.LDELIM&&this.repeated&&this.options.packed&&b.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0&&!d){f=c.readVarint32(),f=c.offset+f;for(var h=[];c.offset<f;)h.push(this.decode(this.type.wireType,c,!0));return h}if(this.map){var i=k.defaultFieldValue(this.keyType);if(e=k.defaultFieldValue(this.type),f=c.readVarint32(),c.remaining()<f)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+f+" required but got only "+c.remaining());var j=c.clone();for(j.limit=j.offset+f,c.offset+=f;j.remaining()>0;){var l=j.readVarint32();a=7&l;var m=l>>>3;if(1===m)i=this.keyElement.decode(j,a,m);else{if(2!==m)throw Error("Unexpected tag in map field key/value submessage");e=this.element.decode(j,a,m)}}return[i,e]}return this.element.decode(c,a,this.id)},f.Message.Field=o;var q=function(a,b,c,d,e,f,g){o.call(this,a,b,c,null,d,e,f,g),this.extension};q.prototype=Object.create(o.prototype),f.Message.ExtensionField=q;var r=function(a,b,c){g.call(this,a,b,c),this.fields=[]};f.Message.OneOf=r;var s=function(a,b,c,d,e){i.call(this,a,b,c,d,e),this.className="Enum",this.object=null};s.getName=function(a,b){for(var c,d=Object.keys(a),e=0;e<d.length;++e)if(a[c=d[e]]===b)return c;return null};var t=s.prototype=Object.create(i.prototype);t.build=function(a){if(this.object&&!a)return this.object;for(var c=new b.Builder.Enum,d=this.getChildren(s.Value),e=0,f=d.length;e<f;++e)c[d[e].name]=d[e].id;return Object.defineProperty&&Object.defineProperty(c,"$options",{value:this.buildOpt(),enumerable:!1}),this.object=c},f.Enum=s;var u=function(a,b,c,d){g.call(this,a,b,c),this.className="Enum.Value",this.id=d};u.prototype=Object.create(g.prototype),f.Enum.Value=u;var v=function(a,b,c,d){g.call(this,a,b,c),this.field=d};v.prototype=Object.create(g.prototype),f.Extension=v;var w=function(a,b,c,d){i.call(this,a,b,c,d),this.className="Service",this.clazz=null},x=w.prototype=Object.create(i.prototype);x.build=function(c){return this.clazz&&!c?this.clazz:this.clazz=function(b,c){for(var d=function(a){b.Builder.Service.call(this),this.rpcImpl=a||function(a,b,c){setTimeout(c.bind(this,Error("Not implemented, see: https://github.com/dcodeIO/ProtoBuf.js/wiki/Services")),0)}},e=d.prototype=Object.create(b.Builder.Service.prototype),f=c.getChildren(b.Reflect.Service.RPCMethod),g=0;g<f.length;g++)!function(b){e[b.name]=function(d,e){try{try{d=b.resolvedRequestType.clazz.decode(a.wrap(d))}catch(f){if(!(f instanceof TypeError))throw f}if(null===d||"object"!=typeof d)throw Error("Illegal arguments");d instanceof b.resolvedRequestType.clazz||(d=new b.resolvedRequestType.clazz(d)),this.rpcImpl(b.fqn(),d,function(a,d){if(a)return void e(a);try{d=b.resolvedResponseType.clazz.decode(d)}catch(f){}return d&&d instanceof b.resolvedResponseType.clazz?void e(null,d):void e(Error("Illegal response type received in service method "+c.name+"#"+b.name))})}catch(f){setTimeout(e.bind(this,f),0)}},d[b.name]=function(a,c,e){new d(a)[b.name](c,e)},Object.defineProperty&&(Object.defineProperty(d[b.name],"$options",{value:b.buildOpt()}),Object.defineProperty(e[b.name],"$options",{value:d[b.name].$options}))}(f[g]);return Object.defineProperty&&(Object.defineProperty(d,"$options",{value:c.buildOpt()}),Object.defineProperty(e,"$options",{value:d.$options}),Object.defineProperty(d,"$type",{value:c}),Object.defineProperty(e,"$type",{value:c})),d}(b,this)},f.Service=w;var y=function(a,b,c,d){g.call(this,a,b,c),this.className="Service.Method",this.options=d||{}},z=y.prototype=Object.create(g.prototype);z.buildOpt=j.buildOpt,f.Service.Method=y;var A=function(a,b,c,d,e,f,g,h){y.call(this,a,b,c,h),this.className="Service.RPCMethod",this.requestName=d,this.responseName=e,this.requestStream=f,this.responseStream=g,this.resolvedRequestType=null,this.resolvedResponseType=null};return A.prototype=Object.create(y.prototype),f.Service.RPCMethod=A,f}(e),e.Builder=function(a,b,d){function e(a){a.messages&&a.messages.forEach(function(b){b.syntax=a.syntax,e(b)}),a.enums&&a.enums.forEach(function(b){b.syntax=a.syntax})}var f=function(a){this.ns=new d.Namespace(this,null,""),this.ptr=this.ns,this.resolved=!1,this.result=null,this.files={},this.importRoot=null,this.options=a||{}},g=f.prototype;return f.isMessage=function(a){return"string"==typeof a.name&&("undefined"==typeof a.values&&"undefined"==typeof a.rpc)},f.isMessageField=function(a){return"string"==typeof a.rule&&"string"==typeof a.name&&"string"==typeof a.type&&"undefined"!=typeof a.id},f.isEnum=function(a){return"string"==typeof a.name&&!("undefined"==typeof a.values||!Array.isArray(a.values)||0===a.values.length)},f.isService=function(a){return!("string"!=typeof a.name||"object"!=typeof a.rpc||!a.rpc)},f.isExtend=function(a){return"string"==typeof a.ref},g.reset=function(){return this.ptr=this.ns,this},g.define=function(a){if("string"!=typeof a||!b.TYPEREF.test(a))throw Error("illegal namespace: "+a);return a.split(".").forEach(function(a){var b=this.ptr.getChild(a);null===b&&this.ptr.addChild(b=new d.Namespace(this,this.ptr,a)),this.ptr=b},this),this},g.create=function(b){if(!b)return this;if(Array.isArray(b)){if(0===b.length)return this;b=b.slice()}else b=[b];for(var c=[b];c.length>0;){if(b=c.pop(),!Array.isArray(b))throw Error("not a valid namespace: "+JSON.stringify(b));for(;b.length>0;){var e=b.shift();if(f.isMessage(e)){var g=new d.Message(this,this.ptr,e.name,e.options,e.isGroup,e.syntax),h={};e.oneofs&&Object.keys(e.oneofs).forEach(function(a){g.addChild(h[a]=new d.Message.OneOf(this,g,a))},this),e.fields&&e.fields.forEach(function(a){if(null!==g.getChild(0|a.id))throw Error("duplicate or invalid field id in "+g.name+": "+a.id);if(a.options&&"object"!=typeof a.options)throw Error("illegal field options in "+g.name+"#"+a.name);var b=null;if("string"==typeof a.oneof&&!(b=h[a.oneof]))throw Error("illegal oneof in "+g.name+"#"+a.name+": "+a.oneof);a=new d.Message.Field(this,g,a.rule,a.keytype,a.type,a.name,a.id,a.options,b,e.syntax),b&&b.fields.push(a),g.addChild(a)},this);var i=[];if(e.enums&&e.enums.forEach(function(a){i.push(a)}),e.messages&&e.messages.forEach(function(a){i.push(a)}),e.services&&e.services.forEach(function(a){i.push(a)}),e.extensions&&(g.extensions=e.extensions,g.extensions[0]<a.ID_MIN&&(g.extensions[0]=a.ID_MIN),g.extensions[1]>a.ID_MAX&&(g.extensions[1]=a.ID_MAX)),this.ptr.addChild(g),i.length>0){c.push(b),b=i,i=null,this.ptr=g,g=null;continue}i=null}else if(f.isEnum(e))g=new d.Enum(this,this.ptr,e.name,e.options,e.syntax),e.values.forEach(function(a){g.addChild(new d.Enum.Value(this,g,a.name,a.id))},this),this.ptr.addChild(g);else if(f.isService(e))g=new d.Service(this,this.ptr,e.name,e.options),Object.keys(e.rpc).forEach(function(a){var b=e.rpc[a];g.addChild(new d.Service.RPCMethod(this,g,a,b.request,b.response,(!!b.request_stream),(!!b.response_stream),b.options))},this),this.ptr.addChild(g);else{if(!f.isExtend(e))throw Error("not a valid definition: "+JSON.stringify(e));if(g=this.ptr.resolve(e.ref,!0))e.fields.forEach(function(b){if(null!==g.getChild(0|b.id))throw Error("duplicate extended field id in "+g.name+": "+b.id);if(b.id<g.extensions[0]||b.id>g.extensions[1])throw Error("illegal extended field id in "+g.name+": "+b.id+" ("+g.extensions.join(" to ")+" expected)");var c=b.name;this.options.convertFieldsToCamelCase&&(c=a.Util.toCamelCase(c));var e=new d.Message.ExtensionField(this,g,b.rule,b.type,this.ptr.fqn()+"."+c,b.id,b.options),f=new d.Extension(this,this.ptr,b.name,e);e.extension=f,this.ptr.addChild(f),g.addChild(e)},this);else if(!/\.?google\.protobuf\./.test(e.ref))throw Error("extended message "+e.ref+" is not defined")}e=null,g=null}b=null,this.ptr=this.ptr.parent}return this.resolved=!1,this.result=null,this},g["import"]=function(b,d){var f="/";if("string"==typeof d){if(a.Util.IS_NODE&&(d=c(44).resolve(d)),this.files[d]===!0)return this.reset();this.files[d]=!0}else if("object"==typeof d){var g=d.root;a.Util.IS_NODE&&(g=c(44).resolve(g)),(g.indexOf("\\")>=0||d.file.indexOf("\\")>=0)&&(f="\\");var h=g+f+d.file;if(this.files[h]===!0)return this.reset();this.files[h]=!0}if(b.imports&&b.imports.length>0){var i,j=!1;"object"==typeof d?(this.importRoot=d.root,j=!0,i=this.importRoot,d=d.file,(i.indexOf("\\")>=0||d.indexOf("\\")>=0)&&(f="\\")):"string"==typeof d?this.importRoot?i=this.importRoot:d.indexOf("/")>=0?(i=d.replace(/\/[^\/]*$/,""),""===i&&(i="/")):d.indexOf("\\")>=0?(i=d.replace(/\\[^\\]*$/,""),f="\\"):i=".":i=null;for(var k=0;k<b.imports.length;k++)if("string"==typeof b.imports[k]){if(!i)throw Error("cannot determine import root");var l=b.imports[k];if("google/protobuf/descriptor.proto"===l)continue;if(l=i+f+l,this.files[l]===!0)continue;/\.proto$/i.test(l)&&!a.DotProto&&(l=l.replace(/\.proto$/,".json"));var m=a.Util.fetch(l);if(null===m)throw Error("failed to import '"+l+"' in '"+d+"': file not found");/\.json$/i.test(l)?this["import"](JSON.parse(m+""),l):this["import"](a.DotProto.Parser.parse(m),l)}else d?/\.(\w+)$/.test(d)?this["import"](b.imports[k],d.replace(/^(.+)\.(\w+)$/,function(a,b,c){return b+"_import"+k+"."+c})):this["import"](b.imports[k],d+"_import"+k):this["import"](b.imports[k]);j&&(this.importRoot=null)}b["package"]&&this.define(b["package"]),b.syntax&&e(b);var n=this.ptr;return b.options&&Object.keys(b.options).forEach(function(a){n.options[a]=b.options[a]}),b.messages&&(this.create(b.messages),this.ptr=n),b.enums&&(this.create(b.enums),this.ptr=n),b.services&&(this.create(b.services),this.ptr=n),b["extends"]&&this.create(b["extends"]),this.reset()},g.resolveAll=function(){var c;if(null==this.ptr||"object"==typeof this.ptr.type)return this;if(this.ptr instanceof d.Namespace)this.ptr.children.forEach(function(a){this.ptr=a,this.resolveAll()},this);else if(this.ptr instanceof d.Message.Field){if(b.TYPE.test(this.ptr.type))this.ptr.type=a.TYPES[this.ptr.type];else{if(!b.TYPEREF.test(this.ptr.type))throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if(c=(this.ptr instanceof d.Message.ExtensionField?this.ptr.extension.parent:this.ptr.parent).resolve(this.ptr.type,!0),!c)throw Error("unresolvable type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if(this.ptr.resolvedType=c,c instanceof d.Enum){if(this.ptr.type=a.TYPES["enum"],"proto3"===this.ptr.syntax&&"proto3"!==c.syntax)throw Error("proto3 message cannot reference proto2 enum")}else{if(!(c instanceof d.Message))throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);this.ptr.type=c.isGroup?a.TYPES.group:a.TYPES.message}}if(this.ptr.map){if(!b.TYPE.test(this.ptr.keyType))throw Error("illegal key type for map field in "+this.ptr.toString(!0)+": "+this.ptr.keyType);this.ptr.keyType=a.TYPES[this.ptr.keyType]}}else if(this.ptr instanceof a.Reflect.Service.Method){if(!(this.ptr instanceof a.Reflect.Service.RPCMethod))throw Error("illegal service type in "+this.ptr.toString(!0));if(c=this.ptr.parent.resolve(this.ptr.requestName,!0),!(c&&c instanceof a.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.requestName);if(this.ptr.resolvedRequestType=c,c=this.ptr.parent.resolve(this.ptr.responseName,!0),!(c&&c instanceof a.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.responseName);this.ptr.resolvedResponseType=c}else if(!(this.ptr instanceof a.Reflect.Message.OneOf||this.ptr instanceof a.Reflect.Extension||this.ptr instanceof a.Reflect.Enum.Value))throw Error("illegal object in namespace: "+typeof this.ptr+": "+this.ptr);return this.reset()},g.build=function(a){if(this.reset(),this.resolved||(this.resolveAll(),this.resolved=!0,this.result=null),null===this.result&&(this.result=this.ns.build()),!a)return this.result;for(var b="string"==typeof a?a.split("."):a,c=this.result,d=0;d<b.length;d++){if(!c[b[d]]){c=null;break}c=c[b[d]]}return c},g.lookup=function(a,b){return a?this.ns.resolve(a,b):this.ns},g.toString=function(){return"Builder"},f.Message=function(){},f.Enum=function(){},f.Service=function(){},f}(e,e.Lang,e.Reflect),e.Map=function(a,b){function c(a){var b=0;return{next:function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}}}var d=function(a,c){if(!a.map)throw Error("field is not a map");if(this.field=a,this.keyElem=new b.Element(a.keyType,null,(!0),a.syntax),this.valueElem=new b.Element(a.type,a.resolvedType,(!1),a.syntax),this.map={},Object.defineProperty(this,"size",{get:function(){return Object.keys(this.map).length}}),c)for(var d=Object.keys(c),e=0;e<d.length;e++){var f=this.keyElem.valueFromString(d[e]),g=this.valueElem.verifyValue(c[d[e]]);this.map[this.keyElem.valueToString(f)]={key:f,value:g}}},e=d.prototype;return e.clear=function(){this.map={}},e["delete"]=function(a){var b=this.keyElem.valueToString(this.keyElem.verifyValue(a)),c=b in this.map;return delete this.map[b],c},e.entries=function(){for(var a,b=[],d=Object.keys(this.map),e=0;e<d.length;e++)b.push([(a=this.map[d[e]]).key,a.value]);return c(b)},e.keys=function(){for(var a=[],b=Object.keys(this.map),d=0;d<b.length;d++)a.push(this.map[b[d]].key);return c(a)},e.values=function(){for(var a=[],b=Object.keys(this.map),d=0;d<b.length;d++)a.push(this.map[b[d]].value);return c(a)},e.forEach=function(a,b){for(var c,d=Object.keys(this.map),e=0;e<d.length;e++)a.call(b,(c=this.map[d[e]]).value,c.key,this)},e.set=function(a,b){var c=this.keyElem.verifyValue(a),d=this.valueElem.verifyValue(b);return this.map[this.keyElem.valueToString(c)]={key:c,value:d},this},e.get=function(a){var b=this.keyElem.valueToString(this.keyElem.verifyValue(a));if(b in this.map)return this.map[b].value},e.has=function(a){var b=this.keyElem.valueToString(this.keyElem.verifyValue(a));return b in this.map},d}(e,e.Reflect),e.loadProto=function(a,b,c){return("string"==typeof b||b&&"string"==typeof b.file&&"string"==typeof b.root)&&(c=b,b=void 0),e.loadJson(e.DotProto.Parser.parse(a),b,c)},e.protoFromString=e.loadProto,e.loadProtoFile=function(a,b,c){if(b&&"object"==typeof b?(c=b,b=null):b&&"function"==typeof b||(b=null),b)return e.Util.fetch("string"==typeof a?a:a.root+"/"+a.file,function(d){if(null===d)return void b(Error("Failed to fetch file"));try{b(null,e.loadProto(d,c,a))}catch(f){b(f)}});var d=e.Util.fetch("object"==typeof a?a.root+"/"+a.file:a);return null===d?null:e.loadProto(d,c,a)},e.protoFromFile=e.loadProtoFile,e.newBuilder=function(a){return a=a||{},"undefined"==typeof a.convertFieldsToCamelCase&&(a.convertFieldsToCamelCase=e.convertFieldsToCamelCase),"undefined"==typeof a.populateAccessors&&(a.populateAccessors=e.populateAccessors),new e.Builder(a)},e.loadJson=function(a,b,c){return("string"==typeof b||b&&"string"==typeof b.file&&"string"==typeof b.root)&&(c=b,b=null),b&&"object"==typeof b||(b=e.newBuilder()),"string"==typeof a&&(a=JSON.parse(a)),b["import"](a,c),b.resolveAll(),b},e.loadJsonFile=function(a,b,c){if(b&&"object"==typeof b?(c=b,b=null):b&&"function"==typeof b||(b=null),b)return e.Util.fetch("string"==typeof a?a:a.root+"/"+a.file,function(d){if(null===d)return void b(Error("Failed to fetch file"));try{b(null,e.loadJson(JSON.parse(d),c,a))}catch(f){b(f)}});var d=e.Util.fetch("object"==typeof a?a.root+"/"+a.file:a);return null===d?null:e.loadJson(JSON.parse(d),c,a)},e})}).call(b,c(71))},function(a,b){var c;c=function(){return this}();try{c=c||Function("return this")()||(0,eval)("this")}catch(d){"object"==typeof window&&(c=window)}a.exports=c},function(a,b,c){var d,e;d=[c(0),c(1),c(4),c(15),c(2),c(84),c(83)],e=function(a,b,c,d,e,f,g){"use strict";function h(a,e,h,j){b.isStringNotEmpty(a,"uri"),b.isString(e,"deviceId"),b.isStringNotEmpty(h,"version"),b.isObject(j,"logger"),this._deviceId=e,this._version=h,this._logger=j,this._mqWebSocket=new d.MQWebSocket(a,this._logger,[f,g],i),this._observableSessionId=new c.Observable(null).extend({rateLimit:0})}var i=5;return h.prototype.onEvent=function(a,b){return this._mqWebSocket.onEvent(a,b)},h.prototype.disconnect=function(){return this._observableSessionId.setValue(null),this._mqWebSocket.disconnect()},h.prototype.authenticate=function(a,c){b.isStringNotEmpty(a,"authToken"),b.isFunction(c,"callback");var d={apiVersion:this._mqWebSocket.getApiVersion(),clientVersion:this._version,deviceId:this._deviceId,platform:e.browser,platformVersion:e.browserVersion.toString(),authenticationToken:a};this.getSessionId()&&(d.sessionId=this.getSessionId());var f=this;return this._mqWebSocket.sendRequest("pcast.Authenticate",d,function(a,b){if(b){var d=f._observableSessionId.getValue();d&&d!==b.sessionId&&f._mqWebSocket.disposeOfPendingRequests(),f._observableSessionId.setValue(b.sessionId)}return c(a,b)})},h.prototype.getSessionId=function(){return this._observableSessionId.getValue()},h.prototype.getObservableSessionId=function(){return this._observableSessionId},h.prototype.bye=function(a,c){b.isStringNotEmpty(a,"reason"),b.isFunction(c,"callback");var d={sessionId:this.getSessionId(),reason:a};return this._mqWebSocket.sendRequest("pcast.Bye",d,c)},h.prototype.setupStream=function(c,d,f,g,h){b.isStringNotEmpty(c,"streamType"),b.isStringNotEmpty(d,"streamToken"),b.isObject(f,"options"),b.isFunction(h,"callback");var i=e.browser||"UnknownBrowser",j=i+"-"+(e.browserVersion||0),k="rtt[http]="+g,l={streamToken:d,createStream:{sessionId:this.getSessionId(),options:["data-quality-notifications"],connectUri:f.connectUri,connectOptions:f.connectOptions||[],tags:f.tags||[],userAgent:a.get(e,["global","navigator","userAgent"],j)}};return f.negotiate&&(l.createStream.createOfferDescription={streamId:"",options:[c,i,j,k],apiVersion:this._mqWebSocket.getApiVersion()},"undefined"!=typeof screen&&l.createStream.createOfferDescription.options.push("screen="+screen.width+"x"+screen.height)),f.receiveAudio===!1&&l.createStream.options.push("no-audio"),f.receiveVideo===!1&&l.createStream.options.push("no-video"),this._mqWebSocket.sendRequest("pcast.SetupStream",l,h)},h.prototype.setAnswerDescription=function(a,c,d){b.isStringNotEmpty(a,"streamId"),b.isStringNotEmpty(c,"sdp"),b.isFunction(d,"callback");var e={streamId:a,sessionDescription:{type:"Answer",sdp:c},apiVersion:this._mqWebSocket.getApiVersion()};return this._mqWebSocket.sendRequest("pcast.SetRemoteDescription",e,d)},h.prototype.addIceCandidates=function(c,d,e,f){b.isStringNotEmpty(c,"streamId"),b.isArray(d,"candidates"),b.isObject(e,"options"),b.isFunction(f,"callback");var g=a.map(d,function(a,c){return b.isStringNotEmpty(a.candidate,"candidate["+c+"].candidate"),b.isNumber(a.sdpMLineIndex,"candidate["+c+"].sdpMLineIndex"),b.isStringNotEmpty(a.sdpMid,"candidate["+c+"].sdpMid"),{candidate:a.candidate,sdpMLineIndex:a.sdpMLineIndex,sdpMid:a.sdpMid}}),h={streamId:c,candidates:g,options:e,apiVersion:this._mqWebSocket.getApiVersion()};return this._mqWebSocket.sendRequest("pcast.AddIceCandidates",h,f)},h.prototype.updateStreamState=function(a,c,d,e,f){b.isStringNotEmpty(a,"streamId"),b.isStringNotEmpty(c,"signalingState"),b.isStringNotEmpty(d,"iceGatheringState"),b.isStringNotEmpty(e,"iceConnectionState"),b.isFunction(f,"callback");var g={streamId:a,signalingState:c,iceGatheringState:d,iceConnectionState:e,apiVersion:this._mqWebSocket.getApiVersion()};return this._mqWebSocket.sendRequest("pcast.UpdateStreamState",g,f)},h.prototype.destroyStream=function(a,c,d){b.isStringNotEmpty(a,"streamId"),b.isString(c,"reason"),b.isFunction(d,"callback");var e={streamId:a,reason:c};return this._mqWebSocket.sendRequest("pcast.DestroyStream",e,d)},h.prototype.getRoomInfo=function(a,c,d){a?b.isString(a,"roomId"):b.isString(c,"alias"),b.isFunction(d,"callback");var e={roomId:a,alias:c,sessionId:this.getSessionId()};return this._mqWebSocket.sendRequest("chat.GetRoomInfo",e,d)},h.prototype.createRoom=function(a,c){b.isObject(a,"room"),b.isStringNotEmpty(a.name,"room.name"),b.isStringNotEmpty(a.type,"room.type"),b.isStringNotEmpty(a.description,"room.description"),b.isFunction(c,"callback");var d={sessionId:this.getSessionId(),room:a};return this._mqWebSocket.sendRequest("chat.CreateRoom",d,c)},h.prototype.enterRoom=function(a,c,d,e,f){a?b.isString(a,"roomId"):b.isString(c,"alias"),b.isObject(d,"member"),b.isNumber(e,"timestamp"),b.isFunction(f,"callback");var g={roomId:a,alias:c,sessionId:this.getSessionId(),member:d,timestamp:e};return this._mqWebSocket.sendRequest("chat.JoinRoom",g,f)},h.prototype.leaveRoom=function(a,c,d){b.isString(a,"roomId"),b.isNumber(c,"timestamp"),b.isFunction(d,"callback");var e={roomId:a,sessionId:this.getSessionId(),timestamp:c};return this._mqWebSocket.sendRequest("chat.LeaveRoom",e,d)},h.prototype.updateMember=function(a,c,d){b.isObject(a,"member"),b.isNumber(c,"timestamp"),b.isFunction(d,"callback"),a.updateStreams=a.hasOwnProperty("streams");var e={sessionId:this.getSessionId(),member:a,timestamp:c};return this._mqWebSocket.sendRequest("chat.UpdateMember",e,d)},h.prototype.updateRoom=function(a,c,d){b.isObject(a,"room"),b.isNumber(c,"timestamp"),b.isFunction(d,"callback");var e={sessionId:this.getSessionId(),room:a,timestamp:c};return this._mqWebSocket.sendRequest("chat.UpdateRoom",e,d)},h.prototype.sendMessageToRoom=function(a,c,d){b.isStringNotEmpty(a,"roomId"),b.isObject(c,"chatMessage");var e={roomId:a,chatMessage:c};return this._mqWebSocket.sendRequest("chat.SendMessageToRoom",e,d)},h.prototype.subscribeToRoomConversation=function(a,c,d,e){b.isStringNotEmpty(a,"sessionId"),b.isStringNotEmpty(c,"roomId"),b.isNumber(d,"batchSize");var f={sessionId:a,roomId:c,limit:d,options:["Subscribe"]};return this._mqWebSocket.sendRequest("chat.FetchRoomConversation",f,e)},h.prototype.getMessages=function(a,c,d,e,f,g){b.isStringNotEmpty(a,"sessionId"),b.isStringNotEmpty(c,"roomId"),f&&e||b.isNumber(d,"batchSize");var h={sessionId:a,roomId:c,limit:d||0,options:[]};return f&&(b.isStringNotEmpty(f,"beforeMessageId"),h.beforeMessageId=f),e&&(b.isStringNotEmpty(e,"afterMessageId"),h.afterMessageId=e),this._mqWebSocket.sendRequest("chat.FetchRoomConversation",h,g)},h.prototype.toString=function(){return"PCastProtocol["+this._mqWebSocket.toString()+"]"},h}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1)],e=function(a,b){"use strict";function c(a){b.isObject(a,"logger"),this._logger=a,this.init()}function d(c,d){b.isObject(c,"audioVolumeMeter"),d=d||{};var g=this,h=!1,i=d.speakingHysteresisInterval||e,j=d.silenceHysteresisInterval||f;b.isNumber(i,"options.speakingHysteresisInterval"),b.isNumber(j,"options.silenceHysteresisInterval");var k=!1,l=a.now()+i,m=a.now()+j;c.onValue(function(d){if(!h){b.isObject(c,"audioVolumeMeter"),b.isNumber(d.date,"value.date"),b.isNumber(d.value,"value.value"),b.isNumber(d.smoothedValue,"value.smoothedValue"),b.isNumber(d.smoothedPeakValue,"value.smoothedPeakValue"),b.isNumber(d.clipped,"value.clipped");var e=d.value>.01&&d.value>2*d.smoothedValue&&d.value>.25*d.smoothedPeakValue,f=d.value>.8*d.smoothedValue,n=d.value<.5*d.smoothedValue,o=!e;(e||k&&f)&&l<d.date?(m=a.utc(d.date)+j,k||(k=!0,g._logger.info("Speaking detected"),g._callback&&g._callback("speaking"))):(n||!k&&o)&&m<d.date&&(l=a.utc(d.date)+i,k&&(k=!1,g._logger.info("Silence detected"),g._callback&&g._callback("silence")))}})}var e=50,f=1500;return c.prototype.init=function(){},c.prototype.onValue=function(a){this._callback=a},c.prototype.startDetection=function(a,b){var c=this;return d.call(c,a,b)},c.prototype.toString=function(){return"AudioSpeakerDetection"},c}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1)],e=function(a,b){"use strict";function c(a){b.isObject(a,"logger"),this._logger=a}function d(b){for(var c=b.inputBuffer.getChannelData(0),d=0,e=0,f=0;f<c.length;f++)d+=c[f]*c[f],Math.abs(c[f])>.99&&e++;this._value=Math.sqrt(d/c.length),this._smoothedValue=this._alpha*this._value+(1-this._alpha)*this._smoothedValue,this._smoothedPeakValue=Math.max(this._value,this._alpha*this._value+(1-this._alpha)*this._smoothedPeakValue),this._clipped=e,this._callback&&this._callback.call(this,{date:a.now(),value:this._value,smoothedValue:this._smoothedValue,smoothedPeakValue:this._smoothedPeakValue,clipped:this._clipped})}function e(a){b.isObject(a,"stream");var c=this;a.getAudioTracks().length>0?(c._mediaStreamSource=c._context.createMediaStreamSource(a),c._mediaStreamSource.connect(c._scriptProcessor),c._scriptProcessor.connect(c._context.destination)):c._logger.info("Stream has no audio tracks")}function f(){this._mediaStreamSource&&this._mediaStreamSource.disconnect(),this._scriptProcessor.disconnect()}var g=1/16;return c.prototype.init=function(c,e){b.isObject(c,"context"),b.isFunction(c.createScriptProcessor,"context.createScriptProcessor"),e=parseFloat(e||g),b.isNumber(e,"alpha"),this._context=c,this._alpha=e,this._value=0,this._smoothedValue=0,this._smoothedPeakValue=0,this._clipped=0,this._scriptProcessor=c.createScriptProcessor(4096,1,1),a.addEventListener(this._scriptProcessor,"audioprocess",a.bind(d,this))},c.prototype.onValue=function(a){this._callback=a},c.prototype.getValue=function(){return this._value},c.prototype.getSmoothedValue=function(){return this._smoothedValue},c.prototype.getSmoothedPeakValue=function(){return this._smoothedPeakValue},c.prototype.setAlpha=function(a){b.isNumber(a,"alpha"),this._alpha=parseFloat(a)},c.prototype.connect=function(a){var b=this;return e.call(b,a)},c.prototype.stop=function(){return f.call(this)},c.prototype.toString=function(){return"AudioVolumeMeter"},c}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(76)],e=function(a,b,c){"use strict";function d(a){b.isObject(a,"logger"),this._logger=a,this._audioVolumeMeters={}}return d.prototype.stopAllMeters=function(){a.forOwn(this._audioVolumeMeters,function(a){a.stop()})},d.prototype.getAudioVolumeMeter=function(a){return b.isObject(a,"stream"),b.isStringNotEmpty(a.id,"streamId"),this._audioVolumeMeters[a.id]||(this._audioVolumeMeters[a.id]=new c(this._logger)),this._audioVolumeMeters[a.id]},d.prototype.getAudioVolumeMeters=function(){return a.values(this._audioVolumeMeters)},d.prototype.toString=function(){return"AudioVolumeMeterFactory"},d}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1)],e=function(a,b){"use strict";function c(a){this.init(a)}function d(b,c){if(this._membersSubscription&&this._membersSubscription.dispose(),!c)return this._publisher.limitBandwidth(b);var d=c.getObservableMembers();this._membersSubscription=d.subscribe(a.bind(e,this,b),{initial:"notify"
})}function e(a,b){if(b.length!==this._roomMemberCount){this._roomMemberCount=b.length;var c=a/Math.max(1,this._roomMemberCount-1);this._publisher.limitBandwidth(c)}}var f=5e6;return c.prototype.init=function(a){b.isObject(a,"publisher"),this._publisher=a,this._roomMemberCount=0,this._roomSubscription=null,this._membersSubscription=null},c.prototype.connect=function(c,e){b.isObject(c,"roomService"),e=e||{};var g=c.getObservableActiveRoom(),h=e.roomBandwidthLimit||f;this._roomSubscription=g.subscribe(a.bind(d,this,h),{initial:"notify"})},c.prototype.close=function(){this._roomSubscription&&this._roomSubscription.dispose(),this._membersSubscription&&this._membersSubscription.dispose(),this._roomSubscription=null,this._membersSubscription=null},c.prototype.toString=function(){return"PublisherBandwidthAdjuster"},c}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(4),c(3),c(34)],e=function(a,b,c,d,e){"use strict";function f(a){b.isObject(a,"pcast"),b.isFunction(a.getLogger,"pcast.getLogger"),b.isFunction(a.getProtocol,"pcast.getProtocol"),this._pcast=a,this._logger=a.getLogger(),this._protocol=a.getProtocol(),this._enabled=new c.Observable((!1)),this._lastSubscribedSessionId=null,b.isObject(this._logger,"this._logger"),b.isObject(this._protocol,"this._protocol"),this._authService=new e(this._pcast)}function g(){var b=this._authService.getObservableStatus().subscribe(a.bind(j,this)),c=this._authService.getObservableSessionId().subscribe(a.bind(k,this));this._disposables.add(b),this._disposables.add(c)}function h(a,b){var c=this;this._roomMessagesListeners[a]=b;var e=new d.Disposable(function(){c._roomMessagesListeners[a]===b&&delete c._roomMessagesListeners[a]});return this._disposables.add(e),e}function i(a){switch(b.isObject(a,"event"),b.isStringNotEmpty(a.roomId,"event.roomId"),b.isStringNotEmpty(a.eventType,"event.eventType"),b.isArray(a.chatMessages,"event.chatMessages"),a.eventType){case"Message":this._logger.debug("[%s] Room messages [%s]",a.roomId,a.chatMessages);var c=this._roomMessagesListeners[a.roomId];q(a.chatMessages),c&&c(null,{status:"ok",chatMessages:a.chatMessages});break;default:this._logger.warn("Unsupported room conversation event [%s]",a.eventType)}}function j(a){}function k(a){this._lastSubscribedSessionId&&this._lastSubscribedSessionId!==a&&l.call(this)}function l(){var b=this;a.forOwn(this._roomMessagesListeners,function(a,c){n.call(b,c,1)})}function m(a,c,d,e,f){b.isStringNotEmpty(a,"roomId"),b.isFunction(f,"callback"),e&&d||b.isNumber(c,"batchSize"),e&&b.isStringNotEmpty(e,"beforeMessageId"),d&&b.isStringNotEmpty(d,"afterMessageId"),p.call(this),this._authService.assertAuthorized();var g=this._authService.getPCastSessionId();this._logger.info("Get messages from room [%s] conversation with batch size of [%s], after [%s], and before [%s]",a,c,d,e);var h=this;this._protocol.getMessages(g,a,c,d,e,function(a,b){if(a)return h._logger.error("Get messages from room conversation failed with error [%s]",a),f(a,null);var c={status:b.status};return"ok"!==b.status?(h._logger.warn("Get messages from room conversation failed with status [%s]",b.status),f(null,c)):(c.chatMessages=b.chatMessages,q(c.chatMessages),void f(null,c))})}function n(a,c){b.isStringNotEmpty(a,"roomId"),b.isNumber(c,"batchSize"),p.call(this),this._authService.assertAuthorized();var d=this._authService.getPCastSessionId();this._lastSubscribedSessionId=d,this._logger.info("Subscribe to room [%s] conversation with batch size of [%s]",a,c);var e=this;this._protocol.subscribeToRoomConversation(d,a,c,function(b,c){var d=e._roomMessagesListeners[a];if(!d)return e._logger.warn("No subscription callback set for room [%s]",a);if(b)return e._logger.error("Subscribe to room conversation failed with error [%s]",b),d(b,null);var f={status:c.status};return"ok"!==c.status?(delete e._roomMessagesListeners[a],e._logger.warn("Subscribe to room conversation failed with status [%s]",c.status),d(null,f)):(f.chatMessages=c.chatMessages,q(f.chatMessages),void d(null,f))})}function o(a,c,d,e,f,g){b.isStringNotEmpty(a,"roomId"),b.isStringNotEmpty(c,"screenName"),b.isStringNotEmpty(d,"role"),b.isNumber(e,"lastUpdate"),b.isStringNotEmpty(f,"message"),b.isFunction(g,"callback"),p.call(this),this._authService.assertAuthorized();var h=this._authService.getPCastSessionId(),i={messageId:"",timestamp:0,from:{sessionId:h,screenName:c,role:d,lastUpdate:e},message:f};this._logger.info("Send message to room [%s] from [%s]",a,c);var j=this;return this._protocol.sendMessageToRoom(a,i,function(a,b){if(a)return j._logger.error("Send message to room failed with error [%s]",a),g(a,null);var c={status:b.status};"ok"!==b.status&&j._logger.warn("Send message to room failed with status [%s]",b.status),g(null,c)})}function p(){if(!this._enabled.getValue())throw new Error("ChatService not Enabled. Please start before performing actions.")}function q(b){a.forEach(b,function(a){r(a)})}function r(b){b.timestamp&&(b.timestamp=a.utc(b.timestamp)),b.from&&(b.from.lastUpdate=a.utc(b.from.lastUpdate))}return f.prototype.start=function(){if(!this._enabled.getValue()){this._disposables=new d.DisposableList,this._roomMessagesListeners={},this._enabled.setValue(!0),g.call(this);var b=this._protocol.onEvent("chat.RoomConversationEvent",a.bind(i,this));this._disposables.add(b)}},f.prototype.stop=function(){this._enabled.getValue()&&this._disposables&&this._disposables.dispose()},f.prototype.getObservableChatEnabled=function(){return this._enabled},f.prototype.sendMessageToRoom=function(a,b,c,d,e,f){o.call(this,a,b,c,d,e,f)},f.prototype.subscribeAndLoadMessages=function(a,b,c){var d=h.call(this,a,c);return n.call(this,a,b),d},f.prototype.getMessages=function(a,b,c,d,e){m.call(this,a,b,c,d,e)},f.prototype.toString=function(){return"ChatService"},f}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(4),c(3),c(79)],e=function(a,b,c,d,e){"use strict";function f(a){b.isObject(a,"roomService"),b.isObject(a._pcast,"roomService._pcast"),b.isObject(a._logger,"roomService._logger"),this._roomService=a,this._pcast=a._pcast,this._logger=a._logger,this._chatService=new e(this._pcast),this._chatMessages=new c.ObservableArray([]),this._latestMessageQueue=[],this._disposables=new d.DisposableList,this._chatRoomId=null}function g(a){a&&this._chatRoomId===a.getRoomId()||(j.call(this),a&&i.call(this))}function h(){var b=this._roomService.getObservableActiveRoom().subscribe(a.bind(g,this));this._disposables.add(b)}function i(){j.call(this),this._roomChatSubscription=k.call(this,this._batchSize)}function j(){this._roomChatSubscription&&this._roomChatSubscription.dispose&&this._roomChatSubscription.dispose()}function k(b){var c=this._roomService.getObservableActiveRoom().getValue(),d=c.getRoomId();this._chatRoomId=d;var e=this;return this._chatMessages.setValue([]),this._chatService.subscribeAndLoadMessages(d,b,function(b,c){if(b)throw b;if("ok"!==c.status)throw new Error("Unable to subscribe to room chat. Status "+status);var d=e._chatMessages.getValue();a.forEach(c.chatMessages,function(a){d.push(a)}),d.length>m&&d.splice(0,d.length-m),e._chatMessages.setValue(d)})}var l=0,m=100;return f.prototype.start=function(a){this._batchSize=a||l,this._chatService.start(),h.call(this),i.call(this)},f.prototype.stop=function(){this._chatService.stop(),j.call(this),this._disposables&&this._disposables.dispose()},f.prototype.getObservableChatMessages=function(){return this._chatMessages},f.prototype.getObservableChatEnabled=function(){return this._chatService.getObservableChatEnabled()},f.prototype.sendMessageToRoom=function(a,b){var c=this._roomService.getObservableActiveRoom().getValue(),d=c.getRoomId(),e=this._roomService._self.getValue(),f=e.getObservableScreenName().getValue(),g=e.getObservableRole().getValue(),h=e.getLastUpdate();this._chatService.sendMessageToRoom(d,f,g,h,a,b)},f.prototype.getMessages=function(a,b,c,d){var e=this._roomService.getObservableActiveRoom().getValue(),f=e.getRoomId();return this._chatService.getMessages(f,a,b,c,d)},f.prototype.toString=function(){return"RoomChatService"},f}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(2),c(8),c(15),c(37)],e=function(a,b,c,d,e,f){function g(g){b.isString(g,"uri"),this._loggingUrl="/telemetry/logs",this._domain="object"==typeof location?location.hostname:c.browser+"-"+c.browserVersion+"-unknown",this._minLevel=d.level.TRACE,this._isEnabled=!0,this._browser=(c.browser||"Browser")+"/"+(c.browserVersion||"?"),this._mostRecentRuntime=0,this._batchHttpProtocol=new e.BatchHttpProto(g+this._loggingUrl,[f],"telemetry.StoreLogRecords",{maxAttempts:3,maxBufferedRecords:1e3,maxBatchSize:512}),this._batchHttpProtocol.on("capacity",a.bind(i,this))}function h(b,c,d){this._batchHttpProtocol.addRecord({level:b,timestamp:a.isoString(),category:c,message:d.join(" "),source:this._browser,fullQualifiedName:this._domain,sessionId:this._mostRecentSessionId,userId:this._mostRecentUserId,environment:this._mostRecentEnvironment,version:this._mostRecentVersion,runtime:this._mostRecentRuntime})}function i(b){this._batchHttpProtocol.addRecordToBeginning({level:"Warn",timestamp:a.isoString(),category:"websdk/telemetryLogger",message:"Deleted "+b+" records",source:this._browser,fullQualifiedName:this._domain,sessionId:this._mostRecentSessionId,userId:this._mostRecentUserId,environment:this._mostRecentEnvironment,version:this._mostRecentVersion,runtime:this._mostRecentRuntime})}return g.prototype.setThreshold=function(a){b.isNumber(a,"level"),this._minLevel=a},g.prototype.getThreshold=function(){return this._minLevel},g.prototype.isEnabled=function(){return this._isEnabled},g.prototype.setEnabled=function(a){b.isBoolean(a,"enabled"),this._isEnabled=a},g.prototype.log=function(a,c,d,e,f,g,i,j,k){k.level<this._minLevel||!this._isEnabled||(b.isArray(e,"messages"),this._mostRecentRuntime=a,this._mostRecentSessionId=f,this._mostRecentUserId=g,this._mostRecentEnvironment=i,this._mostRecentVersion=j,h.call(this,c,d,e))},g}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(35),c(81)],e=function(a,b,c,d){function e(){this._telemetryAppenders={}}function f(a){var b=new d(a);return a||b.setEnabled(!1),b}var g={urls:{local:"",staging:"https://telemetry-stg.phenixp2p.com",production:"https://telemetry.phenixp2p.com"}};return e.prototype.getAppender=function(a){var b=c.parseEnvFromPcastBaseUri(a||""),d=g.urls[b];return this._telemetryAppenders[b]||(this._telemetryAppenders[b]=f.call(this,d)),this._telemetryAppenders[b]},new e}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";var a={"package":"chat",options:{optimize_for:"LITE_RUNTIME"},messages:[{name:"Room",fields:[{rule:"optional",type:"string",name:"roomId",id:1},{rule:"optional",type:"string",name:"alias",id:2},{rule:"required",type:"string",name:"name",id:3},{rule:"required",type:"string",name:"description",id:4},{rule:"required",type:"RoomType",name:"type",id:5},{rule:"repeated",type:"string",name:"options",id:6},{rule:"optional",type:"string",name:"bridgeId",id:7},{rule:"optional",type:"string",name:"pin",id:8}]},{name:"Stream",fields:[{rule:"required",type:"StreamType",name:"type",id:1},{rule:"required",type:"string",name:"uri",id:2},{rule:"required",type:"TrackState",name:"audioState",id:3},{rule:"required",type:"TrackState",name:"videoState",id:4}]},{name:"Member",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"screenName",id:2},{rule:"required",type:"MemberRole",name:"role",id:3},{rule:"repeated",type:"Stream",name:"streams",id:4},{rule:"required",type:"MemberState",name:"state",id:5},{rule:"required",type:"uint64",name:"lastUpdate",id:6}]},{name:"MemberUpdate",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"optional",type:"string",name:"screenName",id:2},{rule:"optional",type:"MemberRole",name:"role",id:3},{rule:"required",type:"bool",name:"updateStreams",id:7,options:{"default":!1}},{rule:"repeated",type:"Stream",name:"streams",id:4},{rule:"optional",type:"MemberState",name:"state",id:5},{rule:"required",type:"uint64",name:"lastUpdate",id:6}]},{name:"ChatUser",fields:[{rule:"optional",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"screenName",id:2},{rule:"required",type:"MemberRole",name:"role",id:3},{rule:"required",type:"uint64",name:"lastUpdate",id:4}]},{name:"ChatMessage",fields:[{rule:"required",type:"string",name:"messageId",id:1},{rule:"required",type:"uint64",name:"timestamp",id:2},{rule:"required",type:"ChatUser",name:"from",id:3},{rule:"required",type:"string",name:"message",id:4}]},{name:"CreateRoom",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"Room",name:"room",id:2}]},{name:"CreateRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"Room",name:"room",id:2}]},{name:"JoinRoom",fields:[{rule:"optional",type:"string",name:"roomId",id:1},{rule:"optional",type:"string",name:"alias",id:2},{rule:"required",type:"string",name:"sessionId",id:3},{rule:"required",type:"Member",name:"member",id:4},{rule:"repeated",type:"string",name:"options",id:5},{rule:"required",type:"uint64",name:"timestamp",id:6}]},{name:"JoinRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"Room",name:"room",id:2},{rule:"repeated",type:"Member",name:"members",id:3},{rule:"optional",type:"Member",name:"self",id:5},{rule:"repeated",type:"string",name:"options",id:4}]},{name:"UpdateRoom",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"Room",name:"room",id:2},{rule:"required",type:"uint64",name:"timestamp",id:3}]},{name:"UpdateRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"UpdateMember",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"MemberUpdate",name:"member",id:2},{rule:"repeated",type:"string",name:"options",id:3},{rule:"required",type:"uint64",name:"timestamp",id:4}]},{name:"UpdateMemberResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"uint64",name:"lastUpdate",id:2}]},{name:"LeaveRoom",fields:[{rule:"required",type:"string",name:"roomId",id:1},{rule:"required",type:"string",name:"sessionId",id:2},{rule:"required",type:"uint64",name:"timestamp",id:3}]},{name:"LeaveRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"DestroyRoom",fields:[{rule:"required",type:"string",name:"roomId",id:1}]},{name:"DestroyRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"GetRoomInfo",fields:[{rule:"optional",type:"string",name:"roomId",id:1},{rule:"optional",type:"string",name:"alias",id:2},{rule:"optional",type:"string",name:"sessionId",id:3},{rule:"optional",type:"string",name:"applicationId",id:4},{rule:"optional",type:"string",name:"secret",id:5},{rule:"repeated",type:"string",name:"options",id:6}]},{name:"GetRoomInfoResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"Room",name:"room",id:2},{rule:"repeated",type:"Member",name:"members",id:3},{rule:"repeated",type:"string",name:"options",id:4}]},{name:"RoomEvent",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"roomId",id:2},{rule:"required",type:"RoomEventType",name:"eventType",id:3},{rule:"repeated",type:"Member",name:"members",id:4},{rule:"optional",type:"Room",name:"room",id:5},{rule:"repeated",type:"string",name:"options",id:6},{rule:"required",type:"uint64",name:"timestamp",id:7}]},{name:"SendMessageToRoom",fields:[{rule:"required",type:"string",name:"roomId",id:1},{rule:"required",type:"ChatMessage",name:"chatMessage",id:2}]},{name:"SendMessageToRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"FetchRoomConversation",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"roomId",id:2},{rule:"optional",type:"string",name:"afterMessageId",id:3},{rule:"optional",type:"string",name:"beforeMessageId",id:4},{rule:"required",type:"uint32",name:"limit",id:5},{rule:"repeated",type:"RoomConversationOption",name:"options",id:6}]},{name:"FetchRoomConversationResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"ChatMessage",name:"chatMessages",id:2}]},{name:"RoomConversationEvent",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"roomId",id:2},{rule:"required",type:"RoomConversationEventType",name:"eventType",id:3},{rule:"repeated",type:"ChatMessage",name:"chatMessages",id:4}]},{name:"RoomBridgeIdle",fields:[{rule:"required",type:"string",name:"roomId",id:1},{rule:"required",type:"string",name:"bridgeId",id:2}]}],enums:[{name:"RoomType",values:[{name:"DirectChat",id:0},{name:"MultiPartyChat",id:1},{name:"ModeratedChat",id:2},{name:"TownHall",id:3},{name:"Channel",id:4}]},{name:"MemberRole",values:[{name:"Participant",id:0},{name:"Moderator",id:1},{name:"Presenter",id:2},{name:"Audience",id:3}]},{name:"MemberState",values:[{name:"Active",id:0},{name:"Passive",id:1},{name:"HandRaised",id:2},{name:"Inactive",id:3},{name:"Offline",id:4}]},{name:"RoomEventType",values:[{name:"MemberJoined",id:0},{name:"MemberLeft",id:1},{name:"MemberUpdated",id:2},{name:"RoomUpdated",id:3},{name:"RoomEnded",id:4}]},{name:"TrackState",values:[{name:"TrackEnabled",id:0},{name:"TrackDisabled",id:1},{name:"TrackEnded",id:2}]},{name:"StreamType",values:[{name:"User",id:0},{name:"Presentation",id:1},{name:"Audio",id:2}]},{name:"RoomConversationOption",values:[{name:"Subscribe",id:0}]},{name:"RoomConversationEventType",values:[{name:"Message",id:0}]}]};return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";var a={"package":"pcast",options:{optimize_for:"LITE_RUNTIME"},messages:[{name:"Authenticate",fields:[{rule:"optional",type:"uint32",name:"apiVersion",id:9,options:{"default":0}},{rule:"required",type:"string",name:"clientVersion",id:1},{rule:"optional",type:"string",name:"device",id:12},{rule:"required",type:"string",name:"deviceId",id:2},{rule:"optional",type:"string",name:"manufacturer",id:13},{rule:"required",type:"string",name:"platform",id:3},{rule:"required",type:"string",name:"platformVersion",id:4},{rule:"required",type:"string",name:"authenticationToken",id:5},{rule:"optional",type:"string",name:"connectionId",id:6},{rule:"optional",type:"string",name:"connectionRouteKey",id:10},{rule:"optional",type:"string",name:"remoteAddress",id:11},{rule:"optional",type:"string",name:"sessionId",id:7},{rule:"optional",type:"string",name:"applicationId",id:8}]},{name:"AuthenticateResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"sessionId",id:2},{rule:"optional",type:"string",name:"redirect",id:3},{rule:"repeated",type:"string",name:"roles",id:4}]},{name:"Bye",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"reason",id:2}]},{name:"ByeResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"SessionDescription",fields:[{rule:"required",type:"Type",name:"type",id:1,options:{"default":"Offer"}},{rule:"required",type:"string",name:"sdp",id:2}],enums:[{name:"Type",values:[{name:"Offer",id:0},{name:"Answer",id:1}]}]},{name:"CreateStream",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"optional",type:"string",name:"originStreamId",id:2},{rule:"repeated",type:"string",name:"originStreamIds",id:10},{rule:"repeated",type:"string",name:"options",id:3},{rule:"optional",type:"string",name:"connectUri",id:8},{rule:"repeated",type:"string",name:"connectOptions",id:9},{rule:"repeated",type:"string",name:"tags",id:4},{rule:"optional",type:"string",name:"userAgent",id:11},{rule:"optional",type:"SetRemoteDescription",name:"setRemoteDescription",id:5},{rule:"optional",type:"CreateOfferDescription",name:"createOfferDescription",id:6},{rule:"optional",type:"CreateAnswerDescription",name:"createAnswerDescription",id:7}]},{name:"IceServer",fields:[{rule:"repeated",type:"string",name:"urls",id:1},{rule:"optional",type:"string",name:"username",id:2},{rule:"optional",type:"string",name:"credential",id:3}]},{name:"RtcConfiguration",fields:[{rule:"optional",type:"BundlePolicy",name:"bundlePolicy",id:1},{rule:"optional",type:"uint32",name:"iceCandidatePoolSize",id:3},{rule:"repeated",type:"IceServer",name:"iceServers",id:4},{rule:"optional",type:"IceTransportPolicy",name:"iceTransportPolicy",id:5},{rule:"optional",type:"string",name:"peerIdentity",id:6},{rule:"optional",type:"RtcpMuxPolicy",name:"rtcpMuxPolicy",id:7}],enums:[{name:"BundlePolicy",values:[{name:"BundlePolicyBalanced",id:1},{name:"BundlePolicyMaxCompat",id:2},{name:"BundlePolicyMaxBundle",id:3}]},{name:"IceTransportPolicy",values:[{name:"IceTransportPolicyAll",id:1},{name:"IceTransportPolicyPublic",id:2},{name:"IceTransportPolicyRelay",id:3}]},{name:"RtcpMuxPolicy",values:[{name:"RtcpMuxPolicyNegotiate",id:1},{name:"RtcpMuxPolicyRequire",id:2}]}]},{name:"CreateStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"streamId",id:2},{rule:"optional",type:"string",name:"instanceRouteKey",id:5},{rule:"repeated",type:"string",name:"streamUris",id:8},{rule:"optional",type:"RtcConfiguration",name:"rtcConfiguration",id:9},{rule:"optional",type:"SetRemoteDescriptionResponse",name:"setRemoteDescriptionResponse",id:3},{rule:"optional",type:"CreateOfferDescriptionResponse",name:"createOfferDescriptionResponse",id:4},{rule:"optional",type:"CreateAnswerDescriptionResponse",name:"createAnswerDescriptionResponse",id:6},{rule:"repeated",type:"string",name:"options",id:7},{rule:"optional",type:"uint64",name:"offset",id:10,options:{"default":0}}]},{name:"SetLocalDescription",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"required",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"optional",type:"uint32",name:"apiVersion",id:3,options:{"default":0}}]},{name:"SetLocalDescriptionResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"string",name:"options",id:2}]},{name:"SetRemoteDescription",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"required",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"optional",type:"uint32",name:"apiVersion",id:3,options:{"default":0}}]},{name:"SetRemoteDescriptionResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"repeated",type:"string",name:"options",id:3}]},{name:"CreateOfferDescription",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"repeated",type:"string",name:"options",id:2},{rule:"optional",type:"uint32",name:"apiVersion",id:3,options:{"default":0}}]},{name:"CreateOfferDescriptionResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"repeated",type:"string",name:"options",id:3}]},{name:"CreateAnswerDescription",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"repeated",type:"string",name:"options",id:2},{rule:"optional",type:"uint32",name:"apiVersion",id:3,options:{"default":0}}]},{name:"CreateAnswerDescriptionResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"repeated",type:"string",name:"options",id:3}]},{name:"IceCandidate",fields:[{rule:"required",type:"string",name:"candidate",id:1},{rule:"required",type:"uint32",name:"sdpMLineIndex",id:2},{rule:"required",type:"string",name:"sdpMid",id:3}]},{name:"AddIceCandidates",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"repeated",type:"IceCandidate",name:"candidates",id:2},{rule:"repeated",type:"string",name:"options",id:3},{rule:"optional",type:"uint32",name:"apiVersion",id:4,options:{"default":0}}]},{name:"AddIceCandidatesResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"string",name:"options",id:2}]},{name:"UpdateStreamState",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"required",type:"string",name:"signalingState",id:2},{rule:"required",type:"string",name:"iceGatheringState",id:3},{rule:"required",type:"string",name:"iceConnectionState",id:4},{rule:"optional",type:"uint32",name:"apiVersion",id:5,options:{"default":0}}]},{name:"UpdateStreamStateResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"string",name:"options",id:2}]},{name:"DestroyStream",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"optional",type:"string",name:"reason",id:2},{rule:"repeated",type:"string",name:"options",id:3}]},{name:"DestroyStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"ConnectionDisconnected",fields:[{rule:"required",type:"string",name:"connectionId",id:1},{rule:"required",type:"uint32",name:"reasonCode",id:2},{rule:"optional",type:"string",name:"description",id:3}]},{name:"ConnectionDisconnectedResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"StreamStarted",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"repeated",type:"string",name:"tags",id:3}]},{name:"SourceStreamStarted",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"repeated",type:"string",name:"capabilities",id:3},{rule:"repeated",type:"string",name:"tags",id:4}]},{name:"StreamEnded",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"string",name:"reason",id:3},{rule:"repeated",type:"string",name:"tags",id:4},{rule:"optional",type:"string",name:"continuationId",id:5},{rule:"optional",type:"string",name:"routeKey",id:6}]},{name:"SourceStreamEnded",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"string",name:"reason",id:3},{rule:"repeated",type:"string",name:"capabilities",id:4},{rule:"repeated",type:"string",name:"tags",id:5}]},{name:"StreamEndedResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"continuationId",id:2},{rule:"optional",type:"string",name:"routeKey",id:3}]},{name:"StreamIdle",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"repeated",type:"string",name:"options",id:3},{rule:"repeated",type:"string",name:"tags",id:4}]},{name:"StreamArchived",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"uint64",name:"startTime",id:4},{rule:"required",type:"string",name:"uri",id:3}]},{name:"SessionEnded",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"reason",id:2},{rule:"required",type:"float",name:"duration",id:3}]},{name:"ResourceIdle",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"routeKey",id:2}]},{name:"ResourceIdleResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"StreamPlaylist",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"PlaylistType",name:"playlistType",id:3},{rule:"required",type:"string",name:"uri",id:4},{rule:"required",type:"bool",name:"isVariant",id:5,options:{"default":!0}}],enums:[{name:"PlaylistType",values:[{name:"Live",id:0},{name:"OnDemand",id:1}]}]},{name:"StreamRtmp",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"required",type:"string",name:"uri",id:2},{rule:"required",type:"uint32",name:"height",id:3},{rule:"required",type:"uint32",name:"bitrate",id:4}]},{name:"SendEventToClient",fields:[{rule:"required",type:"string",name:"connectionId",id:1},{rule:"required",type:"string",name:"type",id:2},{rule:"required",type:"bytes",name:"payload",id:3}]},{name:"SendEventToClientResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"SendRequestToClient",fields:[{rule:"required",type:"string",name:"connectionId",id:1},{rule:"required",type:"string",name:"type",id:2},{rule:"required",type:"bytes",name:"payload",id:3}]},{name:"SendRequestToClientResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"type",id:2},{rule:"optional",type:"bytes",name:"payload",id:3}]},{name:"SetupStream",fields:[{rule:"required",type:"string",name:"streamToken",id:1},{rule:"required",type:"CreateStream",name:"createStream",id:2}]},{name:"SetupStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"CreateStreamResponse",name:"createStreamResponse",id:2}]},{name:"SetupPlaylistStream",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamToken",id:2},{rule:"repeated",type:"string",name:"options",id:3},{rule:"repeated",type:"string",name:"tags",id:4}]},{name:"PlaylistStreamManifest",fields:[{rule:"required",type:"string",name:"manifest",id:1},{rule:"required",type:"bool",name:"isProtectedContent",id:2},{rule:"optional",type:"string",name:"drmToken",id:3}]},{name:"SetupPlaylistStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"PlaylistStreamManifest",name:"manifests",id:2},{rule:"optional",type:"uint64",name:"offset",id:3,options:{"default":0}}]},{name:"StreamDataQuality",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"uint64",name:"timestamp",id:3},{rule:"required",type:"DataQualityStatus",name:"status",id:4},{rule:"required",type:"DataQualityReason",name:"reason",id:5}],enums:[{name:"DataQualityStatus",values:[{name:"NoData",id:0},{name:"AudioOnly",id:1},{name:"All",id:2}]},{name:"DataQualityReason",values:[{name:"None",id:0},{name:"UploadLimited",id:1},{name:"DownloadLimited",id:2},{name:"PublisherLimited",id:3},{name:"NetworkLimited",id:4}]}]},{name:"StreamDataQualityResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"CallbackEvent",fields:[{rule:"optional",type:"uint32",name:"apiVersion",id:1,options:{"default":0}},{rule:"required",type:"string",name:"entity",id:2},{rule:"required",type:"string",name:"what",id:3},{rule:"required",type:"string",name:"data",id:4},{rule:"optional",type:"string",name:"sessionId",id:5}]},{name:"Uri",fields:[{rule:"optional",type:"string",name:"protocol",id:1,options:{"default":"http"}},{rule:"required",type:"string",name:"host",id:2},{rule:"optional",type:"uint32",name:"port",id:3,options:{"default":80}},{rule:"optional",type:"string",name:"method",id:4,options:{"default":"POST"}},{rule:"optional",type:"string",name:"path",id:5,options:{"default":"/"}}]},{name:"SetApplicationCallback",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"required",type:"Uri",name:"callback",id:3}]},{name:"SetApplicationCallbackResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"endpoint",id:2}]},{name:"IssueAuthenticationToken",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"repeated",type:"string",name:"capabilities",id:3}]},{name:"IssueAuthenticationTokenResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"authenticationToken",
id:2}]},{name:"IssueStreamToken",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"required",type:"string",name:"sessionId",id:3},{rule:"optional",type:"string",name:"originStreamId",id:4},{rule:"repeated",type:"string",name:"alternateOriginStreamIds",id:6},{rule:"repeated",type:"string",name:"capabilities",id:5},{rule:"optional",type:"bool",name:"permissive",id:7,options:{"default":!1}}]},{name:"IssueStreamTokenResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"streamToken",id:2}]},{name:"IssueDrmToken",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"optional",type:"string",name:"sessionId",id:3},{rule:"required",type:"string",name:"originStreamId",id:4},{rule:"repeated",type:"string",name:"capabilities",id:5}]},{name:"IssueDrmTokenResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"drmToken",id:2}]},{name:"TerminateStream",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"optional",type:"string",name:"streamId",id:3,oneof:"streamOrToken"},{rule:"optional",type:"string",name:"streamToken",id:5,oneof:"streamOrToken"},{rule:"optional",type:"string",name:"reason",id:4}],oneofs:{streamOrToken:[3,5]}},{name:"TerminateStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"DeleteStream",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"optional",type:"string",name:"streamId",id:3,oneof:"streamOrToken"},{rule:"optional",type:"string",name:"streamToken",id:5,oneof:"streamOrToken"},{rule:"optional",type:"string",name:"reason",id:4}],oneofs:{streamOrToken:[3,5]}},{name:"DeleteStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"Stream",fields:[{rule:"required",type:"string",name:"streamId",id:1}]},{name:"ListStreams",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"optional",type:"string",name:"start",id:3},{rule:"required",type:"uint32",name:"length",id:4},{rule:"repeated",type:"string",name:"options",id:5}]},{name:"ListStreamsResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"start",id:2},{rule:"optional",type:"uint32",name:"length",id:3},{rule:"repeated",type:"Stream",name:"streams",id:4}]},{name:"GetPlaylistUris",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"required",type:"string",name:"streamId",id:3},{rule:"repeated",type:"string",name:"options",id:4}]},{name:"GetPlaylistUrisResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"Playlist",name:"playlists",id:2},{rule:"optional",type:"StreamMetadata",name:"streamInfo",id:3}],messages:[{name:"PlaylistMetadata",fields:[{rule:"optional",type:"uint32",name:"bitrate",id:1},{rule:"optional",type:"uint32",name:"height",id:2},{rule:"optional",type:"float",name:"framesPerSecond",id:3}]},{name:"StreamMetadata",fields:[{rule:"required",type:"string",name:"startTime",id:1},{rule:"optional",type:"string",name:"endTime",id:2}]},{name:"Playlist",fields:[{rule:"required",type:"string",name:"name",id:1},{rule:"required",type:"PlaylistType",name:"type",id:2},{rule:"required",type:"string",name:"uri",id:3},{rule:"required",type:"bool",name:"isVariant",id:4},{rule:"required",type:"bool",name:"isProtected",id:5},{rule:"required",type:"PlaylistMetadata",name:"info",id:6}]}],enums:[{name:"PlaylistType",values:[{name:"Hls",id:0},{name:"Dash",id:1}]}]}]};return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(38)],e=function(a,b,c){"use strict";function d(a){b.isObject(a,"roomService"),this._roomService=a}function e(a,b,d){return d&&d.room&&(d.channel=new c(d.room),delete d.room),a(b,d)}return d.prototype.start=function(){return this._roomService.start.apply(this._roomService,arguments)},d.prototype.getChannelInfo=function(c,d,f){return c?b.isStringNotEmpty(c,"channelId"):b.isStringNotEmpty(d,"alias"),b.isFunction(f,"callback"),this._roomService.getRoomInfo(c,d,a.bind(e,null,f))},d.prototype.createChannel=function(c,d){return b.isObject(c,"channel"),b.isStringNotEmpty(c.name,"channel.name"),b.isStringNotEmpty(c.type,"channel.type"),b.isString(c.description,"channel.description"),b.isFunction(d,"callback"),this._roomService.createRoom(c,a.bind(e,null,d))},d.prototype.enterChannel=function(c,d,f){return c?b.isStringNotEmpty(c,"roomId"):b.isStringNotEmpty(d,"alias"),b.isFunction(f,"callback"),this._roomService.enterRoom(c,d,a.bind(e,null,f))},d.prototype.leaveChannel=function(){return this._roomService.leaveRoom.apply(this._roomService,arguments)},d.prototype.getChatService=function(){return this._roomService.getChatService.apply(this._roomService,arguments)},d.prototype.getSelf=function(){return this._roomService.getSelf.apply(this._roomService,arguments)},d.prototype.getObservableActiveChannel=function(){return this._roomService.getObservableActiveRoom.apply(this._roomService,arguments)},d.prototype.updateSelf=function(){return this._roomService.updateSelf.apply(this._roomService,arguments)},d.prototype.updateMember=function(){return this._roomService.updateMember.apply(this._roomService,arguments)},d.prototype.updateChannel=function(){return this._roomService.updateRoom.apply(this._roomService,arguments)},d.prototype.revertChannelChanges=function(){return this._roomService.revertRoomChanges.apply(this._roomService,arguments)},d.prototype.revertMemberChanges=function(){return this._roomService.revertMemberChanges.apply(this._roomService,arguments)},d.prototype.isInChannel=function(){return this._roomService.isInRoom.apply(this._roomService,arguments)},d.prototype.toString=function(){return"ChannelService"},d.prototype.stop=function(){return this._roomService.stop.apply(this._roomService,arguments)},d}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(4),c(40)],e=function(a,b,c,d){"use strict";function e(a,b,c,d,e,f,g,h,i){this.init(a,b,c,d,e,f,g,h,i)}function f(){throw new Error("ImmutableRoom is Immutable")}function g(){throw new Error("Unable to subscribe to Immutable [ImmutableRoom]")}function h(b){a.isArray(b)?a.forEach(b,function(a){i(a)}):a.isObject(b)&&a.forOwn(b,function(a){i(a)})}function i(a){j(a),h(a)}function j(a){if(a instanceof c.Observable||a instanceof c.ObservableArray){a.setValue=f,a.subscribe=g;var b=a.getValue();h(b)}}return e.prototype.init=function(a,b,c,e,f,g,i,j,k){this._room=new d(null,b,c,e,f,g,i,j,k),h(this._room)},e.prototype.getRoomId=function(){return this._room.getRoomId()},e.prototype.getObservableAlias=function(){return this._room.getObservableAlias()},e.prototype.getObservableName=function(){return this._room.getObservableName()},e.prototype.getObservableDescription=function(){return this._room.getObservableDescription()},e.prototype.getObservableType=function(){return this._room.getObservableType()},e.prototype.getObservableMembers=function(){return this._room.getObservableMembers()},e.prototype.getObservableBridgeId=function(){return this._room.getObservableBridgeId()},e.prototype.getObservablePin=function(){return this._room.getObservablePin()},e.prototype.toString=function(){return this._room.toString()},e.prototype.toJson=function(){return this._room.toJson()},e.prototype.commitChanges=f,e.prototype.reload=f,e.prototype._update=f,e.prototype._addMembers=f,e.prototype._removeMembers=f,e.prototype._updateMembers=f,e}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(2)],e=function(a,b){"use strict";function c(){}var d=/profile-level-id=[^;\n]*/;return c.prototype.getH264ProfileId=function(c){b.isStringNotEmpty(c,"offerSdp");var e=a.get(c.match(d),"0","");return a.get(e.split("="),"1",null)},c.prototype.replaceH264ProfileId=function(a,c){b.isStringNotEmpty(a,"offerSdp"),b.isStringNotEmpty(c,"newProfileId");var d=this.getH264ProfileId(a);return d?a.replace("profile-level-id="+d,"profile-level-id="+c):a},new c}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(5),c(6),c(3),c(2),c(13),c(9),c(7)],e=function(a,b,c,d,e,f,g,h,i){"use strict";function j(b,d,e,f,g){this._logger=g,this._streamId=b,this._playlistUri=encodeURI(d).replace(/[#]/g,"%23"),this._bufferSizeHistory=[],this._streamTelemetry=e,this._options=f,this._element=null,this._dimensionsChangedMonitor=new h(g),this._lastProgress={time:0,buffered:null,averageLength:0,count:0,setupRetry:0,lastCurrentTime:0,lastCurrentTimeOccurenceTimestamp:0},this._namedEvents=new c.NamedEvents,this._onStalled=a.bind(n,this),this._onProgress=a.bind(m,this),this._onEnded=a.bind(o,this),this._onError=a.bind(l,this),this._onWaiting=a.bind(p,this)}function k(b){f.attachUriStream(b,this._playlistUri),this._options.receiveAudio===!1&&(b.muted=!0),a.addEventListener(b,"error",this._onError,!0),a.addEventListener(b,"stalled",this._onStalled,!1),a.addEventListener(b,"pause",this._onStalled,!1),a.addEventListener(b,"suspend",this._onStalled,!1),a.addEventListener(b,"progress",this._onProgress,!1),a.addEventListener(b,"ended",this._onEnded,!1),a.addEventListener(b,"waiting",this._onWaiting,!1),this._element=b,this._dimensionsChangedMonitor.start(this,this._element)}function l(b){var c=this,d=A*c._lastProgress.setupRetry*c._lastProgress.setupRetry,e=0===c._lastProgress.count,f=c._lastProgress.setupRetry<=y;return 4===a.get(this._element,["error","code"])&&e&&f?setTimeout(function(){c._lastProgress.setupRetry++,s.call(c)},Math.max(d,A)):void this._namedEvents.fire(i.rendererEvents.error.name,["player",b])}function m(){if(this._lastProgress.time=a.now(),0===this._element.buffered.length)return this._logger.debug("[%s] Hls stream progress event fired without any buffered content",this._streamId);var b=this._element.buffered.end(this._element.buffered.length-1);if(this._lastProgress.buffered!==b){if(null!==this._lastProgress.buffered){var c=this._lastProgress.averageLength*this._lastProgress.count,d=c+(b-this._lastProgress.buffered);this._lastProgress.count+=1,this._lastProgress.averageLength=d/this._lastProgress.count,this._lastProgress.lastCurrentTime!==this._element.currentTime&&(this._lastProgress.lastCurrentTimeOccurenceTimestamp=a.now());var e=this._lastProgress.lastCurrentTimeOccurenceTimestamp&&a.now()-this._lastProgress.lastCurrentTimeOccurenceTimestamp>B;e&&this._element&&!this._element.paused&&q.call(this)&&(this._logger.warn("Reloading stream after current time has not changed for [%s] seconds due to unregistered stall.",B/1e3),r.call(this))}this._lastProgress.buffered=b,this._lastProgress.setupRetry=0,this._lastProgress.lastCurrentTime=this._element.currentTime}}function n(){if(this._logger.info("[%s] Loading Hls stream stalled.",this._streamId),this._lastProgress.setupRetry>y)return this._logger.warn("[%s] Unable to recover from stalled Hls Stream.",this._streamId);var b=this,c=this._element.currentTime;0===this._lastProgress.count?(this._lastProgress.setupRetry++,s.call(b)):(setTimeout(function(){0===b._lastProgress.count&&(b._lastProgress.setupRetry++,s.call(b))},t.call(b)),setTimeout(function(){b._element&&b._element.currentTime===c&&!b._element.paused&&q.call(b)&&(b._logger.warn("Reloading stream after being stalled for [%s] seconds",B/1e3),r.call(b))},B),setTimeout(a.bind(u,b),x))}function o(){this._logger.info("[%s] Hls stream ended",this._streamId),this.stop("ended")}function p(){this._logger.info("Time elapsed since last progress [%s]",a.now()-this._lastProgress.time),setTimeout(a.bind(u,this),t.call(this))}function q(){var b=!this._lastReloadTime||a.now()-this._lastReloadTime>C;return this._element&&!this._waitForLastChunk&&0!==this._element.buffered.length&&b}function r(){q.call(this)&&(this._logger.warn("Reloading unhealthy stream that was active for at least [%s] seconds",C/1e3),this._lastReloadTime=a.now(),s.call(this))}function s(){this._logger.info("[%s] Attempting to reload Hls stream.",this._streamId);try{this._element.setAttribute("src",""),this._element.setAttribute("src",this._playlistUri)}catch(a){this._logger.warn("Error while reloading Hls stream [%s]",a)}}function t(){return 1.5*this._lastProgress.averageLength<2e3?2e3:1.5*this._lastProgress.averageLength}function u(){a.now()-this._lastProgress.time>t.call(this)&&this._waitForLastChunk&&this.stop("ended")}function v(a){if(a){if(clearTimeout(this._backgroundTimeout),this._backgroundTimeout=null,!this._backgroundThrottled)return;return this._backgroundThrottled=!1,void this.start(this._element)}var b=this;this._backgroundTimeout=setTimeout(function(){g.isForeground()||w(b._element)||(b._logger.info("Detecting application [background] with muted video. Pausing playback until application focused again."),b._element.pause(),b._backgroundThrottled=!0)},D)}function w(b){return!b.muted&&(a.get(b,["webkitAudioDecodedByteCount"],0)>0||a.get(b,["audioTracks","length"],0)>0||b.webkitHasAudio)}var x=5e3,y=5,z=6e3,A=250,B=6e3,C=15e3,D=3e3;return j.prototype.on=function(a,b){return this._namedEvents.listen(a,b)},j.prototype.start=function(b){try{var c=a.now()-this._options.originStartTime;this._disposables=new e.DisposableList,this._disposables.add(g.onBackground(a.bind(v,this,!1))),this._disposables.add(g.onForeground(a.bind(v,this,!0))),this._streamTelemetry.recordTimeToFirstFrame(b),this._streamTelemetry.recordRebuffering(b),this._streamTelemetry.recordVideoResolutionChanges(this,b),c<z&&this._options.isDrmProtectedContent?setTimeout(a.bind(k,this,b),z):k.call(this,b)}catch(d){this._logger.error("[%s] Error while loading HLS live stream [%s]",this._streamId,d.code,d),this._namedEvents.fire(i.rendererEvents.error.name,["hls",d])}return b},j.prototype.stop=function(b,c){var d=this;if(!d._waitingForFinalization){if(c)return d._waitForLastChunk=!0;if(this._dimensionsChangedMonitor.stop(),this._streamTelemetry.stop(),this._disposables.dispose(),this._element){var e=function(){d._element&&(a.removeEventListener(d._element,"error",d._onError,!0),a.removeEventListener(d._element,"stalled",d._onStalled,!1),a.removeEventListener(d._element,"pause",d._onStalled,!1),a.removeEventListener(d._element,"suspend",d._onStalled,!1),a.removeEventListener(d._element,"progress",d._onProgress,!1),a.removeEventListener(d._element,"ended",d._onEnded,!1),a.removeEventListener(d._element,"waiting",d._onWaiting,!1),"Safari"===f.browser&&f.browserVersion>=11?d._element.setAttribute("src",""):d._element.src="",d._element=null);var b="";d._namedEvents.fire(i.rendererEvents.ended.name,[b])};try{d._element.pause(),d._logger.info("[%s] HLS live stream has been destroyed",d._streamId),e()}catch(g){d._logger.error("[%s] Error while destroying HLS live stream [%s]",d._streamId,g.code,g),e(),d._namedEvents.fire(i.rendererEvents.error.name,["hls",g])}d._waitingForFinalization=!0}}},j.prototype.getStats=function(){if(!this._element)return{width:0,height:0,currentTime:0,lag:0,networkState:i.networkStates.networkNoSource.id};var b=this._element?this._element.currentTime||0:0,c=this._element&&this._element.buffered&&this._element.buffered.length>0?this._element.buffered.end(this._element.buffered.length-1):0,d=Math.max(0,c-b);this._bufferSizeHistory.push(d),this._bufferSizeHistory.length>15&&this._bufferSizeHistory.shift();for(var e=0,f=0,g=this._bufferSizeHistory.length;f<g;f++)e=Math.max(e,this._bufferSizeHistory[f]);var h=2,j=(a.now()-this._options.originStartTime)/1e3,k=2*h+e,l=j-k;return{width:this._element.videoWidth||this._element.width,height:this._element.videoHeight||this._element.height,currentTime:l,originTime:j,lag:k,networkState:this._element.networkState}},j.prototype.setDataQualityChangedCallback=function(a){b.isFunction(a,"callback"),this.dataQualityChangedCallback=a},j.prototype.getPlayer=function(){return null},j.prototype.addVideoDisplayDimensionsChangedCallback=function(a,b){this._dimensionsChangedMonitor.addVideoDisplayDimensionsChangedCallback(a,b)},j}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(5),c(2),c(93),c(88),c(90),c(7)],e=function(a,b,c,d,e,f,g,h){"use strict";function i(a,b,d,e,f,g,h){this._type=a,this._streamId=b,this._uri=d,this._streamTelemetry=e,this._options=f,this._shaka=g,this._logger=h,this._renderer=null,this._element=null,this._dimensionsChangedMonitor=null,this._namedEvents=new c.NamedEvents}return i.prototype.on=function(a,b){this._namedEvents.listen(a,b)},i.prototype.createRenderer=function(){switch(this._type){case h.types.dash.name:this._shaka?this._renderer=new e(this._streamId,this._uri,this._streamTelemetry,this._options,this._shaka,this._logger):this._renderer=new g(this._streamId,this._uri,this._streamTelemetry,this._options,this._logger);break;case h.types.hls.name:g.isSupported()&&!this._options.useNativeHlsPlayer?this._renderer=new g(this._streamId,this._uri,this._streamTelemetry,this._options,this._logger):this._renderer=new f(this._streamId,this._uri,this._streamTelemetry,this._options,this._logger);break;default:throw new Error("Unsupported Live stream Type "+this._type)}var a=this;return this._renderer.on(h.rendererEvents.error.name,function(b,c){a._namedEvents.fire(h.streamEvents.playerError.name,[b,c])}),this._renderer.on(h.rendererEvents.ended.name,function(b){a._namedEvents.fire(h.streamEvents.playerEnded.name,[b])}),this._renderer},i.prototype.select=function(a){return this._logger.warn("[%s] selection of tracks not supported for [%s] live streams",this._streamId,this._type),this},i.prototype.setStreamEndedCallback=function(a){b.isFunction(a,"callback"),this.streamEndedCallback=a},i.prototype.setStreamErrorCallback=function(a){b.isFunction(a,"callback"),this.streamErrorCallback=a},i.prototype.stop=function(a){this.isActive()&&(this._logger.info("[%s] stop media stream",this._streamId),this._namedEvents.fire(h.streamEvents.stopped.name,[a]),this._isStopped=!0)},i.prototype.monitor=function(a,c){b.isObject(a,"options"),b.isFunction(c,"callback")},i.prototype.getMonitor=function(){return null},i.prototype.getStream=function(){return this._logger.debug("[%s] stream not available for [%s] live streams",this._streamId,this._type),null},i.prototype.isActive=function(){return!this._isStopped},i.prototype.getStreamId=function(){return this._streamId},i.prototype.getStats=function(){return this._logger.debug("[%s] stats not available for [%s] live streams",this._streamId,this._type),null},i.prototype.getRenderer=function(){return this._renderer},i}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(8),c(5),c(6),c(29),c(2),c(9),c(7)],e=function(a,b,c,d,e,f,g,h,i){"use strict";function j(b,c,e,f,g){this._logger=g,this._streamId=b,this._manifestUri=encodeURI(c).replace(/[#]/g,"%23"),this._streamTelemetry=e,this._options=f,this._renderer=null,this._element=null,this._dimensionsChangedMonitor=new h(g),this._lastProgress={time:0,buffered:null,averageLength:0,count:0,lastCurrentTime:0,lastCurrentTimeOccurenceTimestamp:0},this._namedEvents=new d.NamedEvents,this._onStalled=a.bind(q,this),this._onProgress=a.bind(p,this),this._onEnded=a.bind(s,this)}function k(){var b=this,c=a.assign({bandwidthToStartAt:u},b._options);a.isNumber(b._options.targetMinBufferSize)&&(c.targetMinBufferSize=b._options.targetMinBufferSize,c.targetBufferSizeInMS=1e3*b._options.targetMinBufferSize),a.includes(this._manifestUri,".mpd")&&b._options.isDrmProtectedContent&&(c.drm={"com.widevine.alpha":{serverCertificateUrl:b._options.widevineServiceCertificateUrl,mediaKeySystemConfiguration:{persistentState:"required"}},"com.microsoft.playready":{licenseServerUrl:b._options.playreadyLicenseUrl}});var d=new f.WebPlayer(this._throttledLogger,this._element,c),e=a.now()-this._options.originStartTime;e<x&&this._options.isDrmProtectedContent&&a.includes(this._manifestUri,".m3u8")?setTimeout(a.bind(d.start,d,b._manifestUri),x):d.start(b._manifestUri),b._player=d,a.addEventListener(b._player,"error",a.bind(l,b))}function l(a){return o.call(this)&&a&&(3===a.code||a.severity===f.errors.severity.RECOVERABLE)?n.call(this):void this._namedEvents.fire(i.rendererEvents.error.name,["phenix-player",a])}function m(){this._player.dispose(),this._player=null,this.start(this._element)}function n(){o.call(this)&&(this._logger.warn("Reloading unhealthy stream that was active for at least [%s] seconds",w/1e3),this._lastReloadTime=a.now(),m.call(this))}function o(){var b=!this._lastReloadTime||a.now()-this._lastReloadTime>w;return this._element&&!this._waitForLastChunk&&this._player&&0!==this._element.buffered.length&&b}function p(){if(this._lastProgress.time=a.now(),0===this._element.buffered.length)return this._logger.debug("[%s] Phenix live stream player progress event fired without any buffered content",this._streamId);var b=this._element.buffered.end(this._element.buffered.length-1);if(this._lastProgress.buffered!==b){if(null!==this._lastProgress.buffered){var c=this._lastProgress.averageLength*this._lastProgress.count,d=c+(b-this._lastProgress.buffered);this._lastProgress.count+=1,this._lastProgress.averageLength=d/this._lastProgress.count,this._lastProgress.lastCurrentTime!==this._element.currentTime&&(this._lastProgress.lastCurrentTimeOccurenceTimestamp=a.now());var e=this._lastProgress.lastCurrentTimeOccurenceTimestamp&&a.now()-this._lastProgress.lastCurrentTimeOccurenceTimestamp>v;e&&this._element&&!this._element.paused&&o.call(this)&&(this._logger.warn("Reloading stream after current time has not changed for [%s] seconds due to unregistered stall.",v/1e3),n.call(this))}this._lastProgress.buffered=b,this._lastProgress.lastCurrentTime=this._element.currentTime}}function q(b){var c=this;if(c._logger.info("[%s] Loading Phenix Live stream player stalled caused by [%s] event.",c._streamId,b.type),0!==c._lastProgress.time){var d=c._element.currentTime;setTimeout(function(){a.now()-c._lastProgress.time>r.call(c)&&c._waitForLastChunk&&c.stop("ended")},r.call(c)),setTimeout(function(){c._element&&c._element.currentTime===d&&!c._element.paused&&o.call(c)&&(c._logger.warn("Reloading stream after being stalled for [%s] seconds",v/1e3),n.call(c))},v)}}function r(){return 1.5*this._lastProgress.averageLength<2e3?2e3:1.5*this._lastProgress.averageLength}function s(){this._logger.info("[%s] Phenix live stream player ended.",this._streamId)}function t(b){var d=b.getAppenders(),e=new c.Logger;return a.forEach(d,function(a){a instanceof c.ConsoleAppender&&(a=new c.ConsoleAppender,a.setThreshold(c.level.INFO)),e.addAppender(a)}),e.setUserId(b.getUserId()),e.setEnvironment(b.getEnvironment()),e.setApplicationVersion(b.getApplicationVersion()),e.setObservableSessionId(b.getObservableSessionId()),e}var u=3e6,v=6e3,w=15e3,x=6e3;return j.isSupported=function(){return f.isSupported},j.prototype.on=function(a,b){return this._namedEvents.listen(a,b)},j.prototype.start=function(b){var c=this,d=t(this._logger);return this._throttledLogger=d,this._element=b,this._streamTelemetry.recordTimeToFirstFrame(b),this._streamTelemetry.recordRebuffering(b),this._streamTelemetry.recordVideoResolutionChanges(this,b),this._streamTelemetry.recordVideoPlayingAndPausing(b),k.call(c),c._options.receiveAudio===!1&&(b.muted=!0),a.addEventListener(b,"stalled",c._onStalled,!1),a.addEventListener(b,"pause",c._onStalled,!1),a.addEventListener(b,"suspend",c._onStalled,!1),a.addEventListener(b,"progress",c._onProgress,!1),a.addEventListener(b,"ended",c._onEnded,!1),c._dimensionsChangedMonitor.start(this,b),b},j.prototype.stop=function(b,c){var d=this;if(!d._waitingForFinalization){if(c)return d._waitForLastChunk=!0;if(this._dimensionsChangedMonitor.stop(),this._streamTelemetry.stop(),this._player){var e=function(){var b="";d._element&&(a.removeEventListener(d._element,"stalled",d._onStalled,!1),a.removeEventListener(d._element,"pause",d._onStalled,!1),a.removeEventListener(d._element,"suspend",d._onStalled,!1),a.removeEventListener(d._element,"progress",d._onProgress,!1),a.removeEventListener(d._element,"ended",d._onEnded,!1),"Edge"===g.browser&&(d._element.src="")),d._namedEvents.fire(i.rendererEvents.ended.name,[b]),d._player=null,d._element=null};d._waitingForFinalization=!0;try{d._player.dispose(),d._logger.info("[%s] Phenix live stream has been destroyed",d._streamId),e()}catch(f){d._logger.error("[%s] Error while destroying Phenix live stream player [%s]",d._streamId,f.code,f),e(),d._namedEvents.fire(i.rendererEvents.error.name,["phenix-player",f])}}}},j.prototype.getStats=function(){if(!this._player)return{width:0,height:0,currentTime:0,lag:0,networkState:i.networkStates.networkNoSource.id};var b=this._player.getStats(),c=b.currentTime||this._element.currentTime,d=(a.now()-this._options.originStartTime)/1e3;return b.isNative&&"Hls"===b.deliveryType&&(b.currentTime=d-b.lag),b.isNative||(b.lag=Math.max(0,d-c)),b.estimatedBandwidth>0?b.networkState=i.networkStates.networkLoading.id:b.playTime>0?b.networkState=i.networkStates.networkIdle.id:b.video?b.networkState=i.networkStates.networkEmpty.id:b.networkState=i.networkStates.networkNoSource.id,b},j.prototype.setDataQualityChangedCallback=function(a){b.isFunction(a,"callback"),this.dataQualityChangedCallback=a},j.prototype.getPlayer=function(){return this._player},j.prototype.addVideoDisplayDimensionsChangedCallback=function(a,b){this._dimensionsChangedMonitor.addVideoDisplayDimensionsChangedCallback(a,b)},j}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(5),c(6),c(2),c(9),c(7)],e=function(a,b,c,d,e,f,g){"use strict";function h(b,d,e,g,h){this._logger=h,this._streamId=b,this._streamSrc=d,this._streamTelemetry=e,this._options=g,this._renderer=null,this._element=null,this._dimensionsChangedMonitor=new f(h),this._namedEvents=new c.NamedEvents,this._onStalled=a.bind(i,this),this._onEnded=a.bind(j,this)}function i(a){this._logger.info("[%s] Loading Phenix Real-Time stream player stalled caused by [%s] event.",this._streamId,a.type)}function j(){this._logger.info("[%s] Phenix Real-Time stream ended.",this._streamId)}return h.prototype.on=function(a,b){return this._namedEvents.listen(a,b)},h.prototype.start=function(b){var c=!!a.find(this._streamSrc.getTracks(),function(a){return"audio"===a.kind});return this._options.canPlaybackAudio||(this._options.disableAudioIfNoOutputFound&&this._options.forcedAudioDisabled?this._logger.warn("[%s] Missing audio playback device. Audio has been disabled on stream. Try setting up an audio device and re-subscribe in order to receive audio.",this._streamId):!this._options.disableAudioIfNoOutputFound&&c&&this._logger.warn("[%s] Missing audio playback device. May experience audio and/or video failure. Try setting up an audio device OR pass the [disableAudioIfNoOutputFound] option when subscribing to disable audio playback when no devices are attached.",this._streamId)),this._element=e.attachMediaStream(b,this._streamSrc),this._streamTelemetry.recordTimeToFirstFrame(b),this._streamTelemetry.recordRebuffering(b),this._streamTelemetry.recordVideoResolutionChanges(this,b),this._streamTelemetry.recordVideoPlayingAndPausing(b),this._options.receiveAudio===!1&&(b.muted=!0),a.addEventListener(b,"stalled",this._onStalled,!1),a.addEventListener(b,"pause",this._onStalled,!1),a.addEventListener(b,"suspend",this._onStalled,!1),a.addEventListener(b,"ended",this._onEnded,!1),this._dimensionsChangedMonitor.start(this,b),b},h.prototype.stop=function(b){this._dimensionsChangedMonitor.stop(),this._streamTelemetry.stop(),this._element&&(a.removeEventListener(this._element,"stalled",this._onStalled,!1),a.removeEventListener(this._element,"pause",this._onStalled,!1),a.removeEventListener(this._element,"suspend",this._onStalled,!1),a.removeEventListener(this._element,"ended",this._onEnded,!1),"function"==typeof this._element.pause&&this._element.pause(),"Edge"===e.browser&&(this._element.src=""),this._element.src&&"IE"===e.browser?this._element.src=null:this._element.src&&(this._element.src=""),this._element.srcObject&&(this._element.srcObject=null),this._element=null),this._logger.info("[%s] Phenix real-time renderer has been destroyed",this._streamId),this._namedEvents.fire(g.rendererEvents.ended.name,[b])},h.prototype.getStats=function(){if(!this._element)return{width:0,height:0,currentTime:0,lag:0,networkState:g.networkStates.networkNoSource.id};var b=(a.now()-this._options.originStartTime)/1e3,c=this._options.networkLag/1e3;return{width:this._element.videoWidth||this._element.width,height:this._element.videoHeight||this._element.height,currentTime:b,lag:c,networkState:this._element.networkState}},h.prototype.setDataQualityChangedCallback=function(a){b.isFunction(a,"callback"),this.dataQualityChangedCallback=a},h.prototype.addVideoDisplayDimensionsChangedCallback=function(a,b){this._dimensionsChangedMonitor.addVideoDisplayDimensionsChangedCallback(a,b)},h}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(5),c(2),c(42),c(43),c(91),c(7)],e=function(a,b,c,d,e,f,g,h){"use strict";function i(b,d,e,f,g,h){this._streamId=b,this._streamSrc=d,this._peerConnection=e,this._streamTelemetry=f,this._options=g,this._logger=h,this._renderer=null,this._element=null,this._dimensionsChangedMonitor=null,this._namedEvents=new c.NamedEvents,this._childrenStreams=[],a.addEventListener(e,"iceconnectionstatechange",a.bind(m,this))}function j(b){return a.reduce(b.getTracks(),function(a,b){return a&&k(b)},!0)}function k(a){return b.isObject(a,"track"),"ended"===a.readyState}function l(b){b&&a.isFunction(b.stop,"stream.stop")&&b.stop(),a.forEach(b&&b.getTracks?b.getTracks():[],function(a){a.stop()})}function m(){var b=this;switch(this._peerConnection.iceConnectionState){case"checking":case"connecting":if(a.isNumber(this._connectionSuccessTimeout))return;this._connectionStart=a.now(),this._connectionSuccessTimeout=setTimeout(function(){b._logger.warn("[%s] Stream has not connected withing [%s] ms.",b._streamId,n),b._namedEvents.fire(h.streamEvents.playerError.name,["real-time",new Error("connection-timeout")])},n);break;case"connected":a.isNumber(this._connectionSuccessTimeout)&&(clearTimeout(this._connectionSuccessTimeout),this._connectionSuccessTimeout=null),this._logger.info("[%s] Ice Connection completed after [%s] ms",this._streamId,a.now()-this._connectionStart),this._connectionStart=null}}var n=5e3;return i.prototype.on=function(a,b){this._namedEvents.listen(a,b)},i.prototype.createRenderer=function(){var a=this;return this._renderer=new g(this._streamId,this._streamSrc,this._streamTelemetry,this._options,this._logger),this._renderer.on(h.rendererEvents.error.name,function(b,c){a._namedEvents.fire(h.streamEvents.playerError.name,[b,c])}),this._renderer.on(h.rendererEvents.ended.name,function(b){a._namedEvents.fire(h.streamEvents.playerEnded.name,[b])}),this._renderer},i.prototype.select=function(a){b.isFunction(a,"trackSelectCallback"),b.isFunction(d.global.MediaStream,"rtc.global.MediaStream");for(var c=this._streamSrc.getTracks(),e=new d.global.MediaStream,f=0;f<c.length;f++)a(c[f],f)&&e.addTrack(c[f]);if(0===e.getTracks().length)return this._logger.warn("No tracks selected");var g=this,k=new i(this._streamId,e,this._peerConnection,this._streamTelemetry,this._options,this._logger);return k.on(h.streamEvents.stopped.name,function(a){j(g._streamSrc)&&g._namedEvents.fire(h.streamEvents.stopped.name,[a])}),this._childrenStreams.push(k),k},i.prototype.setStreamEndedCallback=function(a){b.isFunction(a,"callback"),this._streamEndedCallback=a},i.prototype.setStreamErrorCallback=function(a){b.isFunction(a,"callback"),this._streamErrorCallback=a},i.prototype.streamEndedCallback=function(b,c,d){a.forEach(this._childrenStreams,function(a){a.streamEndedCallback(c,d)}),a.isFunction(this._streamEndedCallback)&&this._streamEndedCallback(this,c,d)},i.prototype.streamErrorCallback=function(b,c,d){
a.forEach(this._childrenStreams,function(a){a.streamErrorCallback(c,d)}),a.isFunction(this._streamErrorCallback)&&this._streamErrorCallback(b,c,d)},i.prototype.stop=function(a){this.isActive()&&(l(this._streamSrc),this._logger.info("[%s] stop media stream",this._streamId),this._namedEvents.fire(h.streamEvents.stopped.name,[a]),this._isStopped=!0)},i.prototype.monitor=function o(a,c){b.isObject(a,"options"),b.isFunction(c,"callback");var d=this,o=new f(d._streamId,d._peerConnection,d._logger);return a.direction="inbound",o.start(a,function(){return d.isActive()},function(a,b){return a&&d._logger.warn("[%s] Media stream monitor triggered unrecoverable error [%s]",a),d._logger.warn("[%s] Media stream triggered monitor condition for [%s]",d._streamId,b.type),c(d,"client-side-failure",b)}),this._monitor=o,o},i.prototype.getMonitor=function(){return this._monitor},i.prototype.getStream=function(){return this._streamSrc},i.prototype.isActive=function(){return!this._isStopped&&!j(this._streamSrc)},i.prototype.getStreamId=function(){return this._streamId},i.prototype.getStats=function(a){b.isFunction(a,"callback"),this._lastStats||(this._lastStats={});var c=this;return d.getStats(this._peerConnection,null,function(b){a(e.convertPeerConnectionStats(b,c._lastStats))})},i.prototype.getRenderer=function(){return this._renderer},i}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(5),c(6),c(2),c(9),c(7)],e=function(a,b,c,d,e,f,g){"use strict";function h(b,d,e,g,h,k){this._logger=k,this._streamId=b,this._manifestUri=encodeURI(d).replace(/[#]/g,"%23"),this._streamTelemetry=e,this._options=g,this._renderer=null,this._element=null,this._dimensionsChangedMonitor=new f(k),this._lastProgress={time:0,buffered:null,averageLength:0,count:0},this._namedEvents=new c.NamedEvents,this._shaka=h,this._onStalled=a.bind(j,this),this._onProgress=a.bind(i,this),this._onEnded=a.bind(l,this)}function i(){if(this._lastProgress.time=a.now(),0===this._element.buffered.length)return this._logger.debug("[%s] Shaka live stream player progress event fired without any buffered content",this._streamId);var b=this._element.buffered.end(this._element.buffered.length-1);if(this._lastProgress.buffered!==b){if(null!==this._lastProgress.buffered){var c=this._lastProgress.averageLength*this._lastProgress.count,d=c+(b-this._lastProgress.buffered);this._lastProgress.count+=1,this._lastProgress.averageLength=d/this._lastProgress.count}this._lastProgress.buffered=b}}function j(){var b=this;b._logger.info("[%s] Loading Shaka live stream player stream stalled.",b._streamId),0!==b._lastProgress.time&&setTimeout(function(){a.now()-b._lastProgress.time>k.call(b)&&b._waitForLastChunk&&b.stop("ended")},k.call(b))}function k(){return 1.5*this._lastProgress.averageLength<2e3?2e3:1.5*this._lastProgress.averageLength}function l(){this._logger.info("[%s] Shaka live stream player ended.",this._streamId)}function m(){var b;if(!a.isFunction(Uint8Array))throw b="Uint8Array support required for DRM",this._logger.error(b),new Error(b);if(!a.isFunction(e.global.atob))throw b="rtc.global.atob support required for DRM",this._logger.error(b),new Error(b)}function n(a){var b=this;a.getNetworkingEngine().registerResponseFilter(function(c,d){if(c.toString()===b._shaka.net.NetworkingEngine.RequestType.LICENSE.toString()){var f=new Uint8Array(d.data),g=String.fromCharCode.apply(null,f),h=JSON.parse(g),i=h.license,j=e.global.atob(i);d.data=new Uint8Array(j.length);for(var k=0;k<j.length;++k)d.data[k]=j.charCodeAt(k);h.trackRestrictions&&a.configure({restrictions:h.trackRestrictions})}})}function o(a,b,c){a.drm||(a.drm={}),a.drm.advanced||(a.drm.advanced={}),a.manifest||(a.manifest={}),a.manifest.dash||(a.manifest.dash={}),p.call(this,a,b,c)}function p(a,b,c){function e(b,d){return b?void c(b):(r=d.data,a.drm.advanced["com.widevine.alpha"]={serverCertificate:q(d.data),persistentStateRequired:!0,distinctiveIdentifierRequired:!1},void c(null,a))}a.manifest.dash.customScheme=function(a){if("com.phenixrts.widevine"===a.getAttribute("schemeIdUri")||"com.phenixp2p.widevine"===a.getAttribute("schemeIdUri"))return[{keySystem:"com.widevine.alpha",licenseServerUri:decodeURIComponent(a.getAttribute("widevineLicenseServerUrl"))}]},r?e(null,r):d.get(b.widevineServiceCertificateUrl,{mimeType:"text/plain; charset=x-user-defined"},e)}function q(a){for(var b=a.length,c=new Uint8Array(b),d=0;d<b;d++)c[d]=a.charCodeAt(d);return c}var r=null,s=2e6;return h.prototype.on=function(a,b){return this._namedEvents.listen(a,b)},h.prototype.start=function(b){function c(c){d._player.configure(c),d._options.receiveAudio===!1&&(b.muted=!0),a.addEventListener(d._player,"error",function(a){d._namedEvents.fire(g.rendererEvents.error.name,["player",a])}),a.addEventListener(b,"stalled",d._onStalled,!1),a.addEventListener(b,"pause",d._onStalled,!1),a.addEventListener(b,"suspend",d._onStalled,!1),a.addEventListener(b,"progress",d._onProgress,!1),a.addEventListener(b,"ended",d._onEnded,!1),d._player.load(d._manifestUri).then(function(){d._logger.info("[%s] DASH live stream has been loaded",d._streamId),a.isFunction(b.play)&&b.play()})["catch"](function(a){d._logger.error("[%s] Error while loading DASH live stream [%s]",d._streamId,a.code,a),d._namedEvents.fire(g.rendererEvents.error.name,["shaka",a])}),d._dimensionsChangedMonitor.start(this,b),d._element=b}var d=this;d._player=new this._shaka.Player(b),d._streamTelemetry.recordTimeToFirstFrame(b),d._streamTelemetry.recordRebuffering(b),d._streamTelemetry.recordVideoResolutionChanges(this,b);var e={abr:{defaultBandwidthEstimate:s},manifest:{retryParameters:{timeout:1e4}},streaming:{rebufferingGoal:2,bufferingGoal:10,bufferBehind:30,retryParameters:{timeout:1e4,maxAttempts:10,backoffFactor:1.1}}};return this._options.isDrmProtectedContent?(m.call(d),n.call(d,d._player),o.call(d,e,d._options,function(a,b){if(a)throw d._logger.error("Failed to add DRM configuration to shaka player",a),a;c(b)})):c(e),b},h.prototype.stop=function(b,c){var d=this;if(!d._waitingForFinalization){if(c)return d._waitForLastChunk=!0;if(this._dimensionsChangedMonitor.stop(),this._streamTelemetry.stop(),this._player){var f=function(){var b="";d._element&&(a.removeEventListener(d._element,"stalled",d._onStalled,!1),a.removeEventListener(d._element,"pause",d._onStalled,!1),a.removeEventListener(d._element,"suspend",d._onStalled,!1),a.removeEventListener(d._element,"progress",d._onProgress,!1),a.removeEventListener(d._element,"ended",d._onEnded,!1),"Edge"===e.browser&&(d._element.src="")),d._namedEvents.fire(g.rendererEvents.ended.name,[b]),d._player=null,d._element=null};d._player.destroy().then(function(){d._logger.info("[%s] Shaka live stream player has been destroyed",d._streamId)}).then(function(){f()})["catch"](function(a){d._logger.error("[%s] Error while destroying shaka live stream player [%s]",d._streamId,a.code,a),f(),d._namedEvents.fire(g.rendererEvents.error.name,["shaka",a])});d._waitingForFinalization=!0}}},h.prototype.getStats=function(){if(!this._player)return{width:0,height:0,currentTime:0,lag:0,networkState:g.networkStates.networkNoSource.id};var b=a.assign(this._player.getStats(),{currentTime:0,lag:0}),c=a.get(this._element,["currentTime"],0),d=(a.now()-this._options.originStartTime)/1e3,e=Math.max(0,d-c);return this._element&&(b.currentTime=c,b.lag=e),b.estimatedBandwidth>0?b.networkState=g.networkStates.networkLoading.id:b.playTime>0?b.networkState=g.networkStates.networkIdle.id:b.video?b.networkState=g.networkStates.networkEmpty.id:b.networkState=g.networkStates.networkNoSource.id,b},h.prototype.setDataQualityChangedCallback=function(a){b.isFunction(a,"callback"),this.dataQualityChangedCallback=a},h.prototype.getPlayer=function(){return this._player},h.prototype.addVideoDisplayDimensionsChangedCallback=function(a,b){this._dimensionsChangedMonitor.addVideoDisplayDimensionsChangedCallback(a,b)},h}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(7)],e=function(a,b,c){"use strict";function d(a,d,f){b.isStringNotEmpty(a,"type"),b.isObject(d,"stream"),b.isObject(f,"logger"),this._type=a,this._stream=d,this._logger=f,this._onPlayerEnd=null;var g=this;this._stream.on(c.streamEvents.playerEnded.name,function(a){return g._logger.info("[%s] [%s] player ended.",g._stream.getStreamId(),g._type),g._playerEnded=!0,g._onPlayerEnd?g._onPlayerEnd():void g.streamEndedCallback(e(a),a)})}function e(a){switch(a){case"":case"none":case"ended":return"ended";case"server-error":case"session-error":case"not-ready":case"error":case"died":return"failed";case"censored":return"censored";case"maintenance":return"maintenance";case"capacity":return"capacity";case"app-background":return"app-background";default:return"custom"}}return d.prototype.on=function(a,b){return this._stream.on(a,b)},d.prototype.streamErrorCallback=function(b,c){a.isFunction(this._stream.streamErrorCallback)?(this._logger.debug("[%s] [%s] live stream error event [%s]",this._stream.getStreamId(),this._type,c),this._stream.streamErrorCallback(this._stream,b,c)):this._logger.error("[%s] [%s] live stream error event [%s]",this._stream.getStreamId(),this._type,c)},d.prototype.streamEndedCallback=function(b,c,d){var e=this._stream.getRenderer();if(!this._isStreamEnded){if(d&&!this._onPlayerEnd&&this._stream.isActive()&&e&&!this._playerEnded)return this._onPlayerEnd=a.bind(this.streamEndedCallback,this,b,c),this._logger.info("[%s] [%s] stream ended. Waiting for end of player.",this._stream.getStreamId(),this._type),void(e&&e.stop(c,d));this._isStreamEnded=!0,a.isFunction(this._stream.streamEndedCallback)&&this._stream.streamEndedCallback(this._stream,b,c),this._stream.stop(),e&&e.stop(c,d)}},d.prototype.dataQualityChangedCallback=function(a,b){var c=this._stream.getRenderer();c&&"function"==typeof c.dataQualityChangedCallback&&c.dataQualityChangedCallback(c,a,b)},d.prototype.getPhenixMediaStream=function(){return this._stream},d}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";var a={errorSeverity:{recoverable:{id:1,name:"RECOVERABLE"},critical:{id:2,name:"CRITICAL"}}};return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(15),c(2),c(37)],e=function(a,b,c,d,e){function f(f){b.isString(f,"uri"),this._loggingUrl="/telemetry/metrics",this._domain="object"==typeof location?location.hostname:d.browser+"-"+d.browserVersion+"-unknown",this._isEnabled=!0,this._browser=(d.browser||"Browser")+"/"+(d.browserVersion||"?"),this._batchHttpProtocol=new c.BatchHttpProto(f+this._loggingUrl,[e],"telemetry.SubmitMetricRecords",{maxAttempts:3,maxBufferedRecords:1e3,maxBatchSize:512}),this._batchHttpProtocol.on("capacity",a.bind(h,this))}function g(b,c){var d=a.assign({},c,{metric:b,timestamp:a.isoString(),sessionId:this._mostRecentSessionId,streamId:this._mostRecentStreamId,source:this._browser,fullQualifiedName:this._domain,environment:this._mostRecentEnvironment,version:this._mostRecentVersion,runtime:this._mostRecentRuntime});this._batchHttpProtocol.addRecord(d)}function h(b){this._batchHttpProtocol.addRecordToBeginning({metric:"MetricDropped",value:{uint64:b},timestamp:a.isoString(),sessionId:this._mostRecentSessionId,streamId:this._mostRecentStreamId,source:this._browser,fullQualifiedName:this._domain,environment:this._mostRecentEnvironment,version:this._mostRecentVersion,runtime:this._mostRecentRuntime})}return f.prototype.isEnabled=function(){return this._isEnabled},f.prototype.setEnabled=function(a){b.isBoolean(a,"enabled"),this._isEnabled=a},f.prototype.submitMetric=function(a,c,d,e,f,h,i){this._isEnabled&&(b.isStringNotEmpty(a,"metric"),b.isObject(i,"value"),this._mostRecentRuntime=c,this._mostRecentSessionId=d,this._mostRecentStreamId=e,this._mostRecentEnvironment=f,this._mostRecentVersion=h,g.call(this,a,i))},f}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(5),c(3),c(2)],e=function(a,b,c,d,e){function f(a){return b.isObject(a,"logger"),this._logger=a,this._namedEvents=new c.NamedEvents,this._disposables=new d.DisposableList,this._disposables.add(this._namedEvents),this.isSupported()?(this._lastNetworkStats=g.call(this),void h.call(this)):this._logger.info("Network monitor is not supported.")}function g(){return{downlinkThroughputCapacity:this.getDownlinkThroughputCapacity(),effectiveType:this.getEffectiveType(),rtt:this.getRoundTripTime()}}function h(){var a=this;navigator.connection.addEventListener("change",function(){a._namedEvents.fireAsync("NetworkChange",[g.call(a),a._lastNetworkStats]),a._lastNetworkStats=g.call(a)})}return f.prototype.isSupported=function(){return e.global.navigator&&e.global.navigator.connection},f.prototype.getDownlinkThroughputCapacity=function(){return this.isSupported()?e.global.navigator.connection.downlink||e.global.navigator.connection.downlinkMax:-1},f.prototype.getEffectiveType=function(){return this.isSupported()?e.global.navigator.connection.effectiveType||e.global.navigator.connection.type:"Unknown"},f.prototype.getRoundTripTime=function(){return this.isSupported()?e.global.navigator.connection.rtt||e.global.navigator.connection.type:-1},f.prototype.onNetworkChange=function(a){if(this.isSupported())return b.isFunction(a,"callback"),this._namedEvents.listen("NetworkChange",a)},f.prototype.dispose=function(){this._disposables.dispose()},f}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(3),c(13),c(97),c(2)],e=function(a,b,c,d,e,f){"use strict";function g(b,f){this._environment=t,this._version=u,this._sessionId=null,this._properties={resource:"Session",kind:"Event"},this._logger=b,this._metricsTransmitter=f,this._networkMonitor=new e(this._logger),this._start=a.now(),this._disposables=new c.DisposableList,this._records=[],this._disposables.add(d.onBackground(a.bind(i,this,!1))),this._disposables.add(d.onForeground(a.bind(i,this,!0))),this._networkMonitor.isSupported()&&(this._disposables.add(this._networkMonitor.onNetworkChange(a.bind(n,this))),this._disposables.add(this._networkMonitor),j.call(this),m.call(this),l.call(this))}function h(){var a=d.isForeground(),b=d.getTimeSinceLastChange(),c=a?"ApplicationForeground":"ApplicationBackground";this.recordMetric(c,{uint64:b}),o.call(this,"Session has started in the [%s] after [%s] ms",a?"foreground":"background",b)}function i(a,b){var c=a?"ApplicationForeground":"ApplicationBackground";this.recordMetric(c,{uint64:b}),o.call(this,"Application has gone into the [%s] after [%s] ms",a?"foreground":"background",b)}function j(){var a=this._networkMonitor.getEffectiveType();this.recordMetric("NetworkType",{string:a},null,{resource:f.browser}),o.call(this,"[%s] has started with Network effective type of [%s]",this._sessionId?"Session":"Application",a)}function k(a,b){var c=a||this._networkMonitor.getEffectiveType(),d=b;this.recordMetric("NetworkType",{string:c},{string:d},{resource:f.browser}),o.call(this,"Network effective type has changed to [%s] from [%s]",c,d||"New")}function l(b,c){var d=b||this._networkMonitor.getRoundTripTime(),e=c||-1;return this.recordMetric("RoundTripTime",{uint32:d},{uint32:e},{resource:f.browser}),a.isNullOrUndefined(c)?o.call(this,"Network RTT [%s]",d):void o.call(this,"Network RTT changed to [%s] from [%s]",d,e)}function m(b,c){var d=b||this._networkMonitor.getDownlinkThroughputCapacity(),e=c||-1;return this.recordMetric("DownlinkThroughputCapacity",{uint64:d},{uint64:e},{resource:f.browser}),a.isNullOrUndefined(c)?o.call(this,"Network downlink throughput capacity [%s]",d):void o.call(this,"Network downlink throughput capacity changed to [%s] from [%s]",d,e)}function n(a,b){b.downlinkThroughputCapacity!==a.downlinkThroughputCapacity&&m.call(this,a.downlinkThroughputCapacity,b.downlinkThroughputCapacity),b.rtt!==a.rtt&&l.call(this,a.rtt,b.rtt),b.effectiveType!==a.effectiveType&&k.call(this,a.effectiveType,b.effectiveType)}function o(){var b=Array.prototype.slice.call(arguments);if(0===b.length)throw new Error("Invalid logging arguments.");var c="[%s] [SessionTelemetry] [%s] ",d=c+b[0],e=b.slice(1),f=[d,this._sessionId,a.now()-this._start].concat(e);this._logger.debug.apply(this._logger,f)}function p(){var b=a.now();return(b-s)/1e3}function q(c,d){if(b.isStringNotEmpty(c.metric,"record.metric"),!this._sessionId)return this._records.push({record:c,since:d});var e=a.assign({},this._properties,c);this._metricsTransmitter.submitMetric(c.metric,d,this._sessionId,null,this._environment,this._version,e)}function r(){if(this._sessionId)for(var a=this,b=this._records.length;b>0;){var c=this._records.splice(b-1,1);1===c.length&&q.call(a,c[0].record,c[0].since),b--}}var s=f.global.__phenixPageLoadTime||f.global.__pageLoadTime||a.now(),t="production",u="2018-04-17T00:14:18Z";return g.prototype.setSessionId=function(a){!a&&this._sessionId&&q.call(this,{metric:"Stopped",elapsed:this.elapsed()},p()),this._sessionId=a,a&&(q.call(this,{metric:"Initialized",elapsed:this.elapsed()},p()),r.call(this),h.call(this),this._networkMonitor.isSupported()&&(j.call(this),m.call(this),l.call(this)))},g.prototype.setProperty=function(a,c){b.isStringNotEmpty(a,"name"),b.isStringNotEmpty(c,"value"),this._properties[a]=c},g.prototype.recordMetric=function(c,d,e,f){b.isStringNotEmpty(c,"metric");var g=a.assign({},{metric:c,elapsed:this.elapsed(),value:d,previousValue:e},f||{});q.call(this,g,p())},g.prototype.elapsed=function(){var b=a.now();return b-this._start},g.prototype.dispose=function(){this._disposables.dispose(),this.recordMetric("Stopped"),o.call(this,"Session telemetry stopped")},g}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(3),c(2)],e=function(a,b,c,d){"use strict";function e(d,e,g){b.isStringNotEmpty(d,"sessionId"),this._environment=j,this._version=k,this._sessionId=d,this._properties={},this._logger=e,this._metricsTransmitter=g,this._start=a.now(),this._disposables=new c.DisposableList,f.call(this,"Stream initializing")}function f(){var b=Array.prototype.slice.call(arguments);if(0===b.length)throw new Error("Invalid logging arguments.");var c="[%s] [StreamTelemetry] [%s] ",d=c+b[0],e=b.slice(1),f=[d,this._streamId,a.now()-this._start].concat(e);this._logger.debug.apply(this._logger,f)}function g(){var b=a.now();return(b-i)/1e3}function h(c,d){b.isStringNotEmpty(c.metric,"record.metric");var e=a.assign({},this._properties,c);this._metricsTransmitter.submitMetric(c.metric,d,this._sessionId,this._streamId,this._environment,this._version,e)}var i=d.global.__phenixPageLoadTime||d.global.__pageLoadTime||a.now(),j="production",k="2018-04-17T00:14:18Z";return e.prototype.setProperty=function(a,c){b.isStringNotEmpty(a,"name"),b.isStringNotEmpty(c,"value"),this._properties[a]=c},e.prototype.recordMetric=function(c,d,e,f){b.isStringNotEmpty(c,"metric");var i=a.assign({},{metric:c,elapsed:this.elapsed(),value:d,previousValue:e},f||{});h.call(this,i,g())},e.prototype.setStreamId=function(c){if(b.isStringNotEmpty(c,"streamId"),this._streamId)throw new Error("Stream ID can only be set once.");this._streamId=c;var d=a.now();h.call(this,{metric:"Initialized",elapsed:this.elapsed()-d+this._start},g()-(d-this._start)/1e3)},e.prototype.setStartOffset=function(a){if(b.isNumber(a,"startOffset"),this._startOffset)throw new Error("Start offset can only be set once.");this._startOffset=a,this.recordMetric("Offset",{uint64:a})},e.prototype.getStartOffset=function(){return this._startOffset},e.prototype.elapsed=function(){var b=a.now();return b-this._start},e.prototype.stop=function(){this._disposables.dispose(),this.recordMetric("Stopped"),f.call(this,"Stream stopped")},e.prototype.recordTimeToFirstFrame=function(b){var d,e=this,g=a.now(),h=function(){d||(d=a.now()-g,e.recordMetric("TimeToFirstFrame",{uint64:d}),f.call(e,"First frame [%s]",d),i.dispose())};a.addEventListener(b,"loadeddata",h);var i=new c.Disposable(function(){a.removeEventListener(b,"loadeddata",h)});this._disposables.add(i)},e.prototype.recordVideoResolutionChanges=function(a,b){var c=this,d={width:b.videoWidth,height:b.videoHeight};a.addVideoDisplayDimensionsChangedCallback(function(a,b){d.width===b.width&&d.height===b.height||(c.recordMetric("ResolutionChanged",{string:b.width+"x"+b.height},{string:d.width+"x"+d.height}),d={width:b.width,height:b.height},f.call(c,"Resolution changed: width [%s] height [%s]",b.width,b.height))})},e.prototype.recordRebuffering=function(b){var e,g,h=this,i=function(){e||(h.recordMetric("Stalled"),e=a.now(),f.call(h,"[buffering] Stream has stalled"))},j=function(c){var i=b.buffered.length,j=!("playing"===c.type||i>0)||("progress"===c.type||"timeupdate"===c.type)&&b.buffered.end(i-1)===g;if(e&&(i||"Edge"===d.browser)&&!j){"progress"===c.type&&(g=b.buffered.end(i-1));var k=a.now()-e;h.recordMetric("Buffering",{uint64:k}),f.call(h,"[buffering] Stream has recovered from stall after [%s] milliseconds",k),e=null}};a.addEventListener(b,"stalled",i),a.addEventListener(b,"pause",i),a.addEventListener(b,"suspend",i),a.addEventListener(b,"play",j),a.addEventListener(b,"playing",j),a.addEventListener(b,"progress",j),a.addEventListener(b,"timeupdate",j),this._disposables.add(new c.Disposable(function(){a.removeEventListener(b,"stalled",i),a.removeEventListener(b,"pause",i),a.removeEventListener(b,"suspend",i),a.removeEventListener(b,"play",j),a.removeEventListener(b,"playing",j),a.removeEventListener(b,"progress",j),a.removeEventListener(b,"timeupdate",j)}))},e.prototype.recordVideoPlayingAndPausing=function(b){var d=this,e=function(){b.paused?d.recordMetric("Playing",{"boolean":!1}):d.recordMetric("Playing",{"boolean":!0})};a.addEventListener(b,"pause",e),a.addEventListener(b,"playing",e),this._disposables.add(new c.Disposable(function(){a.removeEventListener(b,"pause",e),a.removeEventListener(b,"playing",e)}))},e}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(35),c(96)],e=function(a,b,c,d){function e(){this._metricsTransmitters={}}function f(a){var b=new d(a);return a||b.setEnabled(!1),b}var g={urls:{local:"",staging:"https://telemetry-stg.phenixp2p.com",production:"https://telemetry.phenixp2p.com"}};return e.prototype.createMetricsTransmitter=function(a){var b=c.parseEnvFromPcastBaseUri(a||""),d=g.urls[b];return this._metricsTransmitters[b]||(this._metricsTransmitters[b]=f.call(this,d)),this._metricsTransmitters[b]},new e}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1)],e=function(a,b){"use strict";function c(a){b.isObject(a,"options"),a.resolutionSelectionStrategy&&b.isValidType(a.resolutionSelectionStrategy,n,"options.resolutionSelectionStrategy"),a.aspectRatio&&b.isStringNotEmpty(a.aspectRatio,"options.aspectRatio"),a.resolutionHeight&&b.isNumber(a.resolutionHeight,"options.resolutionHeight"),a.frameRate&&b.isNumber(a.frameRate,"options.frameRate"),this._resolutionSelectionStrategy=a.resolutionSelectionStrategy||n.fallbackToLowerThenHigher.name,this._defaultAspectRatio=a.aspectRatio||"16x9",this._defaultResolutionHeight=a.resolutionHeight||720,this._defaultFrameRate=a.frameRate||15}function d(a){return b.isNumber(a,"value"),2*Math.floor((a+1)/2)}function e(b,c){var d,e,f,l,n=g(c,m),o=h(c,m),p=h(b.toString(),n),q=0===p,r=m.length-1===o;if(a.isNumber(p)){if(q)return r?null:(o++,d=i(o,m),e=g(d,m),p=k(this._defaultResolutionHeight,e),f=i(p,n),l=this.calculateWidthByAspectRatio(f,d),{aspectRatio:d,height:parseInt(f),width:parseInt(l)});p--}else if(p=k(b,n),!p)return;return d=i(o,m),e=j(o,m),f=i(p,e),l=e[p][f],{aspectRatio:d,height:parseInt(f),width:parseInt(l)}}function f(b,c){var d,e,f,k,n=g(c,m),o=h(c,m),p=h(b.toString(),n),q=p===n.length-1,r=m.length-1===o;if(a.isNumber(p)){if(q)return r?null:(o++,d=i(o,m),f=this._defaultResolutionHeight,k=this.calculateWidthByAspectRatio(f,d),{aspectRatio:d,height:parseInt(f),width:parseInt(k)});p++}else if(p=l(b,n),!p)return;return d=i(o,m),e=j(o,m),f=i(p,e),k=e[p][f],{aspectRatio:d,height:parseInt(f),width:parseInt(k)}}function g(b,c){var d=a.find(c,function(a){return a.hasOwnProperty(b)});return d?d[b]:null}function h(b,c){return a.findIndex(c,function(a){return a.hasOwnProperty(b)})}function i(b,c){var d=a.keys(c[b]);return d[0]}function j(b,c){var d=a.keys(c[b]);return c[b][d[0]]}function k(b,c){return a.keys(c[0])[0]<b?null:a.reduce(c,function(d,e,f){if(!d)return f;var g=a.keys(c[d])[0],h=a.keys(e)[0];return h<b?d:Math.abs(b-h)<Math.abs(b-g)?f:d})}function l(b,c){return a.keys(c[c.length-1])[0]>b?null:a.reduce(c,function(d,e,f){if(!d)return f;var g=a.keys(c[d])[0],h=a.keys(e)[0];return h>b?d:Math.abs(b-h)<Math.abs(b-g)?f:d})}var m=[{"16x9":[{2160:3840},{1080:1920},{768:1366},{720:1280},{576:1024},{480:853},{360:640},{180:320}]},{"4x3":[{1200:1600},{1080:1440},{720:960},{600:800},{576:768},{480:640},{360:480},{288:352},{240:320},{144:176},{120:160}]}],n={fallbackToLower:{id:0,name:"fallbackToLower"},fallbackToHigher:{id:1,name:"fallbackToHigher"},fallbackToLowerThenHigher:{id:2,name:"fallbackToLowerThenHigher"},exact:{id:3,name:"exact"}};return c.prototype.getDefaultResolution=function(){var a=g(this._defaultAspectRatio,m),b=g(this._defaultResolutionHeight,a)||this.calculateWidthByAspectRatio(this._defaultResolutionHeight,this._defaultAspectRatio);return{height:this._defaultResolutionHeight,width:b,aspectRatio:this._defaultAspectRatio}},c.prototype.getDefaultFrameRate=function(){return this._defaultFrameRate},c.prototype.getNextResolution=function(a,c){switch(b.isNumber(a,"height"),b.isStringNotEmpty(c,"aspectRatio"),this._resolutionSelectionStrategy){case n.fallbackToLower.name:return f.call(this,a,c);case n.fallbackToHigher.name:return e.call(this,a,c);case n.fallbackToLowerThenHigher.name:var d=null;return a>this._defaultResolutionHeight?d=e.call(this,a,c):(d=f.call(this,a,c),d&&d.height||(d=e.call(this,this._defaultResolutionHeight,this._defaultAspectRatio))),d;case n.exact.name:default:return}},c.prototype.canResolveNextResolution=function(){return this._resolutionSelectionStrategy!==n.exact.name},c.prototype.calculateWidthByAspectRatio=function(a,b){switch(b){case"16x9":return d(16/9*a);case"4x3":return d(4/3*a);default:throw new Error("Aspect Ratio not supported")}},c}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(4),c(2)],e=function(a,b,c,d){"use strict";function e(e,h){e=e||{},b.isObject(e,"options"),b.isObject(h,"logger"),this._logger=h,this._screenSharingExtensionId=e.screenSharingExtensionId||s(),this._screenSharingAddOn=e.screenSharingAddOn||u,this._screenSharingEnabled=!1,this._isInitializedObservable=new c.Observable((!1)),"Chrome"===d.browser&&this._screenSharingExtensionId&&j.call(this),g.call(this,a.bind(f,this))}function f(a){this._isInitializedObservable.setValue(!0),this._screenSharingEnabled=a}function g(a){var b=this;if("Chrome"===d.browser&&b._screenSharingExtensionId){var c=r.call(this);if(!c)return a(!1);try{c.sendMessage(b._screenSharingExtensionId,{type:"version"},function(c){c&&"ok"===c.status?(b._logger.info("Screen sharing enabled using version [%s]",c.version),a(!0)):(b._logger.info("Screen sharing NOT available"),a(!1))})}catch(e){e.message&&b._logger.warn(e.message,e),a(!1)}}else a("Firefox"===d.browser&&d.browserVersion>=x?!0:"Firefox"===d.browser&&"object"==typeof d.global.PCastScreenSharing?!0:!1)}function h(a){if(this._isInitializedObservable.getValue())return a();var b=this._isInitializedObservable.subscribe(function(){return b.dispose(),a()})}function i(){return"https://chrome.google.com/webstore/detail/"+this._screenSharingExtensionId}function j(){i.call(this);return}function k(b,c){switch(d.browser){case"Chrome":return l.call(this,function(d,e){return d||e&&"ok"!==e.status?c(d,e):(e.data||e.options||(e.options={canRequestAudioTrack:!0}),e.data&&a.hasIndexOrKey(e.data,"hasAudio")&&!e.options&&(e.options={canRequestAudioTrack:e.data.hasAudio}),void c(null,{status:"ok",constraints:m(b,e.streamId,e.options)}))});case"Firefox":c(null,{status:"ok",constraints:n(b)});break;default:c(new Error("not-supported"),{status:"not-supported"})}}function l(a){var b=this,c=r.call(this);if(!c)return a(new Error("not-available"));try{c.sendMessage(b._screenSharingExtensionId,{type:"get-desktop-media",sources:["screen","window","tab","audio"]},function(c){var d=!c;return d?g.call(b,function(c){return f.call(b,c),a(new Error("extension-failure"))}):"ok"!==c.status?a(new Error(c.status),c):void a(null,c)})}catch(d){d.message&&b._logger.warn(d.message),a(d,{status:"failed"})}}function m(b,c,d){var e={};return a.isObject(b)&&a.isObject(b.screen)&&(e.video=b.screen),a.isObject(b)&&a.isObject(b.screenAudio)&&d.canRequestAudioTrack&&(e.audio=b.screenAudio),b.screen&&a.set(e,["video","mandatory"],{chromeMediaSource:"desktop",chromeMediaSourceId:c}),b.screenAudio&&d.canRequestAudioTrack&&a.set(e,["audio","mandatory"],{chromeMediaSource:"system",chromeMediaSourceId:c}),e}function n(a,b){var c={video:{}};return"object"==typeof a&&"object"==typeof a.screen&&(c.video=a.screen),b&&(c.video.mediaSourceId=b),c.video.mediaSource=c.video.mediaSource||"window",c}function o(a){var b=this;if(!b._screenSharingEnabled){var c=function(c,d){return"cancelled"===d?a(null,{status:"cancelled"}):"ok"!==d?a(new Error("screen-sharing-installation-failed"),{status:d}):void g.call(b,function(c){return b._screenSharingEnabled=c,b._screenSharingEnabled?void a(null,{status:"ok"}):a(new Error("screen-sharing-installation-failed"),{status:d})})};switch(d.browser){case"Chrome":p.call(b,c);break;case"Firefox":q.call(b,c);break;default:a(new Error("not-supported"),{status:"not-supported"})}}}function p(a){var b=this,c=i.call(this);try{chrome.webstore.install(c,function(){return a(null,"ok")},function(c){if(c){if(c.match(/cancelled/gi))return b._logger.info("User cancelled screen sharing"),a(new Error(c),"cancelled");b._logger.warn(c)}return a(new Error(c||"failed"),"failed")})}catch(d){d.message&&b._logger.warn(d.message),a(d,"failed")}}function q(a){try{var b,c={"PCast Screen Sharing":{URL:this._screenSharingAddOn.url,IconURL:this._screenSharingAddOn.iconUrl,Hash:this._screenSharingAddOn.hash,toString:function(){return this.URL}}},e=w,f=function(){b&&clearInterval(b),a(null,"ok")},g=function(){b&&clearInterval(b),a(new Error("failed"),"failed")};b=setInterval(function(){return"object"==typeof d.global.PCastScreenSharing?f():e--<0?g():void 0},v),InstallTrigger.install(c,function(a,b){0===b?f():g()})}catch(h){h.message&&this._logger.warn(h.message),a("failed",h)}}function r(){var a=this;switch(d.browser){case"Chrome":return"undefined"!=typeof chrome&&chrome.runtime&&chrome.runtime.sendMessage?chrome.runtime:(a._logger.info("Screen sharing NOT available. Runtime not supported"),null);case"Firefox":default:return null}}function s(){switch(d.browser){case"Chrome":return t;case"Firefox":default:return""}}var t="icngjadgidcmifnehjcielbmiapkhjpn",u=a.freeze({url:"https://addons.mozilla.org/firefox/downloads/file/474686/pcast_screen_sharing-1.0.3-an+fx.xpi",iconUrl:"https://phenixp2p.com/public/images/phenix-logo-unicolor-64x64.png",hash:"sha256:4972e9718ea7f7c896abc12d1a9e664d5f3efe498539b082ab7694f9d7af4f3b"}),v=100,w=450,x=52;return e.prototype.isScreenSharingEnabled=function(a){var b=this;return h.call(this,function(){return a(b._screenSharingEnabled)})},e.prototype.installExtension=function(b){return h.call(this,a.bind(o,this,b))},e.prototype.getScreenSharingConstraints=function(b,c){return h.call(this,a.bind(k,this,b,c))},e.prototype.toString=function(){return"ScreenShareExtensionManager["+d.browser+"]"},e}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(2)],e=function(a,b,c){"use strict";function d(a,c,d){b.isObject(a,"logger"),b.isObject(c,"screenShareExtensionManager"),d&&b.isFunction(d,"onScreenShare"),this._logger=a,this._screenShareExtensionManager=c,this._onScreenShare=d}function e(a,b){var c=this,d=function(a,d){c._gumStreams&&c._gumStreams.push(d),b(c,a,d)},e=function(d,e,f){a.screenAudio&&c._logger.warn("Screen capture with audio is only supported on Windows or Chrome OS."),b(c,d,e,f)},g=a.screen||a.screenAudio,h=a.video||a.audio;
return g&&h?f.call(c,{screen:a.screen},function(b,g){return f.call(c,{audio:a.audio,video:a.video},function(a,b){i(b,g.getTracks()),d(a,b)},function(a,b,c){l(g),e(a,b,c)})},e):f.call(c,a,d,e)}function f(b,d,e){var f=this,i=function(){e("cancelled",null)},j=function(a){e(n(a),void 0,a)},k=function(a){h.call(f,a),d("ok",a)};return g.call(this,b,function(d,e){if("ok"!==a.get(e,["status"]))return j(d);if("cancelled"===e.status)return i();var g=e.constraints;if(f._onScreenShare&&(b.screen||b.screenAudio)&&"Chrome"===c.browser&&(g=f._onScreenShare(g),!g))throw new Error("onScreenShare must return an object of user media constraints");try{c.getUserMedia(g,k,j)}catch(h){j(h)}})}function g(a,b){var c=this;if(a.screen)return c._screenShareExtensionManager.isScreenSharingEnabled(function(d){return d?c._screenShareExtensionManager.getScreenSharingConstraints(a,b):c._screenShareExtensionManager.installExtension(function(d,e){return d||e&&"ok"!==e.status?b(d,e):c._screenShareExtensionManager.getScreenSharingConstraints(a,b)})});var d={audio:a.audio||!1,video:a.video||!1};b(null,{status:"ok",constraints:d})}function h(b){var d={},e={},f=this;setTimeout(function g(){j(b)||(a.forEach(b.getTracks(),function(g){if(c.global.Event&&a.hasIndexOrKey(d,g.id)&&d[g.id]!==g.enabled){var h=new c.global.Event("trackenabledchange");h.data=g,g.dispatchEvent(h),f._logger.info("[%s] Detected track [%s] enabled change to [%s]",b.id,g.id,g.enabled)}if(c.global.Event&&a.hasIndexOrKey(e,g.id)&&e[g.id]!==g.readyState){var i=new c.global.Event("readystatechange");i.data=g,g.dispatchEvent(i),f._logger.info("[%s] Detected track [%s] Ready State change to [%s]",b.id,g.id,g.readyState)}d[g.id]=g.enabled,e[g.id]=g.readyState}),setTimeout(g,m))},m)}function i(b,c){b&&a.isFunction(b.addTrack)&&a.forEach(c,function(a){b.addTrack(a)})}function j(b){return a.reduce(b.getTracks(),function(a,b){return a&&k(b)},!0)}function k(a){return b.isNotUndefined(a,"track"),"ended"===a.readyState}function l(b){if(b&&a.isFunction(b.stop)&&b.stop(),b&&a.isFunction(b.getTracks))for(var c=b.getTracks(),d=0;d<c.length;d++){var e=c[d];e.stop()}}var m=2e3;d.prototype.getUserMedia=function(a,c){b.isObject(a,"options"),b.isFunction(c,"callback"),e.call(this,a,c)};var n=function(a){var b;return b="unavailable"===a.code?"conflict":"permission-denied"===a.message?"permission-denied":"PermissionDeniedError"===a.name?"permission-denied":"InternalError"===a.name&&"Starting video failed"===a.message?"conflict":"SourceUnavailableError"===a.name?"conflict":"SecurityError"===a.name&&"The operation is insecure."===a.message?"permission-denied":"failed"};return d}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b){},function(a,b,c){"use strict";var d,e;d=[c(2),c(8),c(20),c(23),c(45),c(46),c(24),c(21),c(22),c(47)],e=function(a,b,c,d,e,f,g,h,i,j){return a.global.PhenixPCast=c,{PCast:c,RoomService:d,AudioSpeakerDetector:e,BandwidthMonitor:f,UserMediaResolver:g,logging:b,RTC:a,express:{PCastExpress:h,RoomExpress:i,ChannelExpress:j}}}.apply(b,d),!(void 0!==e&&(a.exports=e))}])});