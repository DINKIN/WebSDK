/**
 * Copyright 2017 PhenixP2P Inc. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
!function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b():"function"==typeof define&&define.amd?define("phenix-web-sdk",[],b):"object"==typeof exports?exports["phenix-web-sdk"]=b():a["phenix-web-sdk"]=b()}(this,function(){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){var d,e;d=[c(1),c(2),c(26),c(38),c(51),c(56),c(58),c(60)],e=function(a,b,c,d,e,f,g,h){return window.PhenixPCast=c,{PCast:c,RoomService:d,AudioSpeakerDetector:e,BandwidthMonitor:f,logging:b,RTC:a,express:{PCastExpress:g,RoomExpress:h}}}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){!function(b,c){a.exports=c()}(this,function(){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){var d,e;d=[c(1),c(7)],e=function(a,b){return a.onLoaded=function(){b(a)},a.onLoaded(),a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(2),c(3),c(4)],e=function(a,b,c){"use strict";var d=new a(navigator.userAgent).detect(),e={RTCPeerConnection:b.RTCPeerConnection,RTCSessionDescription:b.RTCSessionDescription,RTCIceCandidate:b.RTCIceCandidate,getSources:b.getSources,getUserMedia:b.getUserMedia,getStats:b.getStats,attachMediaStream:b.attachMediaStream,reattachMediaStream:b.reattachMediaStream,browser:d.browser,browserVersion:d.version,webrtcSupported:b.webrtcSupported,phenixSupported:!1,isPhenixEnabled:function(){return!1},onLoaded:void 0};if(c.isSupported()){e.phenixSupported=!0;var f=new c,g=function(){e.RTCPeerConnection=f.getRTCPeerConnectionConstructor(),e.RTCSessionDescription=f.getRTCSessionDescriptionConstructor(),e.RTCIceCandidate=f.getRTCIceCandidateConstructor(),e.getSources=f.getSourcesDelegate(),e.getUserMedia=f.getUserMediaDelegate(),e.getStats=f.getStatsDelegate(),Function.prototype.bind?(e.attachMediaStream=f.attachMediaStream.bind(f),e.reattachMediaStream=f.reattachMediaStream.bind(f),e.isPhenixEnabled=f.isEnabled.bind(f)):(e.attachMediaStream=function(){f.attachMediaStream.apply(f,arguments)},e.reattachMediaStream=function(){f.reattachMediaStream.apply(f,arguments)},e.isPhenixEnabled=function(){return f.isEnabled()}),e.webrtcSupported=!0,e.phenixSupported=!0,e.phenixVersion=f.getVersion(),e.onLoaded&&e.onLoaded.call()};f.isEnabled()?g():f.onReady(function(a){a&&(g(),e.onload&&"function"==typeof e.onload&&e.onload())}),f.onLoaded(function(){g()})}else e.phenixSupported=!1;return e.addEventListener=function(a,b,c,d){a.phenixSetEventListener?a.phenixSetEventListener(b,c):a.addEventListener?a.addEventListener(b,c,d===!0):a.attachEvent("on"+b,c)},e.removeEventListener=function(a,b,c,d){a.removeEventListener?a.removeEventListener(b,c,d===!0):a.detachEvent("on"+b,c)},e}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";function a(a){this._userAgent=a}return a.prototype.detect=function(){var a="Unknown",b="?",c=this._userAgent.match(/(Chrome|Chromium|Firefox|Opera|Safari)+\//),d=this._userAgent.match(/(Chrome|Chromium|Firefox|Version)+\/([0-9]+)\./);return c&&c.length>=2?a=c[1]:this._userAgent.match(/^\(?Mozilla/)&&(a="Mozilla",(this._userAgent.match(/MSIE/)||this._userAgent.match(/; Trident\/.*rv:[0-9]+/))&&(a="IE",(d=this._userAgent.match(/MSIE ([0-9]+)/))?(b=parseInt(d[1],10),(d=this._userAgent.match(/MSIE [0-9]+.*MSIE ([0-9]+)/))&&(b=parseInt(d[1],10))):(d=this._userAgent.match(/rv:([0-9]+)/))&&(b=parseInt(d[1],10)))),"Chrome"===a&&this._userAgent.match(/OPR\//)?(a="Opera",d=this._userAgent.match(/(OPR)\/([0-9]+)\./)):"Chrome"===a&&this._userAgent.match(/Edge\//)?(a="Edge",d=this._userAgent.match(/(Edge)\/([0-9]+)\./)):"Firefox"!==a&&"IE"!==a||!this._userAgent.match(/Opera/)||(a="Opera",d=this._userAgent.match(/(Opera) ([0-9]+)\./)),"IE"!==a&&d&&d.length>=3&&(b=parseInt(d[2],10)),{browser:a,version:b}},a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(2)],e=function(a){"use strict";var b=function(){console.log.apply(console,arguments)}||function(){},c=null,d=null,e=null,f=null,g=null,h=null,i=null,j=null,k=null,l=!1,m=function(a){navigator.mediaDevices.enumerateDevices().then(function(b){var c=[];b.forEach(function(a){"audioinput"===a.kind?c.push({kind:"audio",id:a.deviceId,label:a.label}):"videoinput"===a.kind&&c.push({kind:"video",id:a.deviceId,label:a.label})}),a(c)})};navigator.mozGetUserMedia?(b("Firefox detected",navigator.userAgent),c=mozRTCPeerConnection,d=mozRTCSessionDescription,e=mozRTCIceCandidate,g=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?function(a,b,c){navigator.mediaDevices.getUserMedia(a).then(b)["catch"](c)}:navigator.mozGetUserMedia.bind(navigator),h=function(a,b,c){var d=a.getStats(b).then(c);if("rejected"===d.state)throw new Error(d.message)},k=function(b,c,d){var e=null,f=b.split(":");if(0===f[0].indexOf("stun"))e={url:b};else if(0===f[0].indexOf("turn")){var g=new a(navigator.userAgent).detect();if(g.version<27){var h=b.split("?");0===h[1].indexOf("transport=udp")&&(e={url:h[0],credential:d,username:c})}else e={url:b,credential:d,username:c}}return e},i=function(a,c){b("Attaching media stream");var d=a.muted;return a.mozSrcObject=c,a.play(),d===!0&&(a.muted=!0),a},j=function(a,c){b("Reattaching media stream");var d=a.muted;return a.mozSrcObject=c.mozSrcObject,a.play(),d===!0&&(a.muted=!0),a},MediaStream.prototype.getVideoTracks||(MediaStream.prototype.getVideoTracks=function(){return[]}),MediaStream.prototype.getAudioTracks||(MediaStream.prototype.getAudioTracks=function(){return[]}),f=navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?m:MediaStreamTrack.getSources?MediaStreamTrack.getSources.bind(MediaStreamTrack):function(a){setTimeout(function(){a([{kind:"audio",id:"default",label:"",facing:""},{kind:"video",id:"default",label:"",facing:""}])},0)},l=!0):navigator.webkitGetUserMedia?(b("Webkit detected",navigator.userAgent),k=function(a,b,c){var d=null,e=a.split(":");return 0===e[0].indexOf("stun")?d={url:a}:0===e[0].indexOf("turn")&&(d={url:a,credential:c,username:b}),d},c=window.webkitRTCPeerConnection,d=window.RTCSessionDescription,e=window.RTCIceCandidate,g=function(a,c,d){var e=function(a){setTimeout(function(){for(var e=a.getTracks(),f=0;f<e.length;f++){var g=e[f];if(g.onended=function(a){b(a.timeStamp,"Track",g.id,g.label,"ended")},b("Track",g.id,g.label,e[f].kind,"readyState=",e[f].readyState),"ended"===g.readyState){try{var h=new Error("User media not available");h.code="unavailable",d(h)}finally{for(var i=0;i<e.length;i++)e[i].stop()}return}}c(a)},100)};navigator.webkitGetUserMedia(a,e,d)},h=function(a,b,c,d){a.getStats(c,b,d)},i=function(a,c){return"undefined"!=typeof a.srcObject?a.srcObject=c:"undefined"!=typeof a.mozSrcObject?a.mozSrcObject=c:"undefined"!=typeof a.src?a.src=URL.createObjectURL(c):b("Error attaching stream to element."),a.play(),a},j=function(a,b){return a.src=b.src,a},f=navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?m:MediaStreamTrack.getSources.bind(MediaStreamTrack),l=!0):b("Browser does not appear to be WebRTC-capable",navigator.userAgent);var n={RTCPeerConnection:c,RTCSessionDescription:d,RTCIceCandidate:e,getSources:f,getUserMedia:g,getStats:h,attachMediaStream:i,reattachMediaStream:j,webrtcSupported:l};return n.exportGlobal=function(){window.RTCPeerConnection=n.RTCPeerConnection,window.RTCSessionDescription=n.RTCSessionDescription,window.RTCIceCandidate=n.RTCIceCandidate},n}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(5),c(6)],e=function(a,b){"use strict";function c(){var b=this;this._root=e(),this._version="?";var c=function(a){b._loaded=!0,b._enabled=a===!0,b._version=b._phenixRTC.phenixVersion||"?.?.?.?",h(a?"Phenix RTC "+b._version:"No Phenix RTC"),b._onReady&&b._onReady(b._enabled)};try{this._phenixRTC=f(this._root),this._phenixRTC.onunload=function(){b._loaded=!1};var d=new a;d.waitForReady(this._phenixRTC,c)}catch(g){i("Error while loading Phenix RTC"+g),loaded(!1)}}function d(){this._root&&document.getElementById("phenixRTC")!==this._root&&(document.body.appendChild(this._root),this._onLoaded&&this._onLoaded.call(this))}function e(){var a=document.createElement("div");return a.id="phenixRTC",a.style.cssText="visibility:hidden !important;width:0px !important;height:0px !important;margin:0px !important;padding:0px !important;border-style:none !important;border-width:0px !important;max-width:0px !important;max-height:0px !important;outline:none !important",document.body.appendChild(a),a}function f(a){var b=document.createElement("object");return b.type="application/x-phenix-rtc",a.appendChild(b),b}function g(a,c){if(!a)throw new Error("Can not attach a stream to a undefined element");if(a.phenixVersion)return a.src=c,a;var d=new b(a,c);return d.getElement().phenixPresenter=d,d.getElement()}var h=function(){console.log.apply(console,arguments)}||function(){},i=function(){console.error.apply(console,arguments)}||h;return c.prototype.onReady=function(a){var b=this;this._loaded?setTimeout(function(){a(b._enabled)},1):this._onReady=a},c.prototype.onLoaded=function(a){this._onLoaded=a},c.prototype.isLoaded=function(){return this._loaded===!0},c.isSupported=function(){if(navigator.plugins)for(var a=navigator.plugins,b=0;b<a.length;b++)if(a[b].name.indexOf("PhenixRTC")>=0)return!0;if(navigator.userAgent.match(/MSIE/)||navigator.userAgent.match(/Trident/))try{return new ActiveXObject("PhenixP2P.RTC"),!0}catch(c){return!1}return!1},c.prototype.isEnabled=function(){return d.call(this),this._phenixRTC&&void 0!=this._phenixRTC.phenixVersion},c.prototype.getVersion=function(){return d.call(this),this._version},c.prototype.getRTCPeerConnectionConstructor=function(){return d.call(this),this._phenixRTC.RTCPeerConnection},c.prototype.getRTCSessionDescriptionConstructor=function(){return d.call(this),this._phenixRTC.RTCSessionDescription},c.prototype.getRTCIceCandidateConstructor=function(){return d.call(this),this._phenixRTC.RTCIceCandidate},c.prototype.getSourcesDelegate=function(){var a=this;return function(b){return d.call(a),a._phenixRTC.getSources(b)}},c.prototype.getUserMediaDelegate=function(){var a=this;return function(b,c,e){return d.call(a),a._phenixRTC.getUserMedia(b,c,e)}},c.prototype.getStatsDelegate=function(){return function(a,b,c,d){return a.getStats(b,c,d)}},c.prototype.attachMediaStream=function(a,b){return d.call(this),g.call(this,a,b)},c.prototype.reattachMediaStream=function(a,b){return d.call(this),this.attachMediaStream(a,b.src)},c}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(2)],e=function(a){"use strict";function b(a){this._timeout=a||15e3}var c=new a(navigator.userAgent).detect(),d=4,e=function(){console.error.apply(console,arguments)}||log;return b.prototype.waitForReadyWithTimeout=function(a,b,f){var g=!1,h=1,i=h,j=function(a){g||(g=!0,b(a))},k=function l(){a.readyState===d?j(!0):a.phenixVersion?j(!0):(h=Math.min(h+1e3,2*h),i+=h,i>f?(e("Timed out while waiting for <object> to load"),j(!1)):setTimeout(l,h))};a.hasOwnProperty&&a.hasOwnProperty("onload")||"IE"!==c.browser&&e("No means of detecting when <object> is loaded"),a.onload=function(){j(!0)},k()},b.prototype.waitForReady=function(a,b){a.phenixVersion?b(!0):this.waitForReadyWithTimeout(a,b,this._timeout)},b}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(5)],e=function(a){"use strict";function b(b,d){var e=this;this._ghost=b,this._stream=d,this._events={};var f=function(a){e._loaded=!0,e._enabled=a===!0,a?h.call(e):m("Failed to create Phenix video element"),e._onReady&&e._onReady(e._enabled)};try{this._video=c(),this._video.className=this._ghost.className,this._video.height=this._ghost.height,this._video.width=this._ghost.width,this._ghost.style.cssText="visibility:hidden !important;width:0px !important;height:0px !important;margin:0px !important;padding:0px !important;border-style:none !important;border-width:0px !important;max-width:0px !important;max-height:0px !important;outline:none !important",this._video.onunload=function(){e._loaded=!1},j.call(this),document.body&&document.body.contains||l("document.body.contains is not supported"),document.body&&document.body.contains&&document.body.contains(this._ghost)&&this._ghost.parentNode.replaceChild(this._video,this._ghost);var g=new a;g.waitForReady(this._video,f)}catch(i){m("Error while loading Phenix RTC"+i),f(!1)}}function c(){var a=document.createElement("object");return a.type="application/x-phenix-video",a}function d(a,b,c){var d=this._events[a];d||(d=this._events[a]=[],this._loaded&&f.call(this,a)),d.push(b)}function e(a,b,c){var d=this._events[a];if(d){var e=d.indexOf(b);e>=0&&(d=d.splice(e,1),d.length>0?this._events[a]=d:delete this._events[a])}}function f(a){function b(){var b=c._events[a];if(b)for(var d=0;d<b.length;d++)b[d].apply(c,arguments)}var c=this;c._video.phenixSetEventListener(a,b)}function g(a,b){var c;document.createEvent?(c=document.createEvent("HTMLEvents"),c.initEvent(b,!0,!0)):(c=document.createEventObject(),c.eventType=b),c.eventName=b,setTimeout(function(){document.createEvent?a.dispatchEvent(c):a.fireEvent("on"+c.eventType,c)})}function h(){for(var a=Object.keys(this._events),b=0;b<a.length;b++)f.call(this,a[b]);this.hookUpEvents(),i.call(this),this._video.id=this._ghost.id,this._video.style.cssText=this._ghost.cssText,this._video.className=this._ghost.className,this._video.innerHtml=this._ghost.innerHtml,this._video.width=this._ghost.width,this._video.height=this._ghost.height,this._video.autoplay=this._ghost.autoplay,this._video.muted=this._ghost.muted,this._video.defaultMuted=this._ghost.defaultMuted,this._video.volume=this._ghost.volume,this._stream&&(this._video.src=this._stream)}function i(){var a=this,b=["style"];if(window.MutationObserver){var c=new MutationObserver(function(c){c.forEach(function(c){"attributes"===c.type&&c.target===a._ghost&&b.indexOf(c.attributeName)===-1&&(a._video[c.attributeName]=a._ghost[c.attributeName])})}),d={attributes:!0};c.observe(a._ghost,d)}else l("Falling back to use of DOM event listeners. This results in degraded performance for further DOM modifications and does not work for IE prior to version 9. See https://developer.mozilla.org/en-US/docs/Web/Guide/Events/Mutation_events for details."),a._ghost.addEventListener?a._ghost.addEventListener("DOMAttrModified",function(b){a._video[b.target.tagName]=a._ghost[b.target.tagName]},!1):a._ghost.attachEvent("onpropertychange",function(b){a._video[b.target.tagName]=a._ghost[b.target.tagName]})}function j(){var a=this;if(window.MutationObserver){var b=new MutationObserver(function(b){b.forEach(function(b){if("childList"===b.type)for(var c=0;c<b.addedNodes.length;c++){var d=b.addedNodes[c];b.target!==a._video&&(d===a._ghost?(b.target.replaceChild(a._video,a._ghost),h.call(a)):k(b.target,a._ghost)&&(a._ghost.parentNode.replaceChild(a._video,a._ghost),h.call(a)))}})}),c={childList:!0,attributes:!1,characterData:!1,subtree:!0};b.observe(document.body,c)}else l("Falling back to use of DOM event listeners. This results in degraded performance for further DOM modifications and does not work for IE prior to version 9. See https://developer.mozilla.org/en-US/docs/Web/Guide/Events/Mutation_events for details."),d(a._ghost,"DOMNodeInserted",function(b){a._ghost.parentNode.replaceChild(a._video,a._ghost)},!1)}function k(a,b){for(var c=b.parentNode;null!=c;){if(c==a)return!0;c=c.parentNode}return!1}var l=function(){console.log.apply(console,arguments)}||function(){},m=function(){console.error.apply(console,arguments)}||l;return b.prototype.hookUpEvents=function(){var a=this,b=this._ghost;this.addEventListener("error",function(){g(b,"error")}),this.addEventListener("mute",function(){b.muted=a._video.muted,g(b,"mute")}),this.addEventListener("unmute",function(){b.muted=a._video.muted,g(b,"unmute")}),this.addEventListener("ended",function(){b.ended=a._video.ended,g(b,"ended")}),this.addEventListener("loadedmetadata",function(){l("Video loaded metadata",a._video.videoWidth,a._video.videoHeight),b.width=a._video.width,b.height=a._video.height,g(b,"loadedmetadata")}),this.addEventListener("loadeddata",function(){b.width=a._video.width,b.height=a._video.height,g(b,"loadeddata")}),this.addEventListener("resize",function(){b.width=a._video.width,b.height=a._video.height,g(b,"resize")})},b.prototype.onReady=function(a){var b=this;this._loaded?setTimeout(function(){a(b._enabled)},1):this._onReady=a},b.prototype.getElement=function(){return this._video},b.prototype.addEventListener=function(a,b,c){d.call(this,a,b,c)},b.prototype.removeEventListener=function(a,b,c){e.call(this,a,b,c)},b}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";var a=function(a){window.RTCPeerConnection=a.RTCPeerConnection,window.RTCSessionDescription=a.RTCSessionDescription,window.RTCIceCandidate=a.RTCIceCandidate};return a}.apply(b,d),!(void 0!==e&&(a.exports=e))}])})},function(a,b,c){var d,e;d=[c(3),c(7),c(25),c(6)],e=function(a,b,c,d){"use strict";return{createLogger:function(){return new a},ConsoleAppender:c,level:d.level}}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(4),c(5),c(6)],e=function(a,b,c){"use strict";function d(){this._appenders=[],this._userId=null,this._sessionId=null,this._environment=j,this._applicationVersion=k}function e(a){this._sessionId=a,a?this.info("Session started on websdk version [%s] ([%s]), user agent [%s]",k,l,navigator.userAgent):this.info("Websdk version [%s] ([%s]), user agent [%s]",k,l,navigator.userAgent)}function f(b,c){var d=a.now(),e=(d-i)/1e3,f=g(c.level),j=c.name||h,k=this;a.forEach(this._appenders,function(a){try{a.log(e,f,j,m(Array.prototype.slice.call(b)),k._sessionId,k._userId,k._environment,k._applicationVersion,c)}catch(d){}})}function g(a){switch(a){case c.level.TRACE:return"Trace";case c.level.DEBUG:return"Debug";case c.level.INFO:return"Info";case c.level.WARN:return"Warn";case c.level.ERROR:return"Error";case c.level.FATAL:return"Fatal";default:throw new Error("Unsupported Logging Level "+a)}}var h="websdk",i=window.__phenixPageLoadTime||window.__pageLoadTime||a.now(),j="production",k="2017-08-07T16:16:54Z",l="2017.2.15";d.prototype.trace=function(){return f.call(this,arguments,{level:c.level.TRACE})},d.prototype.debug=function(){return f.call(this,arguments,{level:c.level.DEBUG})},d.prototype.info=function(){return f.call(this,arguments,{level:c.level.INFO})},d.prototype.warn=function(){return f.call(this,arguments,{level:c.level.WARN})},d.prototype.error=function(){return f.call(this,arguments,{level:c.level.ERROR})},d.prototype.fatal=function(){return f.call(this,arguments,{level:c.level.FATAL})},d.prototype.addAppender=function(a){b.isObject(a,"appender"),b.isFunction(a.log,"appender.log"),this._appenders.push(a)},d.prototype.getAppenders=function(){return this._appenders},d.prototype.getUserId=function(){return this._userId},d.prototype.setUserId=function(a){this._userId=a},d.prototype.getEnvironment=function(){return this._environment},d.prototype.setEnvironment=function(a){this._environment=a},d.prototype.getApplicationVersion=function(){return this._applicationVersion},d.prototype.setApplicationVersion=function(a){this._applicationVersion=a},d.prototype.getObservableSessionId=function(){return this._observableSessionId},d.prototype.setObservableSessionId=function(c){this._observableSessionId=c,this._sessionIdSubscription&&this._sessionIdSubscription.dispose(),c&&(b.isObject(c,"observableSessionId"),this._sessionIdSubscription=this._observableSessionId.subscribe(a.bind(e,this),{initial:"notify"}))};var m=function(b){if(0!==b.length){var c=[],d=[];return a.forEach(b,function(b){c.push(a.toString(b)),b instanceof Error&&d.push(b.stack)}),n(c.concat(d))}},n=function(a){for(var b=a[0],c=0;b.indexOf&&a.length>1&&c>=0;)if(c=b.indexOf("%",c),c>0){var d=b.substring(c+1,c+2);switch(d){case"%":b=b.substring(0,c)+b.substring(c+1),c++;break;case"s":case"d":a[0]=b=b.substring(0,c)+a[1]+b.substring(c+2),a.splice(1,1);break;default:return a}}return a};return d}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";var a=function(){};a.bind=function(b,c){var d=Array.prototype.slice.call(arguments,2);return function(){if(!a.isFunction(b))throw new TypeError("_.bind - callback must be a function");var e=d.concat(Array.prototype.slice.call(arguments));return b.apply(c,e)}},a.now=function(){return(new Date).getTime()},a.utc=function(b){return a.isNumber(b)?b:Math.floor(b)},a.isoString=function(){var b=new Date;return b.toISOString?b.toISOString():b.getUTCFullYear()+"-"+a.pad(b.getUTCMonth()+1,2)+"-"+a.pad(b.getUTCDate(),2)+"T"+a.pad(b.getUTCHours(),2)+":"+a.pad(b.getUTCMinutes(),2)+":"+a.pad(b.getUTCSeconds(),2)+"."+(b.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"},a.map=function(b,c){if(!a.isObject(b))throw new Error("Collection must be an object or array.");var d=[];return b.constructor===Array?a.forEach(b,function(b,e){a.isString(c)&&a.isObject(b)?d.push(b[c]):a.isFunction(c)&&d.push(c(b,e))}):a.forOwn(b,function(b,e){a.isFunction(c)&&d.push(c(b,e))}),d},a.values=function(b){if(!a.isObject(b)||a.isArray(b))throw new Error("Collection must be an object.");return a.map(b,function(a){return a})},a.keys=function(b){if(!a.isObject(b)||a.isArray(b))throw new Error("Collection must be an object.");return a.map(b,function(a,b){return b})},a.forEach=function(c,d){if(!a.isFunction(d))throw new Error("Callback must be a function");b(c);for(var e=0;e<c.length;e++)d(c[e],e)},a.forOwn=function(b,c){if(!a.isFunction(c))throw new Error("Callback must be a function");if(!a.isObject(b))throw new Error("objectWithProperties must be an object.");for(var d=Object.keys(b),e=0;e<d.length;e++){var f=d[e];b.hasOwnProperty(f)&&c(b[f],f)}},a.assign=function(b,c){var d={};return a.forOwn(b,function(a,b){d[b]=a}),a.forOwn(c,function(a,c){b.hasOwnProperty(c)||(d[c]=a)}),d},a.includes=function(b,c){if(!a.isObject(b))throw new Error("collection type not supported. Collection must be an array or object.");var d=!1,e=function(a){a===c&&(d=!0)};return b.constructor===Array?a.forEach(b,e):a.forOwn(b,e),d},a.reduce=function(b,c,d){if(!a.isObject(b))throw new Error("collection type not supported. Collection must be an array or object.");var e=d||null;return b.constructor===Array?a.forEach(b,function(a){e=c(e,a)}):a.forOwn(b,function(a,b){e=c(e,a,b)}),e},a.sample=function(a){return b(a),a[Math.floor(Math.random()*a.length)]},a.uniqueId=function(){return(a.now()*Math.random()).toString()},a.find=function(c,d,e){b(c);var f;return a.forEach(c,function(a,b){if(d(a)&&b>=(e||0))return f=a}),f},a.findIndex=function(c,d,e){b(c);var f;return a.forEach(c,function(a,b){if(d(a,b)&&b>=(e||0))return f=b}),f},a.filter=function(c,d){b(c);var e=[];return a.forEach(c,function(a){d(a)&&e.push(a)}),e},a.remove=function(c,d){b(c);var e=function(a){return!d(a)};return a.filter(c,e)},a.take=function(a,c){return b(a),a.slice(0,c)},a.hasDifferences=function(b,c,d){return a.findDifferences(b,c,d).length>0},a.findDifferences=function(b,c,d){function e(e,h){g[h]=1,(a.isObject(e)||a.isArray(e))&&d?a.hasIndexOrKey(c,h)&&a.sameTypes(b[h],c[h])?a.hasDifferences(b[h],c[h],d)&&f.push(h):f.push(h):b[h]!==c[h]&&f.push(h)}var f=[],g={};if(a.isArray(b)&&a.isArray(c))b.length>c.length?a.forEach(b,e):a.forEach(c,e);else{if(!a.isObject(b)||!a.isObject(c)||a.isArray(b)||a.isArray(c))throw new Error("Object types do not match");a.forOwn(b,e),a.forOwn(c,function(a,b){g.hasOwnProperty(b)||f.push(b)})}return f},a.hasIndexOrKey=function(b,c){return a.isArray(b)?b.length>parseInt(c):!!a.isObject(b)&&b.hasOwnProperty(c)},a.sameTypes=function(b,c){return a.isNullOrUndefined(b)||a.isNullOrUndefined(c)?a.isNullOrUndefined(b)&&a.isNullOrUndefined(c):a.isArray(b)||a.isArray(c)?a.isArray(b)&&a.isArray(c):typeof b==typeof c},a.freeze=function(a){return"freeze"in Object?Object.freeze(a):a},a.noop=function(){},a.isObject=function(a){return null!==a&&"object"==typeof a},a.isArray=function(b){return!!a.isObject(b)&&b.constructor===Array},a.isString=function(a){return"string"==typeof a},a.isNumber=function(a){return!isNaN(a)&&"number"==typeof a},a.isBoolean=function(a){return"boolean"==typeof a},a.isFunction=function(a){return"function"==typeof a},a.isNullOrUndefined=function(a){return null===a||void 0===a},a.getEnumName=function(b,c){var d=null,e=a.map(b,function(a){return a});return a.isNumber(c)?d=a.find(e,function(a){return a.id===c}):a.isString(c)&&(d=a.find(e,function(a){return a.name.toLowerCase()===c.toLowerCase()})),d?d.name:null},a.toString=function(b){if(a.isString(b))return b;if(a.isBoolean(b))return b?"true":"false";if(a.isNumber(b))return b.toString();var c="";if(b)if(a.isFunction(b.toString))c=b.toString();else if(a.isObject(b.toString))try{c=b.toString()}catch(d){c="[object invalid toString()]"}if(0!==c.indexOf("[object"))return c;var e=[];return c+JSON.stringify(b,function(b,c){if(a.isObject(c)&&!a.isNullOrUndefined(c)){if(a.includes(e,c))return"<recursive>";e.push(c)}return""===b?c:a.toString(c)})},a.pad=function(a,b){c(a),c(b);for(var d=a.toString().length,e=0;e<b-d;e++)a="0"+a.toString();return a.toString()};var b=function(b){if(!a.isArray(b))throw new Error("Array must be an array.")},c=function(b){if(!a.isNumber(b))throw new Error("Number must be a number.")};return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(4)],e=function(a){"use strict";var b=function(){};return b.prototype.isObject=function(b,c){var d='"'+c+'" must be an object';if(!a.isObject(b))throw new Error(d)},b.prototype.isArray=function(b,c){var d='"'+c+'" must be an array';if(!a.isArray(b))throw new Error(d)},b.prototype.isString=function(b,c){var d='"'+c+'" must be a string';if(!a.isString(b))throw new Error(d)},b.prototype.isBoolean=function(b,c){var d='"'+c+'" must be a string';if(!a.isBoolean(b))throw new Error(d)},b.prototype.isNumber=function(b,c){var d='"'+c+'" must be a number';if(!a.isNumber(b))throw new Error(d)},b.prototype.isFunction=function(b,c){var d='"'+c+'" must be a function';if(!a.isFunction(b))throw new Error(d)},b.prototype.stringNotEmpty=function(a,b){var c='"'+b+'" must not be empty';if(this.isString(a,b),""===a)throw new Error(c)},new b}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";var a={level:{TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,FATAL:5}};return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(4),c(8),c(5),c(9)],e=function(a,b,c,d){function e(){this._analytixAppenders={}}function f(a){var b=new d;return a?b.setUri(a):b.setEnabled(!1),b}var g={urls:{local:"",staging:"https://analytix-stg.phenixp2p.com",production:"https://analytix.phenixp2p.com"}};return e.prototype.getAppender=function(a){var c=b.parseEnvFromPcastBaseUri(a||""),d=g.urls[c];return this._analytixAppenders[c]||(this._analytixAppenders[c]=f.call(this,d)),this._analytixAppenders[c]},new e}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";var a={};return a.parseEnvFromPcastBaseUri=function(a){return a=a.toLowerCase(),a.indexOf("local")>-1?"local":a.indexOf("stg")>-1?"staging":"production"},a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(4),c(5),c(10),c(11),c(15),c(24),c(1),c(6)],e=function(a,b,c,d,e,f,g,h){function i(){this._loggingUrl="/analytix/logs",this._domain=location.hostname,this._protocol=new e,this._maxAttempts=3,this._maxBufferedRecords=1e3,this._maxBatchSize=100,this._records=[],this._pending=!1,this._baseUri="",this._minLevel=h.level.TRACE,this._isEnabled=!0,this._networkConnectionMonitor=j.call(this),this._browser=(g.browser||"Browser")+"/"+(g.browserVersion||"?")}function j(){function a(){c._isOffline=!1,m.call(c)}function b(){c._isOffline=!0}var c=this,d=new f(o);return d.start(a,b),d}function k(b,c,d,e,f,g,h,i){var j=e.join(" "),k={level:c,timestamp:a.isoString(),category:d,message:j,source:this._browser,fullQualifiedName:this._domain,sessionId:f,userId:g,environment:h,version:i,runtime:b};this._records.push(k)}function l(b,c,d,e,f){if(this._records.length>this._maxBufferedRecords){var g=this._records.length-this._maxBufferedRecords/2;this._records=this._records.slice(g),this._records.unshift({level:"Warn",timestamp:a.isoString(),category:"websdk/analytixLogger",message:"Deleted "+g+" records",source:this._browser,fullQualifiedName:this._domain,sessionId:c,userId:d,environment:e,version:f,runtime:b})}}function m(){if(!this._pending&&this._baseUri&&this._isEnabled&&!this._isOffline&&0!==this._records.length){var b={records:a.take(this._records,this._maxBatchSize)};this._records=this._records.slice(this._maxBatchSize),this._pending=!0;var c=this;try{n.call(this,this._baseUri+this._loggingUrl,b,function(){setTimeout(function(){c._isOffline&&(c._records=c._records.concat(b.records))},o)})}catch(d){throw this._pending=!1,d}}}function n(a,b,e){function f(a,b){return g._pending=!1,a?("timeout"===a.message&&e(),{status:"error",storedRecords:0}):g._protocol.decode("analytix.StoreLogRecordsResponse",d.fromBinary(b))}var g=this,h=this._protocol.encode("analytix.StoreLogRecords",b).toBinary();c.postWithRetry(a,"protobuf",h,f,this._maxAttempts)}var o=0;return i.prototype.setThreshold=function(a){b.isNumber(a),this._minLevel=a},i.prototype.getThreshold=function(){return this._minLevel},i.prototype.setUri=function(a){b.stringNotEmpty(a,"uri"),this._baseUri=a},i.prototype.isEnabled=function(){return this._isEnabled},i.prototype.setEnabled=function(a){b.isBoolean(a),this._isEnabled=a},i.prototype.log=function(a,c,d,e,f,g,h,i,j){j.level<this._minLevel||(b.isArray(e,"messages"),k.call(this,a,c,d,e,f,g,h,i),l.call(this,a,f,g,h,i),m.call(this))},i}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(4)],e=function(a){"use strict";function b(){this._version="2017-08-07T16:16:54Z"}function c(a,b,c){return a+"?version="+encodeURIComponent(b)+"&_="+c}function d(a,b){var c=new XMLHttpRequest;if("withCredentials"in c)c.open(a,b,!0);else{if("undefined"==typeof XDomainRequest)return;c=new XDomainRequest,c.open(a,b)}return c}function e(){var a=new Error("unsupported");return a.code="unsupported",a}function f(a,b){"protobuf"===b?(a.setRequestHeader("Content-type","application/protobuf"),a.setRequestHeader("Accept","application/protobuf")):(a.setRequestHeader("Content-type","application/json"),a.setRequestHeader("Accept","application/json"))}function g(a,b){if(4===a.readyState)if(200===a.status)b(null,a.responseText);else{var c=new Error(0===a.status?"timeout":a.statusText);c.code=a.status,a.status>=500&&a.status<600&&(c.retryable=!0),b(c)}}return b.prototype.get=function(b,c,f){var h="GET";f=f||{};var i=d(h,b,c);return i?(f.mimeType&&i.overrideMimeType(f.mimeType),i.addEventListener("readystatechange",a.bind(g,this,i,c)),i.timeout=f.timeout||15e3,void i.send()):c(e())},b.prototype.getWithRetry=function h(b,d,e,f){function g(a,c){a?f<e&&a.retryable?h.call(i,b,d,e,f+1):d(a):d(null,c)}a.isNumber(f)||(f=1);var i=this,j=c(b,i._version,a.now());i.get(j,g,{})},b.prototype.post=function(b,c,h,i){var j="POST";i=i||{};var k=d(j,b,h);return k?(f(k,i.dataType),k.addEventListener("readystatechange",a.bind(g,this,k,h)),k.timeout=i.timeout||15e3,void k.send(c)):h(e())},b.prototype.postWithRetry=function i(b,d,e,f,g,h){function j(a,c){a?h<g&&a.retryable?i.call(k,b,d,e,f,g,h+1):f(a):f(null,c)}a.isNumber(h)||(h=1);var k=this,l=c(b,k._version,a.now()),m={};d&&(m.dataType=d),k.post(l,e,j,m)},new b}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;(function(a){!function(f){"use strict";function g(a){function b(a){var b=0;return function(){return b<a.length?a.charCodeAt(b++):null}}function c(){var a=[],b=[];return function(){return 0===arguments.length?b.join("")+g.apply(String,a):(a.length+arguments.length>1024&&(b.push(g.apply(String,a)),
a.length=0),void Array.prototype.push.apply(a,arguments))}}var d=function(a,b,c){if("undefined"==typeof a&&(a=d.DEFAULT_CAPACITY),"undefined"==typeof b&&(b=d.DEFAULT_ENDIAN),"undefined"==typeof c&&(c=d.DEFAULT_NOASSERT),!c){if(a=0|a,a<0)throw RangeError("Illegal capacity");b=!!b,c=!!c}this.buffer=0===a?f:new ArrayBuffer(a),this.view=0===a?null:new DataView(this.buffer),this.offset=0,this.markedOffset=-1,this.limit=a,this.littleEndian="undefined"!=typeof b&&!!b,this.noAssert=!!c};d.VERSION="3.5.5",d.LITTLE_ENDIAN=!0,d.BIG_ENDIAN=!1,d.DEFAULT_CAPACITY=16,d.DEFAULT_ENDIAN=d.BIG_ENDIAN,d.DEFAULT_NOASSERT=!1,d.Long=a||null;var e=d.prototype,f=new ArrayBuffer(0),g=String.fromCharCode;d.allocate=function(a,b,c){return new d(a,b,c)},d.concat=function(a,b,c,e){"boolean"!=typeof b&&"string"==typeof b||(e=c,c=b,b=void 0);for(var f,g=0,h=0,i=a.length;h<i;++h)d.isByteBuffer(a[h])||(a[h]=d.wrap(a[h],b)),f=a[h].limit-a[h].offset,f>0&&(g+=f);if(0===g)return new d(0,c,e);var j,k=new d(g,c,e),l=new Uint8Array(k.buffer);for(h=0;h<i;)j=a[h++],f=j.limit-j.offset,f<=0||(l.set(new Uint8Array(j.buffer).subarray(j.offset,j.limit),k.offset),k.offset+=f);return k.limit=k.offset,k.offset=0,k},d.isByteBuffer=function(a){return(a&&a instanceof d)===!0},d.type=function(){return ArrayBuffer},d.wrap=function(a,b,c,f){if("string"!=typeof b&&(f=c,c=b,b=void 0),"string"==typeof a)switch("undefined"==typeof b&&(b="utf8"),b){case"base64":return d.fromBase64(a,c);case"hex":return d.fromHex(a,c);case"binary":return d.fromBinary(a,c);case"utf8":return d.fromUTF8(a,c);case"debug":return d.fromDebug(a,c);default:throw Error("Unsupported encoding: "+b)}if(null===a||"object"!=typeof a)throw TypeError("Illegal buffer");var g;if(d.isByteBuffer(a))return g=e.clone.call(a),g.markedOffset=-1,g;if(a instanceof Uint8Array)g=new d(0,c,f),a.length>0&&(g.buffer=a.buffer,g.offset=a.byteOffset,g.limit=a.byteOffset+a.length,g.view=a.length>0?new DataView(a.buffer):null);else if(a instanceof ArrayBuffer)g=new d(0,c,f),a.byteLength>0&&(g.buffer=a,g.offset=0,g.limit=a.byteLength,g.view=a.byteLength>0?new DataView(a):null);else{if("[object Array]"!==Object.prototype.toString.call(a))throw TypeError("Illegal buffer");for(g=new d(a.length,c,f),g.limit=a.length,i=0;i<a.length;++i)g.view.setUint8(i,a[i])}return g},e.writeInt8=function(a,b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a|=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}b+=1;var d=this.buffer.byteLength;return b>d&&this.resize((d*=2)>b?d:b),b-=1,this.view.setInt8(b,a),c&&(this.offset+=1),this},e.writeByte=e.writeInt8,e.readInt8=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+1) <= "+this.buffer.byteLength)}var c=this.view.getInt8(a);return b&&(this.offset+=1),c},e.readByte=e.readInt8,e.writeUint8=function(a,b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a>>>=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}b+=1;var d=this.buffer.byteLength;return b>d&&this.resize((d*=2)>b?d:b),b-=1,this.view.setUint8(b,a),c&&(this.offset+=1),this},e.readUint8=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+1) <= "+this.buffer.byteLength)}var c=this.view.getUint8(a);return b&&(this.offset+=1),c},e.writeInt16=function(a,b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a|=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}b+=2;var d=this.buffer.byteLength;return b>d&&this.resize((d*=2)>b?d:b),b-=2,this.view.setInt16(b,a,this.littleEndian),c&&(this.offset+=2),this},e.writeShort=e.writeInt16,e.readInt16=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+2) <= "+this.buffer.byteLength)}var c=this.view.getInt16(a,this.littleEndian);return b&&(this.offset+=2),c},e.readShort=e.readInt16,e.writeUint16=function(a,b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a>>>=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}b+=2;var d=this.buffer.byteLength;return b>d&&this.resize((d*=2)>b?d:b),b-=2,this.view.setUint16(b,a,this.littleEndian),c&&(this.offset+=2),this},e.readUint16=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+2) <= "+this.buffer.byteLength)}var c=this.view.getUint16(a,this.littleEndian);return b&&(this.offset+=2),c},e.writeInt32=function(a,b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a|=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}b+=4;var d=this.buffer.byteLength;return b>d&&this.resize((d*=2)>b?d:b),b-=4,this.view.setInt32(b,a,this.littleEndian),c&&(this.offset+=4),this},e.writeInt=e.writeInt32,e.readInt32=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+4) <= "+this.buffer.byteLength)}var c=this.view.getInt32(a,this.littleEndian);return b&&(this.offset+=4),c},e.readInt=e.readInt32,e.writeUint32=function(a,b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a>>>=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}b+=4;var d=this.buffer.byteLength;return b>d&&this.resize((d*=2)>b?d:b),b-=4,this.view.setUint32(b,a,this.littleEndian),c&&(this.offset+=4),this},e.readUint32=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+4) <= "+this.buffer.byteLength)}var c=this.view.getUint32(a,this.littleEndian);return b&&(this.offset+=4),c},a&&(e.writeInt64=function(b,c){var d="undefined"==typeof c;if(d&&(c=this.offset),!this.noAssert){if("number"==typeof b)b=a.fromNumber(b);else if("string"==typeof b)b=a.fromString(b);else if(!(b&&b instanceof a))throw TypeError("Illegal value: "+b+" (not an integer or Long)");if("number"!=typeof c||c%1!==0)throw TypeError("Illegal offset: "+c+" (not an integer)");if(c>>>=0,c<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}"number"==typeof b?b=a.fromNumber(b):"string"==typeof b&&(b=a.fromString(b)),c+=8;var e=this.buffer.byteLength;return c>e&&this.resize((e*=2)>c?e:c),c-=8,this.littleEndian?(this.view.setInt32(c,b.low,!0),this.view.setInt32(c+4,b.high,!0)):(this.view.setInt32(c,b.high,!1),this.view.setInt32(c+4,b.low,!1)),d&&(this.offset+=8),this},e.writeLong=e.writeInt64,e.readInt64=function(b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+8) <= "+this.buffer.byteLength)}var d=this.littleEndian?new a(this.view.getInt32(b,!0),this.view.getInt32(b+4,!0),(!1)):new a(this.view.getInt32(b+4,!1),this.view.getInt32(b,!1),(!1));return c&&(this.offset+=8),d},e.readLong=e.readInt64,e.writeUint64=function(b,c){var d="undefined"==typeof c;if(d&&(c=this.offset),!this.noAssert){if("number"==typeof b)b=a.fromNumber(b);else if("string"==typeof b)b=a.fromString(b);else if(!(b&&b instanceof a))throw TypeError("Illegal value: "+b+" (not an integer or Long)");if("number"!=typeof c||c%1!==0)throw TypeError("Illegal offset: "+c+" (not an integer)");if(c>>>=0,c<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}"number"==typeof b?b=a.fromNumber(b):"string"==typeof b&&(b=a.fromString(b)),c+=8;var e=this.buffer.byteLength;return c>e&&this.resize((e*=2)>c?e:c),c-=8,this.littleEndian?(this.view.setInt32(c,b.low,!0),this.view.setInt32(c+4,b.high,!0)):(this.view.setInt32(c,b.high,!1),this.view.setInt32(c+4,b.low,!1)),d&&(this.offset+=8),this},e.readUint64=function(b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+8) <= "+this.buffer.byteLength)}var d=this.littleEndian?new a(this.view.getInt32(b,!0),this.view.getInt32(b+4,!0),(!0)):new a(this.view.getInt32(b+4,!1),this.view.getInt32(b,!1),(!0));return c&&(this.offset+=8),d}),e.writeFloat32=function(a,b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a)throw TypeError("Illegal value: "+a+" (not a number)");if("number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}b+=4;var d=this.buffer.byteLength;return b>d&&this.resize((d*=2)>b?d:b),b-=4,this.view.setFloat32(b,a,this.littleEndian),c&&(this.offset+=4),this},e.writeFloat=e.writeFloat32,e.readFloat32=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+4) <= "+this.buffer.byteLength)}var c=this.view.getFloat32(a,this.littleEndian);return b&&(this.offset+=4),c},e.readFloat=e.readFloat32,e.writeFloat64=function(a,b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a)throw TypeError("Illegal value: "+a+" (not a number)");if("number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}b+=8;var d=this.buffer.byteLength;return b>d&&this.resize((d*=2)>b?d:b),b-=8,this.view.setFloat64(b,a,this.littleEndian),c&&(this.offset+=8),this},e.writeDouble=e.writeFloat64,e.readFloat64=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+8) <= "+this.buffer.byteLength)}var c=this.view.getFloat64(a,this.littleEndian);return b&&(this.offset+=8),c},e.readDouble=e.readFloat64,d.MAX_VARINT32_BYTES=5,d.calculateVarint32=function(a){return a>>>=0,a<128?1:a<16384?2:a<1<<21?3:a<1<<28?4:5},d.zigZagEncode32=function(a){return((a|=0)<<1^a>>31)>>>0},d.zigZagDecode32=function(a){return a>>>1^-(1&a)|0},e.writeVarint32=function(a,b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a|=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}var e,f=d.calculateVarint32(a);b+=f;var g=this.buffer.byteLength;return b>g&&this.resize((g*=2)>b?g:b),b-=f,this.view.setUint8(b,e=128|a),a>>>=0,a>=128?(e=a>>7|128,this.view.setUint8(b+1,e),a>=16384?(e=a>>14|128,this.view.setUint8(b+2,e),a>=1<<21?(e=a>>21|128,this.view.setUint8(b+3,e),a>=1<<28?(this.view.setUint8(b+4,a>>28&15),f=5):(this.view.setUint8(b+3,127&e),f=4)):(this.view.setUint8(b+2,127&e),f=3)):(this.view.setUint8(b+1,127&e),f=2)):(this.view.setUint8(b,127&e),f=1),c?(this.offset+=f,this):f},e.writeVarint32ZigZag=function(a,b){return this.writeVarint32(d.zigZagEncode32(a),b)},e.readVarint32=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+1) <= "+this.buffer.byteLength)}var c,d,e=0,f=0;do{if(d=a+e,!this.noAssert&&d>this.limit){var g=Error("Truncated");throw g.truncated=!0,g}c=this.view.getUint8(d),e<5&&(f|=(127&c)<<7*e>>>0),++e}while(128===(128&c));return f=0|f,b?(this.offset+=e,f):{value:f,length:e}},e.readVarint32ZigZag=function(a){var b=this.readVarint32(a);return"object"==typeof b?b.value=d.zigZagDecode32(b.value):b=d.zigZagDecode32(b),b},a&&(d.MAX_VARINT64_BYTES=10,d.calculateVarint64=function(b){"number"==typeof b?b=a.fromNumber(b):"string"==typeof b&&(b=a.fromString(b));var c=b.toInt()>>>0,d=b.shiftRightUnsigned(28).toInt()>>>0,e=b.shiftRightUnsigned(56).toInt()>>>0;return 0==e?0==d?c<16384?c<128?1:2:c<1<<21?3:4:d<16384?d<128?5:6:d<1<<21?7:8:e<128?9:10},d.zigZagEncode64=function(b){return"number"==typeof b?b=a.fromNumber(b,!1):"string"==typeof b?b=a.fromString(b,!1):b.unsigned!==!1&&(b=b.toSigned()),b.shiftLeft(1).xor(b.shiftRight(63)).toUnsigned()},d.zigZagDecode64=function(b){return"number"==typeof b?b=a.fromNumber(b,!1):"string"==typeof b?b=a.fromString(b,!1):b.unsigned!==!1&&(b=b.toSigned()),b.shiftRightUnsigned(1).xor(b.and(a.ONE).toSigned().negate()).toSigned()},e.writeVarint64=function(b,c){var e="undefined"==typeof c;if(e&&(c=this.offset),!this.noAssert){if("number"==typeof b)b=a.fromNumber(b);else if("string"==typeof b)b=a.fromString(b);else if(!(b&&b instanceof a))throw TypeError("Illegal value: "+b+" (not an integer or Long)");if("number"!=typeof c||c%1!==0)throw TypeError("Illegal offset: "+c+" (not an integer)");if(c>>>=0,c<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}"number"==typeof b?b=a.fromNumber(b,!1):"string"==typeof b?b=a.fromString(b,!1):b.unsigned!==!1&&(b=b.toSigned());var f=d.calculateVarint64(b),g=b.toInt()>>>0,h=b.shiftRightUnsigned(28).toInt()>>>0,i=b.shiftRightUnsigned(56).toInt()>>>0;c+=f;var j=this.buffer.byteLength;switch(c>j&&this.resize((j*=2)>c?j:c),c-=f,f){case 10:this.view.setUint8(c+9,i>>>7&1);case 9:this.view.setUint8(c+8,9!==f?128|i:127&i);case 8:this.view.setUint8(c+7,8!==f?h>>>21|128:h>>>21&127);case 7:this.view.setUint8(c+6,7!==f?h>>>14|128:h>>>14&127);case 6:this.view.setUint8(c+5,6!==f?h>>>7|128:h>>>7&127);case 5:this.view.setUint8(c+4,5!==f?128|h:127&h);case 4:this.view.setUint8(c+3,4!==f?g>>>21|128:g>>>21&127);case 3:this.view.setUint8(c+2,3!==f?g>>>14|128:g>>>14&127);case 2:this.view.setUint8(c+1,2!==f?g>>>7|128:g>>>7&127);case 1:this.view.setUint8(c,1!==f?128|g:127&g)}return e?(this.offset+=f,this):f},e.writeVarint64ZigZag=function(a,b){return this.writeVarint64(d.zigZagEncode64(a),b)},e.readVarint64=function(b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+1) <= "+this.buffer.byteLength)}var d=b,e=0,f=0,g=0,h=0;if(h=this.view.getUint8(b++),e=127&h,128&h&&(h=this.view.getUint8(b++),e|=(127&h)<<7,128&h&&(h=this.view.getUint8(b++),e|=(127&h)<<14,128&h&&(h=this.view.getUint8(b++),e|=(127&h)<<21,128&h&&(h=this.view.getUint8(b++),f=127&h,128&h&&(h=this.view.getUint8(b++),f|=(127&h)<<7,128&h&&(h=this.view.getUint8(b++),f|=(127&h)<<14,128&h&&(h=this.view.getUint8(b++),f|=(127&h)<<21,128&h&&(h=this.view.getUint8(b++),g=127&h,128&h&&(h=this.view.getUint8(b++),g|=(127&h)<<7,128&h))))))))))throw Error("Buffer overrun");var i=a.fromBits(e|f<<28,f>>>4|g<<24,!1);return c?(this.offset=b,i):{value:i,length:b-d}},e.readVarint64ZigZag=function(b){var c=this.readVarint64(b);return c&&c.value instanceof a?c.value=d.zigZagDecode64(c.value):c=d.zigZagDecode64(c),c}),e.writeCString=function(a,c){var d="undefined"==typeof c;d&&(c=this.offset);var e,f=a.length;if(!this.noAssert){if("string"!=typeof a)throw TypeError("Illegal str: Not a string");for(e=0;e<f;++e)if(0===a.charCodeAt(e))throw RangeError("Illegal str: Contains NULL-characters");if("number"!=typeof c||c%1!==0)throw TypeError("Illegal offset: "+c+" (not an integer)");if(c>>>=0,c<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}f=j.calculateUTF16asUTF8(b(a))[1],c+=f+1;var g=this.buffer.byteLength;return c>g&&this.resize((g*=2)>c?g:c),c-=f+1,j.encodeUTF16toUTF8(b(a),function(a){this.view.setUint8(c++,a)}.bind(this)),this.view.setUint8(c++,0),d?(this.offset=c,this):f},e.readCString=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+1) <= "+this.buffer.byteLength)}var d,e=a,f=-1;return j.decodeUTF8toUTF16(function(){if(0===f)return null;if(a>=this.limit)throw RangeError("Illegal range: Truncated data, "+a+" < "+this.limit);return 0===(f=this.view.getUint8(a++))?null:f}.bind(this),d=c(),!0),b?(this.offset=a,d()):{string:d(),length:a-e}},e.writeIString=function(a,c){var d="undefined"==typeof c;if(d&&(c=this.offset),!this.noAssert){if("string"!=typeof a)throw TypeError("Illegal str: Not a string");if("number"!=typeof c||c%1!==0)throw TypeError("Illegal offset: "+c+" (not an integer)");if(c>>>=0,c<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}var e,f=c;e=j.calculateUTF16asUTF8(b(a),this.noAssert)[1],c+=4+e;var g=this.buffer.byteLength;if(c>g&&this.resize((g*=2)>c?g:c),c-=4+e,this.view.setUint32(c,e,this.littleEndian),c+=4,j.encodeUTF16toUTF8(b(a),function(a){this.view.setUint8(c++,a)}.bind(this)),c!==f+4+e)throw RangeError("Illegal range: Truncated data, "+c+" == "+(c+4+e));return d?(this.offset=c,this):c-f},e.readIString=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+4) <= "+this.buffer.byteLength)}var d,e=0,f=a;e=this.view.getUint32(a,this.littleEndian),a+=4;var g,h=a+e;return j.decodeUTF8toUTF16(function(){return a<h?this.view.getUint8(a++):null}.bind(this),g=c(),this.noAssert),d=g(),b?(this.offset=a,d):{string:d,length:a-f}},d.METRICS_CHARS="c",d.METRICS_BYTES="b",e.writeUTF8String=function(a,c){var d="undefined"==typeof c;if(d&&(c=this.offset),!this.noAssert){if("number"!=typeof c||c%1!==0)throw TypeError("Illegal offset: "+c+" (not an integer)");if(c>>>=0,c<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}var e,f=c;e=j.calculateUTF16asUTF8(b(a))[1],c+=e;var g=this.buffer.byteLength;return c>g&&this.resize((g*=2)>c?g:c),c-=e,j.encodeUTF16toUTF8(b(a),function(a){this.view.setUint8(c++,a)}.bind(this)),d?(this.offset=c,this):c-f},e.writeString=e.writeUTF8String,d.calculateUTF8Chars=function(a){return j.calculateUTF16asUTF8(b(a))[0]},d.calculateUTF8Bytes=function(a){return j.calculateUTF16asUTF8(b(a))[1]},e.readUTF8String=function(a,b,e){"number"==typeof b&&(e=b,b=void 0);var f="undefined"==typeof e;if(f&&(e=this.offset),"undefined"==typeof b&&(b=d.METRICS_CHARS),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal length: "+a+" (not an integer)");if(a|=0,"number"!=typeof e||e%1!==0)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,e<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}var g,h=0,i=e;if(b===d.METRICS_CHARS){if(g=c(),j.decodeUTF8(function(){return h<a&&e<this.limit?this.view.getUint8(e++):null}.bind(this),function(a){++h,j.UTF8toUTF16(a,g)}.bind(this)),h!==a)throw RangeError("Illegal range: Truncated data, "+h+" == "+a);return f?(this.offset=e,g()):{string:g(),length:e-i}}if(b===d.METRICS_BYTES){if(!this.noAssert){if("number"!=typeof e||e%1!==0)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,e<0||e+a>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+"+a+") <= "+this.buffer.byteLength)}var k=e+a;if(j.decodeUTF8toUTF16(function(){return e<k?this.view.getUint8(e++):null}.bind(this),g=c(),this.noAssert),e!==k)throw RangeError("Illegal range: Truncated data, "+e+" == "+k);return f?(this.offset=e,g()):{string:g(),length:e-i}}throw TypeError("Unsupported metrics: "+b)},e.readString=e.readUTF8String,e.writeVString=function(a,c){var e="undefined"==typeof c;if(e&&(c=this.offset),!this.noAssert){if("string"!=typeof a)throw TypeError("Illegal str: Not a string");if("number"!=typeof c||c%1!==0)throw TypeError("Illegal offset: "+c+" (not an integer)");if(c>>>=0,c<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}var f,g,h=c;f=j.calculateUTF16asUTF8(b(a),this.noAssert)[1],g=d.calculateVarint32(f),c+=g+f;var i=this.buffer.byteLength;if(c>i&&this.resize((i*=2)>c?i:c),c-=g+f,c+=this.writeVarint32(f,c),j.encodeUTF16toUTF8(b(a),function(a){this.view.setUint8(c++,a)}.bind(this)),c!==h+f+g)throw RangeError("Illegal range: Truncated data, "+c+" == "+(c+f+g));return e?(this.offset=c,this):c-h},e.readVString=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+1) <= "+this.buffer.byteLength)}var d,e=this.readVarint32(a),f=a;a+=e.length,e=e.value;var g=a+e,h=c();return j.decodeUTF8toUTF16(function(){return a<g?this.view.getUint8(a++):null}.bind(this),h,this.noAssert),d=h(),b?(this.offset=a,d):{string:d,length:a-f}},e.append=function(a,b,c){"number"!=typeof b&&"string"==typeof b||(c=b,b=void 0);var e="undefined"==typeof c;if(e&&(c=this.offset),!this.noAssert){if("number"!=typeof c||c%1!==0)throw TypeError("Illegal offset: "+c+" (not an integer)");if(c>>>=0,c<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}a instanceof d||(a=d.wrap(a,b));var f=a.limit-a.offset;if(f<=0)return this;c+=f;var g=this.buffer.byteLength;return c>g&&this.resize((g*=2)>c?g:c),c-=f,new Uint8Array(this.buffer,c).set(new Uint8Array(a.buffer).subarray(a.offset,a.limit)),a.offset+=f,e&&(this.offset+=f),this},e.appendTo=function(a,b){return a.append(this,b),this},e.assert=function(a){return this.noAssert=!a,this},e.capacity=function(){return this.buffer.byteLength},e.clear=function(){return this.offset=0,this.limit=this.buffer.byteLength,this.markedOffset=-1,this},e.clone=function(a){var b=new d(0,this.littleEndian,this.noAssert);if(a){var c=new ArrayBuffer(this.buffer.byteLength);new Uint8Array(c).set(this.buffer),b.buffer=c,b.view=new DataView(c)}else b.buffer=this.buffer,b.view=this.view;return b.offset=this.offset,b.markedOffset=this.markedOffset,b.limit=this.limit,b},e.compact=function(a,b){if("undefined"==typeof a&&(a=this.offset),"undefined"==typeof b&&(b=this.limit),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal begin: Not an integer");if(a>>>=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal end: Not an integer");if(b>>>=0,a<0||a>b||b>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+b+" <= "+this.buffer.byteLength)}if(0===a&&b===this.buffer.byteLength)return this;var c=b-a;if(0===c)return this.buffer=f,this.view=null,this.markedOffset>=0&&(this.markedOffset-=a),this.offset=0,this.limit=0,this;var d=new ArrayBuffer(c);return new Uint8Array(d).set(new Uint8Array(this.buffer).subarray(a,b)),this.buffer=d,this.view=new DataView(d),this.markedOffset>=0&&(this.markedOffset-=a),this.offset=0,this.limit=c,this},e.copy=function(a,b){if("undefined"==typeof a&&(a=this.offset),"undefined"==typeof b&&(b=this.limit),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal begin: Not an integer");if(a>>>=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal end: Not an integer");if(b>>>=0,a<0||a>b||b>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+b+" <= "+this.buffer.byteLength)}if(a===b)return new d(0,this.littleEndian,this.noAssert);var c=b-a,e=new d(c,this.littleEndian,this.noAssert);return e.offset=0,e.limit=c,e.markedOffset>=0&&(e.markedOffset-=a),this.copyTo(e,0,a,b),e},e.copyTo=function(a,b,c,e){var f,g;if(!this.noAssert&&!d.isByteBuffer(a))throw TypeError("Illegal target: Not a ByteBuffer");if(b=(g="undefined"==typeof b)?a.offset:0|b,c=(f="undefined"==typeof c)?this.offset:0|c,e="undefined"==typeof e?this.limit:0|e,b<0||b>a.buffer.byteLength)throw RangeError("Illegal target range: 0 <= "+b+" <= "+a.buffer.byteLength);if(c<0||e>this.buffer.byteLength)throw RangeError("Illegal source range: 0 <= "+c+" <= "+this.buffer.byteLength);var h=e-c;return 0===h?a:(a.ensureCapacity(b+h),new Uint8Array(a.buffer).set(new Uint8Array(this.buffer).subarray(c,e),b),f&&(this.offset+=h),g&&(a.offset+=h),this)},e.ensureCapacity=function(a){var b=this.buffer.byteLength;return b<a?this.resize((b*=2)>a?b:a):this},e.fill=function(a,b,c){var d="undefined"==typeof b;if(d&&(b=this.offset),"string"==typeof a&&a.length>0&&(a=a.charCodeAt(0)),"undefined"==typeof b&&(b=this.offset),"undefined"==typeof c&&(c=this.limit),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a|=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal begin: Not an integer");if(b>>>=0,"number"!=typeof c||c%1!==0)throw TypeError("Illegal end: Not an integer");if(c>>>=0,b<0||b>c||c>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+b+" <= "+c+" <= "+this.buffer.byteLength)}if(b>=c)return this;for(;b<c;)this.view.setUint8(b++,a);return d&&(this.offset=b),this},e.flip=function(){return this.limit=this.offset,this.offset=0,this},e.mark=function(a){if(a="undefined"==typeof a?this.offset:a,!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+0) <= "+this.buffer.byteLength)}return this.markedOffset=a,this},e.order=function(a){if(!this.noAssert&&"boolean"!=typeof a)throw TypeError("Illegal littleEndian: Not a boolean");return this.littleEndian=!!a,this},e.LE=function(a){return this.littleEndian="undefined"==typeof a||!!a,this},e.BE=function(a){return this.littleEndian="undefined"!=typeof a&&!a,this},e.prepend=function(a,b,c){"number"!=typeof b&&"string"==typeof b||(c=b,b=void 0);var e="undefined"==typeof c;if(e&&(c=this.offset),!this.noAssert){if("number"!=typeof c||c%1!==0)throw TypeError("Illegal offset: "+c+" (not an integer)");if(c>>>=0,c<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}a instanceof d||(a=d.wrap(a,b));var f=a.limit-a.offset;if(f<=0)return this;var g,h=f-c;if(h>0){var i=new ArrayBuffer(this.buffer.byteLength+h);g=new Uint8Array(i),g.set(new Uint8Array(this.buffer).subarray(c,this.buffer.byteLength),f),this.buffer=i,this.view=new DataView(i),this.offset+=h,this.markedOffset>=0&&(this.markedOffset+=h),this.limit+=h,c+=h}else g=new Uint8Array(this.buffer);return g.set(new Uint8Array(a.buffer).subarray(a.offset,a.limit),c-f),a.offset=a.limit,e&&(this.offset-=f),this},e.prependTo=function(a,b){return a.prepend(this,b),this},e.printDebug=function(a){"function"!=typeof a&&(a=console.log.bind(console)),a(this.toString()+"\n-------------------------------------------------------------------\n"+this.toDebug(!0))},e.remaining=function(){return this.limit-this.offset},e.reset=function(){return this.markedOffset>=0?(this.offset=this.markedOffset,this.markedOffset=-1):this.offset=0,this},e.resize=function(a){if(!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal capacity: "+a+" (not an integer)");if(a|=0,a<0)throw RangeError("Illegal capacity: 0 <= "+a)}if(this.buffer.byteLength<a){var b=new ArrayBuffer(a);new Uint8Array(b).set(new Uint8Array(this.buffer)),this.buffer=b,this.view=new DataView(b)}return this},e.reverse=function(a,b){if("undefined"==typeof a&&(a=this.offset),"undefined"==typeof b&&(b=this.limit),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal begin: Not an integer");if(a>>>=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal end: Not an integer");if(b>>>=0,a<0||a>b||b>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+b+" <= "+this.buffer.byteLength)}return a===b?this:(Array.prototype.reverse.call(new Uint8Array(this.buffer).subarray(a,b)),this.view=new DataView(this.buffer),this)},e.skip=function(a){if(!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal length: "+a+" (not an integer)");a|=0}var b=this.offset+a;if(!this.noAssert&&(b<0||b>this.buffer.byteLength))throw RangeError("Illegal length: 0 <= "+this.offset+" + "+a+" <= "+this.buffer.byteLength);return this.offset=b,this},e.slice=function(a,b){if("undefined"==typeof a&&(a=this.offset),"undefined"==typeof b&&(b=this.limit),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal begin: Not an integer");if(a>>>=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal end: Not an integer");if(b>>>=0,a<0||a>b||b>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+b+" <= "+this.buffer.byteLength)}var c=this.clone();return c.offset=a,c.limit=b,c},e.toBuffer=function(a){var b=this.offset,c=this.limit;if(b>c){var d=b;b=c,c=d}if(!this.noAssert){if("number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: Not an integer");if(b>>>=0,"number"!=typeof c||c%1!==0)throw TypeError("Illegal limit: Not an integer");if(c>>>=0,b<0||b>c||c>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+b+" <= "+c+" <= "+this.buffer.byteLength)}if(!a&&0===b&&c===this.buffer.byteLength)return this.buffer;if(b===c)return f;var e=new ArrayBuffer(c-b);return new Uint8Array(e).set(new Uint8Array(this.buffer).subarray(b,c),0),e},e.toArrayBuffer=e.toBuffer,e.toString=function(a,b,c){if("undefined"==typeof a)return"ByteBufferAB(offset="+this.offset+",markedOffset="+this.markedOffset+",limit="+this.limit+",capacity="+this.capacity()+")";
switch("number"==typeof a&&(a="utf8",b=a,c=b),a){case"utf8":return this.toUTF8(b,c);case"base64":return this.toBase64(b,c);case"hex":return this.toHex(b,c);case"binary":return this.toBinary(b,c);case"debug":return this.toDebug();case"columns":return this.toColumns();default:throw Error("Unsupported encoding: "+a)}};var h=function(){for(var a={},b=[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,43,47],c=[],d=0,e=b.length;d<e;++d)c[b[d]]=d;return a.encode=function(a,c){for(var d,e;null!==(d=a());)c(b[d>>2&63]),e=(3&d)<<4,null!==(d=a())?(e|=d>>4&15,c(b[63&(e|d>>4&15)]),e=(15&d)<<2,null!==(d=a())?(c(b[63&(e|d>>6&3)]),c(b[63&d])):(c(b[63&e]),c(61))):(c(b[63&e]),c(61),c(61))},a.decode=function(a,b){function d(a){throw Error("Illegal character code: "+a)}for(var e,f,g;null!==(e=a());)if(f=c[e],"undefined"==typeof f&&d(e),null!==(e=a())&&(g=c[e],"undefined"==typeof g&&d(e),b(f<<2>>>0|(48&g)>>4),null!==(e=a()))){if(f=c[e],"undefined"==typeof f){if(61===e)break;d(e)}if(b((15&g)<<4>>>0|(60&f)>>2),null!==(e=a())){if(g=c[e],"undefined"==typeof g){if(61===e)break;d(e)}b((3&f)<<6>>>0|g)}}},a.test=function(a){return/^(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?$/.test(a)},a}();e.toBase64=function(a,b){if("undefined"==typeof a&&(a=this.offset),"undefined"==typeof b&&(b=this.limit),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal begin: Not an integer");if(a>>>=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal end: Not an integer");if(b>>>=0,a<0||a>b||b>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+b+" <= "+this.buffer.byteLength)}var d;return h.encode(function(){return a<b?this.view.getUint8(a++):null}.bind(this),d=c()),d()},d.fromBase64=function(a,c,e){if(!e){if("string"!=typeof a)throw TypeError("Illegal str: Not a string");if(a.length%4!==0)throw TypeError("Illegal str: Length not a multiple of 4")}var f=new d(a.length/4*3,c,e),g=0;return h.decode(b(a),function(a){f.view.setUint8(g++,a)}),f.limit=g,f},d.btoa=function(a){return d.fromBinary(a).toBase64()},d.atob=function(a){return d.fromBase64(a).toBinary()},e.toBinary=function(a,b){if(a="undefined"==typeof a?this.offset:a,b="undefined"==typeof b?this.limit:b,!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal begin: Not an integer");if(a>>>=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal end: Not an integer");if(b>>>=0,a<0||a>b||b>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+b+" <= "+this.buffer.byteLength)}if(a===b)return"";for(var c=[],d=[];a<b;)c.push(this.view.getUint8(a++)),c.length>=1024&&(d.push(String.fromCharCode.apply(String,c)),c=[]);return d.join("")+String.fromCharCode.apply(String,c)},d.fromBinary=function(a,b,c){if(!c&&"string"!=typeof a)throw TypeError("Illegal str: Not a string");for(var e,f=0,g=a.length,h=new d(g,b,c);f<g;){if(e=a.charCodeAt(f),!c&&e>255)throw RangeError("Illegal charCode at "+f+": 0 <= "+e+" <= 255");h.view.setUint8(f++,e)}return h.limit=g,h},e.toDebug=function(a){for(var b,c=-1,d=this.buffer.byteLength,e="",f="",g="";c<d;){if(c!==-1&&(b=this.view.getUint8(c),e+=b<16?"0"+b.toString(16).toUpperCase():b.toString(16).toUpperCase(),a&&(f+=b>32&&b<127?String.fromCharCode(b):".")),++c,a&&c>0&&c%16===0&&c!==d){for(;e.length<51;)e+=" ";g+=e+f+"\n",e=f=""}e+=c===this.offset&&c===this.limit?c===this.markedOffset?"!":"|":c===this.offset?c===this.markedOffset?"[":"<":c===this.limit?c===this.markedOffset?"]":">":c===this.markedOffset?"'":a||0!==c&&c!==d?" ":""}if(a&&" "!==e){for(;e.length<51;)e+=" ";g+=e+f+"\n"}return a?g:e},d.fromDebug=function(a,b,c){for(var e,f,g=a.length,h=new d((g+1)/3|0,b,c),i=0,j=0,k=!1,l=!1,m=!1,n=!1,o=!1;i<g;){switch(e=a.charAt(i++)){case"!":if(!c){if(l||m||n){o=!0;break}l=m=n=!0}h.offset=h.markedOffset=h.limit=j,k=!1;break;case"|":if(!c){if(l||n){o=!0;break}l=n=!0}h.offset=h.limit=j,k=!1;break;case"[":if(!c){if(l||m){o=!0;break}l=m=!0}h.offset=h.markedOffset=j,k=!1;break;case"<":if(!c){if(l){o=!0;break}l=!0}h.offset=j,k=!1;break;case"]":if(!c){if(n||m){o=!0;break}n=m=!0}h.limit=h.markedOffset=j,k=!1;break;case">":if(!c){if(n){o=!0;break}n=!0}h.limit=j,k=!1;break;case"'":if(!c){if(m){o=!0;break}m=!0}h.markedOffset=j,k=!1;break;case" ":k=!1;break;default:if(!c&&k){o=!0;break}if(f=parseInt(e+a.charAt(i++),16),!c&&(isNaN(f)||f<0||f>255))throw TypeError("Illegal str: Not a debug encoded string");h.view.setUint8(j++,f),k=!0}if(o)throw TypeError("Illegal str: Invalid symbol at "+i)}if(!c){if(!l||!n)throw TypeError("Illegal str: Missing offset or limit");if(j<h.buffer.byteLength)throw TypeError("Illegal str: Not a debug encoded string (is it hex?) "+j+" < "+g)}return h},e.toHex=function(a,b){if(a="undefined"==typeof a?this.offset:a,b="undefined"==typeof b?this.limit:b,!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal begin: Not an integer");if(a>>>=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal end: Not an integer");if(b>>>=0,a<0||a>b||b>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+b+" <= "+this.buffer.byteLength)}for(var c,d=new Array(b-a);a<b;)c=this.view.getUint8(a++),c<16?d.push("0",c.toString(16)):d.push(c.toString(16));return d.join("")},d.fromHex=function(a,b,c){if(!c){if("string"!=typeof a)throw TypeError("Illegal str: Not a string");if(a.length%2!==0)throw TypeError("Illegal str: Length not a multiple of 2")}for(var e,f=a.length,g=new d(f/2|0,b),h=0,i=0;h<f;h+=2){if(e=parseInt(a.substring(h,h+2),16),!c&&(!isFinite(e)||e<0||e>255))throw TypeError("Illegal str: Contains non-hex characters");g.view.setUint8(i++,e)}return g.limit=i,g};var j=function(){var a={};return a.MAX_CODEPOINT=1114111,a.encodeUTF8=function(a,b){var c=null;for("number"==typeof a&&(c=a,a=function(){return null});null!==c||null!==(c=a());)c<128?b(127&c):c<2048?(b(c>>6&31|192),b(63&c|128)):c<65536?(b(c>>12&15|224),b(c>>6&63|128),b(63&c|128)):(b(c>>18&7|240),b(c>>12&63|128),b(c>>6&63|128),b(63&c|128)),c=null},a.decodeUTF8=function(a,b){for(var c,d,e,f,g=function(a){a=a.slice(0,a.indexOf(null));var b=Error(a.toString());throw b.name="TruncatedError",b.bytes=a,b};null!==(c=a());)if(0===(128&c))b(c);else if(192===(224&c))null===(d=a())&&g([c,d]),b((31&c)<<6|63&d);else if(224===(240&c))(null===(d=a())||null===(e=a()))&&g([c,d,e]),b((15&c)<<12|(63&d)<<6|63&e);else{if(240!==(248&c))throw RangeError("Illegal starting byte: "+c);(null===(d=a())||null===(e=a())||null===(f=a()))&&g([c,d,e,f]),b((7&c)<<18|(63&d)<<12|(63&e)<<6|63&f)}},a.UTF16toUTF8=function(a,b){for(var c,d=null;;){if(null===(c=null!==d?d:a()))break;c>=55296&&c<=57343&&null!==(d=a())&&d>=56320&&d<=57343?(b(1024*(c-55296)+d-56320+65536),d=null):b(c)}null!==d&&b(d)},a.UTF8toUTF16=function(a,b){var c=null;for("number"==typeof a&&(c=a,a=function(){return null});null!==c||null!==(c=a());)c<=65535?b(c):(c-=65536,b((c>>10)+55296),b(c%1024+56320)),c=null},a.encodeUTF16toUTF8=function(b,c){a.UTF16toUTF8(b,function(b){a.encodeUTF8(b,c)})},a.decodeUTF8toUTF16=function(b,c){a.decodeUTF8(b,function(b){a.UTF8toUTF16(b,c)})},a.calculateCodePoint=function(a){return a<128?1:a<2048?2:a<65536?3:4},a.calculateUTF8=function(b){for(var c,d=0;null!==(c=b());)d+=a.calculateCodePoint(c);return d},a.calculateUTF16asUTF8=function(b){var c=0,d=0;return a.UTF16toUTF8(b,function(b){++c,d+=a.calculateCodePoint(b)}),[c,d]},a}();return e.toUTF8=function(a,b){if("undefined"==typeof a&&(a=this.offset),"undefined"==typeof b&&(b=this.limit),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal begin: Not an integer");if(a>>>=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal end: Not an integer");if(b>>>=0,a<0||a>b||b>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+b+" <= "+this.buffer.byteLength)}var d;try{j.decodeUTF8toUTF16(function(){return a<b?this.view.getUint8(a++):null}.bind(this),d=c())}catch(e){if(a!==b)throw RangeError("Illegal range: Truncated data, "+a+" != "+b)}return d()},d.fromUTF8=function(a,c,e){if(!e&&"string"!=typeof a)throw TypeError("Illegal str: Not a string");var f=new d(j.calculateUTF16asUTF8(b(a),!0)[1],c,e),g=0;return j.encodeUTF16toUTF8(b(a),function(a){f.view.setUint8(g++,a)}),f.limit=g,f},d}"object"==typeof a&&a&&"object"==typeof b&&b?a.exports=function(){var a;try{a=c(13)}catch(b){}return g(a)}():c(14).amd?(d=[c(13)],e=function(a){return g(a)}.apply(b,d),!(void 0!==e&&(a.exports=e))):(f.dcodeIO=f.dcodeIO||{}).ByteBuffer=g(f.dcodeIO.Long)}(this)}).call(b,c(12)(a))},function(a,b){a.exports=function(a){return a.webpackPolyfill||(a.deprecate=function(){},a.paths=[],a.children=[],a.webpackPolyfill=1),a}},function(a,b,c){var d,e,f;(function(a){!function(g,h){c(14).amd?(e=[],d=h,f="function"==typeof d?d.apply(b,e):d,!(void 0!==f&&(a.exports=f))):"object"==typeof a&&a&&a.exports?a.exports=h():(g.dcodeIO=g.dcodeIO||{}).Long=h()}(this,function(){"use strict";function a(a,b,c){this.low=0|a,this.high=0|b,this.unsigned=!!c}function b(a){return(a&&a.__isLong__)===!0}function c(a,b){var c,d,f;return b?(a>>>=0,(f=0<=a&&a<256)&&(d=i[a])?d:(c=e(a,(0|a)<0?-1:0,!0),f&&(i[a]=c),c)):(a|=0,(f=-128<=a&&a<128)&&(d=h[a])?d:(c=e(a,a<0?-1:0,!1),f&&(h[a]=c),c))}function d(a,b){if(isNaN(a)||!isFinite(a))return b?q:p;if(b){if(a<0)return q;if(a>=m)return v}else{if(a<=-n)return w;if(a+1>=n)return u}return a<0?d(-a,b).neg():e(a%l|0,a/l|0,b)}function e(b,c,d){return new a(b,c,d)}function f(a,b,c){if(0===a.length)throw Error("empty string");if("NaN"===a||"Infinity"===a||"+Infinity"===a||"-Infinity"===a)return p;if("number"==typeof b?(c=b,b=!1):b=!!b,c=c||10,c<2||36<c)throw RangeError("radix");var e;if((e=a.indexOf("-"))>0)throw Error("interior hyphen");if(0===e)return f(a.substring(1),b,c).neg();for(var g=d(j(c,8)),h=p,i=0;i<a.length;i+=8){var k=Math.min(8,a.length-i),l=parseInt(a.substring(i,i+k),c);if(k<8){var m=d(j(c,k));h=h.mul(m).add(d(l))}else h=h.mul(g),h=h.add(d(l))}return h.unsigned=b,h}function g(b){return b instanceof a?b:"number"==typeof b?d(b):"string"==typeof b?f(b):e(b.low,b.high,b.unsigned)}a.prototype.__isLong__,Object.defineProperty(a.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1}),a.isLong=b;var h={},i={};a.fromInt=c,a.fromNumber=d,a.fromBits=e;var j=Math.pow;a.fromString=f,a.fromValue=g;var k=1<<24,l=4294967296,m=0x10000000000000000,n=m/2,o=c(k),p=c(0);a.ZERO=p;var q=c(0,!0);a.UZERO=q;var r=c(1);a.ONE=r;var s=c(1,!0);a.UONE=s;var t=c(-1);a.NEG_ONE=t;var u=e(-1,2147483647,!1);a.MAX_VALUE=u;var v=e(-1,-1,!0);a.MAX_UNSIGNED_VALUE=v;var w=e(0,-2147483648,!1);a.MIN_VALUE=w;var x=a.prototype;return x.toInt=function(){return this.unsigned?this.low>>>0:this.low},x.toNumber=function(){return this.unsigned?(this.high>>>0)*l+(this.low>>>0):this.high*l+(this.low>>>0)},x.toString=function(a){if(a=a||10,a<2||36<a)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(w)){var b=d(a),c=this.div(b),e=c.mul(b).sub(this);return c.toString(a)+e.toInt().toString(a)}return"-"+this.neg().toString(a)}for(var f=d(j(a,6),this.unsigned),g=this,h="";;){var i=g.div(f),k=g.sub(i.mul(f)).toInt()>>>0,l=k.toString(a);if(g=i,g.isZero())return l+h;for(;l.length<6;)l="0"+l;h=""+l+h}},x.getHighBits=function(){return this.high},x.getHighBitsUnsigned=function(){return this.high>>>0},x.getLowBits=function(){return this.low},x.getLowBitsUnsigned=function(){return this.low>>>0},x.getNumBitsAbs=function(){if(this.isNegative())return this.eq(w)?64:this.neg().getNumBitsAbs();for(var a=0!=this.high?this.high:this.low,b=31;b>0&&0==(a&1<<b);b--);return 0!=this.high?b+33:b+1},x.isZero=function(){return 0===this.high&&0===this.low},x.isNegative=function(){return!this.unsigned&&this.high<0},x.isPositive=function(){return this.unsigned||this.high>=0},x.isOdd=function(){return 1===(1&this.low)},x.isEven=function(){return 0===(1&this.low)},x.equals=function(a){return b(a)||(a=g(a)),(this.unsigned===a.unsigned||this.high>>>31!==1||a.high>>>31!==1)&&(this.high===a.high&&this.low===a.low)},x.eq=x.equals,x.notEquals=function(a){return!this.eq(a)},x.neq=x.notEquals,x.lessThan=function(a){return this.comp(a)<0},x.lt=x.lessThan,x.lessThanOrEqual=function(a){return this.comp(a)<=0},x.lte=x.lessThanOrEqual,x.greaterThan=function(a){return this.comp(a)>0},x.gt=x.greaterThan,x.greaterThanOrEqual=function(a){return this.comp(a)>=0},x.gte=x.greaterThanOrEqual,x.compare=function(a){if(b(a)||(a=g(a)),this.eq(a))return 0;var c=this.isNegative(),d=a.isNegative();return c&&!d?-1:!c&&d?1:this.unsigned?a.high>>>0>this.high>>>0||a.high===this.high&&a.low>>>0>this.low>>>0?-1:1:this.sub(a).isNegative()?-1:1},x.comp=x.compare,x.negate=function(){return!this.unsigned&&this.eq(w)?w:this.not().add(r)},x.neg=x.negate,x.add=function(a){b(a)||(a=g(a));var c=this.high>>>16,d=65535&this.high,f=this.low>>>16,h=65535&this.low,i=a.high>>>16,j=65535&a.high,k=a.low>>>16,l=65535&a.low,m=0,n=0,o=0,p=0;return p+=h+l,o+=p>>>16,p&=65535,o+=f+k,n+=o>>>16,o&=65535,n+=d+j,m+=n>>>16,n&=65535,m+=c+i,m&=65535,e(o<<16|p,m<<16|n,this.unsigned)},x.subtract=function(a){return b(a)||(a=g(a)),this.add(a.neg())},x.sub=x.subtract,x.multiply=function(a){if(this.isZero())return p;if(b(a)||(a=g(a)),a.isZero())return p;if(this.eq(w))return a.isOdd()?w:p;if(a.eq(w))return this.isOdd()?w:p;if(this.isNegative())return a.isNegative()?this.neg().mul(a.neg()):this.neg().mul(a).neg();if(a.isNegative())return this.mul(a.neg()).neg();if(this.lt(o)&&a.lt(o))return d(this.toNumber()*a.toNumber(),this.unsigned);var c=this.high>>>16,f=65535&this.high,h=this.low>>>16,i=65535&this.low,j=a.high>>>16,k=65535&a.high,l=a.low>>>16,m=65535&a.low,n=0,q=0,r=0,s=0;return s+=i*m,r+=s>>>16,s&=65535,r+=h*m,q+=r>>>16,r&=65535,r+=i*l,q+=r>>>16,r&=65535,q+=f*m,n+=q>>>16,q&=65535,q+=h*l,n+=q>>>16,q&=65535,q+=i*k,n+=q>>>16,q&=65535,n+=c*m+f*l+h*k+i*j,n&=65535,e(r<<16|s,n<<16|q,this.unsigned)},x.mul=x.multiply,x.divide=function(a){if(b(a)||(a=g(a)),a.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?q:p;var c,e,f;if(this.unsigned){if(a.unsigned||(a=a.toUnsigned()),a.gt(this))return q;if(a.gt(this.shru(1)))return s;f=q}else{if(this.eq(w)){if(a.eq(r)||a.eq(t))return w;if(a.eq(w))return r;var h=this.shr(1);return c=h.div(a).shl(1),c.eq(p)?a.isNegative()?r:t:(e=this.sub(a.mul(c)),f=c.add(e.div(a)))}if(a.eq(w))return this.unsigned?q:p;if(this.isNegative())return a.isNegative()?this.neg().div(a.neg()):this.neg().div(a).neg();if(a.isNegative())return this.div(a.neg()).neg();f=p}for(e=this;e.gte(a);){c=Math.max(1,Math.floor(e.toNumber()/a.toNumber()));for(var i=Math.ceil(Math.log(c)/Math.LN2),k=i<=48?1:j(2,i-48),l=d(c),m=l.mul(a);m.isNegative()||m.gt(e);)c-=k,l=d(c,this.unsigned),m=l.mul(a);l.isZero()&&(l=r),f=f.add(l),e=e.sub(m)}return f},x.div=x.divide,x.modulo=function(a){return b(a)||(a=g(a)),this.sub(this.div(a).mul(a))},x.mod=x.modulo,x.not=function(){return e(~this.low,~this.high,this.unsigned)},x.and=function(a){return b(a)||(a=g(a)),e(this.low&a.low,this.high&a.high,this.unsigned)},x.or=function(a){return b(a)||(a=g(a)),e(this.low|a.low,this.high|a.high,this.unsigned)},x.xor=function(a){return b(a)||(a=g(a)),e(this.low^a.low,this.high^a.high,this.unsigned)},x.shiftLeft=function(a){return b(a)&&(a=a.toInt()),0===(a&=63)?this:a<32?e(this.low<<a,this.high<<a|this.low>>>32-a,this.unsigned):e(0,this.low<<a-32,this.unsigned)},x.shl=x.shiftLeft,x.shiftRight=function(a){return b(a)&&(a=a.toInt()),0===(a&=63)?this:a<32?e(this.low>>>a|this.high<<32-a,this.high>>a,this.unsigned):e(this.high>>a-32,this.high>=0?0:-1,this.unsigned)},x.shr=x.shiftRight,x.shiftRightUnsigned=function(a){if(b(a)&&(a=a.toInt()),a&=63,0===a)return this;var c=this.high;if(a<32){var d=this.low;return e(d>>>a|c<<32-a,c>>>a,this.unsigned)}return 32===a?e(c,0,this.unsigned):e(c>>>a-32,0,this.unsigned)},x.shru=x.shiftRightUnsigned,x.toSigned=function(){return this.unsigned?e(this.low,this.high,!1):this},x.toUnsigned=function(){return this.unsigned?this:e(this.low,this.high,!0)},x.toBytes=function(a){return a?this.toBytesLE():this.toBytesBE()},x.toBytesLE=function(){var a=this.high,b=this.low;return[255&b,b>>>8&255,b>>>16&255,b>>>24&255,255&a,a>>>8&255,a>>>16&255,a>>>24&255]},x.toBytesBE=function(){var a=this.high,b=this.low;return[a>>>24&255,a>>>16&255,a>>>8&255,255&a,b>>>24&255,b>>>16&255,b>>>8&255,255&b]},a})}).call(b,c(12)(a))},function(a,b){a.exports=function(){throw new Error("define cannot be used indirect")}},function(a,b,c){var d,e;d=[c(16),c(20),c(21),c(22),c(23)],e=function(a,b,c,d,e){"use strict";function f(f){this._logger=f;var g=a.loadJson(b);g=a.loadJson(c,g),g=a.loadJson(d,g),g=a.loadJson(e,g),this._builders=g.build(),this._apiVersion=3}function g(a){for(var b=a.split("."),c=this._builders,d=0;d<b.length-1;d++)if(c=c[b[d]],!c)throw new Error('Unsupported type "'+a+'"');if(c=c[b[b.length-1]],"function"!=typeof c)throw new Error('Unsupported type "'+a+'"');return c}function h(a){if(a&&a.$type&&a.$type.children)for(var b in a.$type.children){var c=a.$type.children[b],d=a[c.name],e=c&&c.element?c.element.resolvedType:null;if(e&&"Message"===e.className&&e.children)a[c.name]=h(d);else if(e&&"Enum"===e.className&&e.children){for(var f=null,g=0;g<e.children.length;g++)if(e.children[g].id===d){f=e.children[g];break}f&&f.name&&(a[c.name]=f.name)}else d&&"function"==typeof d.toNumber&&(a[c.name]=d.toNumber())}return a}return f.prototype.getApiVersion=function(){return this._apiVersion},f.prototype.encode=function(a,b){if("string"!=typeof a)throw new Error("'type' must be a string");if("object"!=typeof b)throw new Error("'data' must be an object");var c=g.call(this,a);return c.encode(b)},f.prototype.decode=function(a,b){if("string"!=typeof a)throw new Error("'type' must be a string");var c=g.call(this,a);return h(c.decode(b))},f}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e,f;(function(a,g){!function(a,h){c(14).amd?(e=[c(11)],d=h,f="function"==typeof d?d.apply(b,e):d,!(void 0!==f&&(g.exports=f))):"object"==typeof g&&g&&g.exports?g.exports=h(c(11),!0):(a.dcodeIO=a.dcodeIO||{}).ProtoBuf=h(a.dcodeIO.ByteBuffer)}(this,function(b,d){"use strict";var e={};return e.ByteBuffer=b,e.Long=b.Long||null,e.VERSION="4.1.2",e.WIRE_TYPES={},e.WIRE_TYPES.VARINT=0,e.WIRE_TYPES.BITS64=1,e.WIRE_TYPES.LDELIM=2,e.WIRE_TYPES.STARTGROUP=3,e.WIRE_TYPES.ENDGROUP=4,e.WIRE_TYPES.BITS32=5,e.PACKABLE_WIRE_TYPES=[e.WIRE_TYPES.VARINT,e.WIRE_TYPES.BITS64,e.WIRE_TYPES.BITS32],e.TYPES={int32:{name:"int32",wireType:e.WIRE_TYPES.VARINT,defaultValue:0},uint32:{name:"uint32",wireType:e.WIRE_TYPES.VARINT,defaultValue:0},sint32:{name:"sint32",wireType:e.WIRE_TYPES.VARINT,defaultValue:0},int64:{name:"int64",wireType:e.WIRE_TYPES.VARINT,defaultValue:e.Long?e.Long.ZERO:void 0},uint64:{name:"uint64",wireType:e.WIRE_TYPES.VARINT,defaultValue:e.Long?e.Long.UZERO:void 0},sint64:{name:"sint64",wireType:e.WIRE_TYPES.VARINT,defaultValue:e.Long?e.Long.ZERO:void 0},bool:{name:"bool",wireType:e.WIRE_TYPES.VARINT,defaultValue:!1},"double":{name:"double",wireType:e.WIRE_TYPES.BITS64,defaultValue:0},string:{name:"string",wireType:e.WIRE_TYPES.LDELIM,defaultValue:""},bytes:{name:"bytes",wireType:e.WIRE_TYPES.LDELIM,defaultValue:null},fixed32:{name:"fixed32",wireType:e.WIRE_TYPES.BITS32,defaultValue:0},sfixed32:{name:"sfixed32",wireType:e.WIRE_TYPES.BITS32,defaultValue:0},fixed64:{name:"fixed64",wireType:e.WIRE_TYPES.BITS64,defaultValue:e.Long?e.Long.UZERO:void 0},sfixed64:{name:"sfixed64",wireType:e.WIRE_TYPES.BITS64,defaultValue:e.Long?e.Long.ZERO:void 0},"float":{name:"float",wireType:e.WIRE_TYPES.BITS32,defaultValue:0},"enum":{name:"enum",wireType:e.WIRE_TYPES.VARINT,defaultValue:0},message:{name:"message",wireType:e.WIRE_TYPES.LDELIM,defaultValue:null},group:{name:"group",wireType:e.WIRE_TYPES.STARTGROUP,defaultValue:null}},e.MAP_KEY_TYPES=[e.TYPES.int32,e.TYPES.sint32,e.TYPES.sfixed32,e.TYPES.uint32,e.TYPES.fixed32,e.TYPES.int64,e.TYPES.sint64,e.TYPES.sfixed64,e.TYPES.uint64,e.TYPES.fixed64,e.TYPES.bool,e.TYPES.string,e.TYPES.bytes],e.ID_MIN=1,e.ID_MAX=536870911,e.convertFieldsToCamelCase=!1,e.populateAccessors=!0,e.populateDefaults=!0,e.Util=function(){var b={};return b.IS_NODE=!("object"!=typeof a||a+""!="[object process]"||a.browser),b.XHR=function(){for(var a=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],b=null,c=0;c<a.length;c++){try{b=a[c]()}catch(d){continue}break}if(!b)throw Error("XMLHttpRequest is not supported");return b},b.fetch=function(a,d){if(d&&"function"!=typeof d&&(d=null),b.IS_NODE){var e=c(18);if(d)e.readFile(a,function(a,b){d(a?null:""+b)});else try{return e.readFileSync(a)}catch(f){return null}}else{var g=b.XHR();if(g.open("GET",a,!!d),g.setRequestHeader("Accept","text/plain"),"function"==typeof g.overrideMimeType&&g.overrideMimeType("text/plain"),!d)return g.send(null),200==g.status||0==g.status&&"string"==typeof g.responseText?g.responseText:null;if(g.onreadystatechange=function(){4==g.readyState&&d(200==g.status||0==g.status&&"string"==typeof g.responseText?g.responseText:null)},4==g.readyState)return;g.send(null)}},b.toCamelCase=function(a){return a.replace(/_([a-zA-Z])/g,function(a,b){return b.toUpperCase()})},b}(),e.Lang={DELIM:/[\s\{\}=;:\[\],'"\(\)<>]/g,RULE:/^(?:required|optional|repeated|map)$/,TYPE:/^(?:double|float|int32|uint32|sint32|int64|uint64|sint64|fixed32|sfixed32|fixed64|sfixed64|bool|string|bytes)$/,NAME:/^[a-zA-Z_][a-zA-Z_0-9]*$/,TYPEDEF:/^[a-zA-Z][a-zA-Z_0-9]*$/,TYPEREF:/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)+$/,FQTYPEREF:/^(?:\.[a-zA-Z][a-zA-Z_0-9]*)+$/,NUMBER:/^-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+|([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?)|inf|nan)$/,NUMBER_DEC:/^(?:[1-9][0-9]*|0)$/,NUMBER_HEX:/^0[xX][0-9a-fA-F]+$/,NUMBER_OCT:/^0[0-7]+$/,NUMBER_FLT:/^([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?|inf|nan)$/,BOOL:/^(?:true|false)$/i,ID:/^(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,NEGID:/^\-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,WHITESPACE:/\s/,STRING:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")|(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,STRING_DQ:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,STRING_SQ:/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g},e.DotProto=function(a,b){function c(a,c){var d=-1,e=1;if("-"==a.charAt(0)&&(e=-1,a=a.substring(1)),b.NUMBER_DEC.test(a))d=parseInt(a);else if(b.NUMBER_HEX.test(a))d=parseInt(a.substring(2),16);else{if(!b.NUMBER_OCT.test(a))throw Error("illegal id value: "+(e<0?"-":"")+a);d=parseInt(a.substring(1),8)}if(d=e*d|0,!c&&d<0)throw Error("illegal id value: "+(e<0?"-":"")+a);return d}function d(a){var c=1;if("-"==a.charAt(0)&&(c=-1,a=a.substring(1)),b.NUMBER_DEC.test(a))return c*parseInt(a,10);if(b.NUMBER_HEX.test(a))return c*parseInt(a.substring(2),16);if(b.NUMBER_OCT.test(a))return c*parseInt(a.substring(1),8);if("inf"===a)return c*(1/0);if("nan"===a)return NaN;if(b.NUMBER_FLT.test(a))return c*parseFloat(a);throw Error("illegal number value: "+(c<0?"-":"")+a)}function e(a,b,c){"undefined"==typeof a[b]?a[b]=c:(Array.isArray(a[b])||(a[b]=[a[b]]),a[b].push(c))}var f={},g=function(a){this.source=a+"",this.index=0,this.line=1,this.stack=[],this._stringOpen=null},h=g.prototype;h._readString=function(){var a='"'===this._stringOpen?b.STRING_DQ:b.STRING_SQ;a.lastIndex=this.index-1;var c=a.exec(this.source);if(!c)throw Error("unterminated string");return this.index=a.lastIndex,this.stack.push(this._stringOpen),this._stringOpen=null,c[1]},h.next=function(){if(this.stack.length>0)return this.stack.shift();if(this.index>=this.source.length)return null;if(null!==this._stringOpen)return this._readString();var a,c,d;do{for(a=!1;b.WHITESPACE.test(d=this.source.charAt(this.index));)if("\n"===d&&++this.line,++this.index===this.source.length)return null;if("/"===this.source.charAt(this.index))if(++this.index,"/"===this.source.charAt(this.index)){for(;"\n"!==this.source.charAt(++this.index);)if(this.index==this.source.length)return null;++this.index,++this.line,a=!0}else{if("*"!==(d=this.source.charAt(this.index)))return"/";do{if("\n"===d&&++this.line,++this.index===this.source.length)return null;c=d,d=this.source.charAt(this.index)}while("*"!==c||"/"!==d);++this.index,a=!0}}while(a);if(this.index===this.source.length)return null;var e=this.index;b.DELIM.lastIndex=0;var f=b.DELIM.test(this.source.charAt(e++));if(!f)for(;e<this.source.length&&!b.DELIM.test(this.source.charAt(e));)++e;var g=this.source.substring(this.index,this.index=e);return'"'!==g&&"'"!==g||(this._stringOpen=g),g},h.peek=function(){if(0===this.stack.length){var a=this.next();if(null===a)return null;this.stack.push(a)}return this.stack[0]},h.skip=function(a){var b=this.next();if(b!==a)throw Error("illegal '"+b+"', '"+a+"' expected")},h.omit=function(a){return this.peek()===a&&(this.next(),!0)},h.toString=function(){return"Tokenizer ("+this.index+"/"+this.source.length+" at line "+this.line+")"},f.Tokenizer=g;var i=function(a){this.tn=new g(a),this.proto3=!1},j=i.prototype;return j.parse=function(){var a,c={name:"[ROOT]","package":null,messages:[],enums:[],imports:[],options:{},services:[]},d=!0;try{for(;a=this.tn.next();)switch(a){case"package":if(!d||null!==c["package"])throw Error("unexpected 'package'");if(a=this.tn.next(),!b.TYPEREF.test(a))throw Error("illegal package name: "+a);this.tn.skip(";"),c["package"]=a;break;case"import":if(!d)throw Error("unexpected 'import'");a=this.tn.peek(),"public"===a&&this.tn.next(),a=this._readString(),this.tn.skip(";"),c.imports.push(a);break;case"syntax":if(!d)throw Error("unexpected 'syntax'");this.tn.skip("="),"proto3"===(c.syntax=this._readString())&&(this.proto3=!0),this.tn.skip(";");break;case"message":this._parseMessage(c,null),d=!1;break;case"enum":this._parseEnum(c),d=!1;break;case"option":this._parseOption(c);break;case"service":this._parseService(c);break;case"extend":this._parseExtend(c);break;default:throw Error("unexpected '"+a+"'")}}catch(e){throw e.message="Parse error at line "+this.tn.line+": "+e.message,e}return delete c.name,c},i.parse=function(a){return new i(a).parse()},j._readString=function(){var a,b,c="";do{if(b=this.tn.next(),"'"!==b&&'"'!==b)throw Error("illegal string delimiter: "+b);c+=this.tn.next(),this.tn.skip(b),a=this.tn.peek()}while('"'===a||'"'===a);return c},j._readValue=function(a){var c=this.tn.peek();if('"'===c||"'"===c)return this._readString();if(this.tn.next(),b.NUMBER.test(c))return d(c);if(b.BOOL.test(c))return"true"===c.toLowerCase();if(a&&b.TYPEREF.test(c))return c;throw Error("illegal value: "+c)},j._parseOption=function(a,c){var d=this.tn.next(),e=!1;if("("===d&&(e=!0,d=this.tn.next()),!b.TYPEREF.test(d))throw Error("illegal option name: "+d);var f=d;e&&(this.tn.skip(")"),f="("+f+")",d=this.tn.peek(),b.FQTYPEREF.test(d)&&(f+=d,this.tn.next())),this.tn.skip("="),this._parseOptionValue(a,f),c||this.tn.skip(";")},j._parseOptionValue=function(a,c){var d=this.tn.peek();if("{"!==d)e(a.options,c,this._readValue(!0));else for(this.tn.skip("{");"}"!==(d=this.tn.next());){if(!b.NAME.test(d))throw Error("illegal option name: "+c+"."+d);this.tn.omit(":")?e(a.options,c+"."+d,this._readValue(!0)):this._parseOptionValue(a,c+"."+d)}},j._parseService=function(a){var c=this.tn.next();if(!b.NAME.test(c))throw Error("illegal service name at line "+this.tn.line+": "+c);var d=c,e={name:d,rpc:{},options:{}};for(this.tn.skip("{");"}"!==(c=this.tn.next());)if("option"===c)this._parseOption(e);else{if("rpc"!==c)throw Error("illegal service token: "+c);this._parseServiceRPC(e)}this.tn.omit(";"),a.services.push(e)},j._parseServiceRPC=function(a){var c="rpc",d=this.tn.next();if(!b.NAME.test(d))throw Error("illegal rpc service method name: "+d);var e=d,f={request:null,response:null,request_stream:!1,response_stream:!1,options:{}};if(this.tn.skip("("),d=this.tn.next(),"stream"===d.toLowerCase()&&(f.request_stream=!0,d=this.tn.next()),!b.TYPEREF.test(d))throw Error("illegal rpc service request type: "+d);if(f.request=d,this.tn.skip(")"),d=this.tn.next(),"returns"!==d.toLowerCase())throw Error("illegal rpc service request type delimiter: "+d);if(this.tn.skip("("),d=this.tn.next(),"stream"===d.toLowerCase()&&(f.response_stream=!0,d=this.tn.next()),f.response=d,this.tn.skip(")"),d=this.tn.peek(),"{"===d){for(this.tn.next();"}"!==(d=this.tn.next());){if("option"!==d)throw Error("illegal rpc service token: "+d);this._parseOption(f)}this.tn.omit(";")}else this.tn.skip(";");"undefined"==typeof a[c]&&(a[c]={}),a[c][e]=f},j._parseMessage=function(a,d){var e=!!d,f=this.tn.next(),g={name:"",fields:[],enums:[],messages:[],options:{},oneofs:{}};if(!b.NAME.test(f))throw Error("illegal "+(e?"group":"message")+" name: "+f);for(g.name=f,e&&(this.tn.skip("="),d.id=c(this.tn.next()),g.isGroup=!0),f=this.tn.peek(),"["===f&&d&&this._parseFieldOptions(d),this.tn.skip("{");"}"!==(f=this.tn.next());)if(b.RULE.test(f))this._parseMessageField(g,f);else if("oneof"===f)this._parseMessageOneOf(g);else if("enum"===f)this._parseEnum(g);else if("message"===f)this._parseMessage(g);else if("option"===f)this._parseOption(g);else if("extensions"===f)this._parseExtensions(g);else if("extend"===f)this._parseExtend(g);else{if(!b.TYPEREF.test(f))throw Error("illegal message token: "+f);if(!this.proto3)throw Error("illegal field rule: "+f);this._parseMessageField(g,"optional",f)}return this.tn.omit(";"),a.messages.push(g),g},j._parseMessageField=function(a,d,e){if(!b.RULE.test(d))throw Error("illegal message field rule: "+d);var f,g={rule:d,type:"",name:"",options:{},id:0};if("map"===d){if(e)throw Error("illegal type: "+e);if(this.tn.skip("<"),f=this.tn.next(),!b.TYPE.test(f)&&!b.TYPEREF.test(f))throw Error("illegal message field type: "+f);if(g.keytype=f,this.tn.skip(","),f=this.tn.next(),!b.TYPE.test(f)&&!b.TYPEREF.test(f))throw Error("illegal message field: "+f);if(g.type=f,this.tn.skip(">"),f=this.tn.next(),!b.NAME.test(f))throw Error("illegal message field name: "+f);g.name=f,this.tn.skip("="),g.id=c(this.tn.next()),f=this.tn.peek(),"["===f&&this._parseFieldOptions(g),this.tn.skip(";")}else if(e="undefined"!=typeof e?e:this.tn.next(),"group"===e){var h=this._parseMessage(a,g);if(!/^[A-Z]/.test(h.name))throw Error("illegal group name: "+h.name);g.type=h.name,g.name=h.name.toLowerCase(),this.tn.omit(";")}else{if(!b.TYPE.test(e)&&!b.TYPEREF.test(e))throw Error("illegal message field type: "+e);if(g.type=e,f=this.tn.next(),!b.NAME.test(f))throw Error("illegal message field name: "+f);g.name=f,this.tn.skip("="),g.id=c(this.tn.next()),f=this.tn.peek(),"["===f&&this._parseFieldOptions(g),this.tn.skip(";")}return a.fields.push(g),g},j._parseMessageOneOf=function(a){var c=this.tn.next();if(!b.NAME.test(c))throw Error("illegal oneof name: "+c);var d,e=c,f=[];for(this.tn.skip("{");"}"!==(c=this.tn.next());)d=this._parseMessageField(a,"optional",c),d.oneof=e,f.push(d.id);this.tn.omit(";"),a.oneofs[e]=f},j._parseFieldOptions=function(a){this.tn.skip("[");for(var b,c=!0;"]"!==(b=this.tn.peek());)c||this.tn.skip(","),this._parseOption(a,!0),c=!1;this.tn.next()},j._parseEnum=function(a){var d={name:"",values:[],options:{}},e=this.tn.next();if(!b.NAME.test(e))throw Error("illegal name: "+e);for(d.name=e,this.tn.skip("{");"}"!==(e=this.tn.next());)if("option"===e)this._parseOption(d);else{if(!b.NAME.test(e))throw Error("illegal name: "+e);this.tn.skip("=");var f={name:e,id:c(this.tn.next(),!0)};e=this.tn.peek(),"["===e&&this._parseFieldOptions({options:{}}),this.tn.skip(";"),d.values.push(f)}this.tn.omit(";"),a.enums.push(d)},j._parseExtensions=function(b){var c=this.tn.next(),e=[];"min"===c?e.push(a.ID_MIN):"max"===c?e.push(a.ID_MAX):e.push(d(c)),this.tn.skip("to"),c=this.tn.next(),"min"===c?e.push(a.ID_MIN):"max"===c?e.push(a.ID_MAX):e.push(d(c)),this.tn.skip(";"),b.extensions=e},j._parseExtend=function(a){var c=this.tn.next();if(!b.TYPEREF.test(c))throw Error("illegal extend reference: "+c);var d={ref:c,fields:[]};for(this.tn.skip("{");"}"!==(c=this.tn.next());)if(b.RULE.test(c))this._parseMessageField(d,c);else{
if(!b.TYPEREF.test(c))throw Error("illegal extend token: "+c);if(!this.proto3)throw Error("illegal field rule: "+c);this._parseMessageField(d,"optional",c)}return this.tn.omit(";"),a.messages.push(d),d},j.toString=function(){return"Parser at line "+this.tn.line},f.Parser=i,f}(e,e.Lang),e.Reflect=function(a){function c(c){if("string"==typeof c&&(c=a.TYPES[c]),"undefined"==typeof c.defaultValue)throw Error("default value for type "+c.name+" is not supported");return c==a.TYPES.bytes?new b(0):c.defaultValue}function d(b,c){if(b&&"number"==typeof b.low&&"number"==typeof b.high&&"boolean"==typeof b.unsigned&&b.low===b.low&&b.high===b.high)return new a.Long(b.low,b.high,"undefined"==typeof c?b.unsigned:c);if("string"==typeof b)return a.Long.fromString(b,c||!1,10);if("number"==typeof b)return a.Long.fromNumber(b,c||!1);throw Error("not convertible to Long")}function e(b,c){var d=c.readVarint32(),f=7&d,g=d>>>3;switch(f){case a.WIRE_TYPES.VARINT:do d=c.readUint8();while(128===(128&d));break;case a.WIRE_TYPES.BITS64:c.offset+=8;break;case a.WIRE_TYPES.LDELIM:d=c.readVarint32(),c.offset+=d;break;case a.WIRE_TYPES.STARTGROUP:e(g,c);break;case a.WIRE_TYPES.ENDGROUP:if(g===b)return!1;throw Error("Illegal GROUPEND after unknown group: "+g+" ("+b+" expected)");case a.WIRE_TYPES.BITS32:c.offset+=4;break;default:throw Error("Illegal wire type in unknown group "+b+": "+f)}return!0}var f={},g=function(a,b,c){this.builder=a,this.parent=b,this.name=c,this.className},h=g.prototype;h.fqn=function(){for(var a=this.name,b=this;;){if(b=b.parent,null==b)break;a=b.name+"."+a}return a},h.toString=function(a){return(a?this.className+" ":"")+this.fqn()},h.build=function(){throw Error(this.toString(!0)+" cannot be built directly")},f.T=g;var i=function(a,b,c,d,e){g.call(this,a,b,c),this.className="Namespace",this.children=[],this.options=d||{},this.syntax=e||"proto2"},j=i.prototype=Object.create(g.prototype);j.getChildren=function(a){if(a=a||null,null==a)return this.children.slice();for(var b=[],c=0,d=this.children.length;c<d;++c)this.children[c]instanceof a&&b.push(this.children[c]);return b},j.addChild=function(a){var b;if(b=this.getChild(a.name))if(b instanceof m.Field&&b.name!==b.originalName&&null===this.getChild(b.originalName))b.name=b.originalName;else{if(!(a instanceof m.Field&&a.name!==a.originalName&&null===this.getChild(a.originalName)))throw Error("Duplicate name in namespace "+this.toString(!0)+": "+a.name);a.name=a.originalName}this.children.push(a)},j.getChild=function(a){for(var b="number"==typeof a?"id":"name",c=0,d=this.children.length;c<d;++c)if(this.children[c][b]===a)return this.children[c];return null},j.resolve=function(a,b){var c="string"==typeof a?a.split("."):a,d=this,e=0;if(""===c[e]){for(;null!==d.parent;)d=d.parent;e++}var g;do{do{if(!(d instanceof f.Namespace)){d=null;break}if(g=d.getChild(c[e]),!g||!(g instanceof f.T)||b&&!(g instanceof f.Namespace)){d=null;break}d=g,e++}while(e<c.length);if(null!=d)break;if(null!==this.parent)return this.parent.resolve(a,b)}while(null!=d);return d},j.qn=function(a){var b=[],c=a;do b.unshift(c.name),c=c.parent;while(null!==c);for(var d=1;d<=b.length;d++){var e=b.slice(b.length-d);if(a===this.resolve(e,a instanceof f.Namespace))return e.join(".")}return a.fqn()},j.build=function(){for(var a,b={},c=this.children,d=0,e=c.length;d<e;++d)a=c[d],a instanceof i&&(b[a.name]=a.build());return Object.defineProperty&&Object.defineProperty(b,"$options",{value:this.buildOpt()}),b},j.buildOpt=function(){for(var a={},b=Object.keys(this.options),c=0,d=b.length;c<d;++c){var e=b[c],f=this.options[b[c]];a[e]=f}return a},j.getOption=function(a){return"undefined"==typeof a?this.options:"undefined"!=typeof this.options[a]?this.options[a]:null},f.Namespace=i;var k=function(b,c,d,e){if(this.type=b,this.resolvedType=c,this.isMapKey=d,this.syntax=e,d&&a.MAP_KEY_TYPES.indexOf(b)<0)throw Error("Invalid map key type: "+b.name)},l=k.prototype;k.defaultFieldValue=c,l.verifyValue=function(c){var e=function(a,b){throw Error("Illegal value for "+this.toString(!0)+" of type "+this.type.name+": "+a+" ("+b+")")}.bind(this);switch(this.type){case a.TYPES.int32:case a.TYPES.sint32:case a.TYPES.sfixed32:return("number"!=typeof c||c===c&&c%1!==0)&&e(typeof c,"not an integer"),c>4294967295?0|c:c;case a.TYPES.uint32:case a.TYPES.fixed32:return("number"!=typeof c||c===c&&c%1!==0)&&e(typeof c,"not an integer"),c<0?c>>>0:c;case a.TYPES.int64:case a.TYPES.sint64:case a.TYPES.sfixed64:if(a.Long)try{return d(c,!1)}catch(f){e(typeof c,f.message)}else e(typeof c,"requires Long.js");case a.TYPES.uint64:case a.TYPES.fixed64:if(a.Long)try{return d(c,!0)}catch(f){e(typeof c,f.message)}else e(typeof c,"requires Long.js");case a.TYPES.bool:return"boolean"!=typeof c&&e(typeof c,"not a boolean"),c;case a.TYPES["float"]:case a.TYPES["double"]:return"number"!=typeof c&&e(typeof c,"not a number"),c;case a.TYPES.string:return"string"==typeof c||c&&c instanceof String||e(typeof c,"not a string"),""+c;case a.TYPES.bytes:return b.isByteBuffer(c)?c:b.wrap(c,"base64");case a.TYPES["enum"]:var g=this.resolvedType.getChildren(a.Reflect.Enum.Value);for(i=0;i<g.length;i++){if(g[i].name==c)return g[i].id;if(g[i].id==c)return g[i].id}if("proto3"===this.syntax)return("number"!=typeof c||c===c&&c%1!==0)&&e(typeof c,"not an integer"),(c>4294967295||c<0)&&e(typeof c,"not in range for uint32"),c;e(c,"not a valid enum value");case a.TYPES.group:case a.TYPES.message:if(c&&"object"==typeof c||e(typeof c,"object expected"),c instanceof this.resolvedType.clazz)return c;if(c instanceof a.Builder.Message){var h={};for(var i in c)c.hasOwnProperty(i)&&(h[i]=c[i]);c=h}return new this.resolvedType.clazz(c)}throw Error("[INTERNAL] Illegal value for "+this.toString(!0)+": "+c+" (undefined type "+this.type+")")},l.calculateLength=function(c,d){if(null===d)return 0;var e;switch(this.type){case a.TYPES.int32:return d<0?b.calculateVarint64(d):b.calculateVarint32(d);case a.TYPES.uint32:return b.calculateVarint32(d);case a.TYPES.sint32:return b.calculateVarint32(b.zigZagEncode32(d));case a.TYPES.fixed32:case a.TYPES.sfixed32:case a.TYPES["float"]:return 4;case a.TYPES.int64:case a.TYPES.uint64:return b.calculateVarint64(d);case a.TYPES.sint64:return b.calculateVarint64(b.zigZagEncode64(d));case a.TYPES.fixed64:case a.TYPES.sfixed64:return 8;case a.TYPES.bool:return 1;case a.TYPES["enum"]:return b.calculateVarint32(d);case a.TYPES["double"]:return 8;case a.TYPES.string:return e=b.calculateUTF8Bytes(d),b.calculateVarint32(e)+e;case a.TYPES.bytes:if(d.remaining()<0)throw Error("Illegal value for "+this.toString(!0)+": "+d.remaining()+" bytes remaining");return b.calculateVarint32(d.remaining())+d.remaining();case a.TYPES.message:return e=this.resolvedType.calculate(d),b.calculateVarint32(e)+e;case a.TYPES.group:return e=this.resolvedType.calculate(d),e+b.calculateVarint32(c<<3|a.WIRE_TYPES.ENDGROUP)}throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+d+" (unknown type)")},l.encodeValue=function(c,d,e){if(null===d)return e;switch(this.type){case a.TYPES.int32:d<0?e.writeVarint64(d):e.writeVarint32(d);break;case a.TYPES.uint32:e.writeVarint32(d);break;case a.TYPES.sint32:e.writeVarint32ZigZag(d);break;case a.TYPES.fixed32:e.writeUint32(d);break;case a.TYPES.sfixed32:e.writeInt32(d);break;case a.TYPES.int64:case a.TYPES.uint64:e.writeVarint64(d);break;case a.TYPES.sint64:e.writeVarint64ZigZag(d);break;case a.TYPES.fixed64:e.writeUint64(d);break;case a.TYPES.sfixed64:e.writeInt64(d);break;case a.TYPES.bool:"string"==typeof d?e.writeVarint32("false"===d.toLowerCase()?0:!!d):e.writeVarint32(d?1:0);break;case a.TYPES["enum"]:e.writeVarint32(d);break;case a.TYPES["float"]:e.writeFloat32(d);break;case a.TYPES["double"]:e.writeFloat64(d);break;case a.TYPES.string:e.writeVString(d);break;case a.TYPES.bytes:if(d.remaining()<0)throw Error("Illegal value for "+this.toString(!0)+": "+d.remaining()+" bytes remaining");var f=d.offset;e.writeVarint32(d.remaining()),e.append(d),d.offset=f;break;case a.TYPES.message:var g=(new b).LE();this.resolvedType.encode(d,g),e.writeVarint32(g.offset),e.append(g.flip());break;case a.TYPES.group:this.resolvedType.encode(d,e),e.writeVarint32(c<<3|a.WIRE_TYPES.ENDGROUP);break;default:throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+d+" (unknown type)")}return e},l.decode=function(b,c,d){if(c!=this.type.wireType)throw Error("Unexpected wire type for element");var e,f;switch(this.type){case a.TYPES.int32:return 0|b.readVarint32();case a.TYPES.uint32:return b.readVarint32()>>>0;case a.TYPES.sint32:return 0|b.readVarint32ZigZag();case a.TYPES.fixed32:return b.readUint32()>>>0;case a.TYPES.sfixed32:return 0|b.readInt32();case a.TYPES.int64:return b.readVarint64();case a.TYPES.uint64:return b.readVarint64().toUnsigned();case a.TYPES.sint64:return b.readVarint64ZigZag();case a.TYPES.fixed64:return b.readUint64();case a.TYPES.sfixed64:return b.readInt64();case a.TYPES.bool:return!!b.readVarint32();case a.TYPES["enum"]:return b.readVarint32();case a.TYPES["float"]:return b.readFloat();case a.TYPES["double"]:return b.readDouble();case a.TYPES.string:return b.readVString();case a.TYPES.bytes:if(f=b.readVarint32(),b.remaining()<f)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+f+" required but got only "+b.remaining());return e=b.clone(),e.limit=e.offset+f,b.offset+=f,e;case a.TYPES.message:return f=b.readVarint32(),this.resolvedType.decode(b,f);case a.TYPES.group:return this.resolvedType.decode(b,-1,d)}throw Error("[INTERNAL] Illegal decode type")},l.valueFromString=function(c){if(!this.isMapKey)throw Error("valueFromString() called on non-map-key element");switch(this.type){case a.TYPES.int32:case a.TYPES.sint32:case a.TYPES.sfixed32:case a.TYPES.uint32:case a.TYPES.fixed32:return this.verifyValue(parseInt(c));case a.TYPES.int64:case a.TYPES.sint64:case a.TYPES.sfixed64:case a.TYPES.uint64:case a.TYPES.fixed64:return this.verifyValue(c);case a.TYPES.bool:return"true"===c;case a.TYPES.string:return this.verifyValue(c);case a.TYPES.bytes:return b.fromBinary(c)}},l.valueToString=function(b){if(!this.isMapKey)throw Error("valueToString() called on non-map-key element");return this.type===a.TYPES.bytes?b.toString("binary"):b.toString()},f.Element=k;var m=function(b,c,d,e,f,g){i.call(this,b,c,d,e,g),this.className="Message",this.extensions=[a.ID_MIN,a.ID_MAX],this.clazz=null,this.isGroup=!!f,this._fields=null,this._fieldsById=null,this._fieldsByName=null},n=m.prototype=Object.create(i.prototype);n.build=function(c){if(this.clazz&&!c)return this.clazz;var d=function(a,c){function d(c,e,f,g){if(null===c||"object"!=typeof c){if(g&&g instanceof a.Reflect.Enum){var h=a.Reflect.Enum.getName(g.object,c);if(null!==h)return h}return c}if(b.isByteBuffer(c))return e?c.toBase64():c.toBuffer();if(a.Long.isLong(c))return f?c.toString():new a.Long(c);var i;if(Array.isArray(c))return i=[],c.forEach(function(a,b){i[b]=d(a,e,f,g)}),i;if(i={},c instanceof a.Map){for(var j=c.entries(),k=j.next();!k.done;k=j.next())i[c.keyElem.valueToString(k.value[0])]=d(k.value[1],e,f,c.valueElem.resolvedType);return i}var l=c.$type,m=void 0;for(var n in c)c.hasOwnProperty(n)&&(l&&(m=l.getChild(n))?i[n]=d(c[n],e,f,m.resolvedType):i[n]=d(c[n],e,f));return i}var e=c.getChildren(a.Reflect.Message.Field),f=c.getChildren(a.Reflect.Message.OneOf),g=function(d,h){a.Builder.Message.call(this);for(var i=0,j=f.length;i<j;++i)this[f[i].name]=null;for(i=0,j=e.length;i<j;++i){var k=e[i];this[k.name]=k.repeated?[]:k.map?new a.Map(k):null,!k.required&&"proto3"!==c.syntax||null===k.defaultValue||(this[k.name]=k.defaultValue)}if(arguments.length>0){var l;if(1!==arguments.length||null===d||"object"!=typeof d||!("function"!=typeof d.encode||d instanceof g)||Array.isArray(d)||d instanceof a.Map||b.isByteBuffer(d)||d instanceof ArrayBuffer||a.Long&&d instanceof a.Long)for(i=0,j=arguments.length;i<j;++i)"undefined"!=typeof(l=arguments[i])&&this.$set(e[i].name,l);else this.$set(d)}},h=g.prototype=Object.create(a.Builder.Message.prototype);h.add=function(b,d,e){var f=c._fieldsByName[b];if(!e){if(!f)throw Error(this+"#"+b+" is undefined");if(!(f instanceof a.Reflect.Message.Field))throw Error(this+"#"+b+" is not a field: "+f.toString(!0));if(!f.repeated)throw Error(this+"#"+b+" is not a repeated field");d=f.verifyValue(d,!0)}return null===this[b]&&(this[b]=[]),this[b].push(d),this},h.$add=h.add,h.set=function(b,d,e){if(b&&"object"==typeof b){e=d;for(var f in b)b.hasOwnProperty(f)&&"undefined"!=typeof(d=b[f])&&this.$set(f,d,e);return this}var g=c._fieldsByName[b];if(e)this[b]=d;else{if(!g)throw Error(this+"#"+b+" is not a field: undefined");if(!(g instanceof a.Reflect.Message.Field))throw Error(this+"#"+b+" is not a field: "+g.toString(!0));this[g.name]=d=g.verifyValue(d)}if(g&&g.oneof){var h=this[g.oneof.name];null!==d?(null!==h&&h!==g.name&&(this[h]=null),this[g.oneof.name]=g.name):h===b&&(this[g.oneof.name]=null)}return this},h.$set=h.set,h.get=function(b,d){if(d)return this[b];var e=c._fieldsByName[b];if(!(e&&e instanceof a.Reflect.Message.Field))throw Error(this+"#"+b+" is not a field: undefined");if(!(e instanceof a.Reflect.Message.Field))throw Error(this+"#"+b+" is not a field: "+e.toString(!0));return this[e.name]},h.$get=h.get;for(var i=0;i<e.length;i++){var j=e[i];j instanceof a.Reflect.Message.ExtensionField||c.builder.options.populateAccessors&&function(a){var b=a.originalName.replace(/(_[a-zA-Z])/g,function(a){return a.toUpperCase().replace("_","")});b=b.substring(0,1).toUpperCase()+b.substring(1);var d=a.originalName.replace(/([A-Z])/g,function(a){return"_"+a}),e=function(b,c){return this[a.name]=c?b:a.verifyValue(b),this},f=function(){return this[a.name]};null===c.getChild("set"+b)&&(h["set"+b]=e),null===c.getChild("set_"+d)&&(h["set_"+d]=e),null===c.getChild("get"+b)&&(h["get"+b]=f),null===c.getChild("get_"+d)&&(h["get_"+d]=f)}(j)}h.encode=function(a,d){"boolean"==typeof a&&(d=a,a=void 0);var e=!1;a||(a=new b,e=!0);var f=a.littleEndian;try{return c.encode(this,a.LE(),d),(e?a.flip():a).LE(f)}catch(g){throw a.LE(f),g}},g.encode=function(a,b,c){return new g(a).encode(b,c)},h.calculate=function(){return c.calculate(this)},h.encodeDelimited=function(a){var d=!1;a||(a=new b,d=!0);var e=(new b).LE();return c.encode(this,e).flip(),a.writeVarint32(e.remaining()),a.append(e),d?a.flip():a},h.encodeAB=function(){try{return this.encode().toArrayBuffer()}catch(a){throw a.encoded&&(a.encoded=a.encoded.toArrayBuffer()),a}},h.toArrayBuffer=h.encodeAB,h.encodeNB=function(){try{return this.encode().toBuffer()}catch(a){throw a.encoded&&(a.encoded=a.encoded.toBuffer()),a}},h.toBuffer=h.encodeNB,h.encode64=function(){try{return this.encode().toBase64()}catch(a){throw a.encoded&&(a.encoded=a.encoded.toBase64()),a}},h.toBase64=h.encode64,h.encodeHex=function(){try{return this.encode().toHex()}catch(a){throw a.encoded&&(a.encoded=a.encoded.toHex()),a}},h.toHex=h.encodeHex,h.toRaw=function(a,b){return d(this,!!a,!!b,this.$type)},h.encodeJSON=function(){return JSON.stringify(d(this,!0,!0,this.$type))},g.decode=function(a,d){"string"==typeof a&&(a=b.wrap(a,d?d:"base64")),a=b.isByteBuffer(a)?a:b.wrap(a);var e=a.littleEndian;try{var f=c.decode(a.LE());return a.LE(e),f}catch(g){throw a.LE(e),g}},g.decodeDelimited=function(a,d){if("string"==typeof a&&(a=b.wrap(a,d?d:"base64")),a=b.isByteBuffer(a)?a:b.wrap(a),a.remaining()<1)return null;var e=a.offset,f=a.readVarint32();if(a.remaining()<f)return a.offset=e,null;try{var g=c.decode(a.slice(a.offset,a.offset+f).LE());return a.offset+=f,g}catch(h){throw a.offset+=f,h}},g.decode64=function(a){return g.decode(a,"base64")},g.decodeHex=function(a){return g.decode(a,"hex")},g.decodeJSON=function(a){return new g(JSON.parse(a))},h.toString=function(){return c.toString()};return Object.defineProperty&&(Object.defineProperty(g,"$options",{value:c.buildOpt()}),Object.defineProperty(h,"$options",{value:g.$options}),Object.defineProperty(g,"$type",{value:c}),Object.defineProperty(h,"$type",{value:c})),g}(a,this);this._fields=[],this._fieldsById={},this._fieldsByName={};for(var e,f=0,g=this.children.length;f<g;f++)if(e=this.children[f],e instanceof s||e instanceof m||e instanceof w){if(d.hasOwnProperty(e.name))throw Error("Illegal reflect child of "+this.toString(!0)+": "+e.toString(!0)+" cannot override static property '"+e.name+"'");d[e.name]=e.build()}else if(e instanceof m.Field)e.build(),this._fields.push(e),this._fieldsById[e.id]=e,this._fieldsByName[e.name]=e;else if(!(e instanceof m.OneOf||e instanceof v))throw Error("Illegal reflect child of "+this.toString(!0)+": "+this.children[f].toString(!0));return this.clazz=d},n.encode=function(a,b,c){for(var d,e,f=null,g=0,h=this._fields.length;g<h;++g)d=this._fields[g],e=a[d.name],d.required&&null===e?null===f&&(f=d):d.encode(c?e:d.verifyValue(e),b,a);if(null!==f){var i=Error("Missing at least one required field for "+this.toString(!0)+": "+f);throw i.encoded=b,i}return b},n.calculate=function(a){for(var b,c,d=0,e=0,f=this._fields.length;e<f;++e){if(b=this._fields[e],c=a[b.name],b.required&&null===c)throw Error("Missing at least one required field for "+this.toString(!0)+": "+b);d+=b.calculate(c,a)}return d},n.decode=function(b,c,d){c="number"==typeof c?c:-1;for(var f,g,h,i,j=b.offset,k=new this.clazz;b.offset<j+c||c===-1&&b.remaining()>0;){if(f=b.readVarint32(),g=7&f,h=f>>>3,g===a.WIRE_TYPES.ENDGROUP){if(h!==d)throw Error("Illegal group end indicator for "+this.toString(!0)+": "+h+" ("+(d?d+" expected":"not a group")+")");break}if(i=this._fieldsById[h]){if(i.repeated&&!i.options.packed)k[i.name].push(i.decode(g,b));else if(i.map){var l=i.decode(g,b);k[i.name].set(l[0],l[1])}else if(k[i.name]=i.decode(g,b),i.oneof){var m=k[i.oneof.name];null!==m&&m!==i.name&&(k[m]=null),k[i.oneof.name]=i.name}}else switch(g){case a.WIRE_TYPES.VARINT:b.readVarint32();break;case a.WIRE_TYPES.BITS32:b.offset+=4;break;case a.WIRE_TYPES.BITS64:b.offset+=8;break;case a.WIRE_TYPES.LDELIM:var n=b.readVarint32();b.offset+=n;break;case a.WIRE_TYPES.STARTGROUP:for(;e(h,b););break;default:throw Error("Illegal wire type for unknown field "+h+" in "+this.toString(!0)+"#decode: "+g)}}for(var o=0,p=this._fields.length;o<p;++o)if(i=this._fields[o],null===k[i.name])if("proto3"===this.syntax)k[i.name]=i.defaultValue;else{if(i.required){var q=Error("Missing at least one required field for "+this.toString(!0)+": "+i.name);throw q.decoded=k,q}a.populateDefaults&&null!==i.defaultValue&&(k[i.name]=i.defaultValue)}return k},f.Message=m;var o=function(b,c,d,e,f,h,i,j,k,l){g.call(this,b,c,h),this.className="Message.Field",this.required="required"===d,this.repeated="repeated"===d,this.map="map"===d,this.keyType=e||null,this.type=f,this.resolvedType=null,this.id=i,this.options=j||{},this.defaultValue=null,this.oneof=k||null,this.syntax=l||"proto2",this.originalName=this.name,this.element=null,this.keyElement=null,!this.builder.options.convertFieldsToCamelCase||this instanceof m.ExtensionField||(this.name=a.Util.toCamelCase(this.name))},p=o.prototype=Object.create(g.prototype);p.build=function(){this.element=new k(this.type,this.resolvedType,(!1),this.syntax),this.map&&(this.keyElement=new k(this.keyType,(void 0),(!0),this.syntax)),"proto3"!==this.syntax||this.repeated||this.map?"undefined"!=typeof this.options["default"]&&(this.defaultValue=this.verifyValue(this.options["default"])):this.defaultValue=k.defaultFieldValue(this.type)},p.verifyValue=function(b,c){c=c||!1;var d=function(a,b){throw Error("Illegal value for "+this.toString(!0)+" of type "+this.type.name+": "+a+" ("+b+")")}.bind(this);if(null===b)return this.required&&d(typeof b,"required"),"proto3"===this.syntax&&this.type!==a.TYPES.message&&d(typeof b,"proto3 field without field presence cannot be null"),null;var e;if(this.repeated&&!c){Array.isArray(b)||(b=[b]);var f=[];for(e=0;e<b.length;e++)f.push(this.element.verifyValue(b[e]));return f}return this.map&&!c?b instanceof a.Map?b:(b instanceof Object||d(typeof b,"expected ProtoBuf.Map or raw object for map field"),new a.Map(this,b)):(!this.repeated&&Array.isArray(b)&&d(typeof b,"no array expected"),this.element.verifyValue(b))},p.hasWirePresence=function(b,c){if("proto3"!==this.syntax)return null!==b;if(this.oneof&&c[this.oneof.name]===this.name)return!0;switch(this.type){case a.TYPES.int32:case a.TYPES.sint32:case a.TYPES.sfixed32:case a.TYPES.uint32:case a.TYPES.fixed32:return 0!==b;case a.TYPES.int64:case a.TYPES.sint64:case a.TYPES.sfixed64:case a.TYPES.uint64:case a.TYPES.fixed64:return 0!==b.low||0!==b.high;case a.TYPES.bool:return b;case a.TYPES["float"]:case a.TYPES["double"]:return 0!==b;case a.TYPES.string:return b.length>0;case a.TYPES.bytes:return b.remaining()>0;case a.TYPES["enum"]:return 0!==b;case a.TYPES.message:return null!==b;default:return!0}},p.encode=function(c,d,e){if(null===this.type||"object"!=typeof this.type)throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===c||this.repeated&&0==c.length)return d;try{if(this.repeated){var f;if(this.options.packed&&a.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0){d.writeVarint32(this.id<<3|a.WIRE_TYPES.LDELIM),d.ensureCapacity(d.offset+=1);var g=d.offset;for(f=0;f<c.length;f++)this.element.encodeValue(this.id,c[f],d);var h=d.offset-g,i=b.calculateVarint32(h);if(i>1){var j=d.slice(g,d.offset);g+=i-1,d.offset=g,d.append(j)}d.writeVarint32(h,g-i)}else for(f=0;f<c.length;f++)d.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,c[f],d)}else this.map?c.forEach(function(c,e,f){var g=b.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,e)+b.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,c);d.writeVarint32(this.id<<3|a.WIRE_TYPES.LDELIM),d.writeVarint32(g),d.writeVarint32(8|this.keyType.wireType),this.keyElement.encodeValue(1,e,d),d.writeVarint32(16|this.type.wireType),this.element.encodeValue(2,c,d)},this):this.hasWirePresence(c,e)&&(d.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,c,d))}catch(k){throw Error("Illegal value for "+this.toString(!0)+": "+c+" ("+k+")")}return d},p.calculate=function(c,d){if(c=this.verifyValue(c),null===this.type||"object"!=typeof this.type)throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===c||this.repeated&&0==c.length)return 0;var e=0;try{if(this.repeated){var f,g;if(this.options.packed&&a.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0){for(e+=b.calculateVarint32(this.id<<3|a.WIRE_TYPES.LDELIM),g=0,f=0;f<c.length;f++)g+=this.element.calculateLength(this.id,c[f]);e+=b.calculateVarint32(g),e+=g}else for(f=0;f<c.length;f++)e+=b.calculateVarint32(this.id<<3|this.type.wireType),e+=this.element.calculateLength(this.id,c[f])}else this.map?c.forEach(function(c,d,f){var g=b.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,d)+b.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,c);e+=b.calculateVarint32(this.id<<3|a.WIRE_TYPES.LDELIM),e+=b.calculateVarint32(g),e+=g},this):this.hasWirePresence(c,d)&&(e+=b.calculateVarint32(this.id<<3|this.type.wireType),e+=this.element.calculateLength(this.id,c))}catch(h){throw Error("Illegal value for "+this.toString(!0)+": "+c+" ("+h+")")}return e},p.decode=function(b,c,d){var e,f,g=!this.map&&b==this.type.wireType||!d&&this.repeated&&this.options.packed&&b==a.WIRE_TYPES.LDELIM||this.map&&b==a.WIRE_TYPES.LDELIM;if(!g)throw Error("Illegal wire type for field "+this.toString(!0)+": "+b+" ("+this.type.wireType+" expected)");if(b==a.WIRE_TYPES.LDELIM&&this.repeated&&this.options.packed&&a.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0&&!d){f=c.readVarint32(),f=c.offset+f;for(var h=[];c.offset<f;)h.push(this.decode(this.type.wireType,c,!0));return h}if(this.map){var i=k.defaultFieldValue(this.keyType);if(e=k.defaultFieldValue(this.type),f=c.readVarint32(),c.remaining()<f)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+f+" required but got only "+c.remaining());var j=c.clone();for(j.limit=j.offset+f,c.offset+=f;j.remaining()>0;){var l=j.readVarint32();b=7&l;var m=l>>>3;if(1===m)i=this.keyElement.decode(j,b,m);else{if(2!==m)throw Error("Unexpected tag in map field key/value submessage");e=this.element.decode(j,b,m)}}return[i,e]}return this.element.decode(c,b,this.id)},f.Message.Field=o;var q=function(a,b,c,d,e,f,g){o.call(this,a,b,c,null,d,e,f,g),this.extension};q.prototype=Object.create(o.prototype),f.Message.ExtensionField=q;var r=function(a,b,c){g.call(this,a,b,c),this.fields=[]};f.Message.OneOf=r;var s=function(a,b,c,d,e){i.call(this,a,b,c,d,e),this.className="Enum",this.object=null};s.getName=function(a,b){for(var c,d=Object.keys(a),e=0;e<d.length;++e)if(a[c=d[e]]===b)return c;return null};var t=s.prototype=Object.create(i.prototype);t.build=function(b){if(this.object&&!b)return this.object;for(var c=new a.Builder.Enum,d=this.getChildren(s.Value),e=0,f=d.length;e<f;++e)c[d[e].name]=d[e].id;return Object.defineProperty&&Object.defineProperty(c,"$options",{value:this.buildOpt(),enumerable:!1}),this.object=c},f.Enum=s;var u=function(a,b,c,d){g.call(this,a,b,c),this.className="Enum.Value",this.id=d};u.prototype=Object.create(g.prototype),f.Enum.Value=u;var v=function(a,b,c,d){g.call(this,a,b,c),this.field=d};v.prototype=Object.create(g.prototype),f.Extension=v;var w=function(a,b,c,d){i.call(this,a,b,c,d),this.className="Service",this.clazz=null},x=w.prototype=Object.create(i.prototype);x.build=function(c){return this.clazz&&!c?this.clazz:this.clazz=function(a,c){for(var d=function(b){a.Builder.Service.call(this),this.rpcImpl=b||function(a,b,c){setTimeout(c.bind(this,Error("Not implemented, see: https://github.com/dcodeIO/ProtoBuf.js/wiki/Services")),0)}},e=d.prototype=Object.create(a.Builder.Service.prototype),f=c.getChildren(a.Reflect.Service.RPCMethod),g=0;g<f.length;g++)!function(a){e[a.name]=function(d,e){try{try{d=a.resolvedRequestType.clazz.decode(b.wrap(d))}catch(f){if(!(f instanceof TypeError))throw f}if(null===d||"object"!=typeof d)throw Error("Illegal arguments");d instanceof a.resolvedRequestType.clazz||(d=new a.resolvedRequestType.clazz(d)),this.rpcImpl(a.fqn(),d,function(b,d){if(b)return void e(b);try{d=a.resolvedResponseType.clazz.decode(d)}catch(f){}return d&&d instanceof a.resolvedResponseType.clazz?void e(null,d):void e(Error("Illegal response type received in service method "+c.name+"#"+a.name))})}catch(f){setTimeout(e.bind(this,f),0)}},d[a.name]=function(b,c,e){new d(b)[a.name](c,e)},Object.defineProperty&&(Object.defineProperty(d[a.name],"$options",{value:a.buildOpt()}),Object.defineProperty(e[a.name],"$options",{value:d[a.name].$options}))}(f[g]);return Object.defineProperty&&(Object.defineProperty(d,"$options",{value:c.buildOpt()}),Object.defineProperty(e,"$options",{value:d.$options}),Object.defineProperty(d,"$type",{value:c}),Object.defineProperty(e,"$type",{value:c})),d}(a,this)},f.Service=w;var y=function(a,b,c,d){g.call(this,a,b,c),this.className="Service.Method",this.options=d||{}},z=y.prototype=Object.create(g.prototype);z.buildOpt=j.buildOpt,f.Service.Method=y;var A=function(a,b,c,d,e,f,g,h){y.call(this,a,b,c,h),this.className="Service.RPCMethod",this.requestName=d,this.responseName=e,this.requestStream=f,this.responseStream=g,this.resolvedRequestType=null,this.resolvedResponseType=null};return A.prototype=Object.create(y.prototype),f.Service.RPCMethod=A,f}(e),e.Builder=function(a,b,d){function e(a){a.messages&&a.messages.forEach(function(b){b.syntax=a.syntax,e(b)}),a.enums&&a.enums.forEach(function(b){b.syntax=a.syntax})}var f=function(a){this.ns=new d.Namespace(this,null,""),this.ptr=this.ns,this.resolved=!1,this.result=null,this.files={},this.importRoot=null,this.options=a||{}},g=f.prototype;return f.isMessage=function(a){return"string"==typeof a.name&&("undefined"==typeof a.values&&"undefined"==typeof a.rpc)},f.isMessageField=function(a){return"string"==typeof a.rule&&"string"==typeof a.name&&"string"==typeof a.type&&"undefined"!=typeof a.id},f.isEnum=function(a){return"string"==typeof a.name&&!("undefined"==typeof a.values||!Array.isArray(a.values)||0===a.values.length)},f.isService=function(a){return!("string"!=typeof a.name||"object"!=typeof a.rpc||!a.rpc)},f.isExtend=function(a){return"string"==typeof a.ref},g.reset=function(){return this.ptr=this.ns,this},g.define=function(a){if("string"!=typeof a||!b.TYPEREF.test(a))throw Error("illegal namespace: "+a);return a.split(".").forEach(function(a){var b=this.ptr.getChild(a);null===b&&this.ptr.addChild(b=new d.Namespace(this,this.ptr,a)),this.ptr=b},this),this},g.create=function(b){if(!b)return this;if(Array.isArray(b)){if(0===b.length)return this;b=b.slice()}else b=[b];for(var c=[b];c.length>0;){if(b=c.pop(),!Array.isArray(b))throw Error("not a valid namespace: "+JSON.stringify(b));for(;b.length>0;){var e=b.shift();if(f.isMessage(e)){var g=new d.Message(this,this.ptr,e.name,e.options,e.isGroup,e.syntax),h={};e.oneofs&&Object.keys(e.oneofs).forEach(function(a){g.addChild(h[a]=new d.Message.OneOf(this,g,a))},this),e.fields&&e.fields.forEach(function(a){if(null!==g.getChild(0|a.id))throw Error("duplicate or invalid field id in "+g.name+": "+a.id);if(a.options&&"object"!=typeof a.options)throw Error("illegal field options in "+g.name+"#"+a.name);var b=null;if("string"==typeof a.oneof&&!(b=h[a.oneof]))throw Error("illegal oneof in "+g.name+"#"+a.name+": "+a.oneof);a=new d.Message.Field(this,g,a.rule,a.keytype,a.type,a.name,a.id,a.options,b,e.syntax),b&&b.fields.push(a),g.addChild(a)},this);var i=[];if(e.enums&&e.enums.forEach(function(a){i.push(a)}),e.messages&&e.messages.forEach(function(a){i.push(a)}),e.services&&e.services.forEach(function(a){i.push(a)}),e.extensions&&(g.extensions=e.extensions,g.extensions[0]<a.ID_MIN&&(g.extensions[0]=a.ID_MIN),g.extensions[1]>a.ID_MAX&&(g.extensions[1]=a.ID_MAX)),this.ptr.addChild(g),i.length>0){c.push(b),b=i,i=null,this.ptr=g,g=null;continue}i=null}else if(f.isEnum(e))g=new d.Enum(this,this.ptr,e.name,e.options,e.syntax),e.values.forEach(function(a){g.addChild(new d.Enum.Value(this,g,a.name,a.id))},this),this.ptr.addChild(g);else if(f.isService(e))g=new d.Service(this,this.ptr,e.name,e.options),Object.keys(e.rpc).forEach(function(a){var b=e.rpc[a];g.addChild(new d.Service.RPCMethod(this,g,a,b.request,b.response,(!!b.request_stream),(!!b.response_stream),b.options))},this),this.ptr.addChild(g);else{if(!f.isExtend(e))throw Error("not a valid definition: "+JSON.stringify(e));if(g=this.ptr.resolve(e.ref,!0))e.fields.forEach(function(b){if(null!==g.getChild(0|b.id))throw Error("duplicate extended field id in "+g.name+": "+b.id);if(b.id<g.extensions[0]||b.id>g.extensions[1])throw Error("illegal extended field id in "+g.name+": "+b.id+" ("+g.extensions.join(" to ")+" expected)");var c=b.name;this.options.convertFieldsToCamelCase&&(c=a.Util.toCamelCase(c));var e=new d.Message.ExtensionField(this,g,b.rule,b.type,this.ptr.fqn()+"."+c,b.id,b.options),f=new d.Extension(this,this.ptr,b.name,e);e.extension=f,this.ptr.addChild(f),g.addChild(e)},this);else if(!/\.?google\.protobuf\./.test(e.ref))throw Error("extended message "+e.ref+" is not defined")}e=null,g=null}b=null,this.ptr=this.ptr.parent}return this.resolved=!1,this.result=null,this},g["import"]=function(b,d){var f="/";if("string"==typeof d){if(a.Util.IS_NODE&&(d=c(19).resolve(d)),this.files[d]===!0)return this.reset();this.files[d]=!0}else if("object"==typeof d){var g=d.root;a.Util.IS_NODE&&(g=c(19).resolve(g)),(g.indexOf("\\")>=0||d.file.indexOf("\\")>=0)&&(f="\\");var h=g+f+d.file;if(this.files[h]===!0)return this.reset();this.files[h]=!0}if(b.imports&&b.imports.length>0){var i,j=!1;"object"==typeof d?(this.importRoot=d.root,j=!0,i=this.importRoot,d=d.file,(i.indexOf("\\")>=0||d.indexOf("\\")>=0)&&(f="\\")):"string"==typeof d?this.importRoot?i=this.importRoot:d.indexOf("/")>=0?(i=d.replace(/\/[^\/]*$/,""),""===i&&(i="/")):d.indexOf("\\")>=0?(i=d.replace(/\\[^\\]*$/,""),f="\\"):i=".":i=null;for(var k=0;k<b.imports.length;k++)if("string"==typeof b.imports[k]){if(!i)throw Error("cannot determine import root");
var l=b.imports[k];if("google/protobuf/descriptor.proto"===l)continue;if(l=i+f+l,this.files[l]===!0)continue;/\.proto$/i.test(l)&&!a.DotProto&&(l=l.replace(/\.proto$/,".json"));var m=a.Util.fetch(l);if(null===m)throw Error("failed to import '"+l+"' in '"+d+"': file not found");/\.json$/i.test(l)?this["import"](JSON.parse(m+""),l):this["import"](a.DotProto.Parser.parse(m),l)}else d?/\.(\w+)$/.test(d)?this["import"](b.imports[k],d.replace(/^(.+)\.(\w+)$/,function(a,b,c){return b+"_import"+k+"."+c})):this["import"](b.imports[k],d+"_import"+k):this["import"](b.imports[k]);j&&(this.importRoot=null)}b["package"]&&this.define(b["package"]),b.syntax&&e(b);var n=this.ptr;return b.options&&Object.keys(b.options).forEach(function(a){n.options[a]=b.options[a]}),b.messages&&(this.create(b.messages),this.ptr=n),b.enums&&(this.create(b.enums),this.ptr=n),b.services&&(this.create(b.services),this.ptr=n),b["extends"]&&this.create(b["extends"]),this.reset()},g.resolveAll=function(){var c;if(null==this.ptr||"object"==typeof this.ptr.type)return this;if(this.ptr instanceof d.Namespace)this.ptr.children.forEach(function(a){this.ptr=a,this.resolveAll()},this);else if(this.ptr instanceof d.Message.Field){if(b.TYPE.test(this.ptr.type))this.ptr.type=a.TYPES[this.ptr.type];else{if(!b.TYPEREF.test(this.ptr.type))throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if(c=(this.ptr instanceof d.Message.ExtensionField?this.ptr.extension.parent:this.ptr.parent).resolve(this.ptr.type,!0),!c)throw Error("unresolvable type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if(this.ptr.resolvedType=c,c instanceof d.Enum){if(this.ptr.type=a.TYPES["enum"],"proto3"===this.ptr.syntax&&"proto3"!==c.syntax)throw Error("proto3 message cannot reference proto2 enum")}else{if(!(c instanceof d.Message))throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);this.ptr.type=c.isGroup?a.TYPES.group:a.TYPES.message}}if(this.ptr.map){if(!b.TYPE.test(this.ptr.keyType))throw Error("illegal key type for map field in "+this.ptr.toString(!0)+": "+this.ptr.keyType);this.ptr.keyType=a.TYPES[this.ptr.keyType]}}else if(this.ptr instanceof a.Reflect.Service.Method){if(!(this.ptr instanceof a.Reflect.Service.RPCMethod))throw Error("illegal service type in "+this.ptr.toString(!0));if(c=this.ptr.parent.resolve(this.ptr.requestName,!0),!(c&&c instanceof a.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.requestName);if(this.ptr.resolvedRequestType=c,c=this.ptr.parent.resolve(this.ptr.responseName,!0),!(c&&c instanceof a.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.responseName);this.ptr.resolvedResponseType=c}else if(!(this.ptr instanceof a.Reflect.Message.OneOf||this.ptr instanceof a.Reflect.Extension||this.ptr instanceof a.Reflect.Enum.Value))throw Error("illegal object in namespace: "+typeof this.ptr+": "+this.ptr);return this.reset()},g.build=function(a){if(this.reset(),this.resolved||(this.resolveAll(),this.resolved=!0,this.result=null),null===this.result&&(this.result=this.ns.build()),!a)return this.result;for(var b="string"==typeof a?a.split("."):a,c=this.result,d=0;d<b.length;d++){if(!c[b[d]]){c=null;break}c=c[b[d]]}return c},g.lookup=function(a,b){return a?this.ns.resolve(a,b):this.ns},g.toString=function(){return"Builder"},f.Message=function(){},f.Enum=function(){},f.Service=function(){},f}(e,e.Lang,e.Reflect),e.Map=function(a,b){function c(a){var b=0;return{next:function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}}}var d=function(a,c){if(!a.map)throw Error("field is not a map");if(this.field=a,this.keyElem=new b.Element(a.keyType,null,(!0),a.syntax),this.valueElem=new b.Element(a.type,a.resolvedType,(!1),a.syntax),this.map={},Object.defineProperty(this,"size",{get:function(){return Object.keys(this.map).length}}),c)for(var d=Object.keys(c),e=0;e<d.length;e++){var f=this.keyElem.valueFromString(d[e]),g=this.valueElem.verifyValue(c[d[e]]);this.map[this.keyElem.valueToString(f)]={key:f,value:g}}},e=d.prototype;return e.clear=function(){this.map={}},e["delete"]=function(a){var b=this.keyElem.valueToString(this.keyElem.verifyValue(a)),c=b in this.map;return delete this.map[b],c},e.entries=function(){for(var a,b=[],d=Object.keys(this.map),e=0;e<d.length;e++)b.push([(a=this.map[d[e]]).key,a.value]);return c(b)},e.keys=function(){for(var a=[],b=Object.keys(this.map),d=0;d<b.length;d++)a.push(this.map[b[d]].key);return c(a)},e.values=function(){for(var a=[],b=Object.keys(this.map),d=0;d<b.length;d++)a.push(this.map[b[d]].value);return c(a)},e.forEach=function(a,b){for(var c,d=Object.keys(this.map),e=0;e<d.length;e++)a.call(b,(c=this.map[d[e]]).value,c.key,this)},e.set=function(a,b){var c=this.keyElem.verifyValue(a),d=this.valueElem.verifyValue(b);return this.map[this.keyElem.valueToString(c)]={key:c,value:d},this},e.get=function(a){var b=this.keyElem.valueToString(this.keyElem.verifyValue(a));if(b in this.map)return this.map[b].value},e.has=function(a){var b=this.keyElem.valueToString(this.keyElem.verifyValue(a));return b in this.map},d}(e,e.Reflect),e.loadProto=function(a,b,c){return("string"==typeof b||b&&"string"==typeof b.file&&"string"==typeof b.root)&&(c=b,b=void 0),e.loadJson(e.DotProto.Parser.parse(a),b,c)},e.protoFromString=e.loadProto,e.loadProtoFile=function(a,b,c){if(b&&"object"==typeof b?(c=b,b=null):b&&"function"==typeof b||(b=null),b)return e.Util.fetch("string"==typeof a?a:a.root+"/"+a.file,function(d){if(null===d)return void b(Error("Failed to fetch file"));try{b(null,e.loadProto(d,c,a))}catch(f){b(f)}});var d=e.Util.fetch("object"==typeof a?a.root+"/"+a.file:a);return null===d?null:e.loadProto(d,c,a)},e.protoFromFile=e.loadProtoFile,e.newBuilder=function(a){return a=a||{},"undefined"==typeof a.convertFieldsToCamelCase&&(a.convertFieldsToCamelCase=e.convertFieldsToCamelCase),"undefined"==typeof a.populateAccessors&&(a.populateAccessors=e.populateAccessors),new e.Builder(a)},e.loadJson=function(a,b,c){return("string"==typeof b||b&&"string"==typeof b.file&&"string"==typeof b.root)&&(c=b,b=null),b&&"object"==typeof b||(b=e.newBuilder()),"string"==typeof a&&(a=JSON.parse(a)),b["import"](a,c),b.resolveAll(),b},e.loadJsonFile=function(a,b,c){if(b&&"object"==typeof b?(c=b,b=null):b&&"function"==typeof b||(b=null),b)return e.Util.fetch("string"==typeof a?a:a.root+"/"+a.file,function(d){if(null===d)return void b(Error("Failed to fetch file"));try{b(null,e.loadJson(JSON.parse(d),c,a))}catch(f){b(f)}});var d=e.Util.fetch("object"==typeof a?a.root+"/"+a.file:a);return null===d?null:e.loadJson(JSON.parse(d),c,a)},e})}).call(b,c(17),c(12)(a))},function(a,b){function c(){throw new Error("setTimeout has not been defined")}function d(){throw new Error("clearTimeout has not been defined")}function e(a){if(k===setTimeout)return setTimeout(a,0);if((k===c||!k)&&setTimeout)return k=setTimeout,setTimeout(a,0);try{return k(a,0)}catch(b){try{return k.call(null,a,0)}catch(b){return k.call(this,a,0)}}}function f(a){if(l===clearTimeout)return clearTimeout(a);if((l===d||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(a);try{return l(a)}catch(b){try{return l.call(null,a)}catch(b){return l.call(this,a)}}}function g(){p&&n&&(p=!1,n.length?o=n.concat(o):q=-1,o.length&&h())}function h(){if(!p){var a=e(g);p=!0;for(var b=o.length;b;){for(n=o,o=[];++q<b;)n&&n[q].run();q=-1,b=o.length}n=null,p=!1,f(a)}}function i(a,b){this.fun=a,this.array=b}function j(){}var k,l,m=a.exports={};!function(){try{k="function"==typeof setTimeout?setTimeout:c}catch(a){k=c}try{l="function"==typeof clearTimeout?clearTimeout:d}catch(a){l=d}}();var n,o=[],p=!1,q=-1;m.nextTick=function(a){var b=new Array(arguments.length-1);if(arguments.length>1)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];o.push(new i(a,b)),1!==o.length||p||e(h)},i.prototype.run=function(){this.fun.apply(null,this.array)},m.title="browser",m.browser=!0,m.env={},m.argv=[],m.version="",m.versions={},m.on=j,m.addListener=j,m.once=j,m.off=j,m.removeListener=j,m.removeAllListeners=j,m.emit=j,m.prependListener=j,m.prependOnceListener=j,m.listeners=function(a){return[]},m.binding=function(a){throw new Error("process.binding is not supported")},m.cwd=function(){return"/"},m.chdir=function(a){throw new Error("process.chdir is not supported")},m.umask=function(){return 0}},function(a,b){},function(a,b){},function(a,b,c){var d,e;d=[],e=function(){"use strict";var a={"package":"mq",messages:[{name:"Request",fields:[{rule:"optional",type:"string",name:"sessionId",id:1},{rule:"optional",type:"string",name:"requestId",id:2},{rule:"required",type:"string",name:"type",id:3},{rule:"optional",type:"string",name:"encoding",id:4},{rule:"required",type:"bytes",name:"payload",id:5}]},{name:"Response",fields:[{rule:"optional",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"requestId",id:2},{rule:"required",type:"string",name:"type",id:3},{rule:"optional",type:"string",name:"encoding",id:4},{rule:"required",type:"bytes",name:"payload",id:5},{rule:"repeated",type:"double",name:"wallTime",id:6}]},{name:"Error",fields:[{rule:"required",type:"string",name:"reason",id:1}]},{name:"PingPong",fields:[{rule:"required",type:"uint64",name:"originTimestamp",id:1},{rule:"optional",type:"uint64",name:"count",id:2}]}]};return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";var a={"package":"pcast",messages:[{name:"Authenticate",fields:[{rule:"optional",type:"uint32",name:"apiVersion",id:9,options:{"default":0}},{rule:"required",type:"string",name:"clientVersion",id:1},{rule:"optional",type:"string",name:"device",id:12},{rule:"required",type:"string",name:"deviceId",id:2},{rule:"optional",type:"string",name:"manufacturer",id:13},{rule:"required",type:"string",name:"platform",id:3},{rule:"required",type:"string",name:"platformVersion",id:4},{rule:"required",type:"string",name:"authenticationToken",id:5},{rule:"optional",type:"string",name:"connectionId",id:6},{rule:"optional",type:"string",name:"connectionRouteKey",id:10},{rule:"optional",type:"string",name:"remoteAddress",id:11},{rule:"optional",type:"string",name:"sessionId",id:7},{rule:"optional",type:"string",name:"applicationId",id:8}]},{name:"AuthenticateResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"sessionId",id:2},{rule:"optional",type:"string",name:"redirect",id:3},{rule:"repeated",type:"string",name:"roles",id:4}]},{name:"Bye",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"reason",id:2}]},{name:"ByeResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"SessionDescription",fields:[{rule:"required",type:"Type",name:"type",id:1,options:{"default":"Offer"}},{rule:"required",type:"string",name:"sdp",id:2}],enums:[{name:"Type",values:[{name:"Offer",id:0},{name:"Answer",id:1}]}]},{name:"CreateStream",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"optional",type:"string",name:"originStreamId",id:2},{rule:"repeated",type:"string",name:"options",id:3},{rule:"optional",type:"string",name:"connectUri",id:8},{rule:"repeated",type:"string",name:"connectOptions",id:9},{rule:"repeated",type:"string",name:"tags",id:4},{rule:"optional",type:"SetRemoteDescription",name:"setRemoteDescription",id:5},{rule:"optional",type:"CreateOfferDescription",name:"createOfferDescription",id:6},{rule:"optional",type:"CreateAnswerDescription",name:"createAnswerDescription",id:7}]},{name:"IceServer",fields:[{rule:"repeated",type:"string",name:"urls",id:1},{rule:"optional",type:"string",name:"username",id:2},{rule:"optional",type:"string",name:"credential",id:3}]},{name:"RtcConfiguration",fields:[{rule:"optional",type:"BundlePolicy",name:"bundlePolicy",id:1},{rule:"optional",type:"uint32",name:"iceCandidatePoolSize",id:3},{rule:"repeated",type:"IceServer",name:"iceServers",id:4},{rule:"optional",type:"IceTransportPolicy",name:"iceTransportPolicy",id:5},{rule:"optional",type:"string",name:"peerIdentity",id:6},{rule:"optional",type:"RtcpMuxPolicy",name:"rtcpMuxPolicy",id:7}],enums:[{name:"BundlePolicy",values:[{name:"BundlePolicyBalanced",id:1},{name:"BundlePolicyMaxCompat",id:2},{name:"BundlePolicyMaxBundle",id:3}]},{name:"IceTransportPolicy",values:[{name:"IceTransportPolicyAll",id:1},{name:"IceTransportPolicyPublic",id:2},{name:"IceTransportPolicyRelay",id:3}]},{name:"RtcpMuxPolicy",values:[{name:"RtcpMuxPolicyNegotiate",id:1},{name:"RtcpMuxPolicyRequire",id:2}]}]},{name:"CreateStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"streamId",id:2},{rule:"optional",type:"string",name:"instanceRouteKey",id:5},{rule:"repeated",type:"string",name:"streamUris",id:8},{rule:"optional",type:"RtcConfiguration",name:"rtcConfiguration",id:9},{rule:"optional",type:"SetRemoteDescriptionResponse",name:"setRemoteDescriptionResponse",id:3},{rule:"optional",type:"CreateOfferDescriptionResponse",name:"createOfferDescriptionResponse",id:4},{rule:"optional",type:"CreateAnswerDescriptionResponse",name:"createAnswerDescriptionResponse",id:6},{rule:"repeated",type:"string",name:"options",id:7},{rule:"optional",type:"uint64",name:"offset",id:10,options:{"default":0}}]},{name:"SetLocalDescription",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"required",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"optional",type:"uint32",name:"apiVersion",id:3,options:{"default":0}}]},{name:"SetLocalDescriptionResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"string",name:"options",id:2}]},{name:"SetRemoteDescription",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"required",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"optional",type:"uint32",name:"apiVersion",id:3,options:{"default":0}}]},{name:"SetRemoteDescriptionResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"repeated",type:"string",name:"options",id:3}]},{name:"CreateOfferDescription",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"repeated",type:"string",name:"options",id:2},{rule:"optional",type:"uint32",name:"apiVersion",id:3,options:{"default":0}}]},{name:"CreateOfferDescriptionResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"repeated",type:"string",name:"options",id:3}]},{name:"CreateAnswerDescription",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"repeated",type:"string",name:"options",id:2},{rule:"optional",type:"uint32",name:"apiVersion",id:3,options:{"default":0}}]},{name:"CreateAnswerDescriptionResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"repeated",type:"string",name:"options",id:3}]},{name:"IceCandidate",fields:[{rule:"required",type:"string",name:"candidate",id:1},{rule:"required",type:"uint32",name:"sdpMLineIndex",id:2},{rule:"required",type:"string",name:"sdpMid",id:3}]},{name:"AddIceCandidates",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"repeated",type:"IceCandidate",name:"candidates",id:2},{rule:"repeated",type:"string",name:"options",id:3},{rule:"optional",type:"uint32",name:"apiVersion",id:4,options:{"default":0}}]},{name:"AddIceCandidatesResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"string",name:"options",id:2}]},{name:"UpdateStreamState",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"required",type:"string",name:"signalingState",id:2},{rule:"required",type:"string",name:"iceGatheringState",id:3},{rule:"required",type:"string",name:"iceConnectionState",id:4},{rule:"optional",type:"uint32",name:"apiVersion",id:5,options:{"default":0}}]},{name:"UpdateStreamStateResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"string",name:"options",id:2}]},{name:"DestroyStream",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"optional",type:"string",name:"reason",id:2},{rule:"repeated",type:"string",name:"options",id:3}]},{name:"DestroyStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"ConnectionDisconnected",fields:[{rule:"required",type:"string",name:"connectionId",id:1},{rule:"required",type:"uint32",name:"reasonCode",id:2},{rule:"optional",type:"string",name:"description",id:3}]},{name:"ConnectionDisconnectedResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"StreamStarted",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"repeated",type:"string",name:"tags",id:3}]},{name:"SourceStreamStarted",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"repeated",type:"string",name:"capabilities",id:3},{rule:"repeated",type:"string",name:"tags",id:4}]},{name:"StreamEnded",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"string",name:"reason",id:3},{rule:"repeated",type:"string",name:"tags",id:4},{rule:"optional",type:"string",name:"continuationId",id:5},{rule:"optional",type:"string",name:"routeKey",id:6}]},{name:"SourceStreamEnded",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"string",name:"reason",id:3},{rule:"repeated",type:"string",name:"capabilities",id:4},{rule:"repeated",type:"string",name:"tags",id:5}]},{name:"StreamEndedResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"continuationId",id:2},{rule:"optional",type:"string",name:"routeKey",id:3}]},{name:"StreamIdle",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"repeated",type:"string",name:"options",id:3},{rule:"repeated",type:"string",name:"tags",id:4}]},{name:"StreamArchived",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"string",name:"uri",id:3}]},{name:"SessionEnded",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"reason",id:2},{rule:"required",type:"float",name:"duration",id:3}]},{name:"StreamPlaylist",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"PlaylistType",name:"playlistType",id:3},{rule:"required",type:"string",name:"uri",id:4}],enums:[{name:"PlaylistType",values:[{name:"Live",id:0},{name:"OnDemand",id:1}]}]},{name:"ForwardToClient",fields:[{rule:"required",type:"string",name:"connectionId",id:1},{rule:"required",type:"string",name:"type",id:2},{rule:"required",type:"bytes",name:"payload",id:3}]},{name:"ForwardToClientResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"SetupStream",fields:[{rule:"required",type:"string",name:"streamToken",id:1},{rule:"required",type:"CreateStream",name:"createStream",id:2}]},{name:"SetupStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"CreateStreamResponse",name:"createStreamResponse",id:2}]},{name:"SetupPlaylistStream",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamToken",id:2},{rule:"repeated",type:"string",name:"options",id:3},{rule:"repeated",type:"string",name:"tags",id:4}]},{name:"PlaylistStreamManifest",fields:[{rule:"required",type:"string",name:"manifest",id:1},{rule:"required",type:"bool",name:"isProtectedContent",id:2}]},{name:"SetupPlaylistStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"PlaylistStreamManifest",name:"manifests",id:2},{rule:"optional",type:"uint64",name:"offset",id:3,options:{"default":0}}]},{name:"StreamDataQuality",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"uint64",name:"timestamp",id:3},{rule:"required",type:"DataQualityStatus",name:"status",id:4},{rule:"required",type:"DataQualityReason",name:"reason",id:5}],enums:[{name:"DataQualityStatus",values:[{name:"NoData",id:0},{name:"AudioOnly",id:1},{name:"All",id:2}]},{name:"DataQualityReason",values:[{name:"None",id:0},{name:"UploadLimited",id:1},{name:"DownloadLimited",id:2},{name:"PublisherLimited",id:3},{name:"NetworkLimited",id:4}]}]},{name:"StreamDataQualityResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"CallbackEvent",fields:[{rule:"optional",type:"uint32",name:"apiVersion",id:1,options:{"default":0}},{rule:"required",type:"string",name:"entity",id:2},{rule:"required",type:"string",name:"what",id:3},{rule:"required",type:"string",name:"data",id:4},{rule:"optional",type:"string",name:"sessionId",id:5}]},{name:"Uri",fields:[{rule:"optional",type:"string",name:"protocol",id:1,options:{"default":"http"}},{rule:"required",type:"string",name:"host",id:2},{rule:"optional",type:"uint32",name:"port",id:3,options:{"default":80}},{rule:"optional",type:"string",name:"method",id:4,options:{"default":"POST"}},{rule:"optional",type:"string",name:"path",id:5,options:{"default":"/"}}]},{name:"SetApplicationCallback",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"required",type:"Uri",name:"callback",id:3}]},{name:"SetApplicationCallbackResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"IssueAuthenticationToken",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"repeated",type:"string",name:"capabilities",id:3}]},{name:"IssueAuthenticationTokenResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"authenticationToken",id:2}]},{name:"IssueStreamToken",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"required",type:"string",name:"sessionId",id:3},{rule:"optional",type:"string",name:"originStreamId",id:4},{rule:"repeated",type:"string",name:"capabilities",id:5}]},{name:"IssueStreamTokenResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"streamToken",id:2}]},{name:"IssueDrmToken",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"required",type:"string",name:"streamToken",id:3},{rule:"optional",type:"string",name:"sessionId",id:4},{rule:"required",type:"string",name:"originStreamId",id:5},{rule:"repeated",type:"string",name:"capabilities",id:6}]},{name:"IssueDrmTokenResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"drmToken",id:2}]},{name:"TerminateStream",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"optional",type:"string",name:"streamId",id:3,oneof:"streamOrToken"},{rule:"optional",type:"string",name:"streamToken",id:5,oneof:"streamOrToken"},{rule:"optional",type:"string",name:"reason",id:4}],oneofs:{streamOrToken:[3,5]}},{name:"TerminateStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"Stream",fields:[{rule:"required",type:"string",name:"streamId",id:1}]},{name:"ListStreams",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"optional",type:"string",name:"start",id:3},{rule:"required",type:"uint32",name:"length",id:4},{rule:"repeated",type:"string",name:"options",id:5}]},{name:"ListStreamsResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"start",id:2},{rule:"optional",type:"uint32",name:"length",id:3},{rule:"repeated",type:"Stream",name:"streams",id:4}]}]};return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";var a={"package":"chat",messages:[{name:"Room",fields:[{rule:"optional",type:"string",name:"roomId",id:1},{rule:"optional",type:"string",name:"alias",id:2},{rule:"required",type:"string",name:"name",id:3},{rule:"required",type:"string",name:"description",id:4},{rule:"required",type:"RoomType",name:"type",id:5},{rule:"repeated",type:"string",name:"options",id:6},{rule:"optional",type:"string",name:"bridgeId",id:7},{rule:"optional",type:"string",name:"pin",id:8}]},{name:"Stream",fields:[{rule:"required",type:"StreamType",name:"type",id:1},{rule:"required",type:"string",name:"uri",id:2},{rule:"required",type:"TrackState",name:"audioState",id:3},{rule:"required",type:"TrackState",name:"videoState",id:4}]},{name:"Member",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"screenName",id:2},{rule:"required",type:"MemberRole",name:"role",id:3},{rule:"repeated",type:"Stream",name:"streams",id:4},{rule:"required",type:"MemberState",name:"state",id:5},{rule:"required",type:"uint64",name:"lastUpdate",id:6}]},{name:"MemberUpdate",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"optional",type:"string",name:"screenName",id:2},{rule:"optional",type:"MemberRole",name:"role",id:3},{rule:"required",type:"bool",name:"updateStreams",id:7,options:{"default":!1}},{rule:"repeated",type:"Stream",name:"streams",id:4},{rule:"optional",type:"MemberState",name:"state",id:5},{rule:"required",type:"uint64",name:"lastUpdate",id:6}]},{name:"ChatUser",fields:[{rule:"optional",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"screenName",id:2},{rule:"required",type:"MemberRole",name:"role",id:3},{rule:"required",type:"uint64",name:"lastUpdate",id:4}]},{name:"ChatMessage",fields:[{rule:"required",type:"string",name:"messageId",id:1},{rule:"required",type:"uint64",name:"timestamp",id:2},{rule:"required",type:"ChatUser",name:"from",id:3},{rule:"required",type:"string",name:"message",id:4}]},{name:"CreateRoom",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"Room",name:"room",id:2}]},{name:"CreateRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"Room",name:"room",id:2}]},{name:"JoinRoom",fields:[{rule:"optional",type:"string",name:"roomId",id:1},{rule:"optional",type:"string",name:"alias",id:2},{rule:"required",type:"string",name:"sessionId",id:3},{rule:"required",type:"Member",name:"member",id:4},{rule:"repeated",type:"string",name:"options",id:5},{rule:"required",type:"uint64",name:"timestamp",id:6}]},{name:"JoinRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"Room",name:"room",id:2},{rule:"repeated",type:"Member",name:"members",id:3},{rule:"repeated",type:"string",name:"options",id:4}]},{name:"UpdateRoom",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"Room",name:"room",id:2},{rule:"required",type:"uint64",name:"timestamp",id:3}]},{name:"UpdateRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"UpdateMember",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"MemberUpdate",name:"member",id:2},{rule:"repeated",type:"string",name:"options",id:3},{rule:"required",type:"uint64",name:"timestamp",id:4}]},{name:"UpdateMemberResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"uint64",name:"lastUpdate",id:2}]},{name:"LeaveRoom",fields:[{rule:"required",type:"string",name:"roomId",id:1},{rule:"required",type:"string",name:"sessionId",id:2},{rule:"required",type:"uint64",name:"timestamp",id:3}]},{name:"LeaveRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"DestroyRoom",fields:[{rule:"required",type:"string",name:"roomId",id:1}]},{name:"DestroyRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"GetRoomInfo",fields:[{rule:"optional",type:"string",name:"roomId",id:1},{rule:"optional",type:"string",name:"alias",id:2},{rule:"optional",type:"string",name:"sessionId",id:3},{rule:"optional",type:"string",name:"applicationId",id:4},{rule:"optional",type:"string",name:"secret",id:5},{rule:"repeated",type:"string",name:"options",id:6}]},{name:"GetRoomInfoResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"Room",name:"room",id:2},{rule:"repeated",type:"Member",name:"members",id:3},{rule:"repeated",type:"string",name:"options",id:4}]},{name:"RoomEvent",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"roomId",id:2},{rule:"required",type:"RoomEventType",name:"eventType",id:3},{rule:"repeated",type:"Member",name:"members",id:4},{rule:"optional",type:"Room",name:"room",id:5},{rule:"repeated",type:"string",name:"options",id:6},{rule:"required",type:"uint64",name:"timestamp",id:7}]},{name:"SendMessageToRoom",fields:[{rule:"required",type:"string",name:"roomId",id:1},{rule:"required",type:"ChatMessage",name:"chatMessage",id:2}]},{name:"SendMessageToRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"FetchRoomConversation",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"roomId",id:2},{rule:"optional",type:"string",name:"afterMessageId",id:3},{rule:"optional",type:"string",name:"beforeMessageId",id:4},{rule:"required",type:"uint32",name:"limit",id:5},{rule:"repeated",type:"RoomConversationOption",name:"options",id:6}]},{name:"FetchRoomConversationResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"ChatMessage",name:"chatMessages",id:2}]},{name:"RoomConversationEvent",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"roomId",id:2},{rule:"required",type:"RoomConversationEventType",name:"eventType",id:3},{rule:"repeated",type:"ChatMessage",name:"chatMessages",id:4}]}],enums:[{name:"RoomType",values:[{name:"DirectChat",id:0},{name:"MultiPartyChat",id:1},{name:"ModeratedChat",id:2},{name:"TownHall",id:3},{name:"Channel",id:4}]},{name:"MemberRole",values:[{name:"Participant",id:0},{name:"Moderator",id:1},{name:"Presenter",id:2},{name:"Audience",id:3}]},{name:"MemberState",values:[{name:"Active",id:0},{name:"Passive",id:1},{name:"HandRaised",id:2},{name:"Inactive",id:3},{name:"Offline",id:4}]},{name:"RoomEventType",values:[{name:"MemberJoined",id:0},{name:"MemberLeft",id:1},{name:"MemberUpdated",id:2},{name:"RoomUpdated",id:3},{name:"RoomEnded",id:4}]},{name:"TrackState",values:[{name:"TrackEnabled",id:0},{name:"TrackDisabled",id:1},{name:"TrackEnded",id:2}]},{name:"StreamType",values:[{name:"User",id:0},{name:"Presentation",id:1},{name:"Audio",id:2}]},{name:"RoomConversationOption",values:[{name:"Subscribe",id:0}]},{name:"RoomConversationEventType",values:[{name:"Message",id:0}]}]};return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";var a={"package":"analytix",messages:[{name:"LogData",fields:[{rule:"required",type:"LogLevel",name:"level",id:1},{rule:"required",type:"string",name:"timestamp",id:2},{rule:"required",type:"string",name:"category",id:3},{rule:"required",type:"string",name:"message",id:4},{rule:"optional",type:"string",name:"source",id:5},{rule:"optional",type:"string",name:"fullQualifiedName",id:11},{rule:"optional",type:"string",name:"sessionId",id:6},{rule:"optional",type:"string",name:"userId",id:7},{rule:"optional",type:"string",
name:"environment",id:8},{rule:"optional",type:"string",name:"version",id:9},{rule:"optional",type:"float",name:"runtime",id:10}]},{name:"StoreLogRecords",fields:[{rule:"repeated",type:"LogData",name:"records",id:1}]},{name:"StoreLogRecordsResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"required",type:"uint64",name:"storedRecords",id:2}]},{name:"MetricValue",fields:[{rule:"optional",type:"string",name:"string",id:1},{rule:"optional",type:"float",name:"float",id:2},{rule:"optional",type:"uint64",name:"uint64",id:3},{rule:"optional",type:"int64",name:"int64",id:4},{rule:"optional",type:"bool",name:"boolean",id:5},{rule:"optional",type:"string",name:"timestamp",id:6}]},{name:"MetricData",fields:[{rule:"required",type:"string",name:"timestamp",id:1},{rule:"optional",type:"string",name:"sessionId",id:2},{rule:"optional",type:"string",name:"streamId",id:3},{rule:"optional",type:"string",name:"source",id:4},{rule:"optional",type:"string",name:"resource",id:5},{rule:"optional",type:"string",name:"kind",id:6},{rule:"required",type:"Metric",name:"metric",id:7},{rule:"optional",type:"MetricValue",name:"value",id:8},{rule:"optional",type:"MetricValue",name:"previousValue",id:9},{rule:"optional",type:"uint64",name:"elapsed",id:10},{rule:"optional",type:"string",name:"fullQualifiedName",id:11},{rule:"optional",type:"string",name:"environment",id:12},{rule:"optional",type:"string",name:"version",id:13},{rule:"optional",type:"string",name:"tool",id:14},{rule:"optional",type:"string",name:"toolVersion",id:15},{rule:"required",type:"float",name:"runtime",id:16}]},{name:"SubmitMetricRecords",fields:[{rule:"repeated",type:"MetricData",name:"records",id:1}]},{name:"SubmitMetricRecordsResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"required",type:"uint64",name:"storedRecords",id:2}]}],enums:[{name:"LogLevel",values:[{name:"Trace",id:0},{name:"Debug",id:1},{name:"Info",id:2},{name:"Warn",id:3},{name:"Error",id:4},{name:"Fatal",id:5}]},{name:"Metric",values:[{name:"EndPointRoundTripTime",id:0},{name:"Initialized",id:1},{name:"Provisioned",id:2},{name:"SetupCompleted",id:3},{name:"Offset",id:4},{name:"TimeToFirstFrame",id:5},{name:"Playing",id:6},{name:"Stalled",id:7},{name:"Buffering",id:8},{name:"Stopped",id:9},{name:"BitRateAdaptation",id:10},{name:"ResolutionChanged",id:11},{name:"FrameRateChanged",id:12},{name:"FramesDropped",id:13},{name:"PacketsLost",id:14},{name:"PictureLost",id:15},{name:"PlayoutDelayChanged",id:16},{name:"CodecChanged",id:17},{name:"MetricDropped",id:18}]}]};return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(4),c(1)],e=function(a,b){"use strict";function c(b,c){this._logger=c,this._timeout=null,this._onOnline=null,this._onOffline=null,this._offlineHysteresisTimeout=a.isNumber(b)?b:f}function d(a,b){var c=this;c._logger&&c._logger.warn("Network Disconnect Detected. Waiting for reconnect."),c._offlineHysteresisTimeoutElapsed=!1,c.offlineTimeout=setTimeout(function(){c._offlineHysteresisTimeoutElapsed=!0,a&&c._onOffline&&(c._logger&&c._logger.warn("Network not reconnected after [%s]. Going Offline.",c._offlineHysteresisTimeout),a())},c._offlineHysteresisTimeout)}function e(a,b){this._logger&&this._logger.info("Network Reconnected."),this.offlineTimeout&&(clearTimeout(this.offlineTimeout),this.offlineTimeout=null),a&&this._onOnline&&a(this._offlineHysteresisTimeoutElapsed)}var f=15e3;return c.prototype.start=function(c,f){this._onOnline=a.bind(e,this,c),this._onOffline=a.bind(d,this,f),b.addEventListener(window,"online",this._onOnline,!1),b.addEventListener(window,"offline",this._onOffline,!1)},c.prototype.stop=function(){b.removeEventListener(window,"online",this._onOnline,!1),b.removeEventListener(window,"offline",this._onOffline,!1),this._onOnline=null,this._onOffline=null},c}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(4),c(5),c(6)],e=function(a,b,c){"use strict";function d(){this._minLevel=c.level.TRACE}d.prototype.setThreshold=function(a){b.isNumber(a),this._minLevel=a},d.prototype.getThreshold=function(){return this._minLevel},d.prototype.log=function(a,b,d,g,h,i,j,k,l){l.level<this._minLevel||(g[0]=a+" ["+d+"] "+b+" "+g[0],l.level>c.level.INFO?f(g):e(g))};var e=function(a){console.log.apply(console,a)}||function(){},f=function(a){console.error.apply(console,a)}||e;return d}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(4),c(5),c(29),c(30),c(10),c(31),c(27),c(33),c(34),c(35),c(37),c(1)],e=function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";function m(a){a=a||{},this._observableStatus=new c("offline"),this._baseUri=a.uri||g.DefaultPCastUri,this._deviceId=a.deviceId||"",this._version=ca,this._logger=a.logger||d.createPCastLogger(this._baseUri,a.disableConsoleLogging),this._metricsTransmitter=a.metricsTransmitter||j.createMetricsTransmitter(this._baseUri),this._endPoint=new g(this._version,this._baseUri,this._logger),this._screenSharingExtensionId=a.screenSharingExtensionId||da,this._screenSharingAddOn=a.screenSharingAddOn||ea,this._screenSharingEnabled=!1,this._shaka=a.shaka||window.shaka,this._videojs=a.videojs||window.videojs,this._status="offline","Chrome"===l.browser&&this._screenSharingExtensionId&&p.call(this),l.addEventListener(window,"unload",function(a){return function(){a.stop()}}(this))}function n(a){var b=this;if("Chrome"===l.browser&&b._screenSharingExtensionId)try{chrome.runtime.sendMessage(b._screenSharingExtensionId,{type:"version"},function(c){c&&"ok"===c.status?(b._logger.info("Screen sharing enabled using version [%s]",c.version),a(!0)):(b._logger.info("Screen sharing NOT available"),a(!1))})}catch(c){c.message&&b._logger.warn(c.message,c),a(!1)}else a("Firefox"===l.browser&&"object"==typeof window.PCastScreenSharing?!0:!1)}function o(){return"https://chrome.google.com/webstore/detail/"+this._screenSharingExtensionId}function p(){for(var a=o.call(this),b=document.getElementsByTagName("link"),c=0;c<b.length;c++)if(b[c].href===a)return;this._logger.debug("Adding Chrome Web Store link [%s]",a);var d=document.createElement("link");d.rel="chrome-webstore-item",d.href=a,document.getElementsByTagName("head")[0].appendChild(d)}function q(a){var b=this,c=o.call(this);try{chrome.webstore.install(c,function(){return a("ok")},function(c){if(c){if(c.match(/cancelled/gi))return b._logger.info("User cancelled screen sharing"),a("cancelled",new Error(c));b._logger.warn(c)}return a("failed",new Error(c||"failed"))})}catch(d){d.message&&b._logger.warn(d.message),a("failed",d)}}function r(a){try{var b,c={"PCast Screen Sharing":{URL:this._screenSharingAddOn.url,IconURL:this._screenSharingAddOn.iconUrl,Hash:this._screenSharingAddOn.hash,toString:function(){return this.URL}}},d=ha,e=function(){b&&clearInterval(b),a("ok")},f=function(){b&&clearInterval(b),a("failed",new Error("failed"))};b=setInterval(function(){return"object"==typeof window.PCastScreenSharing?e():d--<0?f():void 0},ga),InstallTrigger.install(c,function(a,b){0===b?e():f()})}catch(g){g.message&&this._logger.warn(g.message),a("failed",g)}}function s(a,b){var c=this;switch(l.browser){case"Chrome":try{chrome.runtime.sendMessage(c._screenSharingExtensionId,{type:"get-desktop-media"},function(c){if("ok"!==c.status)return b(c.status,void 0,new Error(c.status));var d={video:{}};"object"==typeof a&&"object"==typeof a.screen&&(d.video=a.screen),"object"!=typeof d.video.mandatory&&(d.video.mandatory={}),d.video.mandatory.chromeMediaSource="desktop",d.video.mandatory.chromeMediaSourceId=c.streamId,b("ok",d,void 0)})}catch(d){d.message&&c._logger.warn(d.message),b("failed",void 0,d)}break;case"Firefox":var e={video:{}};"object"==typeof a&&"object"==typeof a.screen&&(e.video=a.screen),e.video.mediaSource="window",b("ok",e,void 0);break;default:b("not-supported",void 0,new Error("not-supported"))}}function t(a,b){var c=this;if(a.screen)if(c._screenSharingEnabled)s.call(c,a,b);else{var d=function(d){return"cancelled"===d?b(d,"cancelled"):"ok"!==d?b(d,void 0,new Error("screen-sharing-installation-failed")):void n.call(c,function(e){return c._screenSharingEnabled=e,c._screenSharingEnabled?void s.call(c,a,b):b(d,void 0,new Error("screen-sharing-installation-failed"))})};switch(l.browser){case"Chrome":q.call(c,d);break;case"Firefox":r.call(c,d);break;default:b("not-supported",void 0,new Error("not-supported"))}}else{var e={audio:a.audio||!1,video:a.video||!1};b("ok",e,void 0)}}function u(a,b){var c=this,d=function(a,d){c._gumStreams&&c._gumStreams.push(d),b(c,a,d)},e=function(a,d,e){b(c,a,d,e)},f=a.screen,g=a.video||a.audio;return f&&g?v.call(c,{screen:a.screen},function(b,f){return v.call(c,{audio:a.audio,video:a.video},function(a,b){S(b,f.getTracks()),d(a,b)},function(a,b,c){T(f),e(a,b,c)})},e):v.call(c,a,d,e)}function v(a,b,c){var d=function(){c("cancelled",null)},e=function(a){c(ja(a),void 0,a)},f=function(a){b("ok",a)};return t.call(this,a,function(a,b,c){if("cancelled"===a)return d();if("ok"!==a)return e(c);try{l.getUserMedia(b,f,e)}catch(g){e(g)}})}function w(b){this._protocol=new f(b,this._deviceId,this._version,this._logger),this._protocol.on("connected",a.bind(x,this)),this._protocol.on("reconnecting",a.bind(y,this)),this._protocol.on("reconnected",a.bind(z,this)),this._protocol.on("disconnected",a.bind(A,this)),this._protocol.on("streamEnded",a.bind(C,this)),this._protocol.on("dataQuality",a.bind(D,this)),this._logger.setObservableSessionId&&this._logger.setObservableSessionId(this._protocol.getObservableSessionId())}function x(){var a=this;this._connected=!0,a._stopped||a._protocol.authenticate(a._authToken,function(b,c){a._authenticationCallback&&(b?(a._logger.error("Failed to authenticate [%s]",b),R.call(a,"offline"),a._authenticationCallback.call(a,a,"unauthorized",""),a.stop("unauthorized")):"ok"!==c.status?(a._logger.warn("Failed to authenticate, status [%s]",c.status),R.call(a,"offline"),a._authenticationCallback.call(a,a,"unauthorized",""),a.stop("unauthorized")):(R.call(a,"online"),a._authenticationCallback.call(a,a,c.status,c.sessionId)))})}function y(){R.call(this,"reconnecting")}function z(){R.call(this,"reconnected"),this._logger.info("Attempting to re-authenticate after reconnect event");var a=this;a._stopped||a._protocol.authenticate(a._authToken,function(b,c){var d=a._connected===!0;return b?(a._logger.error("Unable to authenticate after reconnect to WebSocket [%s]",b),R.call(a,"offline")):"ok"!==c.status?(a._logger.warn("Unable to authenticate after reconnect to WebSocket, status [%s]",c.status),R.call(a,"offline")):(a._connected=!0,a._logger.info("Successfully authenticated after reconnect to WebSocket"),R.call(a,"online",d))})}function A(){this._connected=!1,R.call(this,"offline")}function B(a){switch(a){case"":case"none":case"ended":return"ended";case"server-error":case"not-ready":case"error":case"died":return"failed";case"censored":return"censored";case"maintenance":return"maintenance";case"capacity":return"capacity";case"app-background":return"app-background";default:return"custom"}}function C(a){var b=a.streamId,c=a.reason;return E.call(this,b,c)}function D(a){var b=a.streamId,c=a.status,d=a.reason,e=this._mediaStreams[b];e&&e.dataQualityChangedCallback(c,d);var f=this._publishers[b];f&&"function"==typeof f.dataQualityChangedCallback&&f.dataQualityChangedCallback(f,c,d)}function E(a,b){this._logger.info("[%s] Stream ended with reason [%s]",a,b);var c=this._mediaStreams[a];c&&c.streamEndedCallback(B(b),b,!0),delete this._mediaStreams[a];var d=this._publishers[a];d&&"function"==typeof d.publisherEndedCallback&&d.publisherEndedCallback(d,B(b),b),delete this._publishers[a];var e=this._peerConnections[a];e&&V.call(this,a,e,"ended"),delete this._peerConnections[a]}function F(c,d,e,f,g,j){var k=this,m=function(m){function n(){for(var a=p.getTracks(),b=0;b<a.length;b++){var c=a[b];if(!U(c))return!1}return!0}function o(a){d.stopped||(k._logger.info("[%s] stop media stream",c),V.call(k,c,e,"stop"),k._protocol.destroyStream(c,a||"",function(a,b){return a?void k._logger.error("[%s] failed to destroy stream [%s]",c,a):"ok"!==b.status?void k._logger.warn("[%s] failed to destroy stream, status [%s]",c,b.status):void k._logger.info("[%s] destroyed stream",c)}),d.stopped=!0)}if(!d.failed){var p=m.stream;if(!p)return d.failed=!0,k._logger.warn("[%s] No remote stream",c),g.call(k,void 0,"failed");k._logger.info("[%s] Got remote stream",c);var q=function s(g){var m={children:[],renderer:null,isStopped:!1,isStreamEnded:!1,mediaStream:{createRenderer:function(){var b=null,c=new i(k._logger);return{start:function(a){return b=l.attachMediaStream(a,g),f.recordTimeToFirstFrame(b),f.recordRebuffering(b),f.recordVideoResolutionChanges(b),j.receiveAudio===!1&&(b.muted=!0),m.renderer=this,c.start(this,b),b},stop:function(){c.stop(),f.stop(),b&&("function"==typeof b.pause&&b.pause(),b.src&&(b.src=""),b.srcObject&&(b.srcObject=null),b=null),m.renderer=null},getStats:function(){if(!b)return{width:0,height:0,currentTime:0,lag:0,networkState:ba.NETWORK_NO_SOURCE};var c=(a.now()-j.originStartTime)/1e3,d=k._networkOneWayLatency/1e3;return{width:b.videoWidth||b.width,height:b.videoHeight||b.height,currentTime:c,lag:d,networkState:b.networkState}},setDataQualityChangedCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.dataQualityChangedCallback=a},setVideoDisplayDimensionsChangedCallback:function(a,b){c.setVideoDisplayDimensionsChangedCallback(a,b)}}},setStreamEndedCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.streamEndedCallback=a},setStreamErrorCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.streamErrorCallback=a},stop:function(a){m.isStopped||(T(g),n()&&o(a),m.isStopped=!0)},monitor:function q(a,b){if("object"!=typeof a)throw new Error('"options" must be an object');if("function"!=typeof b)throw new Error('"callback" must be a function');var q=new h(c,e,k._logger);a.direction="inbound",q.start(a,function(){return m.mediaStream.isActive()},function(a){return k._logger.warn("[%s] Media stream triggered monitor condition for [%s]",c,a),b(m.mediaStream,"client-side-failure",a)})},getStats:function(a){b.isFunction(a,"callback"),this._lastStats||(this._lastStats={});var c=this;return l.getStats(e,null,function(b){a(W(b,c._lastStats))})},getStream:function(){return g},isActive:function(){var a=d.stopped,b="object"!=typeof k._mediaStreams[c],e=m.isStopped;return!a&&!b&&!e},getStreamId:function(){return c},select:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');if("function"!=typeof window.MediaStream)throw new Error("MediaStream not supported in current browser");for(var b=p.getTracks(),c=new window.MediaStream,d=0;d<b.length;d++)a(b[d],d)&&c.addTrack(b[d]);if(0===c.getTracks().length)return k._logger.warn("No tracks selected");var e=s(c);return m.children.push(e),e.mediaStream}},streamErrorCallback:function(a,b){for(var c=0;c<m.children.length;c++)m.children[c].streamErrorCallback(a,b);var d=m.mediaStream;"function"==typeof d.streamErrorCallback&&d.streamErrorCallback(d,a,b)},streamEndedCallback:function(a,b){for(var c=0;c<m.children.length;c++)m.children[c].streamEndedCallback(a,b);if(!m.isStreamEnded){var d=m.mediaStream;m.isStreamEnded=!0,"function"==typeof d.streamEndedCallback&&d.streamEndedCallback(d,a,b),d.stop(),m.renderer&&m.renderer.stop()}},dataQualityChangedCallback:function(a,b){for(var c=0;c<m.children.length;c++)m.children[c].dataQualityChangedCallback(a,b);var d=m.renderer;d&&"function"==typeof d.dataQualityChangedCallback&&d.dataQualityChangedCallback(d,a,b)}};return m},r=q(p);k._mediaStreams[c]=r,g.call(k,r.mediaStream)}};l.addEventListener(e,"addstream",m)}function G(a,b,c){var d=this,e=function(b){var e=b.candidate;e?d._logger.debug("[%s] ICE candidate: [%s] [%s] [%s]",a,e.sdpMid,e.sdpMLineIndex,e.candidate):d._logger.info("[%s] ICE candidate discovery complete",a),c&&c(e)};l.addEventListener(b,"icecandidate",e)}function H(a,b){var c=this,d=function(a){c._logger.info("[%s] Negotiation needed")},e=function(d){c._logger.info("[%s] ICE connection state changed [%s]",a,b.iceConnectionState)},f=function(d){c._logger.info("[%s] ICE gathering state changed [%s]",a,b.iceGatheringState)},g=function(d){c._logger.info("[%s] Signaling state changed [%s]",a,b.signalingState)},h=function(d){c._logger.info("[%s] Connection state changed [%s]",a,b.connectionState)};l.addEventListener(b,"negotiationneeded",d),l.addEventListener(b,"iceconnectionstatechange",e),l.addEventListener(b,"icegatheringstatechange ",f),l.addEventListener(b,"signalingstatechange",g),l.addEventListener(b,"connectionstatechange",h)}function I(a,b,c){var d=this,e={stopped:!1},f={getStreamId:function(){return a},getStream:function(){return d._logger.debug("[%s] Unable to get stream on publisher of remote origin.",a),null},getStats:function(){return d._logger.debug("[%s] Unable to get stream stats on publisher of remote origin.",a),null},isActive:function(){return!e.stopped},hasEnded:function(){return e.stopped},stop:function(b){e.stopped||(d._protocol.destroyStream(a,b||"",function(b,c){return b?void d._logger.error("[%s] failed to destroy stream [%s]",a,b):"ok"!==c.status?void d._logger.warn("[%s] failed to destroy stream, status [%s]",a,c.status):void d._logger.info("[%s] destroyed stream",a)}),e.stopped=!0)},setPublisherEndedCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.publisherEndedCallback=a},setDataQualityChangedCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.dataQualityChangedCallback=a},getOptions:function(){return c},monitor:function(a,b){if("object"!=typeof a)throw new Error('"options" must be an object');if("function"!=typeof b)throw new Error('"callback" must be a function')}};d._publishers[a]=f,b(f)}function J(c,d,e,f,g,i,j,k){function m(){function c(c){n._logger.info("Created answer [%s]",c.sdp),n._protocol.setAnswerDescription(e,c.sdp,function(c,g){function j(){var a=/(b=AS:([0-9]*)[\n\r]*)/gi,c=/(mid:video)([\n\r]*)/gi;n._logger.info("Set local description (answer)");var g=0,j=a.exec(f);j&&j.length>=3&&(g=1e3*j[2]);var m={getStreamId:function(){return e},getStream:function(){return d},isActive:function(){return!o.stopped},hasEnded:function(){switch(r.iceConnectionState){case"new":case"checking":case"connected":case"completed":return!1;case"disconnected":case"failed":case"closed":return!0;default:return!0}},stop:function(a){o.stopped||(V.call(n,e,r,"closed"),n._protocol.destroyStream(e,a||"",function(a,b){return a?void n._logger.error("[%s] failed to destroy stream [%s]",e,a):"ok"!==b.status?void n._logger.warn("[%s] failed to destroy stream, status [%s]",e,b.status):void n._logger.info("[%s] destroyed stream",e)}),o.stopped=!0)},setPublisherEndedCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.publisherEndedCallback=a},setDataQualityChangedCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.dataQualityChangedCallback=a},limitBandwidth:function(b){if("number"!=typeof b)throw new Error('"bandwidthLimit" must be a number');var d=g?Math.min(b,g):b,e=r.remoteDescription;n._logger.info("Changing bandwidth limit to [%s]",d);var f=e.sdp.replace(a,"");f=f.replace(c,function(a,b,c,e,f){return[b,c,"b=AS:",Math.ceil(d/1e3),c].join("")});var h=new l.RTCSessionDescription({type:e.type,sdp:f});return r.setRemoteDescription(h),{dispose:function(){r.setRemoteDescription(e)}}},monitor:function p(a,b){if("object"!=typeof a)throw new Error('"options" must be an object');if("function"!=typeof b)throw new Error('"callback" must be a function');var p=new h(e,r,n._logger);a.direction="outbound",p.start(a,function(){return n._publishers[e]===m&&!o.stopped},function(a){return n._logger.warn("[%s] Publisher triggered monitor condition for [%s]",e,a),b(m,"client-side-failure",a)})},setRemoteMediaStreamCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.remoteMediaStreamCallback=a,s&&a(m,s)},getOptions:function(){return k},getStats:function(a){b.isFunction(a,"callback"),this._lastStats||(this._lastStats={});var c=this;return l.getStats(r,null,function(b){a(W(b,c._lastStats))})}};n._publishers[e]=m,i.call(n,m)}if(c)return n._logger.error("Failed to set answer description [%s]",c),u();if("ok"!==g.status)return n._logger.warn("Failed to set answer description, status [%s]",g.status),u();a.includes(g.options,"ice-candidates")&&(t=function(b){var c=[],d=[];b?c.push(b):d.push("completed"),n._protocol.addIceCandidates(e,c,d,function(b,c){return b?void n._logger.error("Failed to add ICE candidate [%s]",b):"ok"!==c.status?void n._logger.warn("Failed to add ICE candidate, status [%s]",c.status):void(a.includes(c.options,"cancel")&&(t=null))})});var m=new l.RTCSessionDescription({type:"answer",sdp:g.sessionDescription.sdp});r.setLocalDescription(m,j,u)})}n._logger.info("Set remote description (offer)");var g={mandatory:{}};"Chrome"===l.browser?(g.mandatory.OfferToReceiveVideo=j.receiveVideo===!0,g.mandatory.OfferToReceiveAudio=j.receiveAudio===!0):(g.mandatory.offerToReceiveVideo=j.receiveVideo===!0,g.mandatory.offerToReceiveAudio=j.receiveAudio===!0),r.createAnswer(c,u,g)}var n=this,o={failed:!1,stopped:!1},p=f.match(/a=crypto:/i),q=f.match(/m=application /i),r=new l.RTCPeerConnection(c,{optional:[{DtlsSrtpKeyAgreement:!p},{RtpDataChannels:q}]}),s=null,t=null;n._peerConnections[e]=r,r.addStream(d);var u=function(){o.failed||(o.failed=!0,o.stopped=!0,delete n._peerConnections[e],V.call(n,e,r,"failure"),i.call(n,void 0,"failed"))};F.call(n,e,o,r,g,function(a){var b=n._publishers[e];s=a,b&&b.remoteMediaStreamCallback&&b.remoteMediaStreamCallback(b,a)},j),G.call(n,e,r,function(a){t&&t(a)}),H.call(n,e,r);var v=new l.RTCSessionDescription({type:"offer",sdp:f});r.setRemoteDescription(v,m,u)}function K(b,c,d,e,f,g){function h(){function b(b){i._logger.info("Created answer [%s]",b.sdp),i._protocol.setAnswerDescription(c,b.sdp,function(b,d){function e(){i._logger.debug("Set local description (answer)")}if(b)return i._logger.error("Failed to set answer description [%s]",b),p();if("ok"!==d.status)return i._logger.warn("Failed to set answer description, status [%s]",d.status),p();a.includes(d.options,"ice-candidates")&&(o=function(b){var d=[],e=[];b?d.push(b):e.push("completed"),i._protocol.addIceCandidates(c,b,e,function(b,c){return b?void i._logger.error("Failed to add ICE candidate [%s]",b):"ok"!==c.status?void i._logger.warn("Failed to add ICE candidate, status [%s]",c.status):void(a.includes(c.options,"cancel")&&(o=null))})});var f=new l.RTCSessionDescription({type:"answer",sdp:d.sessionDescription.sdp});n.setLocalDescription(f,e,p)})}i._logger.debug("Set remote description (offer)");var d={mandatory:{}};"Chrome"===l.browser?(d.mandatory.OfferToReceiveVideo=g.receiveVideo!==!1,d.mandatory.OfferToReceiveAudio=g.receiveAudio!==!1):(d.mandatory.offerToReceiveVideo=g.receiveVideo!==!1,d.mandatory.offerToReceiveAudio=g.receiveAudio!==!1),n.createAnswer(b,p,d)}var i=this,j={failed:!1,stopped:!1},k=d.match(/a=crypto:/i),m=d.match(/m=application /i),n=new l.RTCPeerConnection(b,{optional:[{DtlsSrtpKeyAgreement:!k},{RtpDataChannels:m}]}),o=null;i._peerConnections[c]=n;var p=function(){j.failed||(j.failed=!0,j.stopped=!0,delete i._peerConnections[c],V.call(i,c,n,"failure"),f.call(i,void 0,"failed"))};F.call(i,c,j,n,e,f,g),G.call(i,c,n,function(a){o&&o(a)}),H.call(i,c,n);var q=new l.RTCSessionDescription({type:"offer",sdp:d});n.setRemoteDescription(q,h,p)}function L(a,b,c,d,e){var f=this,g=b.match(/a=x-playlist:([^\n]*[.]mpd\??[^\s]*)/m),h=b.match(/a=x-playlist:([^\n]*[.]m3u8)/m);return g&&2===g.length&&f._shaka&&f._shaka.Player.isBrowserSupported()?(e.isDrmProtectedContent=/[?&]drmToken=([^&]*)/.test(g[1])||/x-widevine-service-certificate/.test(b),e.isDrmProtectedContent&&(e.widevineServiceCertificateUrl=b.match(/a=x-widevine-service-certificate:([^\n][^\s]*)/m)[1]),M.call(f,a,g[1],c,d,e)):h&&2===h.length&&"maybe"===document.createElement("video").canPlayType("application/vnd.apple.mpegURL")?Q.call(f,a,h[1],c,d,e):(f._logger.warn("[%s] Offer does not contain a supported manifest",a,b),d.call(f,void 0,"failed"))}function M(b,c,d,e,f){var g=this;if(!g._shaka)return g._logger.warn("[%s] Shaka player not available",b),e.call(g,void 0,"live-player-missing");if(!g._shaka.Player.isBrowserSupported())return g._logger.warn("[%s] Shaka does not support this browser",b),e.call(g,void 0,"browser-unsupported");var h=g._shaka,j=encodeURI(c).replace(/[#]/g,"%23"),k=function(a){var c=l;c.streamErrorCallback?(g._logger.debug("[%s] DASH live stream error event [%s]",b,a.detail),c.streamErrorCallback(c,"shaka",a.detail)):g._logger.error("[%s] DASH live stream error event [%s]",b,a.detail)},l={renderer:null,isStreamEnded:!1,isStopped:!1,waitingForLastChunk:!1,mediaStream:{createRenderer:function(){function c(){if(r.time=a.now(),0===p.buffered.length)return g._logger.debug("[%s] Dash stream progress event fired without any buffered content",b);var c=p.buffered.end(p.buffered.length-1);if(r.buffered!==c){if(null!==r.buffered){var d=r.averageLength*r.count,e=d+(c-r.buffered);r.count+=1,r.averageLength=e/r.count}r.buffered=c}}function e(){g._logger.info("[%s] Loading Dash stream stalled.",b),0!==r.time&&setTimeout(function(){a.now()-r.time>m()&&l.waitingForLastChunk&&l.renderer.stop("ended")},m())}function m(){return 1.5*r.averageLength<2e3?2e3:1.5*r.averageLength}function n(){g._logger.info("[%s] Dash stream ended.",b)}var o=null,p=null,q=new i(g._logger),r={time:0,buffered:null,averageLength:0,count:0};return{start:function(i){function m(d){o.configure(d),f.receiveAudio===!1&&(i.muted=!0),o.addEventListener("error",k),i.addEventListener("stalled",e,!1),i.addEventListener("progress",c,!1),i.addEventListener("ended",n,!1),o.load(j).then(function(){g._logger.info("[%s] DASH live stream has been loaded",b),a.isFunction(i.play)&&i.play()})["catch"](function(a){g._logger.error("[%s] Error while loading DASH live stream [%s]",b,a.code,a),l.streamErrorCallback("shaka",a)}),q.start(this,i),p=i}o=new h.Player(i),l.renderer=this,d.recordTimeToFirstFrame(i),d.recordRebuffering(i),d.recordVideoResolutionChanges(i);var r={abr:{defaultBandwidthEstimate:ia},manifest:{retryParameters:{timeout:1e4}},streaming:{rebufferingGoal:2,bufferingGoal:10,bufferBehind:30,retryParameters:{timeout:1e4}}};return f.isDrmProtectedContent?N.call(g,r,f,function(a,b){if(a)throw g._logger.error("Failed to add DRM configuration to shaka player",a),a;m(b)}):m(r),i},stop:function(){if(q.stop(),d.stop(),o){var a=function(){var a="";p&&(p.removeEventListener("stalled",e,!1),p.removeEventListener("progress",c,!1),p.removeEventListener("ended",n,!1)),l.streamEndedCallback(B(a),a),o=null,p=null};o.destroy().then(function(){g._logger.info("[%s] DASH live stream has been destroyed",b)}).then(function(){a()})["catch"](function(c){g._logger.error("[%s] Error while destroying DASH live stream [%s]",b,c.code,c),a(),l.streamErrorCallback("shaka",c)})}l.renderer=null},getStats:function(){if(!o)return{width:0,height:0,currentTime:0,lag:0,networkState:ba.NETWORK_NO_SOURCE};var b=o.getStats(),c=p.currentTime,d=(a.now()-f.originStartTime)/1e3,e=Math.max(0,d-c);return b.currentTime=c,b.lag=e,b.estimatedBandwidth>0?b.networkState=ba.NETWORK_LOADING:b.playTime>0?b.networkState=ba.NETWORK_IDLE:b.video?b.networkState=ba.NETWORK_EMPTY:b.networkState=ba.NETWORK_NO_SOURCE,b},setDataQualityChangedCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.dataQualityChangedCallback=a},getPlayer:function(){return o},setVideoDisplayDimensionsChangedCallback:function(a,b){q.setVideoDisplayDimensionsChangedCallback(a,b)}}},select:function(a){return g._logger.warn("[%s] selection of tracks not supported for shaka live streams",b),this},setStreamEndedCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.streamEndedCallback=a},setStreamErrorCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.streamErrorCallback=a},stop:function(a){l.isStopped||(g._logger.info("[%s] stop media stream",b),g._protocol.destroyStream(b,a||"",function(a,c){return a?void g._logger.error("[%s] failed to destroy stream, [%s]",b,a):"ok"!==c.status?void g._logger.warn("[%s] failed to destroy stream, status [%s]",b,c.status):void g._logger.info("[%s] destroyed stream",b)}),l.isStopped=!0)},monitor:function(a,b){if("object"!=typeof a)throw new Error('"options" must be an object');if("function"!=typeof b)throw new Error('"callback" must be a function')},getStream:function(){return g._logger.debug("[%s] stream not available for shaka live streams",b),null},isActive:function(){return!l.isStopped},getStreamId:function(){return b},getStats:function(){return g._logger.debug("[%s] stats not available for shaka live streams",b),null}},streamErrorCallback:function(a,b){var c=l.mediaStream;"function"==typeof c.streamErrorCallback&&c.streamErrorCallback(c,a,b)},streamEndedCallback:function(a,b,c){if(c&&!l.waitingForLastChunk&&!l.isStopped)return l.waitingForLastChunk=!0,g._logger.info("[%s] Shaka stream ended. Waiting for end of content.");if(!l.isStreamEnded){var d=l.mediaStream;l.isStreamEnded=!0,"function"==typeof d.streamEndedCallback&&d.streamEndedCallback(d,a,b),d.stop(),l.renderer&&l.renderer.stop()}},dataQualityChangedCallback:function(a,b){var c=l.renderer;c&&"function"==typeof c.dataQualityChangedCallback&&c.dataQualityChangedCallback(c,a,b)}};g._mediaStreams[b]=l,e.call(g,l.mediaStream)}function N(a,b,c){a.drm||(a.drm={}),a.drm.servers||(a.drm.servers={}),a.drm.advanced||(a.drm.advanced={}),a.manifest||(a.manifest={}),a.manifest.dash||(a.manifest.dash={}),O.call(this,a,c,b)}function O(a,b,c){function d(c,d){return c?void b(c):(fa=d,a.drm.advanced["com.widevine.alpha"]={serverCertificate:P(d)},void b(null,a))}a.manifest.dash.customScheme=function(a){if("com.phenixp2p.widevine"===a.getAttribute("schemeIdUri"))return[{keySystem:"com.widevine.alpha",licenseServerUri:decodeURIComponent(a.getAttribute("widevineLicenseServerUrl"))}]},fa?d(null,fa):e.get(c.widevineServiceCertificateUrl,d,{mimeType:"text/plain; charset=x-user-defined"})}function P(a){for(var b=a.length,c=new Uint8Array(b),d=0;d<b;d++)c[d]=a.charCodeAt(d);return c}function Q(b,c,d,e,f){var g=this,h=encodeURI(c).replace(/[#]/g,"%23"),j=function(a,c){var d=k.mediaStream;d.streamErrorCallback?(g._logger.debug("[%s] HLS live stream error event [%s]",b,a.detail),d.streamErrorCallback(d,"hls",a.detail)):g._logger.error("[%s] HLS live stream error event [%s]",b,a.detail)},k={renderer:null,isStreamEnded:!1,isStopped:!1,waitingForLastChunk:!1,mediaStream:{createRenderer:function(){function c(){if(t.time=a.now(),0===q.buffered.length)return g._logger.debug("[%s] Hls stream progress event fired without any buffered content",b);var c=q.buffered.end(q.buffered.length-1);if(t.buffered!==c){if(null!==t.buffered){var d=t.averageLength*t.count,e=d+(c-t.buffered);t.count+=1,t.averageLength=e/t.count}t.buffered=c}}function e(){if(g._logger.info("[%s] Loading Hls stream stalled.",b),0===t.count)n();else{setTimeout(function(){0===t.count&&n()},o());var a=5e3;setTimeout(p,a)}}function l(){g._logger.info("[%s] Hls stream ended",b),k.renderer&&k.renderer.stop("ended")}function m(){g._logger.info("Time elapsed since last progress [%s]",a.now()-t.time),setTimeout(p,o())}function n(){g._logger.info("[%s] Attempting to reload Hls stream.",b),q.pause(),q.src="",q.src=h,q.play()}function o(){return 1.5*t.averageLength<2e3?2e3:1.5*t.averageLength}function p(){a.now()-t.time>o()&&k.waitingForLastChunk&&k.renderer&&k.renderer.stop("ended")}var q=null,r=[],s=new i(g._logger),t={time:0,buffered:null,averageLength:0,count:0};return{start:function(a){try{return a.src=h,f.receiveAudio===!1&&(a.muted=!0),d.recordTimeToFirstFrame(a),
d.recordRebuffering(a),d.recordVideoResolutionChanges(a),k.renderer=this,a.addEventListener("error",j,!0),a.addEventListener("stalled",e,!1),a.addEventListener("progress",c,!1),a.addEventListener("ended",l,!1),a.addEventListener("waiting",m,!1),a.play(),q=a,s.start(this,q),a}catch(i){g._logger.error("[%s] Error while loading HLS live stream [%s]",b,i.code,i),k.streamErrorCallback("hls",i)}},stop:function(){if(s.stop(),d.stop(),q){var a=function(){q&&(q.removeEventListener("error",j,!0),q.removeEventListener("stalled",e,!1),q.removeEventListener("progress",c,!1),q.removeEventListener("ended",l,!1),q.removeEventListener("waiting",m,!1),q.src="",q=null);var a="";k.streamEndedCallback(B(a),a)};try{q.pause(),g._logger.info("[%s] HLS live stream has been destroyed",b),a()}catch(f){g._logger.error("[%s] Error while destroying HLS live stream [%s]",b,f.code,f),a(),k.streamErrorCallback("hls",f)}}k.renderer=null},getStats:function(){if(!q)return{width:0,height:0,currentTime:0,lag:0,networkState:ba.NETWORK_NO_SOURCE};var b=q?q.currentTime||0:0,c=q&&q.buffered&&q.buffered.length>0?q.buffered.end(q.buffered.length-1):0,d=Math.max(0,c-b);r.push(d),r.length>15&&r.shift();for(var e=0,g=0,h=r.length;g<h;g++)e=Math.max(e,r[g]);var i=2,j=(a.now()-f.originStartTime)/1e3,k=2*i+e,l=j-k;return{width:q.videoWidth||q.width,height:q.videoHeight||q.height,currentTime:l,originTime:j,lag:k,networkState:q.networkState}},setDataQualityChangedCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.dataQualityChangedCallback=a},setVideoDisplayDimensionsChangedCallback:function(a,b){s.setVideoDisplayDimensionsChangedCallback(a,b)}}},select:function(a){return g._logger.warn("[%s] selection of tracks not supported for HLS live streams",b),this},setStreamEndedCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.streamEndedCallback=a},setStreamErrorCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.streamErrorCallback=a},stop:function(a){k.isStopped||(g._logger.info("[%s] stop media stream",b),g._protocol.destroyStream(b,a||"",function(a,c){return a?void g._logger.error("[%s] failed to destroy stream [%s]",b,a):"ok"!==c.status?void g._logger.warn("[%s] failed to destroy stream, status [%s]",b,c.status):void g._logger.info("[%s] destroyed stream",b)}),k.isStopped=!0)},monitor:function(a,b){if("object"!=typeof a)throw new Error('"options" must be an object');if("function"!=typeof b)throw new Error('"callback" must be a function')},isActive:function(){return!k.isStopped},getStreamId:function(){return b},getStream:function(){return g._logger.debug("[%s] stream not available for HLS live streams",b),null},getStats:function(){return g._logger.debug("[%s] stats not available for HLS live streams",b),null}},streamErrorCallback:function(a,b){var c=k.mediaStream;"function"==typeof c.streamErrorCallback&&c.streamErrorCallback(c,a,b)},streamEndedCallback:function(a,b,c){if(c&&!k.waitingForLastChunk&&!k.isStopped)return k.waitingForLastChunk=!0,g._logger.info("[%s] Hls stream ended. Waiting for end of content.");if(!k.isStreamEnded){var d=k.mediaStream;k.isStreamEnded=!0,"function"==typeof d.streamEndedCallback&&d.streamEndedCallback(d,a,b),d.stop(),k.renderer&&k.renderer.stop()}},dataQualityChangedCallback:function(a,b){var c=k.renderer;c&&"function"==typeof c.dataQualityChangedCallback&&c.dataQualityChangedCallback(c,a,b)}};g._mediaStreams[b]=k,e.call(g,k.mediaStream)}function R(a,b){var c=this.getStatus();if(c!==a){if(this._observableStatus.setValue(a),b)return;switch(a){case"connecting":case"reconnecting":case"reconnected":break;case"offline":this._offlineCallback.call(this);break;case"online":this._onlineCallback.call(this)}}}function S(a,b){if("object"==typeof a&&"object"==typeof b&&b.constructor===Array)for(var c=0;c<b.length;c++)a.addTrack(b[c])}function T(a){if(a&&"function"==typeof a.getTracks)for(var b=a.getTracks(),c=0;c<b.length;c++){var d=b[c];d.stop()}}function U(a){if("object"!=typeof a)throw new Error("Invalid track.");return"ended"===a.readyState}function V(a,b,c){"closed"===b.signalingState||b.__closing||(this._logger.debug("[%s] close peer connection [%s]",a,c),b.close(),b.__closing=!0)}function W(b,c){if(!b)return null;var d=[],e=function(b,e,f,g,h){if(b){a.hasIndexOrKey(c,b)||(c[b]={timestamp:0});var i=parseFloat(f)-c[b].timestamp,j=X(parseFloat(g),c[b].bytesSent,i),k=Y(parseFloat(h),c[b].bytesReceived,i);c[b].bytesSent=parseFloat(g),c[b].bytesReceived=parseFloat(h),c[b].timestamp=parseFloat(f),d.push({uploadRate:j,downloadRate:k,mediaType:e,ssrc:b})}};return a.isFunction(b.result)?a.forEach(b.result(),function(a){if("ssrc"===a.type){var b=a.stat("ssrc"),c=a.stat("bytesSent"),d=a.stat("bytesReceived"),f=a.stat("mediaType"),g=a.timestamp.getTime();e(b,f,g,c,d)}}):a.isFunction(b.values)?a.forEach(Array.from(b.values()),function(b){if(a.hasIndexOrKey(b,"ssrc")){if(!b.ssrc||b.id.indexOf("rtcp")>-1)return;e(b.ssrc,b.mediaType,b.timestamp,b.bytesSent,b.bytesReceived)}}):a.forEach(b,function(b){if(a.hasIndexOrKey(b,"ssrc")){if(!b.ssrc||b.id.indexOf("rtcp")>-1)return;e(b.ssrc,b.mediaType,b.timestamp,b.bytesSent,b.bytesReceived)}}),d}function X(a,b,c){if(a){var d=b||0,e=8e3*(a-d)/c;return Math.round(e/1e3)}return 0}function Y(a,b,c){if(a){var d=b||0,e=8e3*(a-d)/c;return Math.round(e/1e3)}return 0}function Z(b){if(!b)return b;var c=a.isArray(b)?[]:{},d=a.bind($,null,c);return a.isArray(b)?a.forEach(b,d):a.forOwn(b,d),c}function $(b,c,d){if(null!==c){if(a.isObject(c)||a.isArray(c))return b[d]=Z(c);if(!a.isString(c)||!a.isString(d))return b[d]=c;var e=0===c.toLowerCase().indexOf(d.toLowerCase()),f=e?c.substring(d.length,c.length).toLowerCase():c;b[d]=f}}function _(a){return"firefox"===l.browser.toLowerCase()&&aa(a),a}function aa(b){return b?(a.forEach(b.iceServers,function(b){b.urls=a.filter(b.urls,function(a){return 0!==a.indexOf("turns")})}),b):b}var ba=a.freeze({NETWORK_EMPTY:0,NETWORK_IDLE:1,NETWORK_LOADING:2,NETWORK_NO_SOURCE:3}),ca="2017-08-07T16:16:54Z",da="icngjadgidcmifnehjcielbmiapkhjpn",ea=a.freeze({url:"https://addons.mozilla.org/firefox/downloads/file/474686/pcast_screen_sharing-1.0.3-an+fx.xpi",iconUrl:"https://phenixp2p.com/public/images/phenix-logo-unicolor-64x64.png",hash:"sha256:4972e9718ea7f7c896abc12d1a9e664d5f3efe498539b082ab7694f9d7af4f3b"}),fa=null,ga=100,ha=450,ia=2e6;m.prototype.getBaseUri=function(){return this._endPoint.getBaseUri()},m.prototype.getStatus=function(){return this._observableStatus.getValue()},m.prototype.getObservableStatus=function(){return this._observableStatus},m.prototype.start=function(a,b,c,d){if("string"!=typeof a)throw new Error('"authToken" must be a string');if("function"!=typeof b)throw new Error('"authenticationCallback" must be a function');if("function"!=typeof c)throw new Error('"onlineCallback" must be a function');if("function"!=typeof d)throw new Error('"offlineCallback" must be a function');if(this._started)throw new Error('"Already started"');this._stopped=!1,this._started=!0,this._authToken=a,this._authenticationCallback=b,this._onlineCallback=c,this._offlineCallback=d,R.call(this,"connecting"),this._peerConnections={},this._mediaStreams={},this._publishers={},this._gumStreams=[];var e=this;n.call(e,function(a){e._screenSharingEnabled=a,e._endPoint.resolveUri(function(a,b){if(a){switch(e._logger.error("Failed to connect to [%s]",e._baseUri,a),R.call(e,"offline"),a.code){case 0:e._authenticationCallback.call(e,e,"network-unavailable","");break;case 503:e._authenticationCallback.call(e,e,"capacity","");break;default:e._authenticationCallback.call(e,e,"failed","")}return e._stopped=!0,void(e._started=!1)}e._logger.info("Discovered end point [%s] with RTT [%s]",b.uri,b.roundTripTime),e._networkOneWayLatency=b.roundTripTime/2,w.call(e,b.uri)})})},m.prototype.stop=function(){if(this._started){this._stopped=!0,this._started=!1,delete this._authenticationCallback;try{var b="";for(var c in this._mediaStreams)this._mediaStreams.hasOwnProperty(c)&&E.call(this,c,b);for(var d in this._publishers)if(this._publishers.hasOwnProperty(d)){var e=this._publishers[d];E.call(this,d,b),a.includes(e.getOptions(),"detached")||e.stop(b)}for(var f in this._peerConnections)this._peerConnections.hasOwnProperty(f)&&E.call(this,f,b);for(var g=0;g<this._gumStreams.length;g++)for(var h=this._gumStreams[g].getTracks(),i=0;i<h.length;i++)h[i].stop()}finally{this._protocol&&(this._protocol.disconnect(),this._protocol=null),this._logger.setObservableSessionId&&this._logger.setObservableSessionId(null)}}},m.prototype.getUserMedia=function(a,b){if("object"!=typeof a)throw new Error('"options" must be an object');if("function"!=typeof b)throw new Error('"callback" must be a function');return u.call(this,a,b)},m.prototype.publish=function(b,c,d,e,f){if(!this._started)throw new Error("PCast not started. Unable to publish. Please start pcast first.");if("string"!=typeof b)throw new Error('"streamToken" must be a string');if("object"!=typeof c&&"string"!=typeof c)throw new Error('"streamToPublish" must be an object or URI');if("function"!=typeof d)throw new Error('"callback" must be a function');if(e=e||[],!Array.isArray(e))throw new Error('"tags" must be an array');if(f=f||{},"object"!=typeof f)throw new Error('"options" must be an object');var g=this,h="upload",i=a.assign(f,{negotiate:!0});"string"==typeof c?(i.negotiate=!1,i.connectUri=c):i.connectUri=f.connectUri,e.length>0&&(i.tags=e);var j=new k(this.getProtocol().getSessionId(),this._logger,this._metricsTransmitter);j.setProperty("resource",h),this._protocol.setupStream(h,b,i,function(a,b){if(a)return g._logger.error("Failed to create uploader [%s]",a),d.call(g,g,"failed");if("ok"===b.status){var e=b.createStreamResponse.streamId;if(j.setStreamId(e),j.setStartOffset(b.createStreamResponse.offset),j.recordMetric("Provisioned"),i.negotiate===!0){var h=b.createStreamResponse.createOfferDescriptionResponse.sessionDescription.sdp,k=_(Z(b.createStreamResponse.rtcConfiguration));return J.call(g,k,c,e,h,j,function(a,b){j.recordMetric("SetupCompleted",{string:b?"failed":"ok"}),b?d.call(g,g,"failed",null):d.call(g,g,"ok",a)},f,b.createStreamResponse.options)}return I.call(g,e,function(a,b){j.recordMetric("SetupCompleted",{string:b?"failed":"ok"}),b?d.call(g,g,"failed",null):d.call(g,g,"ok",a)},b.createStreamResponse.options)}switch(g._logger.warn("Failed to create uploader, status [%s]",b.status),b.status){case"capacity":case"unauthorized":return d.call(g,g,b.status);default:return d.call(g,g,"failed")}})},m.prototype.subscribe=function(b,c,d){if(!this._started)throw new Error("PCast not started. Unable to subscribe. Please start pcast first.");if("string"!=typeof b)throw new Error('"streamToken" must be a string');if("function"!=typeof c)throw new Error('"callback" must be a function');if(d=d||{},"object"!=typeof d)throw new Error('"options" must be an object');var e=this,f="download",g=a.assign(d,{negotiate:d.negotiate!==!1}),h=new k(this.getProtocol().getSessionId(),this._logger,this._metricsTransmitter);h.setProperty("resource",f),this._protocol.setupStream(f,b,g,function(b,f){if(b)return e._logger.error("Failed to create downloader [%s]",b),c.call(e,e,"failed");if("ok"===f.status){var g=f.createStreamResponse.streamId,i=f.createStreamResponse.createOfferDescriptionResponse.sessionDescription.sdp,j=_(Z(f.createStreamResponse.rtcConfiguration)),k=a.bind(K,e,j);return i.match(/a=x-playlist:/)&&(k=L),h.setStreamId(g),h.setStartOffset(f.createStreamResponse.offset),h.recordMetric("Provisioned"),d.originStartTime=a.now()-f.createStreamResponse.offset+e._networkOneWayLatency,k.call(e,g,i,h,function(a,b){h.recordMetric("SetupCompleted",{string:b?"failed":"ok"}),b?c.call(e,e,"failed",null):c.call(e,e,"ok",a)},d)}switch(e._logger.warn("Failed to create downloader, status [%s]",f.status),f.status){case"capacity":case"stream-ended":case"origin-stream-ended":case"streaming-not-available":case"unauthorized":return c.call(e,e,f.status);default:return c.call(e,e,"failed")}})},m.prototype.getProtocol=function(){return this._protocol},m.prototype.getLogger=function(){return this._logger},m.prototype.toString=function(){return"PCast["+this.getProtocol().getSessionId()+","+(this._protocol?this._protocol.toString():"uninitialized")+"]"};var ja=function(a){var b;return b="unavailable"===a.code?"conflict":"permission-denied"===a.message?"permission-denied":"PermissionDeniedError"===a.name?"permission-denied":"InternalError"===a.name&&"Starting video failed"===a.message?"conflict":"SourceUnavailableError"===a.name?"conflict":"SecurityError"===a.name&&"The operation is insecure."===a.message?"permission-denied":"failed"};return m}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(10),c(28)],e=function(a,b){"use strict";function c(a,b,c){if("string"!=typeof a)throw new Error('Must pass a valid "version"');if("string"!=typeof b)throw new Error('Must pass a valid "baseUri"');if("object"!=typeof c)throw new Error('Must pass a valid "logger"');this._version=a,this._baseUri=b,this._logger=c}function d(a,c){if(0===a.lastIndexOf("wss:",0))c(void 0,{uri:a+"/ws",roundTripTime:0});else if(0===a.lastIndexOf("https:",0)){var d=this;e.call(d,a,function(a,e){if(a)return c(a);var f=new b(c,d._version,d._baseUri,d._logger);f.resolveAll(e)})}else c(new Error("Uri not supported"))}function e(b,c){a.getWithRetry(b+"/pcast/endPoints",function(a,b){if(a)return c(new Error("Failed to resolve an end point",a));var d=b.split(",");d.length<1&&c(new Error("Failed to discover end points")),c(void 0,d)},f)}var f=4;return c.DefaultPCastUri="https://pcast.phenixp2p.com",c.prototype.getBaseUri=function(){return this._baseUri},c.prototype.resolveUri=function(a){return d.call(this,this._baseUri,a)},c.prototype.toString=function(){return"PCastEndPoint["+this._baseUri+"]"},c}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(4),c(10)],e=function(a,b){"use strict";function c(a,b,c,d){this._done=!1,this._minTime=Number.MAX_VALUE,this._minResponseText="",this._onClosestEndpointFound=a,this._logger=d,this._version=b}var d=4,e=30;return c.prototype.isResolved=function(){return this._done},c.prototype.measurementCallback=function(a,b,c){return b<this._minTime&&(this._logger.info("Current closest end point is [%s] with latency of [%s] ms",c,b),this._minTime=b,this._minResponseText=c),this.isResolved()},c.prototype.completeCallback=function(a){if(this._minResponseText&&this._minTime<Number.MAX_VALUE&&!this.isResolved())return this._done=!0,this._onClosestEndpointFound(void 0,{uri:this._minResponseText,roundTripTime:this._minTime})},c.prototype.resolveAll=function(a){for(var b=0;b<a.length;b++)this.resolve(a[b],d)},c.prototype.resolve=function(c,d){var f=this,g=1,h=0,i=function j(c){var i=1,k=a.now();f._logger.info("[%s] Checking end point [%s]",g,c),b.getWithRetry(c,function(b,i){var l=a.now(),m=l-k,n=m>e;if(f._logger.info("[%s] End point [%s] latency is [%s] ms",g,c,m),g++,!b){if(f.measurementCallback(c,m,i))return;h++}return g<=d&&!f.isResolved()&&(n||b)?(b&&f._logger.info("Retrying after failure to resolve end point [%s] with [%s]",c,b),j(c)):0===h?f._logger.warn("Unable to resolve end point [%s] with [%s]",c,b):f.completeCallback(c)},i)};i(c)},c}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(4),c(5)],e=function(a,b){"use strict";function c(a,b){this.latestValue=null,this.subscribeCallbacks={},this.subscriptionTimeout=100,this.subscriptionCount=0,this.resetOnChange=!1,this.lastChangeTime=0,this.isPendingChanges=!1,this.beforeChange=b,e.call(this,a)}function d(b){return"undefined"==typeof b||null===b?b:a.isArray(b)?b.slice():b}function e(a){var b=a;this.beforeChange&&(b=this.beforeChange(a)),this.latestValue=d(b)}function f(b,c){if(this.lastChangeTime=a.now(),!this.isPendingChanges&&0!==this.subscriptionCount){if(this.isPendingChanges=!0,c)return h.call(this);g.call(this,b)}}function g(b){var c=this;setTimeout(function(){var b=a.now()-c.lastChangeTime;c.resetOnChange&&b<c.subscriptionTimeout?g.call(c,c.subscriptionTimeout-b):h.call(c)},b)}function h(){try{i.call(this)}finally{this.isPendingChanges=!1}}function i(){var b=this;a.forOwn(b.subscribeCallbacks,function(c){a.isFunction(c)&&c(b.latestValue)})}return c.prototype.getValue=function(){return d(this.latestValue)},c.prototype.setValue=function(a){a!==this.latestValue&&(e.call(this,a),f.call(this,this.subscriptionTimeout))},c.prototype.subscribe=function(c,d){function e(){delete h.subscribeCallbacks[i],g&&(clearInterval(g),g=null),h.subscriptionCount-=1}b.isFunction(c),d&&b.isObject(d);var g,h=this,i=a.uniqueId();return h.subscribeCallbacks[i]=c,h.subscriptionCount+=1,d&&("notify"===d.initial&&f.call(h,h.subscriptionTimeout,!0),d.listenForChanges&&(g=setInterval(function(){var a=d.listenForChanges.callback();a!==h.latestValue&&h.setValue(a)},d.listenForChanges.timeout))),{dispose:e}},c.prototype.extend=function(c){switch(b.isObject(c),c.method){case"notifyWhenChangesStop":this.subscriptionTimeout=c.timeout,this.resetOnChange=!0;break;case"notifyAtFixedRate":this.subscriptionTimeout=c.timeout}return a.isNumber(c.rateLimit)&&(this.subscriptionTimeout=c.rateLimit),this},c}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(4),c(5),c(3),c(7),c(25),c(6)],e=function(a,b,c,d,e,f){"use strict";function g(){}return g.prototype.createPCastLogger=function(a,g){a&&b.stringNotEmpty(a,"baseUri");var h=new c,i=d.getAppender(a);return i.setThreshold(f.level.INFO),g||h.addAppender(new e),h.addAppender(i),h.isPCastLogger=!0,h},new g}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(4),c(5),c(29),c(15),c(32),c(11),c(1)],e=function(a,b,c,d,e,f,g){"use strict";function h(b,f,g,h){if("string"!=typeof b)throw new Error('Must pass a valid "uri"');if("string"!=typeof f)throw new Error('Must pass a valid "deviceId"');if("string"!=typeof g)throw new Error('Must pass a valid "version"');if("object"!=typeof h)throw new Error('Must pass a valid "logger"');this._uri=b,this._deviceId=f,this._version=g,this._logger=h,this._mqProtocol=new d(this._logger),this._observableSessionId=new c(null).extend({rateLimit:0}),this._logger.info("Connecting to [%s]",b),this._nextRequestId=0,this._events={},this._requests={},this._webSocket=new e(this._uri,this._logger),this._webSocket.onmessage=a.bind(m,this),this._webSocket.onconnected=a.bind(o,this),this._webSocket.onreconnecting=a.bind(n,this),this._webSocket.onreconnected=a.bind(p,this),this._webSocket.ondisconnected=a.bind(q,this),this._webSocket.onerror=a.bind(r,this)}function i(a,b,c){var d=(this._nextRequestId++).toString(),e={requestId:d,type:a,payload:this._mqProtocol.encode(a,b)};return this._requests[d]=c,this._webSocket.send(this._mqProtocol.encode("mq.Request",e).toString("base64"))}function j(a){var b=this._events[a];return b||(this._events[a]=b=[]),b}function k(b,c){var d=this._events[b];a.remove(d,function(a){return a===c}),this._events[b]=d}function l(a,b){var c=this._events[a];if(c)for(var d=0;d<c.length;d++)c[d].apply(this,b)}function m(a){var b=this._mqProtocol.decode("mq.Response",f.wrap(a.data,"base64"));this._logger.info(">> [%s]",b.type);var c=this._mqProtocol.decode(b.type,b.payload);"pcast.AuthenticateResponse"===b.type?this._observableSessionId.setValue(c.sessionId):"pcast.StreamEnded"===b.type?l.call(this,"streamEnded",[c]):"pcast.StreamDataQuality"===b.type?l.call(this,"dataQuality",[c]):"chat.RoomEvent"===b.type?l.call(this,"roomEvent",[c]):"chat.RoomConversationEvent"===b.type&&l.call(this,"roomChatEvent",[c]);var d=this._requests[b.requestId];if(d)if(delete this._requests[b.requestId],"mq.Error"===b.type){var e=c;d(e,null)}else d(null,c)}function n(a){l.call(this,"reconnecting")}function o(a){l.call(this,"connected")}function p(a){l.call(this,"reconnected")}function q(a){l.call(this,"disconnected",[a.code,a.reason])}function r(a){l.call(this,"error",[a.data])}return h.prototype.on=function(b,c){if("string"!=typeof b)throw new Error('"eventName" must be a string');if("function"!=typeof c)throw new Error('"handler" must be a function');var d=j.call(this,b);return d.push(c),a.bind(k,this,b,c)},h.prototype.disconnect=function(){return this._observableSessionId.setValue(null),this._webSocket.disconnect()},h.prototype.authenticate=function(a,b){if("string"!=typeof a)throw new Error('"authToken" must be a string');if("function"!=typeof b)throw new Error('"callback" must be a function');var c={apiVersion:this._mqProtocol.getApiVersion(),clientVersion:this._version,deviceId:this._deviceId,platform:g.browser,platformVersion:g.browserVersion.toString(),authenticationToken:a};return this.getSessionId()&&(c.sessionId=this.getSessionId()),i.call(this,"pcast.Authenticate",c,b)},h.prototype.getSessionId=function(){return this._observableSessionId.getValue()},h.prototype.getObservableSessionId=function(){return this._observableSessionId},h.prototype.bye=function(a,b){if("string"!=typeof a)throw new Error('"reason" must be a string');if("function"!=typeof b)throw new Error('"callback" must be a function');var c={sessionId:this.getSessionId(),reason:a};return i.call(this,"pcast.Bye",c,b)},h.prototype.setupStream=function(a,b,c,d){if("string"!=typeof a)throw new Error('"streamType" must be a string');if("string"!=typeof b)throw new Error('"streamToken" must be a string');if("object"!=typeof c)throw new Error('"options" must be an object');if("function"!=typeof d)throw new Error('"callback" must be a function');var e=g.browser||"UnknownBrowser",f=e+"-"+(g.browserVersion||0),h={streamToken:b,createStream:{sessionId:this.getSessionId(),options:["data-quality-notifications"],connectUri:c.connectUri,connectOptions:c.connectOptions||[],tags:c.tags||[]}};return c.negotiate&&(h.createStream.createOfferDescription={streamId:"",options:[a,e,f],apiVersion:this._mqProtocol.getApiVersion()}),c.receiveAudio===!1&&h.createStream.options.push("no-audio"),c.receiveVideo===!1&&h.createStream.options.push("no-video"),i.call(this,"pcast.SetupStream",h,d)},h.prototype.setAnswerDescription=function(a,b,c){if("string"!=typeof a)throw new Error('"streamId" must be a string');if("string"!=typeof b)throw new Error('"sdp" must be a string');if("function"!=typeof c)throw new Error('"callback" must be a function');var d={streamId:a,sessionDescription:{type:"Answer",sdp:b},apiVersion:this._mqProtocol.getApiVersion()};return i.call(this,"pcast.SetRemoteDescription",d,c)},h.prototype.addIceCandidates=function(a,b,c,d){if("string"!=typeof a)throw new Error('"streamId" must be a string');if(!(b instanceof Array))throw new Error('"candidates" must be an array');if(!(c instanceof Array))throw new Error('"options" must be an array');if("function"!=typeof d)throw new Error('"callback" must be a function');for(var e=[],f=0;f<b.length;f++){var g=b[f];if("string"!=typeof g.candidate)throw new Error('"candidates['+f+'].candidate" must be a string');if("number"!=typeof g.sdpMLineIndex)throw new Error('"candidates['+f+'].sdpMLineIndex" must be a number');if("string"!=typeof g.sdpMid)throw new Error('"candidates['+f+'].sdpMid" must be a string');e.push({candidate:g.candidate,sdpMLineIndex:g.sdpMLineIndex,sdpMid:g.sdpMid})}var h={streamId:a,candidates:e,options:c,apiVersion:this._mqProtocol.getApiVersion()};return i.call(this,"pcast.AddIceCandidates",h,d)},h.prototype.updateStreamState=function(a,b,c,d,e){if("string"!=typeof a)throw new Error('"streamId" must be a string');if("string"!=typeof b)throw new Error('"signalingState" must be a string');if("string"!=typeof c)throw new Error('"iceGatheringState" must be a string');if("string"!=typeof d)throw new Error('"iceConnectionState" must be a string');if("function"!=typeof e)throw new Error('"callback" must be a function');var f={streamId:a,signalingState:b,iceGatheringState:c,iceConnectionState:d,apiVersion:this._mqProtocol.getApiVersion()};return i.call(this,"pcast.UpdateStreamState",f,e)},h.prototype.destroyStream=function(a,b,c){if("string"!=typeof a)throw new Error('"streamId" must be a string');if("string"!=typeof b)throw new Error('"reason" must be a string');if("function"!=typeof c)throw new Error('"callback" must be a function');var d={streamId:a,reason:b};return i.call(this,"pcast.DestroyStream",d,c)},h.prototype.getRoomInfo=function(a,c,d){a?b.isString(a,"roomId"):b.isString(c,"alias"),b.isFunction(d,"callback");var e={roomId:a,alias:c,sessionId:this.getSessionId()};return i.call(this,"chat.GetRoomInfo",e,d)},h.prototype.createRoom=function(a,c){b.isObject(a,"room"),b.stringNotEmpty(a.name,"room.name"),b.stringNotEmpty(a.type,"room.type"),b.stringNotEmpty(a.description,"room.description"),b.isFunction(c,"callback");var d={sessionId:this.getSessionId(),room:a};return i.call(this,"chat.CreateRoom",d,c)},h.prototype.enterRoom=function(a,c,d,e,f){a?b.isString(a,"roomId"):b.isString(c,"alias"),b.isObject(d,"member"),b.isNumber(e,"timestamp"),b.isFunction(f,"callback");var g={roomId:a,alias:c,sessionId:this.getSessionId(),member:d,timestamp:e};return i.call(this,"chat.JoinRoom",g,f)},h.prototype.leaveRoom=function(a,c,d){b.isString(a,"roomId"),b.isNumber(c,"timestamp"),b.isFunction(d,"callback");var e={roomId:a,sessionId:this.getSessionId(),timestamp:c};return i.call(this,"chat.LeaveRoom",e,d)},h.prototype.updateMember=function(a,c,d){b.isObject(a,"member"),b.isNumber(c,"timestamp"),b.isFunction(d,"callback"),a.updateStreams=a.hasOwnProperty("streams");var e={sessionId:this.getSessionId(),member:a,timestamp:c};return i.call(this,"chat.UpdateMember",e,d)},h.prototype.updateRoom=function(a,c,d){b.isObject(a,"room"),b.isNumber(c,"timestamp"),b.isFunction(d,"callback");var e={sessionId:this.getSessionId(),room:a,timestamp:c};return i.call(this,"chat.UpdateRoom",e,d)},h.prototype.sendMessageToRoom=function(a,c,d){b.stringNotEmpty(a,"roomId"),b.isObject(c,"chatMessage");var e={roomId:a,chatMessage:c};return i.call(this,"chat.SendMessageToRoom",e,d)},h.prototype.subscribeToRoomConversation=function(a,c,d,e){b.stringNotEmpty(a,"sessionId"),b.stringNotEmpty(c,"roomId"),b.isNumber(d,"batchSize");var f={sessionId:a,roomId:c,limit:d,options:["Subscribe"]};return i.call(this,"chat.FetchRoomConversation",f,e)},h.prototype.getMessages=function(a,c,d,e,f,g){b.stringNotEmpty(a,"sessionId"),b.stringNotEmpty(c,"roomId"),f&&e||b.isNumber(d,"batchSize");var h={sessionId:a,roomId:c,limit:d||0,options:[]};return f&&(b.stringNotEmpty(f,"beforeMessageId"),h.beforeMessageId=f),e&&(b.stringNotEmpty(e,"afterMessageId"),h.afterMessageId=e),i.call(this,"chat.FetchRoomConversation",h,g)},h.prototype.toString=function(){return"PCastProtocol["+this._webSocket.toString()+"]"},h}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(4),c(5),c(24)],e=function(a,b,c){"use strict";function d(d,e,g,h){b.stringNotEmpty(d,"uri"),b.isObject(e,"logger"),a.isNullOrUndefined(g)?g=u:b.isNumber(g),this._uri=d,this._logger=e,this._maxReconnectAttempts=g,this._reconnectBackoffInterval=h||t,this._networkConnectionMonitor=new c(r,this._logger),this._hasAttemptedReconnect=!1,this._stopped=!1,this._logger.info("Connecting to [%s]",d),this._webSocket=f.call(this,k,i),this._networkConnectionMonitor.start(a.bind(p,this),a.bind(q,this))}function e(a){return this._webSocket.readyState===w.closed.code?i.call(this,a):this._webSocket.close(a.code,a.reason)}function f(b,c){var d=new WebSocket(this._uri);return d.onopen=a.bind(b,this),d.onclose=a.bind(c,this),d.onmessage=a.bind(o,this),d.onerror=a.bind(n,this),d}function g(a){var b=this;return setTimeout(function(){h.call(b,a)},a*a*this._reconnectBackoffInterval)}function h(a){this._webSocket.readyState!==w.open.code&&this.reconnect(a+1)}function i(a){switch(a.code){case v.reconnecting.code:return;case v.byebye.code:case v.backoffLimitReached.code:case v.networkDisconnect.code:return m.call(this,a);default:if(this._hasAttemptedReconnect)return;return j.call(this,a)}}function j(a){this._logger.info("Attempting to re-establish socket connection after disconnect event with code [%s] and reason [%s]",a.code,a.reason),this.onreconnecting&&this.onreconnecting(a),this.reconnect()}function k(a){this._logger.info("Connected"),this.onconnected&&this.onconnected(a)}function l(a){this._logger.info("Successfully reconnected to WebSocket"),this.onreconnected&&this.onreconnected(a)}function m(a){this._logger.info("Disconnected [%s]: [%s]",a.code,a.reason),this.ondisconnected&&this.ondisconnected(a)}function n(a){this._logger.error("An error occurred [%s]",a.data),this.onerror&&this.onerror(a)}function o(a){this._logger.debug(">> [%s]",a.data),this.onmessage&&this.onmessage(a)}function p(a){var b=this;setTimeout(function(){return b._stopped?b._logger.info("Unable to go back online after network reconnect. Client has stopped WebSocket."):b._webSocket.readyState!==w.open.code?b.reconnect():a?k.call(b):void 0},s)}function q(){m.call(this,v.networkDisconnect)}var r=15e3,s=1e3,t=1e3,u=4,v={byebye:{code:1e3,reason:"byebye",desc:"Client closed"},backoffLimitReached:{code:4e3,reason:"backoff-limit-reached",desc:"Reached the limit in terms of the number of reconnects"},networkDisconnect:{code:4001,reason:"network-disconnect",desc:"Network connection monitor determined loss to internet connectivity"},reconnecting:{code:4002,reason:"reconnecting",desc:"Closing WebSocket in order to attempt to establish another connection"}},w={connecting:{code:0,state:"CONNECTING",desc:"The connection is not yet open"},open:{code:1,state:"OPEN",desc:"The connection is open and ready to communicate"},closing:{code:2,state:"CLOSING",desc:"The connection is in the process of closing"},closed:{code:3,state:"CLOSED",desc:"The connection is closed or could not be opened"}};return d.prototype.onmessage=null,d.prototype.onconnected=null,d.prototype.onreconnecting=null,d.prototype.onreconnected=null,d.prototype.ondisconnected=null,d.prototype.onerror=null,d.prototype.send=function(a){return this._webSocket.send(a)},d.prototype.reconnect=function(b){this._webSocket.onclose=null,this._webSocket.onerror=null,this._hasAttemptedReconnect=!0;var c,d=this;if(a.isNumber(b)||(b=1),this._stopped)return this._logger.info("Client has stopped WebSocket after [%s] reconnect attempts",b-1);if(b>this._maxReconnectAttempts)return this._logger.warn("Unable to reconnect WebSocket after [%s] attempts",this._maxReconnectAttempts),e.call(this,v.backoffLimitReached);e.call(this,v.reconnecting);try{this._webSocket=f.call(d,function(){return c&&clearTimeout(c),d._hasAttemptedReconnect=!1,d._webSocket.onclose=a.bind(i,d),l.call(d)},function(){b+1>d._maxReconnectAttempts&&(c&&clearTimeout(c),h.call(d,b))})}catch(j){this._logger.warn("Unable to create WebSocket connection [%s]",j)}c=g.call(this,b)},d.prototype.disconnect=function(){return this._networkConnectionMonitor.stop(),this._stopped=!0,this._webSocket.close(v.byebye.code,v.byebye.reason)},d.prototype.toString=function(){return"ReconnectedWebSocket["+this._uri+","+this._webSocket.readyState+"]"},d}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(4),c(1)],e=function(a,b){"use strict";function c(a,b,c){if("string"!=typeof a)throw new Error('Must pass a valid "name"');if("object"!=typeof b)throw new Error('Must pass a valid "peerConnection"');if("object"!=typeof c)throw new Error('Must pass a valid "logger"');this._name=a,this._peerConnection=b,this._logger=c}function d(a,c,d,f,l){function t(){var n=null;g(c,n,function(g){function n(c,f){var g=c.ssrc,h=null;switch(b.browser){case"Firefox":if(s=r|=c.selected&&"succeeded"===c.state,"outbound"===d.direction&&("outboundrtp"===c.type||"outbound-rtp"===c.type))switch(h=new e(c.bytesSent),c.mediaType){case"video":u._logger.debug("[%s] Outbound [%s] [%s] with bitrate [%s], droppedFrames [%s] and frame rate [%s]",a,c.mediaType,c.ssrc,c.bitrateMean,c.droppedFrames,c.framerateMean),o=!0,w=c.framerateMean||0,p=!0,x=m(h,A[g]),A[g]=h;break;case"audio":u._logger.debug("[%s] Outbound [%s] [%s]",a,c.mediaType,c.ssrc),q=!0,y=m(h,z[g]),z[g]=h}if("inbound"===d.direction&&("inboundrtp"===c.type||"inbound-rtp"===c.type))switch(h=new e(c.bytesReceived),
c.mediaType){case"video":u._logger.debug("[%s] Inbound [%s] [%s] with framerate [%s] and jitter [%s]",a,c.mediaType,c.ssrc,c.framerateMean,c.jitter),p=!0,x=m(h,A[g]),A[g]=h;break;case"audio":u._logger.debug("[%s] Inbound [%s] [%s] with jitter [%s]",a,c.mediaType,c.ssrc,c.jitter),q=!0,y=m(h,z[g]),z[g]=h}break;default:if("true"===c.googWritable&&(s=!0),"true"===c.googReadable&&(r=!0),"ssrc"!==c.type)return;if("outbound"===d.direction)switch(h=new e(c.bytesSent),c.mediaType){case"video":u._logger.debug("[%s] Outbound [%s] [%s] with average encoding time [%s] ms (CPU limited=[%s]) and RTT [%s]",a,c.mediaType,c.ssrc,c.googAvgEncodeMs,c.googCpuLimitedResolution,c.googRtt),o=!0,w=c.googFrameRateSent||0,p=!0,x=m(h,A[g]),A[g]=h;break;case"audio":u._logger.debug("[%s] Outbound [%s] [%s] with audio input level [%s] and RTT [%s] and jitter [%s]",a,c.mediaType,c.ssrc,c.audioInputLevel,c.googRtt,c.googJitterReceived),q=!0,y=m(h,z[g]),z[g]=h}else if("inbound"===d.direction)switch(h=new e(c.bytesReceived),c.mediaType){case"video":u._logger.debug("[%s] Inbound [%s] [%s] with current delay [%s] ms and target delay [%s] ms",a,c.mediaType,c.ssrc,c.googCurrentDelayMs,c.googTargetDelayMs),o=!0,w=c.googFrameRateReceived||0,p=!0,x=m(h,A[g]),A[g]=h;break;case"audio":u._logger.debug("[%s] Inbound [%s] [%s] with output level [%s] and jitter [%s] and jitter buffer [%s] ms",a,c.mediaType,c.ssrc,c.audioOutputLevel,c.googJitterReceived,c.googJitterBufferMs),q=!0,y=m(h,z[g]),z[g]=h}}}var o=!1,p=!1,q=!1,r=!1,s=!1;if(g.forEach)g.forEach(n);else for(var K in g){var L=g[K];n(L,K)}var M=j(c),N=k(c);if((p&&0===x||q&&0===y||o&&0===w)&&(p=p&&N,q=q&&M,o=o&&N,r=r||!(N||M),s=s||!(N||M)),(q||p||o)&&u._logger.debug("[%s] Current bit rate is [%s] bps for audio and [%s] bps for video with [%s] FPS",a,Math.ceil(y||0),Math.ceil(x||0),w||"?"),!f())return void u._logger.info("[%s] Finished monitoring of peer connection",a);if(!J||"closed"!==c.connectionState&&"failed"!==c.connectionState&&"failed"!==c.iceConnectionState)H&&o&&w<=B?v++:I&&q&&y<=D?v++:I&&p&&x<=C?v++:r&&s?v=0:v++;else{var O=M&&N,P=h.call(u,c);if(!O&&i(c))return void u._logger.info("[%s] Finished monitoring of peer connection with [%s] inactive tracks",a,P.length);v++}v>=E?l("condition",w,x,y)?(v=Number.MIN_VALUE,setTimeout(t,F)):u._logger.error("[%s] Failure detected with frame rate [%s] FPS and bit rate [%s/%s] bps: [%s]",a,w,y,x,g):setTimeout(t,v>0?G:F)},function(a){l("error",a)})}if("string"!=typeof a)throw new Error('Must pass a valid "name"');if("object"!=typeof c)throw new Error('Must pass a valid "peerConnection"');if("object"!=typeof d)throw new Error('Must pass a valid "options"');if("function"!=typeof f)throw new Error('Must pass a valid "activeCallback"');if("function"!=typeof l)throw new Error('Must pass a valid "monitorCallback"');if("inbound"!==d.direction&&"outbound"!==d.direction)throw new Error("Invalid monitoring direction");var u=this,v=0,w=void 0,x=void 0,y=void 0,z={},A={},B=d.frameRateThreshold||p,C=d.videoBitRateThreshold||r,D=d.audioBitRateThreshold||q,E=d.conditionCountForNotificationThreshold||s,F=d.monitoringInterval||n,G=d.monitoringInterval||o,H=!d.hasOwnProperty("monitorFrameRate")||d.monitorFrameRate,I=!d.hasOwnProperty("monitorBitRate")||d.monitorBitRate,J=!d.hasOwnProperty("monitorState")||d.monitorState;setTimeout(t,F)}function e(b){this.time=a.now(),this.value=b||0}function f(a){if("Firefox"===b.browser)return a;var c={};return a.result().forEach(function(a){var b={id:a.id,type:a.type};a.names().forEach(function(c){b[c]=a.stat(c)}),c[b.id]=b}),c}function g(a,c,d,e){switch(b.browser){case"Firefox":return a.getStats(c).then(function(a){var b=f(a);d(b)})["catch"](function(a){e("error",a)});default:return a.getStats(function(a){var b=f(a);d(b)},c,function(a){e("error",a)})}}function h(b){var c=b.getLocalStreams(),d=b.getRemoteStreams(),e=[],f=[];if(a.forEach(c,function(a){e=e.concat(a.getTracks())}),a.forEach(d,function(a){f=f.concat(a.getTracks())}),0!==e.length&&0!==f.length)throw this._logger.error("Invalid State. PeerConnection contains [%s] local and [%s] remote streams.",c.length,d.length),new Error("Invalid State. PeerConnection contains both local and remote streams.");return 0!==e.length?e:0!==f.length?f:[]}function i(b){var c=l(b,function(a){return a.startsWith("video")||a.startsWith("audio")});return a.isNumber(c)}function j(b){var c=l(b,function(a,b,c){return!!a.startsWith("audio")&&(a.indexOf("a=inactive")===-1&&c[b].indexOf("a=inactive")===-1)});return a.isNumber(c)}function k(b){var c=l(b,function(a,b,c){return!!a.startsWith("video")&&(a.indexOf("a=inactive")===-1&&c[b].indexOf("a=inactive")===-1)});return a.isNumber(c)}function l(b,c){var d=b.localDescription.sdp.split("m="),e=b.remoteDescription.sdp.split("m=");return d.length===e.length&&a.findIndex(d,function(a,b){return c(a,b,e)})}function m(a,b){return b=b||new e,8*(a.value-b.value)/((a.time-b.time)/1e3)}var n=4e3,o=1500,p=2,q=5e3,r=6e3,s=3;return c.prototype.start=function(a,b,c){return d.call(this,this._name,this._peerConnection,a,b,c)},c.prototype.toString=function(){return"PeerConnectionMonitor[]"},c}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";function a(a){if(!a)throw new Error("'logger' must be specified.");this._logger=a,this._dimensionsChangedIntervalId=null,this._videoDisplayDimensionsChangedCallback=null,this._toBeStarted=!1,this._videoElement=null,this._dimensionsChangedData={pollFrequency:f,previousWidth:0,previousHeight:0},this._renderer=null}function b(a,b){b&&void 0!==b.videoWidth||this._logger.warn("Attempting to start dimensions changed monitor without providing proper 'video' element."),this._renderer=a,this._videoElement=b,this._toBeStarted=!0,e.call(this)}function c(){this._toBeStarted=!1,this._dimensionsChangedIntervalId&&(clearInterval(this._dimensionsChangedIntervalId),this._dimensionsChangedIntervalId=null)}function d(a,b){if(null===a)return this._videoDisplayDimensionsChangedCallback=null,void c.call(this);if("function"!=typeof a)throw new Error('"callback" must be a function');this._videoDisplayDimensionsChangedCallback=a,b&&b.pollFrequency&&(this._dimensionsChangedData.pollFrequency=b.pollFrequency>=g?b.pollFrequency:g),e.call(this)}function e(){if(this._toBeStarted&&!this._dimensionsChangedIntervalId&&this._videoDisplayDimensionsChangedCallback){var a=this;this._dimensionsChangedData.previousWidth=this._videoElement.videoWidth,this._dimensionsChangedData.previousHeight=this._videoElement.videoHeight,this._dimensionsChangedIntervalId=setInterval(function(){a._videoElement.videoWidth===a._dimensionsChangedData.previousWidth&&a._videoElement.videoHeight===a._dimensionsChangedData.previousHeight||(a._dimensionsChangedData.previousWidth=a._videoElement.videoWidth,a._dimensionsChangedData.previousHeight=a._videoElement.videoHeight,a._videoDisplayDimensionsChangedCallback(a._renderer,{width:a._videoElement.videoWidth,height:a._videoElement.videoHeight}))},a._dimensionsChangedData.pollFrequency)}}var f=500,g=15;return a.prototype.start=function(a,c){b.call(this,a,c)},a.prototype.stop=function(){c.call(this)},a.prototype.setVideoDisplayDimensionsChangedCallback=function(a,b){d.call(this,a,b)},a.prototype.toString=function(){return"DimensionsChangedMonitor[pollFrequency="+this._dimensionsChangedData.pollFrequency+", previousHeight="+this._dimensionsChangedData.previousHeight+", previousWidth="+this._dimensionsChangedData.previousHeight+", state="+(this._dimensionsChangedIntervalId?"running":"stopped")+"]"},a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(4),c(8),c(5),c(36)],e=function(a,b,c,d){function e(){this._metricsTransmitters={}}function f(a){var b=new d;return a?b.setUri(a):b.setEnabled(!1),b}var g={urls:{local:"",staging:"https://analytix-stg.phenixp2p.com",production:"https://analytix.phenixp2p.com"}};return e.prototype.createMetricsTransmitter=function(a){var c=b.parseEnvFromPcastBaseUri(a||""),d=g.urls[c];return this._metricsTransmitters[c]||(this._metricsTransmitters[c]=f.call(this,d)),this._metricsTransmitters[c]},new e}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(4),c(5),c(10),c(11),c(15),c(24),c(1)],e=function(a,b,c,d,e,f,g){function h(){this._loggingUrl="/analytix/metrics",this._domain=location.hostname,this._protocol=new e,this._maxAttempts=3,this._maxBufferedRecords=1e3,this._maxBatchSize=512,this._records=[],this._pending=!1,this._baseUri="",this._isEnabled=!0,this._networkConnectionMonitor=i.call(this),this._browser=(g.browser||"Browser")+"/"+(g.browserVersion||"?")}function i(){function a(){c._isOffline=!1,l.call(c)}function b(){c._isOffline=!0}var c=this,d=new f(n);return d.start(a,b),d}function j(b,c,d,e,f,g,h){var i=a.assign(h,{metric:b,timestamp:a.isoString(),sessionId:d,streamId:e,source:this._browser,fullQualifiedName:this._domain,environment:f,version:g,runtime:c});this._records.push(i)}function k(b,c,d,e,f){if(this._records.length>this._maxBufferedRecords){var g=this._records.length-this._maxBufferedRecords/2;this._records=this._records.slice(g),this._records.unshift({timestamp:a.isoString(),sessionId:c,streamId:d,source:this._browser,metric:"MetricDropped",value:{uint64:g},fullQualifiedName:this._domain,environment:e,version:f,runtime:b})}}function l(){if(!this._pending&&this._baseUri&&this._isEnabled&&!this._isOffline&&0!==this._records.length){var b={records:a.take(this._records,this._maxBatchSize)};this._records=this._records.slice(this._maxBatchSize),this._pending=!0;var c=this;try{m.call(this,this._baseUri+this._loggingUrl,b,function(){setTimeout(function(){c._isOffline&&(c._records=c._records.concat(b.records))},n)})}catch(d){throw this._pending=!1,d}}}function m(a,b,e){function f(a,b){return g._pending=!1,a?("timeout"===a.message&&e(),{status:"error",storedRecords:0}):g._protocol.decode("analytix.SubmitMetricRecordsResponse",d.fromBinary(b))}var g=this,h=this._protocol.encode("analytix.SubmitMetricRecords",b).toBinary();c.postWithRetry(a,"protobuf",h,f,this._maxAttempts)}var n=0;return h.prototype.setUri=function(a){b.stringNotEmpty(a,"uri"),this._baseUri=a},h.prototype.isEnabled=function(){return this._isEnabled},h.prototype.setEnabled=function(a){b.isBoolean(a),this._isEnabled=a},h.prototype.submitMetric=function(a,c,d,e,f,g,h){b.stringNotEmpty(a,"metric"),b.isObject(h,"value"),j.call(this,a,c,d,e,f,g,h),k.call(this,c,d,e,f,g),l.call(this)},h}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(4),c(5),c(1)],e=function(a,b,c){"use strict";function d(c,d,f){b.stringNotEmpty(c,"sessionId"),this._environment=i,this._version=j,this._sessionId=c,this._properties={},this._logger=d,this._metricsTransmitter=f,this._start=a.now(),this._disposables=[],e.call(this,"Stream initializing")}function e(){var b=Array.prototype.slice.call(arguments);if(0===b.length)throw new Error("Invalid logging arguments.");var c="[%s] [StreamAnalytix] [%s] ",d=c+b[0],e=b.slice(1),f=[d,this._streamId,a.now()-this._start].concat(e);this._logger.debug.apply(this._logger,f)}function f(){var b=a.now();return(b-h)/1e3}function g(c,d){b.stringNotEmpty(c.metric,"record.metric"),c=a.assign(this._properties,c),this._metricsTransmitter.submitMetric(c.metric,d,this._sessionId,this._streamId,this._environment,this._version,c)}var h=window.__phenixPageLoadTime||window.__pageLoadTime||a.now(),i="production",j="2017-08-07T16:16:54Z";return d.prototype.setProperty=function(a,c){b.stringNotEmpty(a,"name"),b.stringNotEmpty(c,"value"),this._properties[a]=c},d.prototype.recordMetric=function(a,c,d){b.stringNotEmpty(a,"metric"),g.call(this,{metric:a,elapsed:this.elapsed(),value:c,previousValue:d},f())},d.prototype.setStreamId=function(c){if(b.stringNotEmpty(c,"streamId"),this._streamId)throw new Error("Stream ID can only be set once.");this._streamId=c;var d=a.now();g.call(this,{metric:"Initialized",elapsed:this.elapsed()-d+this._start},f()-(d-this._start)/1e3)},d.prototype.setStartOffset=function(a){if(b.isNumber(a,"startOffset"),this._startOffset)throw new Error("Start offset can only be set once.");this._startOffset=a,this.recordMetric("Offset",{uint64:a})},d.prototype.getStartOffset=function(){return this._startOffset},d.prototype.elapsed=function(){var b=a.now();return b-this._start},d.prototype.stop=function(){a.forEach(this._disposables,function(a){a()}),this.recordMetric("Stopped"),e.call(this,"Stream stopped")},d.prototype.recordTimeToFirstFrame=function(b){var d,f=this,g=function(){d||(f.recordMetric("TimeToFirstFrame"),d=a.now(),e.call(f,"First frame"),c.removeEventListener(b,"loadeddata",g))};c.addEventListener(b,"loadeddata",g)},d.prototype.recordVideoResolutionChanges=function(a){var b=this,d={width:a.videoWidth,height:a.videoHeight},f=function(){d.width===a.videoWidth&&d.height===a.videoHeight||(b.recordMetric("ResolutionChanged",{string:a.videoWidth+"x"+a.videoHeight},{string:d.width+"x"+d.height}),d={width:a.videoWidth,height:a.videoHeight},e.call(b,"Resolution changed: width [%s] height [%s]",a.videoWidth,a.videoHeight))};c.addEventListener(a,"progress",f),this._disposables.push(function(){c.removeEventListener(a,"progress",f)})},d.prototype.recordRebuffering=function(b){var d,f,g=this,h=function(){d||(g.recordMetric("Stalled"),d=a.now(),e.call(g,"[buffering] Stream has stalled"))},i=function(c){if(d&&b.buffered.length&&("progress"!==c.type||b.buffered.end(b.buffered.length)!==f)){"progress"===c.type&&(f=b.buffered.end(b.buffered.length));var h=a.now()-d;g.recordMetric("Buffering",{uint64:h}),g.recordMetric("Playing"),e.call(g,"[buffering] Stream has recovered from stall after [%s] milliseconds",h),d=null}};c.addEventListener(b,"stalled",h),c.addEventListener(b,"paused",h),c.addEventListener(b,"suspend",h),c.addEventListener(b,"play",i),c.addEventListener(b,"playing",i),c.addEventListener(b,"progress",i),this._disposables.push(function(){c.removeEventListener(b,"stalled",h),c.removeEventListener(b,"paused",h),c.removeEventListener(b,"suspend",h),c.removeEventListener(b,"play",i),c.removeEventListener(b,"playing",i),c.removeEventListener(b,"progress",i)})},d}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(4),c(5),c(29),c(40),c(48),c(41),c(39),c(42),c(49),c(47),c(46)],e=function(a,b,c,d,e,f,g,h,i,j,k){"use strict";function l(a){b.isObject(a,"pcast"),b.isFunction(a.getLogger,"pcast.getLogger"),b.isFunction(a.getProtocol,"pcast.getProtocol"),this._pcast=a,this._logger=a.getLogger(),this._protocol=a.getProtocol(),this._self=new c(null),this._activeRoom=new c(null),this._cachedRoom=new c(null),this._roomChatService=null,b.isObject(this._logger,"this._logger"),b.isObject(this._protocol,"this._protocol"),this._authService=new e(this._pcast)}function m(a){var b=this._self.getValue().toJson(),c=this;this._self.setValue(new h(c,b.state,a,b.screenName,b.role,b.streams,b.lastUpdate))}function n(){var b=this,c=b._activeRoom.getValue();if(a.isObject(c)){var d=c.getRoomId(),e=c.getObservableAlias().getValue();b.leaveRoom(function(){b.enterRoom(d,e,function(){b._logger.info("Room Reset Completed")})})}}function o(c){b.isObject(c,"event"),b.isString(c.roomId,"event.roomId"),b.isString(c.eventType,"event.eventType"),b.isArray(c.members,"event.members"),a.forEach(c.members,function(a){b.isObject(a,"member")});var d=this;switch(c.eventType){case j.events.memberJoined.name:return d._logger.debug("[%s] Member joined [%s]",c.roomId,c.members),p.call(d,c.roomId,c.members);case j.events.memberLeft.name:return d._logger.debug("[%s] Member left [%s]",c.roomId,c.members),q.call(d,c.roomId,c.members);case j.events.memberUpdated.name:return d._logger.debug("[%s] Member updated [%s]",c.roomId,c.members),r.call(d,c.roomId,c.members);case j.events.roomUpdated.name:return d._logger.debug("[%s] Room updated [%s]",c.roomId,c.room),s.call(d,c.roomId,c.room);case j.events.roomEnded.name:d._logger.info("[%s] Room ended",c.roomId);break;default:d._logger.warn("Unsupported room event [%s]",c.eventType)}}function p(b,c){var d=this._activeRoom.getValue(),e=this._cachedRoom.getValue();if(d&&d.getRoomId()===b){d._removeMembers(c),d._addMembers(c),e._removeMembers(c),e._addMembers(c);var f=this,g=function(a){return a.sessionId===f.getSelf().getSessionId()},h=a.find(c,g);h&&(L.call(f,d),d._updateMembers([h])),this._logger.info("[%s] Room has now [%d] members",b,d.getObservableMembers().getValue().length)}}function q(a,b){var c=this._activeRoom.getValue(),d=this._cachedRoom.getValue();c&&c.getRoomId()===a&&(c._removeMembers(b),d._removeMembers(b),this._logger.info("[%s] Room has now [%d] members",a,c.getObservableMembers().getValue().length))}function r(a,b){var c=this._activeRoom.getValue(),d=this._cachedRoom.getValue();c&&c.getRoomId()===a&&(c._updateMembers(b),d._updateMembers(b),this._logger.info("[%s] Room has [%d] updated members",a,b.length))}function s(a,b){var c=this._activeRoom.getValue(),d=this._cachedRoom.getValue();c&&c.getRoomId()===a&&(d._update(b),c._update(b))}function t(a){this.getSelf()&&this.getSelf().getSessionId()===a||m.call(this,a)}function u(a,b){var c=b.getValue(),d=c.getObservableMembers().getValue();return v(a,d)}function v(b,c){return a.find(c,function(a){return b===a.getSessionId()})}function w(b){this._logger.info("PCast status changed to [%s]",b),"offline"!==b.toLowerCase()&&"offline"===this._lastPcastStatus||"offline"===b.toLowerCase()&&"offline"!==this._lastPcastStatus&&!a.isNullOrUndefined(this._lastPcastStatus),this._lastPcastStatus=b}function x(){var b=this._self.subscribe(a.bind(n,this)),c=this._authService.getObservableStatus().subscribe(a.bind(w,this)),d=this._authService.getObservableSessionId().subscribe(a.bind(t,this));this._disposables.push(b.dispose),this._disposables.push(c.dispose),this._disposables.push(d.dispose)}function y(b){if(a.isArray(b))for(var c=0;c<b.length;c++)"function"==typeof b[c]&&b[c]()}function z(b,c){var d=A(b,c);return d.sessionId=b.getSessionId(),d.lastUpdate=c?c.getLastUpdate():a.now(),d}function A(b,c){if(null===c)return b.toJson();var d={},e=b.toJson(),f=c.toJson(),g=a.findDifferences(e,f,!0);return a.forEach(g,function(a){d[a]=e[a]}),d}function B(b,c,d){this._authService.assertAuthorized();var e=this;this._protocol.getRoomInfo(b,c,function(b,c){if(b)return e._logger.error("Request to get room info failed with error [%s]",b),d(b,null);var f={status:c.status};return"ok"!==c.status?(e._logger.warn("Request to get room info failed with status [%s]",c.status),d(null,f)):(f.room=a.freeze(I.call(this,c)),void d(null,f))})}function C(b,c){this._authService.assertAuthorized();var d=this,e=D(b);this._protocol.createRoom(e,function(b,e){if(b)return d._logger.error("Creating room failed with error [%s]",b),c(b,null);var f={status:e.status};return"ok"!==e.status&&"already-exists"!==e.status?(d._logger.warn("Creating room failed with status [%s]",e.status),c(null,f)):(f.room=a.freeze(I.call(this,e)),void c(null,f))})}function D(a){var b=this;return new f(b,"",a.alias,a.name,a.description,a.type,[],a.bridgeId,a.pin).toJson()}function E(b,c,d){this._authService.assertAuthorized();var e=this._self.getValue(),f=e.getObservableScreenName().getValue(),g=e.getObservableRole().getValue(),h=z.call(this,e,null),i=a.now();this._logger.info("Enter room [%s]/[%s] with screen name [%s] and role [%s]",b,c,f,g);var j=this;this._protocol.enterRoom(b,c,h,i,function(a,b){if(a)return j._logger.error("Joining of room failed with error [%s]",a),d(a,null);var c={status:b.status};return"ok"!==b.status?(j._logger.warn("Joining of room failed with status [%s]",b.status),d(null,c)):(c.room=K.call(j,b),void d(null,c))})}function F(b){if(!this._activeRoom.getValue())return this._logger.warn("Unable to leave room. Not currently in a room.");this._authService.assertAuthorized();var c=this._activeRoom.getValue().getRoomId(),d=a.now();this._logger.info("Leave room [%s]",c);var e=this;this._protocol.leaveRoom(c,d,function(a,c){if(a)return e._logger.error("Leaving room failed with error [%s]",a),b(a,null);var d={status:c.status};return"ok"!==c.status?(e._logger.warn("Leaving room failed with status [%s]",c.status),b(null,d)):(e._roomChatService&&e._roomChatService.stop(),e._roomChatService=null,e._activeRoom.setValue(null),e._cachedRoom.setValue(null),void b(null,d))})}function G(b,c){if(!this._activeRoom.getValue())return this._logger.warn("Not in a room. Please Enter a room before updating member."),c("not-in-room");this._authService.assertAuthorized();var d=u(b.getSessionId(),this._cachedRoom),e=z.call(this,b,d),f=a.now();this._logger.info("Updating member info for active room");var g=this;this._protocol.updateMember(e,f,function(a,b){if(a)return g._logger.error("Update of member failed with error [%s]",a),c(a,null);var d={status:b.status};"ok"!==b.status&&g._logger.warn("Update of member failed with status [%s]",b.status),c(null,d)})}function H(b){if(!this._activeRoom.getValue())return this._logger.warn("Not in a room. Please Enter a room before updating member."),b("not-in-room");this._authService.assertAuthorized();var c=this._activeRoom.getValue(),d=a.now(),e=this;this._protocol.updateRoom(c.toJson(),d,function(a,c){if(a)return e._logger.error("Update of room failed with error [%s]",a),b(a,null);var d={status:c.status};"ok"!==c.status&&e._logger.warn("Update of room failed with status [%s]",c.status),b(null,d)})}function I(a){var b=a.room,c=a.members||[],d=this;return new g(d,b.roomId,b.alias,b.name,b.description,b.type,c,b.bridgeId,b.pin)}function J(a){var b=a.room,c=a.members,d=this;return new f(d,b.roomId,b.alias,b.name,b.description,b.type,c,b.bridgeId,b.pin)}function K(a){var b=J.call(this,a),c=J.call(this,a);return L.call(this,b),this._activeRoom.setValue(b),this._cachedRoom.setValue(c),b}function L(b){var c=this._self.getValue(),d=b.getObservableMembers().getValue(),e=a.findIndex(d,function(a){return c.getSessionId()===a.getSessionId()});return a.isNumber(e)?(c._update(d[e].toJson()),d[e]=c,void b.getObservableMembers().setValue(d)):this._logger.info("Self not in server room model.")}return l.prototype.start=function(d,e){b.stringNotEmpty(d,"role"),b.stringNotEmpty(e,"screenName");var f=k.states.passive.name,g=this._authService.getPCastSessionId(),i=e,j=[],l=a.now(),m=this,n=new h(m,f,g,i,d,j,l);this._self=new c(n),this._disposables=[];var p=this._protocol.on("roomEvent",a.bind(o,this));return this._disposables.push(p),x.call(this),n},l.prototype.getRoomInfo=function(a,c,d){a?b.stringNotEmpty("roomId",a):b.stringNotEmpty("alias",c),b.isFunction(d),B.call(this,a,c,d)},l.prototype.createRoom=function(a,c){b.isObject(a,"room"),b.stringNotEmpty(a.name,"room.name"),b.stringNotEmpty(a.type,"room.type"),b.isString(a.description,"room.description"),b.isFunction(c),C.call(this,a,c)},l.prototype.enterRoom=function(a,c,d){a?b.stringNotEmpty("roomId",a):b.stringNotEmpty("alias",c),b.isFunction(d),E.call(this,a,c,d)},l.prototype.leaveRoom=function(a){var b=this;return F.call(b,a)},l.prototype.getRoomChatService=function(){return!this._roomChatService&&this._activeRoom.getValue()&&(this._roomChatService=new i(this)),this._roomChatService},l.prototype.getSelf=function(){return this._self.getValue()},l.prototype.getObservableActiveRoom=function(){return this._activeRoom},l.prototype.updateSelf=function(a){b.isFunction(a),G.call(this,this.getSelf(),a)},l.prototype.updateMember=function(a,c){b.isFunction(c),b.isObject(a),G.call(this,a,c)},l.prototype.updateRoom=function(a){b.isFunction(a),H.call(this,a)},l.prototype.revertRoomChanges=function(){var a=this._activeRoom.getValue(),b=this._cachedRoom.getValue();return a&&b?void a._update(b.toJson()):this._logger.warn("Unable to revert changes to room. Not currently in a room.")},l.prototype.revertMemberChanges=function(a){b.isObject(a);var c=u(a.getSessionId(),this._cachedRoom),d=u(a.getSessionId(),this._activeRoom);return c&&d?void d._update(c.toJson()):this._logger.warn("Unable to revert changes to member. Member is currently not in room.")},l.prototype.toString=function(){return"RoomService"},l.prototype.stop=function(){y(this._disposables)},l}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(4),c(5),c(29),c(40),c(41)],e=function(a,b,c,d,e){"use strict";function f(a,b,c,d,e,f,g,h,i){this.init(a,b,c,d,e,f,g,h,i)}function g(){throw new Error("ImmutableRoom is Immutable")}function h(b){a.isArray(b)?a.forEach(b,function(a){i(a)}):a.isObject(b)&&a.forOwn(b,function(a){i(a)})}function i(a){j(a),h(a)}function j(a){if(a instanceof c||a instanceof d){a.setValue=g,a.subscribe=g;var b=a.getValue();h(b)}}return f.prototype.init=function(a,b,c,d,f,g,i,j,k){this._room=new e(null,b,c,d,f,g,i,j,k),h(this._room)},f.prototype.getRoomId=function(){return this._room.getRoomId()},f.prototype.getObservableAlias=function(){return this._room.getObservableAlias()},f.prototype.getObservableName=function(){return this._room.getObservableName()},f.prototype.getObservableDescription=function(){return this._room.getObservableDescription()},f.prototype.getObservableType=function(){return this._room.getObservableType()},f.prototype.getObservableMembers=function(){return this._room.getObservableMembers()},f.prototype.getObservableBridgeId=function(){return this._room.getObservableBridgeId()},f.prototype.getObservablePin=function(){return this._room.getObservablePin()},f.prototype.toString=function(){return this._room.toString()},f.prototype.toJson=function(){return this._room.toJson()},f.prototype.commitChanges=g,f.prototype.reload=g,f.prototype._update=g,f.prototype._addMembers=g,f.prototype._removeMembers=g,f.prototype._updateMembers=g,f}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(4),c(5),c(29)],e=function(a,b,c){"use strict";function d(a,d){var e=a;void 0!==e&&null!==e||(e=[]),b.isArray(e),this.observableArray=new c(e,d)}return d.prototype.getValue=function(){return this.observableArray.getValue()},d.prototype.setValue=function(a){return void 0!==a&&null!==a||(a=[]),void 0!==a&&b.isArray(a),this.observableArray.setValue(a)},d.prototype.subscribe=function(a,b){return this.observableArray.subscribe(a,b)},d.prototype.push=function(a){var b=this.observableArray.getValue();b.push(a),this.observableArray.setValue(b)},d.prototype.pop=function(){var a=this.observableArray.getValue(),b=a.pop();return this.observableArray.setValue(a),b},d.prototype.remove=function(b){var c=this.observableArray.getValue(),d=function(c){return a.isFunction(b)?b(c):c===b},e=a.filter(c,d);return e.length>0&&this.observableArray.setValue(a.remove(c,d)),e},d.prototype.removeAll=function(){var a=this.observableArray.getValue();return this.observableArray.setValue([]),a},d.prototype.extend=function(a){return this.observableArray.extend(a),this},d}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(4),c(5),c(29),c(40),c(42),c(47)],e=function(a,b,c,d,e,f){"use strict";function g(a,b,c,d,e,f,g,h,i){this.init(a,b,c,d,e,f,g,h,i)}function h(a){var b=i(a,this._roomService);this._members.setValue(b)}function i(b,c){return a.map(b,function(a){return new e(c,a.state,a.sessionId,a.screenName,a.role,a.streams,a.lastUpdate)})}function j(b){if(b=a.getEnumName(k,b),!b)throw new Error('"type" must be a valid room type');return b}var k=f.types;return g.prototype.init=function(a,e,f,g,i,k,l,m,n){b.stringNotEmpty(g,"name"),b.stringNotEmpty(i,"description"),b.isArray(l,"members"),e&&b.stringNotEmpty(e,"id"),f&&b.stringNotEmpty(f,"alias"),m&&b.stringNotEmpty(m,"bridgeId"),n&&b.stringNotEmpty(n,"pin"),a&&b.isObject(a,"roomService"),this._roomId=new c(e),this._alias=new c(f),this._name=new c(g),this._description=new c(i),this._type=new c(k,j),this._members=new d([]).extend({method:"notifyWhenChangesStop",timeout:400}),this._options=new d,this._bridgeId=new c(m),this._pin=new c(n),this._roomService=a,h.call(this,l)},g.prototype.getRoomId=function(){return this._roomId.getValue()},g.prototype.getObservableAlias=function(){return this._alias},g.prototype.getObservableName=function(){return this._name},g.prototype.getObservableDescription=function(){return this._description},g.prototype.getObservableType=function(){return this._type},g.prototype.getObservableMembers=function(){return this._members},g.prototype.getObservableBridgeId=function(){return this._bridgeId},g.prototype.getObservablePin=function(){return this._pin},g.prototype.toString=function(){return this._type.getValue()+"["+this._roomId.getValue()+"]"},g.prototype.toJson=function(){return{roomId:this._roomId.getValue(),alias:this._alias.getValue(),name:this._name.getValue(),description:this._description.getValue(),type:this._type.getValue(),pin:this._pin.getValue(),bridgeId:this._bridgeId.getValue()}},g.prototype.commitChanges=function(a){b.isObject(this._roomService),this._roomService.updateRoom(this,a)},g.prototype.reload=function(){b.isObject(this._roomService),this._roomService.revertRoomChanges(this)},g.prototype._update=function(b){a.isObject(b)&&(b.roomId&&this._roomId.setValue(b.roomId),b.alias&&this._alias.setValue(b.alias),b.name&&this._name.setValue(b.name),b.description&&this._description.setValue(b.description),b.type&&this._type.setValue(b.type),b.options&&this._options.setValue(b.options),b.bridgeId&&this._bridgeId.setValue(b.bridgeId),b.pin&&this._pin.setValue(b.pin),b.members)},g.prototype._addMembers=function(b){var c=this,d=i(b);a.forEach(d,function(a){c._members.push(a)})},g.prototype._removeMembers=function(b){var c=this;a.forEach(b,function(a){c._members.remove(function(b){return a.sessionId===b.getSessionId()&&a.lastUpdate>=b.getObservableLastUpdate().getValue()})})},g.prototype._updateMembers=function(b){a.forEach(this._members.getValue(),function(c){var d=a.find(b,function(a){return c.getSessionId()===a.sessionId&&a.lastUpdate>c.getObservableLastUpdate().getValue()});d&&c._update(d)})},g}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(4),c(5),c(29),c(40),c(43),c(46)],e=function(a,b,c,d,e,f){"use strict";function g(a,b,c,d,e,f,g){this.init(a,b,c,d,e,f,g)}function h(a){return new e(a.uri,a.type,a.audioState,a.videoState)}function i(b){var c=this._streams.getValue(),d=[];a.forEach(b,function(b){var e=a.find(c,function(a){return a.getUri()===b.uri&&a.getType()===b.type});e?e._update(b):e=h(b),d.push(e)}),this._streams.setValue(d)}function j(b){if(b=a.getEnumName(l,b),!b)throw new Error('"role" must be a valid member role');return b}function k(b){if(b=a.getEnumName(m,b),!b)throw new Error('"state" must be a valid member state');return b}var l=f.roles,m=f.states;return g.prototype.init=function(e,f,g,h,i,l,m){b.isString(g,"sessionId"),b.isString(h,"screenName"),b.isArray(l,"streams"),b.isNumber(a.utc(m),"lastUpdate"),e&&b.isObject(e),this._sessionId=new c(g),this._screenName=new c(h),this._streams=new d([]),this._state=new c(f,k).extend({rateLimit:500}),this._role=new c(i,j),this._lastUpdate=new c(m,a.utc),this._roomService=e,this.setStreams(l)},g.prototype.getObservableState=function(){return this._state},g.prototype.getSessionId=function(){return this._sessionId.getValue()},g.prototype.getObservableScreenName=function(){return this._screenName},g.prototype.getObservableRole=function(){return this._role},g.prototype.getObservableStreams=function(){return this._streams},g.prototype.getObservableLastUpdate=function(){return this._lastUpdate},g.prototype.getLastUpdate=function(){return this._lastUpdate.getValue()},g.prototype.getStreams=function(){return a.map(this._streams.getValue(),function(a){return a.toJson()})},g.prototype.commitChanges=function(a){b.isObject(this._roomService),this._roomService.updateMember(this,a)},g.prototype.reload=function(){b.isObject(this._roomService),this._roomService.revertMemberChanges(this)},g.prototype.setStreams=function(b){var c=a.map(b,function(a){return h(a)});this._streams.setValue(c)},g.prototype.toString=function(){return this.getObservableRole().getValue()+"["+this.getObservableScreenName().getValue()+","+this.getSessionId()+"]"},g.prototype.toJson=function(){var b={sessionId:this._sessionId.getValue(),screenName:this._screenName.getValue(),role:this._role.getValue(),
state:this._state.getValue(),streams:[],lastUpdate:this._lastUpdate.getValue()};return a.forEach(this._streams.getValue(),function(a){b.streams.push(a.toJson())}),b},g.prototype._update=function(b){a.isObject(b)&&(b.hasOwnProperty("state")&&this._state.setValue(b.state),b.hasOwnProperty("screenName")&&this._screenName.setValue(b.screenName),b.hasOwnProperty("role")&&this._role.setValue(b.role),b.hasOwnProperty("lastUpdate")&&this._lastUpdate.setValue(b.lastUpdate),b.hasOwnProperty("streams")&&i.call(this,b.streams))},g}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(4),c(5),c(29),c(40),c(44),c(45)],e=function(a,b,c,d,e,f){"use strict";function g(a,b,c,d){this.init(a,b,c,d)}function h(b){if(b=a.getEnumName(j,b),!b)throw new Error('"type" must be a valid stream type');return b}function i(b){if(b=a.getEnumName(k,b),!b)throw new Error('"state" must be a valid track state');return b}var j=e.types,k=f.states;return g.prototype.init=function(a,d,e,f){b.isString(a,"uri"),this._uri=new c(a),this._type=new c(d,h),this._audioState=new c(e||k.trackEnabled.name,i),this._videoState=new c(f||k.trackEnabled.name,i)},g.prototype.getUri=function(){return this._uri.getValue()},g.prototype.getType=function(){return this._type.getValue()},g.prototype.getObservableAudioState=function(){return this._audioState},g.prototype.getObservableVideoState=function(){return this._videoState},g.prototype.toJson=function(){return{uri:this._uri.getValue(),type:this._type.getValue(),audioState:this._audioState.getValue(),videoState:this._videoState.getValue()}},g.prototype._update=function(b){a.isObject(b)&&(b.hasOwnProperty("audioState")&&this._audioState.setValue(b.audioState),b.hasOwnProperty("videoState")&&this._videoState.setValue(b.videoState))},g}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";var a={types:{user:{id:0,name:"User"},presentation:{id:1,name:"Presentation"},audio:{id:2,name:"Audio"}}};return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";var a={states:{trackEnabled:{id:0,name:"TrackEnabled"},trackDisabled:{id:1,name:"TrackDisabled"},trackEnded:{id:2,name:"TrackEnded"}}};return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";var a={roles:{participant:{id:0,name:"Participant"},moderator:{id:1,name:"Moderator"},presenter:{id:2,name:"Presenter"},audience:{id:3,name:"Audience"}},states:{active:{id:0,name:"Active"},passive:{id:1,name:"Passive"},handRaised:{id:2,name:"HandRaised"},inactive:{id:3,name:"Inactive"},offline:{id:4,name:"Offline"}}};return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";var a={types:{directChat:{id:0,name:"DirectChat"},multiPartyChat:{id:1,name:"MultiPartyChat"},moderatedChat:{id:2,name:"ModeratedChat"},townHall:{id:3,name:"TownHall"},channel:{id:4,name:"Channel"}},events:{memberJoined:{id:0,name:"MemberJoined"},memberLeft:{id:1,name:"MemberLeft"},memberUpdated:{id:2,name:"MemberUpdated"},roomUpdated:{id:3,name:"RoomUpdated"},roomEnded:{id:4,name:"RoomEnded"}}};return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(4),c(5)],e=function(a,b){"use strict";function c(a){b.isObject(a,"pcast"),b.isFunction(a.getObservableStatus,"pcast.getObservableStatus"),b.isFunction(a.getLogger,"pcast.getLogger"),b.isFunction(a.getProtocol,"pcast.getProtocol"),this._pcast!==a&&(this._pcast=a,this._logger=a.getLogger(),this._protocol=a.getProtocol(),b.isObject(this._logger,"this._logger"),b.isObject(this._protocol,"this._protocol"),b.isFunction(this._protocol.getObservableSessionId,"this._protocol.getObservableSessionId"),b.isFunction(this._pcast.getObservableStatus,"this._pcast.getObservableStatus"),this._sessionId=this._protocol.getObservableSessionId(),this._status=this._pcast.getObservableStatus())}function d(a){return null!==a&&void 0!==a&&""!==a}function e(a){return null!==a&&void 0!==a&&""!==a&&"offline"!==a.toLowerCase()}return c.prototype.assertAuthorized=function(){if(!e(this.getPCastStatus()))throw new Error("Unable to perform action. Status [%s]. Please wait to reconnect.",this.getPCastStatus());if(!d(this.getPCastSessionId()))throw new Error("Unable to perform action. Invalid sessionId [%s]",this.getPCastSessionId())},c.prototype.getObservableSessionId=function(){return this._sessionId},c.prototype.getObservableStatus=function(){return this._status},c.prototype.getPCastSessionId=function(){return this._sessionId.getValue()},c.prototype.getPCastStatus=function(){return this._status.getValue()},c}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(4),c(5),c(40),c(50)],e=function(a,b,c,d){"use strict";function e(a){b.isObject(a,"roomService"),b.isObject(a._pcast,"roomService._pcast"),b.isObject(a._logger,"roomService._logger"),this._roomService=a,this._pcast=a._pcast,this._logger=a._logger,this._chatService=new d(this._pcast),this._chatMessages=new c([]),this._latestMessageQueue=[],this._disposables=[],this._chatRoomId=null}function f(a){a&&this._chatRoomId===a.getRoomId()||(i.call(this),a&&h.call(this))}function g(){var b=this._roomService.getObservableActiveRoom().subscribe(a.bind(f,this));this._disposables.push(b.dispose)}function h(){i.call(this),this._roomChatSubscriptionDispose=j.call(this,this._batchSize)}function i(){this._roomChatSubscriptionDispose&&this._roomChatSubscriptionDispose()}function j(b){var c=this._roomService.getObservableActiveRoom().getValue(),d=c.getRoomId();this._chatRoomId=d;var e=this;return this._chatMessages.setValue([]),this._chatService.subscribeAndLoadMessages(d,b,function(b,c){if(b)throw b;if("ok"!==c.status)throw new Error("Unable to subscribe to room chat. Status "+status);var d=e._chatMessages.getValue();a.forEach(c.chatMessages,function(a){d.push(a)}),d.length>m&&d.splice(0,d.length-m),e._chatMessages.setValue(d)})}function k(b){if(a.isArray(b))for(var c=0;c<b.length;c++)"function"==typeof b[c]&&b[c]()}var l=0,m=100;return e.prototype.start=function(a){this._batchSize=a||l,this._chatService.start(),g.call(this),h.call(this)},e.prototype.stop=function(){this._chatService.stop(),i.call(this),k(this._disposables)},e.prototype.getObservableChatMessages=function(){return this._chatMessages},e.prototype.getObservableChatEnabled=function(){return this._chatService.getObservableChatEnabled()},e.prototype.sendMessageToRoom=function(a,b){var c=this._roomService.getObservableActiveRoom().getValue(),d=c.getRoomId(),e=this._roomService._self.getValue(),f=e.getObservableScreenName().getValue(),g=e.getObservableRole().getValue(),h=e.getLastUpdate();this._chatService.sendMessageToRoom(d,f,g,h,a,b)},e.prototype.getMessages=function(a,b,c,d){var e=this._roomService.getObservableActiveRoom().getValue(),f=e.getRoomId();return this._chatService.getMessages(f,a,b,c,d)},e.prototype.toString=function(){return"RoomChatService"},e}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(4),c(5),c(29),c(48)],e=function(a,b,c,d){"use strict";function e(a){b.isObject(a,"pcast"),b.isFunction(a.getLogger,"pcast.getLogger"),b.isFunction(a.getProtocol,"pcast.getProtocol"),this._pcast=a,this._logger=a.getLogger(),this._protocol=a.getProtocol(),this._enabled=new c((!1)),this._lastSubscribedSessionId=null,b.isObject(this._logger,"this._logger"),b.isObject(this._protocol,"this._protocol"),this._authService=new d(this._pcast)}function f(){var b=this._authService.getObservableStatus().subscribe(a.bind(i,this)),c=this._authService.getObservableSessionId().subscribe(a.bind(j,this));this._disposables.push(b.dispose),this._disposables.push(c.dispose)}function g(a,b){var c=this;this._roomMessagesListeners[a]=b;var d=function(){c._roomMessagesListeners[a]===b&&delete c._roomMessagesListeners[a]};return this._disposables.push(d),d}function h(a){switch(b.isObject(a,"event"),b.stringNotEmpty(a.roomId,"event.roomId"),b.stringNotEmpty(a.eventType,"event.eventType"),b.isArray(a.chatMessages,"event.chatMessages"),a.eventType){case"Message":this._logger.debug("[%s] Room messages [%s]",a.roomId,a.chatMessages);var c=this._roomMessagesListeners[a.roomId];p(a.chatMessages),c&&c(null,{status:"ok",chatMessages:a.chatMessages});break;default:this._logger.warn("Unsupported room conversation event [%s]",a.eventType)}}function i(a){}function j(a){this._lastSubscribedSessionId&&this._lastSubscribedSessionId!==a&&k.call(this)}function k(){var b=this;a.forOwn(this._roomMessagesListeners,function(a,c){m.call(b,c,1)})}function l(a,c,d,e,f){b.stringNotEmpty(a,"roomId"),b.isFunction(f,"callback"),e&&d||b.isNumber(c,"batchSize"),e&&b.stringNotEmpty(e,"beforeMessageId"),d&&b.stringNotEmpty(d,"afterMessageId"),o.call(this),this._authService.assertAuthorized();var g=this._authService.getPCastSessionId();this._logger.info("Get messages from room [%s] conversation with batch size of [%s], after [%s], and before [%s]",a,c,d,e);var h=this;this._protocol.getMessages(g,a,c,d,e,function(a,b){if(a)return h._logger.error("Get messages from room conversation failed with error [%s]",a),f(a,null);var c={status:b.status};return"ok"!==b.status?(h._logger.warn("Get messages from room conversation failed with status [%s]",b.status),f(null,c)):(c.chatMessages=b.chatMessages,p(c.chatMessages),void f(null,c))})}function m(a,c){b.stringNotEmpty(a,"roomId"),b.isNumber(c,"batchSize"),o.call(this),this._authService.assertAuthorized();var d=this._authService.getPCastSessionId();this._lastSubscribedSessionId=d,this._logger.info("Subscribe to room [%s] conversation with batch size of [%s]",a,c);var e=this;this._protocol.subscribeToRoomConversation(d,a,c,function(b,c){var d=e._roomMessagesListeners[a];if(!d)return e._logger.warn("No subscription callback set for room [%s]",a);if(b)return e._logger.error("Subscribe to room conversation failed with error [%s]",b),d(b,null);var f={status:c.status};return"ok"!==c.status?(delete e._roomMessagesListeners[a],e._logger.warn("Subscribe to room conversation failed with status [%s]",c.status),d(null,f)):(f.chatMessages=c.chatMessages,p(f.chatMessages),void d(null,f))})}function n(a,c,d,e,f,g){b.stringNotEmpty(a,"roomId"),b.stringNotEmpty(c,"screenName"),b.stringNotEmpty(d,"role"),b.isNumber(e,"lastUpdate"),b.stringNotEmpty(f,"message"),b.isFunction(g,"callback"),o.call(this),this._authService.assertAuthorized();var h=this._authService.getPCastSessionId(),i={messageId:"",timestamp:0,from:{sessionId:h,screenName:c,role:d,lastUpdate:e},message:f};this._logger.info("Send message to room [%s] from [%s]",a,c);var j=this;return this._protocol.sendMessageToRoom(a,i,function(a,b){if(a)return j._logger.error("Send message to room failed with error [%s]",a),g(a,null);var c={status:b.status};"ok"!==b.status&&j._logger.warn("Send message to room failed with status [%s]",b.status),g(null,c)})}function o(){if(!this._enabled.getValue())throw new Error("ChatService not Enabled. Please start before performing actions.")}function p(b){a.forEach(b,function(a){q(a)})}function q(b){b.timestamp&&(b.timestamp=a.utc(b.timestamp)),b.from&&(b.from.lastUpdate=a.utc(b.from.lastUpdate))}function r(b){if(a.isArray(b))for(var c=0;c<b.length;c++)"function"==typeof b[c]&&b[c]()}return e.prototype.start=function(){if(!this._enabled.getValue()){this._disposables=[],this._roomMessagesListeners={},this._enabled.setValue(!0),f.call(this);var b=this._protocol.on("roomChatEvent",a.bind(h,this));this._disposables.push(b)}},e.prototype.stop=function(){this._enabled.getValue()&&r(this._disposables)},e.prototype.getObservableChatEnabled=function(){return this._enabled},e.prototype.sendMessageToRoom=function(a,b,c,d,e,f){n.call(this,a,b,c,d,e,f)},e.prototype.subscribeAndLoadMessages=function(a,b,c){var d=g.call(this,a,c);return m.call(this,a,b),d},e.prototype.getMessages=function(a,b,c,d,e){l.call(this,a,b,c,d,e)},e.prototype.toString=function(){return"ChatService"},e}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(4),c(5),c(30),c(27),c(52),c(53),c(55)],e=function(a,b,c,d,e,f,g){"use strict";function h(g,h){b.isArray(g,"userMediaStreams"),h=h||{},this._baseUri=h.uri||d.DefaultPCastUri,this._logger=h.logger||c.createPCastLogger(this._baseUri),this._audioContext=h.audioContext||new e,this._nativeAudioContext=this._audioContext.getNativeAudioContext(),this._onSpeakingChanged=null,this._userMediaStreams=g,this._disposeOfAudioContext=!a.isObject(h.audioContext),this._audioVolumeMeterFactory=new f(this._logger),a.forEach(this._userMediaStreams,a.bind(i,this,h))}function i(a,c){b.isObject(c,"stream"),b.isObject(a,"options");var d=this._audioVolumeMeterFactory.getAudioVolumeMeter(c);d.init(this._nativeAudioContext,a.alpha),d.connect(c)}function j(a,c){b.isObject(c,"stream"),b.isObject(a,"options");var d=this._audioVolumeMeterFactory.getAudioVolumeMeter(c),e=new g(this._logger);a.alpha&&d.setAlpha(a.alpha),e.onValue(this._onSpeakingChanged),e.startDetection(d,a)}return h.prototype.start=function(c,d){b.isFunction(d,"callback"),this._onSpeakingChanged=d,c=c||{},a.forEach(this._userMediaStreams,a.bind(j,this,c))},h.prototype.stop=function(){a.forEach(this.getAudioVolumeMeters(),function(a){a.onValue(function(){})}),this._onSpeakingChanged=null},h.prototype.getAudioVolumeMeter=function(a){return b.isObject(a,"stream"),this._audioVolumeMeterFactory.getAudioVolumeMeter(a)},h.prototype.getAudioVolumeMeters=function(){return this._audioVolumeMeterFactory.getAudioVolumeMeters()},h.prototype.dispose=function(){this._disposeOfAudioContext&&this._nativeAudioContext.close(),this._audioVolumeMeterFactory.stopAllMeters(),this._userMediaStreams=null},h.prototype.toString=function(){return"AudioSpeakerDetector"},h}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";function a(){this.init()}return a.prototype.init=function(){if(!window.AudioContext)throw new Error("Browser does not support AudioContext");this._audioContext=new window.AudioContext},a.prototype.getNativeAudioContext=function(){return this._audioContext},a.prototype.toString=function(){return"AudioContext"},a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(4),c(5),c(54)],e=function(a,b,c){"use strict";function d(a){b.isObject(a,"logger"),this._logger=a,this._audioVolumeMeters={}}return d.prototype.stopAllMeters=function(){a.forOwn(this._audioVolumeMeters,function(a){a.stop()})},d.prototype.getAudioVolumeMeter=function(a){return b.isObject(a,"stream"),b.stringNotEmpty(a.id,"streamId"),this._audioVolumeMeters[a.id]||(this._audioVolumeMeters[a.id]=new c(this._logger)),this._audioVolumeMeters[a.id]},d.prototype.getAudioVolumeMeters=function(){return a.values(this._audioVolumeMeters)},d.prototype.toString=function(){return"AudioVolumeMeterFactory"},d}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(4),c(5)],e=function(a,b){"use strict";function c(a){b.isObject(a),this._logger=a}function d(b){for(var c=b.inputBuffer.getChannelData(0),d=0,e=0,f=0;f<c.length;f++)d+=c[f]*c[f],Math.abs(c[f])>.99&&e++;this._value=Math.sqrt(d/c.length),this._smoothedValue=this._alpha*this._value+(1-this._alpha)*this._smoothedValue,this._smoothedPeakValue=Math.max(this._value,this._alpha*this._value+(1-this._alpha)*this._smoothedPeakValue),this._clipped=e,this._callback&&this._callback.call(this,{date:a.now(),value:this._value,smoothedValue:this._smoothedValue,smoothedPeakValue:this._smoothedPeakValue,clipped:this._clipped})}function e(a){b.isObject(a,"stream");var c=this;a.getAudioTracks().length>0?(c._mediaStreamSource=c._context.createMediaStreamSource(a),c._mediaStreamSource.connect(c._scriptProcessor),c._scriptProcessor.connect(c._context.destination)):c._logger.info("Stream has no audio tracks")}function f(){this._mediaStreamSource&&this._mediaStreamSource.disconnect(),this._scriptProcessor.disconnect()}var g=1/16;return c.prototype.init=function(c,e){b.isObject(c,"context"),b.isFunction(c.createScriptProcessor,"context.createScriptProcessor"),e=parseFloat(e||g),b.isNumber(e,"alpha"),this._context=c,this._alpha=e,this._value=0,this._smoothedValue=0,this._smoothedPeakValue=0,this._clipped=0,this._scriptProcessor=c.createScriptProcessor(4096,1,1),this._scriptProcessor.addEventListener("audioprocess",a.bind(d,this))},c.prototype.onValue=function(a){this._callback=a},c.prototype.getValue=function(){return this._value},c.prototype.getSmoothedValue=function(){return this._smoothedValue},c.prototype.getSmoothedPeakValue=function(){return this._smoothedPeakValue},c.prototype.setAlpha=function(a){b.isNumber(a),this._alpha=parseFloat(a)},c.prototype.connect=function(a){var b=this;return e.call(b,a)},c.prototype.stop=function(){return f.call(this)},c.prototype.toString=function(){return"AudioVolumeMeter"},c}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(4),c(5)],e=function(a,b){"use strict";function c(a){b.isObject(a),this._logger=a,this.init()}function d(c,d){b.isObject(c,"audioVolumeMeter"),d=d||{};var g=this,h=!1,i=d.speakingHysteresisInterval||e,j=d.silenceHysteresisInterval||f;b.isNumber(i,"options.speakingHysteresisInterval"),b.isNumber(j,"options.silenceHysteresisInterval");var k=!1,l=a.now()+i,m=a.now()+j;c.onValue(function(d){if(!h){b.isObject(c,"audioVolumeMeter"),b.isNumber(d.date,"value.date"),b.isNumber(d.value,"value.value"),b.isNumber(d.smoothedValue,"value.smoothedValue"),b.isNumber(d.smoothedPeakValue,"value.smoothedPeakValue"),b.isNumber(d.clipped,"value.clipped");var e=d.value>.01&&d.value>2*d.smoothedValue&&d.value>.25*d.smoothedPeakValue,f=d.value>.8*d.smoothedValue,n=d.value<.5*d.smoothedValue,o=!e;(e||k&&f)&&l<d.date?(m=a.utc(d.date)+j,k||(k=!0,g._logger.info("Speaking detected"),g._callback&&g._callback("speaking"))):(n||!k&&o)&&m<d.date&&(l=a.utc(d.date)+i,k&&(k=!1,g._logger.info("Silence detected"),g._callback&&g._callback("silence")))}})}var e=50,f=1500;return c.prototype.init=function(){},c.prototype.onValue=function(a){this._callback=a},c.prototype.startDetection=function(a,b){var c=this;return d.call(c,a,b)},c.prototype.toString=function(){return"AudioSpeakerDetection"},c}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(4),c(5),c(30),c(27),c(57)],e=function(a,b,c,d,e){"use strict";function f(a,e){b.isArray(a,"userMediaStreams"),e=e||{},this._baseUri=e.uri||d.DefaultPCastUri,this._logger=e.logger||c.createPCastLogger(this._baseUri),this._publisherAdjusters=[],this._publishers=a}function g(a,b,c){var d=new e(c);d.connect(a,b),this._publisherAdjusters.push(d)}return f.prototype.start=function(b,c){c=c||{},a.forEach(this._publishers,a.bind(g,this,b,c))},f.prototype.stop=function(){a.forEach(this._publisherAdjusters,function(a){a.close()}),this._publisherAdjusters=[]},f.prototype.toString=function(){return"BandwidthMonitor"},f}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(4),c(5)],e=function(a,b){"use strict";function c(a){this.init(a)}function d(b,c){if(this._membersSubscription&&this._membersSubscription.dispose(),!c)return this._publisher.limitBandwidth(b);var d=c.getObservableMembers();this._membersSubscription=d.subscribe(a.bind(e,this,b),{initial:"notify"})}function e(a,b){if(b.length!==this._roomMemberCount){this._roomMemberCount=b.length;var c=a/Math.max(1,this._roomMemberCount-1);this._publisher.limitBandwidth(c)}}var f=5e6;return c.prototype.init=function(a){b.isObject(a,"publisher"),this._publisher=a,this._roomMemberCount=0,this._roomSubscription=null,this._membersSubscription=null},c.prototype.connect=function(c,e){b.isObject(c,"roomService"),e=e||{};var g=c.getObservableActiveRoom(),h=e.roomBandwidthLimit||f;this._roomSubscription=g.subscribe(a.bind(d,this,h),{initial:"notify"})},c.prototype.close=function(){this._roomSubscription&&this._roomSubscription.dispose(),this._membersSubscription&&this._membersSubscription.dispose(),this._roomSubscription=null,this._membersSubscription=null},c.prototype.toString=function(){return"PublisherBandwidthAdjuster"},c}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(4),c(5),c(59),c(26),c(38),c(1)],e=function(a,b,c,d,e,f){"use strict";function g(a){b.isObject(a,"options"),b.stringNotEmpty(a.backendUri,"options.backendUri"),b.isObject(a.authenticationData,"options.authenticationData"),this._pcast=null,this._subscribers={},this._publishers={},this._roomServices={},this._adminAPI=new c(a.backendUri,a.authenticationData),this._pcast=new d(a)}function h(a){if(this._pcast&&"offline"!==this._pcast.getStatus())return a(null,{status:"ok"});var b=this;this._adminAPI.createAuthenticationToken(function(c,d){return c?a(c):"ok"!==d.status?a(null,d):void b._pcast.start(d.authenticationToken,function(){},function(){a(null,{status:"ok"})},function(){a(null,{status:"offline"})})})}function i(a,c,d){var e=this;b.isArray(c.capabilities,"options.capabilities"),e._adminAPI.createStreamTokenForPublishing(e._pcast.getProtocol().getSessionId(),c.capabilities,function(b,f){return b?d(b):"ok"!==f.status?d(null,f):void j.call(e,f.streamToken,a,c,d)},1)}function j(c,d,e,g){var h=this;e.tags&&b.isArray(e.tags,"options.tags"),e.connectOptions&&b.isArray(e.connectOptions,"options.connectOptions");var k=function(b,k,m){var n=function(b){var f=a.uniqueId();h._publishers[f]=!0,m.stop(b),j.call(h,c,d,e,function(a,b){return b&&b.status===t?i.call(h,d,e,g):void g(a,b)}),delete h._publishers[f]};if("ok"!==k)return g(null,{status:k});h._publishers[m.getStreamId()]=m,e.videoElement&&f.attachMediaStream(e.videoElement,d);var o=!0,p=function(){},q=a.bind(s,h,p,n,o);if(e.monitor){var u=a.bind(r,h,e.monitor.callback,n);m.monitor(e.monitor.options||{},u),q=a.bind(s,h,e.monitor.callback,n,o)}m.setPublisherEndedCallback(q);var v=l.call(h,m,e.videoElement);g(null,{status:"ok",publisher:v})};h._pcast.publish(c,d,k,e.tags,{connectOptions:e.connectOptions})}function k(b,c,d){var e=this;e._pcast.subscribe(b,function(f,g,h){var i=function(f){var g=a.uniqueId();e._subscribers[g]=!0,h.stop(f),k.call(e,b,c,function(a,b){return b&&b.status===t?e.subscribe(c,d):void d(a,b)}),delete e._subscribers[g]};if("streaming-not-ready"===g)return d(null,{status:g,retry:a.bind(i,e,g)});if("ok"!==g)return d(null,{status:g});e._subscribers[h.getStreamId()]=h;var j;c.videoElement&&(j=h.createRenderer(),j.start(c.videoElement));var l=!1,n=function(){},o=a.bind(s,e,n,i,l);if(c.monitor){var p=a.bind(r,e,c.monitor.callback,i);h.monitor(c.monitor.options||{},p),o=a.bind(s,e,c.monitor.callback,i,l)}h.setStreamEndedCallback(o);var q=m.call(e,h,j);d(null,{status:"ok",mediaStream:q})})}function l(a,b){var c=a.stop;return a.stop=function(a){c(a),b&&(b.src="",b.srcObject=null)},a.enableAudio=function(){return o(a.getStream(),!0)},a.disableAudio=function(){return o(a.getStream(),!1)},a.enableVideo=function(){return p(a.getStream(),!0)},a.disableVideo=function(){return p(a.getStream(),!1)},a.setPublisherEndedCallback=function(){},a}function m(a,b){var c=a.stop;return a.stop=function(a){b&&b.stop(),c(a)},a.enableAudio=function(){return o(a.getStream(),!0)},a.disableAudio=function(){return o(a.getStream(),!1)},a.enableVideo=function(){return p(a.getStream(),!0)},a.disableVideo=function(){return p(a.getStream(),!1)},a.setStreamEndedCallback=function(){},a}function n(a,b){var c=this,d=a.stop;return a.stop=function(){d.call(a),delete c._roomServices[b]},a}function o(a,b){if(a)return q(a.getAudioTracks(),b),b}function p(a,b){if(a)return q(a.getVideoTracks(),b),b}function q(c,d){b.isArray(c,"tracks"),a.forEach(c,function(a){a.enabled=d})}function r(b,c,d,e,f){switch(e){case"client-side-failure":b(null,{status:e,retry:a.bind(c,null,e)})}}function s(a,b,c,d,e,f){var g={status:"stream-ended",reason:e,description:f};switch(e){case"ended":var h={status:e,reason:e,description:f};return c?h.publisher=d:h.mediaStream=d,a(null,h);case"custom":return a(null,g);case"capacity":return setTimeout(function(){return b(e)},u);case"failed":case"maintenance":return b(e);case"censored":case"app-background":default:return g.retry=b,a(null,g)}}var t="unauthorized",u=1e3,v=500;g.prototype.stop=function(){a.values(this._roomServices).length&&(a.forOwn(this._roomServices,function(a){a.stop()}),this._roomServices={}),this._pcast&&this._pcast.stop()},g.prototype.getPCast=function(){return this._pcast},g.prototype.getUserMedia=function(a,c){var d=this;b.isObject(a.mediaConstraints,"options.mediaConstraints"),h.call(this,function(b,e){return b?c(b):"ok"!==e.status?c(null,e):void d._pcast.getUserMedia(a.mediaConstraints,function(a,b,d,e){return e?c(e):"ok"!==b?c(null,{status:b}):void c(null,{status:"ok",userMedia:d})})})},g.prototype.publish=function(a,c){b.isObject(a,"options"),a.capabilities&&b.isArray(a.capabilities,"options.capabilities"),a.connectOptions&&b.isArray(a.connectOptions,"options.connectOptions"),a.mediaConstraints?b.isObject(a.mediaConstraints,"options.mediaConstraints"):b.isObject(a.userMediaStream,"options.userMediaStream"),a.videoElement&&b.isObject(a.videoElement,"options.videoElement"),a.monitor&&(b.isObject(a.monitor,"options.monitor"),b.isFunction(a.monitor.callback,"options.monitor.callback"),a.monitor.options&&b.isObject(a.monitor.options,"options.monitor.options"));var d=this;h.call(this,function(b,e){return b?c(b):"ok"!==e.status?c(null,e):a.userMediaStream?i.call(d,a.userMediaStream,a,c):void d._pcast.getUserMedia(a.mediaConstraints,function(b,e,f,g){return g?c(g):"ok"!==e?c(null,{status:e}):void i.call(d,f,a,c)})})};var w=["streaming","low-latency","on-demand","uld","vvld","vld","ld","sd","hd","fhd","uhd"];return g.prototype.publishRemote=function(c,d){if(b.isObject(c,"options"),b.stringNotEmpty(c.streamUri,"options.streamUri"),c.capabilities&&b.isArray(c.capabilities,"options.capabilities"),c.connectOptions&&b.isArray(c.connectOptions,"options.connectOptions"),c.mediaConstraints)throw new Error("Invalid argument, Media Constraints, for publishing remote.");if(c.videoElement)throw new Error("May not view remote stream publisher. Please subscribe to view.");c.prerollSkipDuration&&b.isNumber(c.prerollSkipDuration,"options.prerollSkipDuration"),c.monitor&&(b.isObject(c.monitor,"options.monitor"),b.isFunction(c.monitor.callback,"options.monitor.callback"),c.monitor.options&&b.isObject(c.monitor.options,"options.monitor.options")),c.frameRate&&(b.isObject(c.frameRate,"options.frameRate"),c.frameRate.exact&&b.isNumber(c.frameRate.exact,"options.frameRate.exact"),c.frameRate.max&&b.isNumber(c.frameRate.max,"options.frameRate.max"));var e=this;h.call(this,function(b,f){if(b)return d(b);if("ok"!==f.status)return d(null,f);var g=a.assign(c,{connectOptions:[],capabilities:[]});a.includes(g.capabilities,"publish-uri")||g.capabilities.push("publish-uri"),a.forEach(w,function(b){a.includes(g.capabilities,b)&&g.connectOptions.push("publisher-capability="+b)}),c.frameRate&&c.frameRate.exact&&g.connectOptions.push("source-uri-video-fps="+c.frameRate.exact),c.frameRate&&c.frameRate.max&&g.connectOptions.push("source-uri-video-fps-max="+c.frameRate.max),g.connectOptions.push("source-uri-preroll-skip-duration="+(a.isNumber(c.prerollSkipDuration)?c.prerollSkipDuration:v).toString()),i.call(e,g.streamUri,g,d)})},g.prototype.subscribe=function(a,c){b.isObject(a,"options"),b.stringNotEmpty(a.streamId,"options.streamId"),b.isObject(a.capabilities,"options.capabilities"),a.videoElement&&b.isObject(a.videoElement,"options.videoElement"),a.monitor&&(b.isObject(a.monitor,"options.monitor"),b.isFunction(a.monitor.callback,"options.monitor.callback"),a.monitor.options&&b.isObject(a.monitor.options,"options.monitor.options"));var d=this;h.call(this,function(b,e){return b?c(b):"ok"!==e.status?c(null,e):void d._adminAPI.createStreamTokenForSubscribing(d._pcast.getProtocol().getSessionId(),a.capabilities,a.streamId,function(b,e){return b?c(b):"ok"!==e.status?c(null,e):void k.call(d,e.streamToken,a,c)},1)})},g.prototype.createRoomService=function(b){var c=this,d=a.uniqueId();h.call(this,function(a,f){if(a)return b(a);if("ok"!==f.status)return b(null,f);c._roomServices[d]=new e(c._pcast);var g=n.call(c,c._roomServices[d],d);b(null,{status:"ok",roomService:g})})},g}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(4),c(5),c(10)],e=function(a,b,c){"use strict";function d(a,c){b.stringNotEmpty(a,"backendUri"),b.isObject(c,"authenticationData"),this._backendUri=a,this._authenticationData=c}function e(b){return a.assign(b,this._authenticationData)}function f(a,b,c){if(b)return a(b,{});var d=JSON.parse(c);return"ok"!==d.status?a(null,{status:d.status}):a(null,d)}return d.prototype.createAuthenticationToken=function(b){var d=e.call(this,{});c.postWithRetry(this._backendUri+"/auth","JSON",JSON.stringify(d),a.bind(f,this,b),1)},d.prototype.createStreamTokenForPublishing=function(d,g,h){b.stringNotEmpty(d,"sessionId"),b.isObject(g,"capabilities");var i=e.call(this,{sessionId:d,capabilities:g});c.postWithRetry(this._backendUri+"/stream","JSON",JSON.stringify(i),a.bind(f,this,h),1)},d.prototype.createStreamTokenForSubscribing=function(d,g,h,i){b.stringNotEmpty(d,"sessionId"),b.isObject(g,"capabilities");var j=e.call(this,{sessionId:d,capabilities:g,originStreamId:h});c.postWithRetry(this._backendUri+"/stream","JSON",JSON.stringify(j),a.bind(f,this,i),1)},d.prototype.getStreams=function(b){c.getWithRetry(this._backendUri+"/streams",a.bind(f,this,b),1)},d}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(4),c(5),c(58),c(47),c(46)],e=function(a,b,c,d,e){"use strict";function f(a){b.isObject(a,"options"),b.stringNotEmpty(a.backendUri,"options.backendUri"),b.isObject(a.authenticationData,"options.authenticationData"),this._pcastExpress=new c(a),this._roomServices=[]}function g(a,b,c){var d=this,e=0;d._pcastExpress.subscribe(a,function(a,d){if(a)return b(a);if("ok"!==d.status&&"streaming-not-ready"!==d.status)return b(null,d);if(e++,"streaming-not-ready"===d.status&&e<3)return setTimeout(d.retry,e*e*1e3);if("streaming-not-ready"===d.status&&e>=3)return b(null,{status:d.status});var f=d.mediaStream;return e>1?b(null,{status:"ok",mediaStream:f,reason:"stream-failure-recovered"}):void b(null,{status:"ok",mediaStream:f,reason:c})})}function h(a,b,c){return b?a(b):c.retry?c.retry():void a(b,c)}function i(a){switch(a){case d.types.channel.name:return"Room Channel";case d.types.moderatedChat.name:return"Moderated Chat";case d.types.multiPartyChat.name:return"Multi Party Chat";case d.types.townHall.name:return"Town Hall";case d.types.directChat.name:return"Direct Chat";default:throw new Error("Unsupported Room Type")}}function j(a){var b=a.indexOf(k)>-1;return b?a.replace(k,""):null}f.prototype.stop=function(){this._pcastExpress.stop()},f.prototype.getPCastExpress=function(){return this._pcastExpress},f.prototype.createRoom=function(c,d){b.isFunction(d,"callback"),b.isObject(c.room,"options.room"),b.stringNotEmpty(c.room.name,"options.room.name"),b.stringNotEmpty(c.room.type,"options.room.type"),c.room.description&&b.stringNotEmpty(c.room.description,"options.room.description");var e=c.room.description||i(c.room.type);this._pcastExpress.createRoomService(function(b,f){if(b)return d(b);if("ok"!==f.status)return d(null,f);var g=f.roomService,h=a.assign(c.room,{});h.description||(h.description=e),g.createRoom(h,function(a,b){return a?(g.stop(),d(a)):("already-exists"!==b.status&&"ok"!==b.status&&g.stop(),b.roomService=g,d(null,b))})})},f.prototype.createChannel=function(c,e){b.isObject(c,"options"),b.isObject(c.room,"options.room");var f=a.assign(c,{});f.room.type=d.types.channel.name,this.createRoom(f,e)},f.prototype.joinRoom=function(c,d,e){b.isObject(c,"options"),b.isFunction(d,"joinRoomCallback"),b.isFunction(e,"membersChangedCallback"),b.stringNotEmpty(c.role,"options.role"),c.screenName&&b.stringNotEmpty(c.screenName,"options.screenName"),c.roomId&&b.stringNotEmpty(c.roomId,"options.roomId"),c.alias&&b.stringNotEmpty(c.alias,"options.alias");var f=this,g=c.role,h=c.screenName||a.uniqueId();this._pcastExpress.createRoomService(function(a,b){if(a)return d(a);if("ok"!==b.status)return d(null,b);var i=b.roomService;
f._roomServices.push(i),i.start(g,h),i.enterRoom(c.roomId,c.alias,function(a,b){if(a)return i.stop(),d(a);if("not-found"===b.status)return i.stop(),d(null,{status:"room-not-found"});if("ok"!==b.status)return i.stop(),d(null,b);var c=b.room,g=i.leaveRoom;i.leaveRoom=function(a){g.call(i,function(b,c){return b?(i.stop(),a(b)):"ok"!==c.status?a(null,c):void i.stop()})},d(null,{status:"ok",roomService:i}),f._membersSubscription=c.getObservableMembers().subscribe(e,{initial:"notify"})})})},f.prototype.joinChannel=function(c,f,i){b.isObject(c,"options"),b.isFunction(f,"joinChannelCallback"),b.isFunction(i,"subscriberCallback"),c.videoElement&&b.isObject(c.videoElement,"options.videoElement");var k,l,m=a.assign(c,{type:d.types.channel.name,role:e.roles.audience.name}),n=this,o=function(b,c){var d=!c||a.assign(c,{});if(c&&c.roomService){var e=c.roomService.leaveRoom;d.roomService.leaveRoom=function(a){k&&k.stop(),e(a)}}f(b,d)};this.joinRoom(m,o,function(b){var d=a.filter(b,function(a){return a.getObservableRole().getValue()===e.roles.presenter.name}),f=a.reduce(d,function(a,b){return a&&a.getLastUpdate()>b.getLastUpdate()?a:b});if(!f)return i(null,{status:"no-stream-playing"});var m=f.getObservableStreams().getValue()[0];if(!m)return i(null,{status:"no-stream-playing"});var o=j(m.getUri());if(!o)return i(null,{status:"no-stream-playing"});if(o!==l){l&&k.stop();var p={capabilities:c.capabilities,videoElement:c.videoElement,streamId:o,monitor:{callback:a.bind(h,n,i),options:{conditionCountForNotificationThreshold:8}}},q=l?"stream-override":"stream-started";l=o;var r=function(a,b){b&&b.mediaStream?k=b.mediaStream:(l=null,k=null),i(a,b)};g.call(n,p,r,q)}})},f.prototype.publishToRoom=function(c,f){b.isObject(c,"options"),b.isFunction(f,"callback"),b.isObject(c.room,"options.room"),c.streamUri?b.stringNotEmpty(c.streamUri,"options.streamUri"):c.mediaConstraints?b.isObject(c.mediaConstraints,"options.mediaConstraints"):b.isObject(c.userMediaStream,"options.userMediaStream"),c.videoElement&&b.isObject(c.videoElement,"options.videoElement"),c.screenName&&b.stringNotEmpty(c.screenName,"options.screenName"),c.capabilities&&b.isArray(c.capabilities),c.tags&&b.isArray(c.tags);var g=this,i=e.roles.audience.name,j=c.screenName||a.uniqueId();this.createRoom(c,function(b,e){if(b)return f(b);if("ok"!==e.status&&"already-exists"!==e.status)return f(null,e);var k=e.roomService,l=e.room;k.start(i,j);var m=a.assign(c,{monitor:{callback:a.bind(h,g,f),options:{conditionCountForNotificationThreshold:8}}});if(c.streamUri){var n=a.assign(m,{connectOptions:[]}),o=a.find(n.connectOptions,function(a){return a.startsWith("room-id")});o||(n.connectOptions=n.connectOptions.concat(["room-id="+l.getRoomId(),"member-role=Presenter","member-stream-type=Presentation","screen-name="+j])),g._pcastExpress.publishRemote(n,f)}else if(l.getObservableType().getValue()===d.types.channel.name){var p=a.assign(m,{tags:[]}),q=a.find(p.tags,function(a){return a.startsWith("channelId")});q||(p.tags=p.tags.concat(["channelId:"+l.getRoomId()])),a.includes(p.capabilities,"channel")||p.capabilities.push("channel"),g._pcastExpress.publish(p,f)}})},f.prototype.publishToChannel=function(c,e){b.isObject(c,"options"),b.isFunction(e,"callback");var f=a.assign(c,{});c.room.type=d.types.channel.name,this.publishToRoom(f,e)};var k="pcast://phenixp2p.com/";return f}.apply(b,d),!(void 0!==e&&(a.exports=e))}])});