/**
 * Copyright 2018 PhenixP2P Inc. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
!function(t,i){"object"==typeof exports&&"object"==typeof module?module.exports=i():"function"==typeof define&&define.amd?define("phenix-web-sdk",[],i):"object"==typeof exports?exports["phenix-web-sdk"]=i():t["phenix-web-sdk"]=i()}(this,function(){return function(t){var i={};function e(n){if(i[n])return i[n].exports;var r=i[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,e),r.l=!0,r.exports}return e.m=t,e.c=i,e.i=function(t){return t},e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var i=t&&t.t?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="",e(e.s=82)}([function(t,i,e){var n,r;n=[e(41)],void 0===(r=function(t){"use strict";return t}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(30)],void 0===(r=function(t){return t}.apply(i,n))||(t.exports=r)},function(t,i,e){var n;n=function(t,i,e,n){return function(t){function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}var e={};return i.m=t,i.c=e,i.i=function(t){return t},i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},i.n=function(t){var e=t&&t.t?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},i.p="",i(i.s=10)}([function(t,i,e){(function(e){var n;void 0===(n=function(){"use strict";return"object"==typeof window?window:"object"==typeof e?e:{}}.apply(i,[]))||(t.exports=n)}).call(i,e(9))},function(i,e){i.exports=t},function(t,e){t.exports=i},function(t,i,e){var n,r;n=[e(1),e(4),e(0)],void 0===(r=function(t,i,e){"use strict";function n(t,e,n){var r=this;this.e=t,this.r=e,this.a=n,this.u={};var s=function(t){r.h=!0,r.f=!0===t,t?a.call(r):l("Failed to create Phenix video element"),r.v&&r.v(r.f)};try{if(this.g=function(t){var i=document.createElement("video");return t&&((i=document.createElement("object")).type="application/x-phenix-video"),i}(n),this.g.className=this.e.className,this.g.height=this.e.height,this.g.width=this.e.width,this.e.style.cssText="visibility:hidden !important;width:0px !important;height:0px !important;margin:0px !important;padding:0px !important;border-style:none !important;border-width:0px !important;max-width:0px !important;max-height:0px !important;outline:none !important",this.g.onunload=function(){r.h=!1},h.call(this),document.body&&document.body.contains||f("document.body.contains is not supported"),document.body&&document.body.contains&&document.body.contains(this.e)&&this.e.parentNode.replaceChild(this.g,this.e),!n)return s(!0);(new i).waitForReady(this.g,s)}catch(t){l("Error while loading Phenix RTC"+t),s(!1)}}function r(t,i,e){if(!this.a)return this.g.addEventListener(t,i,e);var n=this.u[t];n||(n=this.u[t]=[],this.h&&s.call(this,t)),n.push(i)}function s(t){var i=this;i.g.phenixSetEventListener(t,function(){var e=i.u[t];if(e)for(var n=0;n<e.length;n++)e[n].apply(i,arguments)})}function o(t,i){var e;document.createEvent?(e=document.createEvent("HTMLEvents")).initEvent(i,!0,!0):(e=document.createEventObject()).eventType=i,e.eventName=i,setTimeout(function(){document.createEvent?t.dispatchEvent(e):t.fireEvent("on"+e.eventType,e)})}function a(){for(var t=Object.keys(this.u),i=0;i<t.length;i++)s.call(this,t[i]);this.hookUpEvents(),u.call(this),this.g.id=this.e.id,this.g.style.cssText=this.e.cssText,this.g.className=this.e.className,this.g.innerHtml=this.e.innerHtml,this.g.width=this.e.width,this.g.height=this.e.height,this.g.autoplay=this.e.autoplay,this.g.muted=this.e.muted,this.g.defaultMuted=this.e.defaultMuted,this.g.volume=this.e.volume,this.r&&(this.g.src=this.r)}function u(){var i=this,n=["style"];if(t.get(e,["MutationObserver"])){new MutationObserver(function(t){t.forEach(function(t){"attributes"===t.type&&t.target===i.e&&-1===n.indexOf(t.attributeName)&&(i.g[t.attributeName]=i.e[t.attributeName])})}).observe(i.e,{attributes:!0})}else f("Falling back to use of DOM event listeners. This results in degraded performance for further DOM modifications and does not work for IE prior to version 9. See https://developer.mozilla.org/en-US/docs/Web/Guide/Events/Mutation_events for details."),i.e.addEventListener?i.e.addEventListener("DOMAttrModified",function(t){i.g[t.target.tagName]=i.e[t.target.tagName]},!1):i.e.attachEvent("onpropertychange",function(t){i.g[t.target.tagName]=i.e[t.target.tagName]})}function h(){var i=this;if(t.get(e,["MutationObserver"])){new MutationObserver(function(t){t.forEach(function(t){if("childList"===t.type)for(var e=0;e<t.addedNodes.length;e++){var n=t.addedNodes[e];t.target!==i.g&&(n===i.e?(t.target.replaceChild(i.g,i.e),a.call(i)):c(t.target,i.e)&&(i.e.parentNode.replaceChild(i.g,i.e),a.call(i)))}})}).observe(document.body,{childList:!0,attributes:!1,characterData:!1,subtree:!0})}else f("Falling back to use of DOM event listeners. This results in degraded performance for further DOM modifications and does not work for IE prior to version 9. See https://developer.mozilla.org/en-US/docs/Web/Guide/Events/Mutation_events for details."),r(i.e,"DOMNodeInserted",function(){i.e.parentNode.replaceChild(i.g,i.e)})}function c(t,i){for(var e=i.parentNode;null!==e;){if(e===t)return!0;e=e.parentNode}return!1}var f=function(){console.log.apply(console,arguments)}||function(){},l=function(){console.error.apply(console,arguments)}||f;return n.prototype.hookUpEvents=function(){var t=this,i=this.e;this.addEventListener("error",function(){o(i,"error")}),this.addEventListener("mute",function(){i.muted=t.g.muted,o(i,"mute")}),this.addEventListener("unmute",function(){i.muted=t.g.muted,o(i,"unmute")}),this.addEventListener("ended",function(){i.ended=t.g.ended,o(i,"ended")}),this.addEventListener("loadedmetadata",function(){i.width=t.g.width,i.height=t.g.height,o(i,"loadedmetadata")}),this.addEventListener("loadeddata",function(){i.width=t.g.width,i.height=t.g.height,o(i,"loadeddata")}),this.addEventListener("resize",function(){i.width=t.g.width,i.height=t.g.height,o(i,"resize")})},n.prototype.onReady=function(t){var i=this;this.h?setTimeout(function(){t(i.f)},1):this.v=t},n.prototype.getElement=function(){return this.g},n.prototype.addEventListener=function(t,i,e){r.call(this,t,i,e)},n.prototype.removeEventListener=function(t,i,e){(function(t,i,e){if(!this.a)return this.g.removeEventListener(t,i,e);var n=this.u[t];if(n){var r=n.indexOf(i);r>=0&&((n=n.splice(r,1)).length>0?this.u[t]=n:delete this.u[t])}}).call(this,t,i,e)},n}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(2)],void 0===(r=function(t){"use strict";function i(t){this.y=t||15e3}var e=new t(navigator.userAgent).detect(),n=function(){console.error.apply(console,arguments)}||console.log;return i.prototype.waitForReadyWithTimeout=function(t,i,r){var s=!1,o=1,a=o,u=function(t){s||(s=!0,i(t))};t.hasOwnProperty&&t.hasOwnProperty("onload")||"IE"!==e.browser&&n("No means of detecting when <object> is loaded"),t.onload=function(){u(!0)},function i(){4===t.readyState?u(!0):t.phenixVersion?u(!0):(o=Math.min(o+1e3,2*o),(a+=o)>r?(n("Timed out while waiting for <object> to load"),u(!1)):setTimeout(i,o))}()},i.prototype.waitForReady=function(t,i){t.phenixVersion?i(!0):this.waitForReadyWithTimeout(t,i,this.y)},i}.apply(i,n))||(t.exports=r)},function(t,i){t.exports=e},function(t,i){t.exports=n},function(t,i,e){var n,r;n=[e(1),e(5),e(6),e(2),e(0),e(12),e(11)],void 0===(r=function(t,i,e,n,r,s,o){"use strict";function a(){if(t.assign(h,s()),o.isSupported()){h.phenixSupported=!0;var i=new o,e=function(){h.RTCPeerConnection=i.getRTCPeerConnectionConstructor(),h.RTCSessionDescription=i.getRTCSessionDescriptionConstructor(),h.RTCIceCandidate=i.getRTCIceCandidateConstructor(),h.getSources=i.getSourcesDelegate(),h.getUserMedia=i.getUserMediaDelegate(),h.getStats=i.getStatsDelegate(),Function.prototype.bind?(h.attachMediaStream=i.attachMediaStream.bind(i),h.reattachMediaStream=i.reattachMediaStream.bind(i),h.isPhenixEnabled=i.isEnabled.bind(i)):(h.attachMediaStream=function(){i.attachMediaStream.apply(i,arguments)},h.reattachMediaStream=function(){i.reattachMediaStream.apply(i,arguments)},h.isPhenixEnabled=function(){return i.isEnabled()}),h.webrtcSupported=!0,h.phenixSupported=!0,h.phenixVersion=i.getVersion(),h.onLoaded&&h.onLoaded.call()};i.isEnabled()?e():i.onReady(function(t){t&&(e(),h.onload&&"function"==typeof h.onload&&h.onload())}),i.onLoaded(function(){e()})}else h.phenixSupported=!1;return h}var u=new n(navigator.userAgent).detect(),h={browser:u.browser,browserVersion:u.version,phenixSupported:!1,isPhenixEnabled:function(){return!1},onLoaded:void 0,global:r};return t.assign(a(),{shim:a})}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(0)],void 0===(r=function(t){"use strict";return function(i){t.RTCPeerConnection=i.RTCPeerConnection,t.RTCSessionDescription=i.RTCSessionDescription,t.RTCIceCandidate=i.RTCIceCandidate}}.apply(i,n))||(t.exports=r)},function(t,i){var e;e=function(){return this}();try{e=e||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(e=window)}t.exports=e},function(t,i,e){"use strict";var n,r;n=[e(7),e(8)],void 0===(r=function(t,i){return t.onLoaded=function(){i(t)},t.onLoaded(),t}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(1),e(5),e(6),e(4),e(3)],void 0===(r=function(t,i,e,n,r){"use strict";function s(){var t=this;this.w=function(){var t=document.createElement("div");return t.id="phenixRTC",t.style.cssText="visibility:hidden !important;width:0px !important;height:0px !important;margin:0px !important;padding:0px !important;border-style:none !important;border-width:0px !important;max-width:0px !important;max-height:0px !important;outline:none !important",document.body.appendChild(t),t}(),this.b="?";try{this.I=function(t){var i=document.createElement("object");return i.type="application/x-phenix-rtc",t.appendChild(i),i}(this.w),this.I.onunload=function(){t.h=!1},(new n).waitForReady(this.I,function(i){t.h=!0,t.f=!0===i,t.b=t.I.phenixVersion||"?.?.?.?",l(i?"Phenix RTC "+t.b:"No Phenix RTC"),t.v&&t.v(t.f)})}catch(t){d("Error while loading Phenix RTC"+t)}}function o(){this.w&&document.getElementById("phenixRTC")!==this.w&&(document.body.appendChild(this.w),this.k&&this.k.call(this))}function a(i){var e=function(){var e=null;switch(arguments.length){case 0:e=new i;break;case 1:e=new i(arguments[0]);break;case 2:e=new i(arguments[0],arguments[1]);break;case 3:e=new i(arguments[0],arguments[1],arguments[2]);break;case 4:e=new i(arguments[0],arguments[1],arguments[2],arguments[3]);break;case 5:e=new i(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]);break;default:throw new Error("Unsupported number of arguments in Phenix Object Constructor")}return e.phenixAddEventListener=t.bind(u,e),e.phenixRemoveEventListener=t.bind(h,e),e};return t.forOwn(i,function(t,i){e[i]=t}),e}function u(t,e){i.stringNotEmpty(t,"name"),i.isFunction(e,"listener"),c.call(this,t),function(t,i){if(!this.events||!this.events[t])throw new Error("No event observable for event: "+name);this.events[t].listeners.push(i)}.call(this,t,e)}function h(t,i){f.call(this,t,i)}function c(i){if(!this.events||!this.events[i]){this.events||(this.events={});var n=this.events;n[i]={observable:(new e.Observable).extend({timeout:0}),subscription:null,listeners:[]},this.phenixSetEventListener(i,t.bind(n[i].observable.setValue,n[i].observable)),n[i].subscription=n[i].observable.subscribe(function(e){var r=n[i].listeners;t.forEach(r,function(t){t(e)})})}}function f(i,e){this.events&&this.events.events[i]&&(this.events[i].listeners=t.filter(this.events[i].listeners,function(t){return e!==t}))}var l=function(){console.log.apply(console,arguments)}||function(){},d=function(){console.error.apply(console,arguments)}||l;return s.prototype.onReady=function(t){var i=this;this.h?setTimeout(function(){t(i.f)},1):this.v=t},s.prototype.onLoaded=function(t){this.k=t},s.prototype.isLoaded=function(){return!0===this.h},s.isSupported=function(){if(navigator.plugins)for(var t=navigator.plugins,i=0;i<t.length;i++)if(t[i].name.indexOf("PhenixRTC")>=0)return!0;if(navigator.userAgent&&(navigator.userAgent.match(/MSIE/)||navigator.userAgent.match(/Trident/)))try{return new window.ActiveXObject("PhenixP2P.RTC"),!0}catch(t){return!1}return!1},s.prototype.isEnabled=function(){return o.call(this),this.I&&void 0!==this.I.phenixVersion},s.prototype.getVersion=function(){return o.call(this),this.b},s.prototype.getRTCPeerConnectionConstructor=function(){return o.call(this),a(this.I.RTCPeerConnection)},s.prototype.getRTCSessionDescriptionConstructor=function(){return o.call(this),a(this.I.RTCSessionDescription)},s.prototype.getRTCIceCandidateConstructor=function(){return o.call(this),a(this.I.RTCIceCandidate)},s.prototype.getSourcesDelegate=function(){var t=this;return function(i){return o.call(t),t.I.getSources(i)}},s.prototype.getUserMediaDelegate=function(){var t=this;return function(i,e,n){return o.call(t),t.I.getUserMedia(i,e,n)}},s.prototype.getStatsDelegate=function(){return function(t,i,e,n){return t.getStats(i,e,n)}},s.prototype.attachMediaStream=function(t,i){return o.call(this),function(t,i){if(!t)throw new Error("Can not attach a stream to a undefined element");if(t.phenixVersion)return t.src=i,t;var e=new r(t,i,!0);return e.getElement().phenixPresenter=e,e.getElement()}.call(this,t,i)},s.prototype.reattachMediaStream=function(t,i){return o.call(this),this.attachMediaStream(t,i.src)},s}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(1),e(2),e(13),e(0),e(3)],void 0===(r=function(t,i,e,n,r){"use strict";function s(){if(w=n.RTCPeerConnection,b=n.RTCSessionDescription,E=n.RTCIceCandidate,navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(I=t.bind(h,null,"input")),navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(k=t.bind(h,null,"output")),(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||n.getUserMedia)&&(T=o),!n.RTCPeerConnection)return g("[%s] browser version [%s] does not appear to be WebRTC-capable",y.browser,y.version);switch(y.browser){case"Firefox":g("Firefox detected",y),R=function(t,i){g("Attaching media stream");var e=t.muted;return y.version>57&&(t.srcObject=i),t.mozSrcObject=i,t.play(),!0===e&&(t.muted=!0),t},C=function(t,i){g("Reattaching media stream");var e=t.muted;return y.version>57&&(t.srcObject=i.srcObject),t.mozSrcObject=i.mozSrcObject,t.play(),!0===e&&(t.muted=!0),t},S=function(i,e,n,r){i.getStats(e,t.bind(d,this,i,n),r)},O=!0;break;case"Opera":g("Opera detected",y),R=c,C=l,S=function(i,e,n,r){i.getStats(t.bind(d,this,i,n),e,r)},O=!0;break;case"Chrome":g("Webkit detected",y),R=c,C=l,S=function(i,e,n,r){i.getStats(t.bind(d,this,i,n),e,r)},O=!0;break;case"Edge":g("Edge detected",y),R=c,C=l,S=function(i,e,n,r){i.getStats(e,t.bind(d,this,i,n),r)},O=!0;break;case"Safari":g("Safari detected",y),R=function(i,e){return t.isObject(e)&&(i.S=!0),c(i,e)},x=function(t,i){return t.S?((t=new r(t,i,!1).getElement()).play(),t):f(t,i)},C=l,S=function(i,e,n,r){i.getStats(e).then(t.bind(d,this,i,n),r)},O=!0;break;case"ReactNative":g("React Native detected",y),R=function(){g("attachMediaStream not supported in React Native environment")},x=function(){g("attachUriStream not supported in React Native environment")},C=function(){g("reattachMediaStream not supported in React Native environment")},S=function(i,e,n,r){i.getStats(e).then(t.bind(d,this,i,n),r)},O=!0;break;default:g("Browser does not appear to be WebRTC-capable",y)}}function o(i,e,r){var s=t.bind(a,this,i,e,r);navigator.getUserMedia&&navigator.getUserMedia(i,s,r),n.getUserMedia&&n.getUserMedia(i,s,r)}function a(t,i,e,n){setTimeout(function(){for(var r=n.getTracks(),s=0;s<r.length;s++){var o=r[s];if(o.onended=function(t){g(t.timeStamp,"Track",o.id,o.label,"ended")},g("Track",o.id,o.label,r[s].kind,"readyState=",r[s].readyState),"ended"===o.readyState)return u("User media not available",e,r)}var a=(t.audio?1:0)+(t.video?1:0);return r.length!==a?u("Unable to get all requested user media.",e,r):void i(n)},100)}function u(t,i,e){try{var n=new Error(t);n.code="unavailable",i(n)}finally{!function(t){for(var i=0;i<t.length;i++)t[i].stop()}(e)}}function h(t,i){if("input"!==t&&"output"!==t)throw new Error("Unsupported device type "+t);navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices().then(function(e){var n=[];e.forEach(function(i){i.kind==="audio"+t?n.push({kind:"audio",id:i.deviceId,label:i.label}):i.kind==="video"+t&&n.push({kind:"video",id:i.deviceId,label:i.label})}),i(n)})}function c(t,i){return void 0!==t.srcObject?t.srcObject=i:void 0!==t.mozSrcObject?t.mozSrcObject=i:void 0!==t.src?t.src=URL.createObjectURL(i):g("Error attaching stream to element."),t.play(),t}function f(t,i){return t.src=i,t.play(),t}function l(t,i){return t.src=i.src,t}function d(t,i,e){i(p(t,e))}function p(i,e){switch(y.browser){case"Edge":e.forEach(function(t){t.mediaType=m(i,t.codecId),t.bytesSent=v(t.packetsSent,t.mediaType),t.bytesReceived=v(t.packetsReceived,t.mediaType)});break;case"Safari":e.forEach(function(i){t.includes(i.id.toLowerCase(),"audio")&&t.includes(i.id.toLowerCase(),"rtp")&&(i.mediaType="audio"),t.includes(i.id.toLowerCase(),"video")&&t.includes(i.id.toLowerCase(),"rtp")&&(i.mediaType="video")})}return e}function m(i,e){var n;if(e)return function(i,e){var n=i.localDescription.sdp.split("m="),r=i.remoteDescription.sdp.split("m=");n.length===r.length&&t.findIndex(n,function(t,i){return e(t,i,r)})}(i,function(i){t.startsWith(i,"video")&&t.includes(i.toLowerCase(),e.toLowerCase())&&(n="video"),t.startsWith(i,"audio")&&t.includes(i.toLowerCase(),e.toLowerCase())&&(n="audio")}),n}function v(t,i){var e=parseInt(t)||0;return"audio"===i?100*e:"video"===i?1080*e:void 0}var g=function(){console.log.apply(console,arguments)},y=new i(navigator.userAgent).detect(),w=n.RTCPeerConnection,b=n.RTCSessionDescription,E=n.RTCIceCandidate,I=null,k=null,T=null,S=null,R=null,x=null,C=null,O=!1;return function(){s();var t={RTCPeerConnection:w,RTCSessionDescription:b,RTCIceCandidate:E,getSources:I,getDestinations:k,getUserMedia:T,getStats:S,attachMediaStream:R,attachUriStream:x||f,reattachMediaStream:C,webrtcSupported:O,exportGlobal:function(){n.RTCPeerConnection=t.RTCPeerConnection,n.RTCSessionDescription=t.RTCSessionDescription,n.RTCIceCandidate=t.RTCIceCandidate}};return t}}.apply(i,n))||(t.exports=r)},function(t,i,e){var n;void 0===(n=function(){"use strict";return function(){}}.apply(i,[]))||(t.exports=n)}])},t.exports=n(e(0),e(36),e(1),e(7))},function(t,i,e){var n,r;n=[e(37),e(38)],void 0===(r=function(t,i){return{Disposable:t,DisposableList:i}}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(16),e(39)],void 0===(r=function(t,i){return{Event:t,NamedEvents:i}}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(40)],void 0===(r=function(t){"use strict";return t}.apply(i,n))||(t.exports=r)},function(t,i,e){var n;void 0===(n=function(){"use strict";return{networkStates:{networkEmpty:{id:0,name:"NETWORK_EMPTY"},networkIdle:{id:1,name:"NETWORK_IDLE"},networkLoading:{id:2,name:"NETWORK_LOADING"},networkNoSource:{id:3,name:"NETWORK_NO_SOURCE"}},types:{realTime:{id:0,name:"RealTime"},dash:{id:1,name:"dash"},hls:{id:2,name:"hls"}},streamEvents:{playerEnded:{id:0,name:"playerended"},playerError:{id:1,name:"playererror"},stopped:{id:2,name:"stopped"}},rendererEvents:{ended:{id:0,name:"ended"},error:{id:1,name:"error"}}}}.apply(i,[]))||(t.exports=n)},function(t,i,e){var n,r;n=[e(18),e(45),e(46)],void 0===(r=function(t,i,e){"use strict";return{Observable:t,ObservableArray:i,ObservableMonitor:e}}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(0),e(1),e(4)],void 0===(r=function(t,i,e){"use strict";var n=500,r=15;function s(t,i){if(!t)throw new Error("'logger' must be specified.");this.R=t,this.x=new e.Event,this.C=null,this.O=!1,this.M=null,this.A={pollFrequency:n,previousWidth:0,previousHeight:0},i&&i.pollFrequency&&(this.A.pollFrequency=i.pollFrequency>=r?i.pollFrequency:r),this.q=null}function o(){if(this.O&&!this.C&&0!==this.x.size()){var t=this;this.A.previousWidth=this.M.videoWidth,this.A.previousHeight=this.M.videoHeight,this.C=setInterval(function(){t.M.videoWidth===t.A.previousWidth&&t.M.videoHeight===t.A.previousHeight||(t.A.previousWidth=t.M.videoWidth,t.A.previousHeight=t.M.videoHeight,t.x.fireAsync([t.q,{width:t.M.videoWidth,height:t.M.videoHeight}]))},t.A.pollFrequency)}}return s.prototype.start=function(i,e){(function(i,e){e&&!t.isUndefined(e.videoWidth)||this.R.warn("Attempting to start dimensions changed monitor without providing proper 'video' element.");this.q=i,this.M=e,this.O=!0,o.call(this)}).call(this,i,e)},s.prototype.stop=function(){(function(){this.O=!1,this.C&&(clearInterval(this.C),this.C=null);this.x.dispose()}).call(this)},s.prototype.addVideoDisplayDimensionsChangedCallback=function(t){return i.isFunction(t,"addVideoDisplayDimensionsChangedCallback"),o.call(this),this.x.listen(t)},s.prototype.toString=function(){return"DimensionsChangedMonitor[pollFrequency="+this.A.pollFrequency+", previousHeight="+this.A.previousHeight+", previousWidth="+this.A.previousHeight+", state="+(this.C?"running":"stopped")+"]"},s}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(43),e(42),e(11)],void 0===(r=function(t,i,e){"use strict";return{createLogger:function(){return new t},Logger:t,ConsoleAppender:i,level:e.level}}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r,s,o;
/**
 * @license bytebuffer.js (c) 2015 Daniel Wirtz <dcode@dcode.io>
 * Backing buffer: ArrayBuffer, Accessor: Uint8Array
 * Released under the Apache License, Version 2.0
 * see: https://github.com/dcodeIO/bytebuffer.js for details
 */
/**
 * @license bytebuffer.js (c) 2015 Daniel Wirtz <dcode@dcode.io>
 * Backing buffer: ArrayBuffer, Accessor: Uint8Array
 * Released under the Apache License, Version 2.0
 * see: https://github.com/dcodeIO/bytebuffer.js for details
 */
o=function(t){"use strict";var i=function(t,e,r){if(void 0===t&&(t=i.DEFAULT_CAPACITY),void 0===e&&(e=i.DEFAULT_ENDIAN),void 0===r&&(r=i.DEFAULT_NOASSERT),!r){if((t|=0)<0)throw RangeError("Illegal capacity");e=!!e,r=!!r}this.buffer=0===t?n:new ArrayBuffer(t),this.view=0===t?null:new Uint8Array(this.buffer),this.offset=0,this.markedOffset=-1,this.limit=t,this.littleEndian=e,this.noAssert=r};i.VERSION="5.0.1",i.LITTLE_ENDIAN=!0,i.BIG_ENDIAN=!1,i.DEFAULT_CAPACITY=16,i.DEFAULT_ENDIAN=i.BIG_ENDIAN,i.DEFAULT_NOASSERT=!1,i.Long=t||null;var e=i.prototype;e.N,Object.defineProperty(e,"__isByteBuffer__",{value:!0,enumerable:!1,configurable:!1});var n=new ArrayBuffer(0),r=String.fromCharCode;function s(t){var i=0;return function(){return i<t.length?t.charCodeAt(i++):null}}function o(){var t=[],i=[];return function(){if(0===arguments.length)return i.join("")+r.apply(String,t);t.length+arguments.length>1024&&(i.push(r.apply(String,t)),t.length=0),Array.prototype.push.apply(t,arguments)}}function a(t,i,e,n,r){var s,o,a=8*r-n-1,u=(1<<a)-1,h=u>>1,c=-7,f=e?r-1:0,l=e?-1:1,d=t[i+f];for(f+=l,s=d&(1<<-c)-1,d>>=-c,c+=a;c>0;s=256*s+t[i+f],f+=l,c-=8);for(o=s&(1<<-c)-1,s>>=-c,c+=n;c>0;o=256*o+t[i+f],f+=l,c-=8);if(0===s)s=1-h;else{if(s===u)return o?NaN:1/0*(d?-1:1);o+=Math.pow(2,n),s-=h}return(d?-1:1)*o*Math.pow(2,s-n)}function u(t,i,e,n,r,s){var o,a,u,h=8*s-r-1,c=(1<<h)-1,f=c>>1,l=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:s-1,p=n?1:-1,m=i<0||0===i&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(a=isNaN(i)?1:0,o=c):(o=Math.floor(Math.log(i)/Math.LN2),i*(u=Math.pow(2,-o))<1&&(o--,u*=2),(i+=o+f>=1?l/u:l*Math.pow(2,1-f))*u>=2&&(o++,u/=2),o+f>=c?(a=0,o=c):o+f>=1?(a=(i*u-1)*Math.pow(2,r),o+=f):(a=i*Math.pow(2,f-1)*Math.pow(2,r),o=0));r>=8;t[e+d]=255&a,d+=p,a/=256,r-=8);for(o=o<<r|a,h+=r;h>0;t[e+d]=255&o,d+=p,o/=256,h-=8);t[e+d-p]|=128*m}i.accessor=function(){return Uint8Array},i.allocate=function(t,e,n){return new i(t,e,n)},i.concat=function(t,e,n,r){"boolean"!=typeof e&&"string"==typeof e||(r=n,n=e,e=void 0);for(var s,o=0,a=0,u=t.length;a<u;++a)i.isByteBuffer(t[a])||(t[a]=i.wrap(t[a],e)),(s=t[a].limit-t[a].offset)>0&&(o+=s);if(0===o)return new i(0,n,r);var h,c=new i(o,n,r);for(a=0;a<u;)(s=(h=t[a++]).limit-h.offset)<=0||(c.view.set(h.view.subarray(h.offset,h.limit),c.offset),c.offset+=s);return c.limit=c.offset,c.offset=0,c},i.isByteBuffer=function(t){return!0===(t&&t.N)},i.type=function(){return ArrayBuffer},i.wrap=function(t,n,r,s){if("string"!=typeof n&&(s=r,r=n,n=void 0),"string"==typeof t)switch(void 0===n&&(n="utf8"),n){case"base64":return i.fromBase64(t,r);case"hex":return i.fromHex(t,r);case"binary":return i.fromBinary(t,r);case"utf8":return i.fromUTF8(t,r);case"debug":return i.fromDebug(t,r);default:throw Error("Unsupported encoding: "+n)}if(null===t||"object"!=typeof t)throw TypeError("Illegal buffer");var o;if(i.isByteBuffer(t))return(o=e.clone.call(t)).markedOffset=-1,o;if(t instanceof Uint8Array)o=new i(0,r,s),t.length>0&&(o.buffer=t.buffer,o.offset=t.byteOffset,o.limit=t.byteOffset+t.byteLength,o.view=new Uint8Array(t.buffer));else if(t instanceof ArrayBuffer)o=new i(0,r,s),t.byteLength>0&&(o.buffer=t,o.offset=0,o.limit=t.byteLength,o.view=t.byteLength>0?new Uint8Array(t):null);else{if("[object Array]"!==Object.prototype.toString.call(t))throw TypeError("Illegal buffer");(o=new i(t.length,r,s)).limit=t.length;for(var a=0;a<t.length;++a)o.view[a]=t[a]}return o},e.writeBitSet=function(t,i){var e=void 0===i;if(e&&(i=this.offset),!this.noAssert){if(!(t instanceof Array))throw TypeError("Illegal BitSet: Not an array");if("number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}var n,r=i,s=t.length,o=s>>3,a=0;for(i+=this.writeVarint32(s,i);o--;)n=1&!!t[a++]|(1&!!t[a++])<<1|(1&!!t[a++])<<2|(1&!!t[a++])<<3|(1&!!t[a++])<<4|(1&!!t[a++])<<5|(1&!!t[a++])<<6|(1&!!t[a++])<<7,this.writeByte(n,i++);if(a<s){var u=0;for(n=0;a<s;)n|=(1&!!t[a++])<<u++;this.writeByte(n,i++)}return e?(this.offset=i,this):i-r},e.readBitSet=function(t){var i=void 0===t;i&&(t=this.offset);var e,n=this.readVarint32(t),r=n.value,s=r>>3,o=0,a=[];for(t+=n.length;s--;)e=this.readByte(t++),a[o++]=!!(1&e),a[o++]=!!(2&e),a[o++]=!!(4&e),a[o++]=!!(8&e),a[o++]=!!(16&e),a[o++]=!!(32&e),a[o++]=!!(64&e),a[o++]=!!(128&e);if(o<r){var u=0;for(e=this.readByte(t++);o<r;)a[o++]=!!(e>>u++&1)}return i&&(this.offset=t),a},e.readBytes=function(t,i){var e=void 0===i;if(e&&(i=this.offset),!this.noAssert){if("number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+t>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+"+t+") <= "+this.buffer.byteLength)}var n=this.slice(i,i+t);return e&&(this.offset+=t),n},e.writeBytes=e.append,e.writeInt8=function(t,i){var e=void 0===i;if(e&&(i=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t|=0,"number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}i+=1;var n=this.buffer.byteLength;return i>n&&this.resize((n*=2)>i?n:i),i-=1,this.view[i]=t,e&&(this.offset+=1),this},e.writeByte=e.writeInt8,e.readInt8=function(t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var e=this.view[t];return 128==(128&e)&&(e=-(255-e+1)),i&&(this.offset+=1),e},e.readByte=e.readInt8,e.writeUint8=function(t,i){var e=void 0===i;if(e&&(i=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t>>>=0,"number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}i+=1;var n=this.buffer.byteLength;return i>n&&this.resize((n*=2)>i?n:i),i-=1,this.view[i]=t,e&&(this.offset+=1),this},e.writeUInt8=e.writeUint8,e.readUint8=function(t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var e=this.view[t];return i&&(this.offset+=1),e},e.readUInt8=e.readUint8,e.writeInt16=function(t,i){var e=void 0===i;if(e&&(i=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t|=0,"number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}i+=2;var n=this.buffer.byteLength;return i>n&&this.resize((n*=2)>i?n:i),i-=2,this.littleEndian?(this.view[i+1]=(65280&t)>>>8,this.view[i]=255&t):(this.view[i]=(65280&t)>>>8,this.view[i+1]=255&t),e&&(this.offset+=2),this},e.writeShort=e.writeInt16,e.readInt16=function(t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+2) <= "+this.buffer.byteLength)}var e=0;return this.littleEndian?(e=this.view[t],e|=this.view[t+1]<<8):(e=this.view[t]<<8,e|=this.view[t+1]),32768==(32768&e)&&(e=-(65535-e+1)),i&&(this.offset+=2),e},e.readShort=e.readInt16,e.writeUint16=function(t,i){var e=void 0===i;if(e&&(i=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t>>>=0,"number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}i+=2;var n=this.buffer.byteLength;return i>n&&this.resize((n*=2)>i?n:i),i-=2,this.littleEndian?(this.view[i+1]=(65280&t)>>>8,this.view[i]=255&t):(this.view[i]=(65280&t)>>>8,this.view[i+1]=255&t),e&&(this.offset+=2),this},e.writeUInt16=e.writeUint16,e.readUint16=function(t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+2) <= "+this.buffer.byteLength)}var e=0;return this.littleEndian?(e=this.view[t],e|=this.view[t+1]<<8):(e=this.view[t]<<8,e|=this.view[t+1]),i&&(this.offset+=2),e},e.readUInt16=e.readUint16,e.writeInt32=function(t,i){var e=void 0===i;if(e&&(i=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t|=0,"number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}i+=4;var n=this.buffer.byteLength;return i>n&&this.resize((n*=2)>i?n:i),i-=4,this.littleEndian?(this.view[i+3]=t>>>24&255,this.view[i+2]=t>>>16&255,this.view[i+1]=t>>>8&255,this.view[i]=255&t):(this.view[i]=t>>>24&255,this.view[i+1]=t>>>16&255,this.view[i+2]=t>>>8&255,this.view[i+3]=255&t),e&&(this.offset+=4),this},e.writeInt=e.writeInt32,e.readInt32=function(t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+4) <= "+this.buffer.byteLength)}var e=0;return this.littleEndian?(e=this.view[t+2]<<16,e|=this.view[t+1]<<8,e|=this.view[t],e+=this.view[t+3]<<24>>>0):(e=this.view[t+1]<<16,e|=this.view[t+2]<<8,e|=this.view[t+3],e+=this.view[t]<<24>>>0),e|=0,i&&(this.offset+=4),e},e.readInt=e.readInt32,e.writeUint32=function(t,i){var e=void 0===i;if(e&&(i=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t>>>=0,"number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}i+=4;var n=this.buffer.byteLength;return i>n&&this.resize((n*=2)>i?n:i),i-=4,this.littleEndian?(this.view[i+3]=t>>>24&255,this.view[i+2]=t>>>16&255,this.view[i+1]=t>>>8&255,this.view[i]=255&t):(this.view[i]=t>>>24&255,this.view[i+1]=t>>>16&255,this.view[i+2]=t>>>8&255,this.view[i+3]=255&t),e&&(this.offset+=4),this},e.writeUInt32=e.writeUint32,e.readUint32=function(t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+4) <= "+this.buffer.byteLength)}var e=0;return this.littleEndian?(e=this.view[t+2]<<16,e|=this.view[t+1]<<8,e|=this.view[t],e+=this.view[t+3]<<24>>>0):(e=this.view[t+1]<<16,e|=this.view[t+2]<<8,e|=this.view[t+3],e+=this.view[t]<<24>>>0),i&&(this.offset+=4),e},e.readUInt32=e.readUint32,t&&(e.writeInt64=function(i,e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"==typeof i)i=t.fromNumber(i);else if("string"==typeof i)i=t.fromString(i);else if(!(i&&i instanceof t))throw TypeError("Illegal value: "+i+" (not an integer or Long)");if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}"number"==typeof i?i=t.fromNumber(i):"string"==typeof i&&(i=t.fromString(i)),e+=8;var r=this.buffer.byteLength;e>r&&this.resize((r*=2)>e?r:e),e-=8;var s=i.low,o=i.high;return this.littleEndian?(this.view[e+3]=s>>>24&255,this.view[e+2]=s>>>16&255,this.view[e+1]=s>>>8&255,this.view[e]=255&s,e+=4,this.view[e+3]=o>>>24&255,this.view[e+2]=o>>>16&255,this.view[e+1]=o>>>8&255,this.view[e]=255&o):(this.view[e]=o>>>24&255,this.view[e+1]=o>>>16&255,this.view[e+2]=o>>>8&255,this.view[e+3]=255&o,e+=4,this.view[e]=s>>>24&255,this.view[e+1]=s>>>16&255,this.view[e+2]=s>>>8&255,this.view[e+3]=255&s),n&&(this.offset+=8),this},e.writeLong=e.writeInt64,e.readInt64=function(i){var e=void 0===i;if(e&&(i=this.offset),!this.noAssert){if("number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+8) <= "+this.buffer.byteLength)}var n=0,r=0;this.littleEndian?(n=this.view[i+2]<<16,n|=this.view[i+1]<<8,n|=this.view[i],n+=this.view[i+3]<<24>>>0,i+=4,r=this.view[i+2]<<16,r|=this.view[i+1]<<8,r|=this.view[i],r+=this.view[i+3]<<24>>>0):(r=this.view[i+1]<<16,r|=this.view[i+2]<<8,r|=this.view[i+3],r+=this.view[i]<<24>>>0,i+=4,n=this.view[i+1]<<16,n|=this.view[i+2]<<8,n|=this.view[i+3],n+=this.view[i]<<24>>>0);var s=new t(n,r,!1);return e&&(this.offset+=8),s},e.readLong=e.readInt64,e.writeUint64=function(i,e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"==typeof i)i=t.fromNumber(i);else if("string"==typeof i)i=t.fromString(i);else if(!(i&&i instanceof t))throw TypeError("Illegal value: "+i+" (not an integer or Long)");if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}"number"==typeof i?i=t.fromNumber(i):"string"==typeof i&&(i=t.fromString(i)),e+=8;var r=this.buffer.byteLength;e>r&&this.resize((r*=2)>e?r:e),e-=8;var s=i.low,o=i.high;return this.littleEndian?(this.view[e+3]=s>>>24&255,this.view[e+2]=s>>>16&255,this.view[e+1]=s>>>8&255,this.view[e]=255&s,e+=4,this.view[e+3]=o>>>24&255,this.view[e+2]=o>>>16&255,this.view[e+1]=o>>>8&255,this.view[e]=255&o):(this.view[e]=o>>>24&255,this.view[e+1]=o>>>16&255,this.view[e+2]=o>>>8&255,this.view[e+3]=255&o,e+=4,this.view[e]=s>>>24&255,this.view[e+1]=s>>>16&255,this.view[e+2]=s>>>8&255,this.view[e+3]=255&s),n&&(this.offset+=8),this},e.writeUInt64=e.writeUint64,e.readUint64=function(i){var e=void 0===i;if(e&&(i=this.offset),!this.noAssert){if("number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+8) <= "+this.buffer.byteLength)}var n=0,r=0;this.littleEndian?(n=this.view[i+2]<<16,n|=this.view[i+1]<<8,n|=this.view[i],n+=this.view[i+3]<<24>>>0,i+=4,r=this.view[i+2]<<16,r|=this.view[i+1]<<8,r|=this.view[i],r+=this.view[i+3]<<24>>>0):(r=this.view[i+1]<<16,r|=this.view[i+2]<<8,r|=this.view[i+3],r+=this.view[i]<<24>>>0,i+=4,n=this.view[i+1]<<16,n|=this.view[i+2]<<8,n|=this.view[i+3],n+=this.view[i]<<24>>>0);var s=new t(n,r,!0);return e&&(this.offset+=8),s},e.readUInt64=e.readUint64),e.writeFloat32=function(t,i){var e=void 0===i;if(e&&(i=this.offset),!this.noAssert){if("number"!=typeof t)throw TypeError("Illegal value: "+t+" (not a number)");if("number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}i+=4;var n=this.buffer.byteLength;return i>n&&this.resize((n*=2)>i?n:i),i-=4,u(this.view,t,i,this.littleEndian,23,4),e&&(this.offset+=4),this},e.writeFloat=e.writeFloat32,e.readFloat32=function(t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+4) <= "+this.buffer.byteLength)}var e=a(this.view,t,this.littleEndian,23,4);return i&&(this.offset+=4),e},e.readFloat=e.readFloat32,e.writeFloat64=function(t,i){var e=void 0===i;if(e&&(i=this.offset),!this.noAssert){if("number"!=typeof t)throw TypeError("Illegal value: "+t+" (not a number)");if("number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}i+=8;var n=this.buffer.byteLength;return i>n&&this.resize((n*=2)>i?n:i),i-=8,u(this.view,t,i,this.littleEndian,52,8),e&&(this.offset+=8),this},e.writeDouble=e.writeFloat64,e.readFloat64=function(t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+8) <= "+this.buffer.byteLength)}var e=a(this.view,t,this.littleEndian,52,8);return i&&(this.offset+=8),e},e.readDouble=e.readFloat64,i.MAX_VARINT32_BYTES=5,i.calculateVarint32=function(t){return(t>>>=0)<128?1:t<16384?2:t<1<<21?3:t<1<<28?4:5},i.zigZagEncode32=function(t){return((t|=0)<<1^t>>31)>>>0},i.zigZagDecode32=function(t){return t>>>1^-(1&t)|0},e.writeVarint32=function(t,e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t|=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}var r,s=i.calculateVarint32(t);e+=s;var o=this.buffer.byteLength;for(e>o&&this.resize((o*=2)>e?o:e),e-=s,t>>>=0;t>=128;)r=127&t|128,this.view[e++]=r,t>>>=7;return this.view[e++]=t,n?(this.offset=e,this):s},e.writeVarint32ZigZag=function(t,e){return this.writeVarint32(i.zigZagEncode32(t),e)},e.readVarint32=function(t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var e,n=0,r=0;do{if(!this.noAssert&&t>this.limit){var s=Error("Truncated");throw s.truncated=!0,s}e=this.view[t++],n<5&&(r|=(127&e)<<7*n),++n}while(0!=(128&e));return r|=0,i?(this.offset=t,r):{value:r,length:n}},e.readVarint32ZigZag=function(t){var e=this.readVarint32(t);return"object"==typeof e?e.value=i.zigZagDecode32(e.value):e=i.zigZagDecode32(e),e},t&&(i.MAX_VARINT64_BYTES=10,i.calculateVarint64=function(i){"number"==typeof i?i=t.fromNumber(i):"string"==typeof i&&(i=t.fromString(i));var e=i.toInt()>>>0,n=i.shiftRightUnsigned(28).toInt()>>>0,r=i.shiftRightUnsigned(56).toInt()>>>0;return 0==r?0==n?e<16384?e<128?1:2:e<1<<21?3:4:n<16384?n<128?5:6:n<1<<21?7:8:r<128?9:10},i.zigZagEncode64=function(i){return"number"==typeof i?i=t.fromNumber(i,!1):"string"==typeof i?i=t.fromString(i,!1):!1!==i.unsigned&&(i=i.toSigned()),i.shiftLeft(1).xor(i.shiftRight(63)).toUnsigned()},i.zigZagDecode64=function(i){return"number"==typeof i?i=t.fromNumber(i,!1):"string"==typeof i?i=t.fromString(i,!1):!1!==i.unsigned&&(i=i.toSigned()),i.shiftRightUnsigned(1).xor(i.and(t.ONE).toSigned().negate()).toSigned()},e.writeVarint64=function(e,n){var r=void 0===n;if(r&&(n=this.offset),!this.noAssert){if("number"==typeof e)e=t.fromNumber(e);else if("string"==typeof e)e=t.fromString(e);else if(!(e&&e instanceof t))throw TypeError("Illegal value: "+e+" (not an integer or Long)");if("number"!=typeof n||n%1!=0)throw TypeError("Illegal offset: "+n+" (not an integer)");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+n+" (+0) <= "+this.buffer.byteLength)}"number"==typeof e?e=t.fromNumber(e,!1):"string"==typeof e?e=t.fromString(e,!1):!1!==e.unsigned&&(e=e.toSigned());var s=i.calculateVarint64(e),o=e.toInt()>>>0,a=e.shiftRightUnsigned(28).toInt()>>>0,u=e.shiftRightUnsigned(56).toInt()>>>0;n+=s;var h=this.buffer.byteLength;switch(n>h&&this.resize((h*=2)>n?h:n),n-=s,s){case 10:this.view[n+9]=u>>>7&1;case 9:this.view[n+8]=9!==s?128|u:127&u;case 8:this.view[n+7]=8!==s?a>>>21|128:a>>>21&127;case 7:this.view[n+6]=7!==s?a>>>14|128:a>>>14&127;case 6:this.view[n+5]=6!==s?a>>>7|128:a>>>7&127;case 5:this.view[n+4]=5!==s?128|a:127&a;case 4:this.view[n+3]=4!==s?o>>>21|128:o>>>21&127;case 3:this.view[n+2]=3!==s?o>>>14|128:o>>>14&127;case 2:this.view[n+1]=2!==s?o>>>7|128:o>>>7&127;case 1:this.view[n]=1!==s?128|o:127&o}return r?(this.offset+=s,this):s},e.writeVarint64ZigZag=function(t,e){return this.writeVarint64(i.zigZagEncode64(t),e)},e.readVarint64=function(i){var e=void 0===i;if(e&&(i=this.offset),!this.noAssert){if("number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+1) <= "+this.buffer.byteLength)}var n=i,r=0,s=0,o=0,a=0;if(r=127&(a=this.view[i++]),128&a&&(r|=(127&(a=this.view[i++]))<<7,(128&a||this.noAssert&&void 0===a)&&(r|=(127&(a=this.view[i++]))<<14,(128&a||this.noAssert&&void 0===a)&&(r|=(127&(a=this.view[i++]))<<21,(128&a||this.noAssert&&void 0===a)&&(s=127&(a=this.view[i++]),(128&a||this.noAssert&&void 0===a)&&(s|=(127&(a=this.view[i++]))<<7,(128&a||this.noAssert&&void 0===a)&&(s|=(127&(a=this.view[i++]))<<14,(128&a||this.noAssert&&void 0===a)&&(s|=(127&(a=this.view[i++]))<<21,(128&a||this.noAssert&&void 0===a)&&(o=127&(a=this.view[i++]),(128&a||this.noAssert&&void 0===a)&&(o|=(127&(a=this.view[i++]))<<7,128&a||this.noAssert&&void 0===a))))))))))throw Error("Buffer overrun");var u=t.fromBits(r|s<<28,s>>>4|o<<24,!1);return e?(this.offset=i,u):{value:u,length:i-n}},e.readVarint64ZigZag=function(e){var n=this.readVarint64(e);return n&&n.value instanceof t?n.value=i.zigZagDecode64(n.value):n=i.zigZagDecode64(n),n}),e.writeCString=function(t,i){var e=void 0===i;e&&(i=this.offset);var n,r=t.length;if(!this.noAssert){if("string"!=typeof t)throw TypeError("Illegal str: Not a string");for(n=0;n<r;++n)if(0===t.charCodeAt(n))throw RangeError("Illegal str: Contains NULL-characters");if("number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}r=c.calculateUTF16asUTF8(s(t))[1],i+=r+1;var o=this.buffer.byteLength;return i>o&&this.resize((o*=2)>i?o:i),i-=r+1,c.encodeUTF16toUTF8(s(t),function(t){this.view[i++]=t}.bind(this)),this.view[i++]=0,e?(this.offset=i,this):r},e.readCString=function(t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var e,n=t,r=-1;return c.decodeUTF8toUTF16(function(){if(0===r)return null;if(t>=this.limit)throw RangeError("Illegal range: Truncated data, "+t+" < "+this.limit);return 0===(r=this.view[t++])?null:r}.bind(this),e=o(),!0),i?(this.offset=t,e()):{string:e(),length:t-n}},e.writeIString=function(t,i){var e=void 0===i;if(e&&(i=this.offset),!this.noAssert){if("string"!=typeof t)throw TypeError("Illegal str: Not a string");if("number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}var n,r=i;n=c.calculateUTF16asUTF8(s(t),this.noAssert)[1],i+=4+n;var o=this.buffer.byteLength;if(i>o&&this.resize((o*=2)>i?o:i),i-=4+n,this.littleEndian?(this.view[i+3]=n>>>24&255,this.view[i+2]=n>>>16&255,this.view[i+1]=n>>>8&255,this.view[i]=255&n):(this.view[i]=n>>>24&255,this.view[i+1]=n>>>16&255,this.view[i+2]=n>>>8&255,this.view[i+3]=255&n),i+=4,c.encodeUTF16toUTF8(s(t),function(t){this.view[i++]=t}.bind(this)),i!==r+4+n)throw RangeError("Illegal range: Truncated data, "+i+" == "+(i+4+n));return e?(this.offset=i,this):i-r},e.readIString=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+4) <= "+this.buffer.byteLength)}var n=t,r=this.readUint32(t),s=this.readUTF8String(r,i.METRICS_BYTES,t+=4);return t+=s.length,e?(this.offset=t,s.string):{string:s.string,length:t-n}},i.METRICS_CHARS="c",i.METRICS_BYTES="b",e.writeUTF8String=function(t,i){var e,n=void 0===i;if(n&&(i=this.offset),!this.noAssert){if("number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}var r=i;e=c.calculateUTF16asUTF8(s(t))[1],i+=e;var o=this.buffer.byteLength;return i>o&&this.resize((o*=2)>i?o:i),i-=e,c.encodeUTF16toUTF8(s(t),function(t){this.view[i++]=t}.bind(this)),n?(this.offset=i,this):i-r},e.writeString=e.writeUTF8String,i.calculateUTF8Chars=function(t){return c.calculateUTF16asUTF8(s(t))[0]},i.calculateUTF8Bytes=function(t){return c.calculateUTF16asUTF8(s(t))[1]},i.calculateString=i.calculateUTF8Bytes,e.readUTF8String=function(t,e,n){"number"==typeof e&&(n=e,e=void 0);var r=void 0===n;if(r&&(n=this.offset),void 0===e&&(e=i.METRICS_CHARS),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal length: "+t+" (not an integer)");if(t|=0,"number"!=typeof n||n%1!=0)throw TypeError("Illegal offset: "+n+" (not an integer)");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+n+" (+0) <= "+this.buffer.byteLength)}var s,a=0,u=n;if(e===i.METRICS_CHARS){if(s=o(),c.decodeUTF8(function(){return a<t&&n<this.limit?this.view[n++]:null}.bind(this),function(t){++a,c.UTF8toUTF16(t,s)}),a!==t)throw RangeError("Illegal range: Truncated data, "+a+" == "+t);return r?(this.offset=n,s()):{string:s(),length:n-u}}if(e===i.METRICS_BYTES){if(!this.noAssert){if("number"!=typeof n||n%1!=0)throw TypeError("Illegal offset: "+n+" (not an integer)");if((n>>>=0)<0||n+t>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+n+" (+"+t+") <= "+this.buffer.byteLength)}var h=n+t;if(c.decodeUTF8toUTF16(function(){return n<h?this.view[n++]:null}.bind(this),s=o(),this.noAssert),n!==h)throw RangeError("Illegal range: Truncated data, "+n+" == "+h);return r?(this.offset=n,s()):{string:s(),length:n-u}}throw TypeError("Unsupported metrics: "+e)},e.readString=e.readUTF8String,e.writeVString=function(t,e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("string"!=typeof t)throw TypeError("Illegal str: Not a string");if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}var r,o,a=e;r=c.calculateUTF16asUTF8(s(t),this.noAssert)[1],o=i.calculateVarint32(r),e+=o+r;var u=this.buffer.byteLength;if(e>u&&this.resize((u*=2)>e?u:e),e-=o+r,e+=this.writeVarint32(r,e),c.encodeUTF16toUTF8(s(t),function(t){this.view[e++]=t}.bind(this)),e!==a+r+o)throw RangeError("Illegal range: Truncated data, "+e+" == "+(e+r+o));return n?(this.offset=e,this):e-a},e.readVString=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var n=t,r=this.readVarint32(t),s=this.readUTF8String(r.value,i.METRICS_BYTES,t+=r.length);return t+=s.length,e?(this.offset=t,s.string):{string:s.string,length:t-n}},e.append=function(t,e,n){"number"!=typeof e&&"string"==typeof e||(n=e,e=void 0);var r=void 0===n;if(r&&(n=this.offset),!this.noAssert){if("number"!=typeof n||n%1!=0)throw TypeError("Illegal offset: "+n+" (not an integer)");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+n+" (+0) <= "+this.buffer.byteLength)}t instanceof i||(t=i.wrap(t,e));var s=t.limit-t.offset;if(s<=0)return this;n+=s;var o=this.buffer.byteLength;return n>o&&this.resize((o*=2)>n?o:n),n-=s,this.view.set(t.view.subarray(t.offset,t.limit),n),t.offset+=s,r&&(this.offset+=s),this},e.appendTo=function(t,i){return t.append(this,i),this},e.assert=function(t){return this.noAssert=!t,this},e.capacity=function(){return this.buffer.byteLength},e.clear=function(){return this.offset=0,this.limit=this.buffer.byteLength,this.markedOffset=-1,this},e.clone=function(t){var e=new i(0,this.littleEndian,this.noAssert);return t?(e.buffer=new ArrayBuffer(this.buffer.byteLength),e.view=new Uint8Array(e.buffer)):(e.buffer=this.buffer,e.view=this.view),e.offset=this.offset,e.markedOffset=this.markedOffset,e.limit=this.limit,e},e.compact=function(t,i){if(void 0===t&&(t=this.offset),void 0===i&&(i=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof i||i%1!=0)throw TypeError("Illegal end: Not an integer");if(i>>>=0,t<0||t>i||i>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+i+" <= "+this.buffer.byteLength)}if(0===t&&i===this.buffer.byteLength)return this;var e=i-t;if(0===e)return this.buffer=n,this.view=null,this.markedOffset>=0&&(this.markedOffset-=t),this.offset=0,this.limit=0,this;var r=new ArrayBuffer(e),s=new Uint8Array(r);return s.set(this.view.subarray(t,i)),this.buffer=r,this.view=s,this.markedOffset>=0&&(this.markedOffset-=t),this.offset=0,this.limit=e,this},e.copy=function(t,e){if(void 0===t&&(t=this.offset),void 0===e&&(e=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal end: Not an integer");if(e>>>=0,t<0||t>e||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}if(t===e)return new i(0,this.littleEndian,this.noAssert);var n=e-t,r=new i(n,this.littleEndian,this.noAssert);return r.offset=0,r.limit=n,r.markedOffset>=0&&(r.markedOffset-=t),this.copyTo(r,0,t,e),r},e.copyTo=function(t,e,n,r){var s,o;if(!this.noAssert&&!i.isByteBuffer(t))throw TypeError("Illegal target: Not a ByteBuffer");if(e=(o=void 0===e)?t.offset:0|e,n=(s=void 0===n)?this.offset:0|n,r=void 0===r?this.limit:0|r,e<0||e>t.buffer.byteLength)throw RangeError("Illegal target range: 0 <= "+e+" <= "+t.buffer.byteLength);if(n<0||r>this.buffer.byteLength)throw RangeError("Illegal source range: 0 <= "+n+" <= "+this.buffer.byteLength);var a=r-n;return 0===a?t:(t.ensureCapacity(e+a),t.view.set(this.view.subarray(n,r),e),s&&(this.offset+=a),o&&(t.offset+=a),this)},e.ensureCapacity=function(t){var i=this.buffer.byteLength;return i<t?this.resize((i*=2)>t?i:t):this},e.fill=function(t,i,e){var n=void 0===i;if(n&&(i=this.offset),"string"==typeof t&&t.length>0&&(t=t.charCodeAt(0)),void 0===i&&(i=this.offset),void 0===e&&(e=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t|=0,"number"!=typeof i||i%1!=0)throw TypeError("Illegal begin: Not an integer");if(i>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal end: Not an integer");if(e>>>=0,i<0||i>e||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+i+" <= "+e+" <= "+this.buffer.byteLength)}if(i>=e)return this;for(;i<e;)this.view[i++]=t;return n&&(this.offset=i),this},e.flip=function(){return this.limit=this.offset,this.offset=0,this},e.mark=function(t){if(t=void 0===t?this.offset:t,!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}return this.markedOffset=t,this},e.order=function(t){if(!this.noAssert&&"boolean"!=typeof t)throw TypeError("Illegal littleEndian: Not a boolean");return this.littleEndian=!!t,this},e.LE=function(t){return this.littleEndian=void 0===t||!!t,this},e.BE=function(t){return this.littleEndian=void 0!==t&&!t,this},e.prepend=function(t,e,n){"number"!=typeof e&&"string"==typeof e||(n=e,e=void 0);var r=void 0===n;if(r&&(n=this.offset),!this.noAssert){if("number"!=typeof n||n%1!=0)throw TypeError("Illegal offset: "+n+" (not an integer)");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+n+" (+0) <= "+this.buffer.byteLength)}t instanceof i||(t=i.wrap(t,e));var s=t.limit-t.offset;if(s<=0)return this;var o=s-n;if(o>0){var a=new ArrayBuffer(this.buffer.byteLength+o),u=new Uint8Array(a);u.set(this.view.subarray(n,this.buffer.byteLength),s),this.buffer=a,this.view=u,this.offset+=o,this.markedOffset>=0&&(this.markedOffset+=o),this.limit+=o,n+=o}else new Uint8Array(this.buffer);return this.view.set(t.view.subarray(t.offset,t.limit),n-s),t.offset=t.limit,r&&(this.offset-=s),this},e.prependTo=function(t,i){return t.prepend(this,i),this},e.printDebug=function(t){"function"!=typeof t&&(t=console.log.bind(console)),t(this.toString()+"\n-------------------------------------------------------------------\n"+this.toDebug(!0))},e.remaining=function(){return this.limit-this.offset},e.reset=function(){return this.markedOffset>=0?(this.offset=this.markedOffset,this.markedOffset=-1):this.offset=0,this},e.resize=function(t){if(!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal capacity: "+t+" (not an integer)");if((t|=0)<0)throw RangeError("Illegal capacity: 0 <= "+t)}if(this.buffer.byteLength<t){var i=new ArrayBuffer(t),e=new Uint8Array(i);e.set(this.view),this.buffer=i,this.view=e}return this},e.reverse=function(t,i){if(void 0===t&&(t=this.offset),void 0===i&&(i=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof i||i%1!=0)throw TypeError("Illegal end: Not an integer");if(i>>>=0,t<0||t>i||i>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+i+" <= "+this.buffer.byteLength)}return t===i?this:(Array.prototype.reverse.call(this.view.subarray(t,i)),this)},e.skip=function(t){if(!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal length: "+t+" (not an integer)");t|=0}var i=this.offset+t;if(!this.noAssert&&(i<0||i>this.buffer.byteLength))throw RangeError("Illegal length: 0 <= "+this.offset+" + "+t+" <= "+this.buffer.byteLength);return this.offset=i,this},e.slice=function(t,i){if(void 0===t&&(t=this.offset),void 0===i&&(i=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof i||i%1!=0)throw TypeError("Illegal end: Not an integer");if(i>>>=0,t<0||t>i||i>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+i+" <= "+this.buffer.byteLength)}var e=this.clone();return e.offset=t,e.limit=i,e},e.toBuffer=function(t){var i=this.offset,e=this.limit;if(!this.noAssert){if("number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: Not an integer");if(i>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal limit: Not an integer");if(e>>>=0,i<0||i>e||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+i+" <= "+e+" <= "+this.buffer.byteLength)}if(!t&&0===i&&e===this.buffer.byteLength)return this.buffer;if(i===e)return n;var r=new ArrayBuffer(e-i);return new Uint8Array(r).set(new Uint8Array(this.buffer).subarray(i,e),0),r},e.toArrayBuffer=e.toBuffer,e.toString=function(t,i,e){if(void 0===t)return"ByteBufferAB(offset="+this.offset+",markedOffset="+this.markedOffset+",limit="+this.limit+",capacity="+this.capacity()+")";switch("number"==typeof t&&(e=i=t="utf8"),t){case"utf8":return this.toUTF8(i,e);case"base64":return this.toBase64(i,e);case"hex":return this.toHex(i,e);case"binary":return this.toBinary(i,e);case"debug":return this.toDebug();case"columns":return this.toColumns();default:throw Error("Unsupported encoding: "+t)}};var h=function(){for(var t={},i=[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,43,47],e=[],n=0,r=i.length;n<r;++n)e[i[n]]=n;return t.encode=function(t,e){for(var n,r;null!==(n=t());)e(i[n>>2&63]),r=(3&n)<<4,null!==(n=t())?(e(i[63&((r|=n>>4&15)|n>>4&15)]),r=(15&n)<<2,null!==(n=t())?(e(i[63&(r|n>>6&3)]),e(i[63&n])):(e(i[63&r]),e(61))):(e(i[63&r]),e(61),e(61))},t.decode=function(t,i){var n,r,s;function o(t){throw Error("Illegal character code: "+t)}for(;null!==(n=t());)if(void 0===(r=e[n])&&o(n),null!==(n=t())&&(void 0===(s=e[n])&&o(n),i(r<<2>>>0|(48&s)>>4),null!==(n=t()))){if(void 0===(r=e[n])){if(61===n)break;o(n)}if(i((15&s)<<4>>>0|(60&r)>>2),null!==(n=t())){if(void 0===(s=e[n])){if(61===n)break;o(n)}i((3&r)<<6>>>0|s)}}},t.test=function(t){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(t)},t}();e.toBase64=function(t,i){if(void 0===t&&(t=this.offset),void 0===i&&(i=this.limit),i|=0,(t|=0)<0||i>this.capacity||t>i)throw RangeError("begin, end");var e;return h.encode(function(){return t<i?this.view[t++]:null}.bind(this),e=o()),e()},i.fromBase64=function(t,e){if("string"!=typeof t)throw TypeError("str");var n=new i(t.length/4*3,e),r=0;return h.decode(s(t),function(t){n.view[r++]=t}),n.limit=r,n},i.btoa=function(t){return i.fromBinary(t).toBase64()},i.atob=function(t){return i.fromBase64(t).toBinary()},e.toBinary=function(t,i){if(void 0===t&&(t=this.offset),void 0===i&&(i=this.limit),i|=0,(t|=0)<0||i>this.capacity()||t>i)throw RangeError("begin, end");if(t===i)return"";for(var e=[],n=[];t<i;)e.push(this.view[t++]),e.length>=1024&&(n.push(String.fromCharCode.apply(String,e)),e=[]);return n.join("")+String.fromCharCode.apply(String,e)},i.fromBinary=function(t,e){if("string"!=typeof t)throw TypeError("str");for(var n,r=0,s=t.length,o=new i(s,e);r<s;){if((n=t.charCodeAt(r))>255)throw RangeError("illegal char code: "+n);o.view[r++]=n}return o.limit=s,o},e.toDebug=function(t){for(var i,e=-1,n=this.buffer.byteLength,r="",s="",o="";e<n;){if(-1!==e&&(r+=(i=this.view[e])<16?"0"+i.toString(16).toUpperCase():i.toString(16).toUpperCase(),t&&(s+=i>32&&i<127?String.fromCharCode(i):".")),++e,t&&e>0&&e%16==0&&e!==n){for(;r.length<51;)r+=" ";o+=r+s+"\n",r=s=""}e===this.offset&&e===this.limit?r+=e===this.markedOffset?"!":"|":e===this.offset?r+=e===this.markedOffset?"[":"<":e===this.limit?r+=e===this.markedOffset?"]":">":r+=e===this.markedOffset?"'":t||0!==e&&e!==n?" ":""}if(t&&" "!==r){for(;r.length<51;)r+=" ";o+=r+s+"\n"}return t?o:r},i.fromDebug=function(t,e,n){for(var r,s,o=t.length,a=new i((o+1)/3|0,e,n),u=0,h=0,c=!1,f=!1,l=!1,d=!1,p=!1;u<o;){switch(r=t.charAt(u++)){case"!":if(!n){if(f||l||d){p=!0;break}f=l=d=!0}a.offset=a.markedOffset=a.limit=h,c=!1;break;case"|":if(!n){if(f||d){p=!0;break}f=d=!0}a.offset=a.limit=h,c=!1;break;case"[":if(!n){if(f||l){p=!0;break}f=l=!0}a.offset=a.markedOffset=h,c=!1;break;case"<":if(!n){if(f){p=!0;break}f=!0}a.offset=h,c=!1;break;case"]":if(!n){if(d||l){p=!0;break}d=l=!0}a.limit=a.markedOffset=h,c=!1;break;case">":if(!n){if(d){p=!0;break}d=!0}a.limit=h,c=!1;break;case"'":if(!n){if(l){p=!0;break}l=!0}a.markedOffset=h,c=!1;break;case" ":c=!1;break;default:if(!n&&c){p=!0;break}if(s=parseInt(r+t.charAt(u++),16),!n&&(isNaN(s)||s<0||s>255))throw TypeError("Illegal str: Not a debug encoded string");a.view[h++]=s,c=!0}if(p)throw TypeError("Illegal str: Invalid symbol at "+u)}if(!n){if(!f||!d)throw TypeError("Illegal str: Missing offset or limit");if(h<a.buffer.byteLength)throw TypeError("Illegal str: Not a debug encoded string (is it hex?) "+h+" < "+o)}return a},e.toHex=function(t,i){if(t=void 0===t?this.offset:t,i=void 0===i?this.limit:i,!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof i||i%1!=0)throw TypeError("Illegal end: Not an integer");if(i>>>=0,t<0||t>i||i>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+i+" <= "+this.buffer.byteLength)}for(var e,n=new Array(i-t);t<i;)(e=this.view[t++])<16?n.push("0",e.toString(16)):n.push(e.toString(16));return n.join("")},i.fromHex=function(t,e,n){if(!n){if("string"!=typeof t)throw TypeError("Illegal str: Not a string");if(t.length%2!=0)throw TypeError("Illegal str: Length not a multiple of 2")}for(var r,s=t.length,o=new i(s/2|0,e),a=0,u=0;a<s;a+=2){if(r=parseInt(t.substring(a,a+2),16),!n&&(!isFinite(r)||r<0||r>255))throw TypeError("Illegal str: Contains non-hex characters");o.view[u++]=r}return o.limit=u,o};var c=function(){var t={MAX_CODEPOINT:1114111,encodeUTF8:function(t,i){var e=null;for("number"==typeof t&&(e=t,t=function(){return null});null!==e||null!==(e=t());)e<128?i(127&e):e<2048?(i(e>>6&31|192),i(63&e|128)):e<65536?(i(e>>12&15|224),i(e>>6&63|128),i(63&e|128)):(i(e>>18&7|240),i(e>>12&63|128),i(e>>6&63|128),i(63&e|128)),e=null},decodeUTF8:function(t,i){for(var e,n,r,s,o=function(t){t=t.slice(0,t.indexOf(null));var i=Error(t.toString());throw i.name="TruncatedError",i.bytes=t,i};null!==(e=t());)if(0==(128&e))i(e);else if(192==(224&e))null===(n=t())&&o([e,n]),i((31&e)<<6|63&n);else if(224==(240&e))(null===(n=t())||null===(r=t()))&&o([e,n,r]),i((15&e)<<12|(63&n)<<6|63&r);else{if(240!=(248&e))throw RangeError("Illegal starting byte: "+e);(null===(n=t())||null===(r=t())||null===(s=t()))&&o([e,n,r,s]),i((7&e)<<18|(63&n)<<12|(63&r)<<6|63&s)}},UTF16toUTF8:function(t,i){for(var e,n=null;null!==(e=null!==n?n:t());)e>=55296&&e<=57343&&null!==(n=t())&&n>=56320&&n<=57343?(i(1024*(e-55296)+n-56320+65536),n=null):i(e);null!==n&&i(n)},UTF8toUTF16:function(t,i){var e=null;for("number"==typeof t&&(e=t,t=function(){return null});null!==e||null!==(e=t());)e<=65535?i(e):(i(55296+((e-=65536)>>10)),i(e%1024+56320)),e=null},encodeUTF16toUTF8:function(i,e){t.UTF16toUTF8(i,function(i){t.encodeUTF8(i,e)})},decodeUTF8toUTF16:function(i,e){t.decodeUTF8(i,function(i){t.UTF8toUTF16(i,e)})},calculateCodePoint:function(t){return t<128?1:t<2048?2:t<65536?3:4},calculateUTF8:function(t){for(var i,e=0;null!==(i=t());)e+=i<128?1:i<2048?2:i<65536?3:4;return e},calculateUTF16asUTF8:function(i){var e=0,n=0;return t.UTF16toUTF8(i,function(t){++e,n+=t<128?1:t<2048?2:t<65536?3:4}),[e,n]}};return t}();return e.toUTF8=function(t,i){if(void 0===t&&(t=this.offset),void 0===i&&(i=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof i||i%1!=0)throw TypeError("Illegal end: Not an integer");if(i>>>=0,t<0||t>i||i>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+i+" <= "+this.buffer.byteLength)}var e;try{c.decodeUTF8toUTF16(function(){return t<i?this.view[t++]:null}.bind(this),e=o())}catch(e){if(t!==i)throw RangeError("Illegal range: Truncated data, "+t+" != "+i)}return e()},i.fromUTF8=function(t,e,n){if(!n&&"string"!=typeof t)throw TypeError("Illegal str: Not a string");var r=new i(c.calculateUTF16asUTF8(s(t),!0)[1],e,n),o=0;return c.encodeUTF16toUTF8(s(t),function(t){r.view[o++]=t}),r.limit=o,r},i},r=[e(28)],void 0===(s="function"==typeof(n=o)?n.apply(i,r):n)||(t.exports=s)},function(t,i,e){var n;void 0===(n=function(){"use strict";return{level:{TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,FATAL:5}}}.apply(i,[]))||(t.exports=n)},function(t,i,e){var n,r;n=[e(48),e(47),e(20)],void 0===(r=function(t,i,e){return{MQWebSocket:t,BatchHttpProto:i,MQService:e}}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(0),e(1),e(7),e(3),e(60),e(5),e(58),e(57),e(56),e(79),e(80),e(25),e(8),e(77),e(76),e(75),e(24),e(71),e(66),e(69),e(6),e(2),e(64)],void 0===(r=function(t,i,e,n,r,s,o,a,u,h,c,f,l,d,p,m,v,g,y,w,b,E,I){"use strict";var k="2018-04-10T16:20:23Z";function T(s){s=s||{},i.isObject(s,"options"),s.streamingSourceMapping&&(i.isObject(s.streamingSourceMapping,"options.streamingSourceMapping"),i.isStringNotEmpty(s.streamingSourceMapping.replacement,"options.streamingSourceMapping.replacement"),s.streamingSourceMapping.patternToReplace instanceof RegExp||i.isStringNotEmpty(s.streamingSourceMapping.patternToReplace,"options.streamingSourceMapping.patternToReplace")),t.isNullOrUndefined(s.disableMultiplePCastInstanceWarning)||i.isBoolean(s.disableMultiplePCastInstanceWarning,"options.disableMultiplePCastInstanceWarning"),this.P=new e.Observable("offline"),this.j=s.uri||u.DefaultPCastUri,this.U=s.deviceId||"",this.b=k,this.R=s.logger||r.createPCastLogger(this.j,s.disableConsoleLogging),this.D=s.metricsTransmitter||d.createMetricsTransmitter(this.j),this.F=new h(s,this.R),this.L=s.shaka,this.B=s.videojs||E.global.videojs,this.V="offline",this.W=s.streamingSourceMapping,this.z=new n.DisposableList,this._=s.disableMultiplePCastInstanceWarning,this.H=!0;var o=this;t.addEventListener(E.global,"unload",function(){return o.R.info("Window Unload Event Triggered"),o.stop()}),s.disableBeforeUnload||t.addEventListener(E.global,"beforeunload",function(){return o.R.info("Window Before Unload Event Triggered"),o.stop()}),E.webrtcSupported||"ReactNative"!==E.browser||E.shim(),E.webrtcSupported&&(function(){var t=this,i=new E.RTCPeerConnection;"Safari"===E.browser&&E.browserVersion>10&&(i.addTransceiver("audio"),i.addTransceiver("video"));i.createOffer(function(i){var e=I.getH264ProfileId(i.sdp);if(!e)return t.R.info("Unable to find local h264 profile level id");t.R.info("Found local h264 profile level id [%s]",e,i.sdp),t.$=e},function(i){t.R.error("Unable to create offer to get local h264 profile level id",i)},{offerToReceiveAudio:!0,offerToReceiveVideo:!0})}.call(this),D.call(this))}function S(){if(O.call(this)&&"offline"===this.P.getValue())return this.R.warn("[PCast] connected after being offline. Going offline."),V.call(this,"critical-network-issue"),this.stop();var t=this;this.G=!0,t.Q||t.J.authenticate(t.K,function(i,e){t.X&&(i?(t.R.error("Failed to authenticate [%s]",i),V.call(t,"unauthorized"),t.X.call(t,t,"unauthorized","")):"ok"!==e.status?(t.R.warn("Failed to authenticate, status [%s]",e.status),V.call(t,"unauthorized"),t.X.call(t,t,"unauthorized","")):(V.call(t,"online"),t.X.call(t,t,e.status,e.sessionId)))})}function R(){V.call(this,"reconnecting")}function x(){V.call(this,"reconnected"),this.R.info("Attempting to re-authenticate after reconnect event"),function(){var t=this;t.Q||t.J.authenticate(t.K,function(i,e){var n=!0===t.G;if(i)return t.R.error("Unable to authenticate after reconnect to WebSocket [%s]",i),V.call(t,"reconnect-failed");if("ok"!==e.status){t.R.warn("Unable to authenticate after reconnect to WebSocket, status [%s]",e.status);var r="capacity"===e.status?e.status:"reconnect-failed";return V.call(t,r)}return t.G=!0,t.R.info("Successfully authenticated after reconnect to WebSocket"),V.call(t,"online",null,n)})}.call(this)}function C(){if(O.call(this)&&"reconnecting"===this.P.getValue())return this.R.warn("[PCast] disconnected after attempting to reconnect. Going offline."),V.call(this,"critical-network-issue"),this.stop();this.G=!1,V.call(this,"offline")}function O(){return t.reduce(this.Z,function(t,i){return t?"closed"===i.iceConnectionState:t},!0)}function M(t){switch(t){case"":case"none":case"ended":return"ended";case"server-error":case"session-error":case"not-ready":case"error":case"died":return"failed";case"censored":return"censored";case"maintenance":return"maintenance";case"capacity":return"capacity";case"app-background":return"app-background";default:return"custom"}}function A(t){var i=t.streamId,e=t.reason;return N.call(this,i,e)}function q(t){var i=t.streamId,e=t.status,n=t.reason,r=this.Y[i];r&&r.dataQualityChangedCallback(e,n);var s=this.tt[i];s&&"function"==typeof s.dataQualityChangedCallback&&s.dataQualityChangedCallback(s,e,n)}function N(t,i){this.R.info("[%s] Stream ended with reason [%s]",t,i);var e=this.Y[t];e&&e.streamEndedCallback(M(i),i,!0),delete this.Y[t];var n=this.tt[t];n&&"function"==typeof n.publisherEndedCallback&&n.publisherEndedCallback(n,M(i),i),delete this.tt[t];var r=this.Z[t];r&&W.call(this,t,r,"ended"),delete this.Z[t]}function P(i,e,n,r,s,o){var a=this;t.addEventListener(n,"addstream",function(u){if(!e.failed){var h=u.stream,c="real-time";if(!h)return e.failed=!0,a.R.warn("[%s] No remote stream",i),s.call(a,void 0,"failed");a.R.info("[%s] Got remote stream",i),r.setProperty("kind",c);var f=t.assign({networkLag:a.it},o),l=new w(i,h,n,r,f,a.R),d=new g(c,l,a.R);d.on(b.streamEvents.playerError.name,function(t,i){a.R.warn("Phenix Real-Time Stream Error [%s] [%s]",t,i),d.streamErrorCallback(c,i)}),d.on(b.streamEvents.stopped.name,function(t){e.stopped||(a.R.info("[%s] stop media stream",i),W.call(a,i,n,"stop"),a.J.destroyStream(i,t||"",function(t,e){t?a.R.error("[%s] failed to destroy stream [%s]",i,t):"ok"===e.status?a.R.info("[%s] destroyed stream",i):a.R.warn("[%s] failed to destroy stream, status [%s]",i,e.status)}),e.stopped=!0)}),a.Y[i]=d,s.call(a,l)}})}function j(i,e,n){var r=this;t.addEventListener(e,"icecandidate",function(t){var e=t.candidate;e?r.R.debug("[%s] ICE candidate: [%s] [%s] [%s]",i,e.sdpMid,e.sdpMLineIndex,e.candidate):r.R.info("[%s] ICE candidate discovery complete",i),n&&n(e)})}function U(i,e){var n=this;t.addEventListener(e,"negotiationneeded",function(t){n.R.info("[%s] Negotiation needed")}),t.addEventListener(e,"iceconnectionstatechange",function(t){n.R.info("[%s] ICE connection state changed [%s]",i,e.iceConnectionState)}),t.addEventListener(e,"icegatheringstatechange ",function(t){n.R.info("[%s] ICE gathering state changed [%s]",i,e.iceGatheringState)}),t.addEventListener(e,"signalingstatechange",function(t){n.R.info("[%s] Signaling state changed [%s]",i,e.signalingState)}),t.addEventListener(e,"connectionstatechange",function(t){n.R.info("[%s] Connection state changed [%s]",i,e.connectionState)})}function D(i){var e=this;switch(E.browser){case"Edge":return E.getDestinations(function(n){0===t.filter(n,function(t){return"audio"===t.kind}).length?(e.H&&e.R.info("Detected no audio devices attached to machine"),e.H=!1):e.H=!0,i&&i()});default:i&&i()}}function F(i,e,n,r,s,o){if("IE"===E.browser)throw new Error("Subscribing in real-time not supported on IE without the PhenixP2P Plugin");var a=this,u={failed:!1,stopped:!1},h=n.match(/a=crypto:/i),c=n.match(/m=application /i),f=new E.RTCPeerConnection(i,{optional:[{DtlsSrtpKeyAgreement:!h},{RtpDataChannels:c}]}),l=null;if(a.Z[e]=f,"Firefox"===E.browser||"Edge"===E.browser){if(n.match(/(\nm=video)/g)&&n.match(/(\nm=audio)/g)){var d=/(a=candidate)((.|\n)*)(?=m=)/g;n=n.replace(d,n.match(d)+"a=end-of-candidates\n")}n=(n+="a=end-of-candidates").replace(/(\na=ice-options:trickle)/g,"")}"ReactNative"===E.browser&&(n=Q(n));var p=function(t){u.failed||(u.failed=!0,u.stopped=!0,delete a.Z[e],W.call(a,e,f,"failure"),s.call(a,void 0,t||"failed"))};P.call(a,e,u,f,r,s,o),j.call(a,e,f,function(t){l&&l(t)}),U.call(a,e,f);var m=new E.RTCSessionDescription({type:"offer",sdp:n});f.setRemoteDescription(m,function(){a.R.debug("Set remote description (offer)");var i={mandatory:{}};"Chrome"===E.browser||"ReactNative"===E.browser?(i.mandatory.OfferToReceiveVideo=!1!==o.receiveVideo,i.mandatory.OfferToReceiveAudio=!1!==o.receiveAudio):(i.mandatory.offerToReceiveVideo=!1!==o.receiveVideo,i.mandatory.offerToReceiveAudio=!1!==o.receiveAudio),f.createAnswer(function(i){a.R.info("Created answer [%s]",i.sdp),a.J.setAnswerDescription(e,i.sdp,function(i,n){if(i)return a.R.error("Failed to set answer description [%s]",i),p();if("ok"!==n.status)return a.R.warn("Failed to set answer description, status [%s]",n.status),p(n.status);t.includes(n.options,"ice-candidates")&&(l=function(i){var n=[];i?[].push(i):n.push("completed"),a.J.addIceCandidates(e,i,n,function(i,e){i?a.R.error("Failed to add ICE candidate [%s]",i):"ok"===e.status?t.includes(e.options,"cancel")&&(l=null):a.R.warn("Failed to add ICE candidate, status [%s]",e.status)})});var r=new E.RTCSessionDescription({type:"answer",sdp:n.sessionDescription.sdp});f.setLocalDescription(r,function(){a.R.debug("Set local description (answer)")},p)})},p,i)},p)}function L(e,n,r,s,o){var a=n.match(/a=x-playlist:([^\n]*[.]mpd\??[^\s]*)/m),u=n.match(/a=x-playlist:([^\n]*[.]m3u8\??[^\s]*)/m),h=t.get(a,[1],""),c=t.get(u,[1],"");this.W&&(h=h.replace(this.W.patternToReplace,this.W.replacement),c=c.replace(this.W.patternToReplace,this.W.replacement));var f=G()||"Safari"===E.browser;return a&&2===a.length&&!f?(o.isDrmProtectedContent=/[?&]drmToken=([^&]*)/.test(a[1])||/x-widevine-service-certificate/.test(n),o.isDrmProtectedContent&&(o.widevineServiceCertificateUrl=n.match(/a=x-widevine-service-certificate:([^\n][^\s]*)/m)[1],o.playreadyLicenseUrl=n.match(/a=x-playready-license-url:([^\n][^\s]*)/m)[1]),this.L&&!this.L.Player.isBrowserSupported()?(this.R.warn("[%s] Shaka does not support this browser",e),s.call(this,void 0,"browser-unsupported")):B.call(this,e,h,b.types.dash.name,r,s,o)):u&&2===u.length&&"object"==typeof document&&"maybe"===document.createElement("video").canPlayType("application/vnd.apple.mpegURL")?(o.isDrmProtectedContent=/[?&]drmToken=([^&]*)/.test(u[1]),o.hlsTargetDuration&&(i.isNumber(o.hlsTargetDuration,"options.hlsTargetDuration"),c=c+(c.indexOf("?")>-1?"&":"?")+"targetDuration="+o.hlsTargetDuration),B.call(this,e,c,b.types.hls.name,r,s,o)):(this.R.warn("[%s] Offer does not contain a supported manifest",e,n),s.call(this,void 0,"failed"))}function B(t,i,e,n,r,s){var o=this,a=new y(e,t,i,n,s,this.L,this.R),u=new g(e,a,this.R);n.setProperty("kind",e),u.on(b.streamEvents.playerError.name,function(t,i){o.R.warn("Phenix Live Stream Player Error [%s] [%s]",t,i),u.streamErrorCallback(t,i)}),u.on(b.streamEvents.stopped.name,function(i){o.J.destroyStream(t,i||"",function(i,e){i?o.R.error("[%s] failed to destroy stream, [%s]",t,i):"ok"===e.status||o.R.warn("[%s] failed to destroy stream, status [%s]",t,e.status)})}),this.Y[t]=u,r.call(this,u.getPhenixMediaStream())}function V(t,i,e){var n,r=this.getStatus();if(r!==t&&("critical-network-issue"!==(n=r)&&"offline"!==n||"offline"!==t)){if(this.P.setValue(t),e)return;switch(t){case"connecting":case"reconnecting":case"reconnected":break;case"critical-network-issue":case"unauthorized":case"reconnect-failed":case"offline":return this.et.call(this);case"online":return this.nt.call(this)}}}function W(t,i,e){"closed"===i.signalingState||i.rt||(this.R.debug("[%s] close peer connection [%s]",t,e),i.close(),i.rt=!0)}function z(i){if(!i)return i;var e=t.isArray(i)?[]:{},n=t.bind(_,null,e);return t.isArray(i)?t.forEach(i,n):t.forOwn(i,n),e}function _(i,e,n){if(null!==e){if(t.isObject(e)||t.isArray(e))return i[n]=z(e);if(!t.isString(e)||!t.isString(n))return i[n]=e;var r=t.startsWith(e.toLowerCase(),n.toLowerCase())?e.substring(n.length,e.length).toLowerCase():e;i[n]=r}}function H(i){return"Firefox"===E.browser&&function(i){if(!i)return i;t.forEach(i.iceServers,function(i){i.urls=t.filter(i.urls,function(i){return!t.startsWith(i,"turns")})})}(i),i}T.prototype.getBaseUri=function(){return this.j},T.prototype.getStatus=function(){return this.P.getValue()},T.prototype.getObservableStatus=function(){return this.P},T.prototype.isStarted=function(){return this.st},T.prototype.reAuthenticate=function(t){if(i.isStringNotEmpty(t,"authToken"),"online"===this.P.getValue())return this.R.warn("Already authenticated. Denying request to re-authenticate");this.R.info("Attempting to re-authenticate with new auth token [%s]",t),this.K=t,x.call(this)},T.prototype.start=function(i,e,n,r){if("string"!=typeof i)throw new Error('"authToken" must be a string');if("function"!=typeof e)throw new Error('"authenticationCallback" must be a function');if("function"!=typeof n)throw new Error('"onlineCallback" must be a function');if("function"!=typeof r)throw new Error('"offlineCallback" must be a function');if(this.st)throw new Error('"Already started"');t.isNumber(E.global.ot)?E.global.ot++:E.global.ot=1,E.global.ot>1&&!this._&&this.R.warn("Avoid using multiple instances of PCast as this uses unnecessary resources and will reduce performance. This is your [%s] simultaneous instance. Remember to dispose all resources when done with them by calling .stop() or .dispose()",E.global.ot),this.Q=!1,this.st=!0,this.K=i,this.X=e,this.nt=n,this.et=r,this.at=new m(this.R,this.D),this.ut=new u(this.b,this.j,this.R,this.at),V.call(this,"connecting"),this.Z={},this.Y={},this.tt={},this.ht=[],this.z.add(this.ut),this.z.add(this.at);var s=this;s.ut.resolveUri(function(i,e){if(i){switch(s.R.error("Failed to connect to [%s]",s.j,i),V.call(s,"offline"),i.code){case 0:s.X.call(s,s,"network-unavailable","");break;case 503:s.X.call(s,s,"capacity","");break;default:s.X.call(s,s,"failed","")}return s.Q=!0,void(s.st=!1)}s.R.info("Discovered end point [%s] with RTT [%s]",e.uri,e.roundTripTime),s.it=e.roundTripTime/2,s.ct=e.uri,function(i){this.J=new a(i,this.U,this.b,this.R),this.J.onEvent("connected",t.bind(S,this)),this.J.onEvent("reconnecting",t.bind(R,this)),this.J.onEvent("reconnected",t.bind(x,this)),this.J.onEvent("disconnected",t.bind(C,this)),this.J.onEvent("pcast.StreamEnded",t.bind(A,this)),this.J.onEvent("pcast.StreamDataQuality",t.bind(q,this)),this.R.setObservableSessionId&&this.R.setObservableSessionId(this.J.getObservableSessionId());this.ft&&(this.ft.dispose(),this.at.setSessionId(null));this.ft=this.J.getObservableSessionId().subscribe(t.bind(this.at.setSessionId,this.at))}.call(s,e.uri)})},T.prototype.stop=function(){if(this.st){this.Q=!0,this.st=!1,delete this.X;try{var i=this;t.forOwn(this.Y,function(t,e){N.call(i,e,"")}),t.forOwn(this.tt,function(e,n){N.call(i,n,""),t.includes(e.getOptions(),"detached")||e.stop("",!0)}),t.forOwn(this.Z,function(t,e){N.call(i,e,"")}),t.forEach(this.ht,function(i){var e=i.getTracks();t.forEach(e,function(t){t.stop()})})}finally{this.J&&(this.J.disconnect(),this.J=null),this.R.setObservableSessionId&&this.R.setObservableSessionId(null),this.ft&&(this.ft.dispose(),this.at.setSessionId(null)),E.global.ot--,this.z.dispose()}}},T.prototype.getUserMedia=function(t,e,n){if("IE"===E.browser)throw new Error("Publishing not supported on IE");return i.isObject(t,"options"),i.isFunction(e,"callback"),n&&i.isFunction(n,"onScreenShare"),new c(this.R,this.F,n).getUserMedia(t,e)},T.prototype.publish=function(e,n,r,s,o){if("IE"===E.browser)throw new Error("Publishing not supported on IE");if(!this.st)throw new Error("PCast not started. Unable to publish. Please start pcast first.");if("string"!=typeof e)throw new Error('"streamToken" must be a string');if("object"!=typeof n&&"string"!=typeof n)throw new Error('"streamToPublish" must be an object or URI');if("function"!=typeof r)throw new Error('"callback" must be a function');if(s=s||[],!Array.isArray(s))throw new Error('"tags" must be an array');if("object"!=typeof(o=o||{}))throw new Error('"options" must be an object');var a=this,u=t.assign({},o,{negotiate:!0});"string"==typeof n?(u.negotiate=!1,u.connectUri=n):u.connectUri=o.connectUri,s.length>0&&(u.tags=s);var h=new p(this.getProtocol().getSessionId(),this.R,this.D);h.setProperty("resource","upload"),this.J.setupStream("upload",e,u,function(e,s){if(e)return a.R.error("Failed to create uploader [%s]",e),r.call(a,a,"failed");if("ok"===s.status){var c=s.createStreamResponse.streamId;if(h.setStreamId(c),h.setStartOffset(s.createStreamResponse.offset),h.recordMetric("Provisioned"),h.recordMetric("RoundTripTime",{uint64:2*a.it},null,{resource:a.ct,kind:"https"}),!0===u.negotiate){var l=s.createStreamResponse.createOfferDescriptionResponse.sessionDescription.sdp,d=H(z(s.createStreamResponse.rtcConfiguration));return function(e,n,r,s,o,a,u,h){var c=this,l={failed:!1,stopped:!1},d=s.match(/a=crypto:/i),p=s.match(/m=application /i),m=new E.RTCPeerConnection(e,{optional:[{DtlsSrtpKeyAgreement:!d},{RtpDataChannels:p}]}),g=null,y=null,w=null;if(c.Z[r]=m,m.addStream(n),"Firefox"===E.browser||"Edge"===E.browser){if(s.match(/(\nm=video)/g)&&s.match(/(\nm=audio)/g)){var b=/(a=candidate)((.|\n)*)(?=m=)/g;s=s.replace(b,s.match(b)+"a=end-of-candidates\n")}s=(s+="a=end-of-candidates").replace(/(\na=ice-options:trickle)/g,"")}var I=function(t){l.failed||(l.failed=!0,l.stopped=!0,delete c.Z[r],W.call(c,r,m,"failure"),a.call(c,void 0,t||"failed"))};P.call(c,r,l,m,o,function(t){var i=c.tt[r];g=t,i&&i.remoteMediaStreamCallback&&i.remoteMediaStreamCallback(i,t)},u),j.call(c,r,m,function(t){y&&y(t)}),U.call(c,r,m);var k=new E.RTCSessionDescription({type:"offer",sdp:s});m.setRemoteDescription(k,function(){c.R.info("Set remote description (offer)");var e={mandatory:{}};"Chrome"===E.browser||"ReactNative"===E.browser?(e.mandatory.OfferToReceiveVideo=!0===u.receiveVideo,e.mandatory.OfferToReceiveAudio=!0===u.receiveAudio):(e.mandatory.offerToReceiveVideo=!0===u.receiveVideo,e.mandatory.offerToReceiveAudio=!0===u.receiveAudio);m.createAnswer(function(e){c.R.info("Created answer [%s]",e.sdp),c.J.setAnswerDescription(r,e.sdp,function(e,o){if(e)return c.R.error("Failed to set answer description [%s]",e),I();if("ok"!==o.status)return c.R.warn("Failed to set answer description, status [%s]",o.status),I(o.status);t.includes(o.options,"ice-candidates")&&(y=function(i){var e=[],n=[];i?e.push(i):n.push("completed"),c.J.addIceCandidates(r,e,n,function(i,e){i?c.R.error("Failed to add ICE candidate [%s]",i):"ok"===e.status?t.includes(e.options,"cancel")&&(y=null):c.R.warn("Failed to add ICE candidate, status [%s]",e.status)})});var u=new E.RTCSessionDescription({type:"answer",sdp:o.sessionDescription.sdp});m.setLocalDescription(u,function(){var e=/(b=AS:([0-9]*)[\n\r]*)/gi,o=/(mid:video)([\n\r]*)/gi;c.R.info("Set local description (answer)");var u=0,d=e.exec(s);d&&d.length>=3&&(u=1e3*d[2]);var p={getStreamId:function(){return r},getStream:function(){return n},isActive:function(){return!l.stopped},hasEnded:function(){switch(m.iceConnectionState){case"new":case"checking":case"connected":case"completed":return!1;case"disconnected":case"failed":case"closed":default:return!0}},stop:function(t){l.stopped||(W.call(c,r,m,"closed"),c.J.destroyStream(r,t||"",function(t,i){t?c.R.error("[%s] failed to destroy stream [%s]",r,t):"ok"===i.status?c.R.info("[%s] destroyed stream",r):c.R.warn("[%s] failed to destroy stream, status [%s]",r,i.status)}),l.stopped=!0)},setPublisherEndedCallback:function(t){if("function"!=typeof t)throw new Error('"callback" must be a function');this.publisherEndedCallback=t},setDataQualityChangedCallback:function(t){if("function"!=typeof t)throw new Error('"callback" must be a function');this.dataQualityChangedCallback=t},limitBandwidth:function(t){if("Edge"===E.browser)return c.R.warn("Limit bandwidth not support on [%s]",E.browser);if("number"!=typeof t)throw new Error('"bandwidthLimit" must be a number');var i=u?Math.min(t,u):t,n=m.remoteDescription;c.R.info("Changing bandwidth limit to [%s]",i);var r=n.sdp.replace(e,"");r=r.replace(o,function(t,e,n,r,s){return[e,n,"b=AS:",Math.ceil(i/1e3),n].join("")});var s=new E.RTCSessionDescription({type:n.type,sdp:r});return m.setRemoteDescription(s),{dispose:function(){m.setRemoteDescription(n)}}},getMonitor:function(){return w},monitor:function(i,e){if("object"!=typeof i)throw new Error('"options" must be an object');if("function"!=typeof e)throw new Error('"callback" must be a function');var s=new f(r,m,c.R);return i.direction="outbound",s.start(i,function(){return c.tt[r]===p&&!l.stopped},function(t,i){return t&&c.R.warn("[%s] Publisher monitor triggered unrecoverable error [%s]",t),c.R.warn("[%s] Publisher triggered monitor condition for [%s]",r,i.type),e(p,"client-side-failure",i)}),t.forEach(n.getTracks(),function(i){t.addEventListener(i,"readystatechange",function(){if("ended"===i.readyState)return c.R.warn("[%s] Publisher track has failed [%s]",r,i),e(p,"camera-track-failure",{type:i.kind+"-track-ended",message:"Publisher "+i.kind+" track has ended in an unrecoverable way. This may require reconfiguring your camera or microphone."})})}),w=s,s},setRemoteMediaStreamCallback:function(t){if("function"!=typeof t)throw new Error('"callback" must be a function');this.remoteMediaStreamCallback=t,g&&t(p,g)},getOptions:function(){return h},getStats:function(t){i.isFunction(t,"callback"),this.dt||(this.dt={});var e=this;return E.getStats(m,null,function(i){t(v.convertPeerConnectionStats(i,e.dt))})}};c.tt[r]=p,a.call(c,p)},I)})},I,e)},I)}.call(a,d,n,c,l,h,function(t,i){h.recordMetric("SetupCompleted",{string:i?"failed":"ok"}),i?r.call(a,a,"failed",null):r.call(a,a,"ok",t)},o,s.createStreamResponse.options)}return function(t,i,e){var n=this,r={stopped:!1},s={getStreamId:function(){return t},getStream:function(){return n.R.debug("[%s] Unable to get stream on publisher of remote origin.",t),null},getStats:function(){return n.R.debug("[%s] Unable to get stream stats on publisher of remote origin.",t),null},isActive:function(){return!r.stopped},hasEnded:function(){return r.stopped},stop:function(i){r.stopped||(n.J.destroyStream(t,i||"",function(i,e){i?n.R.error("[%s] failed to destroy stream [%s]",t,i):"ok"===e.status?n.R.info("[%s] destroyed stream",t):n.R.warn("[%s] failed to destroy stream, status [%s]",t,e.status)}),r.stopped=!0)},setPublisherEndedCallback:function(t){if("function"!=typeof t)throw new Error('"callback" must be a function');this.publisherEndedCallback=t},setDataQualityChangedCallback:function(t){if("function"!=typeof t)throw new Error('"callback" must be a function');this.dataQualityChangedCallback=t},getOptions:function(){return e},monitor:function(t,i){if("object"!=typeof t)throw new Error('"options" must be an object');if("function"!=typeof i)throw new Error('"callback" must be a function')},getMonitor:function(){return null}};n.tt[t]=s,i(s)}.call(a,c,function(t,i){h.recordMetric("SetupCompleted",{string:i?"failed":"ok"}),i?r.call(a,a,"failed",null):r.call(a,a,"ok",t)},s.createStreamResponse.options)}switch(a.R.warn("Failed to create uploader, status [%s]",s.status),s.status){case"timeout":case"capacity":case"unauthorized":return r.call(a,a,s.status);default:return r.call(a,a,"failed")}})},T.prototype.subscribe=function(i,e,n){if(!this.st)throw new Error("PCast not started. Unable to subscribe. Please start pcast first.");if("string"!=typeof i)throw new Error('"streamToken" must be a string');if("function"!=typeof e)throw new Error('"callback" must be a function');if("object"!=typeof(n=n||{}))throw new Error('"options" must be an object');var r=this;D.call(r,function(){var s=t.assign({},n,{negotiate:!1!==n.negotiate}),o=new p(r.getProtocol().getSessionId(),r.R,r.D),a=t.assign({},{useNativeHlsPlayer:!0},n);a.canPlaybackAudio=r.H,!r.H&&n.disableAudioIfNoOutputFound&&!1!==n.receiveAudio&&(s.receiveAudio=!1,a.receiveAudio=!1,a.forcedAudioDisabled=!0),o.setProperty("resource","download"),r.J.setupStream("download",i,s,function(i,n){if(i)return r.R.error("Failed to create downloader [%s]",i),e.call(r,r,"failed");if("ok"===n.status){var s=n.createStreamResponse.streamId,u=n.createStreamResponse.createOfferDescriptionResponse.sessionDescription.sdp,h=H(z(n.createStreamResponse.rtcConfiguration)),c=t.bind(F,r,h);if(u.match(/a=x-playlist:/)&&(c=L),o.setStreamId(s),o.setStartOffset(n.createStreamResponse.offset),o.recordMetric("Provisioned"),o.recordMetric("RoundTripTime",{uint64:2*r.it},null,{resource:r.getBaseUri(),kind:"https"}),a.originStartTime=t.now()-n.createStreamResponse.offset+r.it,"Chrome"===E.browser&&E.browserVersion>=62&&r.$&&$()){var f=I.getH264ProfileId(u);f!==r.$&&(r.R.info("[%s] Replacing h264 profile level id [%s] with new value [%s] in offer sdp",s,f,r.$),u=I.replaceH264ProfileId(u,r.$))}return c.call(r,s,u,o,function(t,i){o.recordMetric("SetupCompleted",{string:i?"failed":"ok"}),i?e.call(r,r,"failed",null):e.call(r,r,"ok",t)},a)}switch(r.R.warn("Failed to create downloader, status [%s]",n.status),n.status){case"capacity":case"stream-ended":case"origin-stream-ended":case"streaming-not-available":case"unauthorized":case"timeout":return e.call(r,r,n.status);default:return e.call(r,r,"failed")}})})},T.prototype.getProtocol=function(){return this.J},T.prototype.getLogger=function(){return this.R},T.prototype.toString=function(){var t=this.getProtocol();return"PCast["+(t?t.getSessionId():"")||"unauthenticated,"+(t?t.toString():"uninitialized")+"]"};var $=function(){var i=t.get(E,["global","navigator","userAgent"],"");return G()||/Android|webOS|BlackBerry|IEMobile|Opera Mini|Mobile|mobile|CriOS/i.test(i)},G=function(){var i=t.get(E,["global","navigator","userAgent"],"");return/iPad|iPhone|iPod/.test(i)&&!E.global.MSStream},Q=function(i){var e=i.match(/(?=a=group:BUNDLE).*/),n=t.get(t.get(e,[0],"").split("a=group:BUNDLE "),[1],""),r=n.split(" ").sort(function(t,e){return i.indexOf("m="+t)>i.indexOf("m="+e)});return r.length>0&&(i=i.replace(n,r.join(" "))),i};return T}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(0),e(1),e(2),e(78)],void 0===(r=function(t,i,e,n){"use strict";function r(e,n){i.isObject(e,"pcast"),n&&i.isObject(n,"options"),n&&n.screenShare&&i.isFunction(n.screenShare,"options.screenShare"),this.pt=e,this.R=e.getLogger(),this.mt=n||{},this.vt=t.get(n,["onScreenShare"])}return r.prototype.getUserMedia=function(r,s){i.isObject(r,"deviceOptions");var o=new n(this.mt),a=o.getDefaultResolution(),u=o.getDefaultFrameRate();(function i(n,r,s,o,a){var u=this.getVendorSpecificConstraints(n,r||{},s);var h=!!u.video;var c=this;this.pt.getUserMedia(u,function(t,u,f,l){if("ok"===u)return a(null,{userMedia:f,options:{frameRate:h?s:null,resolution:h?r.height:null,aspectRatio:h?r.aspectRatio:null}});var d=r,p=s,m=function(t){if(t.constraintName)return t.constraintName;if(t.constraint)return t.constraint;return""}(l);if(l&&("ConstraintNotSatisfiedError"===l.name||"OverconstrainedError"===l.name||"OverconstrainedError"===l.constructor.name||"unavailable"===l.code&&"Edge"===e.browser))switch(m.toLowerCase()){case"width":case"height":if(!r||!o.canResolveNextResolution())break;return c.R.warn("Unable to get user media with constraint [%s] with height [%s] and width [%s]. Retrying with next closest resolution.",m,d.height,d.width),d=o.getNextResolution(r.height,r.aspectRatio),i.call(c,n,d,p,o,a);case"framerate":default:if(s)return c.R.warn("Unable to get user media with constraint [%s] and framerate [%s]. Retrying without frame rate constraint.",m,s),i.call(c,n,d,p=null,o,a);if(!r||!o.canResolveNextResolution())break;return c.R.warn("Unable to get user media with constraint [%s] with height [%s] and width [%s]. Retrying with next closest resolution.",m,d.height,d.width),d=o.getNextResolution(r.height,r.aspectRatio),i.call(c,n,d,p,o,a)}return c.R.error("Unable to get user media with status [%s]",u,l),a(l)},function(i){var n=i;if(c.vt&&"Chrome"===e.browser){var r,s=function(i){var e=t.get(i,["video","mandatory","chromeMediaSource"]),n=t.get(i,["audio","mandatory","chromeMediaSource"]),r=t.get(i,["video","mandatory","chromeMediaSourceId"]),s=t.get(i,["audio","mandatory","chromeMediaSourceId"]),o={};(e||s)&&(t.set(o,["screen","mediaSource"],e),t.set(o,["screen","mediaSourceId"],r));(n||s)&&(t.set(o,["screenAudio","mediaSource"],n),t.set(o,["screenAudio","mediaSourceId"],s));return o}(i);(n=c.vt(s)).resolutionHeight&&n.aspectRatio&&(r={width:o.calculateWidthByAspectRatio(n.resolution,n.aspectRatio),height:n.resolutionHeight}),n=function(i,e,n){var r=this.getVendorSpecificConstraints(i,e,n);r.screen&&(r.video=r.screen,delete r.screen);r.screenAudio&&(r.audio=r.screenAudio,delete r.screenAudio);var s=t.get(r,["video","mandatory","mediaSource"]),o=t.get(r,["audio","mandatory","mediaSource"]),a=t.get(r,["video","mandatory","mediaSourceId"]),u=t.get(r,["audio","mandatory","mediaSourceId"]);(s||a)&&(t.set(r,["video","mandatory","chromeMediaSource"],s),t.set(r,["video","mandatory","chromeMediaSourceId"],a),delete r.video.mandatory.mediaSource,delete r.video.mandatory.mediaSourceId);(o||u)&&(t.set(r,["audio","mandatory","chromeMediaSource"],o),t.set(r,["audio","mandatory","chromeMediaSourceId"],u),delete r.audio.mandatory.mediaSource,delete r.audio.mandatory.mediaSourceId);return r}.call(c,s,r,n.frameRate)}return n})}).call(this,r,a,u,o,s)},r.prototype.getVendorSpecificConstraints=function(t,i,n){if(i=i||{},!t||!t.audio&&!t.video&&!t.screen&&!t.screenAudio)throw new Error("Invalid device options. Must pass in at least one device option.");return"Firefox"===e.browser&&e.browserVersion>38||"Chrome"===e.browser&&e.browserVersion>52&&!t.screen&&!t.screenAudio||"Safari"===e.browser&&e.browserVersion>10||"Opera"===e.browser&&e.browserVersion>40?function(t,i,e){var n=t.video,r=t.audio,s=t.screen,o=t.screenAudio,a=i.width,u=i.height,h={};n&&(h.video={height:{min:u,ideal:u,max:u},width:{min:a,ideal:a,max:a},frameRate:{ideal:e,max:e}},n.deviceId&&(h.video.deviceId={exact:n.deviceId}),n.facingMode&&(h.video.facingMode=n.facingMode),a||delete h.video.width,u||delete h.video.height,e||delete h.video.frameRate,a||u||e||n.deviceId||n.facingMode||(h.video=!0));r&&(h.audio={},r.deviceId&&(h.audio.deviceId={exact:r.deviceId}),r.mediaSource&&(h.audio.mediaSource=r.mediaSource),r.mediaSourceId&&(h.audio.mediaSourceId=r.mediaSourceId),r.deviceId||r.mediaSource||r.mediaSourceId||(h.audio=!0));o&&(h.screenAudio={},o.deviceId&&(h.screenAudio.deviceId={exact:o.deviceId}),o.mediaSource&&(h.screenAudio.mediaSource=o.mediaSource),o.mediaSourceId&&(h.screenAudio.mediaSourceId=o.mediaSourceId),o.deviceId||o.mediaSource||o.mediaSourceId||(h.screenAudio=!0));s&&(h.screen={height:{min:u,ideal:u,max:u},width:{min:a,ideal:a,max:a},frameRate:{ideal:e,max:e}},a||delete h.screen.width,u||delete h.screen.height,e||delete h.screen.frameRate,s.mediaSource&&(h.screen.mediaSource=s.mediaSource),a||u||e||s.mediaSource||(h.screen=!0));s&&n&&(h.screen=!0);return h}(t,i,n):"Edge"===e.browser?function(t,i,e){var n=t.video,r=t.audio,s=t.screen,o=i.width,a=i.height,u={};n&&(u.video={height:{min:a,max:a,exact:a},width:{min:o,max:o,exact:o},frameRate:e},n.deviceId&&(u.video.deviceId=n.deviceId),n.facingMode&&(u.video.facingMode=n.facingMode),o||delete u.video.width,a||delete u.video.height,e||delete u.video.frameRate,o||a||e||n.deviceId||n.facingMode||(u.video=!0));r&&(u.audio=!0,r.deviceId&&(u.audio={deviceId:r.deviceId}));s&&(u.screen=!0);return u}(t,i,n):function(t,i,e){var n=t.video,r=t.audio,s=t.screen,o=t.screenAudio,a=i.width,u=i.height,h={};n&&(h.video={mandatory:{minHeight:u,maxHeight:u,minWidth:a,maxWidth:a,maxFrameRate:e}},n.deviceId&&(h.video.mandatory.sourceId=n.deviceId),n.facingMode&&(h.video.facingMode=n.facingMode),n.mediaSource&&(h.video.mandatory.mediaSource=n.mediaSource),n.mediaSourceId&&(h.video.mandatory.mediaSourceId=n.mediaSourceId),a||(delete h.video.mandatory.minWidth,delete h.video.mandatory.maxWidth),u||(delete h.video.mandatory.minHeight,delete h.video.mandatory.maxHeight),e||delete h.video.mandatory.maxFrameRate,a||u||e||n.deviceId||n.facingMode||n.mediaSource||n.mediaSourceId||(h.video=!0));r&&(h.audio={mandatory:{}},r.deviceId&&(h.audio.mandatory.sourceId=r.deviceId),r.mediaSource&&(h.audio.mandatory.mediaSource=r.mediaSource),r.mediaSourceId&&(h.audio.mandatory.mediaSourceId=r.mediaSourceId),r.deviceId||r.mediaSource||r.mediaSourceId||(h.audio=!0));o&&(h.screenAudio={mandatory:{}},o.deviceId&&(h.screenAudio.mandatory.sourceId=o.deviceId),o.mediaSource&&(h.screenAudio.mandatory.mediaSource=o.mediaSource),o.mediaSourceId&&(h.screenAudio.mandatory.mediaSourceId=o.mediaSourceId),o.deviceId||o.mediaSource||o.mediaSourceId||(h.screenAudio=!0));s&&(h.screen={mandatory:{minHeight:u,maxHeight:u,minWidth:a,maxWidth:a,maxFrameRate:e}},a||(delete h.screen.mandatory.minWidth,delete h.screen.mandatory.maxWidth),u||(delete h.screen.mandatory.minHeight,delete h.screen.mandatory.maxHeight),e||delete h.screen.mandatory.maxFrameRate,s.mediaSource&&(h.screen.mandatory.mediaSource=s.mediaSource),s.mediaSourceId&&(h.screen.mandatory.mediaSourceId=s.mediaSourceId),a||u||e||s.mediaSource||(h.screen=!0));s&&n&&(h.screen=!0);return h}(t,i,n)},r}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(29)],void 0===(r=function(t){"use strict";return new t}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(0),e(1),e(3)],void 0===(r=function(t,i,e){"use strict";function n(){this.yt=[]}function r(e,n,r){var s=this;t.isNullOrUndefined(e)&&(e=[]),i.isArray(e,"args");var o=function(){t.forEach(s.yt,function(t){t.apply(n,e)})};r?setTimeout(function(){o(),r()},0):o()}return n.prototype.fire=function(t,i){r.call(this,t,i)},n.prototype.fireAsync=function(t,i,e){r.call(this,t,i,e||function(){})},n.prototype.listen=function(n){var r=this;return i.isFunction(n,"listener"),r.yt.push(n),new e.Disposable(function(){r.yt=t.remove(r.yt,function(t){return t===n})})},n.prototype.size=function(){return this.yt.length},n.prototype.dispose=function(){this.yt=[]},n.prototype.toString=function(){return"Event|"+this.size()},n}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(44)],void 0===(r=function(t){"use strict";return t}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(0),e(1),e(3)],void 0===(r=function(t,i,e){"use strict";function n(t,i){this.latestValue=null,this.subscribeCallbacks={},this.subscriptionTimeout=100,this.subscriptionCount=0,this.resetOnChange=!1,this.lastChangeTime=0,this.isPendingChanges=!1,this.beforeChange=i,s.call(this,t)}function r(i){return void 0===i||null===i?i:t.isArray(i)?i.slice():i}function s(t){var i=t;this.beforeChange&&(i=this.beforeChange(t)),this.latestValue=r(i)}function o(i,e){if(this.lastChangeTime=t.now(),!this.isPendingChanges&&0!==this.subscriptionCount){if(this.isPendingChanges=!0,e)return a.call(this);(function i(e){var n=this;setTimeout(function(){var e=t.now()-n.lastChangeTime;n.resetOnChange&&e<n.subscriptionTimeout?i.call(n,n.subscriptionTimeout-e):a.call(n)},e)}).call(this,i)}}function a(){try{(function(){var i=this;t.forOwn(i.subscribeCallbacks,function(e){t.isFunction(e)&&e(i.latestValue)})}).call(this)}finally{this.isPendingChanges=!1}}return n.prototype.getValue=function(){return r(this.latestValue)},n.prototype.setValue=function(t){t!==this.latestValue&&(s.call(this,t),o.call(this,this.subscriptionTimeout))},n.prototype.subscribe=function(n,r){i.isFunction(n,"callback"),r&&i.isObject(r,"options");var s,a=this,u=t.uniqueId();return a.subscribeCallbacks[u]=n,a.subscriptionCount+=1,r&&("notify"===r.initial&&o.call(a,a.subscriptionTimeout,!0),r.listenForChanges&&(s=setInterval(function(){var t=r.listenForChanges.callback();t!==a.latestValue&&a.setValue(t)},r.listenForChanges.timeout))),new e.Disposable(function(){delete a.subscribeCallbacks[u],s&&(clearInterval(s),s=null),a.subscriptionCount-=1})},n.prototype.extend=function(e){switch(i.isObject(e,"options"),e.method){case"notifyWhenChangesStop":this.subscriptionTimeout=e.timeout,this.resetOnChange=!0;break;case"notifyAtFixedRate":this.subscriptionTimeout=e.timeout}return t.isNumber(e.rateLimit)&&(this.subscriptionTimeout=e.rateLimit),this},n}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(0),e(53),e(49)],void 0===(r=function(t,i,e){"use strict";function n(n,r){var s=i.loadJson(e);t.forEach(n,function(t){s=i.loadJson(t,s)}),this.wt=s.build(),this.bt=r||3}function r(t){for(var i=t.split("."),e=this.wt,n=0;n<i.length-1;n++)if(!(e=e[i[n]]))throw new Error('Unsupported type "'+t+'"');if("function"!=typeof(e=e[i[i.length-1]]))throw new Error('Unsupported type "'+t+'"');return e}return n.prototype.getApiVersion=function(){return this.bt},n.prototype.encode=function(t,i){if("string"!=typeof t)throw new Error("'type' must be a string");if("object"!=typeof i)throw new Error("'data' must be an object");return r.call(this,t).encode(i)},n.prototype.decode=function(i,e){if("string"!=typeof i)throw new Error("'type' must be a string");return function i(e){if(e&&e.$type&&e.$type.children)t.forOwn(e.$type.children,function(n){var r=e[n.name],s=n&&n.element?n.element.resolvedType:null;if(t.isArray(r))e[n.name]=[],t.forEach(r,function(t){e[n.name].push(i(t))});else if(s&&"Message"===s.className&&s.children)e[n.name]=i(r);else if(s&&"Enum"===s.className&&s.children){var o=t.getEnumName(s.children,r);o&&(e[n.name]=o)}else r&&t.isFunction(r.toNumber)&&(e[n.name]=r.toNumber())});else if(e&&t.isFunction(e.toNumber))return e.toNumber();return e}(r.call(this,i).decode(e))},n}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(0),e(1),e(4),e(3),e(19),e(10)],void 0===(r=function(t,i,e,n,r,s){"use strict";var o="continuation",a=2e3,u=3e5,h=18e3;function c(n,s,o,a,u){i.isObject(n,"logger"),i.isFunction(s,"sendCallback"),i.isFunction(o,"receiveCallback"),this.R=n,this.Et=new r(a,u),this.It=0,this.kt=new e.NamedEvents,this.Tt={},this.St={},this.Rt={},this.xt={},this.Ct={},this.Ot={},this.Mt=o,this.At=s,o(t.bind(f,this))}function f(i){if(this.qt)return this.R.warn("Proto already disposed of. Unable process message");var e,n,r;try{e=this.Et.decode("mq.Message",s.wrap(i.data,"base64")),r=this.Tt[e.requestId],this.R.info(">> [%s] [%s]",e.messageType,e.type),n=this.Et.decode(e.type,e.payload)}catch(t){if(this.R.error(t),r)return r(t);throw t}switch(function(i,e,n){var r=t.now(),s=this.Ct[i.requestId];if(t.isNumber(s)){var o=r-s;i.wallTime=[o].concat(i.wallTime)}this.kt.fireAsync("received",[{key:i.requestId,messageType:i.messageType,type:i.type,wallTime:i.wallTime,received:r,bytes:n,payload:e}]),delete this.Ct[i.requestId]}.call(this,e,n,i.data.length),e.messageType){case"Response":if(n.status!==o&&delete this.Tt[e.requestId],clearTimeout(this.xt[e.requestId]),delete this.xt[e.requestId],!r)return;return"mq.Error"===e.type?r(n,null):r(null,n);case"Request":var a=t.bind(this.sendResponse,this,e.requestId,e.type+"Response"),u=this.Rt[e.type];this.St[e.requestId]=t.now(),u?u(n,a):this.R.info("Received request without a subscribed listener");break;case"Event":return function(t,i){this.kt.fire(t,i,this)}.call(this,e.type,[n]);default:return this.R.warn(">> Unsupported message type [%s]",e.messageType)}}function l(i,e,n,r,s,h,c){return c&&c.status===o?(!this.Ot[i]&&this.Tt[i]&&(this.Ot[i]=function(i,e){return setTimeout(t.bind(m,this,i,u,e),u)}.call(this,i,s)),function(i,e,n,r,s,o){if(!r||!r.continuationId&&!r.routeKey)return this.R.warn("Received request for continuation without a continuationId or routeKey"),o();var u=t.assign({},n,{continuationId:r.continuationId,routeKey:r.routeKey}),h={requestId:i,type:e,payload:this.Et.encode(e,u),messageType:"Request"},c=this;return setTimeout(function(){if(c.Tt[i])return d.call(c,i,h,u,s,o)},a)}.call(this,i,e,n,c,r,s)):(clearTimeout(this.Ot[i]),delete this.Ot[i],s(h,c))}function d(i,e,n,r,s){this.xt[i]&&clearTimeout(this.xt[i]);var o=r||h;return this.xt[i]=setTimeout(t.bind(m,this,i,o,s),o),p.call(this,e,n)}function p(i,e){var n=this.Et.encode("mq.Message",i).toString("base64");return function(i,e,n){var r=t.now();this.Ct[i.requestId]=r,this.kt.fireAsync("sent",[{key:i.requestId,messageType:i.messageType,type:i.type,received:r,bytes:n,payload:e}])}.call(this,i,e,n.length),this.At(n)}function m(t,i,e){if(this.Tt[t])return function(t,i){this.kt.fireAsync("timeout",[{key:t,timeout:i}]),delete this.Ct[t]}.call(this,t,i),this.R.warn("Request [%s] has not completed in [%s] ms. Dropping request.",t,i),delete this.Tt[t],e(null,{status:"timeout"})}return c.prototype.onEvent=function(t,e){return this.qt?this.R.warn("Proto already disposed of. Unable to listen for event"):(i.isStringNotEmpty(t,"eventName"),i.isFunction(e,"handler"),this.kt.listen(t,e))},c.prototype.onRequest=function(t,e){if(this.qt)return this.R.warn("Proto already disposed of. Unable to listen for request");i.isStringNotEmpty(t,"requestName"),i.isFunction(e,"handler"),this.Rt[t]&&this.R.warn("May not set multiple handlers for the same request. Overriding existing handlers for request [%s]",t),this.Rt[t]=e;var r=this;return new n.Disposable(function(){r.Rt[t]=null})},c.prototype.sendRequest=function(e,n,r,s){if(this.qt)return this.R.warn("Proto already disposed of. Unable to send request"),r(null,{status:"proto-disposed"});s=s||{},i.isStringNotEmpty(e,"type"),i.isObject(n,"message"),i.isObject(s,"settings"),r&&i.isFunction(r,"callback"),s.timeout&&i.isNumber(s.timeout,"settings.timeout");var o="C"+(this.It++).toString(),a={requestId:o,type:e,payload:this.Et.encode(e,n),messageType:"Request"};return this.Tt[o]=t.bind(l,this,o,e,n,s.timeout,r),d.call(this,o,a,n,s.timeout,r)},c.prototype.sendResponse=function(e,n,r,s){if(this.qt)return this.R.warn("Proto already disposed of. Unable to send response"),s(null,{status:"proto-disposed"});i.isStringNotEmpty(e,"requestId"),i.isStringNotEmpty(n,"type"),i.isObject(r,"message");var o=this.St[e];o||(this.R.error("Already responded to request [%s]",e),s(new Error("no-response-handler")));var a={requestId:e,type:n,payload:this.Et.encode(n,r),messageType:"Response",wallTime:[t.now()-o]};return p.call(this,a,r),delete this.St[e],s(null,{status:"ok"})},c.prototype.disposeOfRequests=function(){t.forOwn(this.xt,function(t){clearTimeout(t)}),t.forOwn(this.Ot,function(t){clearTimeout(t)}),this.Tt={},this.St={},this.Rt={},this.xt={},this.Ct={},this.Ot={}},c.prototype.dispose=function(){this.qt=!0,this.Mt=null,this.At=null,this.disposeOfRequests(),this.kt.dispose()},c.prototype.getApiVersion=function(){return this.Et.getApiVersion()},c.prototype.toString=function(){return"Proto["+this.Nt.toString()+"]"},c}.apply(i,n))||(t.exports=r)},function(t,i,e){var n;void 0===(n=function(){"use strict";return{isSupported:!1}}.apply(i,[]))||(t.exports=n)},function(t,i,e){var n,r;n=[e(0)],void 0===(r=function(t){"use strict";var i={parseEnvFromPcastBaseUri:function(i){return i=i.toLowerCase(),t.includes(i,"local")?"local":t.includes(i,"stg")?"staging":"production"}};return i}.apply(i,n))||(t.exports=r)},function(t,i,e){var n;void 0===(n=function(){"use strict";return{package:"telemetry",messages:[{name:"LogData",fields:[{rule:"required",type:"LogLevel",name:"level",id:1},{rule:"required",type:"string",name:"timestamp",id:2},{rule:"required",type:"string",name:"category",id:3},{rule:"required",type:"string",name:"message",id:4},{rule:"optional",type:"string",name:"source",id:5},{rule:"optional",type:"string",name:"fullQualifiedName",id:11},{rule:"optional",type:"string",name:"sessionId",id:6},{rule:"optional",type:"string",name:"userId",id:7},{rule:"optional",type:"string",name:"environment",id:8},{rule:"optional",type:"string",name:"version",id:9},{rule:"optional",type:"float",name:"runtime",id:10}]},{name:"StoreLogRecords",fields:[{rule:"repeated",type:"LogData",name:"records",id:1}]},{name:"StoreLogRecordsResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"required",type:"uint64",name:"storedRecords",id:2}]},{name:"MetricValue",fields:[{rule:"optional",type:"string",name:"string",id:1},{rule:"optional",type:"float",name:"float",id:2},{rule:"optional",type:"uint64",name:"uint64",id:3},{rule:"optional",type:"int64",name:"int64",id:4},{rule:"optional",type:"bool",name:"boolean",id:5},{rule:"optional",type:"string",name:"timestamp",id:6}]},{name:"MetricData",fields:[{rule:"required",type:"string",name:"timestamp",id:1},{rule:"optional",type:"string",name:"sessionId",id:2},{rule:"optional",type:"string",name:"streamId",id:3},{rule:"optional",type:"string",name:"source",id:4},{rule:"optional",type:"string",name:"resource",id:5},{rule:"optional",type:"string",name:"kind",id:6},{rule:"required",type:"Metric",name:"metric",id:7},{rule:"optional",type:"MetricValue",name:"value",id:8},{rule:"optional",type:"MetricValue",name:"previousValue",id:9},{rule:"optional",type:"uint64",name:"elapsed",id:10},{rule:"optional",type:"string",name:"fullQualifiedName",id:11},{rule:"optional",type:"string",name:"environment",id:12},{rule:"optional",type:"string",name:"version",id:13},{rule:"optional",type:"string",name:"tool",id:14},{rule:"optional",type:"string",name:"toolVersion",id:15},{rule:"required",type:"float",name:"runtime",id:16}]},{name:"SubmitMetricRecords",fields:[{rule:"repeated",type:"MetricData",name:"records",id:1}]},{name:"SubmitMetricRecordsResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"required",type:"uint64",name:"storedRecords",id:2}]}],enums:[{name:"LogLevel",values:[{name:"Trace",id:0},{name:"Debug",id:1},{name:"Info",id:2},{name:"Warn",id:3},{name:"Error",id:4},{name:"Fatal",id:5}]},{name:"Metric",values:[{name:"RoundTripTime",id:0},{name:"DownlinkThroughputCapacity",id:26},{name:"Initialized",id:1},{name:"Provisioned",id:2},{name:"SetupCompleted",id:3},{name:"Offset",id:4},{name:"TimeToFirstFrame",id:5},{name:"Playing",id:6},{name:"Stalled",id:7},{name:"Buffering",id:8},{name:"Seeking",id:22},{name:"Stopped",id:9},{name:"BitRateAdaptation",id:10},{name:"ResolutionChanged",id:11},{name:"DisplayResolutionChanged",id:23},{name:"VideoBitRate",id:28},{name:"AudioBitRate",id:29},{name:"FrameRateChanged",id:12},{name:"FramesDropped",id:13},{name:"PacketsLost",id:14},{name:"PictureLost",id:15},{name:"PlayoutDelayChanged",id:16},{name:"CodecChanged",id:17},{name:"PlayerEvent",id:21},{name:"MetricDropped",id:18},{name:"NetworkOffline",id:19},{name:"NetworkOnline",id:20},{name:"NetworkType",id:27},{name:"ApplicationForeground",id:24},{name:"ApplicationBackground",id:25}]}]}}.apply(i,[]))||(t.exports=n)},function(t,i,e){var n,r;n=[e(0)],void 0===(r=function(t){"use strict";function i(){}return i.convertPeerConnectionStats=function(i,e){return function(i,e){if(!i)return null;var n=[],r=function(i,r,s,o,a,u){if(i){t.hasIndexOrKey(e,i)||(e[i]={timestamp:0});var h=parseFloat(s)-e[i].timestamp,c=function(t,i,e){if(t){var n=i||0,r=8e3*(t-n)/e;return Math.round(r/1e3)}return 0}(parseFloat(o),e[i].bytesSent,h),f=function(t,i,e){if(t){var n=i||0,r=8e3*(t-n)/e;return Math.round(r/1e3)}return 0}(parseFloat(a),e[i].bytesReceived,h);e[i].bytesSent=parseFloat(o),e[i].bytesReceived=parseFloat(a),e[i].timestamp=parseFloat(s),n.push({uploadRate:c,downloadRate:f,mediaType:r,ssrc:i,direction:u})}};t.isFunction(i.result)?t.forEach(i.result(),function(t){if("ssrc"===t.type){var i=t.stat("ssrc"),e=t.stat("bytesSent"),n=t.stat("bytesReceived"),s=t.stat("mediaType"),o=t.timestamp.getTime(),a=t.id.indexOf("send")>-1?"upload":"download";r(i,s,o,e,n,a)}}):t.isFunction(i.values)?t.forEach(Array.from(i.values()),function(i){if(t.hasIndexOrKey(i,"ssrc")){if(!i.ssrc||t.includes(i.id,"rtcp"))return;var e=i.type.indexOf("outbound")>-1?"upload":"download";r(i.ssrc,i.mediaType,i.timestamp,i.bytesSent,i.bytesReceived,e)}}):t.forEach(i,function(i){if(t.hasIndexOrKey(i,"ssrc")){if(!i.ssrc||t.includes(i.id,"rtcp"))return;var e=i.type.indexOf("outbound")>-1?"upload":"download";r(i.ssrc,i.mediaType,i.timestamp,i.bytesSent,i.bytesReceived,e)}});return n}(i,e)},i}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(0),e(1),e(2)],void 0===(r=function(t,i,e){"use strict";var n=5e3;function r(t,e,n){i.isString(t,"name"),i.isObject(e,"peerConnection"),i.isObject(n,"logger"),this.Pt=t,this.jt=e,this.R=n}function s(i){this.time=t.now(),this.value=i||0}function o(i){var n={};switch(e.browser){case"Firefox":return i;case"IE":t.forOwn(i,function(i,e){if(!t.startsWith(e,"ssrc")){return}n[i.id]=i});return n;case"Safari":case"Edge":i.forEach(function(t){n[t.id]=t});return n;case"ReactNative":var r=t.isString(i)?JSON.parse(i):i;r.forEach(function(i){var e={id:i.id,type:i.type};i.values.forEach(function(i){t.keys(i).forEach(function(t){e[t]=i[t]})});n[e.id]=e});return n;case"Chrome":default:i.result().forEach(function(t){var i={id:t.id,type:t.type};t.names().forEach(function(e){i[e]=t.stat(e)});n[i.id]=i});return n}}function a(t,i,n,r,s){if(!n()){return this.R.info("[%s] Finished monitoring of peer connection",this.Pt)}e.getStats(t,null,function(t){var i=o(t);r(i)},function(t){s(t)})}function u(i){var e=i.getLocalStreams?i.getLocalStreams():[],n=i.getRemoteStreams?i.getRemoteStreams():[],r=[],s=[];if(t.forEach(e,function(t){r=r.concat(t.getTracks())}),t.forEach(n,function(t){s=s.concat(t.getTracks())}),0!==r.length&&0!==s.length)throw this.R.error("Invalid State. PeerConnection contains [%s] local and [%s] remote streams.",e.length,n.length),new Error("Invalid State. PeerConnection contains both local and remote streams.");return 0!==r.length?r:0!==s.length?s:[]}function h(i,e){var n=i.localDescription.sdp.split("m="),r=i.remoteDescription.sdp.split("m=");return n.length===r.length&&t.findIndex(n,function(t,i){return e(t,i,r)})}function c(t,i,e){return i?8*(t.value-i.value)/((t.time-i.time)/1e3):e}function f(i){var e=u(this.jt),n=t.filter(e,function(t){return t.kind===i}),r=t.filter(this.Ut,function(t){return t.kind===i});return t.reduce(n,function(i,e){if(!i)return i;var n=!!t.find(r,function(t){return t.id===e.id});return!e.enabled||n},!0)}return r.prototype.start=function(r,o,l){if(i.isObject(r,"options"),i.isFunction(o,"activeCallback"),i.isFunction(l,"monitorCallback"),"inbound"!==r.direction&&"outbound"!==r.direction)throw new Error("Invalid monitoring direction");if(this.Dt=r.frameRateThreshold||2,this.Ft=r.videoBitRateThreshold||6e3,this.Lt=r.audioBitRateThreshold||5e3,this.Bt=r.conditionCountForNotificationThreshold||3,this.Vt=r.monitoringInterval||4e3,this.Wt=r.monitoringInterval||1500,this.zt=!r.hasOwnProperty("monitorFrameRate")||r.monitorFrameRate,this._t=!r.hasOwnProperty("monitorBitRate")||r.monitorBitRate,this.Ht=!r.hasOwnProperty("monitorState")||r.monitorState,this.Ut=[],"Edge"===e.browser){var d=this.Wt*this.Bt;this.Vt=Math.max(this.Vt,6e3),this.Wt=Math.max(this.Wt,6e3),this.Bt=Math.max(Math.ceil(d/this.Vt),2),this.R.info("Using modified options for optimal monitoring of PeerConnection on [Edge]. Monitor Interval [%s], Condition Monitor Interval [%s], Condition Count For Notification [%s]",this.Vt,this.Wt,this.Bt)}return function(i,r,o,l,d){var p=this,m=0,v=void 0,g=void 0,y=void 0,w={},b={},E={},I=null;setTimeout(function k(T){a.call(p,r,null,l,function(a){var S=!1,R=!1,x=!1,C=!1,O=!1;if(!l())return p.R.info("[%s] Finished monitoring of peer connection",i);function M(t,n){var r=t.id||t.ssrc,a=null;if(t.framesEncoded){var u=new s(t.framesEncoded);t.framerateMean=function(t,i,e){if(!i)return e;return(t.value-i.value)/((t.time-i.time)/1e3)}(u,E[r],2*p.Dt),E[r]=u}switch(e.browser){case"Safari":case"Firefox":case"Edge":case"IE":if(O=C|=t.selected&&"succeeded"===t.state||"IE"===e.browser||"Edge"===e.browser||"Safari"===e.browser,"outbound"===o.direction&&("outboundrtp"===t.type||"outbound-rtp"===t.type||"kOutboundRtp"===t.type))switch(a=new s(t.bytesSent),t.mediaType){case"video":p.R.debug("[%s] Outbound [%s] [%s] with bitrate [%s], droppedFrames [%s] and frame rate [%s]",i,t.mediaType,t.ssrc,t.bitrateMean,t.droppedFrames,t.framerateMean),S=!0,v=t.framerateMean||0,R=!0,g=c(a,b[r],2*p.Ft),b[r]=a,"Edge"===e.browser&&(S=!1);break;case"audio":p.R.debug("[%s] Outbound [%s] [%s]",i,t.mediaType,t.ssrc),x=!0,y=c(a,w[r],2*p.Lt),w[r]=a}if("inbound"===o.direction&&("inboundrtp"===t.type||"inbound-rtp"===t.type||"kInboundRtp"===t.type))switch(a=new s(t.bytesReceived),t.mediaType){case"video":p.R.debug("[%s] Inbound [%s] [%s] with framerate [%s] and jitter [%s]",i,t.mediaType,t.ssrc,t.framerateMean,t.jitter),R=!0,g=c(a,b[r],2*p.Ft),b[r]=a;break;case"audio":p.R.debug("[%s] Inbound [%s] [%s] with jitter [%s]",i,t.mediaType,t.ssrc,t.jitter),x=!0,y=c(a,w[r],2*p.Lt),w[r]=a}break;case"Chrome":default:if("true"===t.googWritable&&(O=!0),"true"===t.googReadable&&(C=!0),"ssrc"!==t.type)return;if("outbound"===o.direction)switch(a=new s(t.bytesSent),t.mediaType){case"video":p.R.debug("[%s] Outbound [%s] [%s] with average encoding time [%s] ms (CPU limited=[%s]) and RTT [%s]",i,t.mediaType,t.ssrc,t.googAvgEncodeMs,t.googCpuLimitedResolution,t.googRtt),S=!0,v=t.googFrameRateSent||0,R=!0,g=c(a,b[r],2*p.Ft),b[r]=a;break;case"audio":p.R.debug("[%s] Outbound [%s] [%s] with audio input level [%s] and RTT [%s] and jitter [%s]",i,t.mediaType,t.ssrc,t.audioInputLevel,t.googRtt,t.googJitterReceived),x=!0,y=c(a,w[r],2*p.Lt),w[r]=a}else if("inbound"===o.direction)switch(a=new s(t.bytesReceived),t.mediaType){case"video":p.R.debug("[%s] Inbound [%s] [%s] with current delay [%s] ms and target delay [%s] ms",i,t.mediaType,t.ssrc,t.googCurrentDelayMs,t.googTargetDelayMs),S=!0,v=t.googFrameRateReceived||0,R=!0,g=c(a,b[r],2*p.Ft),b[r]=a;break;case"audio":p.R.debug("[%s] Inbound [%s] [%s] with output level [%s] and jitter [%s] and jitter buffer [%s] ms",i,t.mediaType,t.ssrc,t.audioOutputLevel,t.googJitterReceived,t.googJitterBufferMs),x=!0,y=c(a,w[r],2*p.Lt),w[r]=a}}}if(!a)throw new Error("Report must be a valid PeerConnection.getStats Report");a.forEach?a.forEach(M):t.forOwn(a,function(t,i){M(t,i)});var A=function(i){var e=h(i,function(i,e,n){return!!t.startsWith(i,"audio")&&(!t.includes(i,"a=inactive")&&!t.includes(n[e],"a=inactive"))});return t.isNumber(e)}(r),q=function(i){var e=h(i,function(i,e,n){return!!t.startsWith(i,"video")&&(!t.includes(i,"a=inactive")&&!t.includes(n[e],"a=inactive"))});return t.isNumber(e)}(r);if((R&&0===g||x&&0===y||S&&0===v)&&(R=R&&q,x=x&&A,S=S&&q,C=C||!(q||A),O=O||!(q||A)),(x||R||S)&&p.R.debug("[%s] Current bit rate is [%s] bps for audio and [%s] bps for video with [%s] FPS",i,Math.ceil(y||0),Math.ceil(g||0),v||"?"),!p.Ht||"closed"!==r.connectionState&&"failed"!==r.connectionState&&"failed"!==r.iceConnectionState)p.zt&&S&&v<=p.Dt&&!f.call(p,"video")?m++:p._t&&x&&y<=p.Lt&&!f.call(p,"audio")?m++:p._t&&R&&g<=p.Ft&&!f.call(p,"video")?m++:C&&O?m=0:m++;else{var N=A&&q,P=u.call(p,r);if(!N&&function(i){var e=h(i,function(i){return t.startsWith(i,"video")||t.startsWith(i,"audio")});return t.isNumber(e)}(r))return void p.R.info("[%s] Finished monitoring of peer connection with [%s] inactive tracks",i,P.length);m++}var j=!(0!==g&&R||0!==y&&x||function(){var i=this;return t.reduce(u(this.jt),function(e,n){if(!e)return e;var r=!!t.find(i.Ut,function(t){return t.id===n.id});return!n.enabled||r},!0)}.call(p));j&&!I?I=setTimeout(t.bind(k,this,!0),n):j||(clearTimeout(I),I=null);var U=T&&j&&I,D=function(){p.R.info("[%s] Failure has been acknowledged",i),m=Number.MIN_VALUE,setTimeout(k,p.Vt)};if(m>=p.Bt||U){var F="["+i+"] Failure detected with frame rate ["+v+"] FPS, audio bit rate ["+y+"] bps, and video bit rate ["+g+"] bps",L="["+i+"] Failure detected with 0 bps audio and video for ["+n/1e3+"] seconds",B=U?L:F,V={type:"condition",message:B,report:a,frameRate:v,videoBitRate:g,audioBitRate:y,acknowledgeFailure:D};d(null,V)?D():p.R.error(B+": [%s]",a)}else setTimeout(k,m>0?p.Wt:p.Vt)},function(t){d(t,{type:"error",message:"Unable to get Connection statistics. Connection may have failed."})})},p.Vt)}.call(this,this.Pt,this.jt,r,o,l)},r.prototype.setMonitorTrackState=function(e,n){i.isObject(e,"track"),i.isBoolean(n,"state");var r=u(this.jt);if(!!!t.find(r,function(t){return t.id===e.id}))return this.R.warn("[%s] Unable to find track [%s] [%s] in peer connection",this.Pt,e.kind,e.id);if(!n)return this.R.info("[%s] Pausing monitoring of track [%s] [%s]",this.Pt,e.kind,e.id),this.Ut.push(e);var s=this.Ut.length;this.Ut=t.filter(this.Ut,function(t){return t.id!==e.id}),s!==this.Ut.length&&this.R.info("[%s] Starting monitoring of track [%s] [%s] after it was paused",this.Pt,e.kind,e.id)},r.prototype.toString=function(){return"PeerConnectionMonitor["+this.Pt+"]"},r}.apply(i,n))||(t.exports=r)},function(t,i){},function(t,i,e){var n,r;n=[e(0),e(1),e(7),e(21),e(55),e(14),e(13),e(2),e(72)],void 0===(r=function(t,i,e,n,r,s,o,a,u){"use strict";var h="unauthorized",c=1e3,f=2e4,l={maxOfflineTime:18e4,maxReconnectFrequency:6e4};function d(n){if(i.isObject(n,"options"),i.isStringNotEmpty(n.backendUri,"options.backendUri"),i.isObject(n.authenticationData,"options.authenticationData"),n.authToken&&i.isStringNotEmpty(n.authToken,"options.authToken"),n.onError&&i.isFunction(n.onError,"options.onError"),!t.isNullOrUndefined(n.onlineTimeout)&&(i.isNumber(n.onlineTimeout,"options.onlineTimeout"),n.onlineTimeout<0))throw new Error('"options.onlineTimeout" must be a positive number');n.reconnectOptions&&(i.isObject(n.reconnectOptions,"options.reconnectOptions"),i.isNumber(n.reconnectOptions.maxOfflineTime,"options.reconnectOptions.maxOfflineTime"),i.isNumber(n.reconnectOptions.maxReconnectFrequency,"options.reconnectOptions.maxReconnectFrequency")),this.$t=new e.Observable(null).extend({rateLimit:0}),this.Gt={},this.tt={},this.Qt=new r(n.backendUri,n.authenticationData),this.Jt=!1,this.Kt=0,this.Xt=0,this.K=n.authToken,this.Zt=n.onError,this.mt=n,this.Yt=t.isNumber(n.onlineTimeout)?n.onlineTimeout:f,this.ti=n.reconnectOptions||l,this.R=null,m.call(this)}d.prototype.dispose=function(){this.ii&&(this.ii.dispose(),this.ii=null),this.$t.getValue()&&(this.$t.getValue().stop(),this.$t.setValue(null)),t.isNumber(this.ei)&&(clearTimeout(this.ei),this.ei=null),this.Qt.dispose(),this.Xt=0,this.Kt=0},d.prototype.getPCast=function(){return this.$t.getValue()},d.prototype.getPCastObservable=function(){return this.$t},d.prototype.getAdminAPI=function(){return this.Qt},d.prototype.getUserMedia=function(t,e){var n=this;if(i.isObject(t.mediaConstraints,"options.mediaConstraints"),i.isFunction(e,"callback"),t.resolution&&i.isNumber(t.resolution,"options.resolution"),t.frameRate&&i.isNumber(t.frameRate,"options.frameRate"),t.aspectRatio&&i.isStringNotEmpty(t.aspectRatio,"options.aspectRatio"),t.onResolveMedia&&i.isFunction(t.onResolveMedia,"options.onResolveMedia"),t.onScreenShare&&i.isFunction(t.onScreenShare,"options.onScreenShare"),n.$t.getValue())return b.call(n,n.$t.getValue(),t,e);var r=n.$t.subscribe(function(i){i&&(r.dispose(),b.call(n,i,t,e))})},d.prototype.publish=function(t,e){i.isObject(t,"options"),i.isFunction(e,"callback"),t.capabilities&&i.isArray(t.capabilities,"options.capabilities"),t.connectOptions&&i.isArray(t.connectOptions,"options.connectOptions"),t.mediaConstraints?i.isObject(t.mediaConstraints,"options.mediaConstraints"):i.isObject(t.userMediaStream,"options.userMediaStream"),t.videoElement&&i.isObject(t.videoElement,"options.videoElement"),t.monitor&&(i.isObject(t.monitor,"options.monitor"),i.isFunction(t.monitor.callback,"options.monitor.callback"),t.monitor.options&&i.isObject(t.monitor.options,"options.monitor.options")),t.streamToken&&i.isStringNotEmpty(t.streamToken,"options.streamToken");var n=this;this.waitForOnline(function(i){return i?e(i):t.userMediaStream?E.call(n,t.userMediaStream,t,!1,e):void n.getUserMedia(t,function(i,r){return i?e(i):"ok"!==r.status?e(null,r):void E.call(n,r.userMedia,t,!0,e)})},t.isContinuation)};var p=["streaming","low-latency","on-demand","uld","vvld","vld","ld","sd","hd","fhd","uhd"];function m(){var i=this;if(!this.$t.getValue()){var e=t.assign({logger:this.R},this.mt);this.$t.setValue(new o(e))}if(this.R||(this.R=this.$t.getValue().getLogger()),this.ni||(this.ni=this.$t.getValue().getObservableStatus().subscribe(t.bind(v,this))),this.K)return this.$t.getValue().start(this.K,t.noop,t.noop,t.noop);this.Qt.createAuthenticationToken(function(e,n){return e&&"timeout"===e.message?v.call(i,e.message):e?w.call(i,e):"ok"!==n.status?v.call(i,n.status):i.$t.getValue()?void i.$t.getValue().start(n.authenticationToken,t.noop,t.noop,t.noop):i.R.warn("Unable to authenticate. PCast not instantiated.")})}function v(t){switch(t){case"timeout":case"critical-network-issue":return this.$t.getValue()&&(this.$t.getValue().stop("express-recovery"),this.$t.setValue(null)),this.ni&&(this.ni.dispose(),this.ni=null),this.Xt++,g.call(this);case"reconnect-failed":case"unauthorized":return delete this.K,this.Kt++,this.Kt>1?w.call(this,new Error(t)):(this.R.info("[Express] Attempting to create new authToken and re-connect after [%s] response",h),y.call(this));case"capacity":case"network-unavailable":return this.Xt++,g.call(this);case"online":return this.Kt=0,this.Xt=0,this.Jt||this.R.info("Express API successfully instantiated"),void(this.Jt=!0);case"reconnecting":case"reconnected":case"connecting":break;case"offline":return;case"failed":default:return w.call(this,new Error(t))}}function g(){var t=this,i=Math.min(c*t.Xt*t.Xt,this.ti.maxReconnectFrequency),e=Math.min(i/1e4,5),n=i+Math.random()*e*1e3;this.R.info("Waiting for [%s] ms before continuing to attempt to reconnect to PCast",n),this.ei=setTimeout(function(){return t.$t.getValue()&&t.$t.getValue().isStarted()?y.call(t):m.call(t)},n)}function y(){var t=this;this.Qt.createAuthenticationToken(function(i,e){return i&&"timeout"===i.message?v.call(t,i.message):i?w.call(t,i):"ok"!==e.status?v.call(t,e.status):t.$t.getValue()?void t.$t.getValue().reAuthenticate(e.authenticationToken):t.R.warn("Unable to authenticate. PCast not instantiated.")})}function w(t){if(!this.Zt)throw t;this.Zt(t)}function b(e,n,r){new s(e,{aspectRatio:n.aspectRatio,resolutionHeight:n.resolution,frameRate:n.frameRate,resolutionSelectionStrategy:n.resolutionSelectionStrategy,onScreenShare:function(e){return(e=n.onScreenShare?n.onScreenShare(e):e).resolution&&i.isNumber(e.resolution,"clientOptions.resolution"),e.frameRate&&i.isNumber(e.frameRate,"screenOptions.frameRate"),e.aspectRatio&&i.isStringNotEmpty(e.aspectRatio,"screenOptions.aspectRatio"),t.assign({resolutionHeight:e.resolution},e)}}).getUserMedia(n.mediaConstraints,function(i,e){if(i)return r(i);n.onResolveMedia&&n.onResolveMedia(e.options),r(null,t.assign({status:"ok"},e))})}function E(t,e,n,r){var s=this;if(i.isArray(e.capabilities,"options.capabilities"),e.streamToken)return I.call(s,e.streamToken,t,e,n,r);s.waitForOnline(function(i){if(i)return r(i);var o=s.$t.getValue().getProtocol().getSessionId();s.R.info("Session Id [%s]",o),s.Qt.createStreamTokenForPublishing(o,e.capabilities,function(i,o){return i?r(i):"ok"!==o.status?r(null,o):void I.call(s,o.streamToken,t,e,n,r)})},e.isContinuation)}function I(e,n,r,s,o){var u=this,c=!1;r.tags&&i.isArray(r.tags,"options.tags"),r.connectOptions&&i.isArray(r.connectOptions,"options.connectOptions");var f=function(i,f,l){var d=function(i){var a=t.uniqueId(),h=t.assign({streamToken:e,isContinuation:!0},r);u.tt[a]=!0,"camera-track-failure"===i?(l.stop(i,!1),u.publish(r,o)):(l.stop(i,!0),E.call(u,n,h,s,o)),delete u.tt[a]};if(f===h&&r.streamToken||"timeout"===f){u.R.info("[Express] Attempting to create new streamToken and re-publish after [%s] response",h);var p=t.assign({isContinuation:!0},r);return delete p.streamToken,E.call(u,n,p,s,o)}if("ok"!==f)return o(null,{status:f});u.tt[l.getStreamId()]=l,r.videoElement&&!c&&(a.attachMediaStream(r.videoElement,n),c=!0);var m=t.bind(C,u,function(){},d,!0);if(r.monitor){var v=t.bind(x,u,r.monitor.callback,d);l.monitor(r.monitor.options||{},v),m=t.bind(C,u,r.monitor.callback,d,!0)}l.setPublisherEndedCallback(m);var g=function(i,e,n){var r=t.bind(i.stop,i);return i.stop=function(t,s){if(r(t),e&&(e.src="",e.srcObject=null),n&&i.getStream()&&!s){var o=i.getStream();o&&o.getTracks().forEach(function(t){t.stop()})}},i.enableAudio=function(){return T(i.getStream(),!0)},i.disableAudio=function(){return T(i.getStream(),!1)},i.enableVideo=function(){return S(i.getStream(),!0)},i.disableVideo=function(){return S(i.getStream(),!1)},i.setPublisherEndedCallback=function(){},i}.call(u,l,r.videoElement,s);o(null,{status:"ok",publisher:g})};u.waitForOnline(function(t){if(t)return o(t);u.$t.getValue().publish(e,n,f,r.tags,{connectOptions:r.connectOptions})},r.isContinuation)}function k(i,e,r){var s=this,o=function(o,a,c){var f,l=function(n){var o=t.uniqueId(),a=t.assign({isContinuation:!0},e);s.Gt[o]=!0,c.stop(n),s.R.warn("[%s] Stream failure occurred with reason [%s]. Attempting to recover from failure.",e.streamId,n),k.call(s,i,a,r),delete s.Gt[o]};if(a===h&&e.streamToken||"timeout"===a){s.R.info("[%s] [Express] Attempting to create new streamToken and re-subscribe after [%s] response",e.streamId,h);var d=t.assign({isContinuation:!0},e);return delete d.streamToken,s.subscribe(d,r)}if("streaming-not-ready"===a)return r(null,{status:a,retry:t.bind(l,s,a)});if("ok"!==a)return r(null,{status:a});s.Gt[c.getStreamId()]=c,e.videoElement&&(f=c.createRenderer()).start(e.videoElement);var p=t.noop,m=t.bind(C,s,p,l,!1);if(e.monitor){var v=t.bind(x,s,e.monitor.callback,l);c.monitor(e.monitor.options||{},v),m=t.bind(C,s,e.monitor.callback,l,!1)}c.setStreamEndedCallback(m);var g=function(i,e){var n=t.bind(i.stop,i);return i.stop=function(t){e&&e.stop(),n(t)},i.enableAudio=function(){return T(i.getStream(),!0)},i.disableAudio=function(){return T(i.getStream(),!1)},i.enableVideo=function(){return S(i.getStream(),!0)},i.disableVideo=function(){return S(i.getStream(),!1)},i.setStreamEndedCallback=function(){},i}.call(s,c,f),y={status:"ok",mediaStream:g};c.setStreamErrorCallback(function(i,o,a){if("real-time"===o&&"connection-timeout"===a.message)return l.call(s,a.message);if("shaka"!==o||a.severity===u.errorSeverity.critical.id){if("phenix-player"===o&&a.severity===n.errors.severity.RECOVERABLE){var h=t.assign({isContinuation:!0},e);return delete h.streamToken,s.subscribe(h,r)}return s.R.warn("[%s] Error while playing stream with Express API. Stopping stream.",g.getStreamId(),a),g.stop(),r(a)}}),f&&(y.renderer=f),r(null,y)};s.waitForOnline(function(t){if(t)return r(t);s.$t.getValue().subscribe(i,o,e.subscriberOptions)},e.isContinuation)}function T(t,i){if(t)return R(t.getAudioTracks(),i),i}function S(t,i){if(t)return R(t.getVideoTracks(),i),i}function R(e,n){i.isArray(e,"tracks"),t.forEach(e,function(t){t.enabled=n})}function x(i,e,n,r,s){switch(r){case"camera-track-failure":case"client-side-failure":i(null,t.assign({status:r,retry:t.bind(e,null,r)},s))}}function C(t,i,e,n,r,s){var o={status:"stream-ended",reason:r,description:s};switch(r){case"ended":case"censored":var a={status:r,reason:r,description:s};return e?a.publisher=n:a.mediaStream=n,t(null,a);case"custom":return t(null,o);case"capacity":return setTimeout(function(){return i(r)},c);case"failed":case"maintenance":return i(r);case"app-background":default:return o.retry=i,t(null,o)}}return d.prototype.publishRemote=function(e,n){if(i.isObject(e,"options"),i.isFunction(n,"callback"),i.isStringNotEmpty(e.streamUri,"options.streamUri"),e.capabilities&&i.isArray(e.capabilities,"options.capabilities"),e.connectOptions&&i.isArray(e.connectOptions,"options.connectOptions"),e.mediaConstraints)throw new Error("Invalid argument, Media Constraints, for publishing remote.");if(e.videoElement)throw new Error("May not view remote stream publisher. Please subscribe to view.");e.prerollSkipDuration&&i.isNumber(e.prerollSkipDuration,"options.prerollSkipDuration"),e.monitor&&(i.isObject(e.monitor,"options.monitor"),i.isFunction(e.monitor.callback,"options.monitor.callback"),e.monitor.options&&i.isObject(e.monitor.options,"options.monitor.options")),e.frameRate&&(i.isObject(e.frameRate,"options.frameRate"),e.frameRate.exact&&i.isNumber(e.frameRate.exact,"options.frameRate.exact"),e.frameRate.max&&i.isNumber(e.frameRate.max,"options.frameRate.max")),e.streamToken&&i.isStringNotEmpty(e.streamToken,"options.streamToken");var r=this;this.waitForOnline(function(i){if(i)return n(i);var s=t.assign({connectOptions:[],capabilities:[]},e);t.includes(s.capabilities,"publish-uri")||s.capabilities.push("publish-uri"),t.forEach(p,function(i){t.includes(s.capabilities,i)&&s.connectOptions.push("publisher-capability="+i)}),e.frameRate&&e.frameRate.exact&&s.connectOptions.push("source-uri-video-fps="+e.frameRate.exact),e.frameRate&&e.frameRate.max&&s.connectOptions.push("source-uri-video-fps-max="+e.frameRate.max),s.connectOptions.push("source-uri-preroll-skip-duration="+(t.isNumber(e.prerollSkipDuration)?e.prerollSkipDuration:500).toString()),E.call(r,s.streamUri,s,!1,n)})},d.prototype.publishScreen=function(i,e){var n=t.assign({mediaConstraints:{screen:!0}},i);return t.set(n,["monitor","options"],t.assign({},{monitorFrameRate:!1,videoBitRateThreshold:100,conditionCountForNotificationThreshold:8},t.get(n,["monitor","options"],{}))),this.publish(n,e)},d.prototype.subscribe=function(t,e){i.isObject(t,"options"),i.isFunction(e,"callback"),i.isStringNotEmpty(t.streamId,"options.streamId"),i.isObject(t.capabilities,"options.capabilities"),t.videoElement&&i.isObject(t.videoElement,"options.videoElement"),t.monitor&&(i.isObject(t.monitor,"options.monitor"),i.isFunction(t.monitor.callback,"options.monitor.callback"),t.monitor.options&&i.isObject(t.monitor.options,"options.monitor.options")),t.streamToken&&i.isStringNotEmpty(t.streamToken,"options.streamToken"),t.subscriberOptions&&i.isObject(t.subscriberOptions,"options.subscriberOptions");var n=this;this.waitForOnline(function(i){return i?e(i):t.streamToken?k.call(n,t.streamToken,t,e):void n.Qt.createStreamTokenForSubscribing(n.$t.getValue().getProtocol().getSessionId(),t.capabilities,t.streamId,null,function(i,r){return i?e(i):"ok"!==r.status?e(null,r):void k.call(n,r.streamToken,t,e)})},t.isContinuation)},d.prototype.subscribeToScreen=function(i,e){var n=t.assign({},i);return t.set(n,["monitor","options"],t.assign({},{monitorFrameRate:!1,videoBitRateThreshold:100,conditionCountForNotificationThreshold:8},t.get(n,["monitor","options"],{}))),this.subscribe(n,e)},d.prototype.waitForOnline=function(e,n){if(i.isFunction(e,"callback"),this.$t.getValue()&&"online"===this.$t.getValue().getStatus())return e();var r=this,s=n?t.get(r.ti,["maxOfflineTime"]):this.Yt,o=null,a=null,u=setTimeout(function(){r.R.info("Disposing of Express Online listener after [%s] ms",s),o&&o.dispose(),a&&a.dispose(),e(new Error("timeout"))},s);this.R.info("Waiting for Online status before continuing. Timeout set to [%s]",s);var h=function(t){a&&a.dispose(),t&&(a=t.getObservableStatus().subscribe(function(t){if("online"===t)return clearTimeout(u),a.dispose(),o.dispose(),e()},{initial:"notify"}))};this.$t.getValue()&&h(this.$t.getValue()),o=this.$t.subscribe(h)},d}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r,s;
/**
 * @license long.js (c) 2013 Daniel Wirtz <dcode@dcode.io>
 * Released under the Apache License, Version 2.0
 * see: https://github.com/dcodeIO/long.js for details
 */r=[],void 0===(s="function"==typeof(n=function(){"use strict";function t(t,i,e){this.low=0|t,this.high=0|i,this.unsigned=!!e}function i(t){return!0===(t&&t.ri)}t.prototype.ri,Object.defineProperty(t.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1}),t.isLong=i;var e={},n={};function r(t,i){var r,s,a;return i?(a=0<=(t>>>=0)&&t<256)&&(s=n[t])?s:(r=o(t,(0|t)<0?-1:0,!0),a&&(n[t]=r),r):(a=-128<=(t|=0)&&t<128)&&(s=e[t])?s:(r=o(t,t<0?-1:0,!1),a&&(e[t]=r),r)}function s(t,i){if(isNaN(t)||!isFinite(t))return i?m:p;if(i){if(t<0)return m;if(t>=f)return b}else{if(t<=-l)return E;if(t+1>=l)return w}return t<0?s(-t,i).neg():o(t%c|0,t/c|0,i)}function o(i,e,n){return new t(i,e,n)}t.fromInt=r,t.fromNumber=s,t.fromBits=o;var a=Math.pow;function u(t,i,e){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return p;if("number"==typeof i?(e=i,i=!1):i=!!i,(e=e||10)<2||36<e)throw RangeError("radix");var n;if((n=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===n)return u(t.substring(1),i,e).neg();for(var r=s(a(e,8)),o=p,h=0;h<t.length;h+=8){var c=Math.min(8,t.length-h),f=parseInt(t.substring(h,h+c),e);if(c<8){var l=s(a(e,c));o=o.mul(l).add(s(f))}else o=(o=o.mul(r)).add(s(f))}return o.unsigned=i,o}function h(i){return i instanceof t?i:"number"==typeof i?s(i):"string"==typeof i?u(i):o(i.low,i.high,i.unsigned)}t.fromString=u,t.fromValue=h;var c=4294967296,f=c*c,l=f/2,d=r(1<<24),p=r(0);t.ZERO=p;var m=r(0,!0);t.UZERO=m;var v=r(1);t.ONE=v;var g=r(1,!0);t.UONE=g;var y=r(-1);t.NEG_ONE=y;var w=o(-1,2147483647,!1);t.MAX_VALUE=w;var b=o(-1,-1,!0);t.MAX_UNSIGNED_VALUE=b;var E=o(0,-2147483648,!1);t.MIN_VALUE=E;var I=t.prototype;return I.toInt=function(){return this.unsigned?this.low>>>0:this.low},I.toNumber=function(){return this.unsigned?(this.high>>>0)*c+(this.low>>>0):this.high*c+(this.low>>>0)},I.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(E)){var i=s(t),e=this.div(i),n=e.mul(i).sub(this);return e.toString(t)+n.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var r=s(a(t,6),this.unsigned),o=this,u="";;){var h=o.div(r),c=(o.sub(h.mul(r)).toInt()>>>0).toString(t);if((o=h).isZero())return c+u;for(;c.length<6;)c="0"+c;u=""+c+u}},I.getHighBits=function(){return this.high},I.getHighBitsUnsigned=function(){return this.high>>>0},I.getLowBits=function(){return this.low},I.getLowBitsUnsigned=function(){return this.low>>>0},I.getNumBitsAbs=function(){if(this.isNegative())return this.eq(E)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,i=31;i>0&&0==(t&1<<i);i--);return 0!=this.high?i+33:i+1},I.isZero=function(){return 0===this.high&&0===this.low},I.isNegative=function(){return!this.unsigned&&this.high<0},I.isPositive=function(){return this.unsigned||this.high>=0},I.isOdd=function(){return 1==(1&this.low)},I.isEven=function(){return 0==(1&this.low)},I.equals=function(t){return i(t)||(t=h(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&(this.high===t.high&&this.low===t.low)},I.eq=I.equals,I.notEquals=function(t){return!this.eq(t)},I.neq=I.notEquals,I.lessThan=function(t){return this.comp(t)<0},I.lt=I.lessThan,I.lessThanOrEqual=function(t){return this.comp(t)<=0},I.lte=I.lessThanOrEqual,I.greaterThan=function(t){return this.comp(t)>0},I.gt=I.greaterThan,I.greaterThanOrEqual=function(t){return this.comp(t)>=0},I.gte=I.greaterThanOrEqual,I.compare=function(t){if(i(t)||(t=h(t)),this.eq(t))return 0;var e=this.isNegative(),n=t.isNegative();return e&&!n?-1:!e&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},I.comp=I.compare,I.negate=function(){return!this.unsigned&&this.eq(E)?E:this.not().add(v)},I.neg=I.negate,I.add=function(t){i(t)||(t=h(t));var e=this.high>>>16,n=65535&this.high,r=this.low>>>16,s=65535&this.low,a=t.high>>>16,u=65535&t.high,c=t.low>>>16,f=0,l=0,d=0,p=0;return d+=(p+=s+(65535&t.low))>>>16,l+=(d+=r+c)>>>16,f+=(l+=n+u)>>>16,f+=e+a,o((d&=65535)<<16|(p&=65535),(f&=65535)<<16|(l&=65535),this.unsigned)},I.subtract=function(t){return i(t)||(t=h(t)),this.add(t.neg())},I.sub=I.subtract,I.multiply=function(t){if(this.isZero())return p;if(i(t)||(t=h(t)),t.isZero())return p;if(this.eq(E))return t.isOdd()?E:p;if(t.eq(E))return this.isOdd()?E:p;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(d)&&t.lt(d))return s(this.toNumber()*t.toNumber(),this.unsigned);var e=this.high>>>16,n=65535&this.high,r=this.low>>>16,a=65535&this.low,u=t.high>>>16,c=65535&t.high,f=t.low>>>16,l=65535&t.low,m=0,v=0,g=0,y=0;return g+=(y+=a*l)>>>16,v+=(g+=r*l)>>>16,g&=65535,v+=(g+=a*f)>>>16,m+=(v+=n*l)>>>16,v&=65535,m+=(v+=r*f)>>>16,v&=65535,m+=(v+=a*c)>>>16,m+=e*l+n*f+r*c+a*u,o((g&=65535)<<16|(y&=65535),(m&=65535)<<16|(v&=65535),this.unsigned)},I.mul=I.multiply,I.divide=function(t){if(i(t)||(t=h(t)),t.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?m:p;var e,n,r;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return m;if(t.gt(this.shru(1)))return g;r=m}else{if(this.eq(E))return t.eq(v)||t.eq(y)?E:t.eq(E)?v:(e=this.shr(1).div(t).shl(1)).eq(p)?t.isNegative()?v:y:(n=this.sub(t.mul(e)),r=e.add(n.div(t)));else if(t.eq(E))return this.unsigned?m:p;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();r=p}for(n=this;n.gte(t);){e=Math.max(1,Math.floor(n.toNumber()/t.toNumber()));for(var o=Math.ceil(Math.log(e)/Math.LN2),u=o<=48?1:a(2,o-48),c=s(e),f=c.mul(t);f.isNegative()||f.gt(n);)f=(c=s(e-=u,this.unsigned)).mul(t);c.isZero()&&(c=v),r=r.add(c),n=n.sub(f)}return r},I.div=I.divide,I.modulo=function(t){return i(t)||(t=h(t)),this.sub(this.div(t).mul(t))},I.mod=I.modulo,I.not=function(){return o(~this.low,~this.high,this.unsigned)},I.and=function(t){return i(t)||(t=h(t)),o(this.low&t.low,this.high&t.high,this.unsigned)},I.or=function(t){return i(t)||(t=h(t)),o(this.low|t.low,this.high|t.high,this.unsigned)},I.xor=function(t){return i(t)||(t=h(t)),o(this.low^t.low,this.high^t.high,this.unsigned)},I.shiftLeft=function(t){return i(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?o(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):o(0,this.low<<t-32,this.unsigned)},I.shl=I.shiftLeft,I.shiftRight=function(t){return i(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?o(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):o(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},I.shr=I.shiftRight,I.shiftRightUnsigned=function(t){if(i(t)&&(t=t.toInt()),0===(t&=63))return this;var e=this.high;return t<32?o(this.low>>>t|e<<32-t,e>>>t,this.unsigned):o(32===t?e:e>>>t-32,0,this.unsigned)},I.shru=I.shiftRightUnsigned,I.toSigned=function(){return this.unsigned?o(this.low,this.high,!1):this},I.toUnsigned=function(){return this.unsigned?this:o(this.low,this.high,!0)},I.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},I.toBytesLE=function(){var t=this.high,i=this.low;return[255&i,i>>>8&255,i>>>16&255,i>>>24&255,255&t,t>>>8&255,t>>>16&255,t>>>24&255]},I.toBytesBE=function(){var t=this.high,i=this.low;return[t>>>24&255,t>>>16&255,t>>>8&255,255&t,i>>>24&255,i>>>16&255,i>>>8&255,255&i]},t})?n.apply(i,r):n)||(t.exports=s)},function(t,i,e){var n,r;n=[e(0),e(1),e(4),e(3)],void 0===(r=function(t,i,e,n){"use strict";var r=3e3;function s(){this.kt=new e.NamedEvents,this.si=t.now(),this.z=new n.DisposableList,this.oi=!0,this.z.add(this.kt),function(){if(o())return function(){if(!o())return;var t=this;chrome.extension.onRequest.addListener(function(i,e,n){"is_selected"===i&&chrome.tabs.getSelected(null,function(i){var r=i.id===e.tab.id;a.call(t,r),n(!!r)})})}.call(this);(function(){var i,e,s=this;if("object"!=typeof document)return;void 0!==document.msHidden?(i="msHidden",e="msvisibilitychange"):void 0!==document.webkitHidden?(i="webkitHidden",e="webkitvisibilitychange"):void 0!==document.hidden&&(i="hidden",e="visibilitychange");function o(){var t=!document[i];a.call(s,t)}void 0!==document.addEventListener&&void 0!==document[i]?(t.addEventListener(document,e,o,!1),s.z.add(new n.Disposable(function(){t.removeEventListener(document,e,o,!1)}))):function(){var i=this;i.ai=setInterval(function(){var t=document.hasFocus();a.call(i,t)},r),i.z.add(new n.Disposable(function(){t.isNumber(i.ai)&&clearInterval(i.ai),i.ai=null}))}.call(s)}).call(this)}.call(this)}function o(){return"undefined"!=typeof chrome&&chrome.extension&&chrome.extension.onRequest}function a(t){if(i.isBoolean(t,"isForeground"),this.oi!==t)return t?(this.oi=!0,u.call(this,"foreground")):(this.oi=!1,u.call(this,"background"))}function u(i){var e=t.now(),n=e-this.si;this.si=e,this.kt.fire(i,[n])}return s.prototype.isForeground=function(){return this.oi},s.prototype.getTimeSinceLastChange=function(){return t.now()-this.si},s.prototype.onForeground=function(t){return i.isFunction(t,"callback"),this.kt.listen("foreground",t)},s.prototype.onBackground=function(t){return i.isFunction(t,"callback"),this.kt.listen("background",t)},s}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(0)],void 0===(r=function(t){var i=function(){};return i.prototype.isObject=function(e,n){i.prototype.isString("name",n);var r='"'+n+'" must be an object';if(!t.isObject(e))throw new Error(r)},i.prototype.isArray=function(e,n){i.prototype.isString("name",n);var r='"'+n+'" must be an array';if(!t.isArray(e))throw new Error(r)},i.prototype.isString=function(i,e){var n='"'+e+'" must be a string';if(!t.isString(e))throw new Error('"name" must be a string');if(!t.isString(i))throw new Error(n)},i.prototype.isBoolean=function(e,n){i.prototype.isString("name",n);var r='"'+n+'" must be a boolean';if(!t.isBoolean(e))throw new Error(r)},i.prototype.isNumber=function(e,n){i.prototype.isString("name",n);var r='"'+n+'" must be a number';if(!t.isNumber(e))throw new Error(r)},i.prototype.isFunction=function(e,n){i.prototype.isString("name",n);var r='"'+n+'" must be a function';if(!t.isFunction(e))throw new Error(r)},i.prototype.stringNotEmpty=function(t,e){i.prototype.isStringNotEmpty(t,e)},i.prototype.isStringNotEmpty=function(t,e){i.prototype.isString("name",e);var n='"'+e+'" must not be empty';if(i.prototype.isString(t,e),""===t)throw new Error(n)},i.prototype.isInstanceOf=function(e,n,r){if(i.prototype.isString("name",r),!t.isObject(e))throw new Error('"'+r+'" must be an instance');if(!(e instanceof n))throw new Error('"'+r+'" must be a valid instance of class')},i.prototype.isNotUndefined=function(e,n){if(i.prototype.isString("name",n),t.isUndefined(e))throw new Error('"'+n+'" must not be undefined')},i.prototype.isValidType=function(e,n,r){if(i.prototype.isStringNotEmpty(r,"name"),e=t.getEnumName(n,e),t.isNullOrUndefined(e))throw new Error('"'+r+'" must be a valid type');return e},i.prototype.isArrayOfString=function(e,n){i.prototype.isString(n,"name"),i.prototype.isArray(e,n),t.forEach(e,function(t,e){i.prototype.isString(t,n+"["+e+"]")})},new i}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(0),e(1),e(4),e(17),e(5),e(7),e(3)],void 0===(r=function(t,i,e,n,r,s,o){var a=0,u={capacity:"capacity",error:"error",response:"response"},h="__phenixBatchHttpMessages";function c(r,a,u,c){i.isStringNotEmpty(r,"uri"),a=a||{},i.isObject(a,"options"),a.requestType&&i.isStringNotEmpty(a.requestType,"options.requestType"),a.maxAttempts&&i.isNumber(a.maxAttempts,"options.maxAttempts"),a.maxBufferedRecords&&i.isNumber(a.maxBufferedRecords,"options.maxBufferedRecords"),a.maxBatchSize&&i.isNumber(a.maxBatchSize,"options.maxBatchSize"),a.contentType&&i.isStringNotEmpty(a.contentType,"options.maxBatchSize"),u&&i.isFunction(u,"serializeRequest"),c&&i.isFunction(c,"deserializeResponse"),this.ui=h+"|"+r,this.hi=a.requestType||"POST",this.ci=a.requestTimeout||3e4,this.fi=a.maxAttempts||5,this.li=a.maxBufferedRecords||1e3,this.di=a.maxBatchSize||100,this.pi=a.contentType||"application/json",this.mi=u,this.vi=c,this.gi=r,this.yi=p.call(this)||[],this.wi=!0,this.kt=new e.NamedEvents,this.bi=new s.Observable(!0),this.z=new o.DisposableList,this.Ei=!1,this.Ii=!1,this.z.add(this.bi.subscribe(t.bind(l,this))),this.z.add(function(){var t=this;return n.listenForNetworkChange(function(){d.call(t,t.Ei)})}.call(this)),this.z.add(this.kt),v.call(this,[]),l.call(this);var f=this;t.addEventListener(window,"beforeunload",function(){m.call(f,f.yi),f.Ii=!0,f.yi=[]})}function f(){if(this.yi.length>this.li){var t=this.yi.length-this.li/2;this.yi=this.yi.slice(t),this.kt.fireAsync(u.capacity,[null,{numberOfDeletedRecords:t}])}}function l(){if(this.bi.getValue()&&0!==this.yi.length){d.call(this,!0);var i={records:t.take(this.yi,this.di)};this.yi=this.yi.slice(this.di);var e=this;try{(function(i,e,n){var s=this,o=this.mi?this.mi(t.assign({},e)):e;switch(this.hi){case"POST":return r.postWithRetry(i,o,{timeout:this.ci,contentType:this.pi,retryOptions:{maxAttempts:this.fi,additionalRetryErrorCodes:[0]}},function(t,i){if(t)return"timeout"!==t.message||function(){return this.yi.length>=this.li}.call(s)?(d.call(s,!1),s.kt.fire(u.error,[t])):n();d.call(s,!1);var e=s.vi?s.vi(i.data):i.data;return s.kt.fire(u.response,[e])});default:throw new Error("Invalid request type")}}).call(this,this.gi,i,function(){setTimeout(function(){e.yi=e.yi.concat(i.records),d.call(e,!1)},a)})}catch(t){setTimeout(function(){return d.call(e,!1),e.kt.fire(u.error,[t])},a)}}}function d(t){this.Ei=t,this.bi.setValue(!t&&n.isOnline())}c.prototype.on=function(t,e){return i.isStringNotEmpty(t,"eventName"),i.isFunction(e,"callback"),this.kt.listen(t,e)},c.prototype.addRecord=function(t){if(this.Ii)return m.call(this,[t]);this.yi.push(t),l.call(this),f.call(this)},c.prototype.addRecordToBeginning=function(t){this.yi.unshift(t),l.call(this),f.call(this)},c.prototype.dispose=function(){this.yi=[],this.z.dispose()};var p=function(){if(!window.localStorage)return null;var t=window.localStorage.getItem(this.ui);return t?JSON.parse(t):[]},m=function(t){if(!window.localStorage||!t||0===t.length)return null;var i=p.call(this).concat(t);return v.call(this,i)},v=function(t){return window.localStorage&&t?window.localStorage.setItem(this.ui,JSON.stringify(t)):null};return c}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(31)],void 0===(r=function(t){"use strict";return t}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(0),e(1),e(5),e(3)],void 0===(r=function(t,i,e,n){"use strict";function r(t,e,r,s){i.isObject(t,"logger"),i.isStringNotEmpty(e,"version"),i.isFunction(r,"onClosestEndpointFound"),s&&i.isFunction(s,"onAnEndpointResolved"),this.R=t,this.b=e,this.ki=r,s&&(this.Ti=s),this.Si=!1,this.Ri=Number.MAX_VALUE,this.xi="",this.z=new n.DisposableList}return r.prototype.isResolved=function(){return this.Si},r.prototype.dispose=function(){this.z.dispose()},r.prototype.measurementCallback=function(t,i,e){return i<this.Ri&&(this.R.info("Current closest end point is [%s] with latency of [%s] ms",e,i),this.Ri=i,this.xi=e),this.isResolved()},r.prototype.completeCallback=function(t){if(this.xi&&this.Ri<Number.MAX_VALUE&&!this.isResolved())return this.Si=!0,this.ki(null,{uri:this.xi,roundTripTime:this.Ri})},r.prototype.resolveAll=function(t){for(var i=0;i<t.length;i++)this.resolve(t[i],4)},r.prototype.resolve=function(i,n){var r=this,s=1,o=0;!function i(a){var u=t.now();r.R.info("[%s] Checking end point [%s]",s,a);var h=e.getWithRetry(a,{timeout:15e3,queryParameters:{version:r.b,Ci:t.now()},retryOptions:{maxAttempts:1}},function(e,h){var c=t.now()-u,f=c>30;if(r.Ti&&(e?r.Ti(e):r.Ti(null,{time:c,endPoint:a})),s++,!e){if(r.measurementCallback(a,c,h.data))return;o++}return s<=n&&!r.isResolved()&&(f||e)?(e&&r.R.info("Retrying after failure to resolve end point [%s] with [%s]",a,e),i(a)):0===o?r.R.warn("Unable to resolve end point [%s] with [%s]",a,e):r.completeCallback(a)});r.z.add(h)}(i)},r}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(33)],void 0===(r=function(t){return t}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(0)],void 0===(r=function(t){"use strict";function i(t){this.Oi=t||""}return i.prototype.detect=function(){var i="Unknown",e="?",n=this.Oi.match(/(Chrome|Chromium|Firefox|Opera|Safari)+\//),r=this.Oi.match(/(Chrome|Chromium|Firefox|Version)+\/([0-9]+)\./),s=!1;return n&&n.length>=2?i=n[1]:this.Oi.match(/^\(?Mozilla/)&&(i="Mozilla",(this.Oi.match(/MSIE/)||this.Oi.match(/; Trident\/.*rv:[0-9]+/))&&(i="IE",(r=this.Oi.match(/MSIE ([0-9]+)/))?(e=parseInt(r[1],10),(r=this.Oi.match(/MSIE [0-9]+.*MSIE ([0-9]+)/))&&(e=parseInt(r[1],10))):(r=this.Oi.match(/rv:([0-9]+)/))&&(e=parseInt(r[1],10)))),"Chrome"===i&&this.Oi.match(/OPR\//)?(i="Opera",r=this.Oi.match(/(OPR)\/([0-9]+)\./)):"Chrome"===i&&this.Oi.match(/Edge\//)?(i="Edge",r=this.Oi.match(/(Edge)\/([0-9]+)\./)):"Firefox"!==i&&"IE"!==i||!this.Oi.match(/Opera/)?"Mozilla"===i&&this.Oi.match(/iphone|ipod|ipad/i)&&(i="Safari",e=parseInt(t.get(this.Oi.match(/OS\s([0-9]+)/),[1]),10),s=!0):(i="Opera",r=this.Oi.match(/(Opera) ([0-9]+)\./)),"Chrome"===i&&(this.Oi.match(/; wv/)||this.Oi.match(/Android/)&&this.Oi.match(/Version\/[0-9].[0-9]/))&&(s=!0),"IE"!==i&&r&&r.length>=3&&(e=parseInt(r[2],10)),"ReactNative"===navigator.product&&(i="ReactNative",e=navigator.productSub||"?"),{browser:i,version:e,isWebview:s}},i}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(35)],void 0===(r=function(t){return t}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(0),e(1)],void 0===(r=function(t,i){"use strict";function e(t){i.isFunction(t,"cleanup"),this.Mi=t}return e.prototype.dispose=function(){return this.Mi.call()},e.prototype.toString=function(){return t.toString(this)},e}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(0)],void 0===(r=function(t){"use strict";function i(){this.Ai=[]}return i.prototype.add=function(i){if(!i||!t.isFunction(i.dispose))throw new Error('"disposable" must be a disposable or implement dispose');this.Ai.push(i)},i.prototype.dispose=function(){var i=[];return t.forEach(this.Ai,function(t){i.push(t.dispose())}),this.Ai=[],i},i.prototype.toString=function(){return t.toString(this)},i}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(0),e(1),e(16)],void 0===(r=function(t,i,e){"use strict";function n(){this.u={}}return n.prototype.fire=function(e,n,r){i.isStringNotEmpty(e,"name"),t.includes(t.keys(this.u),e)&&this.u[e].fire(n,r)},n.prototype.fireAsync=function(e,n,r){i.isStringNotEmpty(e,"name"),t.includes(t.keys(this.u),e)&&this.u[e].fireAsync(n,r)},n.prototype.listen=function(n,r){return i.isStringNotEmpty(n,"name"),(t.includes(t.keys(this.u),n)?this.u[n]:this.u[n]=new e).listen(r)},n.prototype.size=function(i){return t.includes(t.keys(this.u),i)?this.u[i].size():0},n.prototype.dispose=function(){t.forOwn(this.u,function(t){t.dispose()}),this.u={}},n.prototype.toString=function(){return"NamedEvents|"+t.keys(this.u).length},n}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(0),e(1),e(3)],void 0===(r=function(t,i,e){"use strict";var n="GET",r="POST",s="PUT",o="DELETE",a=1,u=2,h=1500,c={clientAborted:{id:4e3,name:"Aborted by Client"}};function f(){}function l(i,e,n,r,s){p(r=r||{});var o=v(i,m(r.queryParameters||{},e)),a=t.bind(b,this,t.now(),s);if(!o)return s(g());r.responseType&&(o.responseType=r.responseType),y(o,r),o.addEventListener("readystatechange",t.bind(w,this,o,r,a)),o.timeout=r.timeout||15e3,o.send(n)}function d(i,e,n,r,s){var o=t.bind(i,this,e,n,r),a={startTime:t.now(),isDisposed:!1};return E.call(this,e,r,o,a,s)}function p(e){i.isObject(e,"settings"),e.queryParameters&&i.isObject(e.queryParameters,"settings.queryParameters"),e.mimeType&&i.stringNotEmpty(e.mimeType,"settings.mimeType"),e.accept&&i.stringNotEmpty(e.accept,"settings.accept"),e.contentType&&i.stringNotEmpty(e.contentType,"settings.contentType"),e.responseType&&i.stringNotEmpty(e.responseType,"settings.responseType"),t.isNullOrUndefined(e.timeout)||i.isNumber(e.timeout,"settings.timeout")}function m(i,e){var n=t.reduce(i,function(t,i,e){return(t+=t?"&":"?")+e.toString()+"="+i.toString()},"");return n.length>0?e+n:e}function v(t,i){var e=new XMLHttpRequest;if("withCredentials"in e)e.open(t,i,!0);else{if("undefined"==typeof XDomainRequest)return;(e=new XDomainRequest).open(t,i)}return e}function g(){var t=new Error("unsupported");return t.code="unsupported",t}function y(i,e){var n=e.contentType||"application/json",r=e.accept||n,s=t.assign({},{"Content-Type":n,Accept:r},t.get(e,["headers"],{}));t.forOwn(s,function(t,e){i.setRequestHeader(e,t)})}function w(e,n,r){if(4===e.readyState)if(200===e.status){var s=function(i){var e=i.getAllResponseHeaders();return t.reduce(e.trim().split(/[\r\n]+/),function(t,i){var e=i.split(": "),n=e.shift(),r=e.join(": ");return n&&(t[n]=r),t},{})}(e);r(null,{data:e.response||e.responseText,headers:s,rawXhr:e})}else{var o=new Error(0===e.status?"timeout":e.statusText),a=t.get(n,["retryOptions","additionalRetryErrorCodes"],[]);t.forEach(a,function(t){i.isNumber(t,"additionalRetryErrorCode")}),o.code=e.status,(e.status>=500&&e.status<600||t.includes(a,e.status))&&(o.retryable=!0),r(o)}}function b(i,e,n,r){r&&t.set(r,["stats","successResponseTime"],t.now()-i),e(n,r)}function E(i,n,r,s,o,f){f=f||1;var l=this,d=t.get(n,["delay"],null),p=t.get(n,["retryOptions","delay"],h),m=t.get(n,["retryOptions","backoff"],u),v=t.get(n,["retryOptions","maxAttempts"],a),g=f>1?p*Math.pow(f,m):d,y=function(e,a){return s.isDisposed?o(I(c.clientAborted)):e&&e.retryable&&f<v?E.call(l,i,n,r,s,o,f+1):function(i,e,n,r,s){s&&(t.set(s,["stats","totalResponseTimeForAllAttempts"],t.now()-i),t.set(s,["stats","attempts"],e)),n(r,s)}.call(l,s.startTime,f,o,e,a)},w=new e.Disposable(function(){t.isNumber(s.mostRecentTimeout)&&clearTimeout(s.mostRecentTimeout),s.isDisposed=!0});return!t.isNumber(d)&&1===f||t.get(n,["retryOptions","sync"],!1)?(r.call(l,y),w):(function(t,i,e,n,r,s){var o=this;n.mostRecentTimeout=setTimeout(function(){if(n.isDisposed)return s(I(c.clientAborted));e.call(o,s)},r)}.call(l,i,n,r,s,g,y),w)}function I(t){var i=new Error(t.name);return i.code=t.id,i}return f.prototype.get=function(i,e,r){p(e=e||{});var s=m(e.queryParameters||{},i),o=v(n,s),a=t.bind(b,this,t.now(),r);if(!o)return r(g());e.mimeType&&o.overrideMimeType(e.mimeType),e.responseType&&(o.responseType=e.responseType),y(o,e),o.addEventListener("readystatechange",t.bind(w,this,o,e,a)),o.timeout=e.timeout||3e3,o.send()},f.prototype.post=function(t,i,e,n){return l.call(this,r,t,i,e,n)},f.prototype.put=function(t,i,e,n){return l.call(this,s,t,i,e,n)},f.prototype.delete=function(t,i,e,n){return l.call(this,o,t,i,e,n)},f.prototype.getWithRetry=function(i,e,n){var r=t.bind(this.get,this,i,e),s={startTime:t.now(),isDisposed:!1};return E.call(this,i,e,r,s,n)},f.prototype.postWithRetry=function(t,i,e,n){return d.call(this,this.post,t,i,e,n)},f.prototype.putWithRetry=function(t,i,e,n){return d.call(this,this.put,t,i,e,n)},f.prototype.deleteWithRetry=function(t,i,e,n){return d.call(this,this.delete,t,i,e,n)},new f}.apply(i,n))||(t.exports=r)},function(t,i,e){var n;void 0===(n=function(){"use strict";var t=function(){};t.get=function(i,e,r){if(t.isNullOrUndefined(i))return r;n(i,"objectToTraverse");var s=e;if(t.isString(s))s=o(e);else if(!t.isArray(s))throw new Error("Unsupported path type "+typeof e);var a=t.reduce(s,function(i,e){if(t.isObject(i)||t.isArray(i))return i[e]},i);return t.isUndefined(a)?r:a},t.set=function(i,e,r){if(!t.isObject(i))return i;n(i,"objectToTraverse");var s=i,a=e;if(t.isString(a))a=o(e);else if(!t.isArray(a))throw new Error("Unsupported path type "+typeof e);return t.forEach(a,function(i,e){!function(i,e,n){if(t.isNumber(parseInt(e))&&t.isArray(i))return i[e]=n;if(t.isString(e)&&t.isObject(i))return i[e]=n;throw new Error("Unsupported type "+typeof e+" when setting property or index")}(s,i,function(i,e,n,r){if(i.length-1===e)return r;var s=i[e],o=i[e+1];if(t.isArray(n[s])||t.isObject(n[s]))return n[s];if(!t.isArray(n[s])&&t.isNumber(parseInt(o)))return[];if(!t.isObject(n[s])&&t.isString(o))return{};throw new Error("Unsupported type "+typeof s+" when setting property or index")}(a,e,s,r)),s=s[i]}),i},t.bind=function(i,e){var n=Array.prototype.slice.call(arguments,2);return function(){if(!t.isFunction(i))throw new TypeError("_.bind - callback must be a function");var r=n.concat(Array.prototype.slice.call(arguments));return i.apply(e,r)}},t.now=function(){return(new Date).getTime()},t.utc=function(i){return t.isNumber(i)?i:i?Math.floor(i):NaN},t.isoString=function(){var i=new Date;return i.toISOString?i.toISOString():i.getUTCFullYear()+"-"+t.pad(i.getUTCMonth()+1,2)+"-"+t.pad(i.getUTCDate(),2)+"T"+t.pad(i.getUTCHours(),2)+":"+t.pad(i.getUTCMinutes(),2)+":"+t.pad(i.getUTCSeconds(),2)+"."+(i.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"},t.map=function(i,e){n(i,"collection");var r=[];return i.constructor===Array?t.forEach(i,function(i,n){t.isString(e)&&t.isObject(i)?r.push(i[e]):t.isFunction(e)&&r.push(e(i,n))}):t.forOwn(i,function(i,n){t.isFunction(e)&&r.push(e(i,n))}),r},t.values=function(i){if(!t.isObject(i)||t.isArray(i))throw new Error("Collection must be an object.");return t.map(i,function(t){return t})},t.keys=function(i){if(!t.isObject(i)||t.isArray(i))throw new Error("Collection must be an object.");return t.map(i,function(t,i){return i})},t.forEach=function(e,n){if(!t.isFunction(n))throw new Error("Callback must be a function");i(e,"collection");for(var r=0;r<e.length;r++){if(!1===n(e[r],r))return}},t.forOwn=function(i,e){if(!t.isFunction(e))throw new Error("Callback must be a function");n(i,"objectWithProperties");for(var r=Object.keys(i),s=0;s<r.length;s++){var o=r[s];(i.hasOwnProperty(o)||Object.prototype.hasOwnProperty.call(i,o))&&e(i[o],o)}},t.argumentsToArray=function(i){if(!t.isObject(i)||!i.length)throw new Error("Collection must be arguments");for(var e=[],n=0;n<i.length;n++)e.push(i[n]);return e},t.assign=function(i){n(i,"target");var e=t.argumentsToArray(arguments);return e.shift(),t.forEach(e,function(e,r){n(e,"source "+r),t.forOwn(e,function(t,e){i[e]=t})}),i},t.includes=function(i,e){if(t.isString(i))return s(e,"Includes value and search parameter"),i.indexOf(e)>-1;if(t.isUndefined(i)||t.isUndefined(e))return!1;n(i,"collection");var r=!1,o=function(t){t===e&&(r=!0)};return i.constructor===Array?t.forEach(i,o):t.forOwn(i,o),r},t.reduce=function(i,e,r){n(i,"collection");var s=r===t.noop()?null:r;return i.constructor===Array?t.forEach(i,function(t,i){s=e(s,t,i)}):t.forOwn(i,function(t,i){s=e(s,t,i)}),s},t.sample=function(t){return i(t,"collection"),t[Math.floor(Math.random()*t.length)]},t.uniqueId=function(){return(t.now()*Math.random()).toString()},t.find=function(e,n,r){var s;return i(e,"collection"),t.forEach(e,function(t,i){if(n(t)&&i>=(r||0))return s=t}),s},t.findIndex=function(e,n,r){var s;return i(e,"collection"),t.forEach(e,function(t,i){if(n(t,i)&&i>=(r||0))return s=i}),s},t.filter=function(e,n){i(e,"collection");var r=[];return t.forEach(e,function(t){n(t)&&r.push(t)}),r},t.remove=function(e,n){i(e,"collection");return t.filter(e,function(t){return!n(t)})},t.take=function(t,e){return i(t,"collection"),t.slice(0,e)},t.hasDifferences=function(i,e,n){return t.findDifferences(i,e,n).length>0},t.findDifferences=function(i,e,n){var r=[],s={};function o(o,a){s[a]=1,(t.isObject(o)||t.isArray(o))&&n?t.hasIndexOrKey(e,a)&&t.sameTypes(i[a],e[a])?t.hasDifferences(i[a],e[a],n)&&r.push(a):r.push(a):i[a]!==e[a]&&r.push(a)}if(t.isArray(i)&&t.isArray(e))i.length>e.length?t.forEach(i,o):t.forEach(e,o);else{if(!t.isObject(i)||!t.isObject(e)||t.isArray(i)||t.isArray(e))throw new Error("Object types do not match");t.forOwn(i,o),t.forOwn(e,function(t,i){s.hasOwnProperty(i)||r.push(i)})}return r},t.hasIndexOrKey=function(i,e){return t.isArray(i)?i.length>parseInt(e):!!t.isObject(i)&&i.hasOwnProperty(e)},t.startsWith=function(t,i){return s(t,"value"),s(i,"prefix"),0===t.indexOf(i)},t.sameTypes=function(i,e){return t.isNullOrUndefined(i)||t.isNullOrUndefined(e)?t.isNullOrUndefined(i)&&t.isNullOrUndefined(e):t.isArray(i)||t.isArray(e)?t.isArray(i)&&t.isArray(e):typeof i==typeof e},t.freeze=function(t){return"freeze"in Object?Object.freeze(t):t},t.noop=function(){},t.isObject=function(t){return null!==t&&"object"==typeof t},t.isArray=function(i){return!!t.isObject(i)&&i.constructor===Array},t.isString=function(t){return"string"==typeof t},t.isNumber=function(t){return!isNaN(t)&&"number"==typeof t},t.isBoolean=function(t){return"boolean"==typeof t},t.isFunction=function(t){return"function"==typeof t},t.isNullOrUndefined=function(i){return null===i||t.isUndefined(i)},t.isUndefined=function(t){return void 0===t},t.getEnumName=function(i,e){var n=null,r=t.map(i,function(t){return t});return t.isNumber(e)?n=t.find(r,function(t){return t.id===e}):t.isString(e)&&(n=t.find(r,function(t){return t.name.toLowerCase()===e.toLowerCase()})),n?n.name:null},t.toString=function(i){if(t.isString(i))return i;if(t.isBoolean(i))return i?"true":"false";if(t.isNumber(i))return i.toString();var e="";if(i)if(t.isFunction(i.toString))e=i.toString();else if(t.isObject(i.toString))try{e=i.toString()}catch(t){e="[object invalid toString()]"}if(0!==e.indexOf("[object"))return e;var n=[];return e+JSON.stringify(i,function(i,e){if(t.isObject(e)&&!t.isNullOrUndefined(e)){if(t.includes(n,e))return"<recursive>";n.push(e)}return""===i?e:t.toString(e)})},t.pad=function(t,i){e(t,"value"),e(i,"numberToPad");for(var n=t.toString().length,r=0;r<i-n;r++)t="0"+t.toString();return t.toString()},t.addEventListener=function(t,i,e,o){n(t,"target"),s(i,"eventName"),r(e,"listener"),t.phenixAddEventListener?t.phenixAddEventListener.call(t,i,e,!!o):t.addEventListener?t.addEventListener(i,e,!!o):t.attachEvent&&t.attachEvent("on"+i,e)},t.removeEventListener=function(t,i,e,o){n(t,"target"),s(i,"eventName"),r(e,"listener"),t.phenixRemoveEventListener?t.phenixRemoveEventListener.call(t,i,e,!!o):t.removeEventListener?t.removeEventListener(i,e,!!o):t.detachEvent&&t.detachEvent("on"+i,e)};var i=function(i){if(!t.isArray(i))throw new Error("Input must be an array.")},e=function(i,e){if(s(e,"name"),!t.isNumber(i))throw new Error(e+" must be a number.")},n=function(i,e){if(s(e,"name"),!t.isObject(i))throw new Error("collection type not supported - "+e+" must be an array or object.")},r=function(i,e){if(s(e,"name"),!t.isFunction(i))throw new Error(e+" must be a function.")},s=function(i,e){if(!t.isString(e))throw new Error("Name must be a string.");if(!t.isString(i))throw new Error(e+" must be a string.")};function o(i){var e=i.split("."),n=[];return t.forEach(e,function(i){n=n.concat(function(i){for(var e="",n=[],r=0,s=0;s<i.length;s++)if("["===i[s]){if(r++,!t.isString(e)||r>1)return[i];e&&(n.push(e),e="")}else if("]"===i[s]){if(0!==--r)return[i];n.push(e),e=""}else{if(s===i.length-1)return[i];e+=i[s]}return n}(i))}),n}return t}.apply(i,[]))||(t.exports=n)},function(t,i,e){var n,r;n=[e(0),e(1),e(11)],void 0===(r=function(t,i,e){"use strict";function n(){this.qi=e.level.TRACE}n.prototype.setThreshold=function(t){i.isNumber(t,"level"),this.qi=t},n.prototype.getThreshold=function(){return this.qi},n.prototype.log=function(t,i,n,o,a,u,h,c,f){f.level<this.qi||(o[0]=t+" ["+n+"] "+i+" "+o[0],f.level>e.level.INFO?s(o):r(o))};var r=function(t){console.log.apply(console,t)}||function(){},s=function(t){console.error.apply(console,t)}||r;return n}.apply(i,n))||(t.exports=r)},function(t,i,e){(function(n){var r,s;r=[e(0),e(1),e(11)],void 0===(s=function(t,i,e){"use strict";var r="websdk",s=p().Ni||p().Pi||t.now(),o="production",a="2018-04-10T16:20:23Z",u="2018.2.0";function h(){this.ji=[],this.Ui=null,this.Di=null,this.Fi=o,this.Li=a}function c(t){this.Di=t,t?this.info("Session started on websdk version [%s] ([%s]), user agent [%s]",a,u,navigator.userAgent):this.info("Websdk version [%s] ([%s]), user agent [%s]",a,u,navigator.userAgent)}function f(i,n){var o=(t.now()-s)/1e3,a=function(t){switch(t){case e.level.TRACE:return"Trace";case e.level.DEBUG:return"Debug";case e.level.INFO:return"Info";case e.level.WARN:return"Warn";case e.level.ERROR:return"Error";case e.level.FATAL:return"Fatal";default:throw new Error("Unsupported Logging Level "+t)}}(n.level),u=n.name||r,h=this;t.forEach(this.ji,function(t){try{t.log(o,a,u,l(Array.prototype.slice.call(i)),h.Di,h.Ui,h.Fi,h.Li,n)}catch(t){}})}h.prototype.trace=function(){return f.call(this,arguments,{level:e.level.TRACE})},h.prototype.debug=function(){return f.call(this,arguments,{level:e.level.DEBUG})},h.prototype.info=function(){return f.call(this,arguments,{level:e.level.INFO})},h.prototype.warn=function(){return f.call(this,arguments,{level:e.level.WARN})},h.prototype.error=function(){return f.call(this,arguments,{level:e.level.ERROR})},h.prototype.fatal=function(){return f.call(this,arguments,{level:e.level.FATAL})},h.prototype.addAppender=function(t){i.isObject(t,"appender"),i.isFunction(t.log,"appender.log"),this.ji.push(t)},h.prototype.getAppenders=function(){return this.ji},h.prototype.getUserId=function(){return this.Ui},h.prototype.setUserId=function(t){this.Ui=t},h.prototype.getEnvironment=function(){return this.Fi},h.prototype.setEnvironment=function(t){this.Fi=t},h.prototype.getApplicationVersion=function(){return this.Li},h.prototype.setApplicationVersion=function(t){this.Li=t},h.prototype.getObservableSessionId=function(){return this.Bi},h.prototype.setObservableSessionId=function(e){this.Bi=e,this.Vi&&this.Vi.dispose(),e&&(i.isObject(e,"observableSessionId"),this.Vi=this.Bi.subscribe(t.bind(c,this),{initial:"notify"}))};var l=function(i){if(0!==i.length){var e=[],n=[];return t.forEach(i,function(i){e.push(t.toString(i)),i instanceof Error&&n.push(i.stack)}),d(e.concat(n))}},d=function(t){for(var i=t[0],e=0;i.indexOf&&t.length>1&&e>=0;){if((e=i.indexOf("%",e))>0)switch(i.substring(e+1,e+2)){case"%":i=i.substring(0,e)+i.substring(e+1),e++;break;case"s":case"d":t[0]=i=i.substring(0,e)+t[1]+i.substring(e+2),t.splice(1,1);break;default:return t}}return t};function p(){return"object"==typeof window?window:"object"==typeof n?n:{}}return h}.apply(i,r))||(t.exports=s)}).call(i,e(54))},function(t,i,e){var n,r;n=[e(0),e(4),e(7),e(3)],void 0===(r=function(t,i,e,n){"use strict";function r(){var n="undefined"==typeof navigator||navigator.onLine;this.Wi=new e.Observable(n).extend({timeout:0}),this.kt=new i.NamedEvents,"undefined"!=typeof window&&(t.addEventListener(window,"online",t.bind(this.kt.fire,this.kt,"online",[])),t.addEventListener(window,"offline",t.bind(this.kt.fire,this.kt,"offline",[])),t.addEventListener(window,"unload",t.bind(this.kt.dispose,this.kt))),this.kt.listen("online",t.bind(this.Wi.setValue,this.Wi,!0)),this.kt.listen("offline",t.bind(this.Wi.setValue,this.Wi,!1))}function s(i,e){var n=this;if(this.Wi.setValue(!1),!t.isNumber(e))return i(!1);n.offlineTimeout=setTimeout(function(){i&&!n.Wi.getValue()&&i(!1)},e)}function o(t){this.Wi.setValue(!0),t&&t(!0)}return r.prototype.listenForNetworkChange=function(i,e){var r=new n.DisposableList,a=t.bind(o,this,i),u=t.bind(s,this,i,e);return r.add(this.kt.listen("online",a)),r.add(this.kt.listen("offline",u)),r},r.prototype.isOnline=function(){return this.Wi.getValue()},new r}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(0),e(1),e(18)],void 0===(r=function(t,i,e){"use strict";function n(t,n){var r=t;void 0!==r&&null!==r||(r=[]),i.isArray(r,"valuesToSet"),this.observableArray=new e(r,n)}return n.prototype.getValue=function(){return this.observableArray.getValue()},n.prototype.setValue=function(t){return void 0!==t&&null!==t||(t=[]),void 0!==t&&i.isArray(t,"values"),this.observableArray.setValue(t)},n.prototype.subscribe=function(t,i){return this.observableArray.subscribe(t,i)},n.prototype.push=function(t){var i=this.observableArray.getValue();i.push(t),this.observableArray.setValue(i)},n.prototype.pop=function(){var t=this.observableArray.getValue(),i=t.pop();return this.observableArray.setValue(t),i},n.prototype.remove=function(i){var e=this.observableArray.getValue(),n=function(e){return t.isFunction(i)?i(e):e===i},r=t.filter(e,n);return r.length>0&&this.observableArray.setValue(t.remove(e,n)),r},n.prototype.removeAll=function(){var t=this.observableArray.getValue();return this.observableArray.setValue([]),t},n.prototype.extend=function(t){return this.observableArray.extend(t),this},n}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(0),e(1)],void 0===(r=function(t,i){"use strict";function e(t){i.isObject(t,"observable"),this.zi=t,this._i=null,this.wi=!1}return e.prototype.start=function(i,e){this.wi=!0,this._i=this.zi.subscribe(t.noop,{listenForChanges:{callback:i,timeout:e||500}})},e.prototype.stop=function(){this.wi=!1,this._i&&this._i.dispose(),this._i=null},e.prototype.isEnabled=function(){return this.wi},e}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(0),e(1),e(32),e(19),e(10)],void 0===(r=function(t,i,e,n,r){function s(t,i,e){return t.encode(i,e).toBinary()}function o(t,i,e){return t.decode(i+"Response",r.fromBinary(e))}return function(r,a,u,h,c){i.isStringNotEmpty(r,"uri"),i.isArray(a,"protocols"),i.isStringNotEmpty(u,"type"),i.isObject(h,"options");var f=t.assign({},h||{},{contentType:"application/protobuf"}),l=new n(a,c);return new e(r,f,t.bind(s,this,l,u),t.bind(o,this,l,u))}}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(0),e(1),e(4),e(51),e(20)],void 0===(r=function(t,i,e,n,r){"use strict";function s(s,o,p,m){i.isStringNotEmpty(s,"uri"),i.isObject(o,"logger"),i.isArray(p,"protocols"),this.gi=s,this.R=o,this.R.info("Connecting to [%s]",s),this.Nt=new n(this.gi,this.R),this.Hi=new r(this.R,t.bind(d,this),t.bind(l,this),p,m),this.kt=new e.NamedEvents,this.Nt.onconnected=t.bind(u,this),this.Nt.onreconnecting=t.bind(a,this),this.Nt.onreconnected=t.bind(h,this),this.Nt.ondisconnected=t.bind(c,this),this.Nt.onerror=t.bind(f,this),this.$i=!1}function o(t,i){this.kt.fire(t,i,this)}function a(t){o.call(this,"reconnecting")}function u(t){o.call(this,"connected")}function h(t){o.call(this,"reconnected")}function c(t){o.call(this,"disconnected",[t.code,t.reason]),this.$i&&(this.kt.dispose(),this.Hi.dispose())}function f(t){o.call(this,"error",[t.data])}function l(t){this.Nt.onmessage=t}function d(t){this.Nt&&this.Nt.send(t)}return s.prototype.onEvent=function(t,i){return this.kt.listen(t,i),this.Hi.onEvent(t,i)},s.prototype.onRequest=function(t,i){return this.Hi.onRequest(t,i)},s.prototype.sendRequest=function(t,i,e,n){return this.Hi.sendRequest(t,i,e,n)},s.prototype.sendResponse=function(t,i,e,n){return this.Hi.sendResponse(t,i,e,n)},s.prototype.disconnect=function(){return this.$i=!0,this.Nt.disconnect()},s.prototype.disposeOfPendingRequests=function(){return this.R.info("Disposing of pending MQ WebSocket requests"),this.Hi.disposeOfRequests()},s.prototype.getApiVersion=function(){return this.Hi.getApiVersion()},s.prototype.toString=function(){return"MQWebSocket["+this.Nt.toString()+"]"},s}.apply(i,n))||(t.exports=r)},function(t,i,e){var n;void 0===(n=function(){"use strict";return{package:"mq",messages:[{name:"Message",fields:[{rule:"optional",type:"MessageType",name:"messageType",id:7,options:{default:"Request"}},{rule:"optional",type:"string",name:"sessionId",id:1},{rule:"optional",type:"string",name:"requestId",id:2},{rule:"required",type:"string",name:"type",id:3},{rule:"optional",type:"string",name:"encoding",id:4},{rule:"required",type:"bytes",name:"payload",id:5},{rule:"repeated",type:"double",name:"wallTime",id:6}],enums:[{name:"MessageType",values:[{name:"Request",id:0},{name:"Response",id:1},{name:"Event",id:2}]}]},{name:"Error",fields:[{rule:"required",type:"string",name:"reason",id:1}]},{name:"PingPong",fields:[{rule:"required",type:"uint64",name:"originTimestamp",id:1},{rule:"optional",type:"uint64",name:"count",id:2}]}]}}.apply(i,[]))||(t.exports=n)},function(t,i,e){var n,r;n=[e(0),e(1),e(17)],void 0===(r=function(t,i,e){"use strict";var n=15e3,r=1e3,s=1e3,o=4,a={byebye:{code:1e3,reason:"byebye",desc:"Client closed"},backoffLimitReached:{code:4e3,reason:"backoff-limit-reached",desc:"Reached the limit in terms of the number of reconnects"},networkDisconnect:{code:4001,reason:"network-disconnect",desc:"Network connection monitor determined loss to internet connectivity"},reconnecting:{code:4002,reason:"reconnecting",desc:"Closing WebSocket in order to attempt to establish another connection"}},u={connecting:{code:0,state:"CONNECTING",desc:"The connection is not yet open"},open:{code:1,state:"OPEN",desc:"The connection is open and ready to communicate"},closing:{code:2,state:"CLOSING",desc:"The connection is in the process of closing"},closed:{code:3,state:"CLOSED",desc:"The connection is closed or could not be opened"}};function h(h,c,l,y){i.isStringNotEmpty(h,"uri"),i.isObject(c,"logger"),t.isNullOrUndefined(l)?l=o:i.isNumber(l,"maxReconnectAttempts"),this.gi=h,this.R=c,this.Gi=l,this.Qi=y||s,this.Ji=!1,this.Q=!1,this.Ki=[],this.Xi="connecting",this.R.info("Connecting WebSocket to [%s]",h),this.Nt=f.call(this,m,d);var w=this;this.Zi=null,this.Yi=e.listenForNetworkChange(function(i){if(i)return t.isNumber(w.Zi)&&(clearTimeout(w.Zi),w.Zi=null),function(){var t=this;setTimeout(function(){return t.Q?t.R.info("Unable to go back online after network reconnect. Client has stopped WebSocket."):t.Nt.readyState!==u.open.code?(t.R.info("Network Reconnected. Attempting to reconnect WebSocket."),t.reconnect()):t.te?(t.R.info("Network Reconnected with WebSocket status of [%s].",u.open.state),m.call(t)):("online"===t.Xi&&"reconnected"===this.Xi||v.call(t),void t.R.info("Network Reconnected."))},r)}.call(w);t.isNumber(w.Zi)||(p.call(w),w.Zi=setTimeout(function(){return function(){this.R.warn("Network not reconnected after [%s]. Going Offline and disconnecting WebSocket connection.",n),this.te=!0,g.call(this,a.networkDisconnect)}.call(w)},n))},0)}function c(t){return this.Nt.readyState===u.closed.code?d.call(this,t):this.Nt.close(t.code,t.reason)}function f(i,e){var n=new WebSocket(this.gi);return n.onopen=t.bind(i,this),n.onclose=t.bind(e,this),n.onmessage=t.bind(w,this),n.onerror=t.bind(y,this),n}function l(t){this.Nt.readyState!==u.open.code&&this.reconnect(t+1)}function d(t){switch(t.code){case a.reconnecting.code:return;case a.byebye.code:case a.backoffLimitReached.code:case a.networkDisconnect.code:return g.call(this,t);default:if(this.Ji)return;return p.call(this,t),this.R.info("Attempting to re-establish socket connection after disconnect event with code [%s] and reason [%s]",t.code,t.reason),this.reconnect()}}function p(t){this.R.info("WebSocket is reconnecting"),this.Xi="reconnecting",this.onreconnecting&&this.onreconnecting(t)}function m(t){this.R.info("WebSocket Connected"),function(){var t=this.Ki.length;if(0===t)return;this.R.info("Sending [%s] queued messages",t);for(;t>0;){t--;var i=this.Ki.shift();this.send(i)}}.call(this),this.Xi="connected",this.onconnected&&this.onconnected(t)}function v(t){this.R.info("Successfully reconnected to WebSocket"),this.Xi="reconnected",this.onreconnected&&this.onreconnected(t)}function g(t){this.R.info("WebSocket Disconnected [%s]: [%s]",t.code,t.reason),this.Xi="disconnected",this.ondisconnected&&this.ondisconnected(t)}function y(t){this.R.error("An error occurred on the WebSocket connection [%s]",t.data||t),this.onerror&&this.onerror(t)}function w(t){this.R.debug(">> [%s]",t.data),this.onmessage&&this.onmessage(t)}return h.prototype.onmessage=null,h.prototype.onconnected=null,h.prototype.onreconnecting=null,h.prototype.onreconnected=null,h.prototype.ondisconnected=null,h.prototype.onerror=null,h.prototype.send=function(t){return e.isOnline(),this.Nt.send(t)},h.prototype.reconnect=function(i){this.Nt.onclose=null,this.Nt.onerror=null,this.Ji=!0;var e,n=this;if(t.isNumber(i)||(i=1),this.Q)return this.R.info("Client has stopped WebSocket after [%s] reconnect attempts",i-1);if(i>this.Gi)return this.R.warn("Unable to reconnect WebSocket after [%s] attempts",this.Gi),c.call(this,a.backoffLimitReached);c.call(this,a.reconnecting);try{this.Nt=f.call(n,function(){return e&&clearTimeout(e),n.Ji=!1,n.Nt.onclose=t.bind(d,n),v.call(n)},function(){i+1>n.Gi&&(e&&clearTimeout(e),l.call(n,i))})}catch(t){this.R.warn("Unable to create WebSocket connection [%s]",t)}e=function(t){var i=this;return setTimeout(function(){l.call(i,t)},t*t*this.Qi)}.call(this,i)},h.prototype.disconnect=function(){return this.Yi.dispose(),this.Q=!0,t.isNumber(this.Zi)&&(clearTimeout(this.Zi),this.Zi=null),this.Nt.close(a.byebye.code,a.byebye.reason)},h.prototype.toString=function(){return"ReconnectedWebSocket["+this.gi+","+this.Nt.readyState+"]"},h}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(50)],void 0===(r=function(t){"use strict";return t}.apply(i,n))||(t.exports=r)},function(t,i){var e,n,r=t.exports={};function s(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(t){if(e===setTimeout)return setTimeout(t,0);if((e===s||!e)&&setTimeout)return e=setTimeout,setTimeout(t,0);try{return e(t,0)}catch(i){try{return e.call(null,t,0)}catch(i){return e.call(this,t,0)}}}!function(){try{e="function"==typeof setTimeout?setTimeout:s}catch(t){e=s}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(t){n=o}}();var u,h=[],c=!1,f=-1;function l(){c&&u&&(c=!1,u.length?h=u.concat(h):f=-1,h.length&&d())}function d(){if(!c){var t=a(l);c=!0;for(var i=h.length;i;){for(u=h,h=[];++f<i;)u&&u[f].run();f=-1,i=h.length}u=null,c=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(i){try{return n.call(null,t)}catch(i){return n.call(this,t)}}}(t)}}function p(t,i){this.fun=t,this.array=i}function m(){}r.nextTick=function(t){var i=new Array(arguments.length-1);if(arguments.length>1)for(var e=1;e<arguments.length;e++)i[e-1]=arguments[e];h.push(new p(t,i)),1!==h.length||c||a(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=m,r.addListener=m,r.once=m,r.off=m,r.removeListener=m,r.removeAllListeners=m,r.emit=m,r.prependListener=m,r.prependOnceListener=m,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(t,i,e){(function(n){var r,s,o,a;
/**
 * @license protobuf.js (c) 2013 Daniel Wirtz <dcode@dcode.io>
 * Released under the Apache License, Version 2.0
 * see: https://github.com/dcodeIO/protobuf.js for details
 */
/**
 * @license protobuf.js (c) 2013 Daniel Wirtz <dcode@dcode.io>
 * Released under the Apache License, Version 2.0
 * see: https://github.com/dcodeIO/protobuf.js for details
 */
a=function(t,i){"use strict";var r,s={};return s.ByteBuffer=t,s.Long=t.Long||null,s.VERSION="5.0.0",s.WIRE_TYPES={},s.WIRE_TYPES.VARINT=0,s.WIRE_TYPES.BITS64=1,s.WIRE_TYPES.LDELIM=2,s.WIRE_TYPES.STARTGROUP=3,s.WIRE_TYPES.ENDGROUP=4,s.WIRE_TYPES.BITS32=5,s.PACKABLE_WIRE_TYPES=[s.WIRE_TYPES.VARINT,s.WIRE_TYPES.BITS64,s.WIRE_TYPES.BITS32],s.TYPES={int32:{name:"int32",wireType:s.WIRE_TYPES.VARINT,defaultValue:0},uint32:{name:"uint32",wireType:s.WIRE_TYPES.VARINT,defaultValue:0},sint32:{name:"sint32",wireType:s.WIRE_TYPES.VARINT,defaultValue:0},int64:{name:"int64",wireType:s.WIRE_TYPES.VARINT,defaultValue:s.Long?s.Long.ZERO:void 0},uint64:{name:"uint64",wireType:s.WIRE_TYPES.VARINT,defaultValue:s.Long?s.Long.UZERO:void 0},sint64:{name:"sint64",wireType:s.WIRE_TYPES.VARINT,defaultValue:s.Long?s.Long.ZERO:void 0},bool:{name:"bool",wireType:s.WIRE_TYPES.VARINT,defaultValue:!1},double:{name:"double",wireType:s.WIRE_TYPES.BITS64,defaultValue:0},string:{name:"string",wireType:s.WIRE_TYPES.LDELIM,defaultValue:""},bytes:{name:"bytes",wireType:s.WIRE_TYPES.LDELIM,defaultValue:null},fixed32:{name:"fixed32",wireType:s.WIRE_TYPES.BITS32,defaultValue:0},sfixed32:{name:"sfixed32",wireType:s.WIRE_TYPES.BITS32,defaultValue:0},fixed64:{name:"fixed64",wireType:s.WIRE_TYPES.BITS64,defaultValue:s.Long?s.Long.UZERO:void 0},sfixed64:{name:"sfixed64",wireType:s.WIRE_TYPES.BITS64,defaultValue:s.Long?s.Long.ZERO:void 0},float:{name:"float",wireType:s.WIRE_TYPES.BITS32,defaultValue:0},enum:{name:"enum",wireType:s.WIRE_TYPES.VARINT,defaultValue:0},message:{name:"message",wireType:s.WIRE_TYPES.LDELIM,defaultValue:null},group:{name:"group",wireType:s.WIRE_TYPES.STARTGROUP,defaultValue:null}},s.MAP_KEY_TYPES=[s.TYPES.int32,s.TYPES.sint32,s.TYPES.sfixed32,s.TYPES.uint32,s.TYPES.fixed32,s.TYPES.int64,s.TYPES.sint64,s.TYPES.sfixed64,s.TYPES.uint64,s.TYPES.fixed64,s.TYPES.bool,s.TYPES.string,s.TYPES.bytes],s.ID_MIN=1,s.ID_MAX=536870911,s.convertFieldsToCamelCase=!1,s.populateAccessors=!0,s.populateDefaults=!0,s.Util=((r={}).IS_NODE=!("object"!=typeof n||n+""!="[object process]"||n.browser),r.XHR=function(){for(var t=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],i=null,e=0;e<t.length;e++){try{i=t[e]()}catch(t){continue}break}if(!i)throw Error("XMLHttpRequest is not supported");return i},r.fetch=function(t,i){if(i&&"function"!=typeof i&&(i=null),r.IS_NODE){var n=e(81);if(i)n.readFile(t,function(t,e){i(t?null:""+e)});else try{return n.readFileSync(t)}catch(t){return null}}else{var s=r.XHR();if(s.open("GET",t,!!i),s.setRequestHeader("Accept","text/plain"),"function"==typeof s.overrideMimeType&&s.overrideMimeType("text/plain"),!i)return s.send(null),200==s.status||0==s.status&&"string"==typeof s.responseText?s.responseText:null;if(s.onreadystatechange=function(){4==s.readyState&&(200==s.status||0==s.status&&"string"==typeof s.responseText?i(s.responseText):i(null))},4==s.readyState)return;s.send(null)}},r.toCamelCase=function(t){return t.replace(/_([a-zA-Z])/g,function(t,i){return i.toUpperCase()})},r),s.Lang={DELIM:/[\s\{\}=;:\[\],'"\(\)<>]/g,RULE:/^(?:required|optional|repeated|map)$/,TYPE:/^(?:double|float|int32|uint32|sint32|int64|uint64|sint64|fixed32|sfixed32|fixed64|sfixed64|bool|string|bytes)$/,NAME:/^[a-zA-Z_][a-zA-Z_0-9]*$/,TYPEDEF:/^[a-zA-Z][a-zA-Z_0-9]*$/,TYPEREF:/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)+$/,FQTYPEREF:/^(?:\.[a-zA-Z][a-zA-Z_0-9]*)+$/,NUMBER:/^-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+|([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?)|inf|nan)$/,NUMBER_DEC:/^(?:[1-9][0-9]*|0)$/,NUMBER_HEX:/^0[xX][0-9a-fA-F]+$/,NUMBER_OCT:/^0[0-7]+$/,NUMBER_FLT:/^([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?|inf|nan)$/,BOOL:/^(?:true|false)$/i,ID:/^(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,NEGID:/^\-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,WHITESPACE:/\s/,STRING:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")|(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,STRING_DQ:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,STRING_SQ:/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g},s.DotProto=function(t,i){var e={},n=function(t){this.source=t+"",this.index=0,this.line=1,this.stack=[],this.ie=null},r=n.prototype;r.ee=function(){var t='"'===this.ie?i.STRING_DQ:i.STRING_SQ;t.lastIndex=this.index-1;var e=t.exec(this.source);if(!e)throw Error("unterminated string");return this.index=t.lastIndex,this.stack.push(this.ie),this.ie=null,e[1]},r.next=function(){if(this.stack.length>0)return this.stack.shift();if(this.index>=this.source.length)return null;if(null!==this.ie)return this.ee();var t,e,n;do{for(t=!1;i.WHITESPACE.test(n=this.source.charAt(this.index));)if("\n"===n&&++this.line,++this.index===this.source.length)return null;if("/"===this.source.charAt(this.index))if(++this.index,"/"===this.source.charAt(this.index)){for(;"\n"!==this.source.charAt(++this.index);)if(this.index==this.source.length)return null;++this.index,++this.line,t=!0}else{if("*"!==(n=this.source.charAt(this.index)))return"/";do{if("\n"===n&&++this.line,++this.index===this.source.length)return null;e=n,n=this.source.charAt(this.index)}while("*"!==e||"/"!==n);++this.index,t=!0}}while(t);if(this.index===this.source.length)return null;var r=this.index;if(i.DELIM.lastIndex=0,!i.DELIM.test(this.source.charAt(r++)))for(;r<this.source.length&&!i.DELIM.test(this.source.charAt(r));)++r;var s=this.source.substring(this.index,this.index=r);return'"'!==s&&"'"!==s||(this.ie=s),s},r.peek=function(){if(0===this.stack.length){var t=this.next();if(null===t)return null;this.stack.push(t)}return this.stack[0]},r.skip=function(t){var i=this.next();if(i!==t)throw Error("illegal '"+i+"', '"+t+"' expected")},r.omit=function(t){return this.peek()===t&&(this.next(),!0)},r.toString=function(){return"Tokenizer ("+this.index+"/"+this.source.length+" at line "+this.line+")"},e.Tokenizer=n;var s=function(t){this.tn=new n(t),this.proto3=!1},o=s.prototype;function a(t,e){var n=-1,r=1;if("-"==t.charAt(0)&&(r=-1,t=t.substring(1)),i.NUMBER_DEC.test(t))n=parseInt(t);else if(i.NUMBER_HEX.test(t))n=parseInt(t.substring(2),16);else{if(!i.NUMBER_OCT.test(t))throw Error("illegal id value: "+(r<0?"-":"")+t);n=parseInt(t.substring(1),8)}if(n=r*n|0,!e&&n<0)throw Error("illegal id value: "+(r<0?"-":"")+t);return n}function u(t){var e=1;if("-"==t.charAt(0)&&(e=-1,t=t.substring(1)),i.NUMBER_DEC.test(t))return e*parseInt(t,10);if(i.NUMBER_HEX.test(t))return e*parseInt(t.substring(2),16);if(i.NUMBER_OCT.test(t))return e*parseInt(t.substring(1),8);if("inf"===t)return e*(1/0);if("nan"===t)return NaN;if(i.NUMBER_FLT.test(t))return e*parseFloat(t);throw Error("illegal number value: "+(e<0?"-":"")+t)}function h(t,i,e){void 0===t[i]?t[i]=e:(Array.isArray(t[i])||(t[i]=[t[i]]),t[i].push(e))}return o.parse=function(){var t,e={name:"[ROOT]",package:null,messages:[],enums:[],imports:[],options:{},services:[]},n=!0;try{for(;t=this.tn.next();)switch(t){case"package":if(!n||null!==e.package)throw Error("unexpected 'package'");if(t=this.tn.next(),!i.TYPEREF.test(t))throw Error("illegal package name: "+t);this.tn.skip(";"),e.package=t;break;case"import":if(!n)throw Error("unexpected 'import'");"public"===(t=this.tn.peek())&&this.tn.next(),t=this.ee(),this.tn.skip(";"),e.imports.push(t);break;case"syntax":if(!n)throw Error("unexpected 'syntax'");this.tn.skip("="),"proto3"===(e.syntax=this.ee())&&(this.proto3=!0),this.tn.skip(";");break;case"message":this.ne(e,null),n=!1;break;case"enum":this.re(e),n=!1;break;case"option":this.se(e);break;case"service":this.oe(e);break;case"extend":this.ae(e);break;default:throw Error("unexpected '"+t+"'")}}catch(t){throw t.message="Parse error at line "+this.tn.line+": "+t.message,t}return delete e.name,e},s.parse=function(t){return new s(t).parse()},o.ee=function(){var t,i,e="";do{if("'"!==(i=this.tn.next())&&'"'!==i)throw Error("illegal string delimiter: "+i);e+=this.tn.next(),this.tn.skip(i),t=this.tn.peek()}while('"'===t||'"'===t);return e},o.ue=function(t){var e=this.tn.peek();if('"'===e||"'"===e)return this.ee();if(this.tn.next(),i.NUMBER.test(e))return u(e);if(i.BOOL.test(e))return"true"===e.toLowerCase();if(t&&i.TYPEREF.test(e))return e;throw Error("illegal value: "+e)},o.se=function(t,e){var n=this.tn.next(),r=!1;if("("===n&&(r=!0,n=this.tn.next()),!i.TYPEREF.test(n))throw Error("illegal option name: "+n);var s=n;r&&(this.tn.skip(")"),s="("+s+")",n=this.tn.peek(),i.FQTYPEREF.test(n)&&(s+=n,this.tn.next())),this.tn.skip("="),this.he(t,s),e||this.tn.skip(";")},o.he=function(t,e){var n=this.tn.peek();if("{"!==n)h(t.options,e,this.ue(!0));else for(this.tn.skip("{");"}"!==(n=this.tn.next());){if(!i.NAME.test(n))throw Error("illegal option name: "+e+"."+n);this.tn.omit(":")?h(t.options,e+"."+n,this.ue(!0)):this.he(t,e+"."+n)}},o.oe=function(t){var e=this.tn.next();if(!i.NAME.test(e))throw Error("illegal service name at line "+this.tn.line+": "+e);var n={name:e,rpc:{},options:{}};for(this.tn.skip("{");"}"!==(e=this.tn.next());)if("option"===e)this.se(n);else{if("rpc"!==e)throw Error("illegal service token: "+e);this.ce(n)}this.tn.omit(";"),t.services.push(n)},o.ce=function(t){var e=this.tn.next();if(!i.NAME.test(e))throw Error("illegal rpc service method name: "+e);var n=e,r={request:null,response:null,request_stream:!1,response_stream:!1,options:{}};if(this.tn.skip("("),"stream"===(e=this.tn.next()).toLowerCase()&&(r.request_stream=!0,e=this.tn.next()),!i.TYPEREF.test(e))throw Error("illegal rpc service request type: "+e);if(r.request=e,this.tn.skip(")"),"returns"!==(e=this.tn.next()).toLowerCase())throw Error("illegal rpc service request type delimiter: "+e);if(this.tn.skip("("),"stream"===(e=this.tn.next()).toLowerCase()&&(r.response_stream=!0,e=this.tn.next()),r.response=e,this.tn.skip(")"),"{"===(e=this.tn.peek())){for(this.tn.next();"}"!==(e=this.tn.next());){if("option"!==e)throw Error("illegal rpc service token: "+e);this.se(r)}this.tn.omit(";")}else this.tn.skip(";");void 0===t.rpc&&(t.rpc={}),t.rpc[n]=r},o.ne=function(t,e){var n=!!e,r=this.tn.next(),s={name:"",fields:[],enums:[],messages:[],options:{},services:[],oneofs:{}};if(!i.NAME.test(r))throw Error("illegal "+(n?"group":"message")+" name: "+r);for(s.name=r,n&&(this.tn.skip("="),e.id=a(this.tn.next()),s.isGroup=!0),"["===(r=this.tn.peek())&&e&&this.fe(e),this.tn.skip("{");"}"!==(r=this.tn.next());)if(i.RULE.test(r))this.le(s,r);else if("oneof"===r)this.de(s);else if("enum"===r)this.re(s);else if("message"===r)this.ne(s);else if("option"===r)this.se(s);else if("service"===r)this.oe(s);else if("extensions"===r)this.pe(s);else if("extend"===r)this.ae(s);else if("reserved"===r)this.me(s);else{if(!i.TYPEREF.test(r))throw Error("illegal message token: "+r);if(!this.proto3)throw Error("illegal field rule: "+r);this.le(s,"optional",r)}return this.tn.omit(";"),t.messages.push(s),s},o.me=function(t){for(;";"!==this.tn.peek();)this.tn.next();this.tn.skip(";")},o.le=function(t,e,n){if(!i.RULE.test(e))throw Error("illegal message field rule: "+e);var r,s={rule:e,type:"",name:"",options:{},id:0};if("map"===e){if(n)throw Error("illegal type: "+n);if(this.tn.skip("<"),r=this.tn.next(),!i.TYPE.test(r)&&!i.TYPEREF.test(r))throw Error("illegal message field type: "+r);if(s.keytype=r,this.tn.skip(","),r=this.tn.next(),!i.TYPE.test(r)&&!i.TYPEREF.test(r))throw Error("illegal message field: "+r);if(s.type=r,this.tn.skip(">"),r=this.tn.next(),!i.NAME.test(r))throw Error("illegal message field name: "+r);s.name=r,this.tn.skip("="),s.id=a(this.tn.next()),"["===(r=this.tn.peek())&&this.fe(s),this.tn.skip(";")}else if("group"===(n=void 0!==n?n:this.tn.next())){var o=this.ne(t,s);if(!/^[A-Z]/.test(o.name))throw Error("illegal group name: "+o.name);s.type=o.name,s.name=o.name.toLowerCase(),this.tn.omit(";")}else{if(!i.TYPE.test(n)&&!i.TYPEREF.test(n))throw Error("illegal message field type: "+n);if(s.type=n,r=this.tn.next(),!i.NAME.test(r))throw Error("illegal message field name: "+r);s.name=r,this.tn.skip("="),s.id=a(this.tn.next()),"["===(r=this.tn.peek())&&this.fe(s),this.tn.skip(";")}return t.fields.push(s),s},o.de=function(t){var e=this.tn.next();if(!i.NAME.test(e))throw Error("illegal oneof name: "+e);var n,r=e,s=[];for(this.tn.skip("{");"}"!==(e=this.tn.next());)(n=this.le(t,"optional",e)).oneof=r,s.push(n.id);this.tn.omit(";"),t.oneofs[r]=s},o.fe=function(t){this.tn.skip("[");for(var i=!0;"]"!==this.tn.peek();)i||this.tn.skip(","),this.se(t,!0),i=!1;this.tn.next()},o.re=function(t){var e={name:"",values:[],options:{}},n=this.tn.next();if(!i.NAME.test(n))throw Error("illegal name: "+n);for(e.name=n,this.tn.skip("{");"}"!==(n=this.tn.next());)if("option"===n)this.se(e);else{if(!i.NAME.test(n))throw Error("illegal name: "+n);this.tn.skip("=");var r={name:n,id:a(this.tn.next(),!0)};"["===(n=this.tn.peek())&&this.fe({options:{}}),this.tn.skip(";"),e.values.push(r)}this.tn.omit(";"),t.enums.push(e)},o.pe=function(i){var e=this.tn.next(),n=[];"min"===e?n.push(t.ID_MIN):"max"===e?n.push(t.ID_MAX):n.push(u(e)),this.tn.skip("to"),"min"===(e=this.tn.next())?n.push(t.ID_MIN):"max"===e?n.push(t.ID_MAX):n.push(u(e)),this.tn.skip(";"),i.extensions=n},o.ae=function(t){var e=this.tn.next();if(!i.TYPEREF.test(e))throw Error("illegal extend reference: "+e);var n={ref:e,fields:[]};for(this.tn.skip("{");"}"!==(e=this.tn.next());)if(i.RULE.test(e))this.le(n,e);else{if(!i.TYPEREF.test(e))throw Error("illegal extend token: "+e);if(!this.proto3)throw Error("illegal field rule: "+e);this.le(n,"optional",e)}return this.tn.omit(";"),t.messages.push(n),n},o.toString=function(){return"Parser at line "+this.tn.line},e.Parser=s,e}(s,s.Lang),s.Reflect=function(i){var e={},n=function(t,i,e){this.builder=t,this.parent=i,this.name=e,this.className},r=n.prototype;r.fqn=function(){for(var t=this.name,i=this;;){if(null==(i=i.parent))break;t=i.name+"."+t}return t},r.toString=function(t){return(t?this.className+" ":"")+this.fqn()},r.build=function(){throw Error(this.toString(!0)+" cannot be built directly")},e.T=n;var s=function(t,i,e,r,s){n.call(this,t,i,e),this.className="Namespace",this.children=[],this.options=r||{},this.syntax=s||"proto2"},o=s.prototype=Object.create(n.prototype);o.getChildren=function(t){if(null==(t=t||null))return this.children.slice();for(var i=[],e=0,n=this.children.length;e<n;++e)this.children[e]instanceof t&&i.push(this.children[e]);return i},o.addChild=function(t){var i;if(i=this.getChild(t.name))if(i instanceof c.Field&&i.name!==i.originalName&&null===this.getChild(i.originalName))i.name=i.originalName;else{if(!(t instanceof c.Field&&t.name!==t.originalName&&null===this.getChild(t.originalName)))throw Error("Duplicate name in namespace "+this.toString(!0)+": "+t.name);t.name=t.originalName}this.children.push(t)},o.getChild=function(t){for(var i="number"==typeof t?"id":"name",e=0,n=this.children.length;e<n;++e)if(this.children[e][i]===t)return this.children[e];return null},o.resolve=function(t,i){var n,r="string"==typeof t?t.split("."):t,s=this,o=0;if(""===r[o]){for(;null!==s.parent;)s=s.parent;o++}do{do{if(!(s instanceof e.Namespace)){s=null;break}if(!(n=s.getChild(r[o]))||!(n instanceof e.T)||i&&!(n instanceof e.Namespace)){s=null;break}s=n,o++}while(o<r.length);if(null!=s)break;if(null!==this.parent)return this.parent.resolve(t,i)}while(null!=s);return s},o.qn=function(t){var i=[],n=t;do{i.unshift(n.name),n=n.parent}while(null!==n);for(var r=1;r<=i.length;r++){var s=i.slice(i.length-r);if(t===this.resolve(s,t instanceof e.Namespace))return s.join(".")}return t.fqn()},o.build=function(){for(var t,i={},e=this.children,n=0,r=e.length;n<r;++n)(t=e[n])instanceof s&&(i[t.name]=t.build());return Object.defineProperty&&Object.defineProperty(i,"$options",{value:this.buildOpt()}),i},o.buildOpt=function(){for(var t={},i=Object.keys(this.options),e=0,n=i.length;e<n;++e){var r=i[e],s=this.options[i[e]];t[r]=s}return t},o.getOption=function(t){return void 0===t?this.options:void 0!==this.options[t]?this.options[t]:null},e.Namespace=s;var a=function(t,e,n,r){if(this.type=t,this.resolvedType=e,this.isMapKey=n,this.syntax=r,n&&i.MAP_KEY_TYPES.indexOf(t)<0)throw Error("Invalid map key type: "+t.name)},u=a.prototype;function h(t,e){if(t&&"number"==typeof t.low&&"number"==typeof t.high&&"boolean"==typeof t.unsigned&&t.low==t.low&&t.high==t.high)return new i.Long(t.low,t.high,void 0===e?t.unsigned:e);if("string"==typeof t)return i.Long.fromString(t,e||!1,10);if("number"==typeof t)return i.Long.fromNumber(t,e||!1);throw Error("not convertible to Long")}a.defaultFieldValue=function(e){if("string"==typeof e&&(e=i.TYPES[e]),void 0===e.defaultValue)throw Error("default value for type "+e.name+" is not supported");return e==i.TYPES.bytes?new t(0):e.defaultValue},u.verifyValue=function(e){var n=function(t,i){throw Error("Illegal value for "+this.toString(!0)+" of type "+this.type.name+": "+t+" ("+i+")")}.bind(this);switch(this.type){case i.TYPES.int32:case i.TYPES.sint32:case i.TYPES.sfixed32:return("number"!=typeof e||e==e&&e%1!=0)&&n(typeof e,"not an integer"),e>4294967295?0|e:e;case i.TYPES.uint32:case i.TYPES.fixed32:return("number"!=typeof e||e==e&&e%1!=0)&&n(typeof e,"not an integer"),e<0?e>>>0:e;case i.TYPES.int64:case i.TYPES.sint64:case i.TYPES.sfixed64:if(i.Long)try{return h(e,!1)}catch(t){n(typeof e,t.message)}else n(typeof e,"requires Long.js");case i.TYPES.uint64:case i.TYPES.fixed64:if(i.Long)try{return h(e,!0)}catch(t){n(typeof e,t.message)}else n(typeof e,"requires Long.js");case i.TYPES.bool:return"boolean"!=typeof e&&n(typeof e,"not a boolean"),e;case i.TYPES.float:case i.TYPES.double:return"number"!=typeof e&&n(typeof e,"not a number"),e;case i.TYPES.string:return"string"==typeof e||e&&e instanceof String||n(typeof e,"not a string"),""+e;case i.TYPES.bytes:return t.isByteBuffer(e)?e:t.wrap(e,"base64");case i.TYPES.enum:var r=this.resolvedType.getChildren(i.Reflect.Enum.Value);for(o=0;o<r.length;o++){if(r[o].name==e)return r[o].id;if(r[o].id==e)return r[o].id}if("proto3"===this.syntax)return("number"!=typeof e||e==e&&e%1!=0)&&n(typeof e,"not an integer"),(e>4294967295||e<0)&&n(typeof e,"not in range for uint32"),e;n(e,"not a valid enum value");case i.TYPES.group:case i.TYPES.message:if(e&&"object"==typeof e||n(typeof e,"object expected"),e instanceof this.resolvedType.clazz)return e;if(e instanceof i.Builder.Message){var s={};for(var o in e)e.hasOwnProperty(o)&&(s[o]=e[o]);e=s}return new this.resolvedType.clazz(e)}throw Error("[INTERNAL] Illegal value for "+this.toString(!0)+": "+e+" (undefined type "+this.type+")")},u.calculateLength=function(e,n){if(null===n)return 0;var r;switch(this.type){case i.TYPES.int32:return n<0?t.calculateVarint64(n):t.calculateVarint32(n);case i.TYPES.uint32:return t.calculateVarint32(n);case i.TYPES.sint32:return t.calculateVarint32(t.zigZagEncode32(n));case i.TYPES.fixed32:case i.TYPES.sfixed32:case i.TYPES.float:return 4;case i.TYPES.int64:case i.TYPES.uint64:return t.calculateVarint64(n);case i.TYPES.sint64:return t.calculateVarint64(t.zigZagEncode64(n));case i.TYPES.fixed64:case i.TYPES.sfixed64:return 8;case i.TYPES.bool:return 1;case i.TYPES.enum:return t.calculateVarint32(n);case i.TYPES.double:return 8;case i.TYPES.string:return r=t.calculateUTF8Bytes(n),t.calculateVarint32(r)+r;case i.TYPES.bytes:if(n.remaining()<0)throw Error("Illegal value for "+this.toString(!0)+": "+n.remaining()+" bytes remaining");return t.calculateVarint32(n.remaining())+n.remaining();case i.TYPES.message:return r=this.resolvedType.calculate(n),t.calculateVarint32(r)+r;case i.TYPES.group:return(r=this.resolvedType.calculate(n))+t.calculateVarint32(e<<3|i.WIRE_TYPES.ENDGROUP)}throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+n+" (unknown type)")},u.encodeValue=function(e,n,r){if(null===n)return r;switch(this.type){case i.TYPES.int32:n<0?r.writeVarint64(n):r.writeVarint32(n);break;case i.TYPES.uint32:r.writeVarint32(n);break;case i.TYPES.sint32:r.writeVarint32ZigZag(n);break;case i.TYPES.fixed32:r.writeUint32(n);break;case i.TYPES.sfixed32:r.writeInt32(n);break;case i.TYPES.int64:case i.TYPES.uint64:r.writeVarint64(n);break;case i.TYPES.sint64:r.writeVarint64ZigZag(n);break;case i.TYPES.fixed64:r.writeUint64(n);break;case i.TYPES.sfixed64:r.writeInt64(n);break;case i.TYPES.bool:"string"==typeof n?r.writeVarint32("false"===n.toLowerCase()?0:!!n):r.writeVarint32(n?1:0);break;case i.TYPES.enum:r.writeVarint32(n);break;case i.TYPES.float:r.writeFloat32(n);break;case i.TYPES.double:r.writeFloat64(n);break;case i.TYPES.string:r.writeVString(n);break;case i.TYPES.bytes:if(n.remaining()<0)throw Error("Illegal value for "+this.toString(!0)+": "+n.remaining()+" bytes remaining");var s=n.offset;r.writeVarint32(n.remaining()),r.append(n),n.offset=s;break;case i.TYPES.message:var o=(new t).LE();this.resolvedType.encode(n,o),r.writeVarint32(o.offset),r.append(o.flip());break;case i.TYPES.group:this.resolvedType.encode(n,r),r.writeVarint32(e<<3|i.WIRE_TYPES.ENDGROUP);break;default:throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+n+" (unknown type)")}return r},u.decode=function(t,e,n){if(e!=this.type.wireType)throw Error("Unexpected wire type for element");var r,s;switch(this.type){case i.TYPES.int32:return 0|t.readVarint32();case i.TYPES.uint32:return t.readVarint32()>>>0;case i.TYPES.sint32:return 0|t.readVarint32ZigZag();case i.TYPES.fixed32:return t.readUint32()>>>0;case i.TYPES.sfixed32:return 0|t.readInt32();case i.TYPES.int64:return t.readVarint64();case i.TYPES.uint64:return t.readVarint64().toUnsigned();case i.TYPES.sint64:return t.readVarint64ZigZag();case i.TYPES.fixed64:return t.readUint64();case i.TYPES.sfixed64:return t.readInt64();case i.TYPES.bool:return!!t.readVarint32();case i.TYPES.enum:return t.readVarint32();case i.TYPES.float:return t.readFloat();case i.TYPES.double:return t.readDouble();case i.TYPES.string:return t.readVString();case i.TYPES.bytes:if(s=t.readVarint32(),t.remaining()<s)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+s+" required but got only "+t.remaining());return(r=t.clone()).limit=r.offset+s,t.offset+=s,r;case i.TYPES.message:return s=t.readVarint32(),this.resolvedType.decode(t,s);case i.TYPES.group:return this.resolvedType.decode(t,-1,n)}throw Error("[INTERNAL] Illegal decode type")},u.valueFromString=function(e){if(!this.isMapKey)throw Error("valueFromString() called on non-map-key element");switch(this.type){case i.TYPES.int32:case i.TYPES.sint32:case i.TYPES.sfixed32:case i.TYPES.uint32:case i.TYPES.fixed32:return this.verifyValue(parseInt(e));case i.TYPES.int64:case i.TYPES.sint64:case i.TYPES.sfixed64:case i.TYPES.uint64:case i.TYPES.fixed64:return this.verifyValue(e);case i.TYPES.bool:return"true"===e;case i.TYPES.string:return this.verifyValue(e);case i.TYPES.bytes:return t.fromBinary(e)}},u.valueToString=function(t){if(!this.isMapKey)throw Error("valueToString() called on non-map-key element");return this.type===i.TYPES.bytes?t.toString("binary"):t.toString()},e.Element=a;var c=function(t,e,n,r,o,a){s.call(this,t,e,n,r,a),this.className="Message",this.extensions=[i.ID_MIN,i.ID_MAX],this.clazz=null,this.isGroup=!!o,this.ve=null,this.ge=null,this.ye=null},f=c.prototype=Object.create(s.prototype);function l(t,e){var n=e.readVarint32(),r=7&n,s=n>>>3;switch(r){case i.WIRE_TYPES.VARINT:do{n=e.readUint8()}while(128==(128&n));break;case i.WIRE_TYPES.BITS64:e.offset+=8;break;case i.WIRE_TYPES.LDELIM:n=e.readVarint32(),e.offset+=n;break;case i.WIRE_TYPES.STARTGROUP:l(s,e);break;case i.WIRE_TYPES.ENDGROUP:if(s===t)return!1;throw Error("Illegal GROUPEND after unknown group: "+s+" ("+t+" expected)");case i.WIRE_TYPES.BITS32:e.offset+=4;break;default:throw Error("Illegal wire type in unknown group "+t+": "+r)}return!0}f.build=function(e){if(this.clazz&&!e)return this.clazz;var n=function(i,e){var n=e.getChildren(i.Reflect.Message.Field),r=e.getChildren(i.Reflect.Message.OneOf),s=function(o,a){i.Builder.Message.call(this);for(var u=0,h=r.length;u<h;++u)this[r[u].name]=null;for(u=0,h=n.length;u<h;++u){var c=n[u];this[c.name]=c.repeated?[]:c.map?new i.Map(c):null,!c.required&&"proto3"!==e.syntax||null===c.defaultValue||(this[c.name]=c.defaultValue)}var f;if(arguments.length>0)if(1!==arguments.length||null===o||"object"!=typeof o||!("function"!=typeof o.encode||o instanceof s)||Array.isArray(o)||o instanceof i.Map||t.isByteBuffer(o)||o instanceof ArrayBuffer||i.Long&&o instanceof i.Long)for(u=0,h=arguments.length;u<h;++u)void 0!==(f=arguments[u])&&this.$set(n[u].name,f);else this.$set(o)},o=s.prototype=Object.create(i.Builder.Message.prototype);o.add=function(t,n,r){var s=e.ye[t];if(!r){if(!s)throw Error(this+"#"+t+" is undefined");if(!(s instanceof i.Reflect.Message.Field))throw Error(this+"#"+t+" is not a field: "+s.toString(!0));if(!s.repeated)throw Error(this+"#"+t+" is not a repeated field");n=s.verifyValue(n,!0)}return null===this[t]&&(this[t]=[]),this[t].push(n),this},o.$add=o.add,o.set=function(t,n,r){if(t&&"object"==typeof t){for(var s in r=n,t)t.hasOwnProperty(s)&&void 0!==(n=t[s])&&this.$set(s,n,r);return this}var o=e.ye[t];if(r)this[t]=n;else{if(!o)throw Error(this+"#"+t+" is not a field: undefined");if(!(o instanceof i.Reflect.Message.Field))throw Error(this+"#"+t+" is not a field: "+o.toString(!0));this[o.name]=n=o.verifyValue(n)}if(o&&o.oneof){var a=this[o.oneof.name];null!==n?(null!==a&&a!==o.name&&(this[a]=null),this[o.oneof.name]=o.name):a===t&&(this[o.oneof.name]=null)}return this},o.$set=o.set,o.get=function(t,n){if(n)return this[t];var r=e.ye[t];if(!(r&&r instanceof i.Reflect.Message.Field))throw Error(this+"#"+t+" is not a field: undefined");if(!(r instanceof i.Reflect.Message.Field))throw Error(this+"#"+t+" is not a field: "+r.toString(!0));return this[r.name]},o.$get=o.get;for(var a=0;a<n.length;a++){var u=n[a];u instanceof i.Reflect.Message.ExtensionField||e.builder.options.populateAccessors&&function(t){var i=t.originalName.replace(/(_[a-zA-Z])/g,function(t){return t.toUpperCase().replace("_","")});i=i.substring(0,1).toUpperCase()+i.substring(1);var n=t.originalName.replace(/([A-Z])/g,function(t){return"_"+t}),r=function(i,e){return this[t.name]=e?i:t.verifyValue(i),this},s=function(){return this[t.name]};null===e.getChild("set"+i)&&(o["set"+i]=r),null===e.getChild("set_"+n)&&(o["set_"+n]=r),null===e.getChild("get"+i)&&(o["get"+i]=s),null===e.getChild("get_"+n)&&(o["get_"+n]=s)}(u)}function h(e,n,r,s){if(null===e||"object"!=typeof e){if(s&&s instanceof i.Reflect.Enum){var o=i.Reflect.Enum.getName(s.object,e);if(null!==o)return o}return e}if(t.isByteBuffer(e))return n?e.toBase64():e.toBuffer();if(i.Long.isLong(e))return r?e.toString():i.Long.fromValue(e);var a;if(Array.isArray(e))return a=[],e.forEach(function(t,i){a[i]=h(t,n,r,s)}),a;if(a={},e instanceof i.Map){for(var u=e.entries(),c=u.next();!c.done;c=u.next())a[e.keyElem.valueToString(c.value[0])]=h(c.value[1],n,r,e.valueElem.resolvedType);return a}var f=e.$type,l=void 0;for(var d in e)e.hasOwnProperty(d)&&(f&&(l=f.getChild(d))?a[d]=h(e[d],n,r,l.resolvedType):a[d]=h(e[d],n,r));return a}return o.encode=function(i,n){"boolean"==typeof i&&(n=i,i=void 0);var r=!1;i||(i=new t,r=!0);var s=i.littleEndian;try{return e.encode(this,i.LE(),n),(r?i.flip():i).LE(s)}catch(t){throw i.LE(s),t}},s.encode=function(t,i,e){return new s(t).encode(i,e)},o.calculate=function(){return e.calculate(this)},o.encodeDelimited=function(i){var n=!1;i||(i=new t,n=!0);var r=(new t).LE();return e.encode(this,r).flip(),i.writeVarint32(r.remaining()),i.append(r),n?i.flip():i},o.encodeAB=function(){try{return this.encode().toArrayBuffer()}catch(t){throw t.encoded&&(t.encoded=t.encoded.toArrayBuffer()),t}},o.toArrayBuffer=o.encodeAB,o.encodeNB=function(){try{return this.encode().toBuffer()}catch(t){throw t.encoded&&(t.encoded=t.encoded.toBuffer()),t}},o.toBuffer=o.encodeNB,o.encode64=function(){try{return this.encode().toBase64()}catch(t){throw t.encoded&&(t.encoded=t.encoded.toBase64()),t}},o.toBase64=o.encode64,o.encodeHex=function(){try{return this.encode().toHex()}catch(t){throw t.encoded&&(t.encoded=t.encoded.toHex()),t}},o.toHex=o.encodeHex,o.toRaw=function(t,i){return h(this,!!t,!!i,this.$type)},o.encodeJSON=function(){return JSON.stringify(h(this,!0,!0,this.$type))},s.decode=function(i,n){"string"==typeof i&&(i=t.wrap(i,n||"base64"));var r=(i=t.isByteBuffer(i)?i:t.wrap(i)).littleEndian;try{var s=e.decode(i.LE());return i.LE(r),s}catch(t){throw i.LE(r),t}},s.decodeDelimited=function(i,n){if("string"==typeof i&&(i=t.wrap(i,n||"base64")),(i=t.isByteBuffer(i)?i:t.wrap(i)).remaining()<1)return null;var r=i.offset,s=i.readVarint32();if(i.remaining()<s)return i.offset=r,null;try{var o=e.decode(i.slice(i.offset,i.offset+s).LE());return i.offset+=s,o}catch(t){throw i.offset+=s,t}},s.decode64=function(t){return s.decode(t,"base64")},s.decodeHex=function(t){return s.decode(t,"hex")},s.decodeJSON=function(t){return new s(JSON.parse(t))},o.toString=function(){return e.toString()},Object.defineProperty&&(Object.defineProperty(s,"$options",{value:e.buildOpt()}),Object.defineProperty(o,"$options",{value:s.$options}),Object.defineProperty(s,"$type",{value:e}),Object.defineProperty(o,"$type",{value:e})),s}(i,this);this.ve=[],this.ge={},this.ye={};for(var r,s=0,o=this.children.length;s<o;s++)if((r=this.children[s])instanceof v||r instanceof c||r instanceof w){if(n.hasOwnProperty(r.name))throw Error("Illegal reflect child of "+this.toString(!0)+": "+r.toString(!0)+" cannot override static property '"+r.name+"'");n[r.name]=r.build()}else if(r instanceof c.Field)r.build(),this.ve.push(r),this.ge[r.id]=r,this.ye[r.name]=r;else if(!(r instanceof c.OneOf||r instanceof y))throw Error("Illegal reflect child of "+this.toString(!0)+": "+this.children[s].toString(!0));return this.clazz=n},f.encode=function(t,i,e){for(var n,r,s=null,o=0,a=this.ve.length;o<a;++o)r=t[(n=this.ve[o]).name],n.required&&null===r?null===s&&(s=n):n.encode(e?r:n.verifyValue(r),i,t);if(null!==s){var u=Error("Missing at least one required field for "+this.toString(!0)+": "+s);throw u.encoded=i,u}return i},f.calculate=function(t){for(var i,e,n=0,r=0,s=this.ve.length;r<s;++r){if(e=t[(i=this.ve[r]).name],i.required&&null===e)throw Error("Missing at least one required field for "+this.toString(!0)+": "+i);n+=i.calculate(e,t)}return n},f.decode=function(t,e,n){e="number"==typeof e?e:-1;for(var r,s,o,a,u=t.offset,h=new this.clazz;t.offset<u+e||-1===e&&t.remaining()>0;){if(o=(r=t.readVarint32())>>>3,(s=7&r)===i.WIRE_TYPES.ENDGROUP){if(o!==n)throw Error("Illegal group end indicator for "+this.toString(!0)+": "+o+" ("+(n?n+" expected":"not a group")+")");break}if(a=this.ge[o]){if(a.repeated&&!a.options.packed)h[a.name].push(a.decode(s,t));else if(a.map){var c=a.decode(s,t);h[a.name].set(c[0],c[1])}else if(h[a.name]=a.decode(s,t),a.oneof){var f=h[a.oneof.name];null!==f&&f!==a.name&&(h[f]=null),h[a.oneof.name]=a.name}}else switch(s){case i.WIRE_TYPES.VARINT:t.readVarint32();break;case i.WIRE_TYPES.BITS32:t.offset+=4;break;case i.WIRE_TYPES.BITS64:t.offset+=8;break;case i.WIRE_TYPES.LDELIM:var d=t.readVarint32();t.offset+=d;break;case i.WIRE_TYPES.STARTGROUP:for(;l(o,t););break;default:throw Error("Illegal wire type for unknown field "+o+" in "+this.toString(!0)+"#decode: "+s)}}for(var p=0,m=this.ve.length;p<m;++p)if(null===h[(a=this.ve[p]).name])if("proto3"===this.syntax)h[a.name]=a.defaultValue;else{if(a.required){var v=Error("Missing at least one required field for "+this.toString(!0)+": "+a.name);throw v.decoded=h,v}i.populateDefaults&&null!==a.defaultValue&&(h[a.name]=a.defaultValue)}return h},e.Message=c;var d=function(t,e,r,s,o,a,u,h,f,l){n.call(this,t,e,a),this.className="Message.Field",this.required="required"===r,this.repeated="repeated"===r,this.map="map"===r,this.keyType=s||null,this.type=o,this.resolvedType=null,this.id=u,this.options=h||{},this.defaultValue=null,this.oneof=f||null,this.syntax=l||"proto2",this.originalName=this.name,this.element=null,this.keyElement=null,!this.builder.options.convertFieldsToCamelCase||this instanceof c.ExtensionField||(this.name=i.Util.toCamelCase(this.name))},p=d.prototype=Object.create(n.prototype);p.build=function(){this.element=new a(this.type,this.resolvedType,!1,this.syntax),this.map&&(this.keyElement=new a(this.keyType,void 0,!0,this.syntax)),"proto3"!==this.syntax||this.repeated||this.map?void 0!==this.options.default&&(this.defaultValue=this.verifyValue(this.options.default)):this.defaultValue=a.defaultFieldValue(this.type)},p.verifyValue=function(t,e){e=e||!1;var n,r=function(t,i){throw Error("Illegal value for "+this.toString(!0)+" of type "+this.type.name+": "+t+" ("+i+")")}.bind(this);if(null===t)return this.required&&r(typeof t,"required"),"proto3"===this.syntax&&this.type!==i.TYPES.message&&r(typeof t,"proto3 field without field presence cannot be null"),null;if(this.repeated&&!e){Array.isArray(t)||(t=[t]);var s=[];for(n=0;n<t.length;n++)s.push(this.element.verifyValue(t[n]));return s}return this.map&&!e?t instanceof i.Map?t:(t instanceof Object||r(typeof t,"expected ProtoBuf.Map or raw object for map field"),new i.Map(this,t)):(!this.repeated&&Array.isArray(t)&&r(typeof t,"no array expected"),this.element.verifyValue(t))},p.hasWirePresence=function(t,e){if("proto3"!==this.syntax)return null!==t;if(this.oneof&&e[this.oneof.name]===this.name)return!0;switch(this.type){case i.TYPES.int32:case i.TYPES.sint32:case i.TYPES.sfixed32:case i.TYPES.uint32:case i.TYPES.fixed32:return 0!==t;case i.TYPES.int64:case i.TYPES.sint64:case i.TYPES.sfixed64:case i.TYPES.uint64:case i.TYPES.fixed64:return 0!==t.low||0!==t.high;case i.TYPES.bool:return t;case i.TYPES.float:case i.TYPES.double:return 0!==t;case i.TYPES.string:return t.length>0;case i.TYPES.bytes:return t.remaining()>0;case i.TYPES.enum:return 0!==t;case i.TYPES.message:return null!==t;default:return!0}},p.encode=function(e,n,r){if(null===this.type||"object"!=typeof this.type)throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===e||this.repeated&&0==e.length)return n;try{var s;if(this.repeated)if(this.options.packed&&i.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0){n.writeVarint32(this.id<<3|i.WIRE_TYPES.LDELIM),n.ensureCapacity(n.offset+=1);var o=n.offset;for(s=0;s<e.length;s++)this.element.encodeValue(this.id,e[s],n);var a=n.offset-o,u=t.calculateVarint32(a);if(u>1){var h=n.slice(o,n.offset);o+=u-1,n.offset=o,n.append(h)}n.writeVarint32(a,o-u)}else for(s=0;s<e.length;s++)n.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,e[s],n);else this.map?e.forEach(function(e,r,s){var o=t.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,r)+t.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,e);n.writeVarint32(this.id<<3|i.WIRE_TYPES.LDELIM),n.writeVarint32(o),n.writeVarint32(8|this.keyType.wireType),this.keyElement.encodeValue(1,r,n),n.writeVarint32(16|this.type.wireType),this.element.encodeValue(2,e,n)},this):this.hasWirePresence(e,r)&&(n.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,e,n))}catch(t){throw Error("Illegal value for "+this.toString(!0)+": "+e+" ("+t+")")}return n},p.calculate=function(e,n){if(e=this.verifyValue(e),null===this.type||"object"!=typeof this.type)throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===e||this.repeated&&0==e.length)return 0;var r=0;try{var s,o;if(this.repeated)if(this.options.packed&&i.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0){for(r+=t.calculateVarint32(this.id<<3|i.WIRE_TYPES.LDELIM),o=0,s=0;s<e.length;s++)o+=this.element.calculateLength(this.id,e[s]);r+=t.calculateVarint32(o),r+=o}else for(s=0;s<e.length;s++)r+=t.calculateVarint32(this.id<<3|this.type.wireType),r+=this.element.calculateLength(this.id,e[s]);else this.map?e.forEach(function(e,n,s){var o=t.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,n)+t.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,e);r+=t.calculateVarint32(this.id<<3|i.WIRE_TYPES.LDELIM),r+=t.calculateVarint32(o),r+=o},this):this.hasWirePresence(e,n)&&(r+=t.calculateVarint32(this.id<<3|this.type.wireType),r+=this.element.calculateLength(this.id,e))}catch(t){throw Error("Illegal value for "+this.toString(!0)+": "+e+" ("+t+")")}return r},p.decode=function(t,e,n){var r,s;if(!(!this.map&&t==this.type.wireType||!n&&this.repeated&&this.options.packed&&t==i.WIRE_TYPES.LDELIM||this.map&&t==i.WIRE_TYPES.LDELIM))throw Error("Illegal wire type for field "+this.toString(!0)+": "+t+" ("+this.type.wireType+" expected)");if(t==i.WIRE_TYPES.LDELIM&&this.repeated&&this.options.packed&&i.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0&&!n){s=e.readVarint32(),s=e.offset+s;for(var o=[];e.offset<s;)o.push(this.decode(this.type.wireType,e,!0));return o}if(this.map){var u=a.defaultFieldValue(this.keyType);if(r=a.defaultFieldValue(this.type),s=e.readVarint32(),e.remaining()<s)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+s+" required but got only "+e.remaining());var h=e.clone();for(h.limit=h.offset+s,e.offset+=s;h.remaining()>0;){var c=h.readVarint32();t=7&c;var f=c>>>3;if(1===f)u=this.keyElement.decode(h,t,f);else{if(2!==f)throw Error("Unexpected tag in map field key/value submessage");r=this.element.decode(h,t,f)}}return[u,r]}return this.element.decode(e,t,this.id)},e.Message.Field=d;var m=function(t,i,e,n,r,s,o){d.call(this,t,i,e,null,n,r,s,o),this.extension};m.prototype=Object.create(d.prototype),e.Message.ExtensionField=m;e.Message.OneOf=function(t,i,e){n.call(this,t,i,e),this.fields=[]};var v=function(t,i,e,n,r){s.call(this,t,i,e,n,r),this.className="Enum",this.object=null};v.getName=function(t,i){for(var e,n=Object.keys(t),r=0;r<n.length;++r)if(t[e=n[r]]===i)return e;return null},(v.prototype=Object.create(s.prototype)).build=function(t){if(this.object&&!t)return this.object;for(var e=new i.Builder.Enum,n=this.getChildren(v.Value),r=0,s=n.length;r<s;++r)e[n[r].name]=n[r].id;return Object.defineProperty&&Object.defineProperty(e,"$options",{value:this.buildOpt(),enumerable:!1}),this.object=e},e.Enum=v;var g=function(t,i,e,r){n.call(this,t,i,e),this.className="Enum.Value",this.id=r};g.prototype=Object.create(n.prototype),e.Enum.Value=g;var y=function(t,i,e,r){n.call(this,t,i,e),this.field=r};y.prototype=Object.create(n.prototype),e.Extension=y;var w=function(t,i,e,n){s.call(this,t,i,e,n),this.className="Service",this.clazz=null};(w.prototype=Object.create(s.prototype)).build=function(e){return this.clazz&&!e?this.clazz:this.clazz=function(i,e){for(var n=function(t){i.Builder.Service.call(this),this.rpcImpl=t||function(t,i,e){setTimeout(e.bind(this,Error("Not implemented, see: https://github.com/dcodeIO/ProtoBuf.js/wiki/Services")),0)}},r=n.prototype=Object.create(i.Builder.Service.prototype),s=e.getChildren(i.Reflect.Service.RPCMethod),o=0;o<s.length;o++)!function(i){r[i.name]=function(n,r){try{try{n=i.resolvedRequestType.clazz.decode(t.wrap(n))}catch(t){if(!(t instanceof TypeError))throw t}if(null===n||"object"!=typeof n)throw Error("Illegal arguments");n instanceof i.resolvedRequestType.clazz||(n=new i.resolvedRequestType.clazz(n)),this.rpcImpl(i.fqn(),n,function(t,n){if(t)r(t);else{try{n=i.resolvedResponseType.clazz.decode(n)}catch(t){}n&&n instanceof i.resolvedResponseType.clazz?r(null,n):r(Error("Illegal response type received in service method "+e.name+"#"+i.name))}})}catch(t){setTimeout(r.bind(this,t),0)}},n[i.name]=function(t,e,r){new n(t)[i.name](e,r)},Object.defineProperty&&(Object.defineProperty(n[i.name],"$options",{value:i.buildOpt()}),Object.defineProperty(r[i.name],"$options",{value:n[i.name].$options}))}(s[o]);return Object.defineProperty&&(Object.defineProperty(n,"$options",{value:e.buildOpt()}),Object.defineProperty(r,"$options",{value:n.$options}),Object.defineProperty(n,"$type",{value:e}),Object.defineProperty(r,"$type",{value:e})),n}(i,this)},e.Service=w;var b=function(t,i,e,r){n.call(this,t,i,e),this.className="Service.Method",this.options=r||{}};(b.prototype=Object.create(n.prototype)).buildOpt=o.buildOpt,e.Service.Method=b;var E=function(t,i,e,n,r,s,o,a){b.call(this,t,i,e,a),this.className="Service.RPCMethod",this.requestName=n,this.responseName=r,this.requestStream=s,this.responseStream=o,this.resolvedRequestType=null,this.resolvedResponseType=null};return E.prototype=Object.create(b.prototype),e.Service.RPCMethod=E,e}(s),s.Builder=function(t,i,n){var r=function(t){this.ns=new n.Namespace(this,null,""),this.ptr=this.ns,this.resolved=!1,this.result=null,this.files={},this.importRoot=null,this.options=t||{}},s=r.prototype;return r.isMessage=function(t){return"string"==typeof t.name&&(void 0===t.values&&void 0===t.rpc)},r.isMessageField=function(t){return"string"==typeof t.rule&&"string"==typeof t.name&&"string"==typeof t.type&&void 0!==t.id},r.isEnum=function(t){return"string"==typeof t.name&&!(void 0===t.values||!Array.isArray(t.values)||0===t.values.length)},r.isService=function(t){return!("string"!=typeof t.name||"object"!=typeof t.rpc||!t.rpc)},r.isExtend=function(t){return"string"==typeof t.ref},s.reset=function(){return this.ptr=this.ns,this},s.define=function(t){if("string"!=typeof t||!i.TYPEREF.test(t))throw Error("illegal namespace: "+t);return t.split(".").forEach(function(t){var i=this.ptr.getChild(t);null===i&&this.ptr.addChild(i=new n.Namespace(this,this.ptr,t)),this.ptr=i},this),this},s.create=function(i){if(!i)return this;if(Array.isArray(i)){if(0===i.length)return this;i=i.slice()}else i=[i];for(var e=[i];e.length>0;){if(i=e.pop(),!Array.isArray(i))throw Error("not a valid namespace: "+JSON.stringify(i));for(;i.length>0;){var s=i.shift();if(r.isMessage(s)){var o=new n.Message(this,this.ptr,s.name,s.options,s.isGroup,s.syntax),a={};s.oneofs&&Object.keys(s.oneofs).forEach(function(t){o.addChild(a[t]=new n.Message.OneOf(this,o,t))},this),s.fields&&s.fields.forEach(function(t){if(null!==o.getChild(0|t.id))throw Error("duplicate or invalid field id in "+o.name+": "+t.id);if(t.options&&"object"!=typeof t.options)throw Error("illegal field options in "+o.name+"#"+t.name);var i=null;if("string"==typeof t.oneof&&!(i=a[t.oneof]))throw Error("illegal oneof in "+o.name+"#"+t.name+": "+t.oneof);t=new n.Message.Field(this,o,t.rule,t.keytype,t.type,t.name,t.id,t.options,i,s.syntax),i&&i.fields.push(t),o.addChild(t)},this);var u=[];if(s.enums&&s.enums.forEach(function(t){u.push(t)}),s.messages&&s.messages.forEach(function(t){u.push(t)}),s.services&&s.services.forEach(function(t){u.push(t)}),s.extensions&&(o.extensions=s.extensions,o.extensions[0]<t.ID_MIN&&(o.extensions[0]=t.ID_MIN),o.extensions[1]>t.ID_MAX&&(o.extensions[1]=t.ID_MAX)),this.ptr.addChild(o),u.length>0){e.push(i),i=u,u=null,this.ptr=o,o=null;continue}u=null}else if(r.isEnum(s))o=new n.Enum(this,this.ptr,s.name,s.options,s.syntax),s.values.forEach(function(t){o.addChild(new n.Enum.Value(this,o,t.name,t.id))},this),this.ptr.addChild(o);else if(r.isService(s))o=new n.Service(this,this.ptr,s.name,s.options),Object.keys(s.rpc).forEach(function(t){var i=s.rpc[t];o.addChild(new n.Service.RPCMethod(this,o,t,i.request,i.response,!!i.request_stream,!!i.response_stream,i.options))},this),this.ptr.addChild(o);else{if(!r.isExtend(s))throw Error("not a valid definition: "+JSON.stringify(s));if(o=this.ptr.resolve(s.ref,!0))s.fields.forEach(function(i){if(null!==o.getChild(0|i.id))throw Error("duplicate extended field id in "+o.name+": "+i.id);if(i.id<o.extensions[0]||i.id>o.extensions[1])throw Error("illegal extended field id in "+o.name+": "+i.id+" ("+o.extensions.join(" to ")+" expected)");var e=i.name;this.options.convertFieldsToCamelCase&&(e=t.Util.toCamelCase(e));var r=new n.Message.ExtensionField(this,o,i.rule,i.type,this.ptr.fqn()+"."+e,i.id,i.options),s=new n.Extension(this,this.ptr,i.name,r);r.extension=s,this.ptr.addChild(s),o.addChild(r)},this);else if(!/\.?google\.protobuf\./.test(s.ref))throw Error("extended message "+s.ref+" is not defined")}s=null,o=null}i=null,this.ptr=this.ptr.parent}return this.resolved=!1,this.result=null,this},s.import=function(i,n){var r="/";if("string"==typeof n){if(t.Util.IS_NODE&&(n=e(26).resolve(n)),!0===this.files[n])return this.reset();this.files[n]=!0}else if("object"==typeof n){var s=n.root;t.Util.IS_NODE&&(s=e(26).resolve(s)),(s.indexOf("\\")>=0||n.file.indexOf("\\")>=0)&&(r="\\");var o=s+r+n.file;if(!0===this.files[o])return this.reset();this.files[o]=!0}if(i.imports&&i.imports.length>0){var a,u=!1;"object"==typeof n?(this.importRoot=n.root,u=!0,a=this.importRoot,n=n.file,(a.indexOf("\\")>=0||n.indexOf("\\")>=0)&&(r="\\")):"string"==typeof n?this.importRoot?a=this.importRoot:n.indexOf("/")>=0?""===(a=n.replace(/\/[^\/]*$/,""))&&(a="/"):n.indexOf("\\")>=0?(a=n.replace(/\\[^\\]*$/,""),r="\\"):a=".":a=null;for(var h=0;h<i.imports.length;h++)if("string"==typeof i.imports[h]){if(!a)throw Error("cannot determine import root");var c=i.imports[h];if("google/protobuf/descriptor.proto"===c)continue;if(c=a+r+c,!0===this.files[c])continue;/\.proto$/i.test(c)&&!t.DotProto&&(c=c.replace(/\.proto$/,".json"));var f=t.Util.fetch(c);if(null===f)throw Error("failed to import '"+c+"' in '"+n+"': file not found");/\.json$/i.test(c)?this.import(JSON.parse(f+""),c):this.import(t.DotProto.Parser.parse(f),c)}else n?/\.(\w+)$/.test(n)?this.import(i.imports[h],n.replace(/^(.+)\.(\w+)$/,function(t,i,e){return i+"_import"+h+"."+e})):this.import(i.imports[h],n+"_import"+h):this.import(i.imports[h]);u&&(this.importRoot=null)}i.package&&this.define(i.package),i.syntax&&function t(i){i.messages&&i.messages.forEach(function(e){e.syntax=i.syntax,t(e)}),i.enums&&i.enums.forEach(function(t){t.syntax=i.syntax})}(i);var l=this.ptr;return i.options&&Object.keys(i.options).forEach(function(t){l.options[t]=i.options[t]}),i.messages&&(this.create(i.messages),this.ptr=l),i.enums&&(this.create(i.enums),this.ptr=l),i.services&&(this.create(i.services),this.ptr=l),i.extends&&this.create(i.extends),this.reset()},s.resolveAll=function(){var e;if(null==this.ptr||"object"==typeof this.ptr.type)return this;if(this.ptr instanceof n.Namespace)this.ptr.children.forEach(function(t){this.ptr=t,this.resolveAll()},this);else if(this.ptr instanceof n.Message.Field){if(i.TYPE.test(this.ptr.type))this.ptr.type=t.TYPES[this.ptr.type];else{if(!i.TYPEREF.test(this.ptr.type))throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if(!(e=(this.ptr instanceof n.Message.ExtensionField?this.ptr.extension.parent:this.ptr.parent).resolve(this.ptr.type,!0)))throw Error("unresolvable type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if(this.ptr.resolvedType=e,e instanceof n.Enum){if(this.ptr.type=t.TYPES.enum,"proto3"===this.ptr.syntax&&"proto3"!==e.syntax)throw Error("proto3 message cannot reference proto2 enum")}else{if(!(e instanceof n.Message))throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);this.ptr.type=e.isGroup?t.TYPES.group:t.TYPES.message}}if(this.ptr.map){if(!i.TYPE.test(this.ptr.keyType))throw Error("illegal key type for map field in "+this.ptr.toString(!0)+": "+this.ptr.keyType);this.ptr.keyType=t.TYPES[this.ptr.keyType]}}else if(this.ptr instanceof t.Reflect.Service.Method){if(!(this.ptr instanceof t.Reflect.Service.RPCMethod))throw Error("illegal service type in "+this.ptr.toString(!0));if(!((e=this.ptr.parent.resolve(this.ptr.requestName,!0))&&e instanceof t.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.requestName);if(this.ptr.resolvedRequestType=e,!((e=this.ptr.parent.resolve(this.ptr.responseName,!0))&&e instanceof t.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.responseName);this.ptr.resolvedResponseType=e}else if(!(this.ptr instanceof t.Reflect.Message.OneOf||this.ptr instanceof t.Reflect.Extension||this.ptr instanceof t.Reflect.Enum.Value))throw Error("illegal object in namespace: "+typeof this.ptr+": "+this.ptr);return this.reset()},s.build=function(t){if(this.reset(),this.resolved||(this.resolveAll(),this.resolved=!0,this.result=null),null===this.result&&(this.result=this.ns.build()),!t)return this.result;for(var i="string"==typeof t?t.split("."):t,e=this.result,n=0;n<i.length;n++){if(!e[i[n]]){e=null;break}e=e[i[n]]}return e},s.lookup=function(t,i){return t?this.ns.resolve(t,i):this.ns},s.toString=function(){return"Builder"},r.Message=function(){},r.Enum=function(){},r.Service=function(){},r}(s,s.Lang,s.Reflect),s.Map=function(t,i){var e=function(t,e){if(!t.map)throw Error("field is not a map");if(this.field=t,this.keyElem=new i.Element(t.keyType,null,!0,t.syntax),this.valueElem=new i.Element(t.type,t.resolvedType,!1,t.syntax),this.map={},Object.defineProperty(this,"size",{get:function(){return Object.keys(this.map).length}}),e)for(var n=Object.keys(e),r=0;r<n.length;r++){var s=this.keyElem.valueFromString(n[r]),o=this.valueElem.verifyValue(e[n[r]]);this.map[this.keyElem.valueToString(s)]={key:s,value:o}}},n=e.prototype;function r(t){var i=0;return{next:function(){return i<t.length?{done:!1,value:t[i++]}:{done:!0}}}}return n.clear=function(){this.map={}},n.delete=function(t){var i=this.keyElem.valueToString(this.keyElem.verifyValue(t)),e=i in this.map;return delete this.map[i],e},n.entries=function(){for(var t,i=[],e=Object.keys(this.map),n=0;n<e.length;n++)i.push([(t=this.map[e[n]]).key,t.value]);return r(i)},n.keys=function(){for(var t=[],i=Object.keys(this.map),e=0;e<i.length;e++)t.push(this.map[i[e]].key);return r(t)},n.values=function(){for(var t=[],i=Object.keys(this.map),e=0;e<i.length;e++)t.push(this.map[i[e]].value);return r(t)},n.forEach=function(t,i){for(var e,n=Object.keys(this.map),r=0;r<n.length;r++)t.call(i,(e=this.map[n[r]]).value,e.key,this)},n.set=function(t,i){var e=this.keyElem.verifyValue(t),n=this.valueElem.verifyValue(i);return this.map[this.keyElem.valueToString(e)]={key:e,value:n},this},n.get=function(t){var i=this.keyElem.valueToString(this.keyElem.verifyValue(t));if(i in this.map)return this.map[i].value},n.has=function(t){return this.keyElem.valueToString(this.keyElem.verifyValue(t))in this.map},e}(0,s.Reflect),s.loadProto=function(t,i,e){return("string"==typeof i||i&&"string"==typeof i.file&&"string"==typeof i.root)&&(e=i,i=void 0),s.loadJson(s.DotProto.Parser.parse(t),i,e)},s.protoFromString=s.loadProto,s.loadProtoFile=function(t,i,e){if(i&&"object"==typeof i?(e=i,i=null):i&&"function"==typeof i||(i=null),i)return s.Util.fetch("string"==typeof t?t:t.root+"/"+t.file,function(n){if(null!==n)try{i(null,s.loadProto(n,e,t))}catch(t){i(t)}else i(Error("Failed to fetch file"))});var n=s.Util.fetch("object"==typeof t?t.root+"/"+t.file:t);return null===n?null:s.loadProto(n,e,t)},s.protoFromFile=s.loadProtoFile,s.newBuilder=function(t){return void 0===(t=t||{}).convertFieldsToCamelCase&&(t.convertFieldsToCamelCase=s.convertFieldsToCamelCase),void 0===t.populateAccessors&&(t.populateAccessors=s.populateAccessors),new s.Builder(t)},s.loadJson=function(t,i,e){return("string"==typeof i||i&&"string"==typeof i.file&&"string"==typeof i.root)&&(e=i,i=null),i&&"object"==typeof i||(i=s.newBuilder()),"string"==typeof t&&(t=JSON.parse(t)),i.import(t,e),i.resolveAll(),i},s.loadJsonFile=function(t,i,e){if(i&&"object"==typeof i?(e=i,i=null):i&&"function"==typeof i||(i=null),i)return s.Util.fetch("string"==typeof t?t:t.root+"/"+t.file,function(n){if(null!==n)try{i(null,s.loadJson(JSON.parse(n),e,t))}catch(t){i(t)}else i(Error("Failed to fetch file"))});var n=s.Util.fetch("object"==typeof t?t.root+"/"+t.file:t);return null===n?null:s.loadJson(JSON.parse(n),e,t)},s},s=[e(10)],void 0===(o="function"==typeof(r=a)?r.apply(i,s):r)||(t.exports=o)}).call(i,e(52))},function(t,i){var e;e=function(){return this}();try{e=e||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(e=window)}t.exports=e},function(t,i,e){var n,r;n=[e(0),e(1),e(5),e(3)],void 0===(r=function(t,i,e,n){"use strict";var r=2e4,s={timeout:r,retryOptions:{backoff:1.5,delay:1e3,maxAttempts:3,additionalRetryErrorCodes:[0]}};function o(t,e){i.isStringNotEmpty(t,"backendUri"),i.isObject(e,"authenticationData"),this.we=t,this.be=e,this.z=new n.DisposableList}function a(i,e){var s=null,o=i(t.bind(h,this,function(t,i){clearTimeout(s),e(t,i)}));s=setTimeout(function(){o.dispose(),e(new Error("timeout"))},r),this.z.add(o),this.z.add(new n.Disposable(function(){clearTimeout(s)}))}function u(i){return t.assign({},i,this.be)}function h(t,i,e){if(i)return t(i,{});var n=JSON.parse(e.data);return"ok"!==n.status?t(null,{status:n.status}):t(null,n)}return o.prototype.dispose=function(){return this.z.dispose()},o.prototype.createAuthenticationToken=function(i){var n=u.call(this,{}),r=t.bind(e.postWithRetry,e,this.we+"/auth",JSON.stringify(n),s);return a.call(this,r,i)},o.prototype.createStreamTokenForPublishing=function(n,r,o){i.isStringNotEmpty(n,"sessionId"),i.isObject(r,"capabilities");var h=u.call(this,{sessionId:n,capabilities:r}),c=t.bind(e.postWithRetry,e,this.we+"/stream",JSON.stringify(h),s);return a.call(this,c,o)},o.prototype.createStreamTokenForSubscribing=function(n,r,o,h,c){i.isStringNotEmpty(n,"sessionId"),i.isObject(r,"capabilities"),t.isNullOrUndefined(h)||(i.isArray(h,"additionalStreamIds"),t.forEach(h,function(t){i.isStringNotEmpty(t,"alternateOriginStreamId")}));var f=u.call(this,{sessionId:n,capabilities:r,originStreamId:o});h&&h.length>0&&(f.alternateOriginStreamIds=h);var l=t.bind(e.postWithRetry,e,this.we+"/stream",JSON.stringify(f),s);return a.call(this,l,c)},o.prototype.getStreams=function(i){var n=t.bind(e.getWithRetry,e,this.we+"/streams",s);return a.call(this,n,i)},o}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(0),e(5),e(3),e(34)],void 0===(r=function(t,i,e,n){"use strict";var r=4;function s(t,i,n,r){if("string"!=typeof t)throw new Error('Must pass a valid "version"');if("string"!=typeof i)throw new Error('Must pass a valid "baseUri"');if("object"!=typeof n)throw new Error('Must pass a valid "logger"');this.b=t,this.j=i,this.R=n,this.z=new e.DisposableList,this.at=r}return s.DefaultPCastUri="https://pcast.phenixp2p.com",s.prototype.getBaseUri=function(){return this.j},s.prototype.resolveUri=function(e){return function(e,s){if(0===e.lastIndexOf("wss:",0))s(void 0,{uri:e+"/ws",roundTripTime:0});else if(0===e.lastIndexOf("https:",0)){var o=this;(function(e,n){var s=i.getWithRetry(e+"/pcast/endPoints",{timeout:15e3,queryParameters:{version:"2018-04-10T16:20:23Z",Ci:t.now()},retryOptions:{maxAttempts:r}},function(t,i){if(t)return n(new Error("Failed to resolve an end point",t));var e=i.data.split(",");e.length<1&&n(new Error("Failed to discover end points")),n(void 0,e)});this.z.add(s)}).call(o,e,function(t,i){if(t)return s(t);var e=new n(o.R,o.b,s,function(t,i){t?o.R.warn("An error occured in resolving an endpoint",t):o.at.recordMetric("RoundTripTime",{uint64:i.time},null,{resource:i.endPoint,kind:"https"})});e.resolveAll(i),o.z.add(e)})}else s(new Error("Uri not supported"))}.call(this,this.j,e)},s.prototype.dispose=function(){this.z.dispose()},s.prototype.toString=function(){return"PCastEndPoint["+this.j+"]"},s}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(0),e(1),e(7),e(12),e(2),e(62),e(63)],void 0===(r=function(t,i,e,n,r,s,o){"use strict";var a=5;function u(t,r,u,h){i.isStringNotEmpty(t,"uri"),i.isString(r,"deviceId"),i.isStringNotEmpty(u,"version"),i.isObject(h,"logger"),this.U=r,this.b=u,this.R=h,this.Ee=new n.MQWebSocket(t,this.R,[s,o],a),this.Bi=new e.Observable(null).extend({rateLimit:0})}return u.prototype.onEvent=function(t,i){return this.Ee.onEvent(t,i)},u.prototype.disconnect=function(){return this.Bi.setValue(null),this.Ee.disconnect()},u.prototype.authenticate=function(t,e){i.isStringNotEmpty(t,"authToken"),i.isFunction(e,"callback");var n={apiVersion:this.Ee.getApiVersion(),clientVersion:this.b,deviceId:this.U,platform:r.browser,platformVersion:r.browserVersion.toString(),authenticationToken:t};this.getSessionId()&&(n.sessionId=this.getSessionId());var s=this;return this.Ee.sendRequest("pcast.Authenticate",n,function(t,i){if(i){var n=s.Bi.getValue();n&&n!==i.sessionId&&s.Ee.disposeOfPendingRequests(),s.Bi.setValue(i.sessionId)}return e(t,i)})},u.prototype.getSessionId=function(){return this.Bi.getValue()},u.prototype.getObservableSessionId=function(){return this.Bi},u.prototype.bye=function(t,e){i.isStringNotEmpty(t,"reason"),i.isFunction(e,"callback");var n={sessionId:this.getSessionId(),reason:t};return this.Ee.sendRequest("pcast.Bye",n,e)},u.prototype.setupStream=function(t,e,n,s){i.isStringNotEmpty(t,"streamType"),i.isStringNotEmpty(e,"streamToken"),i.isObject(n,"options"),i.isFunction(s,"callback");var o=r.browser||"UnknownBrowser",a=o+"-"+(r.browserVersion||0),u={streamToken:e,createStream:{sessionId:this.getSessionId(),options:["data-quality-notifications"],connectUri:n.connectUri,connectOptions:n.connectOptions||[],tags:n.tags||[]}};return n.negotiate&&(u.createStream.createOfferDescription={streamId:"",options:[t,o,a],apiVersion:this.Ee.getApiVersion()}),!1===n.receiveAudio&&u.createStream.options.push("no-audio"),!1===n.receiveVideo&&u.createStream.options.push("no-video"),this.Ee.sendRequest("pcast.SetupStream",u,s)},u.prototype.setAnswerDescription=function(t,e,n){i.isStringNotEmpty(t,"streamId"),i.isStringNotEmpty(e,"sdp"),i.isFunction(n,"callback");var r={streamId:t,sessionDescription:{type:"Answer",sdp:e},apiVersion:this.Ee.getApiVersion()};return this.Ee.sendRequest("pcast.SetRemoteDescription",r,n)},u.prototype.addIceCandidates=function(e,n,r,s){i.isStringNotEmpty(e,"streamId"),i.isArray(n,"candidates"),i.isObject(r,"options"),i.isFunction(s,"callback");var o={streamId:e,candidates:t.map(n,function(t,e){return i.isStringNotEmpty(t.candidate,"candidate["+e+"].candidate"),i.isNumber(t.sdpMLineIndex,"candidate["+e+"].sdpMLineIndex"),i.isStringNotEmpty(t.sdpMid,"candidate["+e+"].sdpMid"),{candidate:t.candidate,sdpMLineIndex:t.sdpMLineIndex,sdpMid:t.sdpMid}}),options:r,apiVersion:this.Ee.getApiVersion()};return this.Ee.sendRequest("pcast.AddIceCandidates",o,s)},u.prototype.updateStreamState=function(t,e,n,r,s){i.isStringNotEmpty(t,"streamId"),i.isStringNotEmpty(e,"signalingState"),i.isStringNotEmpty(n,"iceGatheringState"),i.isStringNotEmpty(r,"iceConnectionState"),i.isFunction(s,"callback");var o={streamId:t,signalingState:e,iceGatheringState:n,iceConnectionState:r,apiVersion:this.Ee.getApiVersion()};return this.Ee.sendRequest("pcast.UpdateStreamState",o,s)},u.prototype.destroyStream=function(t,e,n){i.isStringNotEmpty(t,"streamId"),i.isString(e,"reason"),i.isFunction(n,"callback");var r={streamId:t,reason:e};return this.Ee.sendRequest("pcast.DestroyStream",r,n)},u.prototype.getRoomInfo=function(t,e,n){t?i.isString(t,"roomId"):i.isString(e,"alias"),i.isFunction(n,"callback");var r={roomId:t,alias:e,sessionId:this.getSessionId()};return this.Ee.sendRequest("chat.GetRoomInfo",r,n)},u.prototype.createRoom=function(t,e){i.isObject(t,"room"),i.isStringNotEmpty(t.name,"room.name"),i.isStringNotEmpty(t.type,"room.type"),i.isStringNotEmpty(t.description,"room.description"),i.isFunction(e,"callback");var n={sessionId:this.getSessionId(),room:t};return this.Ee.sendRequest("chat.CreateRoom",n,e)},u.prototype.enterRoom=function(t,e,n,r,s){t?i.isString(t,"roomId"):i.isString(e,"alias"),i.isObject(n,"member"),i.isNumber(r,"timestamp"),i.isFunction(s,"callback");var o={roomId:t,alias:e,sessionId:this.getSessionId(),member:n,timestamp:r};return this.Ee.sendRequest("chat.JoinRoom",o,s)},u.prototype.leaveRoom=function(t,e,n){i.isString(t,"roomId"),i.isNumber(e,"timestamp"),i.isFunction(n,"callback");var r={roomId:t,sessionId:this.getSessionId(),timestamp:e};return this.Ee.sendRequest("chat.LeaveRoom",r,n)},u.prototype.updateMember=function(t,e,n){i.isObject(t,"member"),i.isNumber(e,"timestamp"),i.isFunction(n,"callback"),t.updateStreams=t.hasOwnProperty("streams");var r={sessionId:this.getSessionId(),member:t,timestamp:e};return this.Ee.sendRequest("chat.UpdateMember",r,n)},u.prototype.updateRoom=function(t,e,n){i.isObject(t,"room"),i.isNumber(e,"timestamp"),i.isFunction(n,"callback");var r={sessionId:this.getSessionId(),room:t,timestamp:e};return this.Ee.sendRequest("chat.UpdateRoom",r,n)},u.prototype.sendMessageToRoom=function(t,e,n){i.isStringNotEmpty(t,"roomId"),i.isObject(e,"chatMessage");var r={roomId:t,chatMessage:e};return this.Ee.sendRequest("chat.SendMessageToRoom",r,n)},u.prototype.subscribeToRoomConversation=function(t,e,n,r){i.isStringNotEmpty(t,"sessionId"),i.isStringNotEmpty(e,"roomId"),i.isNumber(n,"batchSize");var s={sessionId:t,roomId:e,limit:n,options:["Subscribe"]};return this.Ee.sendRequest("chat.FetchRoomConversation",s,r)},u.prototype.getMessages=function(t,e,n,r,s,o){i.isStringNotEmpty(t,"sessionId"),i.isStringNotEmpty(e,"roomId"),s&&r||i.isNumber(n,"batchSize");var a={sessionId:t,roomId:e,limit:n||0,options:[]};return s&&(i.isStringNotEmpty(s,"beforeMessageId"),a.beforeMessageId=s),r&&(i.isStringNotEmpty(r,"afterMessageId"),a.afterMessageId=r),this.Ee.sendRequest("chat.FetchRoomConversation",a,o)},u.prototype.toString=function(){return"PCastProtocol["+this.Ee.toString()+"]"},u}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(2)],void 0===(r=function(t){"use strict";function i(){this.init()}return i.prototype.init=function(){if(!t.global.AudioContext&&!t.global.webkitAudioContext)throw new Error("Browser does not support AudioContext");this.Ie=new(t.global.AudioContext||t.global.webkitAudioContext)},i.prototype.getNativeAudioContext=function(){return this.Ie},i.prototype.toString=function(){return"AudioContext"},i}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(0),e(1),e(2),e(9),e(12),e(23)],void 0===(r=function(t,i,e,n,r,s){function o(o){i.isString(o,"uri"),this.ke="/telemetry/logs",this.Te="object"==typeof location?location.hostname:e.browser+"-"+e.browserVersion+"-unknown",this.qi=n.level.TRACE,this.wi=!0,this.Se=(e.browser||"Browser")+"/"+(e.browserVersion||"?"),this.Re=0,this.xe=new r.BatchHttpProto(o+this.ke,[s],"telemetry.StoreLogRecords",{maxAttempts:3,maxBufferedRecords:1e3,maxBatchSize:512}),this.xe.on("capacity",t.bind(a,this))}function a(i){this.xe.addRecordToBeginning({level:"Warn",timestamp:t.isoString(),category:"websdk/telemetryLogger",message:"Deleted "+i+" records",source:this.Se,fullQualifiedName:this.Te,sessionId:this.Ce,userId:this.Oe,environment:this.Me,version:this.Ae,runtime:this.Re})}return o.prototype.setThreshold=function(t){i.isNumber(t,"level"),this.qi=t},o.prototype.getThreshold=function(){return this.qi},o.prototype.isEnabled=function(){return this.wi},o.prototype.setEnabled=function(t){i.isBoolean(t,"enabled"),this.wi=t},o.prototype.log=function(e,n,r,s,o,a,u,h,c){c.level<this.qi||!this.wi||(i.isArray(s,"messages"),this.Re=e,this.Ce=o,this.Oe=a,this.Me=u,this.Ae=h,function(i,e,n){this.xe.addRecord({level:i,timestamp:t.isoString(),category:e,message:n.join(" "),source:this.Se,fullQualifiedName:this.Te,sessionId:this.Ce,userId:this.Oe,environment:this.Me,version:this.Ae,runtime:this.Re})}.call(this,n,r,s))},o}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(0),e(1),e(9),e(61)],void 0===(r=function(t,i,e,n){"use strict";function r(){}return r.prototype.createPCastLogger=function(t,r){t&&i.isStringNotEmpty(t,"baseUri");var s=new e.Logger,o=n.getAppender(t);return o.setThreshold(e.level.INFO),r||s.addAppender(new e.ConsoleAppender),s.addAppender(o),s.isPCastLogger=!0,s},new r}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(0),e(1),e(22),e(59)],void 0===(r=function(t,i,e,n){var r={urls:{local:"",staging:"https://telemetry-stg.phenixp2p.com",production:"https://telemetry.phenixp2p.com"}};function s(){this.qe={}}return s.prototype.getAppender=function(t){var i=e.parseEnvFromPcastBaseUri(t||""),s=r.urls[i];return this.qe[i]||(this.qe[i]=function(t){var i=new n(t);t||i.setEnabled(!1);return i}.call(this,s)),this.qe[i]},new s}.apply(i,n))||(t.exports=r)},function(t,i,e){var n;void 0===(n=function(){"use strict";return{package:"pcast",messages:[{name:"Authenticate",fields:[{rule:"optional",type:"uint32",name:"apiVersion",id:9,options:{default:0}},{rule:"required",type:"string",name:"clientVersion",id:1},{rule:"optional",type:"string",name:"device",id:12},{rule:"required",type:"string",name:"deviceId",id:2},{rule:"optional",type:"string",name:"manufacturer",id:13},{rule:"required",type:"string",name:"platform",id:3},{rule:"required",type:"string",name:"platformVersion",id:4},{rule:"required",type:"string",name:"authenticationToken",id:5},{rule:"optional",type:"string",name:"connectionId",id:6},{rule:"optional",type:"string",name:"connectionRouteKey",id:10},{rule:"optional",type:"string",name:"remoteAddress",id:11},{rule:"optional",type:"string",name:"sessionId",id:7},{rule:"optional",type:"string",name:"applicationId",id:8}]},{name:"AuthenticateResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"sessionId",id:2},{rule:"optional",type:"string",name:"redirect",id:3},{rule:"repeated",type:"string",name:"roles",id:4}]},{name:"Bye",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"reason",id:2}]},{name:"ByeResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"SessionDescription",fields:[{rule:"required",type:"Type",name:"type",id:1,options:{default:"Offer"}},{rule:"required",type:"string",name:"sdp",id:2}],enums:[{name:"Type",values:[{name:"Offer",id:0},{name:"Answer",id:1}]}]},{name:"CreateStream",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"optional",type:"string",name:"originStreamId",id:2},{rule:"repeated",type:"string",name:"options",id:3},{rule:"optional",type:"string",name:"connectUri",id:8},{rule:"repeated",type:"string",name:"connectOptions",id:9},{rule:"repeated",type:"string",name:"tags",id:4},{rule:"optional",type:"SetRemoteDescription",name:"setRemoteDescription",id:5},{rule:"optional",type:"CreateOfferDescription",name:"createOfferDescription",id:6},{rule:"optional",type:"CreateAnswerDescription",name:"createAnswerDescription",id:7}]},{name:"IceServer",fields:[{rule:"repeated",type:"string",name:"urls",id:1},{rule:"optional",type:"string",name:"username",id:2},{rule:"optional",type:"string",name:"credential",id:3}]},{name:"RtcConfiguration",fields:[{rule:"optional",type:"BundlePolicy",name:"bundlePolicy",id:1},{rule:"optional",type:"uint32",name:"iceCandidatePoolSize",id:3},{rule:"repeated",type:"IceServer",name:"iceServers",id:4},{rule:"optional",type:"IceTransportPolicy",name:"iceTransportPolicy",id:5},{rule:"optional",type:"string",name:"peerIdentity",id:6},{rule:"optional",type:"RtcpMuxPolicy",name:"rtcpMuxPolicy",id:7}],enums:[{name:"BundlePolicy",values:[{name:"BundlePolicyBalanced",id:1},{name:"BundlePolicyMaxCompat",id:2},{name:"BundlePolicyMaxBundle",id:3}]},{name:"IceTransportPolicy",values:[{name:"IceTransportPolicyAll",id:1},{name:"IceTransportPolicyPublic",id:2},{name:"IceTransportPolicyRelay",id:3}]},{name:"RtcpMuxPolicy",values:[{name:"RtcpMuxPolicyNegotiate",id:1},{name:"RtcpMuxPolicyRequire",id:2}]}]},{name:"CreateStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"streamId",id:2},{rule:"optional",type:"string",name:"instanceRouteKey",id:5},{rule:"repeated",type:"string",name:"streamUris",id:8},{rule:"optional",type:"RtcConfiguration",name:"rtcConfiguration",id:9},{rule:"optional",type:"SetRemoteDescriptionResponse",name:"setRemoteDescriptionResponse",id:3},{rule:"optional",type:"CreateOfferDescriptionResponse",name:"createOfferDescriptionResponse",id:4},{rule:"optional",type:"CreateAnswerDescriptionResponse",name:"createAnswerDescriptionResponse",id:6},{rule:"repeated",type:"string",name:"options",id:7},{rule:"optional",type:"uint64",name:"offset",id:10,options:{default:0}}]},{name:"SetLocalDescription",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"required",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"optional",type:"uint32",name:"apiVersion",id:3,options:{default:0}}]},{name:"SetLocalDescriptionResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"string",name:"options",id:2}]},{name:"SetRemoteDescription",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"required",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"optional",type:"uint32",name:"apiVersion",id:3,options:{default:0}}]},{name:"SetRemoteDescriptionResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"repeated",type:"string",name:"options",id:3}]},{name:"CreateOfferDescription",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"repeated",type:"string",name:"options",id:2},{rule:"optional",type:"uint32",name:"apiVersion",id:3,options:{default:0}}]},{name:"CreateOfferDescriptionResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"repeated",type:"string",name:"options",id:3}]},{name:"CreateAnswerDescription",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"repeated",type:"string",name:"options",id:2},{rule:"optional",type:"uint32",name:"apiVersion",id:3,options:{default:0}}]},{name:"CreateAnswerDescriptionResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"repeated",type:"string",name:"options",id:3}]},{name:"IceCandidate",fields:[{rule:"required",type:"string",name:"candidate",id:1},{rule:"required",type:"uint32",name:"sdpMLineIndex",id:2},{rule:"required",type:"string",name:"sdpMid",id:3}]},{name:"AddIceCandidates",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"repeated",type:"IceCandidate",name:"candidates",id:2},{rule:"repeated",type:"string",name:"options",id:3},{rule:"optional",type:"uint32",name:"apiVersion",id:4,options:{default:0}}]},{name:"AddIceCandidatesResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"string",name:"options",id:2}]},{name:"UpdateStreamState",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"required",type:"string",name:"signalingState",id:2},{rule:"required",type:"string",name:"iceGatheringState",id:3},{rule:"required",type:"string",name:"iceConnectionState",id:4},{rule:"optional",type:"uint32",name:"apiVersion",id:5,options:{default:0}}]},{name:"UpdateStreamStateResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"string",name:"options",id:2}]},{name:"DestroyStream",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"optional",type:"string",name:"reason",id:2},{rule:"repeated",type:"string",name:"options",id:3}]},{name:"DestroyStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"ConnectionDisconnected",fields:[{rule:"required",type:"string",name:"connectionId",id:1},{rule:"required",type:"uint32",name:"reasonCode",id:2},{rule:"optional",type:"string",name:"description",id:3}]},{name:"ConnectionDisconnectedResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"StreamStarted",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"repeated",type:"string",name:"tags",id:3}]},{name:"SourceStreamStarted",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"repeated",type:"string",name:"capabilities",id:3},{rule:"repeated",type:"string",name:"tags",id:4}]},{name:"StreamEnded",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"string",name:"reason",id:3},{rule:"repeated",type:"string",name:"tags",id:4},{rule:"optional",type:"string",name:"continuationId",id:5},{rule:"optional",type:"string",name:"routeKey",id:6}]},{name:"SourceStreamEnded",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"string",name:"reason",id:3},{rule:"repeated",type:"string",name:"capabilities",id:4},{rule:"repeated",type:"string",name:"tags",id:5}]},{name:"StreamEndedResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"continuationId",id:2},{rule:"optional",type:"string",name:"routeKey",id:3}]},{name:"StreamIdle",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"repeated",type:"string",name:"options",id:3},{rule:"repeated",type:"string",name:"tags",id:4}]},{name:"StreamArchived",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"string",name:"uri",id:3}]},{name:"SessionEnded",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"reason",id:2},{rule:"required",type:"float",name:"duration",id:3}]},{name:"StreamPlaylist",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"PlaylistType",name:"playlistType",id:3},{rule:"required",type:"string",name:"uri",id:4}],enums:[{name:"PlaylistType",values:[{name:"Live",id:0},{name:"OnDemand",id:1}]}]},{name:"ForwardToClient",fields:[{rule:"required",type:"string",name:"connectionId",id:1},{rule:"required",type:"string",name:"type",id:2},{rule:"required",type:"bytes",name:"payload",id:3}]},{name:"ForwardToClientResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"SetupStream",fields:[{rule:"required",type:"string",name:"streamToken",id:1},{rule:"required",type:"CreateStream",name:"createStream",id:2}]},{name:"SetupStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"CreateStreamResponse",name:"createStreamResponse",id:2}]},{name:"SetupPlaylistStream",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamToken",id:2},{rule:"repeated",type:"string",name:"options",id:3},{rule:"repeated",type:"string",name:"tags",id:4}]},{name:"PlaylistStreamManifest",fields:[{rule:"required",type:"string",name:"manifest",id:1},{rule:"required",type:"bool",name:"isProtectedContent",id:2}]},{name:"SetupPlaylistStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"PlaylistStreamManifest",name:"manifests",id:2},{rule:"optional",type:"uint64",name:"offset",id:3,options:{default:0}}]},{name:"StreamDataQuality",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"uint64",name:"timestamp",id:3},{rule:"required",type:"DataQualityStatus",name:"status",id:4},{rule:"required",type:"DataQualityReason",name:"reason",id:5}],enums:[{name:"DataQualityStatus",values:[{name:"NoData",id:0},{name:"AudioOnly",id:1},{name:"All",id:2}]},{name:"DataQualityReason",values:[{name:"None",id:0},{name:"UploadLimited",id:1},{name:"DownloadLimited",id:2},{name:"PublisherLimited",id:3},{name:"NetworkLimited",id:4}]}]},{name:"StreamDataQualityResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"CallbackEvent",fields:[{rule:"optional",type:"uint32",name:"apiVersion",id:1,options:{default:0}},{rule:"required",type:"string",name:"entity",id:2},{rule:"required",type:"string",name:"what",id:3},{rule:"required",type:"string",name:"data",id:4},{rule:"optional",type:"string",name:"sessionId",id:5}]},{name:"Uri",fields:[{rule:"optional",type:"string",name:"protocol",id:1,options:{default:"http"}},{rule:"required",type:"string",name:"host",id:2},{rule:"optional",type:"uint32",name:"port",id:3,options:{default:80}},{rule:"optional",type:"string",name:"method",id:4,options:{default:"POST"}},{rule:"optional",type:"string",name:"path",id:5,options:{default:"/"}}]},{name:"SetApplicationCallback",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"required",type:"Uri",name:"callback",id:3}]},{name:"SetApplicationCallbackResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"IssueAuthenticationToken",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"repeated",type:"string",name:"capabilities",id:3}]},{name:"IssueAuthenticationTokenResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"authenticationToken",id:2}]},{name:"IssueStreamToken",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"required",type:"string",name:"sessionId",id:3},{rule:"optional",type:"string",name:"originStreamId",id:4},{rule:"repeated",type:"string",name:"capabilities",id:5}]},{name:"IssueStreamTokenResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"streamToken",id:2}]},{name:"IssueDrmToken",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"required",type:"string",name:"streamToken",id:3},{rule:"optional",type:"string",name:"sessionId",id:4},{rule:"required",type:"string",name:"originStreamId",id:5},{rule:"repeated",type:"string",name:"capabilities",id:6}]},{name:"IssueDrmTokenResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"drmToken",id:2}]},{name:"TerminateStream",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"optional",type:"string",name:"streamId",id:3,oneof:"streamOrToken"},{rule:"optional",type:"string",name:"streamToken",id:5,oneof:"streamOrToken"},{rule:"optional",type:"string",name:"reason",id:4}],oneofs:{streamOrToken:[3,5]}},{name:"TerminateStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"Stream",fields:[{rule:"required",type:"string",name:"streamId",id:1}]},{name:"ListStreams",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"optional",type:"string",name:"start",id:3},{rule:"required",type:"uint32",name:"length",id:4},{rule:"repeated",type:"string",name:"options",id:5}]},{name:"ListStreamsResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"start",id:2},{rule:"optional",type:"uint32",name:"length",id:3},{rule:"repeated",type:"Stream",name:"streams",id:4}]}]}}.apply(i,[]))||(t.exports=n)},function(t,i,e){var n;void 0===(n=function(){"use strict";return{package:"shim",messages:[]}}.apply(i,[]))||(t.exports=n)},function(t,i,e){var n,r;n=[e(0),e(1),e(2)],void 0===(r=function(t,i){"use strict";var e=/profile-level-id=[^;\n]*/;function n(){}return n.prototype.getH264ProfileId=function(n){i.isStringNotEmpty(n,"offerSdp");var r=t.get(n.match(e),"0","");return t.get(r.split("="),"1",null)},n.prototype.replaceH264ProfileId=function(t,e){i.isStringNotEmpty(t,"offerSdp"),i.isStringNotEmpty(e,"newProfileId");var n=this.getH264ProfileId(t);return n?t.replace("profile-level-id="+n,"profile-level-id="+e):t},new n}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(0),e(1),e(4),e(5),e(3),e(2),e(15),e(8),e(6)],void 0===(r=function(t,i,e,n,r,s,o,a,u){"use strict";var h=5e3,c=5,f=250,l=6e3,d=15e3,p=3e3;function m(i,n,r,s,o){this.R=o,this.Ne=i,this.Pe=encodeURI(n).replace(/[#]/g,"%23"),this.je=[],this.Ue=r,this.mt=s,this.De=null,this.Fe=new a(o),this.Le={time:0,buffered:null,averageLength:0,count:0,setupRetry:0,lastCurrentTime:0,lastCurrentTimeOccurenceTimestamp:0},this.kt=new e.NamedEvents,this.Be=t.bind(w,this),this.Ve=t.bind(y,this),this.We=t.bind(b,this),this.Zt=t.bind(g,this),this.ze=t.bind(E,this)}function v(i){s.attachUriStream(i,this.Pe),!1===this.mt.receiveAudio&&(i.muted=!0),t.addEventListener(i,"error",this.Zt,!0),t.addEventListener(i,"stalled",this.Be,!1),t.addEventListener(i,"pause",this.Be,!1),t.addEventListener(i,"suspend",this.Be,!1),t.addEventListener(i,"progress",this.Ve,!1),t.addEventListener(i,"ended",this.We,!1),t.addEventListener(i,"waiting",this.ze,!1),this.De=i,this.Fe.start(this,this.De)}function g(i){var e=this,n=f*e.Le.setupRetry*e.Le.setupRetry,r=0===e.Le.count,s=e.Le.setupRetry<=c;if(4===t.get(this.De,["error","code"])&&r&&s)return setTimeout(function(){e.Le.setupRetry++,T.call(e)},Math.max(n,f));this.kt.fire(u.rendererEvents.error.name,["player",i])}function y(){if(this.Le.time=t.now(),0===this.De.buffered.length)return this.R.debug("[%s] Hls stream progress event fired without any buffered content",this.Ne);var i=this.De.buffered.end(this.De.buffered.length-1);if(this.Le.buffered!==i){if(null!==this.Le.buffered){var e=this.Le.averageLength*this.Le.count+(i-this.Le.buffered);this.Le.count+=1,this.Le.averageLength=e/this.Le.count,this.Le.lastCurrentTime!==this.De.currentTime&&(this.Le.lastCurrentTimeOccurenceTimestamp=t.now()),this.Le.lastCurrentTimeOccurenceTimestamp&&t.now()-this.Le.lastCurrentTimeOccurenceTimestamp>l&&this.De&&!this.De.paused&&I.call(this)&&(this.R.warn("Reloading stream after current time has not changed for [%s] seconds due to unregistered stall.",l/1e3),k.call(this))}this.Le.buffered=i,this.Le.setupRetry=0,this.Le.lastCurrentTime=this.De.currentTime}}function w(){if(this.R.info("[%s] Loading Hls stream stalled.",this.Ne),this.Le.setupRetry>c)return this.R.warn("[%s] Unable to recover from stalled Hls Stream.",this.Ne);var i=this,e=this.De.currentTime;0===this.Le.count?(this.Le.setupRetry++,T.call(i)):(setTimeout(function(){0===i.Le.count&&(i.Le.setupRetry++,T.call(i))},S.call(i)),setTimeout(function(){i.De&&i.De.currentTime===e&&!i.De.paused&&I.call(i)&&(i.R.warn("Reloading stream after being stalled for [%s] seconds",l/1e3),k.call(i))},l),setTimeout(t.bind(R,i),h))}function b(){this.R.info("[%s] Hls stream ended",this.Ne),this.stop("ended")}function E(){this.R.info("Time elapsed since last progress [%s]",t.now()-this.Le.time),setTimeout(t.bind(R,this),S.call(this))}function I(){var i=!this._e||t.now()-this._e>d;return this.De&&!this.He&&0!==this.De.buffered.length&&i}function k(){I.call(this)&&(this.R.warn("Reloading unhealthy stream that was active for at least [%s] seconds",d/1e3),this._e=t.now(),T.call(this))}function T(){this.R.info("[%s] Attempting to reload Hls stream.",this.Ne);try{this.De.setAttribute("src",""),this.De.setAttribute("src",this.Pe)}catch(t){this.R.warn("Error while reloading Hls stream [%s]",t)}}function S(){return 1.5*this.Le.averageLength<2e3?2e3:1.5*this.Le.averageLength}function R(){t.now()-this.Le.time>S.call(this)&&this.He&&this.stop("ended")}function x(i){if(i){if(clearTimeout(this.$e),this.$e=null,!this.Ge)return;return this.Ge=!1,void this.start(this.De)}var e=this;this.$e=setTimeout(function(){o.isForeground()||function(i){if(i.muted)return!1;return t.get(i,["webkitAudioDecodedByteCount"],0)>0||t.get(i,["audioTracks","length"],0)>0||i.webkitHasAudio}(e.De)||(e.R.info("Detecting application [background] with muted video. Pausing playback until application focused again."),e.De.pause(),e.Ge=!0)},p)}return m.prototype.on=function(t,i){return this.kt.listen(t,i)},m.prototype.start=function(i){try{var e=t.now()-this.mt.originStartTime;this.z=new r.DisposableList,this.z.add(o.onBackground(t.bind(x,this,!1))),this.z.add(o.onForeground(t.bind(x,this,!0))),this.Ue.recordTimeToFirstFrame(i),this.Ue.recordRebuffering(i),this.Ue.recordVideoResolutionChanges(this,i),e<6e3&&this.mt.isDrmProtectedContent?setTimeout(t.bind(v,this,i),6e3):v.call(this,i)}catch(t){this.R.error("[%s] Error while loading HLS live stream [%s]",this.Ne,t.code,t),this.kt.fire(u.rendererEvents.error.name,["hls",t])}return i},m.prototype.stop=function(i,e){var n=this;if(!n.Qe){if(e)return n.He=!0;if(this.Fe.stop(),this.Ue.stop(),this.z.dispose(),this.De){var r=function(){n.De&&(t.removeEventListener(n.De,"error",n.Zt,!0),t.removeEventListener(n.De,"stalled",n.Be,!1),t.removeEventListener(n.De,"pause",n.Be,!1),t.removeEventListener(n.De,"suspend",n.Be,!1),t.removeEventListener(n.De,"progress",n.Ve,!1),t.removeEventListener(n.De,"ended",n.We,!1),t.removeEventListener(n.De,"waiting",n.ze,!1),"Safari"===s.browser&&s.browserVersion>=11?n.De.setAttribute("src",""):n.De.src="",n.De=null);n.kt.fire(u.rendererEvents.ended.name,[""])};try{n.De.pause(),n.R.info("[%s] HLS live stream has been destroyed",n.Ne),r()}catch(t){n.R.error("[%s] Error while destroying HLS live stream [%s]",n.Ne,t.code,t),r(),n.kt.fire(u.rendererEvents.error.name,["hls",t])}n.Qe=!0}}},m.prototype.getStats=function(){if(!this.De)return{width:0,height:0,currentTime:0,lag:0,networkState:u.networkStates.networkNoSource.id};var i=this.De&&this.De.currentTime||0,e=this.De&&this.De.buffered&&this.De.buffered.length>0?this.De.buffered.end(this.De.buffered.length-1):0,n=Math.max(0,e-i);this.je.push(n),this.je.length>15&&this.je.shift();for(var r=0,s=0,o=this.je.length;s<o;s++)r=Math.max(r,this.je[s]);var a=(t.now()-this.mt.originStartTime)/1e3,h=4+r,c=a-h;return{width:this.De.videoWidth||this.De.width,height:this.De.videoHeight||this.De.height,currentTime:c,originTime:a,lag:h,networkState:this.De.networkState}},m.prototype.setDataQualityChangedCallback=function(t){i.isFunction(t,"callback"),this.dataQualityChangedCallback=t},m.prototype.getPlayer=function(){return null},m.prototype.addVideoDisplayDimensionsChangedCallback=function(t,i){this.Fe.addVideoDisplayDimensionsChangedCallback(t,i)},m}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(0),e(1),e(4),e(2),e(70),e(65),e(67),e(6)],void 0===(r=function(t,i,e,n,r,s,o,a){"use strict";function u(t,i,n,r,s,o,a){this.Je=t,this.Ne=i,this.gi=n,this.Ue=r,this.mt=s,this.L=o,this.R=a,this.q=null,this.De=null,this.Fe=null,this.kt=new e.NamedEvents}return u.prototype.on=function(t,i){this.kt.listen(t,i)},u.prototype.createRenderer=function(){switch(this.Je){case a.types.dash.name:this.L?this.q=new r(this.Ne,this.gi,this.Ue,this.mt,this.L,this.R):this.q=new o(this.Ne,this.gi,this.Ue,this.mt,this.R);break;case a.types.hls.name:o.isSupported()&&!this.mt.useNativeHlsPlayer?this.q=new o(this.Ne,this.gi,this.Ue,this.mt,this.R):this.q=new s(this.Ne,this.gi,this.Ue,this.mt,this.R);break;default:throw new Error("Unsupported Live stream Type "+this.Je)}var t=this;return this.q.on(a.rendererEvents.error.name,function(i,e){t.kt.fire(a.streamEvents.playerError.name,[i,e])}),this.q.on(a.rendererEvents.ended.name,function(i){t.kt.fire(a.streamEvents.playerEnded.name,[i])}),this.q},u.prototype.select=function(t){return this.R.warn("[%s] selection of tracks not supported for [%s] live streams",this.Ne,this.Je),this},u.prototype.setStreamEndedCallback=function(t){i.isFunction(t,"callback"),this.streamEndedCallback=t},u.prototype.setStreamErrorCallback=function(t){i.isFunction(t,"callback"),this.streamErrorCallback=t},u.prototype.stop=function(t){this.isActive()&&(this.R.info("[%s] stop media stream",this.Ne),this.kt.fire(a.streamEvents.stopped.name,[t]),this.Ke=!0)},u.prototype.monitor=function(t,e){i.isObject(t,"options"),i.isFunction(e,"callback")},u.prototype.getMonitor=function(){return null},u.prototype.getStream=function(){return this.R.debug("[%s] stream not available for [%s] live streams",this.Ne,this.Je),null},u.prototype.isActive=function(){return!this.Ke},u.prototype.getStreamId=function(){return this.Ne},u.prototype.getStats=function(){return this.R.debug("[%s] stats not available for [%s] live streams",this.Ne,this.Je),null},u.prototype.getRenderer=function(){return this.q},u}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(0),e(1),e(9),e(4),e(5),e(21),e(2),e(8),e(6)],void 0===(r=function(t,i,e,n,r,s,o,a,u){"use strict";var h=3e6,c=6e3,f=15e3;function l(i,e,r,s,o){this.R=o,this.Ne=i,this.Xe=encodeURI(e).replace(/[#]/g,"%23"),this.Ue=r,this.mt=s,this.q=null,this.De=null,this.Fe=new a(o),this.Le={time:0,buffered:null,averageLength:0,count:0,lastCurrentTime:0,lastCurrentTimeOccurenceTimestamp:0},this.kt=new n.NamedEvents,this.Be=t.bind(g,this),this.Ve=t.bind(v,this),this.We=t.bind(w,this)}function d(t){if(t&&3===t.code&&m.call(this))return p.call(this);this.kt.fire(u.rendererEvents.error.name,["phenix-player",t])}function p(){m.call(this)&&(this.R.warn("Reloading unhealthy stream that was active for at least [%s] seconds",f/1e3),this._e=t.now(),function(){this.Ze.dispose(),this.Ye.dispose(),this.in.dispose(),this.en.dispose(),this.Ze=null,this.Ye=null,this.in=null,this.en=null,this.start(this.De)}.call(this))}function m(){var i=!this._e||t.now()-this._e>f;return this.De&&!this.He&&this.Ze&&0!==this.De.buffered.length&&i}function v(){if(this.Le.time=t.now(),0===this.De.buffered.length)return this.R.debug("[%s] Phenix live stream player progress event fired without any buffered content",this.Ne);var i=this.De.buffered.end(this.De.buffered.length-1);if(this.Le.buffered!==i){if(null!==this.Le.buffered){var e=this.Le.averageLength*this.Le.count+(i-this.Le.buffered);this.Le.count+=1,this.Le.averageLength=e/this.Le.count,this.Le.lastCurrentTime!==this.De.currentTime&&(this.Le.lastCurrentTimeOccurenceTimestamp=t.now()),this.Le.lastCurrentTimeOccurenceTimestamp&&t.now()-this.Le.lastCurrentTimeOccurenceTimestamp>c&&this.De&&!this.De.paused&&m.call(this)&&(this.R.warn("Reloading stream after current time has not changed for [%s] seconds due to unregistered stall.",c/1e3),p.call(this))}this.Le.buffered=i,this.Le.lastCurrentTime=this.De.currentTime}}function g(i){var e=this;if(e.R.info("[%s] Loading Phenix Live stream player stalled caused by [%s] event.",e.Ne,i.type),0!==e.Le.time){var n=e.De.currentTime;setTimeout(function(){t.now()-e.Le.time>y.call(e)&&e.He&&e.stop("ended")},y.call(e)),setTimeout(function(){e.De&&e.De.currentTime===n&&!e.De.paused&&m.call(e)&&(e.R.warn("Reloading stream after being stalled for [%s] seconds",c/1e3),p.call(e))},c)}}function y(){return 1.5*this.Le.averageLength<2e3?2e3:1.5*this.Le.averageLength}function w(){this.R.info("[%s] Phenix live stream player ended.",this.Ne)}return l.isSupported=function(){return s.isSupported},l.prototype.on=function(t,i){return this.kt.listen(t,i)},l.prototype.start=function(i){var n,r,o,a=this,c=(n=this.R,r=n.getAppenders(),o=new e.Logger,t.forEach(r,function(t){t instanceof e.ConsoleAppender&&(t=new e.ConsoleAppender).setThreshold(e.level.INFO),o.addAppender(t)}),o.setUserId(n.getUserId()),o.setEnvironment(n.getEnvironment()),o.setApplicationVersion(n.getApplicationVersion()),o.setObservableSessionId(n.getObservableSessionId()),o),f=new s.Playlist(c,this.Xe);return this.nn=c,this.Ye=f,this.De=i,this.Ue.recordTimeToFirstFrame(i),this.Ue.recordRebuffering(i),this.Ue.recordVideoResolutionChanges(this,i),this.Ue.recordVideoPlayingAndPausing(i),f.fetch(function(i){if(i)return a.kt.fire(u.rendererEvents.error.name,["phenix-player",i]);(function(){var i,e=new s.StatsProvider(this.nn,{ewmaPeriods:30}),n={bandwidthToStartAt:this.mt.bandwidthToStartAt||h},r={};t.isNumber(this.mt.targetMinBufferSize)&&(n.targetMinBufferSize=this.mt.targetMinBufferSize,r.targetBufferSizeInMS=1e3*this.mt.targetMinBufferSize);"Dash"===this.Ye.getDeliveryType()?(i=new s.MpdPlaylistChunkFeeder(this.nn,this.Ye,e,r),this.mt.isDrmProtectedContent&&(n.drm={"com.widevine.alpha":{serverCertificateUrl:this.mt.widevineServiceCertificateUrl,mediaKeySystemConfiguration:{persistentState:"required"}},"com.microsoft.playready":{licenseServerUrl:this.mt.playreadyLicenseUrl}})):"Hls"===this.Ye.getDeliveryType()&&(i=new s.M3u8PlaylistChunkFeeder(this.nn,this.Ye,e,r));var o=new s.WebPlayer(this.nn,this.Ye,this.De,i,n),a=new s.AdaptiveStreamingManager(this.nn,this.Ye,o,e);o.start(),this.Ze=o,this.in=e,this.en=a,t.addEventListener(this.Ze,"error",t.bind(d,this))}).call(a)}),!1===a.mt.receiveAudio&&(i.muted=!0),t.addEventListener(i,"stalled",a.Be,!1),t.addEventListener(i,"pause",a.Be,!1),t.addEventListener(i,"suspend",a.Be,!1),t.addEventListener(i,"progress",a.Ve,!1),t.addEventListener(i,"ended",a.We,!1),a.Fe.start(this,i),i},l.prototype.stop=function(i,e){var n=this;if(!n.Qe){if(e)return n.He=!0;if(this.Fe.stop(),this.Ue.stop(),this.Ze){var r=function(){n.De&&(t.removeEventListener(n.De,"stalled",n.Be,!1),t.removeEventListener(n.De,"pause",n.Be,!1),t.removeEventListener(n.De,"suspend",n.Be,!1),t.removeEventListener(n.De,"progress",n.Ve,!1),t.removeEventListener(n.De,"ended",n.We,!1),"Edge"===o.browser&&(n.De.src="")),n.kt.fire(u.rendererEvents.ended.name,[""]),n.Ze=null,n.De=null};n.Qe=!0;try{n.Ze.dispose(),n.Ye.dispose(),n.in.dispose(),n.en.dispose(),n.R.info("[%s] Phenix live stream has been destroyed",n.Ne),r()}catch(t){n.R.error("[%s] Error while destroying Phenix live stream player [%s]",n.Ne,t.code,t),r(),n.kt.fire(u.rendererEvents.error.name,["phenix-player",t])}}}},l.prototype.getStats=function(){if(!this.in||!this.Ze)return{width:0,height:0,currentTime:0,lag:0,networkState:u.networkStates.networkNoSource.id};var i=t.assign(this.in.getRateAverages(),{currentTime:0,lag:0}),e=t.get(this.De,["currentTime"],0),n=(t.now()-this.mt.originStartTime)/1e3,r=Math.max(0,n-e);return this.De&&(i.currentTime=e,i.lag=r),i.estimatedBandwidth>0?i.networkState=u.networkStates.networkLoading.id:i.playTime>0?i.networkState=u.networkStates.networkIdle.id:i.video?i.networkState=u.networkStates.networkEmpty.id:i.networkState=u.networkStates.networkNoSource.id,i},l.prototype.setDataQualityChangedCallback=function(t){i.isFunction(t,"callback"),this.dataQualityChangedCallback=t},l.prototype.getPlayer=function(){return this.Ze},l.prototype.addVideoDisplayDimensionsChangedCallback=function(t,i){this.Fe.addVideoDisplayDimensionsChangedCallback(t,i)},l}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(0),e(1),e(4),e(5),e(2),e(8),e(6)],void 0===(r=function(t,i,e,n,r,s,o){"use strict";function a(i,n,r,o,a){this.R=a,this.Ne=i,this.rn=n,this.Ue=r,this.mt=o,this.q=null,this.De=null,this.Fe=new s(a),this.kt=new e.NamedEvents,this.Be=t.bind(u,this),this.We=t.bind(h,this)}function u(t){this.R.info("[%s] Loading Phenix Real-Time stream player stalled caused by [%s] event.",this.Ne,t.type)}function h(){this.R.info("[%s] Phenix Real-Time stream ended.",this.Ne)}return a.prototype.on=function(t,i){return this.kt.listen(t,i)},a.prototype.start=function(i){var e=!!t.find(this.rn.getTracks(),function(t){return"audio"===t.kind});return this.mt.canPlaybackAudio||(this.mt.disableAudioIfNoOutputFound&&this.mt.forcedAudioDisabled?this.R.warn("[%s] Missing audio playback device. Audio has been disabled on stream. Try setting up an audio device and re-subscribe in order to receive audio.",this.Ne):!this.mt.disableAudioIfNoOutputFound&&e&&this.R.warn("[%s] Missing audio playback device. May experience audio and/or video failure. Try setting up an audio device OR pass the [disableAudioIfNoOutputFound] option when subscribing to disable audio playback when no devices are attached.",this.Ne)),this.De=r.attachMediaStream(i,this.rn),this.Ue.recordTimeToFirstFrame(i),this.Ue.recordRebuffering(i),this.Ue.recordVideoResolutionChanges(this,i),this.Ue.recordVideoPlayingAndPausing(i),!1===this.mt.receiveAudio&&(i.muted=!0),t.addEventListener(i,"stalled",this.Be,!1),t.addEventListener(i,"pause",this.Be,!1),t.addEventListener(i,"suspend",this.Be,!1),t.addEventListener(i,"ended",this.We,!1),this.Fe.start(this,i),i},a.prototype.stop=function(i){this.Fe.stop(),this.Ue.stop(),this.De&&(t.removeEventListener(this.De,"stalled",this.Be,!1),t.removeEventListener(this.De,"pause",this.Be,!1),t.removeEventListener(this.De,"suspend",this.Be,!1),t.removeEventListener(this.De,"ended",this.We,!1),"function"==typeof this.De.pause&&this.De.pause(),"Edge"===r.browser&&(this.De.src=""),this.De.src&&"IE"===r.browser?this.De.src=null:this.De.src&&(this.De.src=""),this.De.srcObject&&(this.De.srcObject=null),this.De=null),this.R.info("[%s] Phenix real-time renderer has been destroyed",this.Ne),this.kt.fire(o.rendererEvents.ended.name,[i])},a.prototype.getStats=function(){if(!this.De)return{width:0,height:0,currentTime:0,lag:0,networkState:o.networkStates.networkNoSource.id};var i=(t.now()-this.mt.originStartTime)/1e3,e=this.mt.networkLag/1e3;return{width:this.De.videoWidth||this.De.width,height:this.De.videoHeight||this.De.height,currentTime:i,lag:e,networkState:this.De.networkState}},a.prototype.setDataQualityChangedCallback=function(t){i.isFunction(t,"callback"),this.dataQualityChangedCallback=t},a.prototype.addVideoDisplayDimensionsChangedCallback=function(t,i){this.Fe.addVideoDisplayDimensionsChangedCallback(t,i)},a}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(0),e(1),e(4),e(2),e(24),e(25),e(68),e(6)],void 0===(r=function(t,i,e,n,r,s,o,a){"use strict";var u=5e3;function h(i,n,r,s,o,a){this.Ne=i,this.rn=n,this.jt=r,this.Ue=s,this.mt=o,this.R=a,this.q=null,this.De=null,this.Fe=null,this.kt=new e.NamedEvents,this.sn=[],t.addEventListener(r,"iceconnectionstatechange",t.bind(f,this))}function c(e){return t.reduce(e.getTracks(),function(t,e){return t&&function(t){return i.isObject(t,"track"),"ended"===t.readyState}(e)},!0)}function f(){var i=this;switch(this.jt.iceConnectionState){case"checking":case"connecting":if(t.isNumber(this.an))return;this.un=t.now(),this.an=setTimeout(function(){i.R.warn("[%s] Stream has not connected withing [%s] ms.",i.Ne,u),i.kt.fire(a.streamEvents.playerError.name,["real-time",new Error("connection-timeout")])},u);break;case"connected":t.isNumber(this.an)&&(clearTimeout(this.an),this.an=null),this.R.info("[%s] Ice Connection completed after [%s] ms",this.Ne,t.now()-this.un),this.un=null}}return h.prototype.on=function(t,i){this.kt.listen(t,i)},h.prototype.createRenderer=function(){var t=this;return this.q=new o(this.Ne,this.rn,this.Ue,this.mt,this.R),this.q.on(a.rendererEvents.error.name,function(i,e){t.kt.fire(a.streamEvents.playerError.name,[i,e])}),this.q.on(a.rendererEvents.ended.name,function(i){t.kt.fire(a.streamEvents.playerEnded.name,[i])}),this.q},h.prototype.select=function(t){i.isFunction(t,"trackSelectCallback"),i.isFunction(n.global.MediaStream,"rtc.global.MediaStream");for(var e=this.rn.getTracks(),r=new n.global.MediaStream,s=0;s<e.length;s++)t(e[s],s)&&r.addTrack(e[s]);if(0===r.getTracks().length)return this.R.warn("No tracks selected");var o=this,u=new h(this.Ne,r,this.jt,this.Ue,this.mt,this.R);return u.on(a.streamEvents.stopped.name,function(t){c(o.rn)&&o.kt.fire(a.streamEvents.stopped.name,[t])}),this.sn.push(u),u},h.prototype.setStreamEndedCallback=function(t){i.isFunction(t,"callback"),this.hn=t},h.prototype.setStreamErrorCallback=function(t){i.isFunction(t,"callback"),this.cn=t},h.prototype.streamEndedCallback=function(i,e,n){t.forEach(this.sn,function(t){t.streamEndedCallback(e,n)}),t.isFunction(this.hn)&&this.hn(this,e,n)},h.prototype.streamErrorCallback=function(i,e,n){t.forEach(this.sn,function(t){t.streamErrorCallback(e,n)}),t.isFunction(this.cn)&&this.cn(i,e,n)},h.prototype.stop=function(i){this.isActive()&&(!function(i){i&&t.isFunction(i.stop,"stream.stop")&&i.stop();t.forEach(i&&i.getTracks?i.getTracks():[],function(t){t.stop()})}(this.rn),this.R.info("[%s] stop media stream",this.Ne),this.kt.fire(a.streamEvents.stopped.name,[i]),this.Ke=!0)},h.prototype.monitor=function(t,e){i.isObject(t,"options"),i.isFunction(e,"callback");var n=this,r=new s(n.Ne,n.jt,n.R);return t.direction="inbound",r.start(t,function(){return n.isActive()},function(t,i){return t&&n.R.warn("[%s] Media stream monitor triggered unrecoverable error [%s]",t),n.R.warn("[%s] Media stream triggered monitor condition for [%s]",n.Ne,i.type),e(n,"client-side-failure",i)}),this.fn=r,r},h.prototype.getMonitor=function(){return this.fn},h.prototype.getStream=function(){return this.rn},h.prototype.isActive=function(){return!this.Ke&&!c(this.rn)},h.prototype.getStreamId=function(){return this.Ne},h.prototype.getStats=function(t){i.isFunction(t,"callback"),this.dt||(this.dt={});var e=this;return n.getStats(this.jt,null,function(i){t(r.convertPeerConnectionStats(i,e.dt))})},h.prototype.getRenderer=function(){return this.q},h}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(0),e(1),e(4),e(5),e(2),e(8),e(6)],void 0===(r=function(t,i,e,n,r,s,o){"use strict";var a=null;function u(i,n,r,o,a,u){this.R=u,this.Ne=i,this.Xe=encodeURI(n).replace(/[#]/g,"%23"),this.Ue=r,this.mt=o,this.q=null,this.De=null,this.Fe=new s(u),this.Le={time:0,buffered:null,averageLength:0,count:0},this.kt=new e.NamedEvents,this.L=a,this.Be=t.bind(c,this),this.Ve=t.bind(h,this),this.We=t.bind(l,this)}function h(){if(this.Le.time=t.now(),0===this.De.buffered.length)return this.R.debug("[%s] Shaka live stream player progress event fired without any buffered content",this.Ne);var i=this.De.buffered.end(this.De.buffered.length-1);if(this.Le.buffered!==i){if(null!==this.Le.buffered){var e=this.Le.averageLength*this.Le.count+(i-this.Le.buffered);this.Le.count+=1,this.Le.averageLength=e/this.Le.count}this.Le.buffered=i}}function c(){var i=this;i.R.info("[%s] Loading Shaka live stream player stream stalled.",i.Ne),0!==i.Le.time&&setTimeout(function(){t.now()-i.Le.time>f.call(i)&&i.He&&i.stop("ended")},f.call(i))}function f(){return 1.5*this.Le.averageLength<2e3?2e3:1.5*this.Le.averageLength}function l(){this.R.info("[%s] Shaka live stream player ended.",this.Ne)}return u.prototype.on=function(t,i){return this.kt.listen(t,i)},u.prototype.start=function(i){var e=this;e.Ze=new this.L.Player(i),e.Ue.recordTimeToFirstFrame(i),e.Ue.recordRebuffering(i),e.Ue.recordVideoResolutionChanges(this,i);var s={abr:{defaultBandwidthEstimate:2e6},manifest:{retryParameters:{timeout:1e4}},streaming:{rebufferingGoal:2,bufferingGoal:10,bufferBehind:30,retryParameters:{timeout:1e4,maxAttempts:10,backoffFactor:1.1}}};function u(n){e.Ze.configure(n),!1===e.mt.receiveAudio&&(i.muted=!0),t.addEventListener(e.Ze,"error",function(t){e.kt.fire(o.rendererEvents.error.name,["player",t])}),t.addEventListener(i,"stalled",e.Be,!1),t.addEventListener(i,"pause",e.Be,!1),t.addEventListener(i,"suspend",e.Be,!1),t.addEventListener(i,"progress",e.Ve,!1),t.addEventListener(i,"ended",e.We,!1),e.Ze.load(e.Xe).then(function(){e.R.info("[%s] DASH live stream has been loaded",e.Ne),t.isFunction(i.play)&&i.play()}).catch(function(t){e.R.error("[%s] Error while loading DASH live stream [%s]",e.Ne,t.code,t),e.kt.fire(o.rendererEvents.error.name,["shaka",t])}),e.Fe.start(this,i),e.De=i}return this.mt.isDrmProtectedContent?(function(){var i;if(!t.isFunction(Uint8Array))throw i="Uint8Array support required for DRM",this.R.error(i),new Error(i);if(!t.isFunction(r.global.atob))throw i="rtc.global.atob support required for DRM",this.R.error(i),new Error(i)}.call(e),function(t){var i=this;t.getNetworkingEngine().registerResponseFilter(function(e,n){if(e.toString()===i.L.net.NetworkingEngine.RequestType.LICENSE.toString()){var s=new Uint8Array(n.data),o=String.fromCharCode.apply(null,s),a=JSON.parse(o),u=a.license,h=r.global.atob(u);n.data=new Uint8Array(h.length);for(var c=0;c<h.length;++c)n.data[c]=h.charCodeAt(c);a.trackRestrictions&&t.configure({restrictions:a.trackRestrictions})}})}.call(e,e.Ze),function(t,i,e){t.drm||(t.drm={});t.drm.advanced||(t.drm.advanced={});t.manifest||(t.manifest={});t.manifest.dash||(t.manifest.dash={});(function(t,i,e){function r(i,n){i?e(i):(a=n.data,t.drm.advanced["com.widevine.alpha"]={serverCertificate:function(t){for(var i=t.length,e=new Uint8Array(i),n=0;n<i;n++)e[n]=t.charCodeAt(n);return e}(n.data),persistentStateRequired:!0,distinctiveIdentifierRequired:!1},e(null,t))}t.manifest.dash.customScheme=function(t){if("com.phenixrts.widevine"===t.getAttribute("schemeIdUri")||"com.phenixp2p.widevine"===t.getAttribute("schemeIdUri"))return[{keySystem:"com.widevine.alpha",licenseServerUri:decodeURIComponent(t.getAttribute("widevineLicenseServerUrl"))}]},a?r(null,a):n.get(i.widevineServiceCertificateUrl,{mimeType:"text/plain; charset=x-user-defined"},r)}).call(this,t,i,e)}.call(e,s,e.mt,function(t,i){if(t)throw e.R.error("Failed to add DRM configuration to shaka player",t),t;u(i)})):u(s),i},u.prototype.stop=function(i,e){var n=this;if(!n.Qe){if(e)return n.He=!0;if(this.Fe.stop(),this.Ue.stop(),this.Ze){var s=function(){n.De&&(t.removeEventListener(n.De,"stalled",n.Be,!1),t.removeEventListener(n.De,"pause",n.Be,!1),t.removeEventListener(n.De,"suspend",n.Be,!1),t.removeEventListener(n.De,"progress",n.Ve,!1),t.removeEventListener(n.De,"ended",n.We,!1),"Edge"===r.browser&&(n.De.src="")),n.kt.fire(o.rendererEvents.ended.name,[""]),n.Ze=null,n.De=null};n.Ze.destroy().then(function(){n.R.info("[%s] Shaka live stream player has been destroyed",n.Ne)}).then(function(){s()}).catch(function(t){n.R.error("[%s] Error while destroying shaka live stream player [%s]",n.Ne,t.code,t),s(),n.kt.fire(o.rendererEvents.error.name,["shaka",t])});n.Qe=!0}}},u.prototype.getStats=function(){if(!this.Ze)return{width:0,height:0,currentTime:0,lag:0,networkState:o.networkStates.networkNoSource.id};var i=t.assign(this.Ze.getStats(),{currentTime:0,lag:0}),e=t.get(this.De,["currentTime"],0),n=(t.now()-this.mt.originStartTime)/1e3,r=Math.max(0,n-e);return this.De&&(i.currentTime=e,i.lag=r),i.estimatedBandwidth>0?i.networkState=o.networkStates.networkLoading.id:i.playTime>0?i.networkState=o.networkStates.networkIdle.id:i.video?i.networkState=o.networkStates.networkEmpty.id:i.networkState=o.networkStates.networkNoSource.id,i},u.prototype.setDataQualityChangedCallback=function(t){i.isFunction(t,"callback"),this.dataQualityChangedCallback=t},u.prototype.getPlayer=function(){return this.Ze},u.prototype.addVideoDisplayDimensionsChangedCallback=function(t,i){this.Fe.addVideoDisplayDimensionsChangedCallback(t,i)},u}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(0),e(1),e(6)],void 0===(r=function(t,i,e){"use strict";function n(t,n,r){i.isStringNotEmpty(t,"type"),i.isObject(n,"stream"),i.isObject(r,"logger"),this.Je=t,this.r=n,this.R=r,this.ln=null;var s=this;this.r.on(e.streamEvents.playerEnded.name,function(t){if(s.R.info("[%s] [%s] player ended.",s.r.getStreamId(),s.Je),s.dn=!0,s.ln)return s.ln();s.streamEndedCallback(function(t){switch(t){case"":case"none":case"ended":return"ended";case"server-error":case"session-error":case"not-ready":case"error":case"died":return"failed";case"censored":return"censored";case"maintenance":return"maintenance";case"capacity":return"capacity";case"app-background":return"app-background";default:return"custom"}}(t),t)})}return n.prototype.on=function(t,i){return this.r.on(t,i)},n.prototype.streamErrorCallback=function(i,e){t.isFunction(this.r.streamErrorCallback)?(this.R.debug("[%s] [%s] live stream error event [%s]",this.r.getStreamId(),this.Je,e),this.r.streamErrorCallback(this.r,i,e)):this.R.error("[%s] [%s] live stream error event [%s]",this.r.getStreamId(),this.Je,e)},n.prototype.streamEndedCallback=function(i,e,n){var r=this.r.getRenderer();if(!this.pn){if(n&&!this.ln&&this.r.isActive()&&r&&!this.dn)return this.ln=t.bind(this.streamEndedCallback,this,i,e),this.R.info("[%s] [%s] stream ended. Waiting for end of player.",this.r.getStreamId(),this.Je),void(r&&r.stop(e,n));this.pn=!0,t.isFunction(this.r.streamEndedCallback)&&this.r.streamEndedCallback(this.r,i,e),this.r.stop(),r&&r.stop(e,n)}},n.prototype.dataQualityChangedCallback=function(t,i){var e=this.r.getRenderer();e&&"function"==typeof e.dataQualityChangedCallback&&e.dataQualityChangedCallback(e,t,i)},n.prototype.getPhenixMediaStream=function(){return this.r},n}.apply(i,n))||(t.exports=r)},function(t,i,e){var n;void 0===(n=function(){"use strict";return{errorSeverity:{recoverable:{id:1,name:"RECOVERABLE"},critical:{id:2,name:"CRITICAL"}}}}.apply(i,[]))||(t.exports=n)},function(t,i,e){var n,r;n=[e(0),e(1),e(12),e(2),e(23)],void 0===(r=function(t,i,e,n,r){function s(s){i.isString(s,"uri"),this.ke="/telemetry/metrics",this.Te="object"==typeof location?location.hostname:n.browser+"-"+n.browserVersion+"-unknown",this.wi=!0,this.Se=(n.browser||"Browser")+"/"+(n.browserVersion||"?"),this.xe=new e.BatchHttpProto(s+this.ke,[r],"telemetry.SubmitMetricRecords",{maxAttempts:3,maxBufferedRecords:1e3,maxBatchSize:512}),this.xe.on("capacity",t.bind(o,this))}function o(i){this.xe.addRecordToBeginning({metric:"MetricDropped",value:{uint64:i},timestamp:t.isoString(),sessionId:this.Ce,streamId:this.mn,source:this.Se,fullQualifiedName:this.Te,environment:this.Me,version:this.Ae,runtime:this.Re})}return s.prototype.isEnabled=function(){return this.wi},s.prototype.setEnabled=function(t){i.isBoolean(t,"enabled"),this.wi=t},s.prototype.submitMetric=function(e,n,r,s,o,a,u){this.wi&&(i.isStringNotEmpty(e,"metric"),i.isObject(u,"value"),this.Re=n,this.Ce=r,this.mn=s,this.Me=o,this.Ae=a,function(i,e){var n=t.assign({},e,{metric:i,timestamp:t.isoString(),sessionId:this.Ce,streamId:this.mn,source:this.Se,fullQualifiedName:this.Te,environment:this.Me,version:this.Ae,runtime:this.Re});this.xe.addRecord(n)}.call(this,e,u))},s}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(0),e(1),e(4),e(3),e(2)],void 0===(r=function(t,i,e,n,r){function s(t){if(i.isObject(t,"logger"),this.R=t,this.kt=new e.NamedEvents,this.z=new n.DisposableList,this.z.add(this.kt),!this.isSupported())return this.R.info("Network monitor is not supported.");this.vn=o.call(this),function(){var t=this;navigator.connection.addEventListener("change",function(){t.kt.fireAsync("NetworkChange",[o.call(t),t.vn]),t.vn=o.call(t)})}.call(this)}function o(){return{downlinkThroughputCapacity:this.getDownlinkThroughputCapacity(),effectiveType:this.getEffectiveType(),rtt:this.getRoundTripTime()}}return s.prototype.isSupported=function(){return r.global.navigator&&r.global.navigator.connection},s.prototype.getDownlinkThroughputCapacity=function(){return this.isSupported()?r.global.navigator.connection.downlink||r.global.navigator.connection.downlinkMax:-1},s.prototype.getEffectiveType=function(){return this.isSupported()?r.global.navigator.connection.effectiveType||r.global.navigator.connection.type:"Unknown"},s.prototype.getRoundTripTime=function(){return this.isSupported()?r.global.navigator.connection.rtt||r.global.navigator.connection.type:-1},s.prototype.onNetworkChange=function(t){if(this.isSupported())return i.isFunction(t,"callback"),this.kt.listen("NetworkChange",t)},s.prototype.dispose=function(){this.z.dispose()},s}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(0),e(1),e(3),e(15),e(74),e(2)],void 0===(r=function(t,i,e,n,r,s){"use strict";var o=s.global.Ni||s.global.Pi||t.now(),a="production",u="2018-04-10T16:20:23Z";function h(i,s){this.Fi=a,this.b=u,this.Di=null,this.gn={resource:"Session",kind:"Event"},this.R=i,this.D=s,this.yn=new r(this.R),this.wn=t.now(),this.z=new e.DisposableList,this.yi=[],this.z.add(n.onBackground(t.bind(c,this,!1))),this.z.add(n.onForeground(t.bind(c,this,!0))),this.yn.isSupported()&&(this.z.add(this.yn.onNetworkChange(t.bind(p,this))),this.z.add(this.yn),f.call(this),d.call(this),l.call(this))}function c(t,i){var e=t?"ApplicationForeground":"ApplicationBackground";this.recordMetric(e,{uint64:i}),m.call(this,"Application has gone into the [%s] after [%s] ms",t?"foreground":"background",i)}function f(){var t=this.yn.getEffectiveType();this.recordMetric("NetworkType",{string:t},null,{resource:s.browser}),m.call(this,"[%s] has started with Network effective type of [%s]",this.Di?"Session":"Application",t)}function l(i,e){var n=i||this.yn.getRoundTripTime(),r=e||-1;if(this.recordMetric("RoundTripTime",{uint32:n},{uint32:r},{resource:s.browser}),t.isNullOrUndefined(e))return m.call(this,"Network RTT [%s]",n);m.call(this,"Network RTT changed to [%s] from [%s]",n,r)}function d(i,e){var n=i||this.yn.getDownlinkThroughputCapacity(),r=e||-1;if(this.recordMetric("DownlinkThroughputCapacity",{uint64:n},{uint64:r},{resource:s.browser}),t.isNullOrUndefined(e))return m.call(this,"Network downlink throughput capacity [%s]",n);m.call(this,"Network downlink throughput capacity changed to [%s] from [%s]",n,r)}function p(t,i){i.downlinkThroughputCapacity!==t.downlinkThroughputCapacity&&d.call(this,t.downlinkThroughputCapacity,i.downlinkThroughputCapacity),i.rtt!==t.rtt&&l.call(this,t.rtt,i.rtt),i.effectiveType!==t.effectiveType&&function(t,i){var e=t||this.yn.getEffectiveType(),n=i;this.recordMetric("NetworkType",{string:e},{string:n},{resource:s.browser}),m.call(this,"Network effective type has changed to [%s] from [%s]",e,n||"New")}.call(this,t.effectiveType,i.effectiveType)}function m(){var i=Array.prototype.slice.call(arguments);if(0===i.length)throw new Error("Invalid logging arguments.");var e="[%s] [SessionTelemetry] [%s] "+i[0],n=i.slice(1),r=[e,this.Di,t.now()-this.wn].concat(n);this.R.debug.apply(this.R,r)}function v(){return(t.now()-o)/1e3}function g(e,n){if(i.isStringNotEmpty(e.metric,"record.metric"),!this.Di)return this.yi.push({record:e,since:n});var r=t.assign({},this.gn,e);this.D.submitMetric(e.metric,n,this.Di,null,this.Fi,this.b,r)}return h.prototype.setSessionId=function(t){!t&&this.Di&&g.call(this,{metric:"Stopped",elapsed:this.elapsed()},v()),this.Di=t,t&&(g.call(this,{metric:"Initialized",elapsed:this.elapsed()},v()),function(){if(!this.Di)return;var t=this.yi.length;for(;t>0;){var i=this.yi.splice(t-1,1);1===i.length&&g.call(this,i[0].record,i[0].since),t--}}.call(this),function(){var t=n.isForeground(),i=n.getTimeSinceLastChange(),e=t?"ApplicationForeground":"ApplicationBackground";this.recordMetric(e,{uint64:i}),m.call(this,"Session has started in the [%s] after [%s] ms",t?"foreground":"background",i)}.call(this),this.yn.isSupported()&&(f.call(this),d.call(this),l.call(this)))},h.prototype.setProperty=function(t,e){i.isStringNotEmpty(t,"name"),i.isStringNotEmpty(e,"value"),this.gn[t]=e},h.prototype.recordMetric=function(e,n,r,s){i.isStringNotEmpty(e,"metric");var o=t.assign({},{metric:e,elapsed:this.elapsed(),value:n,previousValue:r},s||{});g.call(this,o,v())},h.prototype.elapsed=function(){return t.now()-this.wn},h.prototype.dispose=function(){this.z.dispose(),this.recordMetric("Stopped"),m.call(this,"Session telemetry stopped")},h}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(0),e(1),e(3),e(2)],void 0===(r=function(t,i,e,n){"use strict";var r=n.global.Ni||n.global.Pi||t.now(),s="production",o="2018-04-10T16:20:23Z";function a(n,r,a){i.isStringNotEmpty(n,"sessionId"),this.Fi=s,this.b=o,this.Di=n,this.gn={},this.R=r,this.D=a,this.wn=t.now(),this.z=new e.DisposableList,u.call(this,"Stream initializing")}function u(){var i=Array.prototype.slice.call(arguments);if(0===i.length)throw new Error("Invalid logging arguments.");var e="[%s] [StreamTelemetry] [%s] "+i[0],n=i.slice(1),r=[e,this.Ne,t.now()-this.wn].concat(n);this.R.debug.apply(this.R,r)}function h(){return(t.now()-r)/1e3}function c(e,n){i.isStringNotEmpty(e.metric,"record.metric");var r=t.assign({},this.gn,e);this.D.submitMetric(e.metric,n,this.Di,this.Ne,this.Fi,this.b,r)}return a.prototype.setProperty=function(t,e){i.isStringNotEmpty(t,"name"),i.isStringNotEmpty(e,"value"),this.gn[t]=e},a.prototype.recordMetric=function(e,n,r,s){i.isStringNotEmpty(e,"metric");var o=t.assign({},{metric:e,elapsed:this.elapsed(),value:n,previousValue:r},s||{});c.call(this,o,h())},a.prototype.setStreamId=function(e){if(i.isStringNotEmpty(e,"streamId"),this.Ne)throw new Error("Stream ID can only be set once.");this.Ne=e;var n=t.now();c.call(this,{metric:"Initialized",elapsed:this.elapsed()-n+this.wn},h()-(n-this.wn)/1e3)},a.prototype.setStartOffset=function(t){if(i.isNumber(t,"startOffset"),this.bn)throw new Error("Start offset can only be set once.");this.bn=t,this.recordMetric("Offset",{uint64:t})},a.prototype.getStartOffset=function(){return this.bn},a.prototype.elapsed=function(){return t.now()-this.wn},a.prototype.stop=function(){this.z.dispose(),this.recordMetric("Stopped"),u.call(this,"Stream stopped")},a.prototype.recordTimeToFirstFrame=function(i){var n,r=this,s=t.now(),o=function(){n||(n=t.now()-s,r.recordMetric("TimeToFirstFrame",{uint64:n}),u.call(r,"First frame [%s]",n),a.dispose())};t.addEventListener(i,"loadeddata",o);var a=new e.Disposable(function(){t.removeEventListener(i,"loadeddata",o)});this.z.add(a)},a.prototype.recordVideoResolutionChanges=function(t,i){var e=this,n={width:i.videoWidth,height:i.videoHeight};t.addVideoDisplayDimensionsChangedCallback(function(t,i){n.width===i.width&&n.height===i.height||(e.recordMetric("ResolutionChanged",{string:i.width+"x"+i.height},{string:n.width+"x"+n.height}),n={width:i.width,height:i.height},u.call(e,"Resolution changed: width [%s] height [%s]",i.width,i.height))})},a.prototype.recordRebuffering=function(i){var r,s,o=this,a=function(){r||(o.recordMetric("Stalled"),r=t.now(),u.call(o,"[buffering] Stream has stalled"))},h=function(e){var a=i.buffered.length,h=!("playing"===e.type||a>0)||("progress"===e.type||"timeupdate"===e.type)&&i.buffered.end(a-1)===s;if(r&&(a||"Edge"===n.browser)&&!h){"progress"===e.type&&(s=i.buffered.end(a-1));var c=t.now()-r;o.recordMetric("Buffering",{uint64:c}),u.call(o,"[buffering] Stream has recovered from stall after [%s] milliseconds",c),r=null}};t.addEventListener(i,"stalled",a),t.addEventListener(i,"pause",a),t.addEventListener(i,"suspend",a),t.addEventListener(i,"play",h),t.addEventListener(i,"playing",h),t.addEventListener(i,"progress",h),t.addEventListener(i,"timeupdate",h),this.z.add(new e.Disposable(function(){t.removeEventListener(i,"stalled",a),t.removeEventListener(i,"pause",a),t.removeEventListener(i,"suspend",a),t.removeEventListener(i,"play",h),t.removeEventListener(i,"playing",h),t.removeEventListener(i,"progress",h),t.removeEventListener(i,"timeupdate",h)}))},a.prototype.recordVideoPlayingAndPausing=function(i){var n=this,r=function(){i.paused?n.recordMetric("Playing",{boolean:!1}):n.recordMetric("Playing",{boolean:!0})};t.addEventListener(i,"pause",r),t.addEventListener(i,"playing",r),this.z.add(new e.Disposable(function(){t.removeEventListener(i,"pause",r),t.removeEventListener(i,"playing",r)}))},a}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(0),e(1),e(22),e(73)],void 0===(r=function(t,i,e,n){var r={urls:{local:"",staging:"https://telemetry-stg.phenixp2p.com",production:"https://telemetry.phenixp2p.com"}};function s(){this.En={}}return s.prototype.createMetricsTransmitter=function(t){var i=e.parseEnvFromPcastBaseUri(t||""),s=r.urls[i];return this.En[i]||(this.En[i]=function(t){var i=new n(t);t||i.setEnabled(!1);return i}.call(this,s)),this.En[i]},new s}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(0),e(1)],void 0===(r=function(t,i){"use strict";var e=[{"16x9":[{2160:3840},{1080:1920},{768:1366},{720:1280},{576:1024},{480:853},{360:640},{180:320}]},{"4x3":[{1200:1600},{1080:1440},{720:960},{600:800},{576:768},{480:640},{360:480},{288:352},{240:320},{144:176},{120:160}]}],n={fallbackToLower:{id:0,name:"fallbackToLower"},fallbackToHigher:{id:1,name:"fallbackToHigher"},fallbackToLowerThenHigher:{id:2,name:"fallbackToLowerThenHigher"},exact:{id:3,name:"exact"}};function r(t){i.isObject(t,"options"),t.resolutionSelectionStrategy&&i.isValidType(t.resolutionSelectionStrategy,n,"options.resolutionSelectionStrategy"),t.aspectRatio&&i.isStringNotEmpty(t.aspectRatio,"options.aspectRatio"),t.resolutionHeight&&i.isNumber(t.resolutionHeight,"options.resolutionHeight"),t.frameRate&&i.isNumber(t.frameRate,"options.frameRate"),this.In=t.resolutionSelectionStrategy||n.fallbackToLowerThenHigher.name,this.kn=t.aspectRatio||"16x9",this.Tn=t.resolutionHeight||720,this.Sn=t.frameRate||15}function s(t){return i.isNumber(t,"value"),2*Math.floor((t+1)/2)}function o(i,n){var r,s,o,a,d=u(n,e),p=h(n,e),m=h(i.toString(),d),v=0===m,g=e.length-1===p;if(t.isNumber(m)){if(v)return g?null:(s=u(r=c(++p,e),e),o=c(m=l(this.Tn,s),d),a=this.calculateWidthByAspectRatio(o,r),{aspectRatio:r,height:parseInt(o),width:parseInt(a)});m--}else if(!(m=l(i,d)))return;return r=c(p,e),o=c(m,s=f(p,e)),a=s[m][o],{aspectRatio:r,height:parseInt(o),width:parseInt(a)}}function a(i,n){var r,s,o,a,l=u(n,e),d=h(n,e),p=h(i.toString(),l),m=p===l.length-1,v=e.length-1===d;if(t.isNumber(p)){if(m)return v?null:(r=c(++d,e),o=this.Tn,a=this.calculateWidthByAspectRatio(o,r),{aspectRatio:r,height:parseInt(o),width:parseInt(a)});p++}else if(!(p=function(i,e){if(t.keys(e[e.length-1])[0]>i)return null;return t.reduce(e,function(n,r,s){if(!n)return s;var o=t.keys(e[n])[0],a=t.keys(r)[0];return a>i?n:Math.abs(i-a)<Math.abs(i-o)?s:n})}(i,l)))return;return r=c(d,e),o=c(p,s=f(d,e)),a=s[p][o],{aspectRatio:r,height:parseInt(o),width:parseInt(a)}}function u(i,e){var n=t.find(e,function(t){return t.hasOwnProperty(i)});return n?n[i]:null}function h(i,e){return t.findIndex(e,function(t){return t.hasOwnProperty(i)})}function c(i,e){return t.keys(e[i])[0]}function f(i,e){var n=t.keys(e[i]);return e[i][n[0]]}function l(i,e){return t.keys(e[0])[0]<i?null:t.reduce(e,function(n,r,s){if(!n)return s;var o=t.keys(e[n])[0],a=t.keys(r)[0];return a<i?n:Math.abs(i-a)<Math.abs(i-o)?s:n})}return r.prototype.getDefaultResolution=function(){var t=u(this.kn,e),i=u(this.Tn,t)||this.calculateWidthByAspectRatio(this.Tn,this.kn);return{height:this.Tn,width:i,aspectRatio:this.kn}},r.prototype.getDefaultFrameRate=function(){return this.Sn},r.prototype.getNextResolution=function(t,e){switch(i.isNumber(t,"height"),i.isStringNotEmpty(e,"aspectRatio"),this.In){case n.fallbackToLower.name:return a.call(this,t,e);case n.fallbackToHigher.name:return o.call(this,t,e);case n.fallbackToLowerThenHigher.name:var r=null;return t>this.Tn?r=o.call(this,t,e):(r=a.call(this,t,e))&&r.height||(r=o.call(this,this.Tn,this.kn)),r;case n.exact.name:default:return}},r.prototype.canResolveNextResolution=function(){return this.In!==n.exact.name},r.prototype.calculateWidthByAspectRatio=function(t,i){switch(i){case"16x9":return s(16/9*t);case"4x3":return s(4/3*t);default:throw new Error("Aspect Ratio not supported")}},r}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(0),e(1),e(7),e(2)],void 0===(r=function(t,i,e,n){"use strict";var r="icngjadgidcmifnehjcielbmiapkhjpn",s=t.freeze({url:"https://addons.mozilla.org/firefox/downloads/file/474686/pcast_screen_sharing-1.0.3-an+fx.xpi",iconUrl:"https://phenixp2p.com/public/images/phenix-logo-unicolor-64x64.png",hash:"sha256:4972e9718ea7f7c896abc12d1a9e664d5f3efe498539b082ab7694f9d7af4f3b"}),o=100,a=450,u=52;function h(o,a){o=o||{},i.isObject(o,"options"),i.isObject(a,"logger"),this.R=a,this.Rn=o.screenSharingExtensionId||function(){switch(n.browser){case"Chrome":return r;case"Firefox":default:return""}}(),this.xn=o.screenSharingAddOn||s,this.Cn=!1,this.On=new e.Observable(!1),"Chrome"===n.browser&&this.Rn&&function(){var t=d.call(this);if("object"!=typeof document)return;for(var i=document.getElementsByTagName("link"),e=0;e<i.length;e++)if(i[e].href===t)return;this.R.debug("Adding Chrome Web Store link [%s]",t);var n=document.createElement("link");n.rel="chrome-webstore-item",n.href=t,document.getElementsByTagName("head")[0].appendChild(n)}.call(this),f.call(this,t.bind(c,this))}function c(t){this.On.setValue(!0),this.Cn=t}function f(t){var i=this;if("Chrome"===n.browser&&i.Rn){var e=v.call(this);if(!e)return t(!1);try{e.sendMessage(i.Rn,{type:"version"},function(e){e&&"ok"===e.status?(i.R.info("Screen sharing enabled using version [%s]",e.version),t(!0)):(i.R.info("Screen sharing NOT available"),t(!1))})}catch(e){e.message&&i.R.warn(e.message,e),t(!1)}}else"Firefox"===n.browser&&n.browserVersion>=u?t(!0):"Firefox"===n.browser&&"object"==typeof n.global.PCastScreenSharing?t(!0):t(!1)}function l(t){if(this.On.getValue())return t();var i=this.On.subscribe(function(){return i.dispose(),t()})}function d(){return"https://chrome.google.com/webstore/detail/"+this.Rn}function p(i,e){switch(n.browser){case"Chrome":return function(t){var i=this,e=v.call(this);if(!e)return t(new Error("not-available"));try{e.sendMessage(i.Rn,{type:"get-desktop-media",sources:["screen","window","tab","audio"]},function(e){var n=!e;return n?f.call(i,function(e){return c.call(i,e),t(new Error("extension-failure"))}):"ok"!==e.status?t(new Error(e.status),e):void t(null,e)})}catch(e){e.message&&i.R.warn(e.message),t(e,{status:"failed"})}}.call(this,function(n,r){if(n||r&&"ok"!==r.status)return e(n,r);r.data||r.options||(r.options={canRequestAudioTrack:!0}),r.data&&t.hasIndexOrKey(r.data,"hasAudio")&&!r.options&&(r.options={canRequestAudioTrack:r.data.hasAudio}),e(null,{status:"ok",constraints:function(i,e,n){var r={};t.isObject(i)&&t.isObject(i.screen)&&(r.video=i.screen);t.isObject(i)&&t.isObject(i.screenAudio)&&n.canRequestAudioTrack&&(r.audio=i.screenAudio);i.screen&&t.set(r,["video","mandatory"],{chromeMediaSource:"desktop",chromeMediaSourceId:e});i.screenAudio&&n.canRequestAudioTrack&&t.set(r,["audio","mandatory"],{chromeMediaSource:"system",chromeMediaSourceId:e});return r}(i,r.streamId,r.options)})});case"Firefox":e(null,{status:"ok",constraints:function(t,i){var e={video:{}};"object"==typeof t&&"object"==typeof t.screen&&(e.video=t.screen);i&&(e.video.mediaSourceId=i);return e.video.mediaSource=e.video.mediaSource||"window",e}(i)});break;default:e(new Error("not-supported"),{status:"not-supported"})}}function m(t){var i=this;if(!i.Cn){var e=function(e,n){return"cancelled"===n?t(null,{status:"cancelled"}):"ok"!==n?t(new Error("screen-sharing-installation-failed"),{status:n}):void f.call(i,function(e){if(i.Cn=e,!i.Cn)return t(new Error("screen-sharing-installation-failed"),{status:n});t(null,{status:"ok"})})};switch(n.browser){case"Chrome":(function(t){var i=this,e=d.call(this);try{chrome.webstore.install(e,function(){return t(null,"ok")},function(e){if(e){if(e.match(/cancelled/gi))return i.R.info("User cancelled screen sharing"),t(new Error(e),"cancelled");i.R.warn(e)}return t(new Error(e||"failed"),"failed")})}catch(e){e.message&&i.R.warn(e.message),t(e,"failed")}}).call(i,e);break;case"Firefox":(function(t){try{var i,e={"PCast Screen Sharing":{URL:this.xn.url,IconURL:this.xn.iconUrl,Hash:this.xn.hash,toString:function(){return this.URL}}},r=a,s=function(){i&&clearInterval(i),t(null,"ok")},u=function(){i&&clearInterval(i),t(new Error("failed"),"failed")};i=setInterval(function(){return"object"==typeof n.global.PCastScreenSharing?s():r--<0?u():void 0},o),InstallTrigger.install(e,function(t,i){0===i?s():u()})}catch(i){i.message&&this.R.warn(i.message),t("failed",i)}}).call(i,e);break;default:t(new Error("not-supported"),{status:"not-supported"})}}}function v(){switch(n.browser){case"Chrome":return"undefined"!=typeof chrome&&chrome.runtime&&chrome.runtime.sendMessage?chrome.runtime:(this.R.info("Screen sharing NOT available. Runtime not supported"),null);case"Firefox":default:return null}}return h.prototype.isScreenSharingEnabled=function(t){var i=this;return l.call(this,function(){return t(i.Cn)})},h.prototype.installExtension=function(i){return l.call(this,t.bind(m,this,i))},h.prototype.getScreenSharingConstraints=function(i,e){return l.call(this,t.bind(p,this,i,e))},h.prototype.toString=function(){return"ScreenShareExtensionManager["+n.browser+"]"},h}.apply(i,n))||(t.exports=r)},function(t,i,e){var n,r;n=[e(0),e(1),e(2)],void 0===(r=function(t,i,e){"use strict";var n=2e3;function r(t,e,n){i.isObject(t,"logger"),i.isObject(e,"screenShareExtensionManager"),n&&i.isFunction(n,"onScreenShare"),this.R=t,this.F=e,this.vt=n}function s(r,s,a){var u=this,h=function(t){a(o(t),void 0,t)},c=function(r){(function(r){var s={},o={},a=this;setTimeout(function u(){(function(e){return t.reduce(e.getTracks(),function(t,e){return t&&function(t){return i.isNotUndefined(t,"track"),"ended"===t.readyState}(e)},!0)})(r)||(t.forEach(r.getTracks(),function(i){if(e.global.Event&&t.hasIndexOrKey(s,i.id)&&s[i.id]!==i.enabled){var n=new e.global.Event("trackenabledchange");n.data=i,i.dispatchEvent(n),a.R.info("[%s] Detected track [%s] enabled change to [%s]",r.id,i.id,i.enabled)}if(e.global.Event&&t.hasIndexOrKey(o,i.id)&&o[i.id]!==i.readyState){var u=new e.global.Event("readystatechange");u.data=i,i.dispatchEvent(u),a.R.info("[%s] Detected track [%s] Ready State change to [%s]",r.id,i.id,i.readyState)}s[i.id]=i.enabled,o[i.id]=i.readyState}),setTimeout(u,n))},n)}).call(u,r),s("ok",r)};return function(t,i){var e=this;if(t.screen)return e.F.isScreenSharingEnabled(function(n){return n?e.F.getScreenSharingConstraints(t,i):e.F.installExtension(function(n,r){return n||r&&"ok"!==r.status?i(n,r):e.F.getScreenSharingConstraints(t,i)})});var n={audio:t.audio||!1,video:t.video||!1};i(null,{status:"ok",constraints:n})}.call(this,r,function(i,n){if("ok"!==t.get(n,["status"]))return h(i);if("cancelled"!==n.status){var s=n.constraints;if(u.vt&&(r.screen||r.screenAudio)&&"Chrome"===e.browser&&!(s=u.vt(s)))throw new Error("onScreenShare must return an object of user media constraints");try{e.getUserMedia(s,c,h)}catch(t){h(t)}}else a("cancelled",null)})}r.prototype.getUserMedia=function(e,n){i.isObject(e,"options"),i.isFunction(n,"callback"),function(i,e){var n=this,r=function(t,i){n.ht&&n.ht.push(i),e(n,t,i)},o=function(t,r,s){i.screenAudio&&n.R.warn("Screen capture with audio is only supported on Windows or Chrome OS."),e(n,t,r,s)},a=i.screen||i.screenAudio,u=i.video||i.audio;if(!a||!u)return s.call(n,i,r,o);return s.call(n,{screen:i.screen},function(e,a){return s.call(n,{audio:i.audio,video:i.video},function(i,e){!function(i,e){if(!i||!t.isFunction(i.addTrack))return;t.forEach(e,function(t){i.addTrack(t)})}(e,a.getTracks()),r(i,e)},function(i,e,n){!function(i){i&&t.isFunction(i.stop)&&i.stop();if(i&&t.isFunction(i.getTracks))for(var e=i.getTracks(),n=0;n<e.length;n++){var r=e[n];r.stop()}}(a),o(i,e,n)})},o)}.call(this,e,n)};var o=function(t){return"unavailable"===t.code?"conflict":"permission-denied"===t.message?"permission-denied":"PermissionDeniedError"===t.name?"permission-denied":"InternalError"===t.name&&"Starting video failed"===t.message?"conflict":"SourceUnavailableError"===t.name?"conflict":"SecurityError"===t.name&&"The operation is insecure."===t.message?"permission-denied":"failed"};return r}.apply(i,n))||(t.exports=r)},function(t,i){},function(t,i,e){"use strict";var n,r;n=[e(2),e(9),e(13),e(14),e(27)],void 0===(r=function(t,i,e,n,r){return t.global.PhenixPCast=e,{PCast:e,UserMediaResolver:n,logging:i,RTC:t,express:{PCastExpress:r}}}.apply(i,n))||(t.exports=r)}])});