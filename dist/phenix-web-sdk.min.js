/**
 * Copyright 2018 PhenixP2P Inc. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("phenix-web-sdk",[],e):"object"==typeof exports?exports["phenix-web-sdk"]=e():t["phenix-web-sdk"]=e()}(window,function(){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},i.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=109)}([function(t,e,i){var n,r;n=[i(107)],void 0===(r=function(t){"use strict";return t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(106)],void 0===(r=function(t){return t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(102),i(101)],void 0===(r=function(t,e){return{Disposable:t,DisposableList:e}}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r,s,o,a,u;t.exports=(n=i(0),r=i(43),s=i(1),o=i(2),a=i(4),u=i(5),function(t){function e(n){if(i[n])return i[n].exports;var r=i[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var i={};return e.m=t,e.c=i,e.i=function(t){return t},e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=12)}([function(t,e,i){(function(i){var n;void 0===(n=function(){"use strict";return"object"==typeof window?window:"object"==typeof i?i:{}}.apply(e,[]))||(t.exports=n)}).call(e,i(5))},function(t,e){t.exports=n},function(t,e){t.exports=r},function(t,e,i){var n,r;n=[i(1),i(7),i(4),i(0),i(13)],void 0===(r=function(t,e,i,n,r){"use strict";function s(t,n,r,s){var a=this;this.t=t,this.e=n,this.a="phenix"===r,this.u="flash"===r,this.h=s||{},this.f={},this.v=new e.DisposableList,this.g=null;var u=function(t){a.y=!0,a.w=!0===t,t?c.call(a):m("Failed to create Phenix video element"),a.b&&a.b(a.w)};try{if(this.k=o.call(this),this.k.className=this.t.className,this.k.height=this.t.height,this.k.width=this.t.width,this.S=this.t.style.cssText,this.t.style.cssText="visibility:hidden !important;width:0px !important;height:0px !important;margin:0px !important;padding:0px !important;border-style:none !important;border-width:0px !important;max-width:0px !important;max-height:0px !important;outline:none !important",this.v.add(new e.Disposable(function(){a.t.style.cssText=a.S})),this.k.onunload=function(){a.y=!1},f.call(this),document.body&&document.body.contains||l("document.body.contains is not supported"),document.body&&document.body.contains&&document.body.contains(this.t)&&(this.t.parentNode.replaceChild(this.k,this.t),this.u&&this.g&&(this.k=this.g.finishInitializationInDom()),this.v.add(new e.Disposable(function(){a.k.parentNode&&a.k.parentNode.replaceChild(a.t,a.k)}))),!this.a)return u(!0);(new i).waitForReady(this.k,u)}catch(t){m("Error while loading Phenix RTC"+t),u(!1)}}function o(){var t=document.createElement("video");if(this.a&&((t=document.createElement("object")).type="application/x-phenix-video"),this.u){this.g=new r(this.t,this.e,this.h);var i=this;this.v.add(new e.Disposable(function(){i.g.destroy()})),t=this.g.getElement()}return t}function a(t){var e=this;e.k.phenixSetEventListener(t,function(){var i=e.f[t];if(i)for(var n=0;n<i.length;n++)i[n].apply(e,arguments)})}function u(t,e){var i;document.createEvent?(i=document.createEvent("HTMLEvents")).initEvent(e,!0,!0):(i=document.createEventObject()).eventType=e,i.eventName=e,setTimeout(function(){document.createEvent?t.dispatchEvent(i):t.fireEvent("on"+i.eventType,i)})}function c(){for(var t=Object.keys(this.f),e=0;e<t.length;e++)a.call(this,t[e]);this.hookUpEvents(),h.call(this),this.k.id=this.t.id,this.k.style.cssText=this.S,this.k.className=this.t.className,this.k.innerHtml=this.t.innerHtml,this.k.width=this.t.width,this.k.height=this.t.height,this.k.autoplay=this.t.autoplay,this.k.muted=this.t.muted,this.k.defaultMuted=this.t.defaultMuted,this.k.volume=this.t.volume,this.e&&!this.u&&(this.k.src=this.e)}function h(){var i=this,r=["style"];if(t.get(n,["MutationObserver"])){var s=new MutationObserver(function(t){t.forEach(function(t){"attributes"===t.type&&t.target===i.t&&-1===r.indexOf(t.attributeName)&&(i.k[t.attributeName]=i.t[t.attributeName])})});s.observe(i.t,{attributes:!0}),i.v.add(new e.Disposable(function(){s.disconnect()}))}else{l("Falling back to use of DOM event listeners. This results in degraded performance for further DOM modifications and does not work for IE prior to version 9. See https://developer.mozilla.org/en-US/docs/Web/Guide/Events/Mutation_events for details.");var o=function(t){i.k[t.target.tagName]=i.t[t.target.tagName]};i.t.addEventListener?(i.t.addEventListener("DOMAttrModified",o,!1),i.v.add(new e.Disposable(function(){i.t.removeEventListener("DOMAttrModified",o,!1)}))):(i.t.attachEvent("onpropertychange",o),i.v.add(new e.Disposable(function(){i.t.detachEvent("DOMAttrModified",o)})))}}function f(){var i=this;if(t.get(n,["MutationObserver"])){var r=new MutationObserver(function(t){t.forEach(function(t){if("childList"===t.type)for(var e=0;e<t.addedNodes.length;e++){var n=t.addedNodes[e];t.target!==i.k&&(n===i.t?(t.target.replaceChild(i.k,i.t),c.call(i)):d(t.target,i.t)&&(i.t.parentNode&&i.t.parentNode.replaceChild(i.k,i.t),c.call(i)))}})});r.observe(document.body,{childList:!0,attributes:!1,characterData:!1,subtree:!0}),i.v.add(new e.Disposable(function(){r.disconnect()}))}else{l("Falling back to use of DOM event listeners. This results in degraded performance for further DOM modifications and does not work for IE prior to version 9. See https://developer.mozilla.org/en-US/docs/Web/Guide/Events/Mutation_events for details.");var s=function(){i.t.parentNode&&i.t.parentNode.replaceChild(i.k,i.t)};i.addEventListener("DOMNodeInserted",s,!1),i.v.add(new e.Disposable(function(){i.removeEventListener("DOMNodeInserted",s,!1)}))}}function d(t,e){for(var i=e.parentNode;null!==i;){if(i===t)return!0;i=i.parentNode}return!1}var l=function(){console.log.apply(console,arguments)}||function(){},m=function(){console.error.apply(console,arguments)}||l;return s.prototype.hookUpEvents=function(){var t=this,i=this.t,n=function(){u(i,"error")},r=function(){i.muted=t.k.muted,u(i,"mute")},s=function(){i.muted=t.k.muted,u(i,"unmute")},o=function(){i.ended=t.k.ended,u(i,"ended")},a=function(){i.width=t.k.width,i.height=t.k.height,u(i,"loadedmetadata")},c=function(){i.width=t.k.width,i.height=t.k.height,u(i,"loadeddata")},h=function(){i.width=t.k.width,i.height=t.k.height,u(i,"resize")};this.addEventListener("error",n),this.addEventListener("mute",r),this.addEventListener("unmute",s),this.addEventListener("ended",o),this.addEventListener("loadedmetadata",a),this.addEventListener("loadeddata",c),this.addEventListener("resize",h);var f=new e.Disposable(function(){t.removeEventListener("error",n),t.removeEventListener("mute",r),t.removeEventListener("unmute",s),t.removeEventListener("ended",o),t.removeEventListener("loadedmetadata",a),t.removeEventListener("loadeddata",c),t.removeEventListener("resize",h)});return this.v.add(f),f},s.prototype.onReady=function(t){var e=this;this.y?setTimeout(function(){t(e.w)},1):this.b=t},s.prototype.getElement=function(){return this.k},s.prototype.addEventListener=function(t,e,i){(function(t,e,i){if(this.u)return this.g.addEventListener(t,e);if(this.a){var n=this.f[t];return n||(n=this.f[t]=[],this.y&&a.call(this,t)),n.push(e)}return this.k.addEventListener(t,e,i)}).call(this,t,e,i)},s.prototype.removeEventListener=function(t,e,i){(function(t,e,i){if(this.u)return this.g.removeEventListener(t,e);if(!this.a)return this.k.removeEventListener(t,e,i);var n=this.f[t];if(n){var r=n.indexOf(e);r>=0&&((n=n.splice(r,1)).length>0?this.f[t]=n:delete this.f[t])}}).call(this,t,e,i)},s.prototype.destroy=function(){this.v.dispose()},s}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(2)],void 0===(r=function(t){"use strict";function e(t){this.T=t||15e3}var i=new t(navigator.userAgent).detect(),n=function(){console.error.apply(console,arguments)}||console.log;return e.prototype.waitForReadyWithTimeout=function(t,e,r){var s=!1,o=1,a=o,u=function(t){s||(s=!0,e(t))};t.hasOwnProperty&&t.hasOwnProperty("onload")||"IE"!==i.browser&&n("No means of detecting when <object> is loaded"),t.onload=function(){u(!0)},function e(){4===t.readyState?u(!0):t.phenixVersion?u(!0):(o=Math.min(o+1e3,2*o),(a+=o)>r?(n("Timed out while waiting for <object> to load"),u(!1)):setTimeout(e,o))}()},e.prototype.waitForReady=function(t,e){t.phenixVersion?e(!0):this.waitForReadyWithTimeout(t,e,this.T)},e}.apply(e,n))||(t.exports=r)},function(t,e){var i;i=function(){return this}();try{i=i||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e){t.exports=s},function(t,e){t.exports=o},function(t,e){t.exports=a},function(t,e,i){var n,r;n=[i(1),i(6),i(8),i(2),i(0),i(15),i(14)],void 0===(r=function(t,e,i,n,r,s,o){"use strict";function a(){if(t.assign(c,s()),o.isSupported()){c.phenixSupported=!0;var e=new o,i=function(){c.RTCPeerConnection=e.getRTCPeerConnectionConstructor(),c.RTCSessionDescription=e.getRTCSessionDescriptionConstructor(),c.RTCIceCandidate=e.getRTCIceCandidateConstructor(),c.getSources=e.getSourcesDelegate(),c.getUserMedia=e.getUserMediaDelegate(),c.getStats=e.getStatsDelegate(),Function.prototype.bind?(c.attachMediaStream=e.attachMediaStream.bind(e),c.reattachMediaStream=e.reattachMediaStream.bind(e),c.isPhenixEnabled=e.isEnabled.bind(e)):(c.attachMediaStream=function(){e.attachMediaStream.apply(e,arguments)},c.reattachMediaStream=function(){e.reattachMediaStream.apply(e,arguments)},c.isPhenixEnabled=function(){return e.isEnabled()}),c.webrtcSupported=!0,c.phenixSupported=!0,c.phenixVersion=e.getVersion(),c.onLoaded&&c.onLoaded.call()};e.isEnabled()?i():e.onReady(function(t){t&&(i(),c.onload&&"function"==typeof c.onload&&c.onload())}),e.onLoaded(function(){i()})}else c.phenixSupported=!1;return c}var u=new n(navigator.userAgent).detect(),c={browser:u.browser,browserVersion:u.version,phenixSupported:!1,isPhenixEnabled:function(){return!1},onLoaded:void 0,global:r};return t.assign(a(),{shim:a})}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0)],void 0===(r=function(t){"use strict";return function(e){t.RTCPeerConnection=e.RTCPeerConnection,t.RTCSessionDescription=e.RTCSessionDescription,t.RTCIceCandidate=e.RTCIceCandidate}}.apply(e,n))||(t.exports=r)},function(t,e,i){(function(e){var i;!function(e){t.exports=e()}(function(){return function t(e,n,r){function s(a,u){if(!n[a]){if(!e[a]){if(!u&&("function"==typeof i&&i))return i(a,!0);if(o)return i(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var h=n[a]={exports:{}};e[a][0].call(h.exports,function(t){return s(e[a][1][t]||t)},h,h.exports,t,e,n,r)}return n[a].exports}for(var o="function"==typeof i&&i,a=0;a<r.length;a++)s(r[a]);return s}({1:[function(t,e,i){"use strict";function n(t,e,i,n,r){var s=u.writeRtpDescription(t.kind,e);if(s+=u.writeIceParameters(t.iceGatherer.getLocalParameters()),s+=u.writeDtlsParameters(t.dtlsTransport.getLocalParameters(),"offer"===i?"actpass":r||"active"),s+="a=mid:"+t.mid+"\r\n",s+=t.rtpSender&&t.rtpReceiver?"a=sendrecv\r\n":t.rtpSender?"a=sendonly\r\n":t.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",t.rtpSender){var o=t.rtpSender.I||t.rtpSender.track.id;t.rtpSender.I=o;var a="msid:"+(n?n.id:"-")+" "+o+"\r\n";s+="a="+a,s+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" "+a,t.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+t.sendEncodingParameters[0].rtx.ssrc+" "+a,s+="a=ssrc-group:FID "+t.sendEncodingParameters[0].ssrc+" "+t.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return s+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" cname:"+u.localCName+"\r\n",t.rtpSender&&t.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+t.sendEncodingParameters[0].rtx.ssrc+" cname:"+u.localCName+"\r\n"),s}function r(t,e){var i={codecs:[],headerExtensions:[],fecMechanisms:[]},n=function(t,e){t=parseInt(t,10);for(var i=0;i<e.length;i++)if(e[i].payloadType===t||e[i].preferredPayloadType===t)return e[i]},r=function(t,e,i,r){var s=n(t.parameters.apt,i),o=n(e.parameters.apt,r);return s&&o&&s.name.toLowerCase()===o.name.toLowerCase()};return t.codecs.forEach(function(n){for(var s=0;s<e.codecs.length;s++){var o=e.codecs[s];if(n.name.toLowerCase()===o.name.toLowerCase()&&n.clockRate===o.clockRate){if("rtx"===n.name.toLowerCase()&&n.parameters&&o.parameters.apt&&!r(n,o,t.codecs,e.codecs))continue;(o=JSON.parse(JSON.stringify(o))).numChannels=Math.min(n.numChannels,o.numChannels),i.codecs.push(o),o.rtcpFeedback=o.rtcpFeedback.filter(function(t){for(var e=0;e<n.rtcpFeedback.length;e++)if(n.rtcpFeedback[e].type===t.type&&n.rtcpFeedback[e].parameter===t.parameter)return!0;return!1});break}}}),t.headerExtensions.forEach(function(t){for(var n=0;n<e.headerExtensions.length;n++){var r=e.headerExtensions[n];if(t.uri===r.uri){i.headerExtensions.push(r);break}}}),i}function s(t,e,i){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[e][t].indexOf(i)}function o(t,e){var i=t.getRemoteCandidates().find(function(t){return e.foundation===t.foundation&&e.ip===t.ip&&e.port===t.port&&e.priority===t.priority&&e.protocol===t.protocol&&e.type===t.type});return i||t.addRemoteCandidate(e),!i}function a(t,e){var i=new Error(e);return i.name=t,i.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[t],i}var u=t("sdp");e.exports=function(t,e){function i(e,i){i.addTrack(e),i.dispatchEvent(new t.MediaStreamTrackEvent("addtrack",{track:e}))}function c(e,i){i.removeTrack(e),i.dispatchEvent(new t.MediaStreamTrackEvent("removetrack",{track:e}))}function h(e,i,n,r){var s=new Event("track");s.track=i,s.receiver=n,s.transceiver={receiver:n},s.streams=r,t.setTimeout(function(){e.R("track",s)})}var f=function(i){var n=this,r=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(t){n[t]=r[t].bind(r)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this.C=null,this.M=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",i=JSON.parse(JSON.stringify(i||{})),this.usingBundle="max-bundle"===i.bundlePolicy,"negotiate"===i.rtcpMuxPolicy)throw a("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(i.rtcpMuxPolicy||(i.rtcpMuxPolicy="require"),i.iceTransportPolicy){case"all":case"relay":break;default:i.iceTransportPolicy="all"}switch(i.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:i.bundlePolicy="balanced"}if(i.iceServers=function(t,e){var i=!1;return(t=JSON.parse(JSON.stringify(t))).filter(function(t){if(t&&(t.urls||t.url)){var n=t.urls||t.url;t.url&&!t.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var r="string"==typeof n;return r&&(n=[n]),n=n.filter(function(t){return 0===t.indexOf("turn:")&&-1!==t.indexOf("transport=udp")&&-1===t.indexOf("turn:[")&&!i?(i=!0,!0):0===t.indexOf("stun:")&&e>=14393&&-1===t.indexOf("?transport=udp")}),delete t.url,t.urls=r?n[0]:n,!!n.length}})}(i.iceServers||[],e),this.P=[],i.iceCandidatePoolSize)for(var s=i.iceCandidatePoolSize;s>0;s--)this.P.push(new t.RTCIceGatherer({iceServers:i.iceServers,gatherPolicy:i.iceTransportPolicy}));else i.iceCandidatePoolSize=0;this.x=i,this.transceivers=[],this.D=u.generateSessionId(),this.O=0,this.A=void 0,this.q=!1};Object.defineProperty(f.prototype,"localDescription",{configurable:!0,get:function(){return this.C}}),Object.defineProperty(f.prototype,"remoteDescription",{configurable:!0,get:function(){return this.M}}),f.prototype.onicecandidate=null,f.prototype.onaddstream=null,f.prototype.ontrack=null,f.prototype.onremovestream=null,f.prototype.onsignalingstatechange=null,f.prototype.oniceconnectionstatechange=null,f.prototype.onconnectionstatechange=null,f.prototype.onicegatheringstatechange=null,f.prototype.onnegotiationneeded=null,f.prototype.ondatachannel=null,f.prototype.R=function(t,e){this.q||(this.dispatchEvent(e),"function"==typeof this["on"+t]&&this["on"+t](e))},f.prototype.U=function(){var t=new Event("icegatheringstatechange");this.R("icegatheringstatechange",t)},f.prototype.getConfiguration=function(){return this.x},f.prototype.getLocalStreams=function(){return this.localStreams},f.prototype.getRemoteStreams=function(){return this.remoteStreams},f.prototype.F=function(t,e){var i=this.transceivers.length>0,n={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:t,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&i)n.iceTransport=this.transceivers[0].iceTransport,n.dtlsTransport=this.transceivers[0].dtlsTransport;else{var r=this.N();n.iceTransport=r.iceTransport,n.dtlsTransport=r.dtlsTransport}return e||this.transceivers.push(n),n},f.prototype.addTrack=function(e,i){if(this.q)throw a("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");if(this.transceivers.find(function(t){return t.track===e}))throw a("InvalidAccessError","Track already exists.");for(var n,r=0;r<this.transceivers.length;r++)this.transceivers[r].track||this.transceivers[r].kind!==e.kind||(n=this.transceivers[r]);return n||(n=this.F(e.kind)),this.j(),-1===this.localStreams.indexOf(i)&&this.localStreams.push(i),n.track=e,n.stream=i,n.rtpSender=new t.RTCRtpSender(e,n.dtlsTransport),n.rtpSender},f.prototype.addStream=function(t){var i=this;if(e>=15025)t.getTracks().forEach(function(e){i.addTrack(e,t)});else{var n=t.clone();t.getTracks().forEach(function(t,e){var i=n.getTracks()[e];t.addEventListener("enabled",function(t){i.enabled=t.enabled})}),n.getTracks().forEach(function(t){i.addTrack(t,n)})}},f.prototype.removeTrack=function(e){if(this.q)throw a("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(e instanceof t.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var i=this.transceivers.find(function(t){return t.rtpSender===e});if(!i)throw a("InvalidAccessError","Sender was not created by this connection.");var n=i.stream;i.rtpSender.stop(),i.rtpSender=null,i.track=null,i.stream=null,-1===this.transceivers.map(function(t){return t.stream}).indexOf(n)&&this.localStreams.indexOf(n)>-1&&this.localStreams.splice(this.localStreams.indexOf(n),1),this.j()},f.prototype.removeStream=function(t){var e=this;t.getTracks().forEach(function(t){var i=e.getSenders().find(function(e){return e.track===t});i&&e.removeTrack(i)})},f.prototype.getSenders=function(){return this.transceivers.filter(function(t){return!!t.rtpSender}).map(function(t){return t.rtpSender})},f.prototype.getReceivers=function(){return this.transceivers.filter(function(t){return!!t.rtpReceiver}).map(function(t){return t.rtpReceiver})},f.prototype.L=function(e,i){var n=this;if(i&&e>0)return this.transceivers[0].iceGatherer;if(this.P.length)return this.P.shift();var r=new t.RTCIceGatherer({iceServers:this.x.iceServers,gatherPolicy:this.x.iceTransportPolicy});return Object.defineProperty(r,"state",{value:"new",writable:!0}),this.transceivers[e].bufferedCandidateEvents=[],this.transceivers[e].bufferCandidates=function(t){var i=!t.candidate||0===Object.keys(t.candidate).length;r.state=i?"completed":"gathering",null!==n.transceivers[e].bufferedCandidateEvents&&n.transceivers[e].bufferedCandidateEvents.push(t)},r.addEventListener("localcandidate",this.transceivers[e].bufferCandidates),r},f.prototype.B=function(e,i){var n=this,r=this.transceivers[i].iceGatherer;if(!r.onlocalcandidate){var s=this.transceivers[i].bufferedCandidateEvents;this.transceivers[i].bufferedCandidateEvents=null,r.removeEventListener("localcandidate",this.transceivers[i].bufferCandidates),r.onlocalcandidate=function(t){if(!(n.usingBundle&&i>0)){var s=new Event("icecandidate");s.candidate={sdpMid:e,sdpMLineIndex:i};var o=t.candidate,a=!o||0===Object.keys(o).length;if(a)"new"!==r.state&&"gathering"!==r.state||(r.state="completed");else{"new"===r.state&&(r.state="gathering"),o.component=1,o.ufrag=r.getLocalParameters().usernameFragment;var c=u.writeCandidate(o);s.candidate=Object.assign(s.candidate,u.parseCandidate(c)),s.candidate.candidate=c,s.candidate.toJSON=function(){return{candidate:s.candidate.candidate,sdpMid:s.candidate.sdpMid,sdpMLineIndex:s.candidate.sdpMLineIndex,usernameFragment:s.candidate.usernameFragment}}}var h=u.getMediaSections(n.C.sdp);h[s.candidate.sdpMLineIndex]+=a?"a=end-of-candidates\r\n":"a="+s.candidate.candidate+"\r\n",n.C.sdp=u.getDescription(n.C.sdp)+h.join("");var f=n.transceivers.every(function(t){return t.iceGatherer&&"completed"===t.iceGatherer.state});"gathering"!==n.iceGatheringState&&(n.iceGatheringState="gathering",n.U()),a||n.R("icecandidate",s),f&&(n.R("icecandidate",new Event("icecandidate")),n.iceGatheringState="complete",n.U())}},t.setTimeout(function(){s.forEach(function(t){r.onlocalcandidate(t)})},0)}},f.prototype.N=function(){var e=this,i=new t.RTCIceTransport(null);i.onicestatechange=function(){e.W(),e.z()};var n=new t.RTCDtlsTransport(i);return n.ondtlsstatechange=function(){e.z()},n.onerror=function(){Object.defineProperty(n,"state",{value:"failed",writable:!0}),e.z()},{iceTransport:i,dtlsTransport:n}},f.prototype.V=function(t){var e=this.transceivers[t].iceGatherer;e&&(delete e.onlocalcandidate,delete this.transceivers[t].iceGatherer);var i=this.transceivers[t].iceTransport;i&&(delete i.onicestatechange,delete this.transceivers[t].iceTransport);var n=this.transceivers[t].dtlsTransport;n&&(delete n.ondtlsstatechange,delete n.onerror,delete this.transceivers[t].dtlsTransport)},f.prototype.H=function(t,i,n){var s=r(t.localCapabilities,t.remoteCapabilities);i&&t.rtpSender&&(s.encodings=t.sendEncodingParameters,s.rtcp={cname:u.localCName,compound:t.rtcpParameters.compound},t.recvEncodingParameters.length&&(s.rtcp.ssrc=t.recvEncodingParameters[0].ssrc),t.rtpSender.send(s)),n&&t.rtpReceiver&&s.codecs.length>0&&("video"===t.kind&&t.recvEncodingParameters&&e<15019&&t.recvEncodingParameters.forEach(function(t){delete t.rtx}),t.recvEncodingParameters.length?s.encodings=t.recvEncodingParameters:s.encodings=[{}],s.rtcp={compound:t.rtcpParameters.compound},t.rtcpParameters.cname&&(s.rtcp.cname=t.rtcpParameters.cname),t.sendEncodingParameters.length&&(s.rtcp.ssrc=t.sendEncodingParameters[0].ssrc),t.rtpReceiver.receive(s))},f.prototype.setLocalDescription=function(t){var e,i,n=this;if(-1===["offer","answer"].indexOf(t.type))return Promise.reject(a("TypeError",'Unsupported type "'+t.type+'"'));if(!s("setLocalDescription",t.type,n.signalingState)||n.q)return Promise.reject(a("InvalidStateError","Can not set local "+t.type+" in state "+n.signalingState));if("offer"===t.type)e=u.splitSections(t.sdp),i=e.shift(),e.forEach(function(t,e){var i=u.parseRtpParameters(t);n.transceivers[e].localCapabilities=i}),n.transceivers.forEach(function(t,e){n.B(t.mid,e)});else if("answer"===t.type){e=u.splitSections(n.M.sdp),i=e.shift();var o=u.matchPrefix(i,"a=ice-lite").length>0;e.forEach(function(t,e){var s=n.transceivers[e],a=s.iceGatherer,c=s.iceTransport,h=s.dtlsTransport,f=s.localCapabilities,d=s.remoteCapabilities;if(!(u.isRejected(t)&&0===u.matchPrefix(t,"a=bundle-only").length)&&!s.rejected){var l=u.getIceParameters(t,i),m=u.getDtlsParameters(t,i);o&&(m.role="server"),n.usingBundle&&0!==e||(n.B(s.mid,e),"new"===c.state&&c.start(a,l,o?"controlling":"controlled"),"new"===h.state&&h.start(m));var p=r(f,d);n.H(s,p.codecs.length>0,!1)}})}return n.C={type:t.type,sdp:t.sdp},"offer"===t.type?n.G("have-local-offer"):n.G("stable"),Promise.resolve()},f.prototype.setRemoteDescription=function(n){var r=this;if(-1===["offer","answer"].indexOf(n.type))return Promise.reject(a("TypeError",'Unsupported type "'+n.type+'"'));if(!s("setRemoteDescription",n.type,r.signalingState)||r.q)return Promise.reject(a("InvalidStateError","Can not set remote "+n.type+" in state "+r.signalingState));var f={};r.remoteStreams.forEach(function(t){f[t.id]=t});var d=[],l=u.splitSections(n.sdp),m=l.shift(),p=u.matchPrefix(m,"a=ice-lite").length>0,v=u.matchPrefix(m,"a=group:BUNDLE ").length>0;r.usingBundle=v;var g=u.matchPrefix(m,"a=ice-options:")[0];return r.canTrickleIceCandidates=!!g&&g.substr(14).split(" ").indexOf("trickle")>=0,l.forEach(function(s,a){var h=u.splitLines(s),l=u.getKind(s),g=u.isRejected(s)&&0===u.matchPrefix(s,"a=bundle-only").length,y=h[0].substr(2).split(" ")[2],w=u.getDirection(s,m),b=u.parseMsid(s),k=u.getMid(s)||u.generateIdentifier();if(g||"application"===l&&("DTLS/SCTP"===y||"UDP/DTLS/SCTP"===y))r.transceivers[a]={mid:k,kind:l,protocol:y,rejected:!0};else{!g&&r.transceivers[a]&&r.transceivers[a].rejected&&(r.transceivers[a]=r.F(l,!0));var S,E,T,I,R,C,M,P,x,D,O,A=u.parseRtpParameters(s);g||(D=u.getIceParameters(s,m),(O=u.getDtlsParameters(s,m)).role="client"),M=u.parseRtpEncodingParameters(s);var q=u.parseRtcpParameters(s),U=u.matchPrefix(s,"a=end-of-candidates",m).length>0,F=u.matchPrefix(s,"a=candidate:").map(function(t){return u.parseCandidate(t)}).filter(function(t){return 1===t.component});if(("offer"===n.type||"answer"===n.type)&&!g&&v&&a>0&&r.transceivers[a]&&(r.V(a),r.transceivers[a].iceGatherer=r.transceivers[0].iceGatherer,r.transceivers[a].iceTransport=r.transceivers[0].iceTransport,r.transceivers[a].dtlsTransport=r.transceivers[0].dtlsTransport,r.transceivers[a].rtpSender&&r.transceivers[a].rtpSender.setTransport(r.transceivers[0].dtlsTransport),r.transceivers[a].rtpReceiver&&r.transceivers[a].rtpReceiver.setTransport(r.transceivers[0].dtlsTransport)),"offer"!==n.type||g)"answer"!==n.type||g||(E=(S=r.transceivers[a]).iceGatherer,T=S.iceTransport,I=S.dtlsTransport,R=S.rtpReceiver,C=S.sendEncodingParameters,P=S.localCapabilities,r.transceivers[a].recvEncodingParameters=M,r.transceivers[a].remoteCapabilities=A,r.transceivers[a].rtcpParameters=q,F.length&&"new"===T.state&&(!p&&!U||v&&0!==a?F.forEach(function(t){o(S.iceTransport,t)}):T.setRemoteCandidates(F)),v&&0!==a||("new"===T.state&&T.start(E,D,"controlling"),"new"===I.state&&I.start(O)),r.H(S,"sendrecv"===w||"recvonly"===w,"sendrecv"===w||"sendonly"===w),!R||"sendrecv"!==w&&"sendonly"!==w?delete S.rtpReceiver:(x=R.track,b?(f[b.stream]||(f[b.stream]=new t.MediaStream),i(x,f[b.stream]),d.push([x,R,f[b.stream]])):(f.default||(f.default=new t.MediaStream),i(x,f.default),d.push([x,R,f.default]))));else{(S=r.transceivers[a]||r.F(l)).mid=k,S.iceGatherer||(S.iceGatherer=r.L(a,v)),F.length&&"new"===S.iceTransport.state&&(!U||v&&0!==a?F.forEach(function(t){o(S.iceTransport,t)}):S.iceTransport.setRemoteCandidates(F)),P=t.RTCRtpReceiver.getCapabilities(l),e<15019&&(P.codecs=P.codecs.filter(function(t){return"rtx"!==t.name})),C=S.sendEncodingParameters||[{ssrc:1001*(2*a+2)}];var N,j=!1;"sendrecv"===w||"sendonly"===w?(j=!S.rtpReceiver,R=S.rtpReceiver||new t.RTCRtpReceiver(S.dtlsTransport,l),j&&(x=R.track,b&&"-"===b.stream||(b?(f[b.stream]||(f[b.stream]=new t.MediaStream,Object.defineProperty(f[b.stream],"id",{get:function(){return b.stream}})),Object.defineProperty(x,"id",{get:function(){return b.track}}),N=f[b.stream]):(f.default||(f.default=new t.MediaStream),N=f.default)),N&&(i(x,N),S.associatedRemoteMediaStreams.push(N)),d.push([x,R,N]))):S.rtpReceiver&&S.rtpReceiver.track&&(S.associatedRemoteMediaStreams.forEach(function(t){var e=t.getTracks().find(function(t){return t.id===S.rtpReceiver.track.id});e&&c(e,t)}),S.associatedRemoteMediaStreams=[]),S.localCapabilities=P,S.remoteCapabilities=A,S.rtpReceiver=R,S.rtcpParameters=q,S.sendEncodingParameters=C,S.recvEncodingParameters=M,r.H(r.transceivers[a],!1,j)}}}),void 0===r.A&&(r.A="offer"===n.type?"active":"passive"),r.M={type:n.type,sdp:n.sdp},"offer"===n.type?r.G("have-remote-offer"):r.G("stable"),Object.keys(f).forEach(function(e){var i=f[e];if(i.getTracks().length){if(-1===r.remoteStreams.indexOf(i)){r.remoteStreams.push(i);var n=new Event("addstream");n.stream=i,t.setTimeout(function(){r.R("addstream",n)})}d.forEach(function(t){var e=t[0],n=t[1];i.id===t[2].id&&h(r,e,n,[i])})}}),d.forEach(function(t){t[2]||h(r,t[0],t[1],[])}),t.setTimeout(function(){r&&r.transceivers&&r.transceivers.forEach(function(t){t.iceTransport&&"new"===t.iceTransport.state&&t.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),t.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},f.prototype.close=function(){this.transceivers.forEach(function(t){t.iceTransport&&t.iceTransport.stop(),t.dtlsTransport&&t.dtlsTransport.stop(),t.rtpSender&&t.rtpSender.stop(),t.rtpReceiver&&t.rtpReceiver.stop()}),this.q=!0,this.G("closed")},f.prototype.G=function(t){this.signalingState=t;var e=new Event("signalingstatechange");this.R("signalingstatechange",e)},f.prototype.j=function(){var e=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,t.setTimeout(function(){if(e.needNegotiation){e.needNegotiation=!1;var t=new Event("negotiationneeded");e.R("negotiationneeded",t)}},0))},f.prototype.W=function(){var t,e={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(t){e[t.iceTransport.state]++}),t="new",e.failed>0?t="failed":e.checking>0?t="checking":e.disconnected>0?t="disconnected":e.new>0?t="new":e.connected>0?t="connected":e.completed>0&&(t="completed"),t!==this.iceConnectionState){this.iceConnectionState=t;var i=new Event("iceconnectionstatechange");this.R("iceconnectionstatechange",i)}},f.prototype.z=function(){var t,e={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(t){e[t.iceTransport.state]++,e[t.dtlsTransport.state]++}),e.connected+=e.completed,t="new",e.failed>0?t="failed":e.connecting>0?t="connecting":e.disconnected>0?t="disconnected":e.new>0?t="new":e.connected>0&&(t="connected"),t!==this.connectionState){this.connectionState=t;var i=new Event("connectionstatechange");this.R("connectionstatechange",i)}},f.prototype.createOffer=function(){var i=this;if(i.q)return Promise.reject(a("InvalidStateError","Can not call createOffer after close"));var r=i.transceivers.filter(function(t){return"audio"===t.kind}).length,s=i.transceivers.filter(function(t){return"video"===t.kind}).length,o=arguments[0];if(o){if(o.mandatory||o.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==o.offerToReceiveAudio&&(r=!0===o.offerToReceiveAudio?1:!1===o.offerToReceiveAudio?0:o.offerToReceiveAudio),void 0!==o.offerToReceiveVideo&&(s=!0===o.offerToReceiveVideo?1:!1===o.offerToReceiveVideo?0:o.offerToReceiveVideo)}for(i.transceivers.forEach(function(t){"audio"===t.kind?--r<0&&(t.wantReceive=!1):"video"===t.kind&&--s<0&&(t.wantReceive=!1)});r>0||s>0;)r>0&&(i.F("audio"),r--),s>0&&(i.F("video"),s--);var c=u.writeSessionBoilerplate(i.D,i.O++);i.transceivers.forEach(function(n,r){var s=n.track,o=n.kind,a=n.mid||u.generateIdentifier();n.mid=a,n.iceGatherer||(n.iceGatherer=i.L(r,i.usingBundle));var c=t.RTCRtpSender.getCapabilities(o);e<15019&&(c.codecs=c.codecs.filter(function(t){return"rtx"!==t.name})),c.codecs.forEach(function(t){"H264"===t.name&&void 0===t.parameters["level-asymmetry-allowed"]&&(t.parameters["level-asymmetry-allowed"]="1"),n.remoteCapabilities&&n.remoteCapabilities.codecs&&n.remoteCapabilities.codecs.forEach(function(e){t.name.toLowerCase()===e.name.toLowerCase()&&t.clockRate===e.clockRate&&(t.preferredPayloadType=e.payloadType)})}),c.headerExtensions.forEach(function(t){(n.remoteCapabilities&&n.remoteCapabilities.headerExtensions||[]).forEach(function(e){t.uri===e.uri&&(t.id=e.id)})});var h=n.sendEncodingParameters||[{ssrc:1001*(2*r+1)}];s&&e>=15019&&"video"===o&&!h[0].rtx&&(h[0].rtx={ssrc:h[0].ssrc+1}),n.wantReceive&&(n.rtpReceiver=new t.RTCRtpReceiver(n.dtlsTransport,o)),n.localCapabilities=c,n.sendEncodingParameters=h}),"max-compat"!==i.x.bundlePolicy&&(c+="a=group:BUNDLE "+i.transceivers.map(function(t){return t.mid}).join(" ")+"\r\n"),c+="a=ice-options:trickle\r\n",i.transceivers.forEach(function(t,e){c+=n(t,t.localCapabilities,"offer",t.stream,i.A),c+="a=rtcp-rsize\r\n",!t.iceGatherer||"new"===i.iceGatheringState||0!==e&&i.usingBundle||(t.iceGatherer.getLocalCandidates().forEach(function(t){t.component=1,c+="a="+u.writeCandidate(t)+"\r\n"}),"completed"===t.iceGatherer.state&&(c+="a=end-of-candidates\r\n"))});var h=new t.RTCSessionDescription({type:"offer",sdp:c});return Promise.resolve(h)},f.prototype.createAnswer=function(){var i=this;if(i.q)return Promise.reject(a("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==i.signalingState&&"have-local-pranswer"!==i.signalingState)return Promise.reject(a("InvalidStateError","Can not call createAnswer in signalingState "+i.signalingState));var s=u.writeSessionBoilerplate(i.D,i.O++);i.usingBundle&&(s+="a=group:BUNDLE "+i.transceivers.map(function(t){return t.mid}).join(" ")+"\r\n");var o=u.getMediaSections(i.M.sdp).length;i.transceivers.forEach(function(t,a){if(!(a+1>o)){if(t.rejected)return"application"===t.kind?s+="DTLS/SCTP"===t.protocol?"m=application 0 DTLS/SCTP 5000\r\n":"m=application 0 "+t.protocol+" webrtc-datachannel\r\n":"audio"===t.kind?s+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===t.kind&&(s+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(s+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+t.mid+"\r\n");var u;t.stream&&("audio"===t.kind?u=t.stream.getAudioTracks()[0]:"video"===t.kind&&(u=t.stream.getVideoTracks()[0]),u&&e>=15019&&"video"===t.kind&&!t.sendEncodingParameters[0].rtx&&(t.sendEncodingParameters[0].rtx={ssrc:t.sendEncodingParameters[0].ssrc+1}));var c=r(t.localCapabilities,t.remoteCapabilities);!c.codecs.filter(function(t){return"rtx"===t.name.toLowerCase()}).length&&t.sendEncodingParameters[0].rtx&&delete t.sendEncodingParameters[0].rtx,s+=n(t,c,"answer",t.stream,i.A),t.rtcpParameters&&t.rtcpParameters.reducedSize&&(s+="a=rtcp-rsize\r\n")}});var c=new t.RTCSessionDescription({type:"answer",sdp:s});return Promise.resolve(c)},f.prototype.addIceCandidate=function(t){var e,i=this;return t&&void 0===t.sdpMLineIndex&&!t.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(n,r){if(!i.M)return r(a("InvalidStateError","Can not add ICE candidate without a remote description"));if(t&&""!==t.candidate){var s=t.sdpMLineIndex;if(t.sdpMid)for(var c=0;c<i.transceivers.length;c++)if(i.transceivers[c].mid===t.sdpMid){s=c;break}var h=i.transceivers[s];if(!h)return r(a("OperationError","Can not add ICE candidate"));if(h.rejected)return n();var f=Object.keys(t.candidate).length>0?u.parseCandidate(t.candidate):{};if("tcp"===f.protocol&&(0===f.port||9===f.port))return n();if(f.component&&1!==f.component)return n();if((0===s||s>0&&h.iceTransport!==i.transceivers[0].iceTransport)&&!o(h.iceTransport,f))return r(a("OperationError","Can not add ICE candidate"));var d=t.candidate.trim();0===d.indexOf("a=")&&(d=d.substr(2)),(e=u.getMediaSections(i.M.sdp))[s]+="a="+(f.type?d:"end-of-candidates")+"\r\n",i.M.sdp=u.getDescription(i.M.sdp)+e.join("")}else for(var l=0;l<i.transceivers.length&&(i.transceivers[l].rejected||(i.transceivers[l].iceTransport.addRemoteCandidate({}),(e=u.getMediaSections(i.M.sdp))[l]+="a=end-of-candidates\r\n",i.M.sdp=u.getDescription(i.M.sdp)+e.join(""),!i.usingBundle));l++);n()})},f.prototype.getStats=function(e){if(e&&e instanceof t.MediaStreamTrack){var i=null;if(this.transceivers.forEach(function(t){t.rtpSender&&t.rtpSender.track===e?i=t.rtpSender:t.rtpReceiver&&t.rtpReceiver.track===e&&(i=t.rtpReceiver)}),!i)throw a("InvalidAccessError","Invalid selector.");return i.getStats()}var n=[];return this.transceivers.forEach(function(t){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(e){t[e]&&n.push(t[e].getStats())})}),Promise.all(n).then(function(t){var e=new Map;return t.forEach(function(t){t.forEach(function(t){e.set(t.id,t)})}),e})},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(e){var i=t[e];if(i&&i.prototype&&i.prototype.getStats){var n=i.prototype.getStats;i.prototype.getStats=function(){return n.apply(this).then(function(t){var e=new Map;return Object.keys(t).forEach(function(i){t[i].type=function(t){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[t.type]||t.type}(t[i]),e.set(i,t[i])}),e})}}});var d=["createOffer","createAnswer"];return d.forEach(function(t){var e=f.prototype[t];f.prototype[t]=function(){var t=arguments;return"function"==typeof t[0]||"function"==typeof t[1]?e.apply(this,[arguments[2]]).then(function(e){"function"==typeof t[0]&&t[0].apply(null,[e])},function(e){"function"==typeof t[1]&&t[1].apply(null,[e])}):e.apply(this,arguments)}}),(d=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(t){var e=f.prototype[t];f.prototype[t]=function(){var t=arguments;return"function"==typeof t[1]||"function"==typeof t[2]?e.apply(this,arguments).then(function(){"function"==typeof t[1]&&t[1].apply(null)},function(e){"function"==typeof t[2]&&t[2].apply(null,[e])}):e.apply(this,arguments)}}),["getStats"].forEach(function(t){var e=f.prototype[t];f.prototype[t]=function(){var t=arguments;return"function"==typeof t[1]?e.apply(this,arguments).then(function(){"function"==typeof t[1]&&t[1].apply(null)}):e.apply(this,arguments)}}),f}},{sdp:2}],2:[function(t,e,i){"use strict";var n={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};n.localCName=n.generateIdentifier(),n.splitLines=function(t){return t.trim().split("\n").map(function(t){return t.trim()})},n.splitSections=function(t){return t.split("\nm=").map(function(t,e){return(e>0?"m="+t:t).trim()+"\r\n"})},n.getDescription=function(t){var e=n.splitSections(t);return e&&e[0]},n.getMediaSections=function(t){var e=n.splitSections(t);return e.shift(),e},n.matchPrefix=function(t,e){return n.splitLines(t).filter(function(t){return 0===t.indexOf(e)})},n.parseCandidate=function(t){for(var e,i={foundation:(e=0===t.indexOf("a=candidate:")?t.substring(12).split(" "):t.substring(10).split(" "))[0],component:parseInt(e[1],10),protocol:e[2].toLowerCase(),priority:parseInt(e[3],10),ip:e[4],port:parseInt(e[5],10),type:e[7]},n=8;n<e.length;n+=2)switch(e[n]){case"raddr":i.relatedAddress=e[n+1];break;case"rport":i.relatedPort=parseInt(e[n+1],10);break;case"tcptype":i.tcpType=e[n+1];break;case"ufrag":i.ufrag=e[n+1],i.usernameFragment=e[n+1];break;default:i[e[n]]=e[n+1]}return i},n.writeCandidate=function(t){var e=[];e.push(t.foundation),e.push(t.component),e.push(t.protocol.toUpperCase()),e.push(t.priority),e.push(t.ip),e.push(t.port);var i=t.type;return e.push("typ"),e.push(i),"host"!==i&&t.relatedAddress&&t.relatedPort&&(e.push("raddr"),e.push(t.relatedAddress),e.push("rport"),e.push(t.relatedPort)),t.tcpType&&"tcp"===t.protocol.toLowerCase()&&(e.push("tcptype"),e.push(t.tcpType)),(t.usernameFragment||t.ufrag)&&(e.push("ufrag"),e.push(t.usernameFragment||t.ufrag)),"candidate:"+e.join(" ")},n.parseIceOptions=function(t){return t.substr(14).split(" ")},n.parseRtpMap=function(t){var e=t.substr(9).split(" "),i={payloadType:parseInt(e.shift(),10)};return e=e[0].split("/"),i.name=e[0],i.clockRate=parseInt(e[1],10),i.channels=3===e.length?parseInt(e[2],10):1,i.numChannels=i.channels,i},n.writeRtpMap=function(t){var e=t.payloadType;void 0!==t.preferredPayloadType&&(e=t.preferredPayloadType);var i=t.channels||t.numChannels||1;return"a=rtpmap:"+e+" "+t.name+"/"+t.clockRate+(1!==i?"/"+i:"")+"\r\n"},n.parseExtmap=function(t){var e=t.substr(9).split(" ");return{id:parseInt(e[0],10),direction:e[0].indexOf("/")>0?e[0].split("/")[1]:"sendrecv",uri:e[1]}},n.writeExtmap=function(t){return"a=extmap:"+(t.id||t.preferredId)+(t.direction&&"sendrecv"!==t.direction?"/"+t.direction:"")+" "+t.uri+"\r\n"},n.parseFmtp=function(t){for(var e,i={},n=t.substr(t.indexOf(" ")+1).split(";"),r=0;r<n.length;r++)i[(e=n[r].trim().split("="))[0].trim()]=e[1];return i},n.writeFmtp=function(t){var e="",i=t.payloadType;if(void 0!==t.preferredPayloadType&&(i=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){var n=[];Object.keys(t.parameters).forEach(function(e){t.parameters[e]?n.push(e+"="+t.parameters[e]):n.push(e)}),e+="a=fmtp:"+i+" "+n.join(";")+"\r\n"}return e},n.parseRtcpFb=function(t){var e=t.substr(t.indexOf(" ")+1).split(" ");return{type:e.shift(),parameter:e.join(" ")}},n.writeRtcpFb=function(t){var e="",i=t.payloadType;return void 0!==t.preferredPayloadType&&(i=t.preferredPayloadType),t.rtcpFeedback&&t.rtcpFeedback.length&&t.rtcpFeedback.forEach(function(t){e+="a=rtcp-fb:"+i+" "+t.type+(t.parameter&&t.parameter.length?" "+t.parameter:"")+"\r\n"}),e},n.parseSsrcMedia=function(t){var e=t.indexOf(" "),i={ssrc:parseInt(t.substr(7,e-7),10)},n=t.indexOf(":",e);return n>-1?(i.attribute=t.substr(e+1,n-e-1),i.value=t.substr(n+1)):i.attribute=t.substr(e+1),i},n.parseSsrcGroup=function(t){var e=t.substr(13).split(" ");return{semantics:e.shift(),ssrcs:e.map(function(t){return parseInt(t,10)})}},n.getMid=function(t){var e=n.matchPrefix(t,"a=mid:")[0];if(e)return e.substr(6)},n.parseFingerprint=function(t){var e=t.substr(14).split(" ");return{algorithm:e[0].toLowerCase(),value:e[1]}},n.getDtlsParameters=function(t,e){return{role:"auto",fingerprints:n.matchPrefix(t+e,"a=fingerprint:").map(n.parseFingerprint)}},n.writeDtlsParameters=function(t,e){var i="a=setup:"+e+"\r\n";return t.fingerprints.forEach(function(t){i+="a=fingerprint:"+t.algorithm+" "+t.value+"\r\n"}),i},n.getIceParameters=function(t,e){var i=n.splitLines(t);return{usernameFragment:(i=i.concat(n.splitLines(e))).filter(function(t){return 0===t.indexOf("a=ice-ufrag:")})[0].substr(12),password:i.filter(function(t){return 0===t.indexOf("a=ice-pwd:")})[0].substr(10)}},n.writeIceParameters=function(t){return"a=ice-ufrag:"+t.usernameFragment+"\r\na=ice-pwd:"+t.password+"\r\n"},n.parseRtpParameters=function(t){for(var e={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=n.splitLines(t)[0].split(" "),r=3;r<i.length;r++){var s=i[r],o=n.matchPrefix(t,"a=rtpmap:"+s+" ")[0];if(o){var a=n.parseRtpMap(o),u=n.matchPrefix(t,"a=fmtp:"+s+" ");switch(a.parameters=u.length?n.parseFmtp(u[0]):{},a.rtcpFeedback=n.matchPrefix(t,"a=rtcp-fb:"+s+" ").map(n.parseRtcpFb),e.codecs.push(a),a.name.toUpperCase()){case"RED":case"ULPFEC":e.fecMechanisms.push(a.name.toUpperCase())}}}return n.matchPrefix(t,"a=extmap:").forEach(function(t){e.headerExtensions.push(n.parseExtmap(t))}),e},n.writeRtpDescription=function(t,e){var i="";i+="m="+t+" ",i+=e.codecs.length>0?"9":"0",i+=" UDP/TLS/RTP/SAVPF ",i+=e.codecs.map(function(t){return void 0!==t.preferredPayloadType?t.preferredPayloadType:t.payloadType}).join(" ")+"\r\n",i+="c=IN IP4 0.0.0.0\r\n",i+="a=rtcp:9 IN IP4 0.0.0.0\r\n",e.codecs.forEach(function(t){i+=n.writeRtpMap(t),i+=n.writeFmtp(t),i+=n.writeRtcpFb(t)});var r=0;return e.codecs.forEach(function(t){t.maxptime>r&&(r=t.maxptime)}),r>0&&(i+="a=maxptime:"+r+"\r\n"),i+="a=rtcp-mux\r\n",e.headerExtensions&&e.headerExtensions.forEach(function(t){i+=n.writeExtmap(t)}),i},n.parseRtpEncodingParameters=function(t){var e,i=[],r=n.parseRtpParameters(t),s=-1!==r.fecMechanisms.indexOf("RED"),o=-1!==r.fecMechanisms.indexOf("ULPFEC"),a=n.matchPrefix(t,"a=ssrc:").map(function(t){return n.parseSsrcMedia(t)}).filter(function(t){return"cname"===t.attribute}),u=a.length>0&&a[0].ssrc,c=n.matchPrefix(t,"a=ssrc-group:FID").map(function(t){return t.substr(17).split(" ").map(function(t){return parseInt(t,10)})});c.length>0&&c[0].length>1&&c[0][0]===u&&(e=c[0][1]),r.codecs.forEach(function(t){if("RTX"===t.name.toUpperCase()&&t.parameters.apt){var n={ssrc:u,codecPayloadType:parseInt(t.parameters.apt,10)};u&&e&&(n.rtx={ssrc:e}),i.push(n),s&&((n=JSON.parse(JSON.stringify(n))).fec={ssrc:e,mechanism:o?"red+ulpfec":"red"},i.push(n))}}),0===i.length&&u&&i.push({ssrc:u});var h=n.matchPrefix(t,"b=");return h.length&&(h=0===h[0].indexOf("b=TIAS:")?parseInt(h[0].substr(7),10):0===h[0].indexOf("b=AS:")?1e3*parseInt(h[0].substr(5),10)*.95-16e3:void 0,i.forEach(function(t){t.maxBitrate=h})),i},n.parseRtcpParameters=function(t){var e={},i=n.matchPrefix(t,"a=ssrc:").map(function(t){return n.parseSsrcMedia(t)}).filter(function(t){return"cname"===t.attribute})[0];i&&(e.cname=i.value,e.ssrc=i.ssrc);var r=n.matchPrefix(t,"a=rtcp-rsize");e.reducedSize=r.length>0,e.compound=0===r.length;var s=n.matchPrefix(t,"a=rtcp-mux");return e.mux=s.length>0,e},n.parseMsid=function(t){var e,i=n.matchPrefix(t,"a=msid:");if(1===i.length)return{stream:(e=i[0].substr(7).split(" "))[0],track:e[1]};var r=n.matchPrefix(t,"a=ssrc:").map(function(t){return n.parseSsrcMedia(t)}).filter(function(t){return"msid"===t.attribute});return r.length>0?{stream:(e=r[0].value.split(" "))[0],track:e[1]}:void 0},n.generateSessionId=function(){return Math.random().toString().substr(2,21)},n.writeSessionBoilerplate=function(t,e){var i=void 0!==e?e:2;return"v=0\r\no=thisisadapterortc "+(t||n.generateSessionId())+" "+i+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},n.writeMediaSection=function(t,e,i,r){var s=n.writeRtpDescription(t.kind,e);if(s+=n.writeIceParameters(t.iceGatherer.getLocalParameters()),s+=n.writeDtlsParameters(t.dtlsTransport.getLocalParameters(),"offer"===i?"actpass":"active"),s+="a=mid:"+t.mid+"\r\n",s+=t.direction?"a="+t.direction+"\r\n":t.rtpSender&&t.rtpReceiver?"a=sendrecv\r\n":t.rtpSender?"a=sendonly\r\n":t.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",t.rtpSender){var o="msid:"+r.id+" "+t.rtpSender.track.id+"\r\n";s+="a="+o,s+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" "+o,t.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+t.sendEncodingParameters[0].rtx.ssrc+" "+o,s+="a=ssrc-group:FID "+t.sendEncodingParameters[0].ssrc+" "+t.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return s+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+"\r\n",t.rtpSender&&t.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+t.sendEncodingParameters[0].rtx.ssrc+" cname:"+n.localCName+"\r\n"),s},n.getDirection=function(t,e){for(var i=n.splitLines(t),r=0;r<i.length;r++)switch(i[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[r].substr(2)}return e?n.getDirection(e):"sendrecv"},n.getKind=function(t){return n.splitLines(t)[0].split(" ")[0].substr(2)},n.isRejected=function(t){return"0"===t.split(" ",2)[1]},n.parseMLine=function(t){var e=n.splitLines(t)[0].substr(2).split(" ");return{kind:e[0],port:parseInt(e[1],10),protocol:e[2],fmt:e.slice(3).join(" ")}},n.parseOLine=function(t){var e=n.matchPrefix(t,"o=")[0].substr(2).split(" ");return{username:e[0],sessionId:e[1],sessionVersion:parseInt(e[2],10),netType:e[3],addressType:e[4],address:e[5]}},n.isValidSDP=function(t){if("string"!=typeof t||0===t.length)return!1;for(var e=n.splitLines(t),i=0;i<e.length;i++)if(e[i].length<2||"="!==e[i].charAt(1))return!1;return!0},"object"==typeof e&&(e.exports=n)},{}],3:[function(t,i,n){(function(e){"use strict";var n=t("./adapter_factory.js");i.exports=n({window:e.window})}).call(this,void 0!==e?e:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./adapter_factory.js":4}],4:[function(t,e,i){"use strict";var n=t("./utils");e.exports=function(e,i){var r=e&&e.window,s={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(var o in i)hasOwnProperty.call(i,o)&&(s[o]=i[o]);var a=n.log,u=n.detectBrowser(r),c=t("./chrome/chrome_shim")||null,h=t("./edge/edge_shim")||null,f=t("./firefox/firefox_shim")||null,d=t("./safari/safari_shim")||null,l=t("./common_shim")||null,m={browserDetails:u,commonShim:l,extractVersion:n.extractVersion,disableLog:n.disableLog,disableWarnings:n.disableWarnings};switch(u.browser){case"chrome":if(!c||!c.shimPeerConnection||!s.shimChrome)return a("Chrome shim is not included in this adapter release."),m;a("adapter.js shimming chrome."),m.browserShim=c,l.shimCreateObjectURL(r),c.shimGetUserMedia(r),c.shimMediaStream(r),c.shimSourceObject(r),c.shimPeerConnection(r),c.shimOnTrack(r),c.shimAddTrackRemoveTrack(r),c.shimGetSendersWithDtmf(r),c.shimSenderReceiverGetStats(r),c.fixNegotiationNeeded(r),l.shimRTCIceCandidate(r),l.shimMaxMessageSize(r),l.shimSendThrowTypeError(r);break;case"firefox":if(!f||!f.shimPeerConnection||!s.shimFirefox)return a("Firefox shim is not included in this adapter release."),m;a("adapter.js shimming firefox."),m.browserShim=f,l.shimCreateObjectURL(r),f.shimGetUserMedia(r),f.shimSourceObject(r),f.shimPeerConnection(r),f.shimOnTrack(r),f.shimRemoveStream(r),f.shimSenderGetStats(r),f.shimReceiverGetStats(r),f.shimRTCDataChannel(r),l.shimRTCIceCandidate(r),l.shimMaxMessageSize(r),l.shimSendThrowTypeError(r);break;case"edge":if(!h||!h.shimPeerConnection||!s.shimEdge)return a("MS edge shim is not included in this adapter release."),m;a("adapter.js shimming edge."),m.browserShim=h,l.shimCreateObjectURL(r),h.shimGetUserMedia(r),h.shimPeerConnection(r),h.shimReplaceTrack(r),l.shimMaxMessageSize(r),l.shimSendThrowTypeError(r);break;case"safari":if(!d||!s.shimSafari)return a("Safari shim is not included in this adapter release."),m;a("adapter.js shimming safari."),m.browserShim=d,l.shimCreateObjectURL(r),d.shimRTCIceServerUrls(r),d.shimCreateOfferLegacy(r),d.shimCallbacksAPI(r),d.shimLocalStreamsAPI(r),d.shimRemoteStreamsAPI(r),d.shimTrackEventTransceiver(r),d.shimGetUserMedia(r),l.shimRTCIceCandidate(r),l.shimMaxMessageSize(r),l.shimSendThrowTypeError(r);break;default:a("Unsupported browser!")}return m}},{"./chrome/chrome_shim":5,"./common_shim":7,"./edge/edge_shim":8,"./firefox/firefox_shim":11,"./safari/safari_shim":13,"./utils":14}],5:[function(t,e,i){"use strict";function n(t,e,i){var n=i?"outbound-rtp":"inbound-rtp",r=new Map;if(null===e)return r;var s=[];return t.forEach(function(t){"track"===t.type&&t.trackIdentifier===e.id&&s.push(t)}),s.forEach(function(e){t.forEach(function(i){i.type===n&&i.trackId===e.id&&function t(e,i,n){i&&!n.has(i.id)&&(n.set(i.id,i),Object.keys(i).forEach(function(r){r.endsWith("Id")?t(e,e.get(i[r]),n):r.endsWith("Ids")&&i[r].forEach(function(i){t(e,e.get(i),n)})}))}(t,i,r)})}),r}var r=t("../utils.js"),s=r.log;e.exports={shimGetUserMedia:t("./getusermedia"),shimMediaStream:function(t){t.MediaStream=t.MediaStream||t.webkitMediaStream},shimOnTrack:function(t){if("object"!=typeof t||!t.RTCPeerConnection||"ontrack"in t.RTCPeerConnection.prototype)"RTCRtpTransceiver"in t||r.wrapPeerConnectionEvent(t,"track",function(t){return t.transceiver||(t.transceiver={receiver:t.receiver}),t});else{Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get:function(){return this.J},set:function(t){this.J&&this.removeEventListener("track",this.J),this.addEventListener("track",this.J=t)},enumerable:!0,configurable:!0});var e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){var i=this;return i.K||(i.K=function(e){e.stream.addEventListener("addtrack",function(n){var r;r=t.RTCPeerConnection.prototype.getReceivers?i.getReceivers().find(function(t){return t.track&&t.track.id===n.track.id}):{track:n.track};var s=new Event("track");s.track=n.track,s.receiver=r,s.transceiver={receiver:r},s.streams=[e.stream],i.dispatchEvent(s)}),e.stream.getTracks().forEach(function(n){var r;r=t.RTCPeerConnection.prototype.getReceivers?i.getReceivers().find(function(t){return t.track&&t.track.id===n.id}):{track:n};var s=new Event("track");s.track=n,s.receiver=r,s.transceiver={receiver:r},s.streams=[e.stream],i.dispatchEvent(s)})},i.addEventListener("addstream",i.K)),e.apply(i,arguments)}}},shimGetSendersWithDtmf:function(t){if("object"==typeof t&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){var e=function(t,e){return{track:e,get dtmf(){return void 0===this.X&&("audio"===e.kind?this.X=t.createDTMFSender(e):this.X=null),this.X},Q:t}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this.$=this.$||[],this.$.slice()};var i=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(t,n){var r=this,s=i.apply(r,arguments);return s||(s=e(r,t),r.$.push(s)),s};var n=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(t){var e=this;n.apply(e,arguments);var i=e.$.indexOf(t);-1!==i&&e.$.splice(i,1)}}var r=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(t){var i=this;i.$=i.$||[],r.apply(i,[t]),t.getTracks().forEach(function(t){i.$.push(e(i,t))})};var s=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(t){var e=this;e.$=e.$||[],s.apply(e,[t]),t.getTracks().forEach(function(t){var i=e.$.find(function(e){return e.track===t});i&&e.$.splice(e.$.indexOf(i),1)})}}else if("object"==typeof t&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){var o=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){var t=this,e=o.apply(t,[]);return e.forEach(function(e){e.Q=t}),e},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this.X&&("audio"===this.track.kind?this.X=this.Q.createDTMFSender(this.track):this.X=null),this.X}})}},shimSenderReceiverGetStats:function(t){if("object"==typeof t&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver){if(!("getStats"in t.RTCRtpSender.prototype)){var e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){var t=this,i=e.apply(t,[]);return i.forEach(function(e){e.Q=t}),i});var i=t.RTCPeerConnection.prototype.addTrack;i&&(t.RTCPeerConnection.prototype.addTrack=function(){var t=i.apply(this,arguments);return t.Q=this,t}),t.RTCRtpSender.prototype.getStats=function(){var t=this;return this.Q.getStats().then(function(e){return n(e,t.track,!0)})}}if(!("getStats"in t.RTCRtpReceiver.prototype)){var s=t.RTCPeerConnection.prototype.getReceivers;s&&(t.RTCPeerConnection.prototype.getReceivers=function(){var t=this,e=s.apply(t,[]);return e.forEach(function(e){e.Q=t}),e}),r.wrapPeerConnectionEvent(t,"track",function(t){return t.receiver.Q=t.srcElement,t}),t.RTCRtpReceiver.prototype.getStats=function(){var t=this;return this.Q.getStats().then(function(e){return n(e,t.track,!1)})}}if("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype){var o=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){var e=this;if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){var i,n,r,s=arguments[0];return e.getSenders().forEach(function(t){t.track===s&&(i?r=!0:i=t)}),e.getReceivers().forEach(function(t){return t.track===s&&(n?r=!0:n=t),t.track===s}),r||i&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return o.apply(e,arguments)}}}},shimSourceObject:function(t){var e=t&&t.URL;"object"==typeof t&&(!t.HTMLMediaElement||"srcObject"in t.HTMLMediaElement.prototype||Object.defineProperty(t.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.Y},set:function(t){var i=this;return this.Y=t,this.src&&e.revokeObjectURL(this.src),t?(this.src=e.createObjectURL(t),t.addEventListener("addtrack",function(){i.src&&e.revokeObjectURL(i.src),i.src=e.createObjectURL(t)}),void t.addEventListener("removetrack",function(){i.src&&e.revokeObjectURL(i.src),i.src=e.createObjectURL(t)})):void(this.src="")}}))},shimAddTrackRemoveTrackWithNative:function(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){var t=this;return this.Z=this.Z||{},Object.keys(this.Z).map(function(e){return t.Z[e][0]})};var e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(t,i){if(!i)return e.apply(this,arguments);this.Z=this.Z||{};var n=e.apply(this,arguments);return this.Z[i.id]?-1===this.Z[i.id].indexOf(n)&&this.Z[i.id].push(n):this.Z[i.id]=[i,n],n};var i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(t){var e=this;this.Z=this.Z||{},t.getTracks().forEach(function(t){if(e.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError")});var n=e.getSenders();i.apply(this,arguments);var r=e.getSenders().filter(function(t){return-1===n.indexOf(t)});this.Z[t.id]=[t].concat(r)};var n=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(t){return this.Z=this.Z||{},delete this.Z[t.id],n.apply(this,arguments)};var r=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(t){var e=this;return this.Z=this.Z||{},t&&Object.keys(this.Z).forEach(function(i){var n=e.Z[i].indexOf(t);-1!==n&&e.Z[i].splice(n,1),1===e.Z[i].length&&delete e.Z[i]}),r.apply(this,arguments)}},shimAddTrackRemoveTrack:function(t){function e(t,e){var i=e.sdp;return Object.keys(t.tt||[]).forEach(function(e){var n=t.tt[e],r=t.et[n.id];i=i.replace(new RegExp(r.id,"g"),n.id)}),new RTCSessionDescription({type:e.type,sdp:i})}var i=r.detectBrowser(t);if(t.RTCPeerConnection.prototype.addTrack&&i.version>=65)return this.shimAddTrackRemoveTrackWithNative(t);var n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){var t=this,e=n.apply(this);return t.tt=t.tt||{},e.map(function(e){return t.tt[e.id]})};var s=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(e){var i=this;if(i.et=i.et||{},i.tt=i.tt||{},e.getTracks().forEach(function(t){if(i.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError")}),!i.tt[e.id]){var n=new t.MediaStream(e.getTracks());i.et[e.id]=n,i.tt[n.id]=e,e=n}s.apply(i,[e])};var o=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(t){var e=this;e.et=e.et||{},e.tt=e.tt||{},o.apply(e,[e.et[t.id]||t]),delete e.tt[e.et[t.id]?e.et[t.id].id:t.id],delete e.et[t.id]},t.RTCPeerConnection.prototype.addTrack=function(e,i){var n=this;if("closed"===n.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var r=[].slice.call(arguments,1);if(1!==r.length||!r[0].getTracks().find(function(t){return t===e}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(n.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError");n.et=n.et||{},n.tt=n.tt||{};var s=n.et[i.id];if(s)s.addTrack(e),Promise.resolve().then(function(){n.dispatchEvent(new Event("negotiationneeded"))});else{var o=new t.MediaStream([e]);n.et[i.id]=o,n.tt[o.id]=i,n.addStream(o)}return n.getSenders().find(function(t){return t.track===e})},["createOffer","createAnswer"].forEach(function(i){var n=t.RTCPeerConnection.prototype[i];t.RTCPeerConnection.prototype[i]=function(){var t=this,i=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(t,[function(n){var r=e(t,n);i[0].apply(null,[r])},function(t){i[1]&&i[1].apply(null,t)},arguments[2]]):n.apply(t,arguments).then(function(i){return e(t,i)})}});var a=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){var t=this;return arguments.length&&arguments[0].type?(arguments[0]=function(t,e){var i=e.sdp;return Object.keys(t.tt||[]).forEach(function(e){var n=t.tt[e],r=t.et[n.id];i=i.replace(new RegExp(n.id,"g"),r.id)}),new RTCSessionDescription({type:e.type,sdp:i})}(t,arguments[0]),a.apply(t,arguments)):a.apply(t,arguments)};var u=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get:function(){var t=u.get.apply(this);return""===t.type?t:e(this,t)}}),t.RTCPeerConnection.prototype.removeTrack=function(t){var e,i=this;if("closed"===i.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!t.Q)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(t.Q===i))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");i.et=i.et||{},Object.keys(i.et).forEach(function(n){i.et[n].getTracks().find(function(e){return t.track===e})&&(e=i.et[n])}),e&&(1===e.getTracks().length?i.removeStream(i.tt[e.id]):e.removeTrack(t.track),i.dispatchEvent(new Event("negotiationneeded")))}},shimPeerConnection:function(t){var e=r.detectBrowser(t);if(!t.RTCPeerConnection&&t.webkitRTCPeerConnection)t.RTCPeerConnection=function(e,i){return s("PeerConnection"),e&&e.iceTransportPolicy&&(e.iceTransports=e.iceTransportPolicy),new t.webkitRTCPeerConnection(e,i)},t.RTCPeerConnection.prototype=t.webkitRTCPeerConnection.prototype,t.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:function(){return t.webkitRTCPeerConnection.generateCertificate}});else{var i=t.RTCPeerConnection;t.RTCPeerConnection=function(t,e){if(t&&t.iceServers){for(var n=[],s=0;s<t.iceServers.length;s++){var o=t.iceServers[s];!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")?(r.deprecated("RTCIceServer.url","RTCIceServer.urls"),(o=JSON.parse(JSON.stringify(o))).urls=o.url,n.push(o)):n.push(t.iceServers[s])}t.iceServers=n}return new i(t,e)},t.RTCPeerConnection.prototype=i.prototype,Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:function(){return i.generateCertificate}})}var n=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(t,e,i){var r=this,s=arguments;if(arguments.length>0&&"function"==typeof t)return n.apply(this,arguments);if(0===n.length&&(0===arguments.length||"function"!=typeof arguments[0]))return n.apply(this,[]);var o=function(t){var e={};return t.result().forEach(function(t){var i={id:t.id,timestamp:t.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[t.type]||t.type};t.names().forEach(function(e){i[e]=t.stat(e)}),e[i.id]=i}),e},a=function(t){return new Map(Object.keys(t).map(function(e){return[e,t[e]]}))};return arguments.length>=2?n.apply(this,[function(t){s[1](a(o(t)))},arguments[0]]):new Promise(function(t,e){n.apply(r,[function(e){t(a(o(e)))},e])}).then(e,i)},e.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var i=t.RTCPeerConnection.prototype[e];t.RTCPeerConnection.prototype[e]=function(){var t=arguments,e=this,n=new Promise(function(n,r){i.apply(e,[t[0],n,r])});return t.length<2?n:n.then(function(){t[1].apply(null,[])},function(e){t.length>=3&&t[2].apply(null,[e])})}}),e.version<52&&["createOffer","createAnswer"].forEach(function(e){var i=t.RTCPeerConnection.prototype[e];t.RTCPeerConnection.prototype[e]=function(){var t=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var e=1===arguments.length?arguments[0]:void 0;return new Promise(function(n,r){i.apply(t,[n,r,e])})}return i.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var i=t.RTCPeerConnection.prototype[e];t.RTCPeerConnection.prototype[e]=function(){return arguments[0]=new("addIceCandidate"===e?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}});var o=t.RTCPeerConnection.prototype.addIceCandidate;t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?o.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}},fixNegotiationNeeded:function(t){r.wrapPeerConnectionEvent(t,"negotiationneeded",function(t){if("stable"===t.target.signalingState)return t})},shimGetDisplayMedia:function(t,e){if(!("getDisplayMedia"in t.navigator))return"function"!=typeof e?void console.error("shimGetDisplayMedia: getSourceId argument is not a function"):void(navigator.getDisplayMedia=function(t){return e(t).then(function(e){return t.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxFrameRate:t.video.frameRate||3}},navigator.mediaDevices.getUserMedia(t)})})}}},{"../utils.js":14,"./getusermedia":6}],6:[function(t,e,i){"use strict";var n=t("../utils.js"),r=n.log;e.exports=function(t){var e=n.detectBrowser(t),i=t&&t.navigator,s=function(t){if("object"!=typeof t||t.mandatory||t.optional)return t;var e={};return Object.keys(t).forEach(function(i){if("require"!==i&&"advanced"!==i&&"mediaSource"!==i){var n="object"==typeof t[i]?t[i]:{ideal:t[i]};void 0!==n.exact&&"number"==typeof n.exact&&(n.min=n.max=n.exact);var r=function(t,e){return t?t+e.charAt(0).toUpperCase()+e.slice(1):"deviceId"===e?"sourceId":e};if(void 0!==n.ideal){e.optional=e.optional||[];var s={};"number"==typeof n.ideal?(s[r("min",i)]=n.ideal,e.optional.push(s),(s={})[r("max",i)]=n.ideal,e.optional.push(s)):(s[r("",i)]=n.ideal,e.optional.push(s))}void 0!==n.exact&&"number"!=typeof n.exact?(e.mandatory=e.mandatory||{},e.mandatory[r("",i)]=n.exact):["min","max"].forEach(function(t){void 0!==n[t]&&(e.mandatory=e.mandatory||{},e.mandatory[r(t,i)]=n[t])})}}),t.advanced&&(e.optional=(e.optional||[]).concat(t.advanced)),e},o=function(t,n){if(e.version>=61)return n(t);if((t=JSON.parse(JSON.stringify(t)))&&"object"==typeof t.audio){var o=function(t,e,i){e in t&&!(i in t)&&(t[i]=t[e],delete t[e])};o((t=JSON.parse(JSON.stringify(t))).audio,"autoGainControl","googAutoGainControl"),o(t.audio,"noiseSuppression","googNoiseSuppression"),t.audio=s(t.audio)}if(t&&"object"==typeof t.video){var a=t.video.facingMode;a=a&&("object"==typeof a?a:{ideal:a});var u,c=e.version<66;if(a&&("user"===a.exact||"environment"===a.exact||"user"===a.ideal||"environment"===a.ideal)&&(!i.mediaDevices.getSupportedConstraints||!i.mediaDevices.getSupportedConstraints().facingMode||c)&&(delete t.video.facingMode,"environment"===a.exact||"environment"===a.ideal?u=["back","rear"]:"user"!==a.exact&&"user"!==a.ideal||(u=["front"]),u))return i.mediaDevices.enumerateDevices().then(function(e){var i=(e=e.filter(function(t){return"videoinput"===t.kind})).find(function(t){return u.some(function(e){return-1!==t.label.toLowerCase().indexOf(e)})});return!i&&e.length&&-1!==u.indexOf("back")&&(i=e[e.length-1]),i&&(t.video.deviceId=a.exact?{exact:i.deviceId}:{ideal:i.deviceId}),t.video=s(t.video),r("chrome: "+JSON.stringify(t)),n(t)});t.video=s(t.video)}return r("chrome: "+JSON.stringify(t)),n(t)},a=function(t){return e.version>=64?t:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[t.name]||t.name,message:t.message,constraint:t.constraint||t.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};i.getUserMedia=function(t,e,n){o(t,function(t){i.webkitGetUserMedia(t,e,function(t){n&&n(a(t))})})};var u=function(t){return new Promise(function(e,n){i.getUserMedia(t,e,n)})};if(i.mediaDevices||(i.mediaDevices={getUserMedia:u,enumerateDevices:function(){return new Promise(function(e){var i={audio:"audioinput",video:"videoinput"};return t.MediaStreamTrack.getSources(function(t){e(t.map(function(t){return{label:t.label,kind:i[t.kind],deviceId:t.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),i.mediaDevices.getUserMedia){var c=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(t){return o(t,function(t){return c(t).then(function(e){if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(function(t){t.stop()}),new DOMException("","NotFoundError");return e},function(t){return Promise.reject(a(t))})})}}else i.mediaDevices.getUserMedia=function(t){return u(t)};void 0===i.mediaDevices.addEventListener&&(i.mediaDevices.addEventListener=function(){r("Dummy mediaDevices.addEventListener called.")}),void 0===i.mediaDevices.removeEventListener&&(i.mediaDevices.removeEventListener=function(){r("Dummy mediaDevices.removeEventListener called.")})}},{"../utils.js":14}],7:[function(t,e,i){"use strict";var n=t("sdp"),r=t("./utils");e.exports={shimRTCIceCandidate:function(t){if(t.RTCIceCandidate&&!(t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)){var e=t.RTCIceCandidate;t.RTCIceCandidate=function(t){if("object"==typeof t&&t.candidate&&0===t.candidate.indexOf("a=")&&((t=JSON.parse(JSON.stringify(t))).candidate=t.candidate.substr(2)),t.candidate&&t.candidate.length){var i=new e(t),r=n.parseCandidate(t.candidate),s=Object.assign(i,r);return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new e(t)},t.RTCIceCandidate.prototype=e.prototype,r.wrapPeerConnectionEvent(t,"icecandidate",function(e){return e.candidate&&Object.defineProperty(e,"candidate",{value:new t.RTCIceCandidate(e.candidate),writable:"false"}),e})}},shimCreateObjectURL:function(t){var e=t&&t.URL;if("object"==typeof t&&t.HTMLMediaElement&&"srcObject"in t.HTMLMediaElement.prototype&&e.createObjectURL&&e.revokeObjectURL){var i=e.createObjectURL.bind(e),n=e.revokeObjectURL.bind(e),s=new Map,o=0;e.createObjectURL=function(t){if("getTracks"in t){var e="polyblob:"+ ++o;return s.set(e,t),r.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream"),e}return i(t)},e.revokeObjectURL=function(t){n(t),s.delete(t)};var a=Object.getOwnPropertyDescriptor(t.HTMLMediaElement.prototype,"src");Object.defineProperty(t.HTMLMediaElement.prototype,"src",{get:function(){return a.get.apply(this)},set:function(t){return this.srcObject=s.get(t)||null,a.set.apply(this,[t])}});var u=t.HTMLMediaElement.prototype.setAttribute;t.HTMLMediaElement.prototype.setAttribute=function(){return 2===arguments.length&&"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=s.get(arguments[1])||null),u.apply(this,arguments)}}},shimMaxMessageSize:function(t){if(!t.RTCSctpTransport&&t.RTCPeerConnection){var e=r.detectBrowser(t);"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this.it?null:this.it}});var i=function(t){var e=n.splitSections(t.sdp);return e.shift(),e.some(function(t){var e=n.parseMLine(t);return e&&"application"===e.kind&&-1!==e.protocol.indexOf("SCTP")})},s=function(t){var i=65536;return"firefox"===e.browser&&(i=e.version<57?-1===t?16384:2147483637:e.version<60?57===e.version?65535:65536:2147483637),i},o=function(t,i){var r=65536;"firefox"===e.browser&&57===e.version&&(r=65535);var s=n.matchPrefix(t.sdp,"a=max-message-size:");return s.length>0?r=parseInt(s[0].substr(19),10):"firefox"===e.browser&&-1!==i&&(r=2147483637),r},a=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){var t=this;if(t.it=null,i(arguments[0])){var e,n=function(t){var e=t.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===e||e.length<2)return-1;var i=parseInt(e[1],10);return i!=i?-1:i}(arguments[0]),r=s(n),u=o(arguments[0],n);e=0===r&&0===u?Number.POSITIVE_INFINITY:0===r||0===u?Math.max(r,u):Math.min(r,u);var c={};Object.defineProperty(c,"maxMessageSize",{get:function(){return e}}),t.it=c}return a.apply(t,arguments)}}},shimSendThrowTypeError:function(t){function e(t,e){var i=t.send;t.send=function(){var n=arguments[0],r=n.length||n.size||n.byteLength;if("open"===t.readyState&&e.sctp&&r>e.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+e.sctp.maxMessageSize+" bytes)");return i.apply(t,arguments)}}if(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype){var i=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){var t=i.apply(this,arguments);return e(t,this),t},r.wrapPeerConnectionEvent(t,"datachannel",function(t){return e(t.channel,t.target),t})}}}},{"./utils":14,sdp:2}],8:[function(t,e,i){"use strict";var n=t("../utils"),r=t("./filtericeservers"),s=t("rtcpeerconnection-shim");e.exports={shimGetUserMedia:t("./getusermedia"),shimPeerConnection:function(t){var e=n.detectBrowser(t);if(t.RTCIceGatherer&&(t.RTCIceCandidate||(t.RTCIceCandidate=function(t){return t}),t.RTCSessionDescription||(t.RTCSessionDescription=function(t){return t}),e.version<15025)){var i=Object.getOwnPropertyDescriptor(t.MediaStreamTrack.prototype,"enabled");Object.defineProperty(t.MediaStreamTrack.prototype,"enabled",{set:function(t){i.set.call(this,t);var e=new Event("enabled");e.enabled=t,this.dispatchEvent(e)}})}!t.RTCRtpSender||"dtmf"in t.RTCRtpSender.prototype||Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this.X&&("audio"===this.track.kind?this.X=new t.RTCDtmfSender(this):"video"===this.track.kind&&(this.X=null)),this.X}}),t.RTCDtmfSender&&!t.RTCDTMFSender&&(t.RTCDTMFSender=t.RTCDtmfSender);var o=s(t,e.version);t.RTCPeerConnection=function(t){return t&&t.iceServers&&(t.iceServers=r(t.iceServers)),new o(t)},t.RTCPeerConnection.prototype=o.prototype},shimReplaceTrack:function(t){!t.RTCRtpSender||"replaceTrack"in t.RTCRtpSender.prototype||(t.RTCRtpSender.prototype.replaceTrack=t.RTCRtpSender.prototype.setTrack)}}},{"../utils":14,"./filtericeservers":9,"./getusermedia":10,"rtcpeerconnection-shim":1}],9:[function(t,e,i){"use strict";var n=t("../utils");e.exports=function(t,e){var i=!1;return(t=JSON.parse(JSON.stringify(t))).filter(function(t){if(t&&(t.urls||t.url)){var r=t.urls||t.url;t.url&&!t.urls&&n.deprecated("RTCIceServer.url","RTCIceServer.urls");var s="string"==typeof r;return s&&(r=[r]),r=r.filter(function(t){return 0===t.indexOf("turn:")&&-1!==t.indexOf("transport=udp")&&-1===t.indexOf("turn:[")&&!i?(i=!0,!0):0===t.indexOf("stun:")&&e>=14393&&-1===t.indexOf("?transport=udp")}),delete t.url,t.urls=s?r[0]:r,!!r.length}})}},{"../utils":14}],10:[function(t,e,i){"use strict";e.exports=function(t){var e=t&&t.navigator,i=e.mediaDevices.getUserMedia.bind(e.mediaDevices);e.mediaDevices.getUserMedia=function(t){return i(t).catch(function(t){return Promise.reject(function(t){return{name:{PermissionDeniedError:"NotAllowedError"}[t.name]||t.name,message:t.message,constraint:t.constraint,toString:function(){return this.name}}}(t))})}}},{}],11:[function(t,e,i){"use strict";var n=t("../utils");e.exports={shimGetUserMedia:t("./getusermedia"),shimOnTrack:function(t){"object"!=typeof t||!t.RTCPeerConnection||"ontrack"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get:function(){return this.J},set:function(t){this.J&&(this.removeEventListener("track",this.J),this.removeEventListener("addstream",this.K)),this.addEventListener("track",this.J=t),this.addEventListener("addstream",this.K=function(t){t.stream.getTracks().forEach(function(e){var i=new Event("track");i.track=e,i.receiver={track:e},i.transceiver={receiver:i.receiver},i.streams=[t.stream],this.dispatchEvent(i)}.bind(this))}.bind(this))},enumerable:!0,configurable:!0}),"object"==typeof t&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimSourceObject:function(t){"object"==typeof t&&(!t.HTMLMediaElement||"srcObject"in t.HTMLMediaElement.prototype||Object.defineProperty(t.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(t){this.mozSrcObject=t}}))},shimPeerConnection:function(t){var e=n.detectBrowser(t);if("object"==typeof t&&(t.RTCPeerConnection||t.mozRTCPeerConnection)){t.RTCPeerConnection||(t.RTCPeerConnection=function(i,n){if(e.version<38&&i&&i.iceServers){for(var r=[],s=0;s<i.iceServers.length;s++){var o=i.iceServers[s];if(o.hasOwnProperty("urls"))for(var a=0;a<o.urls.length;a++){var u={url:o.urls[a]};0===o.urls[a].indexOf("turn")&&(u.username=o.username,u.credential=o.credential),r.push(u)}else r.push(i.iceServers[s])}i.iceServers=r}return new t.mozRTCPeerConnection(i,n)},t.RTCPeerConnection.prototype=t.mozRTCPeerConnection.prototype,t.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:function(){return t.mozRTCPeerConnection.generateCertificate}}),t.RTCSessionDescription=t.mozRTCSessionDescription,t.RTCIceCandidate=t.mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var i=t.RTCPeerConnection.prototype[e];t.RTCPeerConnection.prototype[e]=function(){return arguments[0]=new("addIceCandidate"===e?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}});var i=t.RTCPeerConnection.prototype.addIceCandidate;t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},s=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(t,i,n){return s.apply(this,[t||null]).then(function(t){if(e.version<48&&(t=function(t){var e=new Map;return Object.keys(t).forEach(function(i){e.set(i,t[i]),e[i]=t[i]}),e}(t)),e.version<53&&!i)try{t.forEach(function(t){t.type=r[t.type]||t.type})}catch(e){if("TypeError"!==e.name)throw e;t.forEach(function(e,i){t.set(i,Object.assign({},e,{type:r[e.type]||e.type}))})}return t}).then(i,n)}}},shimSenderGetStats:function(t){if("object"==typeof t&&t.RTCPeerConnection&&t.RTCRtpSender&&!(t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)){var e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){var t=this,i=e.apply(t,[]);return i.forEach(function(e){e.Q=t}),i});var i=t.RTCPeerConnection.prototype.addTrack;i&&(t.RTCPeerConnection.prototype.addTrack=function(){var t=i.apply(this,arguments);return t.Q=this,t}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this.Q.getStats(this.track):Promise.resolve(new Map)}}},shimReceiverGetStats:function(t){if("object"==typeof t&&t.RTCPeerConnection&&t.RTCRtpSender&&!(t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)){var e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){var t=this,i=e.apply(t,[]);return i.forEach(function(e){e.Q=t}),i}),n.wrapPeerConnectionEvent(t,"track",function(t){return t.receiver.Q=t.srcElement,t}),t.RTCRtpReceiver.prototype.getStats=function(){return this.Q.getStats(this.track)}}},shimRemoveStream:function(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(t){var e=this;n.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(i){i.track&&-1!==t.getTracks().indexOf(i.track)&&e.removeTrack(i)})})},shimRTCDataChannel:function(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)},shimGetDisplayMedia:function(t,e){"getDisplayMedia"in t.navigator||(navigator.getDisplayMedia=function(t){if(!t||!t.video){var i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Promise.reject(i)}return!0===t.video?t.video={mediaSource:e}:t.video.mediaSource=e,navigator.mediaDevices.getUserMedia(t)})}}},{"../utils":14,"./getusermedia":12}],12:[function(t,e,i){"use strict";var n=t("../utils"),r=n.log;e.exports=function(t){var e=n.detectBrowser(t),i=t&&t.navigator,s=t&&t.MediaStreamTrack,o=function(t){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[t.name]||t.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[t.message]||t.message,constraint:t.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},a=function(t,n,s){var a=function(t){if("object"!=typeof t||t.require)return t;var e=[];return Object.keys(t).forEach(function(i){if("require"!==i&&"advanced"!==i&&"mediaSource"!==i){var n=t[i]="object"==typeof t[i]?t[i]:{ideal:t[i]};if(void 0===n.min&&void 0===n.max&&void 0===n.exact||e.push(i),void 0!==n.exact&&("number"==typeof n.exact?n.min=n.max=n.exact:t[i]=n.exact,delete n.exact),void 0!==n.ideal){t.advanced=t.advanced||[];var r={};"number"==typeof n.ideal?r[i]={min:n.ideal,max:n.ideal}:r[i]=n.ideal,t.advanced.push(r),delete n.ideal,Object.keys(n).length||delete t[i]}}}),e.length&&(t.require=e),t};return t=JSON.parse(JSON.stringify(t)),e.version<38&&(r("spec: "+JSON.stringify(t)),t.audio&&(t.audio=a(t.audio)),t.video&&(t.video=a(t.video)),r("ff37: "+JSON.stringify(t))),i.mozGetUserMedia(t,n,function(t){s(o(t))})};if(i.mediaDevices||(i.mediaDevices={getUserMedia:function(t){return new Promise(function(e,i){a(t,e,i)})},addEventListener:function(){},removeEventListener:function(){}}),i.mediaDevices.enumerateDevices=i.mediaDevices.enumerateDevices||function(){return new Promise(function(t){t([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},e.version<41){var u=i.mediaDevices.enumerateDevices.bind(i.mediaDevices);i.mediaDevices.enumerateDevices=function(){return u().then(void 0,function(t){if("NotFoundError"===t.name)return[];throw t})}}if(e.version<49){var c=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(t){return c(t).then(function(e){if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(function(t){t.stop()}),new DOMException("The object can not be found here.","NotFoundError");return e},function(t){return Promise.reject(o(t))})}}if(!(e.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){var h=function(t,e,i){e in t&&!(i in t)&&(t[i]=t[e],delete t[e])},f=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(t){return"object"==typeof t&&"object"==typeof t.audio&&(t=JSON.parse(JSON.stringify(t)),h(t.audio,"autoGainControl","mozAutoGainControl"),h(t.audio,"noiseSuppression","mozNoiseSuppression")),f(t)},s&&s.prototype.getSettings){var d=s.prototype.getSettings;s.prototype.getSettings=function(){var t=d.apply(this,arguments);return h(t,"mozAutoGainControl","autoGainControl"),h(t,"mozNoiseSuppression","noiseSuppression"),t}}if(s&&s.prototype.applyConstraints){var l=s.prototype.applyConstraints;s.prototype.applyConstraints=function(t){return"audio"===this.kind&&"object"==typeof t&&(t=JSON.parse(JSON.stringify(t)),h(t,"autoGainControl","mozAutoGainControl"),h(t,"noiseSuppression","mozNoiseSuppression")),l.apply(this,[t])}}}i.getUserMedia=function(t,r,s){return e.version<44?a(t,r,s):(n.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),void i.mediaDevices.getUserMedia(t).then(r,s))}}},{"../utils":14}],13:[function(t,e,i){"use strict";var n=t("../utils");e.exports={shimLocalStreamsAPI:function(t){if("object"==typeof t&&t.RTCPeerConnection){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this.nt||(this.nt=[]),this.nt}),"getStreamById"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getStreamById=function(t){var e=null;return this.nt&&this.nt.forEach(function(i){i.id===t&&(e=i)}),this.rt&&this.rt.forEach(function(i){i.id===t&&(e=i)}),e}),!("addStream"in t.RTCPeerConnection.prototype)){var e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(t){this.nt||(this.nt=[]),-1===this.nt.indexOf(t)&&this.nt.push(t);var i=this;t.getTracks().forEach(function(n){e.call(i,n,t)})},t.RTCPeerConnection.prototype.addTrack=function(t,i){return i&&(this.nt?-1===this.nt.indexOf(i)&&this.nt.push(i):this.nt=[i]),e.call(this,t,i)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(t){this.nt||(this.nt=[]);var e=this.nt.indexOf(t);if(-1!==e){this.nt.splice(e,1);var i=this,n=t.getTracks();this.getSenders().forEach(function(t){-1!==n.indexOf(t.track)&&i.removeTrack(t)})}})}},shimRemoteStreamsAPI:function(t){if("object"==typeof t&&t.RTCPeerConnection&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this.rt?this.rt:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this.st},set:function(t){this.st&&this.removeEventListener("addstream",this.st),this.addEventListener("addstream",this.st=t)}});var e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){var t=this;return this.ot||this.addEventListener("track",this.ot=function(e){e.streams.forEach(function(e){if(t.rt||(t.rt=[]),!(t.rt.indexOf(e)>=0)){t.rt.push(e);var i=new Event("addstream");i.stream=e,t.dispatchEvent(i)}})}),e.apply(t,arguments)}}},shimCallbacksAPI:function(t){if("object"==typeof t&&t.RTCPeerConnection){var e=t.RTCPeerConnection.prototype,i=e.createOffer,n=e.createAnswer,r=e.setLocalDescription,s=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(t,e){var n=arguments.length>=2?arguments[2]:arguments[0],r=i.apply(this,[n]);return e?(r.then(t,e),Promise.resolve()):r},e.createAnswer=function(t,e){var i=arguments.length>=2?arguments[2]:arguments[0],r=n.apply(this,[i]);return e?(r.then(t,e),Promise.resolve()):r};var a=function(t,e,i){var n=r.apply(this,[t]);return i?(n.then(e,i),Promise.resolve()):n};e.setLocalDescription=a,a=function(t,e,i){var n=s.apply(this,[t]);return i?(n.then(e,i),Promise.resolve()):n},e.setRemoteDescription=a,a=function(t,e,i){var n=o.apply(this,[t]);return i?(n.then(e,i),Promise.resolve()):n},e.addIceCandidate=a}},shimGetUserMedia:function(t){var e=t&&t.navigator;e.getUserMedia||(e.webkitGetUserMedia?e.getUserMedia=e.webkitGetUserMedia.bind(e):e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=function(t,i,n){e.mediaDevices.getUserMedia(t).then(i,n)}.bind(e)))},shimRTCIceServerUrls:function(t){var e=t.RTCPeerConnection;t.RTCPeerConnection=function(t,i){if(t&&t.iceServers){for(var r=[],s=0;s<t.iceServers.length;s++){var o=t.iceServers[s];!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")?(n.deprecated("RTCIceServer.url","RTCIceServer.urls"),(o=JSON.parse(JSON.stringify(o))).urls=o.url,delete o.url,r.push(o)):r.push(t.iceServers[s])}t.iceServers=r}return new e(t,i)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in t.RTCPeerConnection&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:function(){return e.generateCertificate}})},shimTrackEventTransceiver:function(t){"object"==typeof t&&t.RTCPeerConnection&&"receiver"in t.RTCTrackEvent.prototype&&!t.RTCTransceiver&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimCreateOfferLegacy:function(t){var e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(t){var i=this;if(t){void 0!==t.offerToReceiveAudio&&(t.offerToReceiveAudio=!!t.offerToReceiveAudio);var n=i.getTransceivers().find(function(t){return t.sender.track&&"audio"===t.sender.track.kind});!1===t.offerToReceiveAudio&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==t.offerToReceiveAudio||n||i.addTransceiver("audio"),void 0!==t.offerToReceiveVideo&&(t.offerToReceiveVideo=!!t.offerToReceiveVideo);var r=i.getTransceivers().find(function(t){return t.sender.track&&"video"===t.sender.track.kind});!1===t.offerToReceiveVideo&&r?"sendrecv"===r.direction?r.setDirection("sendonly"):"recvonly"===r.direction&&r.setDirection("inactive"):!0!==t.offerToReceiveVideo||r||i.addTransceiver("video")}return e.apply(i,arguments)}}}},{"../utils":14}],14:[function(t,e,i){"use strict";function n(t,e,i){var n=t.match(e);return n&&n.length>=i&&parseInt(n[i],10)}var r=!0,s=!0;e.exports={extractVersion:n,wrapPeerConnectionEvent:function(t,e,i){if(t.RTCPeerConnection){var n=t.RTCPeerConnection.prototype,r=n.addEventListener;n.addEventListener=function(t,n){if(t!==e)return r.apply(this,arguments);var s=function(t){var e=i(t);e&&n(e)};return this.at=this.at||{},this.at[n]=s,r.apply(this,[t,s])};var s=n.removeEventListener;n.removeEventListener=function(t,i){if(t!==e||!this.at||!this.at[i])return s.apply(this,arguments);var n=this.at[i];return delete this.at[i],s.apply(this,[t,n])},Object.defineProperty(n,"on"+e,{get:function(){return this["_on"+e]},set:function(t){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),t&&this.addEventListener(e,this["_on"+e]=t)},enumerable:!0,configurable:!0})}},disableLog:function(t){return"boolean"!=typeof t?new Error("Argument type: "+typeof t+". Please use a boolean."):(r=t,t?"adapter.js logging disabled":"adapter.js logging enabled")},disableWarnings:function(t){return"boolean"!=typeof t?new Error("Argument type: "+typeof t+". Please use a boolean."):(s=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))},log:function(){if("object"==typeof window){if(r)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},deprecated:function(t,e){s&&console.warn(t+" is deprecated, please use "+e+" instead.")},detectBrowser:function(t){var e=t&&t.navigator,i={browser:null,version:null};if(void 0===t||!t.navigator)return i.browser="Not a browser.",i;if(e.mozGetUserMedia)i.browser="firefox",i.version=n(e.userAgent,/Firefox\/(\d+)\./,1);else if(e.webkitGetUserMedia)i.browser="chrome",i.version=n(e.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(e.mediaDevices&&e.userAgent.match(/Edge\/(\d+).(\d+)$/))i.browser="edge",i.version=n(e.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!t.RTCPeerConnection||!e.userAgent.match(/AppleWebKit\/(\d+)\./))return i.browser="Not a supported browser.",i;i.browser="safari",i.version=n(e.userAgent,/AppleWebKit\/(\d+)\./,1)}return i}}},{}]},{},[3])(3)})}).call(e,i(5))},function(t,e,i){"use strict";var n,r;n=[i(9),i(10),i(3)],void 0===(r=function(t,e,i){return t.PhenixVideo=i,t.onLoaded=function(){e(t)},t.onLoaded(),t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(1),i(2),i(7),i(16),i(4),i(0)],void 0===(r=function(t,e,i,n,r,s){"use strict";function o(e,r,s){this.v=new i.DisposableList,this.f=new n.NamedEvents,this.ut="video"===e.tagName,this.ct=s.swfSrc,this.ht=e.id||s.streamId,this.ft=e.clientWidth,this.dt=e.clientHeight,this.t=e,this.lt=null,this.mt=[],this.pt=["uid="+this.ht,"autoplay="+(!!t.isUndefined(e.autoplay)||e.autoplay),"allowScriptAccess=always","preload=true","src="+JSON.stringify(r)];var o=this;this.v.add(new i.Disposable(function(){d.call(o,"fire_stop")}));try{this.lt=y||w?function(){return document.createElement("div")}.call(this):function(){var t=document.createElement("embed");return t.setAttribute("id","__"+this.ht),t.setAttribute("name","__"+this.ht),t.setAttribute("play","true"),t.setAttribute("loop","false"),t.setAttribute("quality","high"),t.setAttribute("bgcolor","#000000"),t.setAttribute("wmode","transparent"),t.setAttribute("allowScriptAccess","always"),t.setAttribute("allowFullScreen","true"),t.setAttribute("type","application/x-shockwave-flash"),t.setAttribute("pluginspage","//www.macromedia.com/go/getflashplayer"),t.setAttribute("src",this.ct),t.setAttribute("flashvars",this.pt.join("&")),this.ut&&(t.setAttribute("width",this.ft.toString()),t.setAttribute("height",this.dt.toString())),t}.call(this),c.call(this)}catch(t){m("Error while loading Flash Player"+t)}}function a(e,i){return t.findIndex(this.mt,function(t){return t.name===e&&t.listener===i})}function u(t,e){var i=document.createElement("param");return i.setAttribute("name",t),i.setAttribute("value",e),i}function c(){t.assign(this.lt,p,{id:this.ht,width:this.ft,height:this.dt,videoWidth:this.ft,videoHeight:this.dt}),function(){var e=this;s["__event__"+this.ht]=function(t,i){var n=function(t,e){var i=t.match(/([a-z]+\.([a-z]+))/i),n={target:e};if(null!==i&&(t=i[1],n.namespace=i[2]),"IE"===g.browser&&g.version>8){var r=s.document.createEvent("CustomEvent");return r.initCustomEvent(t,!1,!1,n),r}return s.CustomEvent?new s.CustomEvent(t,{detail:n}):n}(t,e.lt);if(i)try{n.data=JSON.parse(i),n.details.data=n.data}catch(t){n.message=i}switch(t){case"ended":break;case"error":e.lt.error=n.data,e.lt.dispatchEvent&&e.lt.dispatchEvent(n);break;case"loadeddata":case"loadedmetadata":case"loadstart":e.lt.dispatchEvent&&e.lt.dispatchEvent(n);break;case"pause":e.lt.paused=!0;break;case"play":case"playing":e.lt.paused=!1;break;case"progress":case"seeked":case"seeking":case"stalled":case"suspend":e.lt.dispatchEvent&&e.lt.dispatchEvent(n);break;case"timeupdate":e.lt.currentTime=f.call(e,"currentTime"),e.lt.dispatchEvent&&e.lt.dispatchEvent(n)}e.f.fireAsync(t,[n])};var n=this.lt.requestFullscreen||this.lt.mozRequestFullScreen||this.lt.webkitRequestFullScreen||this.lt.msRequestFullscreen;this.v.add(new i.Disposable(function(){delete s["__event__"+e.ht]})),this.lt.play=function(){d.call(e,"fire_play")},this.lt.load=function(){d.call(e,"fire_load")},this.lt.seek=function(){d.call(e,"fire_seek")},this.lt.pause=function(){d.call(e,"fire_pause")},this.lt.requestFullscreen=function(){if(e.vt=!0,function(){function t(){document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement||document.fullscreenElement||(document.removeEventListener("webkitfullscreenchange",t),document.removeEventListener("mozfullscreenchange",t),document.removeEventListener("fullscreenchange",t),document.removeEventListener("MSFullscreenChange",t),document.removeEventListener("keydown",e),i.vt=!1,i.lt.style.position=i.gt,i.lt.style.height=i.yt,i.lt.style.width=i.wt)}function e(e){var i=e||s.event;("key"in i?"Escape"===i.key||"Esc"===i.key:27===i.keyCode)&&t()}var i=this;document.addEventListener("webkitfullscreenchange",t,!1),document.addEventListener("mozfullscreenchange",t,!1),document.addEventListener("fullscreenchange",t,!1),document.addEventListener("MSFullscreenChange",t,!1),document.addEventListener("keydown",e,!1)}.call(e),e.yt=e.lt.style.height,e.wt=e.lt.style.width,e.gt=e.lt.style.position,e.lt.style.position="absolute",e.lt.style.height="100%",e.lt.style.width="100%",void 0!==s.ActiveXObject){var t=new s("WScript.Shell");null!==t&&t.SendKeys("{F11}")}n.call(e.lt)};var r=function(){d.call(e,"set_size",e.vt?screen.width:e.lt.clientWidth,e.vt?screen.height:e.lt.clientHeight)};t.addEventListener(s,"resize",r),this.v.add(new i.Disposable(function(){t.removeEventListener(s,"resize",r)}))}.call(this),function(){var e=this,n=["currentTime","paused","error","src"];if(t.get(s,["MutationObserver"])){var r=new MutationObserver(function(i){i.forEach(function(i){"attributes"!==i.type||i.target!==e.lt||t.includes(n,i.attributeName)||h.call(e,i.attributeName,e.lt[i.attributeName])})});r.observe(e.lt,{attributes:!0}),e.v.add(new i.Disposable(function(){r.disconnect()}))}else{l("Falling back to use of DOM event listeners. This results in degraded performance for further DOM modifications and does not work for IE prior to version 9. See https://developer.mozilla.org/en-US/docs/Web/Guide/Events/Mutation_events for details.");var o=function(i){t.includes(n,i.target.tagName)||h.call(e,i.target.tagName,e.lt[i.target.tagName])};e.lt.addEventListener?(e.lt.addEventListener("DOMAttrModified",o,!1),e.v.add(new i.Disposable(function(){e.lt.removeEventListener("DOMAttrModified",o,!1)}))):(e.lt.attachEvent("onpropertychange",o),e.v.add(new i.Disposable(function(){e.lt.detachEvent("DOMAttrModified",o)})))}}.call(this),function(){var t=function(){var t=this,e=t.t.muted,i=t.lt.muted;return function(){var n=t.lt.muted,r=t.lt.muted;n===e&&r===i||(n!==e&&(e=n,i=n,r=n),r!==i&&(e=n,i=n),t.lt.muted=r,t.t.muted=r,h.call(t,"muted",r))}}.call(this),e=function(){var t=this,e=t.t.volume,i=t.lt.volume;return function(){var n=t.lt.volume,r=t.lt.volume;n===e&&r===i||(n!==e&&(e=n,i=n,r=n),r!==i&&(e=n,i=n),t.lt.volume=r,t.t.volume=r,h.call(t,"volume",r))}}.call(this),n=setInterval(function(){t(),e()},v);this.v.add(new i.Disposable(function(){clearInterval(n)}))}.call(this)}function h(e,i){return(this.lt["set_"+e]||t.noop).call(this.lt,i)}function f(e){return(this.lt["get_"+e]||t.noop).call(this.lt)}function d(t){var e=this.lt[t];if([].shift.apply(arguments),e)return e.apply(this.lt,arguments)}var l=function(){console.log.apply(console,arguments)}||function(){},m=function(){console.error.apply(console,arguments)}||l,p={width:480,height:360,videoWidth:480,videoHeight:360,muted:!1,volume:1,currentTime:0,duration:1/0,readyState:0,ended:!1,buffered:null,autoplay:!0},v=300,g=new e(navigator.userAgent).detect(),y="IE"===g.browser&&/(trident|microsoft)/i.test(t.get(s.navigator,["appName"],"")),w="Edge"===g.browser&&t.get(s.navigator,"msLaunchUri")&&!t.get(s.document,"documentMode");return o.prototype.finishInitializationInDom=function(){return function(){if(!y&&!w)return this.lt;var e=(w?"__"+this.ht:this.ht)+t.uniqueId(),i=document.createElement("object"),n=document.createElement("div"),r=[u("movie",this.ct+"?x="+t.now()),u("flashvars",this.pt.join("&")),u("quality",2),u("bgcolor","#000000"),u("wmode","transparent"),u("allowScriptAccess","always"),u("allowFullScreen","true"),n];return n.innerHTML="You are using a browser that does not have Flash player enabled or installed. Please turn on your Flash player plugin or download the latest version from https://get.adobe.com/flashplayer/",w?(i.setAttribute("type","application/x-shockwave-flash"),i.setAttribute("data",this.ct),i.setAttribute("id",e),i.setAttribute("width","__"+this.ft.toString()),i.setAttribute("height","__"+this.dt.toString())):(i.setAttribute("classid","clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"),i.setAttribute("codebase","//download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab"),i.setAttribute("id",e),i.setAttribute("width",this.ft.toString()),i.setAttribute("height",this.dt.toString())),i.object?(t.forEach(r,function(e){t.isNullOrUndefined(t.get(i.object,[e.name]))||(i.object[e.name]=e.value)}),i.appendChild(n)):t.forEach(r,function(e){var n=t.find(i.children,function(t){return t.name===e.name});return n?i.replaceChild(e,n):i.appendChild(e)}),this.lt.outerHTML=i.outerHTML,s.document.getElementById&&(this.lt=s.document.getElementById(e),c.call(this)),this.lt}.call(this)},o.prototype.getElement=function(){return this.lt},o.prototype.addEventListener=function(t,e){if(!(a.call(this,t,e)>-1)){var i=this.f.listen(t,e);this.v.add(i),this.mt.push({name:t,listener:e,disposable:i})}},o.prototype.removeEventListener=function(t,e){var i=a.call(this,t,e);i>-1&&this.mt.splice(i,1)[0].disposable.dispose()},o.prototype.destroy=function(){this.v.dispose()},o}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(1),i(6),i(8),i(4),i(3)],void 0===(r=function(t,e,i,n,r){"use strict";function s(){var t=this;this.bt=function(){var t=document.createElement("div");return t.id="phenixRTC",t.style.cssText="visibility:hidden !important;width:0px !important;height:0px !important;margin:0px !important;padding:0px !important;border-style:none !important;border-width:0px !important;max-width:0px !important;max-height:0px !important;outline:none !important",document.body.appendChild(t),t}(),this.kt="?";try{this.St=function(t){var e=document.createElement("object");return e.type="application/x-phenix-rtc",t.appendChild(e),e}(this.bt),this.St.onunload=function(){t.y=!1},(new n).waitForReady(this.St,function(e){t.y=!0,t.w=!0===e,t.kt=t.St.phenixVersion||"?.?.?.?",d(e?"Phenix RTC "+t.kt:"No Phenix RTC"),t.b&&t.b(t.w)})}catch(t){l("Error while loading Phenix RTC"+t)}}function o(){this.bt&&document.getElementById("phenixRTC")!==this.bt&&(document.body.appendChild(this.bt),this.Et&&this.Et.call(this))}function a(e){var i=function(){var i=null;switch(arguments.length){case 0:i=new e;break;case 1:i=new e(arguments[0]);break;case 2:i=new e(arguments[0],arguments[1]);break;case 3:i=new e(arguments[0],arguments[1],arguments[2]);break;case 4:i=new e(arguments[0],arguments[1],arguments[2],arguments[3]);break;case 5:i=new e(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]);break;default:throw new Error("Unsupported number of arguments in Phenix Object Constructor")}return i.phenixAddEventListener=t.bind(u,i),i.phenixRemoveEventListener=t.bind(c,i),i};return t.forOwn(e,function(t,e){i[e]=t}),i}function u(t,i){e.Tt(t,"name"),e.It(i,"listener"),h.call(this,t),function(t,e){if(!this.events||!this.events[t])throw new Error("No event observable for event: "+name);this.events[t].listeners.push(e)}.call(this,t,i)}function c(t,e){f.call(this,t,e)}function h(e){if(!this.events||!this.events[e]){this.events||(this.events={});var n=this.events;n[e]={observable:(new i.Observable).extend({timeout:0}),subscription:null,listeners:[]},this.phenixSetEventListener(e,t.bind(n[e].observable.setValue,n[e].observable)),n[e].subscription=n[e].observable.subscribe(function(i){var r=n[e].listeners;t.forEach(r,function(t){t(i)})})}}function f(e,i){this.events&&this.events.events[e]&&(this.events[e].listeners=t.filter(this.events[e].listeners,function(t){return i!==t}))}var d=function(){console.log.apply(console,arguments)}||function(){},l=function(){console.error.apply(console,arguments)}||d;return s.prototype.onReady=function(t){var e=this;this.y?setTimeout(function(){t(e.w)},1):this.b=t},s.prototype.onLoaded=function(t){this.Et=t},s.prototype.isLoaded=function(){return!0===this.y},s.isSupported=function(){if(navigator.plugins)for(var t=navigator.plugins,e=0;e<t.length;e++)if(t[e].name.indexOf("PhenixRTC")>=0)return!0;if(navigator.userAgent&&(navigator.userAgent.match(/MSIE/)||navigator.userAgent.match(/Trident/)))try{return new window.ActiveXObject("PhenixP2P.RTC"),!0}catch(t){return!1}return!1},s.prototype.isEnabled=function(){return o.call(this),this.St&&void 0!==this.St.phenixVersion},s.prototype.getVersion=function(){return o.call(this),this.kt},s.prototype.getRTCPeerConnectionConstructor=function(){return o.call(this),a(this.St.RTCPeerConnection)},s.prototype.getRTCSessionDescriptionConstructor=function(){return o.call(this),a(this.St.RTCSessionDescription)},s.prototype.getRTCIceCandidateConstructor=function(){return o.call(this),a(this.St.RTCIceCandidate)},s.prototype.getSourcesDelegate=function(){var t=this;return function(e){return o.call(t),t.St.getSources(e)}},s.prototype.getUserMediaDelegate=function(){var t=this;return function(e,i,n){return o.call(t),t.St.getUserMedia(e,i,n)}},s.prototype.getStatsDelegate=function(){return function(t,e,i,n){return t.getStats(e,i,n)}},s.prototype.attachMediaStream=function(t,e){return o.call(this),function(t,e){if(!t)throw new Error("Can not attach a stream to a undefined element");if(t.phenixVersion)return t.src=e,t;var i=new r(t,e,!0);return i.getElement().phenixPresenter=i,i.getElement()}.call(this,t,e)},s.prototype.reattachMediaStream=function(t,e){return o.call(this),this.attachMediaStream(t,e.src)},s}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(1),i(2),i(11),i(0),i(3)],void 0===(r=function(t,e,i,n,r){"use strict";function s(){if(w=n.RTCPeerConnection,b=n.RTCSessionDescription,k=n.RTCIceCandidate,navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(S=t.bind(c,null,"input")),navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(E=t.bind(c,null,"output")),(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||n.getUserMedia)&&(T=o),!n.RTCPeerConnection)return g("[%s] browser version [%s] does not appear to be WebRTC-capable",y.browser,y.version);switch(y.browser){case"Firefox":g("Firefox detected",y),R=function(t,e){g("Attaching media stream");var i=t.muted;return y.version>57&&(t.srcObject=e),t.mozSrcObject=e,t.play(),!0===i&&(t.muted=!0),t},M=function(t,e){g("Reattaching media stream");var i=t.muted;return y.version>57&&(t.srcObject=e.srcObject),t.mozSrcObject=e.mozSrcObject,t.play(),!0===i&&(t.muted=!0),t},I=function(e,i,n,r){e.getStats(i,t.bind(l,this,e,n),r)},P=!0;break;case"Opera":g("Opera detected",y),R=h,M=d,I=function(e,i,n,r){e.getStats(t.bind(l,this,e,n),i,r)},P=!0;break;case"Chrome":g("Webkit detected",y),R=h,M=d,I=function(e,i,n,r){e.getStats(t.bind(l,this,e,n),i,r)},P=!0;break;case"Edge":g("Edge detected",y),R=h,M=d,I=function(e,i,n,r){e.getStats(i,t.bind(l,this,e,n),r)},P=!0;break;case"Safari":g("Safari detected",y),R=function(e,i){return t.Rt(i)&&(e.__phenixHasPlayedWebRtc=!0),h(e,i)},C=function(t,e){return t.__phenixHasPlayedWebRtc?((t=new r(t,e,!1).getElement()).play(),t):f(t,e)},M=d,I=function(e,i,n,r){e.getStats(i).then(t.bind(l,this,e,n),r)},P=!0;break;case"ReactNative":g("React Native detected",y),R=function(){g("attachMediaStream not supported in React Native environment")},C=function(){g("attachUriStream not supported in React Native environment")},M=function(){g("reattachMediaStream not supported in React Native environment")},I=function(e,i,n,r){e.getStats(i).then(t.bind(l,this,e,n),r)},P=!0;break;default:g("Browser does not appear to be WebRTC-capable",y)}}function o(e,i,r){var s=t.bind(a,this,e,i,r);return navigator&&t.It(navigator.getUserMedia)?navigator.getUserMedia(e,s,r):n&&t.It(n.getUserMedia)?n.getUserMedia(e,s,r):void 0}function a(t,e,i,n){setTimeout(function(){for(var r=n.getTracks(),s=0;s<r.length;s++){var o=r[s];if(o.onended=function(t){g(t.timeStamp,"Track",o.id,o.label,"ended")},g("Track",o.id,o.label,r[s].kind,"readyState=",r[s].readyState),"ended"===o.readyState)return u("User media not available",i,r)}var a=(t.audio?1:0)+(t.video?1:0);return r.length!==a?u("Unable to get all requested user media.",i,r):void e(n)},100)}function u(t,e,i){try{var n=new Error(t);n.code="unavailable",e(n)}finally{!function(t){for(var e=0;e<t.length;e++)t[e].stop()}(i)}}function c(t,e){if("input"!==t&&"output"!==t)throw new Error("Unsupported device type "+t);navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices().then(function(i){var n=[];i.forEach(function(e){e.kind==="audio"+t?n.push({kind:"audio",id:e.deviceId,label:e.label}):e.kind==="video"+t&&n.push({kind:"video",id:e.deviceId,label:e.label})}),e(n)})}function h(t,e){return void 0!==t.srcObject?t.srcObject=e:void 0!==t.mozSrcObject?t.mozSrcObject=e:void 0!==t.src?t.src=URL.createObjectURL(e):g("Error attaching stream to element."),t.play(),t}function f(t,e){return t.src=e,t.play(),t}function d(t,e){return t.src=e.src,t}function l(t,e,i){e(m(t,i))}function m(e,i){switch(y.browser){case"Edge":i.forEach(function(t){t.mediaType=p(e,t.codecId),t.bytesSent=v(t.packetsSent,t.mediaType),t.bytesReceived=v(t.packetsReceived,t.mediaType)});break;case"Safari":i.forEach(function(e){t.includes(e.id.toLowerCase(),"audio")&&t.includes(e.id.toLowerCase(),"rtp")&&(e.mediaType="audio"),t.includes(e.id.toLowerCase(),"video")&&t.includes(e.id.toLowerCase(),"rtp")&&(e.mediaType="video")})}return i}function p(e,i){var n;if(i)return function(e,i){var n=e.localDescription.sdp.split("m="),r=e.remoteDescription.sdp.split("m=");n.length===r.length&&t.findIndex(n,function(t,e){return i(t)})}(e,function(e){t.startsWith(e,"video")&&t.includes(e.toLowerCase(),i.toLowerCase())&&(n="video"),t.startsWith(e,"audio")&&t.includes(e.toLowerCase(),i.toLowerCase())&&(n="audio")}),n}function v(t,e){var i=parseInt(t)||0;return"audio"===e?100*i:"video"===e?1080*i:void 0}var g=function(){console.log.apply(console,arguments)},y=new e(navigator.userAgent).detect(),w=n.RTCPeerConnection,b=n.RTCSessionDescription,k=n.RTCIceCandidate,S=null,E=null,T=null,I=null,R=null,C=null,M=null,P=!1;return function(){s();var t={RTCPeerConnection:w,RTCSessionDescription:b,RTCIceCandidate:k,getSources:S,getDestinations:E,getUserMedia:T,getStats:I,attachMediaStream:R,attachUriStream:C||f,reattachMediaStream:M,webrtcSupported:P,exportGlobal:function(){n.RTCPeerConnection=t.RTCPeerConnection,n.RTCSessionDescription=t.RTCSessionDescription,n.RTCIceCandidate=t.RTCIceCandidate}};return t}}.apply(e,n))||(t.exports=r)},function(t,e){t.exports=u}]))},function(t,e,i){var n,r;n=[i(44),i(99),i(98)],void 0===(r=function(t,e,i){"use strict";return{Observable:t,ObservableArray:e,ObservableMonitor:i}}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(45),i(100)],void 0===(r=function(t,e){return{Event:t,NamedEvents:e}}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(80)],void 0===(r=function(t){"use strict";return t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n;void 0===(n=function(){"use strict";return{networkStates:{networkEmpty:{id:0,name:"NETWORK_EMPTY"},networkIdle:{id:1,name:"NETWORK_IDLE"},networkLoading:{id:2,name:"NETWORK_LOADING"},networkNoSource:{id:3,name:"NETWORK_NO_SOURCE"}},types:{realTime:{id:0,name:"real-time"},dash:{id:1,name:"dash"},hls:{id:2,name:"hls"},rtmp:{id:0,name:"rtmp"}},streamEvents:{playerEnded:{id:0,name:"playerended"},playerError:{id:1,name:"playererror"},stopped:{id:2,name:"stopped"}},rendererEvents:{ended:{id:0,name:"ended"},error:{id:1,name:"error"}}}}.apply(e,[]))||(t.exports=n)},function(t,e,i){var n,r;n=[i(108),i(103),i(21)],void 0===(r=function(t,e,i){"use strict";return{createLogger:function(){return new t},Logger:t,ConsoleAppender:e,level:i.level}}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(5)],void 0===(r=function(t,e,i){"use strict";var n=500,r=15;function s(t,s){e.Rt(t,"logger"),this.Ct=t,this.Mt=new i.Event,this.Pt=null,this.xt=!1,this.Dt=null,this.Ot={pollFrequency:n,previousWidth:0,previousHeight:0},s&&s.pollFrequency&&(this.Ot.pollFrequency=s.pollFrequency>=r?s.pollFrequency:r),this.At=null}function o(){if(this.xt&&!this.Pt&&0!==this.Mt.size()){var t=this;this.Ot.previousWidth=this.Dt.videoWidth,this.Ot.previousHeight=this.Dt.videoHeight,this.Pt=setInterval(function(){t.Dt.videoWidth===t.Ot.previousWidth&&t.Dt.videoHeight===t.Ot.previousHeight||(t.Ot.previousWidth=t.Dt.videoWidth,t.Ot.previousHeight=t.Dt.videoHeight,t.Mt.fireAsync([t.At,{width:t.Dt.videoWidth,height:t.Dt.videoHeight}]))},t.Ot.pollFrequency)}}return s.prototype.start=function(e,i){(function(e,i){i&&!t.isUndefined(i.videoWidth)||this.Ct.warn("Attempting to start dimensions changed monitor without providing proper 'video' element."),this.At=e,this.Dt=i,this.xt=!0,o.call(this)}).call(this,e,i)},s.prototype.stop=function(){(function(){this.xt=!1,this.Pt&&(clearInterval(this.Pt),this.Pt=null),this.Mt.dispose()}).call(this)},s.prototype.addVideoDisplayDimensionsChangedCallback=function(t){return e.It(t,"addVideoDisplayDimensionsChangedCallback"),o.call(this),this.Mt.listen(t)},s.prototype.toString=function(){return"DimensionsChangedMonitor[pollFrequency="+this.Ot.pollFrequency+", previousHeight="+this.Ot.previousHeight+", previousWidth="+this.Ot.previousHeight+", state="+(this.Pt?"running":"stopped")+"]"},s}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(105)],void 0===(r=function(t){"use strict";return t()}.apply(e,n))||(t.exports=r)},function(t,e,i){var n;void 0===(n=function(){"use strict";return{types:{directChat:{id:0,name:"DirectChat"},multiPartyChat:{id:1,name:"MultiPartyChat"},moderatedChat:{id:2,name:"ModeratedChat"},townHall:{id:3,name:"TownHall"},channel:{id:4,name:"Channel"}},events:{memberJoined:{id:0,name:"MemberJoined"},memberLeft:{id:1,name:"MemberLeft"},memberUpdated:{id:2,name:"MemberUpdated"},roomUpdated:{id:3,name:"RoomUpdated"},roomEnded:{id:4,name:"RoomEnded"}}}}.apply(e,[]))||(t.exports=n)},function(t,e,i){var n;void 0===(n=function(){"use strict";return{roles:{participant:{id:0,name:"Participant"},moderator:{id:1,name:"Moderator"},presenter:{id:2,name:"Presenter"},audience:{id:3,name:"Audience"}},states:{active:{id:0,name:"Active"},passive:{id:1,name:"Passive"},handRaised:{id:2,name:"HandRaised"},inactive:{id:3,name:"Inactive"},offline:{id:4,name:"Offline"}}}}.apply(e,[]))||(t.exports=n)},function(t,e,i){var n,r,s,o,a,u,c,h,f;t.exports=(n=i(1),r=i(0),s=i(8),o=i(5),a=i(2),u=i(3),c=i(6),h=i(43),f=i(35),function(t){function e(n){if(i[n])return i[n].exports;var r=i[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var i={};return e.m=t,e.c=i,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=21)}([function(t,e){t.exports=n},function(t,e){t.exports=r},function(t,e){t.exports=s},function(t,e){t.exports=o},function(t,e){t.exports=a},function(t,e,i){var n,r;n=[i(1),i(0),i(2),i(3),i(4),i(10),i(7),i(22),i(23),i(13),i(14),i(26),i(6)],void 0!==(r=function(t,e,i,n,r,s,o,a,u,c,h,f,d){"use strict";function l(t,s){s&&e.qt(s,"playlistUrl"),this.parsedPlaylist=null,this.Ct=t||new i.Logger,this.playlistUrl=s,this.baseUrl=s?s.substring(0,s.lastIndexOf("/")+1):"",this.Ut=s?s.substring(s.lastIndexOf("/"),s.length):"",this.Ft=new n.Event,this.Nt={},this.jt=[],this.Lt=p(this.playlistUrl),this.Bt=null,this._t=0,this.v=new r.DisposableList,this.v.add(this.Ft)}function m(i,n){e.Wt(i,o,"track"),n=n||t.noop,e.It(n,"eventCallback");var s=i.getMimeType();this.Nt[s]||(this.Nt[s]=[]),t.includes(this.Nt[s],i)||this.Nt[s].push(i),t.includes(this.jt,s)||this.jt.push(s),this.v.add(new r.Disposable(function(){i.dispose()})),this.Ft.fireAsync([i],this,n)}function p(t){return/[.]mpd\??[^\s]*/i.test(t)?"Dash":/[.]m3u8\??[^\s]*/i.test(t)?"Hls":null}function v(e,i,n){if(this.Ct.error("Failed to load playlist [%s]. Status code: [%s] (status text: [%s])",this.playlistUrl,e.code,e.message),i&&i.attempts===y){var r="Failed to get playlist with max retries of ["+y+" after ["+t.get(i,["stats","totalResponseTimeForAllAttempts"],0)+"] ms";return n(g(d.name.playlistNotFound.name,d.severity.CRITICAL,r))}if(0===e.code){var s="Failed to get playlist with timeout after ["+t.get(i,["stats","totalResponseTimeForAllAttempts"],0)+"]";return n(g(d.name.timeout.name,d.severity.RECOVERABLE,s))}return n(g(d.name.error.name,d.severity.CRITICAL,e))}function g(t,e,i){return{category:d.category.PLAYLIST,name:t,severity:e,error:"Error"===i.constructor.name?i:new Error(i)}}var y=5;return l.prototype.toString=function(){return"Playlist [playlistUrl="+this.playlistUrl+", baseUrl="+this.baseUrl+", mimeTypes="+this.jt+", trackAddedEvent(size)="+this.Ft.size()+", playlistTracks="+this.getAllPlaylistTracks()+"]"},l.prototype.dispose=function(){this.Nt={},this.v.dispose()},l.prototype.getPlaylistTracksByMimeType=function(t){return this.Nt[t]},l.prototype.fetch=function(e){(function(e){var i=this;s.getWithRetry(i.playlistUrl,{retryOptions:{backoff:1,delay:1e3,maxAttempts:y,additionalRetryErrorCodes:[0]}},function(n,r){if(n)return v.call(i,n,r,e);(function(e,i,n){var r=null,o=[],d=this;switch(this.Lt){case"Dash":r=new c(d.Ct,e);var l=new f(d.Ct,r.timeSources,i);d.v.add(l),d.parsedPlaylist=r,d.zt=d.parsedPlaylist.availabilityStartTime?d.parsedPlaylist.availabilityStartTime.getTime():null,d.Vt=d.parsedPlaylist.publishTime?d.parsedPlaylist.publishTime.getTime():null,d.Ht=t.get(d.parsedPlaylist,["suggestedPresentationDelay","totalMillis"],null),d.Gt=t.get(d.parsedPlaylist,["mediaPresentationDuration","totalMillis"],1/0),d.Jt=t.get(d.parsedPlaylist,["minBufferTime","totalMillis"],null),d.Bt=d.parsedPlaylist.type,o=function(e){var i=this;return t.map(e.representations,function(t){return{chunkDuration:t.duration,dataChunkUrlTemplate:t.media,codec:t.mseCodec,bandwidth:t.bandwidth,height:t.height,trackId:t.id,initUrl:t.initialization,mimeType:t.mimeType,totalNumberOfChunks:Math.ceil(i.Gt/t.duration)}})}.call(d,d.parsedPlaylist),t.forEach(o,function(t){m.call(d,new a(d.Ct,t))}),l.calculateOffset(function(t,e){d._t=e,n()}),l.setInterval(function t(e,i){if(e)return d.Kt("Unable to get server local time offset",e),l.setInterval(t);d._t=i});break;case"Hls":r=new h(d.Ct,d.Ut,e),d.parsedPlaylist=r,d.zt=null,d.Jt=0,d.Ht=0,d.Gt=1/0;var g=0;t.forEach(r.streamVariants,function(t){var e=d.baseUrl+t.name,i=new u(d.Ct,{mediaSegmentPlaylistUrl:e,codecs:t.codecs.join(","),bandwidth:t.bandwidth,trackId:t.name,mimeType:"application/octet-stream",height:null});s.getWithRetry(e,{retryOptions:{maxAttempts:y,backoff:1}},function(t,e){if(t)return v.call(d,t,e,n);i.updateMediaSegments(e.data),m.call(d,i),++g===r.streamVariants.length&&(d.Bt=i.isComplete()?"static":"dynamic","static"===d.Bt&&(d.Gt=1e3*i.getPlayableDuration()),n())})});break;default:throw d.Ct.error("[%s] Unsupported Delivery Type [%s]",d.playlistUrl,p(d.playlistUrl)),new Error("Unsupported Delivery Type "+p(d.playlistUrl))}}).call(i,r.data,r.stats.successResponseTime,function(){e(n,{raw:r,parsed:i.parsedPlaylist})})})}).call(this,e)},l.prototype.getType=function(){return this.Bt},l.prototype.getDeliveryType=function(){return this.Lt},l.prototype.getPlaylistTracksByBandwidthPerMimeType=function(i,n){e.Rt(n,"restrictions");var r=this;return t.map(this.jt,function(e){var s=function(e,i){return 0===t.keys(i).length?e:t.filter(e,function(e){return function(e,i){var n=e.getHeight()||0,r=e.getBandwidth()||0;return t.reduce(i,function(t,e,i){switch(i){case"maxHeight":return n<=e;case"minHeight":return n>=e;case"maxBandwidth":return r<=e;case"minBandwidth":return r>=e;default:throw new Error("Unknown restriction "+i)}},!1)}(e,i)})}(r.getPlaylistTracksByMimeType(e),n),o=t.reduce(s,function(t,e){return e.getBandwidth()>i?t:t&&t.getBandwidth()>e.getBandwidth()?t:e},null)||r.getPlaylistTrackByMimeTypeAndNextHighestBandwidth(0,e);if(o)return o;var a=t.get(t.filter(s,function(t){return!t.getBandwidth()}),"0");if(a)return r.Ct.debug("Unable to get track with bandwidth [%s]. Falling back to track [%s].",a.getTrackId()),a;r.Ct.warn("Unable to get track with bandwidth [%s]. No other tracks to fallback on.")})},l.prototype.getPlaylistTrackByBandwidthAndMimeType=function(e,i){return t.find(this.getPlaylistTracksByBandwidthPerMimeType(e,{}),function(t){return t.getMimeType()===i})},l.prototype.getPlaylistTrackByMimeTypeAndNextHighestBandwidth=function(e,i){return t.reduce(this.getPlaylistTracksByMimeType(i),function(t,i){return i.getBandwidth()<=e?t:t?t.getBandwidth()>i.getBandwidth()?i:t:i},null)},l.prototype.getAllPlaylistTracks=function(){return[].concat.apply([],t.values(this.Nt))},l.prototype.getMimeTypes=function(){return this.jt},l.prototype.getPlaybackDurationSinceAvailable=function(){return this.currentServerTime()-this.zt},l.prototype.getPlaybackDurationSincePublish=function(){return this.currentServerTime()-this.Vt},l.prototype.getSuggestedPresentationDelayTotalMillis=function(){return this.Ht},l.prototype.getTotalMediaTimeInMillis=function(){return this.Gt},l.prototype.getMinBufferTimeTotalMillis=function(){return this.Jt},l.prototype.getLocalToServerTimeOffset=function(){return this._t},l.prototype.currentServerTime=function(){return t.now()-this._t},l.prototype.getMaxChunkDuration=function(){return t.reduce(this.getAllPlaylistTracks(),function(t,e){return Math.max(e.getChunkDuration(),t)},0)},l.prototype.addEventListener=function(t,i){switch(e.Xt(t,"eventName"),e.It(i,"listener"),t){case"trackadded":return this.Ft.listen(i);default:throw new Error('Event "'+t+'" is unknown.')}},l}.apply(e,n))&&(t.exports=r)},function(t,e,i){var n;void 0!==(n=function(){"use strict";return{name:{chunkNotFound:{id:0,name:"chunk-not-found"},timeout:{id:1,name:"timeout"},error:{id:2,name:"error"},playlistNotFound:{id:3,name:"playlist-not-found"},progressTimeOut:{id:4,name:"progress-timeout"},hlsNativeError:{id:5,name:"hls-native-error"}},category:{PLAYLIST:4,STREAMING:5,DRM:6},severity:{RECOVERABLE:1,CRITICAL:2}}}.apply(e,[]))&&(t.exports=n)},function(t,e,i){var n,r;n=[i(0),i(3),i(2)],void 0!==(r=function(t,e,i){"use strict";function n(t,e,i){}return n.prototype.toString=function(){throw new Error("Must be implemented")},n.prototype.dispose=function(){throw new Error("Must be implemented")},n.prototype.getMseCodec=function(){throw new Error("Must be implemented")},n.prototype.getTrackId=function(){throw new Error("Must be implemented")},n.prototype.getChunkDuration=function(){throw new Error("Must be implemented")},n.prototype.getBandwidth=function(){throw new Error("Must be implemented")},n.prototype.getHeight=function(){throw new Error("Must be implemented")},n.prototype.getMimeType=function(){throw new Error("Must be implemented")},n.prototype.getTotalNumberOfChunks=function(){throw new Error("Must be implemented")},n.prototype.getCurrentChunkId=function(){throw new Error("Must be implemented")},n.prototype.setCurrentChunkId=function(t){throw new Error("Must be implemented")},n.prototype.incrementCurrentChunkId=function(){throw new Error("Must be implemented")},n.prototype.addDataChunk=function(t,e,i){throw new Error("Must be implemented")},n.prototype.getChunks=function(){throw new Error("Must be implemented")},n.prototype.addEventListener=function(t,e){throw new Error("Must be implemented")},n}.apply(e,n))&&(t.exports=r)},function(t,e){t.exports=u},function(t,e,i){var n,r;n=[i(1),i(2)],void 0!==(r=function(t,e){"use strict";function i(t,i){this.h=i||{},this.Ct=t||new e.Logger,this.Qt={},this.$t=i.ewmaPeriods||null,this.Yt=this.$t?2/(this.$t+1):null}function n(t,e,i,n,r){var s=(i*(t.length-1)+r(e))/t.length;if(n>0)for(;e.added-t[0].added>n;){var o=t.shift();s=(s*(t.length+1)-r(o))/t.length}return s}return i.prototype.toString=function(){var e=this;return"StatsProvider [rateDataPoints(keys)="+t.keys(this.Qt)+", rateDataPoints="+t.toString(t.map(this.Qt,function(t,i){return e.getRateAverages(i)}))+", options="+this.h+"]"},i.prototype.dispose=function(){delete this.Qt},i.prototype.addRateDataPoint=function(e,i,r,s){if(!t.isNullOrUndefined(this.Qt)){this.Qt[e]||(this.Qt[e]={tenSecDataPoints:[],thirtySecDataPoints:[],oneMinDataPoints:[],twoMinDataPoints:[],ewmaDataPoints:[],tenSecAverageRate:0,thirtySecAverageRate:0,oneMinAverageRate:0,twoMinAverageRate:0,ewmaRate:0,smaRate:0,tenSecAverageDuration:0,thirtySecAverageDuration:0,oneMinAverageDuration:0,twoMinAverageDuration:0,ewmaDuration:0,smaDuration:0});var o={duration:i,amount:r,durationToSecondsFactor:s,rate:r/(i*s),added:t.now()};(function(t,e){var i=function(t){return t.rate},r=function(t){return t.duration};t.tenSecDataPoints.push(e),t.thirtySecDataPoints.push(e),t.oneMinDataPoints.push(e),t.twoMinDataPoints.push(e),t.tenSecAverageRate=n.call(this,t.tenSecDataPoints,e,t.tenSecAverageRate,1e4,i),t.thirtySecAverageRate=n.call(this,t.thirtySecDataPoints,e,t.thirtySecAverageRate,3e4,i),t.oneMinAverageRate=n.call(this,t.oneMinDataPoints,e,t.oneMinAverageRate,6e4,i),t.twoMinAverageRate=n.call(this,t.twoMinDataPoints,e,t.twoMinAverageRate,12e4,i),t.tenSecAverageDuration=n.call(this,t.tenSecDataPoints,e,t.tenSecAverageDuration,1e4,r),t.thirtySecAverageDuration=n.call(this,t.thirtySecDataPoints,e,t.thirtySecAverageDuration,3e4,r),t.oneMinAverageDuration=n.call(this,t.oneMinDataPoints,e,t.oneMinAverageDuration,6e4,r),t.twoMinAverageDuration=n.call(this,t.twoMinDataPoints,e,t.twoMinAverageDuration,12e4,r),this.Yt&&(t.ewmaDataPoints.push(e),t.smaRate=n.call(this,t.ewmaDataPoints,e,t.smaRate,-1,i),t.smaDuration=n.call(this,t.ewmaDataPoints,e,t.smaDuration,-1,r),t.ewmaDataPoints.length>=this.$t&&(t.ewmaDataPoints.shift(),t.ewmaDataPoints.length===this.$t?(t.ewmaRate=t.smaRate,t.ewmaDuration=t.smaDuration):(t.ewmaRate=this.Yt*(t.smaRate-t.ewmaRate)+t.ewmaRate,t.ewmaDuration=this.Yt*(t.smaDuration-t.ewmaDuration)+t.ewmaDuration)))}).call(this,this.Qt[e],o)}},i.prototype.getRateAverages=function(e){if(!t.get(this.Qt,[e]))return{tenSecAverageRate:0,thirtySecAverageRate:0,oneMinAverageRate:0,twoMinAverageRate:0,ewmaRate:0,tenSecAverageDuration:0,thirtySecAverageDuration:0,oneMinAverageDuration:0,twoMinAverageDuration:0,ewmaDuration:0};var i=this.Qt[e];return{tenSecAverageRate:i.tenSecAverageRate,thirtySecAverageRate:i.thirtySecAverageRate,oneMinAverageRate:i.oneMinAverageRate,twoMinAverageRate:i.twoMinAverageRate,ewmaRate:i.ewmaRate,tenSecAverageDuration:i.tenSecAverageDuration,thirtySecAverageDuration:i.thirtySecAverageDuration,oneMinAverageDuration:i.oneMinAverageDuration,twoMinAverageDuration:i.twoMinAverageDuration,ewmaDuration:i.ewmaDuration}},i}.apply(e,n))&&(t.exports=r)},function(t,e){t.exports=c},function(t,e){t.exports=h},function(t,e,i){var n;void 0!==(n=function(){"use strict";function t(t,e,i,n){}return t.prototype.toString=function(){throw new Error("Must be implemented")},t.prototype.dispose=function(){throw new Error("Must be implemented")},t.prototype.initialize=function(t,e,i,n){throw new Error("Must be implemented")},t.prototype.setActiveTracks=function(t){throw new Error("Must be implemented")},t.prototype.initializePlaylistTracks=function(t,e,i,n){throw new Error("Must be implemented")},t.prototype.startRequestingDataForActiveTracks=function(){throw new Error("Must be implemented")},t.prototype.isFetchingData=function(){throw new Error("Must be implemented")},t.prototype.seekToChunk=function(t){throw new Error("Must be implemented")},t.prototype.stopRequestingAllData=function(){throw new Error("Must be implemented")},t}.apply(e,[]))&&(t.exports=n)},function(t,e,i){var n,r;n=[i(1),i(0),i(25)],void 0!==(r=function(t,e,i){"use strict";function n(n,s){e.qt(s,"mpdXml"),e.Rt(n,"logger"),this.Zt=s,this.Ct=n,this.minBufferTime=0,this.type=null,this.publishTime=null,this.availabilityStartTime=null,this.timeShiftBufferDepth=0,this.suggestedPresentationDelay=0,this.minimumUpdatePeriod=0,this.maxSegmentDuration=0,this.profiles=null,this.moreInfoUrl=null,this.programInfoTitle=null,this.representations=[],function(){e.qt(this.Zt,"mpdXml");var n,s=i.parseXml(this.Zt),c=s.getElementsByTagName("parsererror");if(c&&c.length>0)throw n="Failed to parse MPD Playlist XML: "+c.item(0).innerText+" (source xml: "+this.Zt+")",this.Ct.error(n),new Error(n);if("MPD"!==s.documentElement.nodeName)throw n='Invalid MPD Playlist XML. Does not start with "MPD": '+this.Zt,this.Ct.error(n),new Error(n);this.minBufferTime=r(a(s.documentElement,"minBufferTime")),this.type=a(s.documentElement,"type"),this.publishTime=o(a(s.documentElement,"publishTime")),this.availabilityStartTime=o(a(s.documentElement,"availabilityStartTime")),this.timeShiftBufferDepth=r(a(s.documentElement,"timeShiftBufferDepth")),this.suggestedPresentationDelay=r(a(s.documentElement,"suggestedPresentationDelay")),this.minimumUpdatePeriod=r(a(s.documentElement,"minimumUpdatePeriod")),this.maxSegmentDuration=r(a(s.documentElement,"maxSegmentDuration")),this.mediaPresentationDuration=r(a(s.documentElement,"mediaPresentationDuration")),this.profiles=a(s.documentElement,"profiles");var h=s.getElementsByTagName("ProgramInformation"),f=s.getElementsByTagName("UTCTiming");if(h&&h.length>=1){var d=h.item(0);this.programInfoTitle=u(d,"Title").childNodes[0].nodeValue,this.moreInfoUrl=a(d,"moreInformationURL")}var l=s.getElementsByTagName("ContentProtection");if(this.contentProtectionTags=[],l.length>0)for(var m=0;m<l.length;m++){var p=l.item(m),v=t.reduce(p.attributes,function(t,e){return t[e.name]=e.value,t},{});this.contentProtectionTags.push(v)}for(var g=s.getElementsByTagName("Representation"),y=0;y<g.length;y++){var w=function(t){var e={};if(e.id=a(t,"id"),e.mimeType=a(t,"mimeType"),e.codecs=a(t,"codecs"),e.mseCodec=i.getMSECodec(e.mimeType,e.codecs),e.isAudio=e.mimeType.indexOf("audio")>=0,e.isVideo=e.mimeType.indexOf("video")>=0,!i.isCodecSupported(e.mseCodec))return this.Ct.debug("MPD representation has unsupported codec. Skipping stream id [%s] (mimeType=[%s], codecs=[%s])",e.id,e.mimeType,e.codecs),null;var n=a(t,"bandwidth");e.bandwidth=n?parseInt(n,10):null;var r=a(t,"height");e.height=r?parseInt(r,10):null;var s=u(t,"SegmentTemplate");return s&&(e.timescale=parseInt(a(s,"timescale")),e.media=a(s,"media"),e.startNumber=parseInt(a(s,"startNumber")),e.duration=parseInt(a(s,"duration")),e.initialization=a(s,"initialization")),e}.call(this,g.item(y));w&&this.representations.push(w)}this.timeSources=[];for(var b=0;b<f.length;b++){var k=f.item(b),S=a(k,"schemeIdUri"),E=a(k,"value"),T=o(E);this.timeSources.push({name:S,value:isNaN(T.getTime())?E:T.getTime()})}}.call(this)}function r(t){if(!t)return null;var e=/^(-)?P(?:(-?[0-9,.]*)Y)?(?:(-?[0-9,.]*)M)?(?:(-?[0-9,.]*)W)?(?:(-?[0-9,.]*)D)?(?:T(?:(-?[0-9,.]*)H)?(?:(-?[0-9,.]*)M)?(?:(-?[0-9,.]*)S)?)?$/.exec(t);if(e){var i="-"===e[1]?-1:1,n={year:s(e[2],i),month:s(e[3],i),week:s(e[4],i),day:s(e[5],i),hour:s(e[6],i),minute:s(e[7],i),second:s(e[8],i)};return n.totalMillis=1e3*(n.second+60*(n.minute+60*(n.hour+24*n.day))),n}return null}function s(t,e){var i=t&&parseFloat(t.replace(",","."));return(isNaN(i)?0:i)*e}function o(t){if(!t)return null;var e=new Date;return e.setTime(Date.parse(t)),e}function a(t,e){var i=t.attributes.getNamedItem(e);return i?i.value:null}function u(t,e){for(var i=0;i<t.childNodes.length;i++){var n=t.childNodes.item(i);if(n.nodeName===e)return n}return null}return n.prototype.toString=function(){return"Mpd [minBufferTime="+this.minBufferTime+", type="+this.type+", publishTime="+this.publishTime+", availabilityStartTime="+this.availabilityStartTime+", timeShiftBufferDepth="+this.timeShiftBufferDepth+", suggestedPresentationDelay="+this.suggestedPresentationDelay+", minimumUpdatePeriod="+this.minimumUpdatePeriod+", maxSegmentDuration="+this.maxSegmentDuration+", profiles="+this.profiles+", moreInfoUrl="+this.moreInfoUrl+", programInfoTitle="+this.programInfoTitle+", representations="+JSON.stringify(this.representations)+"]"},n}.apply(e,n))&&(t.exports=r)},function(t,e,i){var n,r;n=[i(1),i(0)],void 0!==(r=function(t,e){"use strict";function i(i,r,s){e.qt(s,"M3u8VariantPlaylistString"),e.qt(r,"name"),e.Rt(i,"logger"),this.te=s,this.Ut=r,this.Ct=i,function(e){var i=e.match(/[^\r\n]+/g),r=this;return t.forEach(i,function(e,s){var o=e.match(/(?!#)EXT.+?(?=[:\n\r])/),a=t.get(o,["0"],null),u=e.trim().substring(a?a.length+2:0,e.length);switch(a){case"EXT-X-STREAM-INF":r.streamVariants=r.streamVariants||[];var c=[u,i[s+1]];r.streamVariants.push(function(e){var i=(function(e){var i=t.get(e.match(/(?:CODECS=).*?",/),["0"],""),n=t.get(i.split("="),["1"],"");return n.substring(1,n.length-2)}(e[0])||"").split(","),r=(n(e[0],"FRAME-RATE")||"").trim();return{programId:n(e[0],"PROGRAM-ID"),codecs:i,bandwidth:parseInt(n(e[0],"BANDWIDTH")),averageBandwidth:parseInt(n(e[0],"AVERAGE-BANDWIDTH")),frameRate:parseInt(parseInt(r)||0),name:t.get(e,["1"],"").trim()}}(c));break;case"EXT-X-ALLOW-CACHE":r.allowCache="YES"===u;break;case"#EXT-X-COMBINED":r.combined="YES"===u;break;case"EXTM3U":case null:break;default:return r.Ct.debug("[%s] [Variant] Playlist unsupported key type [%s]",r.Ut,a)}}),r}.call(this,this.te)}function n(e,i){var n=new RegExp("(?:"+i+"=).*?(?=[,\n\r])"),r=new RegExp("(?:"+i+"=).*?$"),s=t.get(e.match(n)||e.match(r),["0"],"");return t.get(s.split("="),["1"])}return i.prototype.toString=function(){return"M3u8VariantPlaylist[name="+this.Ut+",numberOfStreamVariants="+this.streamVariants.length+"]"},i}.apply(e,n))&&(t.exports=r)},function(t,e,i){var n,r;n=[i(1),i(0),i(2),i(3),i(16),i(12),i(5),i(7),i(9),i(13),i(6)],void 0!==(r=function(t,e,i,n,r,s,o,a,u,c,h){"use strict";function f(s,a,h,f){e.Wt(a,o,"playlist"),e.Wt(a.parsedPlaylist,c,"playlist.parsedPlaylist"),e.Wt(h,u,"statsProvider"),e.qt(a.playlistUrl,"playlist.playlistUrl"),e.qt(a.baseUrl,"playlist.baseUrl"),e.ee(f.targetLatency,"options.targetLatency"),f&&f.defaultPresentationDelay&&e.ee(f.defaultPresentationDelay,"options.defaultPresentationDelay"),this.ie=a,this.ne=this.ie.baseUrl,this.re=h,this.Ct=s||new i.Logger,this.se=new r(this.Ct),this.oe=new n.Event,this.ae=[],this.ue=0,this.ce=!1,this.he=t.get(f,"defaultPresentationDelay",k),this.fe=1e3*f.targetLatency,this.de={average:0,values:[],maxSize:10}}function d(t){var e=Math.max(this.fe?this.fe:0,0),i=this.ie.getPlaybackDurationSinceAvailable(),n=Math.max(Math.ceil((i-e)/t),0);return"static"===this.ie.getType()&&(n=0),this.Ct.trace("Getting chunk index to start: [%s], playbackTimePassed=[%s], duration=[%s]",n,i,t),n}function l(){var e=this;t.forEach(e.ae,function(t){t.setCurrentChunkId(m.call(e,t.getChunkDuration()))})}function m(t){var e=t/1e3;return Math.floor(this.ue/e)}function p(t){var e=1e3*this.ue+2*t.getChunkDuration()-this.ie.getPlaybackDurationSinceAvailable(),i=Math.max(e,0);return Math.min(t.getChunkDuration(),i)+this.de.average}function v(t,e,i,n){var r=this;(function(t,e,i){var n=this,r=function(t,e){return t.replace("$Number%05d$",("00000"+e).substr(-5))}(n.ne+t.getDataChunkUrlTemplate(),t.getCurrentChunkId()),s=t.getCurrentChunkId();n.Ct.trace("Fetching data chunk for [%s]: [%s], nextChunkId=[%s]",t.getMseCodec(),r,t.getCurrentChunkId());var o=t.getMseCodec();g.call(n,r,e,b,function(a,u){if(n.Ct.trace("DONE Fetching data chunk for [%s] : [%s], nextChunkId=[%s]",o,r,t.getCurrentChunkId()+(a?": FAILED: "+a.code:": data="+u.data.byteLength)),!a){n.re.addRateDataPoint(o,u.stats.successResponseTime,u.data.byteLength,.001);var c=u.stats.totalResponseTimeForAllAttempts-u.stats.successResponseTime-Math.max(e,0);if(n.de.values.push(c),n.de.average=(n.de.average*(n.de.values.length-1)+c)/n.de.values.length,n.de.values.length>n.de.maxSize){var h=n.de.values.shift();n.de.average=(n.de.average*(n.de.values.length+1)-h)/n.de.values.length}}if(!a&&s===t.getCurrentChunkId())return t.incrementCurrentChunkId(),n.ue=t.getChunkDuration()*t.getCurrentChunkId()/1e3,t.addDataChunk(u.data,s,function(){i(a)});a?(a.feederReason=404===a.code?"not yet available":"other",i(a)):i(null,u.data)})}).call(r,t,i,function(s){return s&&r.Ct.trace('Failed to fetch data chunk of stream for config [%s]". Error: [%s]',t,s),!s&&e>1&&v.call(r,t,e-1,i,n),n(s)})}function g(e,i,n,r){var s=this,o={responseType:"arraybuffer",retryOptions:{delay:n,maxAttempts:w},timeout:S};if(t.ee(i)&&0!==i)o.delay=i;else if(!t.isNullOrUndefined(i)&&0!==i)throw new Error('"delay" must be a positive number greater than or equal to 0 or null or undefined');return this.se.getWithRetry(e,o,function(i,n){if(i){if(s.Ct.debug("Failed to load next stream data chunk. Status code: [%s] (status text: [%s]) for [%s]",i.code,i.message,e),n&&n.attempts===w){var o="Failed to get chunk with max retries of ["+w+" after ["+t.get(n,["stats","totalResponseTimeForAllAttempts"],0)+"] ms";return s.Ct.warn(o),s.oe.fire([y(h.name.chunkNotFound.name,h.severity.CRITICAL,o)])}if(0===i.code){var a="Failed to get chunk with timeout after ["+t.get(n,["stats","totalResponseTimeForAllAttempts"],0)+"] ms with chunk timeout of ["+S+"]";return s.Ct.warn(a),s.oe.fire([y(h.name.timeout.name,h.severity.RECOVERABLE,a)])}return s.oe.fire([y(h.name.error.name,h.severity.CRITICAL,i)])}r(i,n)})}function y(t,e,i){return{category:h.category.STREAMING,name:t,severity:e,error:"Error"===i.constructor.name?i:new Error(i)}}var w=15,b=150,k=0,S=5e3;return f.prototype=Object.create(s.prototype),f.prototype.constructor=f,f.prototype.toString=function(){return"MpdPlaylistChunkFeeder [mpdPlaylistUrl="+this.ie.playlistUrl+", baseUrl="+this.ne+", defaultPresentationDelay="+this.he+"]"},f.prototype.addEventListener=function(t,i){switch(e.Xt(t,"eventName"),e.It(i,"listener"),t){case"error":return this.oe.listen(i);default:throw new Error('Event "'+t+'" is unknown.')}},f.prototype.dispose=function(){this.stopRequestingAllData(t.noop),this.se.dispose(),this.ie.dispose(),this.re.dispose(),this.oe.dispose(),this.ae=null,this.ue=0},f.prototype.initializeActiveTracks=function(i){var n=this;e.It(i,"callback");var r=t.filter(this.ae,function(t){return!t.getInitChunkData()});if(0===r.length)return i();(function(i,n){e.isArray(i,"tracks"),e.It(n,"callback");var r=0,s=this;t.forEach(i,function(t){e.Wt(t,a,"track"),t.setCurrentChunkId(d.call(s,t.getChunkDuration())),function(t,e){var i=this;(function(t,e){var i=this;i.Ct.trace("Fetching init chunk for [%s]: [%s], nextChunkId=[%s]",t.getMseCodec(),i.ne+t.getInitUrl(),t.getCurrentChunkId()),g.call(i,i.ne+t.getInitUrl(),null,500,function(n,r){i.Ct.trace("DONE Fetching init chunk for [%s]: [%s], nextChunkId=[%s]",t.getMseCodec(),i.ne+t.getInitUrl(),t.getCurrentChunkId()+(n?": FAILED: "+n.code:": data="+r.data.byteLength)),e(n,r.data)})}).call(i,t,function(n,r){if(n){var s=new Error("Failed to fetch init chunk of stream for config [%s]",t);return s.cause=n,i.Ct.error("[%s] (Cause: [%s])",s.message,n),e(s)}t.setInitChunkData(r),i.Ct.debug("Got init chunk for track [%s]",t.getTrackId()),e()})}.call(s,t,function(t){if(t)return n(t);++r===i.length&&n()})})}).call(n,r,i,function(t){return n.Ct.error("Unable to initialize active tracks",t),i(t)})},f.prototype.fetchNChunks=function(i,n){if(e.ee(i,"chunksToFetch"),e.It(n,"done"),this.isFetchingData())return this.Ct.debug("Unable to fetch requesting data. Feeder is already fetching data.");var r=this,s=0;r.Ct.debug("Fetching [%s] chunks for [%s] active tracks",i,this.ae.length),t.forEach(this.ae,function(t){e.Wt(t,a,"track");var i=Math.min(Math.floor(r.le/t.getChunkDuration),1);return t.setCurrentChunkId(d.call(r,t.getChunkDuration())),v.call(r,t,i,null,function(e){return e?(r.Ct.warn("Failed to get [%s] chunks for track [%s]",i,t.getTrackId(),e),n(e)):++s===r.ae.length?(r.Ct.info("Got [%s] chunks for [%s] active tracks",i,r.ae.length),n()):void 0})})},f.prototype.setActiveTracks=function(t){this.ae=t},f.prototype.getActiveTracks=function(){return this.ae},f.prototype.startRequestingDataForActiveTracks=function(){if(this.isFetchingData())return this.Ct.debug("Unable to start requesting data. Feeder is already fetching data.");this.ce=!0,this.Ct.debug("Starting requesting data at timestamp [%s]",this.ue),l.call(this),function e(i){var n=this,r=n.ae.length;t.forEach(n.ae,function(s,o){!function(s,o){if(t.find(n.ae,function(t){return t.getMimeType()===s.getMimeType()})===s){var a=m.call(n,s.getChunkDuration()),u=a>=s.getTotalNumberOfChunks();if("static"===n.ie.getType()&&u)return o===r-1&&(n.ce=!1),n.Ct.info("Finished getting chunks for [static] track [%s] [%s]",s.getTrackId(),s.getMimeType());t.isNullOrUndefined(i)&&"dynamic"===n.ie.getType()&&(i=p.call(n,s)),v.call(n,s,1,i,function(t){if(t&&t.causes&&t.causes.length>0&&"not yet available"===t.causes[0].feederReason?n.Ct.info("Failed to get next chunk (packet not yet available) for [%s]|[%s]. Trying to fetch again in [%s] ms.",s.getMseCodec(),s.getBandwidth(),b):(t&&n.Ct.warn("Failed to get next chunk (# of errors=[%s], errors=[%s]). Moving on.",t.causes?t.causes.length:"n/a",t),r--),r<=0&&n.ce){if("dynamic"===n.ie.getType()){var i=p.call(n,s);return n.Ct.debug("Done fetching chunk with index [%s] for each active track. Waiting for [%s] ms before moving on to next chunk.",a,i),e.call(n,i)}n.Ct.debug("Done fetching chunk with index [%s] for each active track. Moving on to next chunk",a),e.call(n,null)}})}}(s,o)})}.call(this,null)},f.prototype.isFetchingData=function(){return this.ce},f.prototype.seekToChunk=function(t){this.ue=Math.floor(t),this.Ct.debug("Seeking to timestamp [%s]",this.ue),l.call(this)},f.prototype.seekToCurrent=function(){var e=t.reduce(this.ae,function(t,e){return e.getChunkDuration()>t?e.getChunkDuration():t},0),i=(Math.max(this.ie.getPlaybackDurationSinceAvailable(),0)-Math.max(this.fe?this.fe:0,e))/1e3;return this.Ct.info("Seeking to most recent chunk"),this.seekToChunk(i),i},f.prototype.stopRequestingAllData=function(){this.ce&&(this.ce=!1,this.Ct.debug("Pausing requesting of data at timestamp [%s]",this.ue),this.se.disposePendingRequests())},f}.apply(e,n))&&(t.exports=r)},function(t,e,i){var n,r;n=[i(1),i(0),i(10),i(4)],void 0!==(r=function(t,e,i,n){"use strict";function r(t){e.Rt(t,"logger"),this.Ct=t,this.me=new n.DisposableList}return r.prototype.toString=function(){return"HttpRequestManager"},r.prototype.disposePendingRequests=function(){this.me.dispose(),this.me=new n.DisposableList},r.prototype.dispose=function(){this.disposePendingRequests()},r.prototype.getWithRetry=function(n,r,s){e.qt(n,"url"),e.Rt(r,"options"),e.It(s,"callback");var o=this;r.retryOptions=t.assign({delay:0,backoff:1,maxAttempts:1,additionalRetryErrorCodes:[404,0]},r.retryOptions),this.me.add(i.getWithRetry(n,r,function(t,e){return t&&4e3===t.code?o.Ct.debug("Request handler disposed of before response received for get [%s]",n):(t&&o.Ct.debug("Status code: [%s] (status text: [%s]) for get [%s]",t.code,t.message,n),s(t,e))}))},r}.apply(e,n))&&(t.exports=r)},function(t,e,i){var n,r;n=[i(1),i(0),i(2),i(3),i(16),i(12),i(5),i(7),i(9),i(14),i(6)],void 0!==(r=function(t,e,i,n,r,s,o,a,u,c,h){"use strict";function f(s,a,u,h){e.Wt(a,o,"playlist"),e.Wt(a.parsedPlaylist,c,"playlist.parsedPlaylist"),e.qt(a.playlistUrl,"playlist.playlistUrl"),e.qt(a.baseUrl,"playlist.baseUrl"),h&&h.targetLatencyInMilliseconds&&e.ee(h.targetLatencyInMilliseconds,"options.targetLatencyInMilliseconds"),this.ie=a,this.ne=this.ie.baseUrl,this.re=u,this.Ct=s||new i.Logger,this.se=new r(this.Ct),this.h=h,this.oe=new n.Event,this.ae=[],this.ue=0,this.ce=!1,this.fe=t.get(h,"targetLatencyInMS",0),this.pe=Math.max(this.ie.getSuggestedPresentationDelayTotalMillis(),this.ie.getMinBufferTimeTotalMillis(),this.he),this.ve=Math.max(this.ie.getPlaybackDurationSinceAvailable()-this.pe,0)}function d(){var e=this;t.ee(e.ge)||(e.ge=setTimeout(function(){(function(e){var i=this,n=0;t.forEach(this.ae,function(r){var s=r.getMediaSegmentPlaylistUrlInfo(),o=t.assign({version:t.now()},s.queryParameters),a={retryOptions:{delay:w,maxAttempts:b},queryParameters:o};i.se.getWithRetry(s.url,a,function(t,o){if(t)return i.Ct.debug("Unable to get media segment playlist [%s]",s.url);o&&r.updateMediaSegments(o.data),++n===i.ae.length&&e()})},y)}).call(e,function(){t.isNullOrUndefined(e.ge)||(e.ge=null,d.call(e))})},y))}function l(e){var i=this,n=i.ae.length;i.ye=!1,t.forEach(i.ae,function(r,s){!function(r){t.find(i.ae,function(t){return t.getMimeType()===r.getMimeType()})!==r?i.Ct.debug("Wrong track type [%s]. Pausing fetching for track [%s]",r.getMimeType(),r.getTrackId()):r.isLastMediaSegment(i.ue)?("dynamic"===i.ie.getType()&&(i.ye=!0),i.Ct.debug("No more chunks. Pausing fetching for track [%s]",r.getMimeType(),r.getTrackId())):m.call(i,r,1,e,function(t){if(t&&t.causes&&t.causes.length>0&&"not yet available"===t.causes[0].feederReason?i.Ct.info("Failed to get next chunk (packet not yet available) for [%s]|[%s]. Trying to fetch again in [%s] ms.",r.getMseCodec(),r.getBandwidth(),g):(t&&i.Ct.warn("Failed to get next chunk (# of errors=[%s], errors=[%s]). Moving on.",t.causes?t.causes.length:"n/a",JSON.stringify(t)),n--),n<=0){i.Ct.debug("Done fetching chunk for timestamp [%s] for each active track. Moving on to next chunk. (keep fetching=[%s])",i.ue,i.ce);var e=r.isLastMediaSegment(i.ue);if("static"===i.ie.getType()&&e)return i.ce=!1,i.Ct.info("Finished getting chunks for [static] track [%s] [%s]",r.getTrackId(),r.getMimeType());if(e)return i.ye=!0,i.Ct.debug("Waiting for new segment on the Segment Playlist for [dynaimic] track [%s] [%s]",r.getTrackId(),r.getMimeType());i.ce&&l.call(i,null)}})}(r)})}function m(e,i,n,r){var s=this;(function(e,i,n){var r=this,s=e.getSegmentByTimestamp(r.ue),o=r.ne+s.name;r.Ct.trace("Fetching data chunk for [%s]: [%s], next segment=[%s]",e.getMseCodec(),o,s.name);var a=e.getMseCodec();(function(e,i,n){var r=this,s={responseType:"arraybuffer",retryOptions:{delay:g,maxAttempts:v},timeout:k};if(t.ee(i))s.delay=i;else if(!t.isNullOrUndefined(i))throw new Error('"delay" must be a number or null or undefined');return this.se.getWithRetry(e,s,function(i,s){if(i){if(r.Ct.debug("Failed to load next stream data chunk. Status code: [%s] (status text: [%s]) for [%s]",i.code,i.message,e),s&&s.attempts===v){var o="Failed to get chunk with max retries of ["+v+" after ["+t.get(s,["stats","totalResponseTimeForAllAttempts"],0)+"] ms";return r.oe.fire([p(h.name.chunkNotFound.name,h.severity.CRITICAL,o)])}if(0===i.code){var a="Failed to get chunk with timeout after ["+t.get(s,["stats","totalResponseTimeForAllAttempts"],0)+"] ms with chunk timeout of ["+k+"]";return r.oe.fire([p(h.name.timeout.name,h.severity.RECOVERABLE,a)])}return r.oe.fire([p(h.name.error.name,h.severity.CRITICAL,i)])}n(i,s)})}).call(r,o,i,function(t,i){if(r.Ct.trace("DONE Fetching data chunk for [%s] : [%s], next segment=[%s]",a,o,s.name+(t?": FAILED: "+t.code:": data="+i.data.byteLength)),t||r.re.addRateDataPoint(a,i.stats.successResponseTime,i.data.byteLength,.001),!t)return r.Ct.debug("Finished fetching [%s]. Updating timestamp to fetch to [%s]",s.name,s.timestamp+s.duration),r.ue=s.timestamp+s.duration,e.addDataChunk(i.data,s.name,function(){n(t)});t?(t.feederReason=404===t.code?"not yet available":"other",n(t)):n(null,i.data)})}).call(s,e,n,function(t){return t&&s.Ct.trace('Failed to fetch data chunk of stream for config [%s]". Error: [%s]',JSON.stringify(e),t),!t&&i>1&&m.call(s,e,i,n,r),r(t)})}function p(t,e,i){return{category:h.category.STREAMING,name:t,severity:e,error:"Error"===i.constructor.name?i:new Error(i)}}var v=15,g=700,y=500,w=10,b=2,k=5e3;return f.prototype=Object.create(s.prototype),f.prototype.constructor=f,f.prototype.toString=function(){return"M3u8PlaylistChunkFeeder [mpdPlaylistUrl="+this.ie.playlistUrl+", baseUrl="+this.ne+", defaultPresentationDelay="+this.he+"]"},f.prototype.addEventListener=function(t,i){switch(e.Xt(t,"eventName"),e.It(i,"listener"),t){case"error":return this.oe.listen(i);default:throw new Error('Event "'+t+'" is unknown.')}},f.prototype.dispose=function(){this.stopRequestingAllData(t.noop),this.se.dispose(),this.ie.dispose(),this.re.dispose(),this.ae=null,this.ue=0,this.we&&(this.we.dispose(),this.we=null)},f.prototype.initializeActiveTracks=function(i,n){e.It(n,"callback"),"dynamic"===this.ie.getType()&&d.call(this),this.ye=!1;var r=this;if(1!==this.ae.length)throw new Error("Unable to support multiple active tracks");t.forEach(this.ae,function(t){r.we=t.addEventListener("segmentsready",function(){r.ye&&(r.Ct.debug("Continuing fetching of track [%s] segments after wait",t.getTrackId()),l.call(r,null))})}),n()},f.prototype.fetchNChunks=function(i,n){if(e.ee(i,"chunksToFetch"),e.It(n,"callback"),this.isFetchingData())return this.Ct.debug("Unable to fetch requesting data. Feeder is already fetching data.");var r=this,s=0;r.Ct.debug("Fetching [%s] chunks for [%s] active tracks",i,this.ae.length),t.forEach(this.ae,function(e){m.call(r,e,1,null,function(e){if(e)return n(e);++s===r.ae.length&&(r.be=t.now(),n())})})},f.prototype.setActiveTracks=function(e){this.ae=e;var i=t.map(e,function(t){return t.getTrackId()});this.Ct.debug("Setting active tracks [%s]",i)},f.prototype.getActiveTracks=function(){return this.ae},f.prototype.startRequestingDataForActiveTracks=function(){if(this.isFetchingData())return this.Ct.debug("Unable to start requesting data. Feeder is already fetching data.");this.ce=!0,this.Ct.debug("Starting requesting data at timestamp [%s]",this.ue),"dynamic"===this.ie.getType()&&d.call(this),l.call(this,null)},f.prototype.isFetchingData=function(){return this.ce},f.prototype.seekToChunk=function(e){var i=t.get(this.ae,["0"]),n=i.getClosestSegmentNotGreaterThanTimestamp(e),r=t.get(n,["timestamp"]);t.isUndefined(r)?i||(this.ue=e):this.ue=Math.floor(n.timestamp),this.Ct.debug("Seeking to timestamp [%s]",this.ue)},f.prototype.seekToCurrent=function(){var e=t.reduce(this.ae,function(e,i){var n=t.get(i.getLastSegment(),["duration"],0);return n>e?n:e},0),i=(t.reduce(this.ae,function(t,e){var i=e.getLastSegment().timestamp;return i<t?i:t},0)-Math.max(this.fe?this.fe-e:0,e))/1e3;return this.Ct.info("Seeking to most recent chunk"),this.seekToChunk(i),i},f.prototype.stopRequestingAllData=function(){this.ce&&(this.ce=!1,this.ye=!1,this.Ct.debug("Pausing requesting of data at timestamp [%s]",this.ue),this.se.disposePendingRequests(),clearTimeout(this.ge),this.ge=null)},f}.apply(e,n))&&(t.exports=r)},function(t,e,i){var n,r;n=[i(1),i(0),i(2),i(3),i(10),i(4),i(11),i(8),i(6)],void 0!==(r=function(t,e,i,n,r,s,o,a,u){"use strict";function c(r,o,c,d){e.Rt(o,"videoElement");var C=this;this.Dt=o,this.Ct=r||new i.Logger,this.ke=null,this.Se=null,this.Ee=null,this.v=new s.DisposableList;var M=t.bind(R,this);"Safari"===v.browser&&(M=t.bind(function(e,i){var n=this;if(i=i||1,!this.Te){if(i<=E)return n.Ct.debug("Attempt [%s] for checking if the certificate have been set",i),void(n.Ee=setTimeout(function(){R.call(n,e,i+1)},S));var r="Unable to find fairplay certificate after "+(i-1)+" attempts";return n.Ct.warn(r),n.Ie.fire([p("NoCertificate",u.severity.RECOVERABLE,r)])}this.Ct.info("Key requested by Webkit browser"),n.Re="https://"+function(t){return String.fromCharCode.apply(null,new a.global.Uint16Array(t.buffer))}(e.initData).split("skd://")[1];var o="phenix-fairplay-"+t.now(),c=function(t,e,i){var n=function(t){for(var e=new a.global.ArrayBuffer(2*t.length),i=new a.global.Uint16Array(e),n=0,r=t.length;n<r;n++)i[n]=t.charCodeAt(n);return i}(e),r=0,s=new a.global.ArrayBuffer(t.byteLength+4+n.byteLength+4+i.byteLength),o=new a.global.DataView(s);new Uint8Array(s,r,t.byteLength).set(t),r+=t.byteLength,o.setUint32(r,n.byteLength,!0),r+=4;var u=new a.global.Uint16Array(s,r,n.length);return u.set(n),r+=u.byteLength,o.setUint32(r,i.byteLength,!0),r+=4,new Uint8Array(s,r,i.byteLength).set(i),new Uint8Array(s,0,s.byteLength)}(e.initData,o,n.Te);if(n.Dt.webkitKeys||n.Dt.webkitSetMediaKeys(new a.global.WebKitMediaKeys(b)),!n.Dt.webkitKeys)return n.Ie.fire([p("webkitKeys",u.severity.RECOVERABLE,new Error("Could not create MediaKeys"))]);var h=n.Dt.webkitKeys.createSession("video/mp4",c);if(!h)return n.Ie.fire([p("webkitKeySession",u.severity.RECOVERABLE,new Error("Could not create key session"))]);var d=t.bind(f,n);h.addEventListener("webkitkeymessage",d,!1),n.v.add(new s.Disposable(function(){h.removeEventListener("webkitkeymessage",d,!1)}));var l=function(){n.Ct.info("Decryption key was added")};h.addEventListener("webkitkeyadded",l,!1),n.v.add(new s.Disposable(function(){h.removeEventListener("webkitkeyadded",l,!1)}));var m=function(t){n.Ie.fire([p("webkitkeyerror",u.severity.RECOVERABLE,t)])};h.addEventListener("webkitkeyerror",m,!1),n.v.add(new s.Disposable(function(){h.removeEventListener("webkitkeyerror",m,!1)}))},this)),this.Dt.addEventListener(I,M,!1),this.v.add(new s.Disposable(function(){C.Dt.removeEventListener(I,M,!1)})),this.v.add(new s.Disposable(function(){null!==C.Se&&a.global.clearTimeout(C.Se)})),this.v.add(new s.Disposable(function(){null!==C.Ee&&a.global.clearTimeout(C.Ee)})),this.Ce={initDataTypes:["cenc"],videoCapabilities:[{contentType:'video/mp4; codecs="avc1.42c01f"'}],audioCapabilities:[{contentType:'audio/mp4; codecs="mp4a.40.2"'}],persistentState:"optional",distinctiveIdentifier:"optional"},this.x={},"Edge"===v.browser||"IE"===v.browser?this.Me=y:"Safari"===v.browser?this.Me=b:this.Me=g,function(e,i){var n=this,r=function(e){return t.keys(t.reduce(e,function(t,e){return t[e]=1,t},{}))}(t.keys(e).concat(t.keys(i)));t.forEach(r,function(r){t.set(n.x,[r],t.assign({},t.get(e,[r],{}),t.get(i,[r],{}))),t.set(n.x,[r,"mediaKeySystemConfiguration"],t.assign({},n.Ce,t.get(e,[r,"mediaKeySystemConfiguration"],{}),t.get(i,[r,"mediaKeySystemConfiguration"],{})))})}.call(this,function(e){return t.reduce(e,function(e,i){var n="com.phenixp2p.widevine"===i.schemeIdUri||"com.phenixrts.widevine"===i.schemeIdUri?g:i.schemeIdUri===w?y:i.schemeIdUri,r="",s="";return"com.phenixp2p.widevine"!==i.schemeIdUri&&"com.phenixrts.widevine"!==i.schemeIdUri||(r=i.widevineLicenseServerUrl||i.licenseServerUrl,s=i.serverCertificateUrl),e[n]={licenseServerUrl:r?h(r):"",serverCertificateUrl:s?h(s):""},t.forOwn(i,function(i,r){t.startsWith(r,"mediaKeySystemConfiguration.")&&t.set(e[n],r,i)}),e},{})}(c),d||{}),function(){e.Rt(this.x,"this._config");var i=this;t.forOwn(this.x,function(t,n){e.Pe(n,k,n),n===i.Me&&(n!==g&&n!==b||e.qt(t.serverCertificateUrl,n+"[serverCertificateUrl]"),e.Rt(t.mediaKeySystemConfiguration,n+"[mediaKeySystemConfiguration]"),e.xe(t.mediaKeySystemConfiguration.initDataTypes,n+"[mediaKeySystemConfiguration][initDataTypes]"),e.isArray(t.mediaKeySystemConfiguration.videoCapabilities,n+"[mediaKeySystemConfiguration][videoCapabilities]"),e.isArray(t.mediaKeySystemConfiguration.audioCapabilities,n+"[mediaKeySystemConfiguration][audioCapabilities]"),e.qt(t.mediaKeySystemConfiguration.persistentState,n+"[mediaKeySystemConfiguration][persistentState]"),e.qt(t.mediaKeySystemConfiguration.distinctiveIdentifier,n+"[mediaKeySystemConfiguration][distinctiveIdentifier]"))})}.call(this),this.Ie=new n.Event,this.De=new n.Event,this.v.add(this.Ie),this.v.add(this.De),T&&function(){var e=this;if(!this.Dt.mediaKeys){var i=t.get(this.x,[this.Me,"mediaKeySystemConfiguration"]);a.global.navigator.requestMediaKeySystemAccess(this.Me,[i]).then(function(i){i.createMediaKeys().catch(function(t){e.Ie.fire([p("CreateMediaKeys",u.severity.CRITICAL,t)]),e.Ct.error("Unable to create MediaKeys",t)}).then(function(t){return e.ke=t,e.Dt.setMediaKeys(t)}).catch(function(t){e.Ie.fire([p("SetMediaKeys",u.severity.CRITICAL,t)]),e.Ct.error("Unable to set MediaKeys",t)}).then(function(){return new a.global.Promise(function(i){var n=t.get(e.x,[e.Me,"serverCertificateUrl"]);if(!n)return e.Ct.info("Not fetching server certificate because [%s] -> [serverCertificateUrl] is not set",e.Me),i();l(n,function(t,n){if(t)return e.Ct.warn("Failed to get service certificate",t),i();var r=m(n.data);return e.ke.setServerCertificate(r).then(i).catch(function(t){e.Ct.warn("Failed to set service certificate",t)})})})})}).catch(function(t){e.Ie.fire([p("RequestMediaKeySystemAccess",u.severity.CRITICAL,t)]),e.Ct.error("[%s] Unable to request MediaKeySystemAccess with error [%s]",e.Me,t)})}}.call(this),"Safari"===v.browser&&(a.global.WebKitMediaKeys.isTypeSupported("com.apple.fps.1_0","video/mp4")||C.Ie.fire([p("isTypeSupported",u.severity.CRITICAL,new Error("com.apple.fps.1_0 Key System not supported"))]),l(t.get(C.x,[C.Me,"serverCertificateUrl"]),function(t,e){t&&(C.Ie.fire([p("getServerCertificateFairplay",u.severity.CRITICAL,t)]),C.Ct.error("[Fairplay] Failed to get service certificate",t)),C.Te=m(e.data)}))}function h(i){e.qt(i,"xmlSafeUrl");var n=i.split("?"),r=t.get(n,[0]),s=t.get(n,[1],"");return r+(s?"?"+decodeURIComponent(s):"")}function f(e){var i=this,n=e.target;d.call(this,e.message,function(e,r){if(e)return i.Ie.fire([p("LicenseRetrieval",u.severity.RECOVERABLE,e)]);try{var s=n.update(r)}catch(t){return i.Ie.fire([p("KeySessionUpdate",u.severity.CRITICAL,t)])}t.It(t.get(s,["catch"]))&&s.catch(function(t){i.Ie.fire([p("KeySessionUpdate",u.severity.CRITICAL,t)]),i.Ct.error("Update of keySession with license failed [%s]",t)})})}function d(i,n){var s,o=this,u=t.get(this.x,[this.Me,"licenseServerUrl"],this.Re),c={};if(e.qt(u,"licenseServerUrl"),this.Me===y){var h=(new DOMParser).parseFromString(String.fromCharCode.apply(null,new a.global.Uint16Array(i)),"application/xml");if(!h.getElementsByTagName("Challenge")[0])return n(new Error("[Playready] Cannot find `challenge` in key message"));s=atob(h.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue);var f=h.getElementsByTagName("name"),d=h.getElementsByTagName("value");if(f.length!==d.length)return n(new Error("[Playready] Mismatched header name/value pair in key message"));c.headers={};for(var l=0;l<f.length;l++){var m=t.get(f,[l,"childNodes",0,"nodeValue"]),p=t.get(d,[l,"childNodes",0,"nodeValue"]);m&&p&&(c.headers[m]=p)}c.responseType="arraybuffer"}else c.contentType="application/octet-stream",s=i;r.post(u,s,c,function(t,e){if(t)return o.Ct.error("Failed to get license with [%s] [%s]",t,e),n(t);if(o.Me===y)return n(null,e.data);var i=e.data,r=null,s=null;try{o.Ct.debug("Attempting to unwrap license response"),r=(i=JSON.parse(i)).license||i.ckc,i.trackRestrictions&&o.De.fire([i.trackRestrictions])}catch(t){if(!(t instanceof SyntaxError))return o.Ct.error("Unexpected error [%s]",t),n(t);o.Ct.debug("Unwrapping of license failed. Assuming that license response is already unwrapped"),r=i}"<ckc>"===r.substr(0,5)&&"</ckc>"===r.substr(-6)&&(r=r.slice(5,-6));try{s=function(t){for(var e=a.global.atob(t),i=new Uint8Array(e.length),n=0;n<e.length;++n)i[n]=e.charCodeAt(n);return i}(r)}catch(t){o.Ct.error("Failed to convert base64 license string [%s] to binary",r),n(t)}n(null,s)})}function l(t,e){r.get(t,{mimeType:"text/plain; charset=x-user-defined"},e)}function m(t){for(var e=t.length,i=new a.global.Uint8Array(e),n=0;n<e;n++)i[n]=t.charCodeAt(n);return i}function p(t,e,i){return{category:u.category.DRM,name:t,severity:e,error:"Error"===i.constructor.name?i:new Error(i)}}var v=new o(a.global.navigator.userAgent).detect(),g="com.widevine.alpha",y="com.microsoft.playready",w="urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95",b="com.apple.fps.1_0",k=t.freeze([{id:1,name:"org.w3.clearkey"},{id:2,name:g},{id:3,name:y},{id:4,name:w},{id:5,name:b}]),S=200,E=20,T=!!a.global.navigator.requestMediaKeySystemAccess,I="encrypted";T||"Edge"!==v.browser&&"IE"!==v.browser||(I="msneedkey"),"Safari"===v.browser&&(I="webkitneedkey"),c.isSupported=function(){return!(("IE"!==v.browser||11!==v.version)&&("Safari"===v.browser?t.isNullOrUndefined(a.global.WebKitMediaKeys)||t.isNullOrUndefined(a.global.Uint16Array)||t.isNullOrUndefined(a.global.Uint8Array)||t.isNullOrUndefined(a.global.ArrayBuffer)||t.isNullOrUndefined(a.global.DataView):t.isNullOrUndefined(a.global.navigator.requestMediaKeySystemAccess)||t.isNullOrUndefined(a.global.Promise)||t.isNullOrUndefined(a.global.Uint8Array)||t.isNullOrUndefined(a.global.atob)))},c.prototype.addEventListener=function(t,i){switch(e.Xt(t,"eventName"),e.It(i,"listener"),t){case"trackRestrictionsAvailable":return this.De.listen(i);case"error":return this.Ie.listen(i);default:throw new Error('Event "'+t+'" is unknown.')}},c.prototype.toString=function(){return"EncryptedMediaHandler [config="+JSON.stringify(this.x)+"]"},c.prototype.dispose=function(){this.v.dispose(),delete this.ke};var R=function(e,i){var n=this;if(i=i||1,!T)try{this.Dt.msSetMediaKeys(new a.global.MSMediaKeys(this.Me))}catch(r){return n.Ie.fire([p("RequestMediaKeySystemAccess",u.severity.CRITICAL,new Error('Unable to create MediaKeys ("'+this.Me+'"). Error: '+r.message))])}if(!this.ke&&!n.Dt.msKeys){if(i<=20)return n.Ct.debug("Attempt [%s] for checking if the media keys have been set",i),void(n.Se=setTimeout(function(){R.call(n,e,i+1)},S));var r="Unable to find media keys after "+(i-1)+" attempts";return n.Ct.warn(r),n.Ie.fire([p("NoMediaKeys",u.severity.RECOVERABLE,r)])}if(n.Dt.msKeys){var o=n.Dt.msKeys.createSession("video/mp4",e.initData);o||n.Ie.fire([p("NoKeySession",u.severity.CRITICAL,new Error("Could not create key session"))]);var c=function(t){d.call(n,t.message.buffer,function(t,e){if(t)return n.Ie.fire([p("getLicense",u.severity.RECOVERABLE,t)]);o.update(new Uint8Array(e))})};o.addEventListener("mskeymessage",c,!1),n.v.add(new s.Disposable(function(){o.removeEventListener("mskeymessage",c,!1)}));var h=function(){n.Ie.fire([p("MicrosoftKeyError",u.severity.CRITICAL,new Error("Unexpected `keyerror` event from key session. Code: "+o.error.code+", systemCode: "+o.error.systemCode))])};return o.addEventListener("mskeyerror",h,!1),void n.v.add(new s.Disposable(function(){o.removeEventListener("mskeyerror",h,!1)}))}var l=n.ke.createSession(),m=t.bind(f,n);return l.addEventListener("message",m,!1),n.v.add(new s.Disposable(function(){l.removeEventListener("message",m,!1)})),l.generateRequest(e.initDataType,e.initData).then(function(){n.Ct.info("passing the media data to CDM")}).catch(function(t){n.Ie.fire([p("InitKeySessionFailure",u.severity.CRITICAL,t)]),n.Ct.error("Unable to create or initialize key session [%s]",t)})};return c}.apply(e,n))&&(t.exports=r)},function(t,e){t.exports=f},function(t,e,i){var n,r;n=[i(1),i(0),i(2),i(4),i(19),i(5),i(9)],void 0!==(r=function(t,e,i,n,r,s,o){"use strict";function a(a,d,v,g){e.Wt(d,s,"playlist"),e.Oe(v,"webPlayer"),e.Wt(g,o,"statsProvider"),this.ie=d,this.Ae=v,this.re=g,this.Ct=a||new i.Logger,this.qe={nextSwitchCheckTime:t.now()+5e3,oldBandwidth:-1},this.v=new n.DisposableList,this.Ae.addEventListener("started",t.bind(function(){var e=this;this.Ue=t.reduce(this.ie.getMimeTypes(),function(i,n){var r=e.ie.getPlaylistTracksByMimeType(n)||[],s=t.filter(r,function(e){return t.ee(e.getBandwidth())}),o=t.map(s,function(t){return t.getBandwidth()});return r.length>s.length&&e.Ct.info("Excluding [%s] tracks without Bandwidth from ABR switching.",r.length-s.length),i[n]={max:Math.max.apply(null,o),min:Math.min.apply(null,o)},i},{}),this.Ct.debug("Listening for bandwidth changes with max and min bandwidths of [%s]",this.Ue),this.Ae.addEventListener("playbacktimeleft",t.bind(function(e,i){if(!this.qe.isInProgress&&r.isForeground()){var n=this.Ue[i.getMimeType()],s=this;if(this.qe.nextSwitchCheckTime>0){if(this.qe.nextSwitchCheckTime>t.now())return;this.qe.nextSwitchCheckTime=0,this.qe.oldBandwidth=-1}var o=t.bind(function(){this.qe.isInProgress=!1},this);if(u.call(s,i,e)&&i.getBandwidth()<n.max){this.qe.isInProgress=!0;var a=this.ie.getPlaylistTrackByMimeTypeAndNextHighestBandwidth(i.getBandwidth(),i.getMimeType());this.Fe=setTimeout(function(){u.call(s,i,s.Ae.getTimeLeft())?(s.Ct.info("Switching to higher quality track with [%s] time left in buffer and ewma of [%s].",s.Ae.getTimeLeft(),h.call(s,i)),s.qe.nextSwitchCheckTime=t.now()+1e3*e+l,s.qe.oldBandwidth=i.getBandwidth(),s.Ae.changeBandwidthLimit(a.getBandwidth(),o)):s.qe.isInProgress=!1},p)}else if(c.call(s,i,e)&&i.getBandwidth()>n.min){this.qe.isInProgress=!0;var f=this.ie.getPlaylistTrackByBandwidthAndMimeType(i.getBandwidth()-1,i.getMimeType());this.Fe=setTimeout(function(){c.call(s,i,s.Ae.getTimeLeft())?(s.Ct.info("Switching to lower quality track with [%s] time left in buffer and ewma of [%s].",s.Ae.getTimeLeft(),h.call(s,i)),s.qe.nextSwitchCheckTime=t.now()+1e3*e+m,s.qe.oldBandwidth=i.getBandwidth(),s.Ae.changeBandwidthLimit(f.getBandwidth(),o)):s.qe.isInProgress=!1},p)}}},this))},this)),this.v.add(r.onBackground(t.bind(f,this,!1))),this.v.add(r.onForeground(t.bind(f,this,!0))),this.Ne=null,this.je=null}function u(t,e){var i=this.re.getRateAverages(t.getMseCodec()).ewmaDuration,n=t.getChunkDuration();return e>3.5||i>0&&i<=3*n/4&&e/(n/1e3)>2}function c(t,e){var i=this.re.getRateAverages(t.getMseCodec()).ewmaDuration,n=t.getChunkDuration();return e<.7||i>0&&i>=7*n/8&&e/(n/1e3)<=1.5}function h(t){return this.re.getRateAverages(t.getMseCodec()).ewmaDuration}function f(e){null!==this.Fe&&(clearTimeout(this.Fe),this.Fe=null);var i=this.Ae.getVideoElement();if(e){if(clearTimeout(this.Ne),this.Ne=null,null===this.je)return;var n=this.je;return this.je=null,n!==this.Ae.getBandwidthLimit()&&(this.qe.nextSwitchCheckTime=t.now()+l,this.Ct.info("Detected change to [foreground] for tab. Reverting to [%s] previous bandwidth limit from [%s]",n,this.Ae.getBandwidthLimit()),this.Ae.changeBandwidthLimit(n)),void(d(i)||"dynamic"!==this.ie.getType()||(this.Ct.info("Detecting application [foreground] with muted video. Resuming playback at most recent available chunk."),this.Ae.play()))}var s=this;this.Ne=setTimeout(function(){r.isForeground()||(s.je=s.Ae.getBandwidthLimit(),d(i)||"dynamic"!==s.ie.getType()||(s.Ct.info("Detecting application [background] with muted video. Pausing playback until application focused again."),s.Ae.pause()))},v)}function d(e){return!e.muted&&0!==e.volume&&(t.get(e,["webkitAudioDecodedByteCount"],0)>0||t.get(e,["audioTracks","length"],0)>0||e.mozHasAudio||e.hasAudio||e.webkitHasAudio)}var l=15e3,m=5e3,p=500,v=3e3;return a.prototype.dispose=function(){null!==this.Fe&&clearTimeout(this.Fe),null!==this.Ne&&clearTimeout(this.Ne),this.v.dispose(),this.Ne=null,this.Fe=null},a}.apply(e,n))&&(t.exports=r)},function(t,e,i){"use strict";var n,r;n=[i(5),i(15),i(17),i(27),i(9),i(20),i(6)],void 0!==(r=function(t,e,i,n,r,s,o){return{Playlist:t,MpdPlaylistChunkFeeder:e,M3u8PlaylistChunkFeeder:i,WebPlayer:n,StatsProvider:r,AdaptiveStreamingManager:s,isSupported:n.isSupported,errors:o}}.apply(e,n))&&(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(3),i(2),i(7)],void 0!==(r=function(t,e,i,n){"use strict";function r(n,r,a){if(t.Rt(n,"logger"),t.Rt(r,"playlistTrackConfig"),t.qt(r.codec,"playlistTrackConfig.codec"),t.qt(r.mimeType,"playlistTrackConfig.mimeType"),t.ee(r.bandwidth,"playlistTrackConfig.bandwidth"),t.ee(r.chunkDuration,"playlistTrackConfig.chunkDuration"),t.qt(r.trackId,"playlistTrackConfig.trackId"),t.qt(r.initUrl,"playlistTrackConfig.initUrl"),t.qt(r.dataChunkUrlTemplate,"playlistTrackConfig.dataChunkUrlTemplate"),t.ee(r.chunkDuration,"playlistTrackConfig.chunkDuration"),a=a||{},this.Ct=n||new i.Logger,this.Le=r.codec,this.Be=r.chunkDuration,this._e=r.bandwidth,this.dt=r.height,this.We=r.trackId,this.ze=r.mimeType,this.Ve=r.initUrl,this.He=r.dataChunkUrlTemplate,this.Ge=r.totalNumberOfChunks,this.Je=null,this.Ke=a.maxChunksToCache||s,this.Xe=a.lowWaterMaxChunks||o,t.ee(this.Ke,"options.maxChunksToCache"),t.ee(this.Xe,"options.lowWaterMaxChunks"),this.Xe>=this.Ke)throw new Error('The "maxChunksToCache" cannot be less than or equal to the "lowWaterMaxChunks"');this.Qe=null,this.$e=[],this.Ye=new e.Event}var s=20,o=15;return r.prototype=Object.create(n.prototype),r.prototype.constructor=r,r.prototype.toString=function(){return"MpdPlaylistTrack [mseCodec="+this.Le+", maxChunksToCache="+this.Ke+", lowWaterMaxChunks="+this.Xe+", initChunk="+this.Qe+", dataChunks(size)="+this.$e.length+", chunkAddedEvent(size)="+this.Ye.size()+", trackId="+(this.We?this.We:"n/a")+", bandwidth="+(this.bandwidth?this.bandwidth:"n/a")+"]"},r.prototype.dispose=function(){this.$e=[],this.Ye.dispose()},r.prototype.getMseCodec=function(){return this.Le},r.prototype.getTrackId=function(){return this.We},r.prototype.getChunkDuration=function(){return this.Be},r.prototype.getBandwidth=function(){return this._e},r.prototype.getHeight=function(){return this.dt},r.prototype.getMimeType=function(){return this.ze},r.prototype.getTotalNumberOfChunks=function(){return this.Ge},r.prototype.getInitChunkData=function(){return this.Qe},r.prototype.setInitChunkData=function(t){this.Qe=t},r.prototype.getCurrentChunkId=function(){return this.Je},r.prototype.setCurrentChunkId=function(t){this.Je=t},r.prototype.incrementCurrentChunkId=function(){null===this.Je&&this.Ct.error("[%s] Attempting to increment `CurrentChunkId` that is not initialized",this.We),this.Je++},r.prototype.getInitUrl=function(){return this.Ve},r.prototype.getDataChunkUrlTemplate=function(){return this.He},r.prototype.addDataChunk=function(e,i,n){t.Oe(e,"dataChunk"),n=n||function(){},t.It(n,"eventCallback");var r={data:e,chunkId:i,timestamp:i*this.Be/1e3};if(this.$e.push(r),this.$e.length>this.Ke)for(;this.$e.length>this.Xe;)this.$e.shift();this.Ye.fireAsync([r],this,n)},r.prototype.getChunks=function(){return this.$e},r.prototype.addEventListener=function(e,i){if(t.Xt(e,"eventName"),t.It(i,"listener"),"chunkadded"!==e)throw new Error('Event "'+e+'" is unknown.');return this.Ye.listen(i)},r}.apply(e,n))&&(t.exports=r)},function(t,e,i){var n,r;n=[i(1),i(0),i(3),i(2),i(7),i(24)],void 0!==(r=function(t,e,i,n,r,s){"use strict";function o(r,s,o){if(e.Rt(r,"logger"),e.Rt(s,"playlistTrackConfig"),e.qt(s.codecs,"playlistTrackConfig.codecs"),e.ee(s.bandwidth,"playlistTrackConfig.bandwidth"),e.qt(s.trackId,"playlistTrackConfig.trackId"),o=o||{},this.Ct=r||new n.Logger,this.Le=function(t){return t.split(",").length>1?"video/mp4; codecs="+t:"audio/mp4; codecs="+t}(s.codecs),this._e=s.bandwidth,this.dt=s.height,this.We=s.trackId,this.ze=s.mimeType,this.Ge=s.totalNumberOfChunks,this.Ze=[],this.ti=!1,this.ei=0,this.Be=0,this.ii=function(e){var i=e.split("?")[0],n=t.get(e.split("?"),[1],"");return{url:i,queryParameters:t.reduce(n.split("&"),function(t,e){var i=e.split("=")[0];return i&&(t[i]=e.split("=")[1]),t},{})}}(s.mediaSegmentPlaylistUrl),this.Je=null,this.Ke=o.maxChunksToCache||a,this.Xe=o.lowWaterMaxChunks||u,e.ee(this.Ke,"options.maxChunksToCache"),e.ee(this.Xe,"options.lowWaterMaxChunks"),this.Xe>=this.Ke)throw new Error('The "maxChunksToCache" cannot be less than or equal to the "lowWaterMaxChunks"');this.Qe=null,this.$e=[],this.Ye=new i.Event,this.ni=new i.Event}var a=20,u=15;return o.prototype=Object.create(r.prototype),o.prototype.constructor=o,o.prototype.toString=function(){return"M3u8PlaylistTrack"},o.prototype.dispose=function(){this.$e=[],this.Ye.dispose()},o.prototype.getMseCodec=function(){return this.Le},o.prototype.getTrackId=function(){return this.We},o.prototype.getChunkDuration=function(){return this.Be},o.prototype.getBandwidth=function(){return this._e},o.prototype.getHeight=function(){return this.dt},o.prototype.getMimeType=function(){return this.ze},o.prototype.getTotalNumberOfChunks=function(){return this.Ge},o.prototype.getPlayableDuration=function(){return this.ei},o.prototype.isComplete=function(){return this.ti},o.prototype.hasSegments=function(){return this.Ze.length>0},o.prototype.getSegmentByTimestamp=function(e){return t.find(this.Ze,function(t){return t.timestamp<=e&&e<t.timestamp+t.duration})},o.prototype.getLastSegment=function(){return t.get(this.Ze,[this.Ze.length-1],null)},o.prototype.getMediaSegmentPlaylistUrlInfo=function(){return this.ii},o.prototype.getClosestSegmentNotGreaterThanTimestamp=function(t){return t>this.ei?this.Ze[this.Ze.length-1]:this.getSegmentByTimestamp(t)},o.prototype.isLastMediaSegment=function(e){var i=this.getSegmentByTimestamp(e),n=!this.ti&&t.get(i,["timestamp"],0)+t.get(i,["duration"],0)===this.ei,r=!this.ti&&e>this.ei;return this.ei===e||n||r},o.prototype.updateMediaSegments=function(e){var i=new s(this.Ct,this.We,e),n=this.Ge||0,r=t.map(this.Ze,function(t){return t.name}),o=this,a=t.get(this.Ze,[this.Ze.length-1]),u=t.get(a,["timestamp"])+t.get(a,["duration"])||void 0;t.forEach(i.mediaSegments,function(e){t.includes(r,e.name)||(e.timestamp=t.isUndefined(u)?0:u,o.Ze.push(e),o.ei+=e.duration,u=e.timestamp+e.duration,e.duration>o.Be&&(o.Be=e.duration),o.Ct.trace("[%s]:[%s]:[%s] Got new segment from playlist [%s]",(new Date).getHours(),(new Date).getMinutes(),(new Date).getSeconds(),e.name))}),n!==this.Ze.length&&(this.ti=i.isComplete,this.Ge=this.Ze.length,this.ni.fireAsync([this.Ze],null,t.noop))},o.prototype.addDataChunk=function(t,i,n){e.Oe(t,"dataChunk"),n=n||function(){},e.It(n,"eventCallback");var r={data:t,chunkId:i,timestamp:i*this.Be/1e3};if(this.$e.push(r),this.$e.length>this.Ke)for(;this.$e.length>this.Xe;)this.$e.shift();this.Ye.fireAsync([r],this,n)},o.prototype.getChunks=function(){return this.$e},o.prototype.addEventListener=function(t,i){switch(e.Xt(t,"eventName"),e.It(i,"listener"),t){case"chunkadded":return this.Ye.listen(i);case"segmentsready":return this.ni.listen(i);default:throw new Error('Event "'+t+'" is unknown.')}},o}.apply(e,n))&&(t.exports=r)},function(t,e,i){var n,r;n=[i(1),i(0)],void 0!==(r=function(t,e){"use strict";function i(i,r,s){e.qt(s,"m3u8String"),e.Rt(i,"logger"),this.ri=s,this.Ct=i,this.Ut=r,this.mediaSegments=[],function(e){var i=e.match(/[^\r\n]+/g),r=this;return t.forEach(i,function(e,s){var o=e.match(/(?!#)EXT.+?(?=[:\n\r])/),a=t.get(o,["0"],null),u=e.trim().substring(a?a.length+2:0,e.length);switch("#EXT-X-ENDLIST"===e&&(a="EXT-X-ENDLIST"),a){case"EXT-X-VERSION":r.version=parseFloat(u);break;case"EXT-X-PROGRAM-DATE-TIME":r.programDateTime=u?new Date(u.trim()):null;break;case"EXT-X-TARGETDURATION":r.targetDuration=1e3*parseFloat(u)||0;break;case"EXT-X-MEDIA-SEQUENCE":r.mediaSequence=parseInt(u);break;case"EXTINF":var c=[u,i[s+1]];r.mediaSegments.push(n(c,r.mediaSegments+1));break;case"EXT-X-ENDLIST":r.isComplete=!0;break;case"EXTM3U":case null:break;default:return r.Ct.debug("[%s] [Segment] Playlist unsupported key type [%s]",r.Ut,a)}}),r}.call(this,this.ri);var o=0;t.forEach(this.mediaSegments,function(t){t.timestamp=o,o+=t.duration}),this.playableDuration=o,this.isComplete=!!this.isComplete}i.prototype.toString=function(){return"vod"};var n=function(e){var i=t.get(e,["0"],"").split(","),n=t.get(i,["0"],0),r=t.get(i,["1"],"").trim(),s=t.get(e,["1"],"").trim();return{duration:parseFloat(n),title:r,name:s}};return i}.apply(e,n))&&(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(8)],void 0!==(r=function(t,e){"use strict";function i(){}return i.prototype.isCodecSupported=function(i){return t.qt(i,"codec"),e.global.MediaSource&&"function"==typeof e.global.MediaSource.isTypeSupported&&e.global.MediaSource.isTypeSupported(i)},i.prototype.parseXml=function(i){if(t.qt(i,"xmlString"),void 0!==e.global.DOMParser)return(new e.global.DOMParser).parseFromString(i,"text/xml");if(void 0!==e.global.ActiveXObject&&new e.global.ActiveXObject("Microsoft.XMLDOM")){var n=new e.global.ActiveXObject("Microsoft.XMLDOM");return n.async="false",n.loadXML(i),n}throw new Error("No XML parser found")},i.prototype.getMSECodec=function(e,i){return t.qt(e,"mpdMimeType"),t.qt(i,"mpdCodecs"),e+'; codecs="'+i+'"'},new i}.apply(e,n))&&(t.exports=r)},function(t,e,i){var n,r;n=[i(1),i(0),i(4),i(10)],void 0!==(r=function(t,e,i,n){"use strict";function r(t,n,r){e.Rt(t,"logger"),this.Ct=t,this.si=n.sort(function(t,e){return a[t.name]-a[e.name]}),this.oi=r,this.v=new i.DisposableList}function s(t){return(Math.random()-.5)*(t/20)+t}function o(e,i){i=i||0;var r=this,s=t.get(this.si,[i],{});(function(e,i){var r=this;switch(e.name){case"urn:mpeg:dash:utc:http-head:2014":var s=n.getWithRetry(e.value,t.assign({contentType:"text/plain"},u),function(n,s){var o=t.get(s,["headers","date"],""),a=new Date(o).getTime();if(n||isNaN(a))return r.Ct.warn("Unable to resolve dash timing via [%s]",e.value,n),i(n||new Error("invalid-server-time"));var u=t.now()-a-s.stats.successResponseTime/2;return r.Ct.info("Resolved [%s] local to server timestamp offset [%s]",e.name,u),i(null,u)});return this.v.add(s),s;case"urn:mpeg:dash:utc:direct:2014":var o=t.now()-e.value-this.oi/2;return r.Ct.info("Resolved [%s] local to server timestamp offset [%s]",e.name,o),i(null,o);default:return r.Ct.info("Unable to resolve mpd Timing Sources. Defaulting to local time"),i(null,0)}}).call(this,s,function(n,s){if(!t.ee(s))return o.call(r,e,i+1);e(n,s)})}var a={"urn:mpeg:dash:utc:http-head:2014":0,"urn:mpeg:dash:utc:direct:2014":1},u={retryOptions:{backoff:2,delay:2e3,maxAttempts:3,additionalRetryErrorCodes:[0]}};return r.prototype.calculateOffset=function(t){o.call(this,t)},r.prototype.setInterval=function(n,r){e.It(n,"callback"),t.isUndefined(r)||e.ee(r,"interval");var a=this,u=s(r||3e5),c=setTimeout(function t(){a.Ct.debug("Syncing local to server time"),o.call(a,function(e,i){if(e)return n(e);u=s(r||3e5),n(e,i),a.Ct.debug("Waiting [%s] ms before next time sync",u),c=setTimeout(t,u)})},u),h=new i.Disposable(function(){clearTimeout(c)});return this.Ct.debug("Waiting [%s] ms before next time sync",u),this.v.add(h),h},r.prototype.dispose=function(){return this.Ct.debug("Disposing of mdp time sync"),this.v.dispose()},r.prototype.toString=function(){return"MpdTimeSync [Time Source Number: "+this.si.length+", Direct Source Offset: "+this.oi+"]"},r}.apply(e,n))&&(t.exports=r)},function(t,e,i){var n,r;n=[i(1),i(0),i(2),i(3),i(4),i(11),i(8),i(28),i(29),i(5),i(9),i(20),i(15),i(17)],void 0!==(r=function(t,e,i,n,r,s,o,a,u,c,h,f,d,l){"use strict";function m(a,u,c){e.Oe(u,"videoElement"),e.Oe(u.videoWidth,"videoElement.videoWidth"),this.Ct=a||new i.Logger,this.h=t.assign({targetLatency:v},c),this.Dt=u,this.v=new r.DisposableList,this.ai=new s(o.global.navigator.userAgent).detect(),this.ui=this.h.preferNative||!1,this.ci=null,this.hi=!1,this.fi=!1,this.hi=!1,this.di=new n.Event,this.li=new n.Event,this.mi=new n.Event,this.v.add(this.di),this.v.add(this.li),this.v.add(this.mi)}function p(){var t=this;"Edge"===t.ai.browser||"IE"===t.ai.browser?(t.Dt.play(),t.hi=!0,t.li.fireAsync([],t),t.Ct.debug("Playback Started")):t.Dt.play().then(function(){t.hi=!0,t.li.fireAsync([],t),t.Ct.debug("Playback Started")}).catch(function(e){t.Ct.error("Playback Failed [%s]",e)})}var v=8;return m.prototype.toString=function(){return t.toString(this)},m.prototype.start=function(t){if(e.qt(t,"uri"),this.ci)return this.Ct.warn("Already started Phenix Web Player");var i=this;if(u.isSupported){if(this.ui||!a.isSupported)return this.Ct.info("HLS native player selected"),this.ci=new u(this.Ct,this.Dt,this.h),this.ci.addEventListener("error",function(t){i.mi.fire([t])}),this.v.add(this.ci),this.ci.start(t,function(){p.call(i)})}else this.ui&&this.Ct.warn("HLS native player is not supported");this.Ct.info("MSE player selected");var n=new c(this.Ct,t);i.v.add(n),n.fetch(function(t){if(t)return i.mi.fire([t]);var e,r=new h(i.Ct,{ewmaPeriods:30});"Dash"===n.getDeliveryType()?e=new d(i.Ct,n,r,i.h):"Hls"===n.getDeliveryType()&&(e=new l(i.Ct,n,r,i.h));var s=new a(i.Ct,n,i.Dt,e,i.h),o=new f(i.Ct,n,i,r);s.start(),p.call(i),i.ci=s,i.ci.addEventListener("playbacktimeleft",function(t,e){i.di.fire([t,e])}),i.ci.addEventListener("error",function(t){i.mi.fire([t])}),i.v.add(i.ci),i.v.add(r),i.v.add(o)})},m.prototype.play=function(){p.call(this),this.ci&&this.ci.play()},m.prototype.pause=function(){this.Ct.info("Pausing web player"),this.ci&&this.ci.pause()},m.prototype.getVideoElement=function(){return this.Dt},m.prototype.dispose=function(){this.v.dispose(),this.Dt&&(this.Dt.load(),this.Dt.src="",this.Dt.mediaKeys&&this.Dt.setMediaKeys(null)),this.ci=null,this.Dt=null},m.prototype.getBandwidthLimit=function(){this.ci.getBandwidthLimit()},m.prototype.getTimeLeft=function(){return this.Dt?function(e){var i=this.Dt.currentTime,n=this.Dt.duration,r=function(t,e){for(var i=0;i<t.buffered.length;i++){var n=t.buffered.start(i),r=t.buffered.end(i);if(n<=e&&e<=r)return i}}(e,i),s=t.ee(r)?e.buffered.end(r):0,o=0===s?0:s-i;return{bufferedLength:e.buffered.length,current:i,bufferEnd:s,timeBufferedButNotPlayed:o,duration:n,timestampOffset:e.timestampOffset}}.call(this,this.Dt).timeBufferedButNotPlayed:0},m.prototype.changeBandwidthLimit=function(t,e){this.ci.changeBandwidthLimit(t,e)},m.prototype.addEventListener=function(i,n){switch(e.Xt(i,"eventName"),e.It(n,"listener"),i){case"playbacktimeleft":return this.di.listen(n);case"started":var r=this.li.listen(n);return this.hi&&setTimeout(t.bind(n,this),0),r;case"error":return this.mi.listen(n);default:throw new Error('Event "'+i+'" is unknown.')}},m.prototype.getStats=function(){return this.ci?this.ci.getStats():{}},m.isSupported=u.isSupported||a.isSupported,m.deviceSupportsHlsPlayback=u.isSupported||a.isSupported,m.deviceSupportsDashPlayback=a.isSupported,m}.apply(e,n))&&(t.exports=r)},function(t,e,i){var n,r;n=[i(1),i(0),i(2),i(3),i(4),i(11),i(8),i(5),i(12),i(18)],void 0!==(r=function(t,e,i,n,r,s,o,a,u,c){"use strict";function h(h,d,l,m,p){e.Wt(d,a,"playlist"),e.Oe(l,"videoElement"),e.Oe(l.videoWidth,"videoElement.videoWidth"),e.Oe(m,"playlistChunkFeeder"),e.Wt(m,u,"playlistChunkFeeder"),e.ee(p.targetLatency,"options.targetLatency"),t.isUndefined(t.get(p,"bandwidthToStartAt"))||e.ee(p.bandwidthToStartAt,"options.bandwidthToStartAt"),t.isUndefined(t.get(p,"trackRestrictions"))||e.Rt(p.trackRestrictions,"options.trackRestrictions"),t.isUndefined(t.get(p,"bufferSizeToPauseFetch"))||e.ee(p.bufferSizeToPauseFetch,"options.bufferSizeToPauseFetch"),t.isUndefined(t.get(p,"bufferSizeToResumeFetch"))||e.ee(p.bufferSizeToResumeFetch,"options.bufferSizeToResumeFetch"),t.isUndefined(t.get(p,"maximumFrequencyForAlteringPlaybackRate"))||e.ee(p.maximumFrequencyForAlteringPlaybackRate,"options.maximumFrequencyForAlteringPlaybackRate"),t.isUndefined(t.get(p,"playbackRateToRecover"))||e.ee(p.playbackRateToRecover,"options.playbackRateToRecover");var v=this;this.h=p,this.Dt=l,this.pi=m,this.ie=d,this.v=new r.DisposableList,this.Ct=h||new i.Logger,this.vi=t.get(p,"bandwidthToStartAt",k),this.gi=t.get(p,"trackRestrictions",{}),this.yi=t.get(p,"playbackMode",P.strict.name),this.wi=t.get(p,"bufferSizeToPauseFetch",S),this.bi=t.get(p,"bufferSizeToResumeFetch",E),this.fe=1e3*p.targetLatency,this.hi=!1,this.fi=!1,this.ki=[],this.ai=new s(o.global.navigator.userAgent).detect();var g=(this.fe-(this.ie.getMaxChunkDuration()||1e3)-500)/this.fe;this.Si=t.get(p,"playbackRateToDecreaseBuffer",I),this.Ei=t.get(p,"playbackRateToIncreaseBuffer",R),this.Ti=t.get(p,"minimumIntervalBetweenPlaybackRateChange",C),this.Ii=this.fe/1e3*g,this.Ri=this.fe/1e3/4,this.Ci=this.fe/1e3/2,this.Ct.info("Target latency set to [%s] MS ([%s]/[%s] rates at most every [%s] with target buffers [%s] - [%s] - [%s])",this.fe,this.Ei,this.Si,this.Ti,this.Ri,this.Ci,this.Ii),function(){var e=this,i=t.get(this.ie,["parsedPlaylist","contentProtectionTags"],[]);return 0===i.length?this.Ct.info("No Content Protection Tags found in the playlist so skipping initialization of EncryptedMediaHandler"):c.isSupported()?(this.Mi=new c(this.Ct,this.Dt,i,t.get(this.h,"drm")),this.Mi.addEventListener("error",function(t){e.mi.fire([t])}),this.Mi.addEventListener("trackRestrictionsAvailable",function(i){t.keys(i).length>0&&(e.gi=i,f.call(e),e.Dt.play())}),void this.v.add(this.Mi)):this.Ct.error("DRM not supported by the browser")}.call(this),this.hi=!1,this.Pi={},this.xi={},this.di=new n.Event,this.mi=new n.Event,this.pi.addEventListener("error",function(t){v.mi.fire([t])}),this.v.add(this.pi),this.v.add(this.di),this.v.add(this.mi),this.v.add(new r.Disposable(function(){null!==v.Di&&o.global.clearTimeout(v.Di)}))}function f(){var t=this.ie.getPlaylistTracksByBandwidthPerMimeType(this.vi,this.gi);return this.pi.setActiveTracks(t),t}function d(t,e,i){this.Ct.debug("VIDEO EVENT: [%s]",t,i),e&&e.call(this,i)}function l(e,i){var n=t.bind(d,this,"durationchange",function(){var r=this;if("dynamic"!==r.ie.getType())return r.Dt.removeEventListener("durationchange",n,!1),r.Oi=null;0!==t.get(r.Dt,["buffered","length"],0)&&function(e,i){var n=this;e=t.ee(e)?e:(n.ie.getPlaybackDurationSinceAvailable()-n.fe)/1e3,this.yi===P.strict.name&&(e=(n.ie.getPlaybackDurationSinceAvailable()-n.fe)/1e3),"Firefox"===this.ai.browser&&(e-=1),setTimeout(function(){var r=n.Dt.buffered.start(n.Dt.buffered.length-1),s=n.Dt.buffered.end(n.Dt.buffered.length-1),o=n.Dt.currentTime<e||n.Dt.currentTime>e+1,a=r<=e&&e<=s,u=n.Ai>=M;if(n.Oi||!a&&!u&&n.qi)n.Ai++;else{if(o&&!n.Ui&&(a||u||!n.qi)){var c=u?(s-r)/2+r:r;n.qi||a||(c=r),n.Ct.debug("Setting video current time to [%s], attempt [%s]",c,n.Ai),n.Dt.currentTime=c,n.Ui=!0,n.qi||(n.qi=!0)}r<=n.Dt.currentTime&&n.Dt.currentTime<=s&&(a||u)&&(n.Oi=t.now(),n.Ui=!1,n.Ct.debug("Successfully updated video current time [%s] after [%s] attempts",n.Dt.currentTime,n.Ai),i())}},10)}.call(r,e,function(){r.Dt.removeEventListener("durationchange",n,!1),i&&i()})});return this.Ai=0,n}function m(e){var i=this,n=this.pi.getActiveTracks(),s=f.call(this);(function(e){if("static"===this.ie.getType()&&this.Fi.duration!==this.ie.getTotalMediaTimeInMillis()/1e3)this.Fi.duration=this.ie.getTotalMediaTimeInMillis()/1e3;else if("Hls"===this.ie.getDeliveryType()&&this.Fi.duration!==1/0){this.Fi.duration=1/0;var i=t.reduce(e,function(e,i){var n=t.get(i.getLastSegment(),["timestamp"],0);return t.isNullOrUndefined(e)?n:n<e?n:e})||0;this.pi.seekToChunk(i)}}).call(this,s),this.pi.initializeActiveTracks(function(o){if(o)return i.Ct.error("Unable to initialize playlist tracks",o),i.mi.fire([o]),e(o);var a=t.filter(s,function(t){return!i.xi[b(t)]});if(a.length>0){var u=t.map(a,function(t){return t.getTrackId()});i.Ct.info("Initializing source buffers for [%s] tracks [%s]",a.length,u),function(e){this.Ct.debug("Creating MSE buffers for all tracks."),t.forEach(e,t.bind(function(e){(function(e){var i=this,n={track:e,chunks:[],chunkAddRequested:!1},s=w(e),o=!t.includes(t.keys(i.Pi),s),a=o?i.Fi.addSourceBuffer(e.getMseCodec()):i.Pi[s].buffer,u=b(e);i.xi[u]=n,o&&(a.mode="segments","static"===i.ie.getType()&&(a.appendWindowEnd=i.ie.getTotalMediaTimeInMillis()/1e3),i.Ct.debug("Creating MSE Buffer for [%s] with mode [%s]",i.ie.getType(),a.mode),i.Pi[s]={buffer:a,updateEnd:function(t){a.updating||y.call(this,t,!0)}},i.v.add(new r.Disposable(function(){i.Ct.debug("Cleaning up sourceBuffer [%s]",s),i.Fi.removeSourceBuffer(a)})));var c=e.addEventListener("chunkadded",t.bind(function(e,r){n.addInitChunkFirst&&"Dash"===i.ie.getDeliveryType()&&(n.addInitChunkFirst=!1,this.Ct.debug("Pushing track [%s] chunk [%s] into buffer",e.getTrackId(),"Init"),n.chunks.push(e.getInitChunkData())),this.Ct.debug("Pushing track [%s] chunk [%s] into buffer",e.getTrackId(),r.chunkId),n.chunks.push(r.data),n.chunkAddRequested&&(n.chunkAddRequested=!1,a.updating||y.call(this,e,!1));var s=t.now()-this.Ni>=T,o=t.now()-this.ji>=500;this.fi&&s&&o&&!this.Dt.paused&&!this.Li&&(this.Ct.trace("Starting after wait [%s]",t.now()-this.Ni),this.ji=t.now(),this.Dt.play())},i,e));i.v.add(c)}).call(this,e)},this))}.call(i,a)}var c=t.filter(s,function(e){return!t.find(n,function(t){return t.getTrackId()===e.getTrackId()})});t.forEach(c,function(e){(function(e){var i=this.Pi[w(e)],n=t.bind(function(t){this.Ct.warn("Buffer Error [%s]",t)},this),r=!!i.track;if(i.track!==e){var s=this.xi[b(e)];if(i.track&&i.track!==e&&r&&(i.buffer.removeEventListener("updateend",i.updateEndListener),i.buffer.removeEventListener("error",n),s&&(s.addInitChunkFirst=!0,s.chunkAddRequested=!0,s.chunks=[])),i.track=e,i.updateEndListener=t.bind(i.updateEnd,this,e),i.buffer.addEventListener("updateend",i.updateEndListener),i.buffer.addEventListener("error",n),i.buffer.onerror=n,!r){var o="Dash"===this.ie.getDeliveryType()?[e.getInitChunkData()]:[];s.chunks=[].concat(o,t.map(e.getChunks(),function(t){return t.data})),"static"===this.ie.getType()&&"Edge"!==this.ai.browser&&"IE"!==this.ai.browser&&this.Fi.setLiveSeekableRange(0,this.ie.getTotalMediaTimeInMillis()/1e3),y.call(this,e,!1)}}}).call(i,e),i.Ct.info("Switched [%s] to track [%s] with [%s] bandwidth limit",w(e),e.getTrackId(),i.vi)}),e()})}function p(e){var i=this.Dt.currentTime,n=this.Dt.duration,r=v(e,i),s=t.ee(r)?e.buffered.end(r):0,o=0===s?0:s-i;return{bufferedLength:e.buffered.length,current:i,bufferEnd:s,timeBufferedButNotPlayed:o,duration:n,timestampOffset:e.timestampOffset}}function v(t,e){for(var i=0;i<t.buffered.length;i++){var n=t.buffered.start(i),r=t.buffered.end(i);if(n<=e&&e<=r)return i}}function g(){var e=!0,i=!1;t.forOwn(this.Pi,t.bind(function(t){var n=p.call(this,t.buffer),r=parseFloat(n.timeBufferedButNotPlayed);r<this.wi&&(e=!1),r<this.bi&&(i=!0)},this)),e&&this.pi.isFetchingData()&&(this.Ct.debug("Pausing feeder due to excess buffer"),x.call(this)),!i||this.pi.isFetchingData()||this.Li||(this.Ct.debug("Starting feeder due to limited buffer"),D.call(this))}function y(e,i){var n=this.Pi[w(e)],r=this.xi[b(e)];if(!r)return this.Ct.warn("Unable to add chunk for non existent buffer");if("dynamic"===this.ie.getType()&&this.Li&&!this.Bi&&n.buffer.buffered.length>0)n.buffer.remove(0,n.buffer.buffered.end(n.buffer.buffered.length-1)),n.cleared=!0,t.reduce(this.Pi,function(t,e){return t?e.cleared:t},!0)&&(this.qi=!1,this.Oi=null,this.Ui=!1,this.Bi=!0);else if(r.chunks.length>0){if(this.Dt.error)return this.Ct.error("Unable to continue appending to buffer. Video element error code [%s] and message [%s]",this.Dt.error.code,this.Dt.error.message),x.call(this),this.mi.fire([this.Dt.error]);var s=r.chunks.shift();n.cleared=!1,this.Ct.debug("Appending chunk to buffer for track [%s]",e.getTrackId()),n.buffer.appendBuffer(new Uint8Array(s))}else i&&(this.ji&&g.call(this),r.chunkAddRequested=!0)}function w(t){return t.getMseCodec().indexOf("video")>=0?"video":t.getMseCodec().indexOf("audio")>=0?"audio":"other"}function b(t){return t.getTrackId()+"_"+t.getMseCodec()}var k=2e6,S=60,E=30,T=1e3,I=1.03,R=.97,C=300,M=2,P={loose:{id:0,name:"loose"},strict:{id:1,name:"strict"}};h.prototype.toString=function(){return t.toString(this)},h.prototype.play=function(){if("dynamic"===this.ie.getType()){var t=this.pi.seekToCurrent();D.call(this);var e=this,i=l.call(this,t,function(){e.Li=0,e.Dt&&e.Dt.play()});return setTimeout(function(){e.Dt.addEventListener("durationchange",i,!1)},300),this.v.add(new r.Disposable(function(){e.Dt.removeEventListener("durationchange",i,!1)}))}D.call(this),this.Dt&&this.Dt.play()},h.prototype.pause=function(){this.Ct.info("Pausing web player"),x.call(this);var e=this;this.Dt&&(this.Dt.pause(),this.Li=t.now(),this.Bi=!1,t.forOwn(this.pi.getActiveTracks(),function(t){e.Pi[w(t)].buffer.updating||y.call(e,t,!1)}))},h.prototype.dispose=function(){this.v.dispose(),this.hi=!1,this.Pi={},this.xi={},this.ki=[],this.Fi=null,this.ie=null,this.Dt=null},h.prototype.start=function(e){(function(e){var i=this;i.Fi=new MediaSource;var n=function(){(function(e){var i=this;m.call(i,function n(s){if(s)return e(s);var o=i.pi.getActiveTracks(),a=t.map(o,function(t){return t.getTrackId()});i.Ct.debug("Initializing tracks [%s]",a);var u=setTimeout(function(){return i.pi.stopRequestingAllData(),i.vi=i.vi/2,m.call(i,n)},i.ie.getMaxChunkDuration());i.pi.fetchNChunks(1,function(n){if("timeout"!==t.get(n,["message"])){if(clearTimeout(u),n)return e(n);"Hls"===i.ie.getDeliveryType()&&t.forEach(i.pi.getActiveTracks(),function(t){i.xi[b(t)].chunkAddRequested=!0}),i.Ct.info("Initializing feeder with [%s] [%s] playlist of duration [%s]",i.ie.getType(),i.ie.getDeliveryType(),i.ie.getTotalMediaTimeInMillis()/1e3),function(e){var i=this,n=t.bind(function(){this.fi=!1,this.Ni=t.now();var e,i=t.now()-this._i>4e3;t.forOwn(this.Pi,t.bind(function(t){var i=p.call(this,t.buffer);(!e||e>i.timeBufferedButNotPlayed)&&(e=i.timeBufferedButNotPlayed),this.di.fire([i.timeBufferedButNotPlayed,t.track],this)},this)),g.call(this),i&&(function(e){this.ki.push({size:e,timestamp:t.now()});for(var i=t.get(this.ki,[0,"timestamp"],t.now());t.now()-i>3e5;)this.ki.shift(),i=t.get(this.ki,[0,"timestamp"],t.now());this.Wi=Math.min.apply(null,t.map(this.ki,function(t){return t.size}))}.call(this,e),function(e){if("Dash"===this.ie.getDeliveryType()||"dynamic"===this.ie.getType()){var i=this.Ii,n=this.zi,r=t.now()-this._i>4e3,s=!n||t.now()-n>1e3*this.Ti,o=this.fe/1e3,a=this.Wi>this.Ri,u=this.Wi<=o+.1&&this.Wi>=o-.1,c=e>=this.Ci&&this.Dt.playbackRate===this.Ei;e>=i&&a&&this.Dt.playbackRate<=1&&r&&s?(this.Ct.info("Adjusting playback rate to [%s] to reduce buffer size from [%s] with minimum buffer size of [%s]",this.Si,e,this.Wi),this.Dt.playbackRate=this.Si):!a&&!u&&this.Dt.playbackRate>=1&&s?(this.Ct.info("Adjusting playback rate to [%s] to increase buffer size from [%s] with minimum buffer size of [%s]",this.Ei,e,this.Wi),this.Dt.playbackRate=this.Ei):(c||u)&&1!==this.Dt.playbackRate&&(this.Ct.info("Resuming normal playback rate with buffer size of [%s] and minimum buffer size of [%s]",e,this.Wi),this.Dt.playbackRate=1,this.zi=t.now())}}.call(this,e||0))},i),s=t.bind(d,i,"stalled",null),o=t.bind(d,i,"suspend",null),a=t.bind(d,i,"ended",null),u=t.bind(d,i,"error",null),c=t.bind(d,i,"pause",null),h=t.bind(d,i,"play",function(){this.Li&&this.Dt.pause()}),f=t.bind(d,i,"waiting",function(){this.hi&&(this.Ct.debug("Waiting for new chunk or end of track"),this.fi=!0)}),m=t.bind(d,i,"seeking",function(e){var i=t.keys(this.Pi),n=t.get(i,"0",null),r=this.Pi[n],s=t.now()-this.Oi,o=this;if(!(r&&s>500&&"Hls"!==this.ie.getDeliveryType()))return this.Ct.debug("Ignoring video seek event during initialization");var a=v(r.buffer,e.timeStamp/1e3),u=v(r.buffer,this.Dt.currentTime),c=t.reduce(this.Pi,function(e,i){var n=v(i.buffer,o.Dt.currentTime),r=t.ee(n)?i.buffer.buffered.end(n):0;return e?r<e?r:e:r})||this.Dt.currentTime;if(this.pi.stopRequestingAllData(),this.Ct.debug("Pausing of feeder completed."),this.pi.seekToChunk("dynamic"===this.ie.getType()?this.Dt.currentTime:c),a!==u||t.isNullOrUndefined(u)){if(this.pi.isFetchingData())return;this.pi.startRequestingDataForActiveTracks(this.vi)}}),y=l.call(i);i.Dt.addEventListener("timeupdate",n,!1),i.Dt.addEventListener("ended",a,!1),i.Dt.addEventListener("error",u,!1),i.Dt.addEventListener("pause",c,!1),i.Dt.addEventListener("stalled",s,!1),i.Dt.addEventListener("suspend",o,!1),i.Dt.addEventListener("play",h,!1),i.Dt.addEventListener("waiting",f,!1),i.Dt.addEventListener("seeking",m,!1),i.Dt.addEventListener("durationchange",y,!1),i.v.add(new r.Disposable(function(){i.Ct.debug("Cleaning up videoElement listeners"),i.Dt.removeEventListener("timeupdate",n,!1),i.Dt.removeEventListener("ended",a,!1),i.Dt.removeEventListener("error",u,!1),i.Dt.removeEventListener("pause",c,!1),i.Dt.removeEventListener("stalled",s,!1),i.Dt.removeEventListener("suspend",o,!1),i.Dt.removeEventListener("play",h,!1),i.Dt.removeEventListener("waiting",f,!1),i.Dt.removeEventListener("seeking",m,!1),i.Dt.removeEventListener("durationchange",y,!1)})),D.call(i),i.ji=t.now(),t.It(e)&&e()}.call(i,e)}})})}).call(i,e)};i.Fi.addEventListener("sourceopen",n),i.v.add(new r.Disposable(function(){i.Ct.debug("Cleaning up sourceopen listener"),i.Fi.removeEventListener("sourceopen",n)})),i.Dt.src=o.global.URL.createObjectURL(i.Fi)}).call(this,e),this._i=t.now()},h.prototype.getBandwidthLimit=function(){return this.vi},h.prototype.changeBandwidthLimit=function(e,i){this.Ct.debug("Changing playback bandwidth limit: [%s], current limit: [%s]",e,this.vi),this.vi=e,this.Di=setTimeout(t.bind(function(e){var i=this;m.call(this,function(n){if(n)return e(n);var r=i.pi.getActiveTracks(),s=t.reduce(r,function(e,n){var r=i.Pi[w(n)],s=v(r.buffer,i.Dt.currentTime),o=n.getChunkDuration()/1e3;if(!t.ee(s))return!t.ee(e)||e>i.Dt.currentTime?i.Dt.currentTime:e;var a=Math.round(r.buffer.buffered.end(s)/o)*o;return!t.ee(e)||e>a?a:e});return t.ee(s)||(s=i.Dt.currentTime),i.pi.stopRequestingAllData(),i.pi.seekToChunk(s),i.Ct.debug("Pausing of feeder completed."),i.pi.isFetchingData()?e():(i.pi.startRequestingDataForActiveTracks(i.vi),e())})},this,i||t.noop),250)},h.prototype.addEventListener=function(t,i){switch(e.Xt(t,"eventName"),e.It(i,"listener"),t){case"playbacktimeleft":return this.di.listen(i);case"error":return this.mi.listen(i);default:throw new Error('Event "'+t+'" is unknown.')}},h.prototype.getStats=function(){return{currentTime:t.get(this.lt,["currentTime"],0),width:t.get(this.lt,["videoWidth"],0)||t.get(this.lt,["width"],0),height:t.get(this.lt,["videoHeight"],0)||t.get(this.lt,["height"],0),lag:0,deliveryType:this.ie.getDeliveryType(),isNative:!1}},h.isSupported=!!o.global.MediaSource;var x=function(){this.pi.stopRequestingAllData(),this.Ct.debug("Pausing of feeder completed.")},D=function(){if(this.pi.isFetchingData())return this.Ct.debug("Unable to start requesting data. Feeder is already fetching data.");this.pi.startRequestingDataForActiveTracks()};return h}.apply(e,n))&&(t.exports=r)},function(t,e,i){var n,r;n=[i(1),i(0),i(2),i(3),i(4),i(11),i(19),i(8),i(5),i(18),i(6)],void 0!==(r=function(t,e,i,n,r,s,o,a,u,c,h){"use strict";function f(o,f,v){e.Oe(f,"videoElement"),e.Oe(f.videoWidth,"videoElement.videoWidth"),this.h=v,this.Dt=f,this.v=new r.DisposableList,this.Ct=o||new i.Logger,this.ai=new s(a.global.navigator.userAgent).detect(),this.mi=new n.Event,this.v.add(this.mi),this.Vi=t.bind(function(){var t=this,e=this.lt.currentTime,i=function(){return 1.5*this.Hi.averageLength<4e3?4e3:1.5*this.Hi.averageLength}.call(t);t.lt.paused||(setTimeout(function(){if(0===t.Hi.count&&!t.lt.paused&&t.lt.currentTime===e){var n="Stream has not started within ["+i/1e3+"] seconds";t.Ct.warn(n),m.call(t,h.name.progressTimeOut.name,n)}},i),setTimeout(function(){if(t.lt&&t.lt.currentTime===e&&!t.lt.paused&&d.call(t)){var i="Stream has been stalled for ["+y/1e3+"] seconds";t.Ct.warn(i),l.call(t,h.name.progressTimeOut.name,i)}},y))},this),this.Gi=t.bind(function(){if(this.Hi.time=t.now(),0===this.lt.buffered.length)return this.Ct.debug("[%s] Hls stream progress event fired without any buffered content",this.Ji);var e=this.lt.buffered.end(this.lt.buffered.length-1);if(this.Hi.buffered!==e){if(null!==this.Hi.buffered){var i=this.Hi.averageLength*this.Hi.count+(e-this.Hi.buffered);if(this.Hi.count+=1,this.Hi.averageLength=i/this.Hi.count,this.Hi.lastCurrentTime!==this.lt.currentTime&&(this.Hi.lastCurrentTimeOccurrenceTimestamp=t.now()),this.Hi.lastCurrentTimeOccurrenceTimestamp&&t.now()-this.Hi.lastCurrentTimeOccurrenceTimestamp>y&&this.lt&&!this.lt.paused&&d.call(this)){var n="Reloading stream after current time has not changed for ["+y/1e3+"] seconds due to unregistered stall.";this.Ct.warn(n),l.call(this,h.name.progressTimeOut.name,n)}}this.Hi.buffered=e,this.Hi.lastCurrentTime=this.lt.currentTime}},this),this.Ki=t.bind(function(){this.Ct.info("[%s] Hls stream ended",this.Xi),this.stop("ended")},this),this.Qi=t.bind(function(e){var i=0===this.Hi.count;4===t.get(this.lt,["error","code"])&&i&&m.call(this,h.name.hlsNativeError.name,e),p.call(this,h.name.hlsNativeError.name,e)},this),this.Hi={time:0,buffered:null,averageLength:0,count:0,lastCurrentTime:0,lastCurrentTimeOccurrenceTimestamp:0},this.$i=[],function(){var e=this,i=t.get(this.h,["drm","com.apple.fps.1_0"],{});return 0===t.keys(i).length?this.Ct.info("DRM config is empty so skipping initialization of EncryptedMediaHandler"):c.isSupported()?(this.Mi=new c(this.Ct,this.Dt,[],t.get(this.h,"drm")),this.Mi.addEventListener("error",function(t){e.mi.fire([t])}),this.Mi.addEventListener("trackRestrictionsAvailable",function(i){t.keys(i).length>0&&(e.gi=i)}),void this.v.add(this.Mi)):this.Ct.error("DRM not supported by the browser")}.call(this),setTimeout(t.bind(function(){this.ie=new u(this.Ct,this.Ji),this.v.add(this.ie),this.ie.fetch(t.noop)},this),b)}function d(){return this.lt&&0!==this.lt.buffered.length}function l(t,e){if(!d.call(this))return p.call(this,t,e);m.call(this,t,e)}function m(t,e){this.mi.fire([g(t,h.severity.RECOVERABLE,e)])}function p(t,e){this.mi.fire([g(t,h.severity.CRITICAL,e)])}function v(e){if(e){if(clearTimeout(this.Ne),this.Ne=null,!this.Yi)return;return this.Yi=!1,void this.start(this.lt)}var i=this;this.Ne=setTimeout(function(){var e;o.isForeground()||!(e=i.lt).muted&&(t.get(e,["webkitAudioDecodedByteCount"],0)>0||t.get(e,["audioTracks","length"],0)>0||e.webkitHasAudio)||(i.Ct.info("Detecting application [background] with muted video. Pausing playback until application focused again."),i.lt.pause(),i.Yi=!0)},w)}function g(t,e,i){return{category:h.category.STREAMING,name:t,severity:e,error:"Error"===i.constructor.name?i:new Error(i)}}var y=6e3,w=3e3,b=2e3;return f.prototype.toString=function(){return t.toString(this)},f.prototype.play=function(){this.Dt.play()},f.prototype.pause=function(){this.Dt.pause()},f.prototype.dispose=function(){this.v.dispose()},f.prototype.start=function(e){if(this.Ji)return this.Ct.warn("Already started player");this.Ji=e,this.v.add(o.onBackground(t.bind(v,this,!1))),this.v.add(o.onForeground(t.bind(v,this,!0))),function(e){a.attachUriStream(e,this.Ji),!1===this.h.receiveAudio&&(e.muted=!0),t.addEventListener(e,"error",this.Qi,!0),t.addEventListener(e,"stalled",this.Vi,!1),t.addEventListener(e,"pause",this.Vi,!1),t.addEventListener(e,"suspend",this.Vi,!1),t.addEventListener(e,"progress",this.Gi,!1),t.addEventListener(e,"ended",this.Ki,!1),this.lt=e}.call(this,this.Dt)},f.prototype.getBandwidthLimit=function(){return this.Ct.warn("getBandwidthLimit not supported for HLS Native")},f.prototype.changeBandwidthLimit=function(){return this.Ct.warn("changeBandwidthLimit not supported for HLS Native")},f.prototype.addEventListener=function(t,i){switch(e.Xt(t,"eventName"),e.It(i,"listener"),t){case"error":return this.mi.listen(i);default:throw new Error('Event "'+t+'" is unknown.')}},f.prototype.getStats=function(){if(!this.Dt)return{width:0,height:0,currentTime:0,lag:0,deliveryType:"Hls",isNative:!0};var e=t.get(this.lt,["currentTime"],0),i=this.lt&&this.lt.buffered&&this.lt.buffered.length>0?this.lt.buffered.end(this.lt.buffered.length-1):0,n=Math.max(0,i-e);this.$i.push(n),this.$i.length>15&&this.$i.shift();for(var r=0,s=0,o=this.$i.length;s<o;s++)r=Math.max(r,this.$i[s]);var a=2;this.ie&&this.ie.getAllPlaylistTracks().length>0&&(a=this.ie.getAllPlaylistTracks()[0].getChunkDuration());var u=2*a+r;return{width:this.lt.videoWidth||this.lt.width,height:this.lt.videoHeight||this.lt.height,currentTime:e,lag:u,deliveryType:"Hls",isNative:!0}},f.isSupported="object"==typeof document&&"maybe"===document.createElement("video").canPlayType("application/vnd.apple.mpegURL"),f}.apply(e,n))&&(t.exports=r)}]))},function(t,e,i){var n;void 0===(n=function(){"use strict";return{types:{user:{id:0,name:"User"},presentation:{id:1,name:"Presentation"},audio:{id:2,name:"Audio"}}}}.apply(e,[]))||(t.exports=n)},function(t,e,i){var n,r;n=[i(0),i(1),i(4),i(14),i(29)],void 0===(r=function(t,e,i,n,r){"use strict";var s=n.types,o=r.states,a="pcast://phenixp2p.com/",u="pcast://phenixrts.com/";function c(t,e,i,n){this.init(t,e,i,n)}function h(e){return t.includes(e,a)?a:u}function f(e){var i={},n=e.split("?");if(2!==n.length)return i;var r=n[1].split("&");return t.forEach(r,function(t){var e=t.split("="),n=e[0];i[n]=e[1],"capabilities"===n&&(i[n]=e[1]&&e[1].split(",")||[])}),i}function d(i){return e.Pe(i,s,"streamType"),t.getEnumName(s,i)}function l(i){return e.Pe(i,o,"trackState"),t.getEnumName(o,i)}return c.prototype.init=function(t,n,r,s){e.Xt(t,"uri"),this.Ji=new i.Observable(t),this.Bt=new i.Observable(n,d),this.Zi=new i.Observable(r||o.trackEnabled.name,l),this.tn=new i.Observable(s||o.trackEnabled.name,l),this.Xi=c.parsePCastStreamIdFromStreamUri(t)},c.prototype.getUri=function(){return this.Ji.getValue()},c.prototype.getType=function(){return this.Bt.getValue()},c.prototype.getObservableAudioState=function(){return this.Zi},c.prototype.getObservableVideoState=function(){return this.tn},c.prototype.toJson=function(){return{uri:this.Ji.getValue(),type:this.Bt.getValue(),audioState:this.Zi.getValue(),videoState:this.tn.getValue()}},c.prototype.en=function(e){var i,n;t.Rt(e)&&(e.hasOwnProperty("uri")&&e.uri!==this.Ji.getValue()&&(i=e.uri,n=this.Ji.getValue(),c.parsePCastStreamIdFromStreamUri(i)===c.parsePCastStreamIdFromStreamUri(n))&&(this.Ji.setValue(e.uri),this.Xi=c.parsePCastStreamIdFromStreamUri(e.uri)),e.hasOwnProperty("audioState")&&this.Zi.setValue(e.audioState),e.hasOwnProperty("videoState")&&this.tn.setValue(e.videoState))},c.prototype.isPCastStream=function(){return!!this.Xi},c.prototype.getPCastStreamId=function(){return this.Xi},c.prototype.getInfo=function(){return f(this.Ji.getValue())},c.getPCastPrefix=function(){return a},c.parsePCastStreamIdFromStreamUri=function(e){return t.includes(e,h(e))?e.replace(h(e),"").split("?")[0]:null},c.getInfoFromStreamUri=function(t){return f(t)},c}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(3)],void 0===(r=function(t,e){"use strict";function i(){}function n(e){return t.includes(e.id,"send")||t.includes(e.id,"outbound")||"outboundrtp"===e.type||"outbound-rtp"===e.type||"kOutboundRtp"===e.type}function r(e){return t.includes(e.id,"recv")||"inboundrtp"===e.type||"inbound-rtp"===e.type||"kInboundRtp"===e.type}return i.convertPeerConnectionStats=function(i,s){return function(i,s){if(!i)return null;var o=[],a=function(i){var s={};switch(e.browser){case"Firefox":return t.forOwn(i,function(e,n){t.includes(n,"rtcp")&&t.forOwn(i,function(i,n){t.includes(n,"rtp")&&e.mediaType===i.mediaType&&(i.jitter=1e3*(e.jitter||i.jitter),i.roundTripTime=e.roundTripTime)})}),i;case"IE":return t.forOwn(i,function(e,i){t.startsWith(i,"ssrc")&&(s[e.id]=e)}),s;case"Edge":return i.forEach(function(e){s[e.id]=e,t.hasIndexOrKey(e,"jitter")&&(e.jitter*=1e3)}),t.forOwn(s,function(e){"track"===e.type&&t.hasIndexOrKey(e,"framesPerSecond")&&t.forOwn(s,function(t){"video"===t.mediaType&&(t.framesPerSecond=parseInt(e.framesPerSecond,10))})}),s;case"Safari":return i.forEach(function(t){s[t.id]=t}),t.forOwn(s,function(e){if(t.hasIndexOrKey(e,"id")&&r(e)){var i=parseInt(t.get(e.id.split("_"),[1]),10);e.ssrc=i||e.ssrc}t.hasIndexOrKey(e,"jitter")&&(e.jitter*=1e3),"candidate-pair"===e.type&&t.forOwn(s,function(t){"audio"!==t.mediaType&&"video"!==t.mediaType||(t.currentRoundTripTime=1e3*e.currentRoundTripTime)}),"track"===e.type&&t.forOwn(s,function(t){"audio"===t.mediaType&&r(t)?t.audioOutputLevel=1e5*e.audioLevel:"audio"===t.mediaType&&n(t)&&(t.audioInputLevel=1e5*e.audioLevel)})}),s;case"ReactNative":return(t.Xt(i)?JSON.parse(i):i).forEach(function(e){var i={id:e.id,type:e.type};e.values.forEach(function(e){t.keys(e).forEach(function(t){i[t]=e[t]})}),s[i.id]=i}),s;case"Chrome":default:return i.result().forEach(function(t){var e={id:t.id,type:t.type};t.names().forEach(function(i){e[i]=t.stat(i)}),e.timestamp=t.timestamp.getTime(),s[e.id]=e}),s}}(i);return t.forOwn(a,function(e){if(t.hasIndexOrKey(e,"ssrc")&&e.ssrc&&!t.includes(e.id,"rtcp")){var i=e.id||e.ssrc;t.hasIndexOrKey(s,i)||(s[i]={timestamp:t.now()});var a="?",u=parseFloat(e.timestamp)-s[i].timestamp,c=function(e,i,n){if(!t.isUndefined(i))return e?8*(e-(i||0))/n:0}(parseFloat(e.bytesSent),s[i].bytesSent,u),h=function(e,i,n){if(!t.isUndefined(i))return e?8*(e-(i||0))/n:0}(parseFloat(e.bytesReceived),s[i].bytesReceived,u),f=function(e,i,n){if(!t.isUndefined(i))return(e-i)/(n/1e3)}(parseFloat(e.framesEncoded||e.framesDecoded),s[i].framesEncoded||s[i].framesDecoded,u);n(e)&&(a="upload"),r(e)&&(a="download");var d={uploadRate:c,downloadRate:h,mediaType:e.mediaType,ssrc:e.ssrc,direction:a,nativeReport:e,rtt:e.rtt||e.googRtt||e.roundTripTime||e.currentRoundTripTime||"?",bitrateMean:parseInt(e.bitrateMean,10)||1e3*(n(e)?c:h)||void 0,targetDelay:parseInt(e.targetDelay||e.googTargetDelayMs,10)||void 0,currentDelay:parseInt(e.currentDelay||e.currentDelayMs||e.googCurrentDelayMs,10)||void 0};t.assign(s[i],e),"video"===e.mediaType&&(d=t.assign(d,{droppedFrames:parseInt(e.droppedFrames,10)||0,framerateMean:parseInt(e.framerateMean||f,10)||e.framesPerSecond||0,cpuLimitedResolution:e.cpuLimitedResolution||e.googCpuLimitedResolution,avgEncode:parseInt(e.avgEncode||e.avgEncodeMs||e.googAvgEncodeMs,10)})),"audio"===e.mediaType&&(d=t.assign(d,{audioInputLevel:e.audioInputLevel||e.googAudioInputLevel,audioOutputLevel:e.audioOutputLevel||e.googAudioOutputLevel,jitter:parseInt(e.jitter||e.jitterReceived||e.googJitterReceived,10)||void 0,jitterBuffer:parseInt(e.jitterBuffer||e.jitterBufferMs||e.googJitterBufferMs,10)||void 0})),o.push(d)}}),o}(i,s)},i}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(1),i(0),i(6),i(2),i(75)],void 0===(r=function(t,e,i,n,r){"use strict";function s(e,i,r,s){t.qt(e,"version"),t.qt(i,"baseUri"),t.Rt(r,"logger"),this.kt=e,this.in=i,this.Ct=r,this.v=new n.DisposableList,this.nn=s}return s.DefaultPCastUri="https://pcast.phenixrts.com",s.prototype.getBaseUri=function(){return this.in},s.prototype.resolveUri=function(t){return function(t,n){if(0===t.lastIndexOf("wss:",0))n(void 0,{uri:t+"/ws",roundTripTime:0});else if(0===t.lastIndexOf("https:",0)){var s=this;(function(t,n){var r=i.getWithRetry(t+"/pcast/endPoints",{timeout:15e3,queryParameters:{version:"2018-09-17T15:08:57Z",_:e.now()},retryOptions:{maxAttempts:4}},function(t,e){if(t)return n(new Error("Failed to resolve an end point",t));var i=e.data.split(",");i.length<1&&n(new Error("Failed to discover end points")),n(void 0,i)});this.v.add(r)}).call(s,t,function(t,e){if(t)return n(t);var i=new r(s.Ct,s.kt,n,function(t,e){t?s.Ct.warn("An error occured in resolving an endpoint",t):s.nn.recordMetric("RoundTripTime",{uint64:e.time},null,{resource:e.endPoint,kind:"https"})});i.resolveAll(e),s.v.add(i)})}else n(new Error("Uri not supported"))}.call(this,this.in,t)},s.prototype.dispose=function(){this.v.dispose()},s.prototype.toString=function(){return"PCastEndPoint["+this.in+"]"},s}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(94),i(83),i(41)],void 0===(r=function(t,e,i){return{MQWebSocket:t,BatchHttpProto:e,MQService:i}}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0)],void 0===(r=function(t){"use strict";return{parseEnvFromPcastBaseUri:function(e){return e=e.toLowerCase(),t.includes(e,"local")?"local":t.includes(e,"stg")?"staging":"production"}}}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(8),i(97)],void 0===(r=function(t,e,i,n){"use strict";function r(){}return r.prototype.createPCastLogger=function(t,r){t&&e.qt(t,"baseUri");var s=new i.Logger,o=n.getAppender(t);return o.setThreshold(i.level.INFO),r||s.addAppender(new i.ConsoleAppender),s.addAppender(o),s.isPCastLogger=!0,s},new r}.apply(e,n))||(t.exports=r)},function(t,e,i){var n;void 0===(n=function(){"use strict";return{level:{TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,FATAL:5}}}.apply(e,[]))||(t.exports=n)},function(t,e,i){var n,r;n=[i(0),i(1)],void 0===(r=function(t,e){"use strict";function i(t){e.Rt(t,"room"),this.rn=t}return i.prototype.getChannelId=function(){return this.rn.getRoomId.apply(this.rn,arguments)},i.prototype.getObservableAlias=function(){return this.rn.getObservableAlias.apply(this.rn,arguments)},i.prototype.getObservableName=function(){return this.rn.getObservableName.apply(this.rn,arguments)},i.prototype.getObservableDescription=function(){return this.rn.getObservableDescription.apply(this.rn,arguments)},i.prototype.getObservableType=function(){return this.rn.getObservableType.apply(this.rn,arguments)},i.prototype.getObservableMembers=function(){return this.rn.getObservableMembers.apply(this.rn,arguments)},i.prototype.getObservableBridgeId=function(){return this.rn.getObservableBridgeId.apply(this.rn,arguments)},i.prototype.getObservablePin=function(){return this.rn.getObservablePin.apply(this.rn,arguments)},i.prototype.toString=function(){return this.rn.toString.apply(this.rn,arguments)},i.prototype.toJson=function(){return{channelId:this.rn.getRoomId(),alias:this.rn.getObservableAlias().getValue(),name:this.rn.getObservableName().getValue(),description:this.rn.getObservableDescription().getValue(),type:this.rn.getObservableType().getValue(),pin:this.rn.getObservablePin().getValue(),bridgeId:this.rn.getObservableBridgeId().getValue()}},i.prototype.commitChanges=function(){return this.rn.commitChanges.apply(this.rn,arguments)},i.prototype.reload=function(){return this.rn.reload.apply(this.rn,arguments)},i.prototype.en=function(){return this.rn.en.apply(this.rn,arguments)},i.prototype.sn=function(){return this.rn.sn.apply(this.rn,arguments)},i.prototype.an=function(){return this.rn.an.apply(this.rn,arguments)},i.prototype.un=function(){return this.rn.un.apply(this.rn,arguments)},i}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1)],void 0===(r=function(t,e){"use strict";var i="most-recent";function n(t,n){t&&e.qt(t,"selectionStrategy"),e.Rt(n,"logger"),this.cn=t||i,this.Ct=n,this.hn=null,this.fn=[]}function r(e){return!!t.find(this.fn,function(t){return t.key===s(e)})}function s(t){return t?t.getSessionId()+t.getObservableScreenName().getValue():""}function o(t){return u(t.getObservableScreenName().getValue())}function a(t){return c(t.getObservableScreenName().getValue())}function u(t){return/primary/i.test(t)}function c(t){return/alternate/i.test(t)}return n.prototype.getNext=function(e,n){var u=function(e,n){switch(this.cn){case i:return function(e){return t.reduce(e,function(t,e){return t&&t.getLastUpdate()>e.getLastUpdate()?t:e})}(e);case"high-availability":if(this.hn&&!n)return this.hn;var u=function(e){var i=this;return t.filter(e,function(t){return!r.call(i,t)})}.call(this,e);n&&(u=function(e,i){return t.filter(e,function(t){return s(t)!==s(i)})}(u,this.hn));var c=t.filter(u,o);return 0===c.length&&(c=t.filter(u,a)),0===c.length&&(c=u),t.sample(c);default:throw new Error("Invalid Selection Strategy")}}.call(this,e,n);return this.getNumberOfBlackListedMembers()>0&&function(){return t.reduce(this.fn,function(e,i){return e+t.now()-i.timestamp},0)>18e4}.call(this)&&!u?(this.Ct.info("Unable to select new member. Clearing [%s] black-listed members and trying again",this.getNumberOfBlackListedMembers()),this.clearBlackListedMembers(),this.getNext(e,n)):(this.hn!==u&&(u?this.Ct.info("Selecting new Member [%s]/[%s]",u.getSessionId(),u.getObservableScreenName().getValue()):this.Ct.info("Unable to select new member"),this.hn&&!r.call(this,this.hn)&&function(e){e&&this.fn.push({key:s(e),timestamp:t.now()})}.call(this,this.hn)),this.hn=u,u)},n.prototype.getStrategy=function(){return this.cn},n.prototype.clearBlackListedMembers=function(){this.fn=[]},n.prototype.getNumberOfBlackListedMembers=function(){return this.fn.length},n.prototype.reset=function(){this.hn=null,this.fn=[]},n.prototype.dispose=function(){this.reset()},n.getSimilarMembers=function(e,i,n){var r=t.filter(n,function(t){return t.getObservableScreenName().getValue()!==e&&(!i||t.getSessionId()!==i)}),s=t.filter(r,o),h=t.filter(r,a);return u(e)?s||h||r:c(e)?h||s||r:r||s||h},n}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(4),i(2),i(26),i(32),i(23),i(15),i(11),i(12),i(14),i(29),i(33)],void 0===(r=function(t,e,i,n,r,s,o,a,u,c,h,f,d){"use strict";var l=["streaming","rtmp"];function m(i){e.Rt(i,"options"),i.pcastExpress&&e.Rt(i.pcastExpress,"options.pcastExpress"),this.dn=i.pcastExpress||new r(i),this.ln=!i.pcastExpress,this.mn={},this.pn=[],this.vn={},this.gn=[],this.yn={},this.wn={},this.Ct=this.dn.getPCast().getLogger(),this.v=new n.DisposableList,this.bn=!1,this.kn=new d(i.features);var s=this;this.dn.getPCastObservable().subscribe(function(e){if(!e){var i=t.assign({},s.mn);t.forOwn(s.yn,function(t){t.dispose()}),s.dn.waitForOnline(function(){t.forOwn(i,function(t){t.stop("pcast-change")})},!0),s.Ct.info("Resetting Room Express after change in pcast."),s.yn={},s.mn={},s.gn=[]}})}function p(e,i,n){var r=this,o=t.uniqueId();this.dn.waitForOnline(function(t){if(t)return n(t);var a=v.call(r,e,i);if(a)return n(null,{status:"ok",roomService:a});r.mn[o]=new s(r.dn.getPCast());var u=function(t,e){var i=this,n=t.stop,r=t.leaveRoom;return t.stop=function(){n.apply(t,arguments),delete i.mn[e]},t.leaveRoom=function(e){var n=t.getObservableActiveRoom().getValue();r.call(t,function(r,s){return r?(t.stop("leave-room-failure"),e(r)):"ok"!==s.status&&"not-in-room"!==s.status?e(null,s):(n&&i.yn[n.getRoomId()]&&(i.yn[n.getRoomId()].dispose(),delete i.yn[n.getRoomId()]),i.Ct.info("Successfully disposed Express Room Service [%s]",n?n.getRoomId():"Uninitialized"),t.stop("leave-room"),e(null,s))})},t}.call(r,r.mn[o],o);n(null,{status:"ok",roomService:u})})}function v(e,i){return t.find(this.gn,function(t){var n=t.getObservableActiveRoom().getValue();return n&&(n.getRoomId()===e||n.getObservableAlias().getValue()===i)})}function g(e,i,n){var r=this,s=e.role,o=e.screenName||t.uniqueId();p.call(r,e.roomId,e.alias,function(u,h){if(u)return i(u);if("ok"!==h.status)return i(null,h);var f=h.roomService,d=f.getObservableActiveRoom(),l=d.getValue(),m=null,p=function(){var t=d.getValue();return t?(m=t.getObservableMembers().subscribe(n,{initial:"notify"}),d.subscribe(function(t){m&&(m.dispose(),m=null),t&&(m=t.getObservableMembers().subscribe(n,{initial:"notify"}))})):r.Ct.warn("Unable to setup members subscription. Not in room.")};if(l||f.start(s,o),e.streams&&e.streams.length>0){var v=e.streams[0];if(e.streamsWildcardTokenCapabilities&&!t.includes(e.streams[0].uri,a.getPCastPrefix())&&(e.streams[0].uri=a.getPCastPrefix()+e.streams[0].uri,r.pn.push(e.streams[0].uri)),e.streamsWildcardTokenCapabilities&&l&&!t.includes(v.uri,"streamToken"))return b.call(r,e,v,l,function(e,r){if(i(e,t.assign({roomService:f},r)),n)return p()});var g=!e.streamsWildcardTokenCapabilities||l||t.includes(v.uri,"streamToken")?e.role:c.roles.audience.name;(function(t,e,i,n){var r=i?i.getObservableActiveRoom().getValue():null;if(t&&i&&i.getSelf().setStreams(t),e&&i&&i.getSelf().getObservableRole().setValue(0===t.length?c.roles.audience.name:e),r&&i.getSelf())return R.call(this,i.getSelf(),n)}).call(r,e.streams,g,f,function(t){if(t)return i(t)})}if(l)return i(null,{status:"ok",roomService:f}),void(n&&p());f.enterRoom(e.roomId,e.alias,function(s,o){if(s)return f.stop("enter-room-failure"),i(s);if("not-found"===o.status)return f.stop("enter-room-failure"),i(null,{status:"room-not-found"});if("ok"!==o.status&&"already-in-room"!==o.status)return f.stop("enter-room-failure"),i(null,o);var a=o.room,u=t.get(e,["streams",0]);return r.gn.push(f),e.streamsWildcardTokenCapabilities&&u&&!t.includes(u.uri,"streamToken")?b.call(r,e,u,a,function(e,r){if(i(e,t.assign({roomService:f},r)),n)return p()}):(i(null,{status:"ok",roomService:f}),n?p():void 0)})})}function y(e,i){this.vn[i.getRoomId()]&&e&&(this.vn[i.getRoomId()]=t.filter(this.vn[i.getRoomId()],function(t){return t.getStreamId()!==e.getStreamId()}))}function w(e,i,n,r){var s=function(e,i,n,r,s,o,u){var c=e.getStream(),h=c?c.getAudioTracks():null,d=c?c.getVideoTracks():null,l=h.length>0&&h[0].enabled,m=d.length>0&&d[0].enabled,p={uri:a.getPCastPrefix()+e.getStreamId(),type:i,audioState:l?f.states.trackEnabled.name:f.states.trackDisabled.name,videoState:m?f.states.trackEnabled.name:f.states.trackDisabled.name},v=t.assign({},n,{streamToken:void 0,streamTokenForBroadcastStream:void 0,streamTokenForLiveStream:void 0});delete v.streamToken,delete v.streamTokenForBroadcastStream,delete v.streamTokenForLiveStream;var g=t.reduce(v,function(t,e,i){return t+(t?"&":"?")+i+"="+e},"");return g.length>0&&(p.uri=p.uri+g),p}(i,e.streamType,e.streamInfo);if(s=S(s,"capabilities",e.capabilities.join(",")),!e.enableWildcardCapability){var o=v.call(this,n.getRoomId(),n.getObservableAlias().getValue()),u=t.assign({},e,{streams:T.call(this,s,n)});return I.call(this,u.streams,u.memberRole,o,n,u,r)}return b.call(this,e,s,n,r)}function b(e,i,n,r){var s,c=this,h="high-availability"===e.viewerStreamSelectionStrategy&&n.getObservableType().getValue()===u.types.channel.name,f=[],d=r,m=a.parsePCastStreamIdFromStreamUri(t.get(i,"uri","")),p=c.getPCastExpress().getPCast().getProtocol(),g=p?p.getSessionId():"",y=c.wn[m];if(t.includes(i,"capabilities")||(i=S(i,"capabilities",e.capabilities.join(","))),h){var w=o.getSimilarMembers(e.screenName,g,n.getObservableMembers().getValue());f=E(w),d=function(a,u){r(a,u);var h=t.get(u,"roomService",v.call(c,n.getRoomId(),n.getObservableAlias().getValue()));if(!a&&"ok"===u.status&&!s&&h){var d=h.getObservableActiveRoom().getValue();s=d.getObservableMembers().subscribe(function(n){var a=h.getSelf(),u=a?a.getSessionId():"",l=E(o.getSimilarMembers(e.screenName,u,n)),p=l.length===f.length&&t.reduce(l,function(e,i){return e?t.includes(f,i):e},!0),v=a?a.getObservableStreams().getValue():[];if(!t.find(v,function(t){return t.getPCastStreamId()===m}))return s.dispose(),void(s=null);p||(c.Ct.debug("Members with similar content to stream [%s] have changed. Generating new wildcard viewer token",m),s.dispose(),s=null,b.call(c,e,i,d,function(t,e){(t||"ok"!==e.status)&&r(t,e)}))}),y&&y.add(s)}}}return function(e,i,n,r,s){var o=[],a=0,u=!1,c=function(){t.forEach(o,function(t){t.dispose()})},h=function(t,e){if(!u){if(t||"ok"!==e.status)return c(),u=!0,s(t,e);++a===o.length&&s(null,{status:"ok"})}};this.Ct.debug("Creating [real-time] and [broadcast] viewer wildcard stream token for published stream [%s] with [%s] additional streams",i,n.length),o.push(k.call(this,[],i,n,r,"streamToken",h)),o.push(k.call(this,["broadcast"],i,n,r,"streamTokenForBroadcastStream",h));var f=t.filter(e,t.bind(t.includes,null,l));return f.length>0&&(this.Ct.debug("Creating [%s] viewer wildcard stream token for published stream [%s] with [%s] additional streams",f,i,n.length),o.push(k.call(this,f,i,n,r,"streamTokenForLiveStream",h))),t.includes(e,"drm")&&(this.Ct.debug("Creating [drm-open-access] and [drm-hollywood] viewer wildcard stream token for published stream [%s] with [%s] additional streams",i,n.length),o.push(k.call(this,["streaming","drm-open-access"],i,n,r,"streamTokenForLiveStreamWithDrmOpenAccess",h)),o.push(k.call(this,["streaming","drm-hollywood"],i,n,r,"streamTokenForLiveStreamWithDrmHollywood",h))),c}.call(this,e.capabilities,m,f,i,function(s,o){if(s)return r(s);if("ok"!==o.status)return r(null,o);var a=v.call(c,n.getRoomId(),n.getObservableAlias().getValue()),u=t.assign({},e,{streams:T.call(c,i,n)});return I.call(c,u.streams,u.memberRole,a,n,u,d)})}function k(t,e,i,n,r,s){return this.dn.getAdminAPI().createStreamTokenForSubscribing("*",t,e,i,function(t,e){return t?s(t):"ok"!==e.status?s(null,e):(n=S(n,r,e.streamToken),void s(null,e))})}function S(t,e,i){var n=t.uri.indexOf("?"),r=n>-1?"&":"?",s=t.uri.indexOf("#",-1===n?t.uri.length:n),o=-1===s?t.uri:t.uri.substring(0,s),a=-1===s?"":t.uri.substring(s);return t.uri=o+r+e+"="+i+a,t}function E(e){return t.reduce(e,function(e,i){var n=t.get(i.getObservableStreams().getValue(),"0"),r=n?n.getPCastStreamId():"";return r&&e.push(r),e},[])}function T(e,i){var n=this,r=v.call(this,i.getRoomId(),i.getObservableAlias().getValue()),s=e?[e]:[];if(!r)return s;var o=r.getSelf();if(!o)return s;var u=t.map(o.getObservableStreams().getValue(),function(t){return t.toJson()}),c=this.vn[i.getRoomId()]||[],h=t.map(c,function(t){return t.getStreamId()});return u&&0!==u.length?(e&&(u=t.filter(u,function(t){var i=t.uri===e.uri,n=a.parsePCastStreamIdFromStreamUri(t.uri),r=!!n&&n===a.parsePCastStreamIdFromStreamUri(e.uri),s=e.uri.split("?")[0]===t.uri.split("?")[0],o=t.type===e.type;return!i&&!r&&!s||!o})).push(e),t.filter(u,function(e){return!a.parsePCastStreamIdFromStreamUri(e.uri)||t.includes(h,a.parsePCastStreamIdFromStreamUri(e.uri)||e.uri)||t.includes(n.pn,e.uri.split("?")[0])})):s}function I(e,i,n,r,s,o){var a=v.call(this,r.getRoomId(),r.getObservableAlias().getValue()),u=n?n.getObservableActiveRoom().getValue():null,c=!u&&!a;if(this.bn)return this.Ct.warn("Unable to update self after express room service disposal.");if(e&&a&&(this.Ct.debug("Preparing member streams for update in room [%s].",r.getRoomId()),a.getSelf().setStreams(e)),i&&a&&a.getSelf().getObservableRole().getValue()!==i&&(this.Ct.debug("Preparing member role for update in room [%s].",r.getRoomId()),a.getSelf().getObservableRole().setValue(i)),u&&a.getSelf())return R.call(this,a.getSelf(),o);if(c){this.Ct.info("Joining room with member [%s].",r.getRoomId());var h=t.assign({role:i,alias:t.get(s,["room","alias"]),roomId:t.get(s,["room","roomId"])},s);g.call(this,h,function(t,e){return t?o(t):"ok"!==e.status&&"already-in-room"!==e.status?o(null,e):void o(t,e)})}}function R(t,e){var i=0,n=this;try{t.commitChanges(function r(s,o){return s&&i++,o&&"ok"!==o.status&&i++,o&&"ok"===o.status?(i=0,!e||e(null,o)):i>=5?(n.Ct.warn("Unable to update self after [%s] attempts.",5),e(new Error("Unable to update self"))):i>0&&i<5?(n.Ct.warn("Unable to update self after [%s] attempts. Retrying.",i),t.commitChanges(r)):void 0})}catch(t){e(t)}}function C(t,e,i){return e?t(e):i.retry?i.retry():void t(e,i)}return m.prototype.dispose=function(){this.bn=!0,function(){t.forOwn(this.yn,function(t){t.dispose()}),t.forOwn(this.vn,function(e){t.forEach(e,function(t){t.stop("dispose")})}),t.forOwn(this.mn,function(t){t.stop("dispose")}),this.yn={},this.vn={},this.pn=[],this.mn={},this.gn=[]}.call(this),this.ln&&this.dn.dispose(),this.v.dispose(),this.Ct.info("Disposed Room Express Instance")},m.prototype.getPCastExpress=function(){return this.dn},m.prototype.createRoom=function(i,n){e.It(n,"callback"),e.Rt(i.room,"options.room"),e.qt(i.room.name,"options.room.name"),e.qt(i.room.type,"options.room.type"),i.room.description&&e.qt(i.room.description,"options.room.description");var r=i.room.description||function(t){switch(i.room.type){case u.types.channel.name:return"Room Channel";case u.types.moderatedChat.name:return"Moderated Chat";case u.types.multiPartyChat.name:return"Multi Party Chat";case u.types.townHall.name:return"Town Hall";case u.types.directChat.name:return"Direct Chat";default:throw new Error("Unsupported Room Type")}}();p.call(this,null,null,function(e,s){if(e)return n(e);if("ok"!==s.status)return n(null,s);var o=s.roomService,a=t.assign({},i.room);a.description||(a.description=r),o.createRoom(a,function(t,e){return t?n(t):(o.stop("create"),n(null,e))})})},m.prototype.joinRoom=function(t,i,n){e.Rt(t,"options"),e.It(i,"joinRoomCallback"),e.qt(t.role,"options.role"),n&&e.It(n,"membersChangedCallback"),t.screenName&&e.qt(t.screenName,"options.screenName"),t.roomId&&e.qt(t.roomId,"options.roomId"),t.alias&&e.qt(t.alias,"options.alias"),t.streams&&e.isArray(t.streams,"options.streams");var r=this,s=function(e){e&&g.call(r,t,function(t,n){var r=n;if(r&&r.roomService){var s=r.roomService.leaveRoom;r.roomService.leaveRoom=function(t){o&&"offline"!==e.getObservableStatus()&&o.dispose(),s(t)}}i(t,n)},n)};if(this.dn.getPCastObservable())return s(this.dn.getPCastObservable());var o=this.dn.getPCastObservable().subscribe(s)},m.prototype.publishToRoom=function(i,r){e.Rt(i,"options"),e.It(r,"callback"),e.Rt(i.room,"options.room"),i.streamUri?e.qt(i.streamUri,"options.streamUri"):i.mediaConstraints?e.Rt(i.mediaConstraints,"options.mediaConstraints"):e.Rt(i.userMediaStream,"options.userMediaStream"),i.videoElement&&e.Rt(i.videoElement,"options.videoElement"),i.screenName&&e.qt(i.screenName,"options.screenName"),i.capabilities&&e.isArray(i.capabilities,"options.capabilities"),i.tags&&e.isArray(i.tags,"options.tags"),i.streamInfo&&e.Rt(i.streamInfo,"options.streamInfo"),i.viewerStreamSelectionStrategy&&e.qt(i.viewerStreamSelectionStrategy,"options.viewerStreamSelectionStrategy"),t.isUndefined(i.enableWildcardCapability)&&(i.enableWildcardCapability=!0),e.Pe(i.streamType,h.types,"options.streamType"),e.Pe(i.memberRole,c.roles,"options.memberRole"),e.Sn(i.enableWildcardCapability,"options.enableWildcardCapability");var s=this,o=i.screenName||t.uniqueId();this.createRoom(i,function(e,a){if(e)return r(e);if("ok"!==a.status&&"already-exists"!==a.status)return r(null,a);var h=a.room,d=t.assign({monitor:{callback:t.bind(C,s,r),options:{conditionCountForNotificationThreshold:8}},streamInfo:{}},i);if(h.getObservableType().getValue()===u.types.channel.name?d.tags=["channelId:"+h.getRoomId()].concat(d.tags||[]):d.tags=["roomId:"+h.getRoomId()].concat(d.tags||[]),i.streamUri){var l=t.assign({connectOptions:[]},d);return t.find(l.connectOptions,function(e){return t.startsWith(e,"room-id")})||(l.connectOptions=l.connectOptions.concat(["room-id="+h.getRoomId(),"member-role="+i.memberRole,"member-stream-type="+i.streamType,"screen-name="+o])),i.enableWildcardCapability&&l.connectOptions.concat(["member-stream-token-type=Wildcard","member-stream-token-refresh-interval="+3e5]),s.dn.publishRemote(l,function(e,i){r(e,i?t.assign({roomService:null},i):i)})}var m=t.assign({},i,{role:c.roles.audience.name,roomId:h.getRoomId()});g.call(s,m,function(e,i){if(e)return r(e);if("ok"!==i.status&&"already-in-room"!==i.status)return r(null,a);var o=i.roomService.getObservableActiveRoom().getValue();(function(e,i,r){var s,o,a=this,u=function(e,i){r(e,i?t.assign({publisher:s},i):i)},h=function(r,h){if(o&&s&&clearInterval(o),r)return u(r);if("ok"!==h.status)return u(null,h);(function(t,e){this.vn[e.getRoomId()]||(this.vn[e.getRoomId()]=[]),this.vn[e.getRoomId()].push(t)}).call(a,h.publisher,i),y.call(a,s,i),s=h.publisher,a.wn[s.getStreamId()]=new n.DisposableList;var d=t.bind(s.stop,s);s.stop=function(){clearInterval(o),y.call(a,s,i);var t=T.call(a,null,i),n=v.call(a,i.getRoomId()),r=a.wn[s.getStreamId()];r&&(r.dispose(),delete a.wn[s.getStreamId()]),d.apply(s,arguments),n&&I.call(a,t,0===t.length?c.roles.audience.name:e.memberRole,n,i,e,function(t){if(t)return u(t)})},function(e,i){var r=this,s=r.wn[e.getStreamId()],o=e.getStream();if(o){var a=o.getTracks();t.forEach(a,function(a){var u=function(){var n=a.enabled?f.states.trackEnabled.name:f.states.trackDisabled.name,s=v.call(r,i.getRoomId());if(s&&s.getSelf()){var u=s.getSelf().getObservableStreams().getValue(),c=t.find(u,function(t){return t.getPCastStreamId()===e.getStreamId()}),h=function(e){var i=t.find(this.gn,function(i){var n=i.getSelf(),r=n?n.getObservableStreams().getValue():[];return t.find(r,function(t){return e===t})});return i?i.getSelf():null}.call(r,c);if(!c)return r.Ct.warn("[%s] [%s] Unable to update member state change after track state change [%s]. Member stream no longer exists on member model.",o.id,a.id,a.enabled);r.Ct.info("[%s] [%s] Track state changed to [%s], updating room member stream state [%s]",o.id,a.id,a.enabled,n),"video"===a.kind?c.getObservableVideoState().setValue(n):c.getObservableAudioState().setValue(n),h&&R.call(r,h)}};t.addEventListener(a,"StateChange",u),s.add(new n.Disposable(function(){t.removeEventListener(a,"StateChange",u)}))})}}.call(a,s,i),e.enableWildcardCapability&&(o=setInterval(function(){a.Ct.info("Refresh wildcard viewer stream token for [%s] interval of [%s] has expired. Creating new token.",s.getStreamId(),3e5);var t=v.call(a,i.getRoomId(),i.getObservableAlias().getValue()),n=t?t.getObservableActiveRoom().getValue():i;w.call(a,e,s,n,function(t,e){(t||"ok"!==e.status)&&u(t,e)})},3e5),a.v.add(new n.Disposable(function(){clearInterval(o)}))),w.call(a,e,h.publisher,i,u)};if(t.get(e,["mediaConstraints","screen"],!1))return t.set(e,["streamInfo","isScreen"],!0),this.dn.publishScreen(e,h);this.dn.publish(e,h)}).call(s,d,o,function(e,n){r(e,n?t.assign({roomService:i.roomService},n):n)})})})},m.prototype.publishScreenToRoom=function(e,i){var n=t.assign({mediaConstraints:{screen:!0}},e);this.publishToRoom(n,i)},m.prototype.subscribeToMemberStream=function(i,r,s,o){if(e.Rt(i,"memberStream"),e.Rt(r,"options"),e.It(s,"callback"),o=t.ee(o)?o:0,r.capabilities)throw new Error("subscribeToMemberStream options.capabilities is deprecated. Please use the constructor features option");var u,c,h=this,l=i.getUri(),m=i.getPCastStreamId(),p=i.getInfo(),v=t.get(p,["isScreen"],!1),g=null,y=p.capabilities||(u=l,c=[],a.getInfoFromStreamUri(u).streamTokenForLiveStream&&c.push("streaming"),c)||[],w=this.kn.getPreferredFeatureFromPublisherCapabilities(y),b=d.mapFeatureToPCastCapability(w),k=b?[b]:[],S=this.kn.getFeaturePCastCapabilities(),E=!1;if(!m)throw this.Ct.error("Invalid Member Stream. Unable to parse streamId from uri"),new Error("Invalid Member Stream. Unable to parse streamId from uri");if(t.hasIndexOrKey(p,"capabilities")){if(!w)return this.Ct.warn("Unable to find supported feature. Publisher capabilities [%s]. Requested feature capabilities [%s]",p.capabilities,this.kn.getFeaturePCastCapabilities()),s(null,{status:"unsupported-features"});g=function(t,e){var i=a.getInfoFromStreamUri(t);switch(e){case"rtmp":case"hls":case"dash":return i.streamTokenForLiveStream;case"real-time":return i.streamToken;default:return}}(l,w)}else{if(!w){var T=t.get(S,[o]);if(!T&&o>=S.length)return s(null,{status:"no-supported-features"});k=T?[T]:[],w=T?t.get(d.mapPCastCapabilityToFeatures(T),[0]):null}if(!p.streamTokenForLiveStream&&"streaming"===b)return this.Ct.warn("Streaming is not available for stream [%].",m),s(null,{status:"streaming-not-available"});g=function(e,i){var n=a.getInfoFromStreamUri(e),r=n.streamTokenForLiveStream&&t.includes(i,"streaming"),s=n.streamTokenForLiveStream&&t.includes(i,"rtmp");if(!t.includes(i,"drm-open-access")||!t.includes(i,"drm-hollywood"))return r&&n.streamTokenForLiveStreamWithDrmOpenAccess&&(t.includes(i,"drm-open-access")||/(android)/i.test(navigator.userAgent))?n.streamTokenForLiveStreamWithDrmOpenAccess:r&&n.streamTokenForLiveStreamWithDrmHollywood&&t.includes(i,"drm-hollywood")?n.streamTokenForLiveStreamWithDrmHollywood:r||s?n.streamTokenForLiveStream:n.streamTokenForBroadcastStream&&t.includes(i,"broadcast")?n.streamTokenForBroadcastStream:t.includes(i,"streaming")||t.includes(i,"broadcast")||t.includes(i,"rtmp")?void 0:n.streamToken}(l,k),E=!0}this.Ct.info("Subscribing to member stream with feature [%s] and pre-generated token [%s]",w,!!g);var I=t.assign({},{streamId:m,streamToken:g,capabilities:k},r),R=new n.DisposableList;(function(e,i,r){var s=this,o=0,a=function(e,i){if(e)return r(e);if("ok"!==i.status&&"streaming-not-ready"!==i.status)return r(null,i);if(o++,"streaming-not-ready"===i.status&&o<3){var a=o*o*1e3;s.Ct.info("Waiting for [%s] ms before retrying after [streaming-not-ready] status.",a);var u=setTimeout(i.retry,a);s.v.add(new n.Disposable(function(){clearTimeout(u)}))}else{if("streaming-not-ready"===i.status&&o>=3)return r(null,{status:i.status});var c=t.assign({},i,{status:"ok"});if(o>1)return c.reason="stream-failure-recovered",r(null,c);r(null,c)}};return i?s.dn.subscribeToScreen(e,a):s.dn.subscribe(e,a)}).call(this,I,v,function(e,n){if(R.dispose(),n&&"ok"===n.status&&n.mediaStream&&n.mediaStream.getStream()&&(R.add(i.getObservableAudioState().subscribe(function(t){var e=n.mediaStream.getMonitor(),i=n.mediaStream.getStream().getAudioTracks();e&&1===i.length&&e.setMonitorTrackState(i[0],t===f.states.trackEnabled.name)},{initial:"notify"})),R.add(i.getObservableVideoState().subscribe(function(t){var e=n.mediaStream.getMonitor(),i=n.mediaStream.getStream().getVideoTracks();e&&1===i.length&&e.setMonitorTrackState(i[0],t===f.states.trackEnabled.name)},{initial:"notify"}))),e&&6===parseInt(e.category))return s(e,{status:"device-insecure"});if(n&&("failed"===n.status||"streaming-not-available"===n.status)&&E&&o<S.length)return h.Ct.info("Attempting to subscribe to member stream with next available feature after failure"),h.subscribeToMemberStream(i,r,s,o+1);var a=t.assign({originStreamId:m},n);s(e,a)})},m}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(6),i(2)],void 0===(r=function(t,e,i,n){"use strict";var r=2e4,s={timeout:r,retryOptions:{backoff:1.5,delay:1e3,maxAttempts:3,additionalRetryErrorCodes:[0]}},o={body:{id:1,name:"body"},header:{id:2,name:"header"}},a={createStreamTokenPath:"/stream",createAuthTokenPath:"/auth"},u={auth:{id:1,name:"auth"},stream:{id:2,name:"stream"}};function c(){this.En=null,this.Tn="",this.In=a,this.Rn={},this.Cn=o.body.name,this.v=new n.DisposableList}function h(e,i){var s=null,o=e(t.bind(d,this,function(t,e){clearTimeout(s),i(t,e)}));return s=setTimeout(function(){o.dispose(),i(new Error("timeout"))},r),this.v.add(o),this.v.add(new n.Disposable(function(){clearTimeout(s)})),o}function f(e,i,n,r,s){switch(this.Cn){case o.body.name:r=function(e){return t.assign({},e,this.Rn)}.call(this,r);break;case o.header.name:s=function(e){return e.headers?(e.headers=t.assign({},this.Rn,e.headers),e):t.assign({},{headers:this.Rn},e)}.call(this,s);break;default:throw new Error("Unsupported Authentication Mode "+this.Cn)}return t.bind(e,i,n,JSON.stringify(r),s)}function d(t,e,i){if(e)return t(e,{});var n=JSON.parse(i.data);return"ok"!==n.status?t(null,{status:n.status}):t(null,n)}function l(t,e,i,n){if(!n||i)return e(i,{status:"failed"});var r={status:"ok"};switch(t){case u.auth.name:r.authenticationToken=n;break;case u.stream.name:r.streamToken=n;break;default:throw new Error("Unsupported request type "+t)}return e(i,r)}return c.prototype.dispose=function(){return this.v.dispose()},c.prototype.toString=function(){return"AdminApiProxyClient[customRequestHandler="+(!!this.En).toString()+",backendUri="+this.Tn+",authenticationDataLocationInPayload="+this.Cn+",customEndpointPaths="+(this.In===a).toString()+",customAuthenticationData="+(t.keys(this.Rn).length>0).toString()+"]"},c.prototype.getBackendUri=function(){return this.Tn},c.prototype.setBackendUri=function(t){e.Xt(t,"backendUri"),this.Tn=t},c.prototype.getEndpointPaths=function(){return t.assign({},this.In)},c.prototype.setEndpointPaths=function(i){e.Rt(i,"endpointPaths"),i.createStreamTokenPath&&e.qt(i.createStreamTokenPath,"endpointPaths.createStreamTokenPath"),i.createAuthTokenPath&&e.qt(i.createAuthTokenPath,"endpointPaths.createAuthTokenPath"),this.In=t.assign({},a,i)},c.prototype.getAuthenticationData=function(){return t.assign({},this.Rn)},c.prototype.setAuthenticationData=function(t){e.Rt(t,"authenticationData"),this.Rn=t},c.prototype.getAuthenticationDataLocationInPayload=function(){return this.Cn},c.prototype.setAuthenticationDataLocationInPayload=function(t){e.Pe(t,o,"authenticationDataLocationInPayload"),this.Cn=t},c.prototype.getRequestHandler=function(){return this.En},c.prototype.setRequestHandler=function(i){if(e.It(i,"callback"),this.Tn)throw new Error("Conflicting parameter [backendUri]");if(t.keys(this.Rn).length>0)throw new Error("Conflicting parameter [authenticationData]");if(this.Cn!==o.body.name)throw new Error("Conflicting parameter [authenticationDataLocationInPayload]");if(this.In!==a)throw new Error("Conflicting parameter [endpointPaths]");this.En=i},c.prototype.createAuthenticationToken=function(e){if(this.En)return this.En(u.auth.name,{},t.bind(l,this,u.auth.name,e));var n=f.call(this,i.postWithRetry,i,this.Tn+this.In.createAuthTokenPath,{},s);return h.call(this,n,e)},c.prototype.createStreamTokenForPublishing=function(n,r,o){e.qt(n,"sessionId"),e.Rt(r,"capabilities");var a={sessionId:n,capabilities:r};if(this.En)return this.En(u.stream.name,a,t.bind(l,this,u.stream.name,o));var c=f.call(this,i.postWithRetry,i,this.Tn+this.In.createStreamTokenPath,a,s);return h.call(this,c,o)},c.prototype.createStreamTokenForPublishingToExternal=function(t,e,i,n){this.createStreamTokenForSubscribing(t,e,i,null,n)},c.prototype.createStreamTokenForSubscribing=function(n,r,o,a,c){e.qt(n,"sessionId"),e.Rt(r,"capabilities"),t.isNullOrUndefined(a)||(e.isArray(a,"additionalStreamIds"),t.forEach(a,function(t){e.qt(t,"alternateOriginStreamId")}));var d={sessionId:n,capabilities:r,originStreamId:o};if(a&&a.length>0&&(d.alternateOriginStreamIds=a),this.En)return this.En(u.stream.name,d,t.bind(l,this,u.stream.name,c));var m=f.call(this,i.postWithRetry,i,this.Tn+this.In.createStreamTokenPath,d,s);return h.call(this,m,c)},c}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(4),i(13),i(25),i(27),i(46),i(3),i(51)],void 0===(r=function(t,e,i,n,r,s,o,a,u){"use strict";var c="unauthorized",h=1e3,f=2e4,d={maxOfflineTime:18e4,maxReconnectFrequency:6e4};function l(n){if(e.Rt(n,"options"),n.authToken&&e.qt(n.authToken,"options.authToken"),n.onError&&e.It(n.onError,"options.onError"),!t.isNullOrUndefined(n.onlineTimeout)&&(e.ee(n.onlineTimeout,"options.onlineTimeout"),n.onlineTimeout<0))throw new Error('"options.onlineTimeout" must be a positive number');n.reconnectOptions&&(e.Rt(n.reconnectOptions,"options.reconnectOptions"),e.ee(n.reconnectOptions.maxOfflineTime,"options.reconnectOptions.maxOfflineTime"),e.ee(n.reconnectOptions.maxReconnectFrequency,"options.reconnectOptions.maxReconnectFrequency")),n.adminApiProxyClient&&(e.Rt(n.adminApiProxyClient,"options.adminApiProxyClient"),e.It(n.adminApiProxyClient.createAuthenticationToken,"options.adminApiProxyClient.createAuthenticationToken")),this.Mn=new i.Observable(null).extend({rateLimit:0}),this.Pn={},this.xn={},this.Dn=n.adminApiProxyClient||new r,this.On=!1,this.An=0,this.qn=0,this.Un=n.authToken,this.Qi=n.onError,this.h=n,this.Fn=t.ee(n.onlineTimeout)?n.onlineTimeout:f,this.Nn=n.reconnectOptions||d,this.Ct=null,this.jn={},n.adminApiProxyClient||(this.Dn.setBackendUri(n.backendUri),this.Dn.setAuthenticationData(n.authenticationData)),p.call(this),n.adminApiProxyClient||(n.backendUri&&this.Ct.warn("Passing options.backendUri is deprecated. Please create an instance of the sdk.net.AdminApiProxyClient and pass that instead"),n.authenticationData&&this.Ct.warn("Passing options.authenticationData is deprecated. Please create an instance of the sdk.net.AdminApiProxyClient and pass that instead"))}l.prototype.dispose=function(){this.Ln&&(this.Ln.dispose(),this.Ln=null),this.Mn.getValue()&&(this.Mn.getValue().stop(),this.Mn.setValue(null)),t.ee(this.Bn)&&(clearTimeout(this.Bn),this.Bn=null),this.Dn.dispose(),this.qn=0,this.An=0,this.Ct.info("Disposed PCast Express Instance")},l.prototype.getPCast=function(){return this.Mn.getValue()},l.prototype.getPCastObservable=function(){return this.Mn},l.prototype.getAdminAPI=function(){return this.Dn},l.prototype.getUserMedia=function(t,i){var n=this;if(e.Rt(t.mediaConstraints,"options.mediaConstraints"),e.It(i,"callback"),t.resolution&&e.ee(t.resolution,"options.resolution"),t.frameRate&&e.ee(t.frameRate,"options.frameRate"),t.aspectRatio&&e.qt(t.aspectRatio,"options.aspectRatio"),t.onResolveMedia&&e.It(t.onResolveMedia,"options.onResolveMedia"),t.onScreenShare&&e.It(t.onScreenShare,"options.onScreenShare"),n.Mn.getValue())return b.call(n,n.Mn.getValue(),t,i);var r=n.Mn.subscribe(function(e){e&&(r.dispose(),b.call(n,e,t,i))})},l.prototype.publish=function(t,i){e.Rt(t,"options"),e.It(i,"callback"),t.capabilities&&e.isArray(t.capabilities,"options.capabilities"),t.connectOptions&&e.isArray(t.connectOptions,"options.connectOptions"),t.mediaConstraints?e.Rt(t.mediaConstraints,"options.mediaConstraints"):e.Rt(t.userMediaStream,"options.userMediaStream"),t.videoElement&&e.Rt(t.videoElement,"options.videoElement"),t.monitor&&(e.Rt(t.monitor,"options.monitor"),e.It(t.monitor.callback,"options.monitor.callback"),t.monitor.options&&e.Rt(t.monitor.options,"options.monitor.options")),t.streamToken&&e.qt(t.streamToken,"options.streamToken");var n=this;this.waitForOnline(function(e){return e?i(e):t.userMediaStream?k.call(n,t.userMediaStream,t,!1,i):void n.getUserMedia(t,function(e,r){return e?i(e):"ok"!==r.status?i(null,r):void k.call(n,r.userMedia,t,!0,i)})},t.isContinuation)};var m=["streaming","low-latency","on-demand","uld","vvld","vld","ld","sd","hd","fhd","uhd"];function p(){var e=this;if(!this.Mn.getValue()){var i=t.assign({logger:this.Ct},this.h);this.Mn.setValue(new o(i))}if(this.Ct||(this.Ct=this.Mn.getValue().getLogger()),this._n||(this._n=this.Mn.getValue().getObservableStatus().subscribe(t.bind(v,this))),this.Un)return this.Mn.getValue().start(this.Un,t.noop,t.noop,t.noop);this.Dn.createAuthenticationToken(function(i,n){return i&&"timeout"===i.message?v.call(e,i.message):i?w.call(e,i):"ok"!==n.status?v.call(e,n.status):e.Mn.getValue()?void e.Mn.getValue().start(n.authenticationToken,t.noop,t.noop,t.noop):e.Ct.warn("Unable to authenticate. PCast not instantiated.")})}function v(t){switch(t){case"timeout":case"critical-network-issue":return this.Mn.getValue()&&(this.Mn.getValue().stop("recovery"),this.Mn.setValue(null)),this._n&&(this._n.dispose(),this._n=null),this.qn++,g.call(this);case"reconnect-failed":case"unauthorized":return delete this.Un,this.An++,this.An>1?w.call(this,new Error(t)):(this.Ct.info("[Express] Attempting to create new authToken and re-connect after [%s] response",c),y.call(this));case"capacity":case"network-unavailable":return this.qn++,g.call(this);case"online":return this.An=0,this.qn=0,this.On||this.Ct.info("Express API successfully instantiated"),void(this.On=!0);case"reconnecting":case"reconnected":case"connecting":break;case"offline":return;case"failed":default:return w.call(this,new Error(t))}}function g(){var t=this,e=Math.min(h*t.qn*t.qn,this.Nn.maxReconnectFrequency),i=Math.min(e/1e4,5),n=e+Math.random()*i*1e3;this.Ct.info("Waiting for [%s] ms before continuing to attempt to reconnect to PCast",n),this.Bn=setTimeout(function(){return t.Mn.getValue()&&t.Mn.getValue().isStarted()?y.call(t):p.call(t)},n)}function y(){var t=this;this.Dn.createAuthenticationToken(function(e,i){return e&&"timeout"===e.message?v.call(t,e.message):e?w.call(t,e):"ok"!==i.status?v.call(t,i.status):t.Mn.getValue()?void t.Mn.getValue().reAuthenticate(i.authenticationToken):t.Ct.warn("Unable to authenticate. PCast not instantiated.")})}function w(t){if(!this.Qi)throw t;this.Qi(t)}function b(i,n,r){new s(i,{aspectRatio:n.aspectRatio,resolutionHeight:n.resolution,frameRate:n.frameRate,resolutionSelectionStrategy:n.resolutionSelectionStrategy,onScreenShare:function(i){return(i=n.onScreenShare?n.onScreenShare(i):i).resolution&&e.ee(i.resolution,"clientOptions.resolution"),i.frameRate&&e.ee(i.frameRate,"screenOptions.frameRate"),i.aspectRatio&&e.qt(i.aspectRatio,"screenOptions.aspectRatio"),t.assign({resolutionHeight:i.resolution},i)}}).getUserMedia(n.mediaConstraints,function(e,i){if(e)return r(e);n.onResolveMedia&&n.onResolveMedia(i.options),r(null,t.assign({status:"ok"},i))})}function k(i,n,r,s){var o=this;if(e.isArray(n.capabilities,"options.capabilities"),n.streamToken)return S.call(o,n.streamToken,i,n,r,s);o.waitForOnline(function(e){if(e)return o.Ct.error("Failed to create stream token for publishing after waiting for online status",e),s(e);var a=o.Mn.getValue().getProtocol().getSessionId(),u=t.includes(n.capabilities,"egress"),c=t.bind(o.Dn.createStreamTokenForPublishing,o.Dn,a,n.capabilities);u&&(c=t.bind(o.Dn.createStreamTokenForPublishingToExternal,o.Dn,a,n.capabilities,n.streamId)),o.Ct.info("[%s] Creating stream token for publishing",a),c(function(t,e){return t?(o.Ct.error("[%s] Failed to create stream token for publishing",a,t),s(t)):"ok"!==e.status?(o.Ct.warn("[%s] Failed to create stream token for publishing with status [%s]",a,e.status),s(null,e)):void S.call(o,e.streamToken,i,n,r,s)})},n.isContinuation)}function S(i,n,r,s,o){var u=this,h=!1,f=null;r.tags&&e.isArray(r.tags,"options.tags"),r.connectOptions&&e.isArray(r.connectOptions,"options.connectOptions");var d=function(e,d,l){var m=function(e){var a=t.uniqueId(),c=t.assign({streamToken:i,isContinuation:!0},r);u.xn[a]=!0,u.Ct.warn("Retrying publisher after failure with reason [%s]",e),u.jn[l.getStreamId()]=!0,"camera-track-failure"===e?(l.stop(e,!1),u.publish(r,o)):(l.stop(e,!0),k.call(u,n,c,s,o)),delete u.xn[a]};if(d===c&&(r.streamToken||!r.authFailure)||"timeout"===d){u.Ct.info("[Express] Attempting to create new streamToken and re-publish after [%s] response",c);var p=t.assign({isContinuation:!0,authFailure:!0},r);return delete p.streamToken,k.call(u,n,p,s,o)}if("ok"!==d)return u.Ct.warn("Failure to publish with status [%s]",d),f&&(u.jn[f.getStreamId()]=!0),o(null,{status:d});delete r.authFailure,u.xn[l.getStreamId()]=l,f=l,r.videoElement&&!h&&(a.attachMediaStream(r.videoElement,n),h=!0);var v=t.bind(M,u,function(){},m,!0);if(r.monitor){var g=t.bind(C,u,r.monitor.callback,m);l.monitor(r.monitor.options||{},g),v=t.bind(M,u,r.monitor.callback,m,!0)}l.setPublisherEndedCallback(v);var y=function(e,i,n){var r=t.bind(e.stop,e);return e.stop=function(t,s){if(r(t),i&&(i.src="",i.srcObject=null),n&&e.getStream()&&!s){var o=e.getStream();o&&o.getTracks().forEach(function(t){t.stop()})}},e.enableAudio=function(){return T(e.getStream(),!0)},e.disableAudio=function(){return T(e.getStream(),!1)},e.enableVideo=function(){return I(e.getStream(),!0)},e.disableVideo=function(){return I(e.getStream(),!1)},e.setPublisherEndedCallback=function(){},e}.call(u,l,r.videoElement,s);o(null,{status:"ok",publisher:y})};u.waitForOnline(function(t){if(t)return o(t);u.Mn.getValue().publish(i,n,d,r.tags,{connectOptions:r.connectOptions})},r.isContinuation)}function E(e,i,r){var s=this,o=null,a=function(a,h,f){var d,l=function(n){var o=t.uniqueId(),a=t.assign({isContinuation:!0},i);s.Pn[o]=!0,s.jn[f.getStreamId()]=!0,f.stop(n),s.Ct.warn("[%s] Stream failure occurred with reason [%s]. Attempting to recover from failure.",i.streamId,n),E.call(s,e,a,r),delete s.Pn[o]};if(h===c&&(i.streamToken||!i.authFailure)||"timeout"===h){s.Ct.info("[%s] [Express] Attempting to create new streamToken and re-subscribe after [%s] response",i.streamId,c);var m=t.assign({isContinuation:!0,authFailure:!0},i);return delete m.streamToken,s.subscribe(m,r)}if("streaming-not-ready"===h)return s.Ct.warn("Failure to subscribe with status [%s]. Try again in a few seconds.",h),r(null,{status:h,retry:t.bind(l,s,h)});if("ok"!==h)return s.Ct.warn("Failure to subscribe with status [%s]",h),o&&(s.jn[o.getStreamId()]=!0),r(null,{status:h});delete i.authFailure,s.Pn[f.getStreamId()]=f,o=f,i.videoElement&&(d=f.createRenderer()).start(i.videoElement);var p=t.noop,v=t.bind(M,s,p,l,!1);if(i.monitor){var g=t.bind(C,s,i.monitor.callback,l);f.monitor(i.monitor.options||{},g),v=t.bind(M,s,i.monitor.callback,l,!1)}f.setStreamEndedCallback(v);var y=function(e,i){var n=t.bind(e.stop,e);return e.stop=function(t){i&&i.stop(t),n(t)},e.enableAudio=function(){return T(e.getStream(),!0)},e.disableAudio=function(){return T(e.getStream(),!1)},e.enableVideo=function(){return I(e.getStream(),!0)},e.disableVideo=function(){return I(e.getStream(),!1)},e.setStreamEndedCallback=function(){},e}.call(s,f,d),w={status:"ok",mediaStream:y};f.setStreamErrorCallback(function(e,o,a){if("real-time"===o&&"connection-timeout"===a.message)return l.call(s,a.message);if("shaka"!==o||a.severity===u.errorSeverity.critical.id){if("phenix-player"===o&&a.severity===n.errors.severity.RECOVERABLE){s.Ct.warn("[%s] Recoverable error occurred while playing stream with Express API. Attempting to subscribe again.",y.getStreamId(),a);var c=t.assign({isContinuation:!0},i);return delete c.streamToken,s.subscribe(c,r)}return s.Ct.warn("[%s] Error occurred while playing stream with Express API. Stopping stream.",y.getStreamId(),a),y.stop(),r(a)}}),d&&(w.renderer=d),r(null,w)};s.waitForOnline(function(t){if(t)return r(t);s.Mn.getValue().subscribe(e,a,i.subscriberOptions)},i.isContinuation)}function T(t,e){if(t)return R(t.getAudioTracks(),e),e}function I(t,e){if(t)return R(t.getVideoTracks(),e),e}function R(i,n){e.isArray(i,"tracks"),t.forEach(i,function(t){t.enabled=n})}function C(e,i,n,r,s){switch(r){case"camera-track-failure":case"client-side-failure":e(null,t.assign({status:r,retry:t.bind(i,null,r)},s))}}function M(t,e,i,n,r,s){var o={status:"stream-ended",reason:r,description:s};if(this.jn[n.getStreamId()])return this.Ct.info("Ignoring stream end due to recovery in progress [%s]",n.getStreamId());switch(r){case"egress-setup-failed":case"ended":case"censored":var a={status:r,reason:r,description:s};return i?a.publisher=n:a.mediaStream=n,t(null,a);case"custom":return t(null,o);case"egress-failed":case"capacity":return setTimeout(function(){return e(r)},h);case"failed":case"maintenance":return e(r);case"app-background":default:return o.retry=e,t(null,o)}}return l.prototype.publishRemote=function(i,n){if(e.Rt(i,"options"),e.It(n,"callback"),e.qt(i.streamUri,"options.streamUri"),i.capabilities&&e.isArray(i.capabilities,"options.capabilities"),i.connectOptions&&e.isArray(i.connectOptions,"options.connectOptions"),i.mediaConstraints)throw new Error("Invalid argument: mediaConstraints, passed on publishRemote. Local media not allowed when publishing remote content.");if(i.videoElement)throw new Error("May not view remote stream publisher. Please subscribe to view.");i.prerollSkipDuration&&e.ee(i.prerollSkipDuration,"options.prerollSkipDuration"),i.monitor&&(e.Rt(i.monitor,"options.monitor"),e.It(i.monitor.callback,"options.monitor.callback"),i.monitor.options&&e.Rt(i.monitor.options,"options.monitor.options")),i.frameRate&&(e.Rt(i.frameRate,"options.frameRate"),i.frameRate.exact&&e.ee(i.frameRate.exact,"options.frameRate.exact"),i.frameRate.max&&e.ee(i.frameRate.max,"options.frameRate.max")),i.streamToken&&e.qt(i.streamToken,"options.streamToken");var r=this;this.waitForOnline(function(e){if(e)return n(e);var s=t.assign({connectOptions:[],capabilities:[]},i);t.includes(s.capabilities,"publish-uri")||s.capabilities.push("publish-uri"),t.forEach(m,function(e){t.includes(s.capabilities,e)&&s.connectOptions.push("publisher-capability="+e)}),i.frameRate&&i.frameRate.exact&&s.connectOptions.push("source-uri-video-fps="+i.frameRate.exact),i.frameRate&&i.frameRate.max&&s.connectOptions.push("source-uri-video-fps-max="+i.frameRate.max),s.connectOptions.push("source-uri-preroll-skip-duration="+(t.ee(i.prerollSkipDuration)?i.prerollSkipDuration:500).toString()),k.call(r,s.streamUri,s,!1,n)})},l.prototype.publishStreamToExternal=function(i,n){if(e.Rt(i,"options"),e.It(n,"callback"),e.qt(i.streamId,"options.streamId"),e.qt(i.externalUri,"options.externalUri"),i.capabilities&&e.isArray(i.capabilities,"options.capabilities"),i.connectOptions&&e.isArray(i.connectOptions,"options.connectOptions"),i.mediaConstraints)throw new Error("Invalid argument: mediaConstraints, passed on publishStreamToExternal. Local media not allowed when publishing remote content.");if(i.videoElement)throw new Error("May not view remote stream publisher. Please subscribe to view.");i.monitor&&(e.Rt(i.monitor,"options.monitor"),e.It(i.monitor.callback,"options.monitor.callback"),i.monitor.options&&e.Rt(i.monitor.options,"options.monitor.options")),i.streamToken&&e.qt(i.streamToken,"options.streamToken");var r=this;this.waitForOnline(function(e){if(e)return n(e);var s=t.assign({connectOptions:[],capabilities:[]},i);t.includes(s.capabilities,"egress")||s.capabilities.push("egress"),t.includes(s.capabilities,"egress-own-stream")||s.capabilities.push("egress-own-stream"),k.call(r,s.externalUri,s,!1,n)})},l.prototype.publishScreen=function(e,i){var n=t.assign({mediaConstraints:{screen:!0}},e);return t.set(n,["monitor","options"],t.assign({},{monitorFrameRate:!1,videoBitRateThreshold:100,conditionCountForNotificationThreshold:8},t.get(n,["monitor","options"],{}))),this.publish(n,i)},l.prototype.subscribe=function(t,i){e.Rt(t,"options"),e.It(i,"callback"),e.qt(t.streamId,"options.streamId"),e.Rt(t.capabilities,"options.capabilities"),t.videoElement&&e.Rt(t.videoElement,"options.videoElement"),t.monitor&&(e.Rt(t.monitor,"options.monitor"),e.It(t.monitor.callback,"options.monitor.callback"),t.monitor.options&&e.Rt(t.monitor.options,"options.monitor.options")),t.streamToken&&e.qt(t.streamToken,"options.streamToken"),t.subscriberOptions&&e.Rt(t.subscriberOptions,"options.subscriberOptions");var n=this;this.waitForOnline(function(e){return e?(n.Ct.error("Failed to subscribe after error waiting for online status",e),i(e)):t.streamToken?E.call(n,t.streamToken,t,i):(n.Ct.info("[%s] Generating stream token for subscribing to origin [%s]",n.Mn.getValue().getProtocol().getSessionId(),t.streamId),void n.Dn.createStreamTokenForSubscribing(n.Mn.getValue().getProtocol().getSessionId(),t.capabilities,t.streamId,null,function(e,r){return e?(n.Ct.error("Failed to create stream token for subscribing",e),i(e)):"ok"!==r.status?(n.Ct.warn("Failed to create stream token for subscribing with status [%s]",r.status),i(null,r)):void E.call(n,r.streamToken,t,i)}))},t.isContinuation)},l.prototype.subscribeToScreen=function(e,i){var n=t.assign({},e);return t.set(n,["monitor","options"],t.assign({},{monitorFrameRate:!1,videoBitRateThreshold:100,conditionCountForNotificationThreshold:8},t.get(n,["monitor","options"],{}))),this.subscribe(n,i)},l.prototype.waitForOnline=function(i,n){if(e.It(i,"callback"),this.Mn.getValue()&&"online"===this.Mn.getValue().getStatus())return i();var r=this,s=n?t.get(r.Nn,["maxOfflineTime"]):this.Fn,o=null,a=null,u=setTimeout(function(){r.Ct.info("Disposing of Express Online listener after [%s] ms",s),o&&o.dispose(),a&&a.dispose(),i(new Error("timeout"))},s);this.Ct.info("Waiting for Online status before continuing. Timeout set to [%s]",s);var c=function(t){a&&a.dispose(),t&&(a=t.getObservableStatus().subscribe(function(t){if("online"===t)return clearTimeout(u),a.dispose(),o.dispose(),i()},{initial:"notify"}))};this.Mn.getValue()&&c(this.Mn.getValue()),o=this.Mn.subscribe(c)},l}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(3),i(52)],void 0===(r=function(t,e,i,n){"use strict";function r(i,n){e.Rt(i,"pcast"),n&&e.Rt(n,"options"),n&&n.screenShare&&e.It(n.screenShare,"options.screenShare"),this.Wn=i,this.Ct=i.getLogger(),this.h=n||{},this.zn=t.get(n,["onScreenShare"])}return r.prototype.getUserMedia=function(r,s){e.Rt(r,"deviceOptions");var o=new n(this.h),a=o.getDefaultResolution(),u=o.getDefaultFrameRate();(function e(n,r,s,o,a){var u=this.getVendorSpecificConstraints(n,r||{},s),c=!!u.video,h=this;this.Wn.getUserMedia(u,function(u,f,d,l){if("ok"===f)return a(null,{userMedia:d,options:{frameRate:c?s:null,resolution:c?t.get(r,["height"],null):null,aspectRatio:c?t.get(r,["aspectRatio"],null):null}});var m=r,p=s,v=function(t){return t.constraintName?t.constraintName:t.constraint?t.constraint:""}(l);if(l&&("ConstraintNotSatisfiedError"===l.name||"OverconstrainedError"===l.name||"OverconstrainedError"===l.constructor.name||"unavailable"===l.code&&"Edge"===i.browser))switch(v.toLowerCase()){case"width":case"height":if(!r||!o.canResolveNextResolution())break;return h.Ct.warn("Unable to get user media with constraint [%s] with height [%s] and width [%s]. Retrying with next closest resolution.",v,m.height,m.width),m=o.getNextResolution(r.height,r.aspectRatio),e.call(h,n,m,p,o,a);case"framerate":default:if(s)return h.Ct.warn("Unable to get user media with constraint [%s] and framerate [%s]. Retrying without frame rate constraint.",v,s),e.call(h,n,m,p=null,o,a);if(!r||!o.canResolveNextResolution())break;return h.Ct.warn("Unable to get user media with constraint [%s] with height [%s] and width [%s]. Retrying with next closest resolution.",v,m.height,m.width),m=o.getNextResolution(r.height,r.aspectRatio),e.call(h,n,m,p,o,a)}return h.Ct.error("Unable to get user media with status [%s]",f,l),a(l)},function(e){var n=e;if(h.zn&&"Chrome"===i.browser){var r,s=function(e){var i=t.get(e,["video","mandatory","chromeMediaSource"]),n=t.get(e,["audio","mandatory","chromeMediaSource"]),r=t.get(e,["video","mandatory","chromeMediaSourceId"]),s=t.get(e,["audio","mandatory","chromeMediaSourceId"]),o={};return(i||s)&&(t.set(o,["screen","mediaSource"],i),t.set(o,["screen","mediaSourceId"],r)),(n||s)&&(t.set(o,["screenAudio","mediaSource"],n),t.set(o,["screenAudio","mediaSourceId"],s)),o}(e);(n=h.zn(s)).resolutionHeight&&n.aspectRatio&&(r={width:o.calculateWidthByAspectRatio(n.resolution,n.aspectRatio),height:n.resolutionHeight}),n=function(e,i,n){var r=this.getVendorSpecificConstraints(e,i,n);r.screen&&(r.video=r.screen,delete r.screen),r.screenAudio&&(r.audio=r.screenAudio,delete r.screenAudio);var s=t.get(r,["video","mandatory","mediaSource"]),o=t.get(r,["audio","mandatory","mediaSource"]),a=t.get(r,["video","mandatory","mediaSourceId"]),u=t.get(r,["audio","mandatory","mediaSourceId"]);return(s||a)&&(t.set(r,["video","mandatory","chromeMediaSource"],s),t.set(r,["video","mandatory","chromeMediaSourceId"],a),delete r.video.mandatory.mediaSource,delete r.video.mandatory.mediaSourceId),(o||u)&&(t.set(r,["audio","mandatory","chromeMediaSource"],o),t.set(r,["audio","mandatory","chromeMediaSourceId"],u),delete r.audio.mandatory.mediaSource,delete r.audio.mandatory.mediaSourceId),r}.call(h,s,r,n.frameRate)}return n})}).call(this,r,a,u,o,s)},r.prototype.getVendorSpecificConstraints=function(t,e,n){if(e=e||{},!t||!t.audio&&!t.video&&!t.screen&&!t.screenAudio)throw new Error("Invalid device options. Must pass in at least one device option.");return"Firefox"===i.browser&&i.browserVersion>38||"Chrome"===i.browser&&i.browserVersion>52&&!t.screen&&!t.screenAudio||"Safari"===i.browser&&i.browserVersion>10||"Opera"===i.browser&&i.browserVersion>40?function(t,e,i){var n=t.video,r=t.audio,s=t.screen,o=t.screenAudio,a=e.width,u=e.height,c={};return n&&(c.video={height:{min:u,ideal:u,max:u},width:{min:a,ideal:a,max:a},frameRate:{ideal:i,max:i}},n.deviceId&&(c.video.deviceId={exact:n.deviceId}),n.facingMode&&(c.video.facingMode=n.facingMode),a||delete c.video.width,u||delete c.video.height,i||delete c.video.frameRate,a||u||i||n.deviceId||n.facingMode||(c.video=!0)),r&&(c.audio={},r.deviceId&&(c.audio.deviceId={exact:r.deviceId}),r.mediaSource&&(c.audio.mediaSource=r.mediaSource),r.mediaSourceId&&(c.audio.mediaSourceId=r.mediaSourceId),r.deviceId||r.mediaSource||r.mediaSourceId||(c.audio=!0)),o&&(c.screenAudio={},o.deviceId&&(c.screenAudio.deviceId={exact:o.deviceId}),o.mediaSource&&(c.screenAudio.mediaSource=o.mediaSource),o.mediaSourceId&&(c.screenAudio.mediaSourceId=o.mediaSourceId),o.deviceId||o.mediaSource||o.mediaSourceId||(c.screenAudio=!0)),s&&(c.screen={height:{min:u,ideal:u,max:u},width:{min:a,ideal:a,max:a},frameRate:{ideal:i,max:i}},a||delete c.screen.width,u||delete c.screen.height,i||delete c.screen.frameRate,s.mediaSource&&(c.screen.mediaSource=s.mediaSource),a||u||i||s.mediaSource||(c.screen=!0)),s&&n&&(c.screen=!0),c}(t,e,n):"Edge"===i.browser?function(t,e,i){var n=t.video,r=t.audio,s=t.screen,o=e.width,a=e.height,u={};return n&&(u.video={height:{min:a,max:a,exact:a},width:{min:o,max:o,exact:o},frameRate:i},n.deviceId&&(u.video.deviceId=n.deviceId),n.facingMode&&(u.video.facingMode=n.facingMode),o||delete u.video.width,a||delete u.video.height,i||delete u.video.frameRate,o||a||i||n.deviceId||n.facingMode||(u.video=!0)),r&&(u.audio=!0,r.deviceId&&(u.audio={deviceId:r.deviceId})),s&&(u.screen=!0),u}(t,e,n):function(t,e,i){var n=t.video,r=t.audio,s=t.screen,o=t.screenAudio,a=e.width,u=e.height,c={};return n&&(c.video={mandatory:{minHeight:u,maxHeight:u,minWidth:a,maxWidth:a,maxFrameRate:i}},n.deviceId&&(c.video.mandatory.sourceId=n.deviceId),n.facingMode&&(c.video.facingMode=n.facingMode),n.mediaSource&&(c.video.mandatory.mediaSource=n.mediaSource),n.mediaSourceId&&(c.video.mandatory.mediaSourceId=n.mediaSourceId),a||(delete c.video.mandatory.minWidth,delete c.video.mandatory.maxWidth),u||(delete c.video.mandatory.minHeight,delete c.video.mandatory.maxHeight),i||delete c.video.mandatory.maxFrameRate,a||u||i||n.deviceId||n.facingMode||n.mediaSource||n.mediaSourceId||(c.video=!0)),r&&(c.audio={mandatory:{}},r.deviceId&&(c.audio.mandatory.sourceId=r.deviceId),r.mediaSource&&(c.audio.mandatory.mediaSource=r.mediaSource),r.mediaSourceId&&(c.audio.mandatory.mediaSourceId=r.mediaSourceId),r.deviceId||r.mediaSource||r.mediaSourceId||(c.audio=!0)),o&&(c.screenAudio={mandatory:{}},o.deviceId&&(c.screenAudio.mandatory.sourceId=o.deviceId),o.mediaSource&&(c.screenAudio.mandatory.mediaSource=o.mediaSource),o.mediaSourceId&&(c.screenAudio.mandatory.mediaSourceId=o.mediaSourceId),o.deviceId||o.mediaSource||o.mediaSourceId||(c.screenAudio=!0)),s&&(c.screen={mandatory:{minHeight:u,maxHeight:u,minWidth:a,maxWidth:a,maxFrameRate:i}},a||(delete c.screen.mandatory.minWidth,delete c.screen.mandatory.maxWidth),u||(delete c.screen.mandatory.minHeight,delete c.screen.mandatory.maxHeight),i||delete c.screen.mandatory.maxFrameRate,s.mediaSource&&(c.screen.mandatory.mediaSource=s.mediaSource),s.mediaSourceId&&(c.screen.mandatory.mediaSourceId=s.mediaSourceId),a||u||i||s.mediaSource||(c.screen=!0)),s&&n&&(c.screen=!0),c}(t,e,n)},r}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1)],void 0===(r=function(t,e){"use strict";function i(t){e.Rt(t,"pcast"),e.It(t.getObservableStatus,"pcast.getObservableStatus"),e.It(t.getLogger,"pcast.getLogger"),e.It(t.getProtocol,"pcast.getProtocol"),this.Wn!==t&&(this.Wn=t,this.Ct=t.getLogger(),this.Vn=t.getProtocol(),e.Rt(this.Ct,"this._logger"),e.Rt(this.Vn,"this._protocol"),e.It(this.Vn.getObservableSessionId,"this._protocol.getObservableSessionId"),e.It(this.Wn.getObservableStatus,"this._pcast.getObservableStatus"),this.Hn=this.Vn.getObservableSessionId(),this.Gn=this.Wn.getObservableStatus())}return i.prototype.assertAuthorized=function(){if(null===(t=this.getPCastStatus())||void 0===t||""===t||"offline"===t.toLowerCase())throw new Error("Unable to perform action. Status [%s]. Please wait to reconnect.",this.getPCastStatus());var t,e;if(null===(e=this.getPCastSessionId())||void 0===e||""===e)throw new Error("Unable to perform action. Invalid sessionId [%s]",this.getPCastSessionId())},i.prototype.getObservableSessionId=function(){return this.Hn},i.prototype.getObservableStatus=function(){return this.Gn},i.prototype.getPCastSessionId=function(){return this.Hn.getValue()},i.prototype.getPCastStatus=function(){return this.Gn.getValue()},i}.apply(e,n))||(t.exports=r)},function(t,e,i){var n;void 0===(n=function(){"use strict";return{states:{trackEnabled:{id:0,name:"TrackEnabled"},trackDisabled:{id:1,name:"TrackDisabled"},trackEnded:{id:2,name:"TrackEnded"}}}}.apply(e,[]))||(t.exports=n)},function(t,e,i){var n,r;n=[i(0),i(1),i(4),i(15),i(12)],void 0===(r=function(t,e,i,n,r){"use strict";var s=r.roles,o=r.states;function a(t,e,i,n,r,s,o){this.init(t,e,i,n,r,s,o)}function u(t){return new n(t.uri,t.type,t.audioState,t.videoState)}function c(i){return e.Pe(i,s,"memberRole"),t.getEnumName(s,i)}function h(i){return e.Pe(i,o,"memberState"),t.getEnumName(o,i)}return a.prototype.init=function(n,r,s,o,a,u,f){e.Xt(s,"sessionId"),e.Xt(o,"screenName"),e.isArray(u,"streams"),e.ee(t.utc(f),"lastUpdate"),n&&e.Rt(n,"roomService"),this.Hn=new i.Observable(s),this.Jn=new i.Observable(o),this.et=new i.ObservableArray([]),this.Kn=new i.Observable(r,h).extend({rateLimit:500}),this.Xn=new i.Observable(a,c),this.Ni=new i.Observable(f,t.utc),this.Qn=n,this.setStreams(u)},a.prototype.getObservableState=function(){return this.Kn},a.prototype.getSessionId=function(){return this.Hn.getValue()},a.prototype.getObservableScreenName=function(){return this.Jn},a.prototype.getObservableRole=function(){return this.Xn},a.prototype.getObservableStreams=function(){return this.et},a.prototype.getObservableLastUpdate=function(){return this.Ni},a.prototype.getLastUpdate=function(){return this.Ni.getValue()},a.prototype.getStreams=function(){return t.map(this.et.getValue(),function(t){return t.toJson()})},a.prototype.commitChanges=function(t){e.Rt(this.Qn,"this._roomService"),this.Qn.updateMember(this,t)},a.prototype.reload=function(){e.Rt(this.Qn,"this._roomService"),this.Qn.revertMemberChanges(this)},a.prototype.setStreams=function(e){var i=t.map(e,function(t){return u(t)});this.et.setValue(i)},a.prototype.toString=function(){return this.getObservableRole().getValue()+"["+this.getObservableScreenName().getValue()+","+this.getSessionId()+"]"},a.prototype.toJson=function(){var e={sessionId:this.Hn.getValue(),screenName:this.Jn.getValue(),role:this.Xn.getValue(),state:this.Kn.getValue(),streams:[],lastUpdate:this.Ni.getValue()};return t.forEach(this.et.getValue(),function(t){e.streams.push(t.toJson())}),e},a.prototype.en=function(e){t.Rt(e)&&(e.hasOwnProperty("state")&&this.Kn.setValue(e.state),e.hasOwnProperty("screenName")&&this.Jn.setValue(e.screenName),e.hasOwnProperty("role")&&this.Xn.setValue(e.role),e.hasOwnProperty("lastUpdate")&&this.Ni.setValue(e.lastUpdate),e.hasOwnProperty("streams")&&function(e){var i=this.et.getValue(),r=[];t.forEach(e,function(e){var s=n.parsePCastStreamIdFromStreamUri(e.uri),o=t.find(i,function(t){var i=t.getUri()===e.uri,n=t.isPCastStream()&&t.getPCastStreamId()===s,r=i||n;return t.getType()===e.type&&r});o?o.en(e):o=u(e),r.push(o)}),this.et.setValue(r)}.call(this,e.streams))},a}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(4),i(30),i(11)],void 0===(r=function(t,e,i,n,r){"use strict";var s=r.types;function o(t,e,i,n,r,s,o,a,u){this.init(t,e,i,n,r,s,o,a,u)}function a(e,i){return t.map(e,function(t){return new n(i,t.state,t.sessionId,t.screenName,t.role,t.streams,t.lastUpdate)})}function u(e){if(!(e=t.getEnumName(s,e)))throw new Error('"type" must be a valid room type');return e}return o.prototype.init=function(t,n,r,s,o,c,h,f,d){e.qt(s,"name"),e.qt(o,"description"),e.isArray(h,"members"),n&&e.qt(n,"id"),r&&e.qt(r,"alias"),f&&e.qt(f,"bridgeId"),d&&e.qt(d,"pin"),t&&e.Rt(t,"roomService"),this.$n=new i.Observable(n),this.Yn=new i.Observable(r),this.Ut=new i.Observable(s),this.Zn=new i.Observable(o),this.Bt=new i.Observable(c,u),this.tr=new i.ObservableArray([]).extend({method:"notifyWhenChangesStop",timeout:400}),this.h=new i.ObservableArray,this.er=new i.Observable(f),this.ir=new i.Observable(d),this.Qn=t,function(t){var e=a(t,this.Qn);this.tr.setValue(e)}.call(this,h)},o.prototype.getRoomId=function(){return this.$n.getValue()},o.prototype.getObservableAlias=function(){return this.Yn},o.prototype.getObservableName=function(){return this.Ut},o.prototype.getObservableDescription=function(){return this.Zn},o.prototype.getObservableType=function(){return this.Bt},o.prototype.getObservableMembers=function(){return this.tr},o.prototype.getObservableBridgeId=function(){return this.er},o.prototype.getObservablePin=function(){return this.ir},o.prototype.toString=function(){return this.Bt.getValue()+"["+this.$n.getValue()+"]"},o.prototype.toJson=function(){return{roomId:this.$n.getValue(),alias:this.Yn.getValue(),name:this.Ut.getValue(),description:this.Zn.getValue(),type:this.Bt.getValue(),pin:this.ir.getValue(),bridgeId:this.er.getValue()}},o.prototype.commitChanges=function(t){e.Rt(this.Qn,"this._roomService"),this.Qn.updateRoom(this,t)},o.prototype.reload=function(){e.Rt(this.Qn,"this._roomService"),this.Qn.revertRoomChanges(this)},o.prototype.en=function(e){t.Rt(e)&&(e.roomId&&this.$n.setValue(e.roomId),e.alias&&this.Yn.setValue(e.alias),e.name&&this.Ut.setValue(e.name),e.description&&this.Zn.setValue(e.description),e.type&&this.Bt.setValue(e.type),e.options&&this.h.setValue(e.options),e.bridgeId&&this.er.setValue(e.bridgeId),e.pin&&this.ir.setValue(e.pin),e.members)},o.prototype.sn=function(e){var i=this,n=a(e);t.forEach(n,function(t){i.tr.push(t)})},o.prototype.an=function(e){var i=this;t.forEach(e,function(t){i.tr.remove(function(e){return t.sessionId===e.getSessionId()&&t.lastUpdate>=e.getObservableLastUpdate().getValue()})})},o.prototype.un=function(e){t.forEach(this.tr.getValue(),function(i){var n=t.find(e,function(t){return i.getSessionId()===t.sessionId&&t.lastUpdate>i.getObservableLastUpdate().getValue()});n&&i.en(n)})},o}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(4),i(2),i(28),i(31),i(59),i(30),i(58),i(11),i(12)],void 0===(r=function(t,e,i,n,r,s,o,a,u,c,h){"use strict";var f=t.freeze({status:"not-in-room"}),d=t.freeze({status:"already-in-room"}),l=t.freeze({status:"in-another-room"});function m(t){e.Rt(t,"pcast"),e.It(t.getLogger,"pcast.getLogger"),e.It(t.getProtocol,"pcast.getProtocol"),this.Wn=t,this.Ct=t.getLogger(),this.Vn=t.getProtocol(),this.nr=new i.Observable(null),this.rr=new i.Observable(null),this.sr=new i.Observable(null),this.or=null,e.Rt(this.Ct,"this._logger"),e.Rt(this.Vn,"this._protocol"),this.ar=new r(this.Wn)}function p(){this.nr.setValue(null),this.rr.setValue(null),this.sr.setValue(null),this.or=null,this.v&&this.v.dispose(),this.v=null}function v(){var e=this,i=e.rr.getValue(),n=e.nr.getValue().getSessionId();if(t.Rt(i)&&n){var r=i.getRoomId(),s=i.getObservableAlias().getValue();e.Ct.info("Leaving and re-entering room after reset of self model"),E.call(e,function(){S.call(e,r,s,function(){e.Ct.info("Room Reset Completed")})})}}function g(i){switch(e.Rt(i,"event"),e.Xt(i.roomId,"event.roomId"),e.Xt(i.eventType,"event.eventType"),e.isArray(i.members,"event.members"),t.forEach(i.members,function(t){e.Rt(t,"member")}),i.eventType){case c.events.memberJoined.name:return this.Ct.debug("[%s] Member joined [%s]",i.roomId,i.members),function(e,i){var n=this.rr.getValue(),r=this.sr.getValue();if(n&&n.getRoomId()===e){n.an(i),n.sn(i),r.an(i),r.sn(i);var s=this,o=t.find(i,function(t){return t.sessionId===s.getSelf().getSessionId()});o&&(C.call(s,n),n.un([o])),this.Ct.info("[%s] Room has now [%d] members",e,n.getObservableMembers().getValue().length)}}.call(this,i.roomId,i.members);case c.events.memberLeft.name:return this.Ct.debug("[%s] Member left [%s]",i.roomId,i.members),function(e,i){var n=this.rr.getValue(),r=this.sr.getValue();if(n&&n.getRoomId()===e){var s=this,o=t.find(i,function(t){return t.sessionId===s.getSelf().getSessionId()}),a=this.getSelf();a&&o&&a.getObservableLastUpdate().setValue(o.lastUpdate),n.an(i),r.an(i),this.Ct.info("[%s] Room has now [%d] members",e,n.getObservableMembers().getValue().length)}}.call(this,i.roomId,i.members);case c.events.memberUpdated.name:return this.Ct.debug("[%s] Member updated [%s]",i.roomId,i.members),function(e,i){var n=this.rr.getValue(),r=this.sr.getValue();if(n&&n.getRoomId()===e){var s=function(e){var i=this;return t.map(e,function(t){var e=w(t.sessionId,i.sr),n=k(new a(null,t.state,t.sessionId,t.screenName,t.role,t.streams,t.lastUpdate),e);return n.lastUpdate=t.lastUpdate,n})}.call(this,i);n.un(s),r.un(s),this.Ct.info("[%s] Room has [%d] updated members",e,i.length)}}.call(this,i.roomId,i.members);case c.events.roomUpdated.name:return this.Ct.debug("[%s] Room updated [%s]",i.roomId,i.room),function(t,e){var i=this.rr.getValue(),n=this.sr.getValue();i&&i.getRoomId()===t&&(n.en(e),i.en(e))}.call(this,i.roomId,i.room);case c.events.roomEnded.name:this.Ct.info("[%s] Room ended",i.roomId);break;default:this.Ct.warn("Unsupported room event [%s]",i.eventType)}}function y(t){this.getSelf()&&this.getSelf().getSessionId()===(t||"")||function(t){var e=this.nr.getValue().toJson();this.Ct.info("Resetting self after sessionId changed to [%s]",t),this.nr.setValue(new a(this,e.state,t||"",e.screenName,e.role,e.streams,e.lastUpdate))}.call(this,t)}function w(e,i){return function(e,i){return t.find(i,function(t){return e===t.getSessionId()})}(e,i.getValue().getObservableMembers().getValue())}function b(e){this.Ct.info("PCast status changed to [%s]",e),"offline"!==e.toLowerCase()&&"offline"===this.ur||"offline"===e.toLowerCase()&&"offline"!==this.ur&&t.isNullOrUndefined(this.ur),this.ur=e}function k(e,i){var n=function(e,i){if(!i)return e.toJson();var n={},r=e.toJson(),s=i.toJson(),o=t.findDifferences(r,s,!0);return t.forEach(o,function(t){n[t]=r[t]}),n}(e,i);return n.sessionId=e.getSessionId(),n.lastUpdate=i?i.getLastUpdate():t.now(),n}function S(e,i,n){var r=this.rr.getValue();if(r){var s=e===r.getRoomId()||i===r.getObservableAlias().getValue();return this.Ct.info("Unable to join room. Already in [%s]/[%s] room.",r.getRoomId(),r.getObservableAlias().getValue()),n(null,t.assign({room:r},s?d:l))}this.ar.assertAuthorized();var o=this.nr.getValue(),a=o.getObservableScreenName().getValue(),u=o.getObservableRole().getValue(),c=k.call(this,o,null),h=t.now();this.Ct.info("Enter room [%s]/[%s] with screen name [%s] and role [%s]",e,i,a,u);var f=this;this.Vn.enterRoom(e,i,c,h,function(t,e){if(t)return f.Ct.error("Joining of room failed with error [%s]",t),n(t,null);var i={status:e.status};if("ok"!==e.status)return f.Ct.warn("Joining of room failed with status [%s]",e.status),n(null,i);i.room=function(t){var e=R.call(this,t),i=R.call(this,t);return C.call(this,e),this.rr.setValue(e),this.sr.setValue(i),e}.call(f,e),"ok"===e.status&&e.self&&f.getSelf().en(e.self),n(null,i)})}function E(e){if(!this.rr.getValue())return this.Ct.info("Unable to leave room. Not currently in a room."),e(null,f);if(!this.cr){this.ar.assertAuthorized();var i=this.rr.getValue().getRoomId(),n=t.now();this.Ct.info("Leave room [%s]",i);var r=this;this.cr=!0,this.Vn.leaveRoom(i,n,function(t,i){if(r.cr=!1,t)return r.Ct.error("Leaving room failed with error [%s]",t),e(t,null);var n={status:i.status};if("ok"!==i.status)return r.Ct.warn("Leaving room failed with status [%s]",i.status),e(null,n);r.or&&r.or.stop(),r.or=null,r.rr.setValue(null),r.sr.setValue(null),e(null,n)})}}function T(e,i){if(!this.rr.getValue())return this.Ct.warn("Not in a room. Please Enter a room before updating member."),i(null,f);this.ar.assertAuthorized();var n=this.rr.getValue().getRoomId(),r=e.getSessionId()===this.getSelf().getSessionId(),s=w(e.getSessionId(),this.sr),o=k.call(this,e,s),a=t.now(),u=r&&!s,c=r&&o.role===h.roles.audience.name;u&&(o.lastUpdate=e.getObservableLastUpdate().getValue()),this.Ct.info("Updating member info for active room [%s]",n);var d=this;this.Vn.updateMember(n,o,a,function(e,n){if(e)return d.Ct.error("Update of member failed with error [%s]",e),i(e,null);var r={status:n.status};"ok"!==n.status&&d.Ct.warn("Update of member failed with status [%s]",n.status),"ok"===n.status&&c&&t.ee(n.lastUpdate)&&d.getSelf().getObservableLastUpdate().setValue(n.lastUpdate),i(null,r)})}function I(t){var e=t.room,i=t.members||[];return new o(this,e.roomId,e.alias,e.name,e.description,e.type,i,e.bridgeId,e.pin)}function R(t){var e=t.room,i=t.members;return new s(this,e.roomId,e.alias,e.name,e.description,e.type,i,e.bridgeId,e.pin)}function C(e){var i=this.nr.getValue(),n=e.getObservableMembers().getValue(),r=t.findIndex(n,function(t){return i.getSessionId()===t.getSessionId()});if(!t.ee(r))return this.Ct.info("Self not in server room model.");i.en(n[r].toJson()),n[r]=i,e.getObservableMembers().setValue(n)}return m.prototype.start=function(r,s){if(this.hr)return this.Ct.warn("RoomService already started.");e.qt(r,"role"),e.qt(s,"screenName");var o=h.states.passive.name,u=this.ar.getPCastSessionId(),c=s,f=t.now(),d=new a(this,o,u,c,r,[],f);this.nr=new i.Observable(d),this.v=new n.DisposableList;var l=this.Vn.onEvent("chat.RoomEvent",t.bind(g,this));return this.v.add(l),function(){var e=this.nr.subscribe(t.bind(v,this)),i=this.ar.getObservableStatus().subscribe(t.bind(b,this)),n=this.ar.getObservableSessionId().subscribe(t.bind(y,this));this.v.add(e),this.v.add(i),this.v.add(n)}.call(this),this.hr=!0,d},m.prototype.getRoomInfo=function(i,n,r){i?e.qt(i,"roomId"):e.qt(n,"alias"),e.It(r,"callback"),function(e,i,n){this.ar.assertAuthorized();var r=this;this.Vn.getRoomInfo(e,i,function(e,i){if(e)return r.Ct.error("Request to get room info failed with error [%s]",e),n(e,null);var s={status:i.status};if("ok"!==i.status)return r.Ct.warn("Request to get room info failed with status [%s]",i.status),n(null,s);s.room=t.freeze(I.call(this,i)),n(null,s)})}.call(this,i,n,r)},m.prototype.createRoom=function(i,n){e.Rt(i,"room"),e.qt(i.name,"room.name"),e.qt(i.type,"room.type"),e.Xt(i.description,"room.description"),e.It(n,"callback"),function(e,i){this.ar.assertAuthorized();var n=this,r=function(t){return new s(this,"",t.alias,t.name,t.description,t.type,[],t.bridgeId,t.pin).toJson()}(e);this.Vn.createRoom(r,function(e,r){if(e)return n.Ct.error("Creating room failed with error [%s]",e),i(e,null);var s={status:r.status};if("ok"!==r.status&&"already-exists"!==r.status)return n.Ct.warn("Creating room failed with status [%s]",r.status),i(null,s);s.room=t.freeze(I.call(this,r)),i(null,s)})}.call(this,i,n)},m.prototype.enterRoom=function(t,i,n){t?e.qt(t,"roomId"):e.qt(i,"alias"),e.It(n,"callback"),S.call(this,t,i,n)},m.prototype.leaveRoom=function(t){return E.call(this,t)},m.prototype.getChatService=function(){return!this.or&&this.rr.getValue()&&(this.or=new u(this)),this.or},m.prototype.getSelf=function(){return this.nr.getValue()},m.prototype.getObservableActiveRoom=function(){return this.rr},m.prototype.updateSelf=function(t){e.It(t,"callback"),T.call(this,this.getSelf(),t)},m.prototype.updateMember=function(t,i){e.It(i,"callback"),e.Rt(t,"member"),T.call(this,t,i)},m.prototype.updateRoom=function(i){e.It(i,"callback"),function(e){if(!this.rr.getValue())return this.Ct.warn("Not in a room. Please Enter a room before updating member."),e(null,f);this.ar.assertAuthorized();var i=this.rr.getValue(),n=t.now(),r=this;this.Vn.updateRoom(i.toJson(),n,function(t,i){if(t)return r.Ct.error("Update of room failed with error [%s]",t),e(t,null);var n={status:i.status};"ok"!==i.status&&r.Ct.warn("Update of room failed with status [%s]",i.status),e(null,n)})}.call(this,i)},m.prototype.revertRoomChanges=function(){var t=this.rr.getValue(),e=this.sr.getValue();if(!t||!e)return this.Ct.warn("Unable to revert changes to room. Not currently in a room.");t.en(e.toJson())},m.prototype.revertMemberChanges=function(t){e.Rt(t,"member");var i=w(t.getSessionId(),this.sr),n=w(t.getSessionId(),this.rr);if(!i||!n)return this.Ct.warn("Unable to revert changes to member. Member is currently not in room.");n.en(i.toJson())},m.prototype.isInRoom=function(){return!!this.rr.getValue()},m.prototype.toString=function(){return"RoomService"},m.prototype.stop=function(t){var e=this.rr.getValue(),i=this;if(this.Ct.info("Stopping room service with reason [%s]",t),e)return this.leaveRoom(function(t,e){t&&i.Ct.warn("Failure to stop room service. Unable to leave room",t),e&&"ok"!==e.status&&i.Ct.warn("Failure to stop room service. Unable to leave room. Status: [%s]",e.status),e&&"ok"===e.status&&(p.call(i),i.hr=!1)});p.call(this),i.hr=!1},m}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(3),i(34),i(7)],void 0===(r=function(t,e,i,n,r){"use strict";var s,o=[r.types.realTime.name,r.types.dash.name,r.types.hls.name];function a(i){i=i||o,e.isArray(i,"features"),t.forEach(i,function(t,i){e.Pe(t,r.types,"FeatureType["+i+"]")}),this.fr=t.map(i,t.bind(t.getEnumName,t,r.types))}function u(e,i){return t.includes(e,i)||e.push(i),e}return a.isFeatureSupported=function(s){switch(s&&e.qt(s,"feature"),t.getEnumName(r.types,s)){case r.types.realTime.name:return i.webrtcSupported;case r.types.dash.name:case r.types.hls.name:case r.types.rtmp.name:return n.canPlaybackType(s);default:return!1}},a.mapFeatureToPCastCapability=function(i){switch(i&&e.qt(i,"feature"),t.getEnumName(r.types,i)){case r.types.realTime.name:return"real-time";case r.types.dash.name:case r.types.hls.name:return"streaming";case r.types.rtmp.name:return"rtmp";default:return""}},a.mapPCastCapabilitiesToFeatures=function(i){return e.isArray(i,"capabilities"),t.reduce(i,function(t,e){return t.concat(a.mapPCastCapabilityToFeatures(e))},[])},a.mapPCastCapabilityToFeatures=function(t){return t&&e.qt(t,"capability"),"real-time"===t?[r.types.realTime.name]:"streaming"===t?[r.types.dash.name,r.types.dash.name]:"rtmp"===t?[r.types.rtmp.name]:[]},a.prototype.getFeatures=function(){return this.fr},a.prototype.getFeaturePCastCapabilities=function(){var e=t.map(this.fr,a.mapFeatureToPCastCapability);return t.reduce(e,u,[])},a.prototype.getPreferredFeatureFromPublisherCapabilities=function(i,n){e.isArray(i,"capabilities");var s=t.reduce(this.fr,function(e,r){var s=a.mapFeatureToPCastCapability(r),o=a.isFeatureSupported(r)&&(t.includes(i,s)||"real-time"===r&&!n);return e||(o?r:null)},null);return s===r.types.dash.name&&a.shouldUseNativeHls&&t.includes(i,a.mapFeatureToPCastCapability(r.types.hls.name))&&t.includes(this.fr,r.types.hls.name)?s=r.types.hls.name:s===r.types.hls.name&&!a.shouldUseNativeHls&&t.includes(i,a.mapFeatureToPCastCapability(r.types.dash.name))&&t.includes(this.fr,r.types.dash.name)&&(s=r.types.dash.name),s},a.shouldUseNativeHls=(s=t.get(i,["global","navigator","userAgent"],""),/iPad|iPhone|iPod/.test(s)&&!i.global.MSStream||"Safari"===i.browser||function(){var e=t.get(i,["global","navigator","userAgent"],"");return/SamsungBrowser/.test(e)}()),a}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(5),i(3),i(13),i(64),i(63),i(62),i(7)],void 0===(r=function(t,e,i,n,r,s,o,a,u){"use strict";function c(t,e,n,r,s,o,a){this.Bt=t,this.Xi=e,this.Ji=n,this.dr=r,this.h=s,this.lr=o,this.Ct=a,this.mr=[],this.pr=null,this.vr=new i.NamedEvents}return c.prototype.on=function(t,e){this.vr.listen(t,e)},c.prototype.createRenderer=function(){var e=null;switch(this.Bt){case u.types.dash.name:e=this.lr?new s(this.Xi,this.Ji,this.dr,this.h,this.lr,this.Ct):new o(this.Xi,this.Ji,this.dr,this.h,this.Ct);break;case u.types.hls.name:e=new o(this.Xi,this.Ji,this.dr,this.h,this.Ct);break;case u.types.rtmp.name:e=new a(this.Xi,this.Ji,this.dr,this.h,this.Ct);break;default:throw new Error("Unsupported Live stream Type "+this.Bt)}var i=this;return e.on(u.rendererEvents.error.name,function(t,e){i.vr.fire(u.streamEvents.playerError.name,[t,e])}),e.on(u.rendererEvents.ended.name,function(n){i.mr=t.filter(i.mr,function(t){return t!==e}),0===i.mr.length&&(i.dr.stop(),i.vr.fire(u.streamEvents.playerEnded.name,[n]))}),this.mr.push(e),e},c.prototype.select=function(t){return this.Ct.warn("[%s] selection of tracks not supported for [%s] live streams",this.Xi,this.Bt),this},c.prototype.setStreamEndedCallback=function(t){e.It(t,"callback"),this.streamEndedCallback=t},c.prototype.setStreamErrorCallback=function(t){e.It(t,"callback"),this.streamErrorCallback=t},c.prototype.stop=function(t){this.isActive()&&(this.Ct.info("[%s] stop [live] media stream with reason [%s]",this.Xi,t),this.vr.fire(u.streamEvents.stopped.name,[t]),this.gr=!0)},c.prototype.monitor=function(t,i){e.Rt(t,"options"),e.It(i,"callback")},c.prototype.getMonitor=function(){return null},c.prototype.getStream=function(){return this.Ct.debug("[%s] stream not available for [%s] live streams",this.Xi,this.Bt),null},c.prototype.isActive=function(){return!this.gr},c.prototype.getStreamId=function(){return this.Xi},c.prototype.getStats=function(){return this.Ct.debug("[%s] stats not available for [%s] live streams",this.Xi,this.Bt),null},c.prototype.getRenderer=function(){return t.get(this.mr,[0],null)},c.canPlaybackType=function(t){switch(t){case u.types.dash.name:return r.WebPlayer.deviceSupportsDashPlayback;case u.types.hls.name:return r.WebPlayer.deviceSupportsHlsPlayback;case u.types.rtmp.name:return a.isSupported();default:return!1}},c}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(67)],void 0===(r=function(t){"use strict";return new t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1)],void 0===(r=function(t,e){"use strict";var i=/profile-level-id=[^;\n]*/,n=/vp8/i,r=/vp9/i,s=/h264/i,o=/h265/i;function a(){}return a.prototype.getH264ProfileIds=function(n){e.qt(n,"offerSdp");for(var r=[],s=n.match(i),o=n;s;){var a=t.get(s,"0","");r.push(a.split("=")[1]),s=(o=o.substring(s.index+a.length,n.length)).match(i)}return r},a.prototype.replaceH264ProfileId=function(i,n,r){e.qt(i,"offerSdp"),e.qt(r,"newProfileId");var s=this.getH264ProfileIds(i);return t.includes(s,n)?i.replace("profile-level-id="+n,"profile-level-id="+r):i},a.prototype.getH264ProfileIdWithSameProfileAndEqualToOrHigherLevel=function(e,i){if(t.includes(e,i))return i;var n=t.reduce(e,function(t,e){var i=parseInt(t.substring(0,2),16),n=parseInt(t.substring(4,6),16),r=parseInt(e.substring(0,2),16),s=parseInt(e.substring(4,6),16);return i!==r?t:n>=s?t:e},i);return n===i?null:n},a.prototype.getH264ProfileIdWithSameOrHigherProfileAndEqualToOrHigherLevel=function(e,i){var n=this.getH264ProfileIdWithSameProfileAndEqualToOrHigherLevel(e,i);if(n)return n;var r=t.reduce(e,function(t,e){var i=parseInt(t.substring(0,2),16),n=parseInt(t.substring(4,6),16),r=parseInt(e.substring(0,2),16),s=parseInt(e.substring(4,6),16);return i<r?e:r<i?t:n>s?t:e},i);return r===i?null:r},a.prototype.getSupportedCodecs=function(t){e.qt(t,"offerSdp");var i=[];return n.test(t)&&i.push("VP8"),r.test(t)&&i.push("VP9"),s.test(t)&&i.push("H264"),o.test(t)&&i.push("H265"),i},a.prototype.hasMediaSectionsInLocalSdp=function(e){var i=this.findInSdpSections(e,function(e){return t.startsWith(e,"video")||t.startsWith(e,"audio")});return t.ee(i)},a.prototype.hasActiveAudio=function(e){var i=this.findInSdpSections(e,function(e,i,n){return!!t.startsWith(e,"audio")&&!t.includes(e,"a=inactive")&&!t.includes(n[i],"a=inactive")});return t.ee(i)},a.prototype.hasActiveVideo=function(e){var i=this.findInSdpSections(e,function(e,i,n){return!!t.startsWith(e,"video")&&!t.includes(e,"a=inactive")&&!t.includes(n[i],"a=inactive")});return t.ee(i)},a.prototype.findInSdpSections=function(e,i){var n=this.getLocalSdp(e).split("m="),r=this.getRemoteSdp(e).split("m=");return n.length===r.length&&t.findIndex(n,function(t,e){return i(t,e,r)})},a.prototype.getNumberOfActiveSections=function(e){var i=(this.getLocalSdp(e)||this.getRemoteSdp(e)).split("m=");return t.filter(i,function(e){return!t.includes(e,"a=inactive")&&(t.startsWith(e,"audio")||t.startsWith(e,"video"))}).length},a.prototype.getLocalSdp=function(e){return t.get(e,["localDescription","sdp"],"")},a.prototype.getRemoteSdp=function(e){return t.get(e,["remoteDescription","sdp"],"")},new a}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(3),i(36),i(16)],void 0===(r=function(t,e,i,n,r){"use strict";function s(t,i,n){e.Xt(t,"name"),e.Rt(i,"peerConnection"),e.Rt(n,"logger"),this.Ut=t,this.yr=i,this.Ct=n,this.wr={}}function o(e){var i=function(e){var i=e.getSenders?t.map(e.getSenders(),function(t){return t.track}):[];if(0===(i=t.filter(i,function(e){return!t.isNullOrUndefined(e)})).length){var n=e.getLocalStreams?e.getLocalStreams():[];return t.reduce(n,function(t,e){return t.concat(e.getTracks())},[])}return i}(e),n=function(e){var i=e.getReceivers?t.map(e.getReceivers(),function(t){return t.track}):[];if(0===(i=t.filter(i,function(e){return!t.isNullOrUndefined(e)})).length){var n=e.getRemoteStreams?e.getRemoteStreams():[];return t.reduce(n,function(t,e){return t.concat(e.getTracks())},[])}return i}(e);if(0!==i.length&&0!==n.length)throw this.Ct.error("Invalid State. PeerConnection contains [%s] local and [%s] remote tracks.",i.length,n.length),new Error("Invalid State. PeerConnection contains both local and remote streams.");return 0!==i.length?i:0!==n.length?n:[]}function a(e){var i=o.call(this,this.yr),n=t.filter(i,function(t){return t.kind===e}),r=t.filter(this.br,function(t){return t.kind===e});return t.reduce(n,function(e,i){if(!e)return e;var n=!!t.find(r,function(t){return t.id===i.id});return!i.enabled||n},!0)}return s.prototype.start=function(s,u,c){if(e.Rt(s,"options"),e.It(u,"activeCallback"),e.It(c,"monitorCallback"),"inbound"!==s.direction&&"outbound"!==s.direction)throw new Error("Invalid monitoring direction");if(this.kr=s.frameRateThreshold||2,this.Sr=s.videoBitRateThreshold||6e3,this.Er=s.audioBitRateThreshold||5e3,this.Tr=s.conditionCountForNotificationThreshold||3,this.Ir=s.monitoringInterval||4e3,this.Rr=s.monitoringInterval||1500,this.Cr=!s.hasOwnProperty("monitorFrameRate")||s.monitorFrameRate,this.Mr=!s.hasOwnProperty("monitorBitRate")||s.monitorBitRate,this.Pr=!s.hasOwnProperty("monitorState")||s.monitorState,this.br=[],"Edge"===i.browser){var h=this.Rr*this.Tr;this.Ir=Math.max(this.Ir,6e3),this.Rr=Math.max(this.Rr,6e3),this.Tr=Math.max(Math.ceil(h/this.Ir),2),this.Ct.info("Using modified options for optimal monitoring of PeerConnection on [Edge]. Monitor Interval [%s], Condition Monitor Interval [%s], Condition Count For Notification [%s]",this.Ir,this.Rr,this.Tr)}return function(e,s,u,c,h){var f=this,d=0,l=void 0,m=void 0,p=void 0,v=null;setTimeout(function g(y){(function(e,n,s,o,a,u){if(!o())return this.Ct.info("[%s] Finished monitoring of peer connection",this.Ut);var c=this;i.getStats(e,null,function(e){var i=r.convertPeerConnectionStats(e,c.wr);i=t.filter(i,function(t){return"inbound"===n.direction&&"download"===t.direction||"outbound"===n.direction&&"upload"===t.direction}),a(i)},function(t){u(t)})}).call(f,s,u,null,c,function(r){var w=!1,b=!1,k=!1;if(!c())return f.Ct.info("[%s] Finished monitoring of peer connection",e);if(!r)throw new Error("Report must be a valid PeerConnection.getStats Report");if(t.forEach(r,function(t){var n="";if("outbound"===u.direction&&"upload"===t.direction)switch(t.mediaType){case"video":t.avgEncode&&(n+=" with average encoding time ["+t.avgEncode+"] ms"),t.cpuLimitedResolution&&(n+=" (CPU limited=["+t.cpuLimitedResolution+"])"),f.Ct.debug("[%s] [%s] [%s] [%s] with bitrate [%s], droppedFrames [%s] and frame rate [%s] and RTT [%s]"+n,e,u.direction,t.mediaType,t.ssrc,t.bitrateMean,t.droppedFrames,t.framerateMean,t.rtt),l=t.framerateMean,m=t.uploadRate?1e3*t.uploadRate:t.uploadRate,w=!0,b=!0,"Edge"===i.browser&&(w=!1);break;case"audio":f.Ct.debug("[%s] [%s] [%s] [%s] and RTT [%s] and jitter [%s] and audio input level [%s]",e,u.direction,t.mediaType,t.ssrc,t.rtt,t.jitter,t.audioInputLevel),k=!0,p=t.uploadRate?1e3*t.uploadRate:t.uploadRate}if("inbound"===u.direction&&"download"===t.direction)switch(t.mediaType){case"video":t.currentDelay&&(n+=" with current delay ["+t.currentDelay+"] ms"),t.targetDelay&&(n+=" and target delay ["+t.targetDelay+"] ms"),f.Ct.debug("[%s] [%s] [%s] [%s] with framerate [%s]"+n,e,u.direction,t.mediaType,t.ssrc,t.framerateMean),w=!0,l=t.framerateMean||0,b=!0,m=t.downloadRate?1e3*t.downloadRate:t.downloadRate,"Edge"===i.browser&&(w=!1);break;case"audio":t.jitterBuffer&&(n+=" with jitter buffer ["+t.jitterBuffer+"] ms"),f.Ct.debug("[%s] [%s] [%s] [%s] with jitter [%s]  with output level [%s]"+n,e,u.direction,t.mediaType,t.ssrc,t.jitter,t.audioOutputLevel),k=!0,p=t.downloadRate?1e3*t.downloadRate:t.downloadRate}}),t.isUndefined(p)&&t.isUndefined(m))return setTimeout(g,f.Ir);var S=n.hasActiveAudio(s),E=n.hasActiveVideo(s);if((b&&0===m||k&&0===p||w&&0===l)&&(b=b&&E,k=k&&S,w=w&&E),(k||b||w)&&f.Ct.debug("[%s] [%s] Current bit rate is [%s] bps for audio and [%s] bps for video with [%s] FPS",e,u.direction,Math.ceil(p||0),Math.ceil(m||0),l||"?"),!f.Pr||"closed"!==s.connectionState&&"failed"!==s.connectionState&&"failed"!==s.iceConnectionState)f.Cr&&w&&l<=f.kr&&!a.call(f,"video")?d++:f.Mr&&k&&p<=f.Er&&!a.call(f,"audio")?d++:f.Mr&&b&&m<=f.Sr&&!a.call(f,"video")?d++:d=0;else{var T=S&&E,I=o.call(f,s);if(!T&&n.hasMediaSectionsInLocalSdp(s))return void f.Ct.info("[%s] [%s] Finished monitoring of peer connection with [%s] inactive tracks",e,u.direction,I.length);d++}var R=!(0!==m&&b||0!==p&&k||function(){var e=this;return t.reduce(o.call(this,this.yr),function(i,n){if(!i)return i;var r=!!t.find(e.br,function(t){return t.id===n.id});return!n.enabled||r},!0)}.call(f));R&&!v?v=setTimeout(t.bind(g,this,!0),5e3):R||(clearTimeout(v),v=null);var C=y&&R&&v,M=function(){f.Ct.info("[%s] [%s] Failure has been acknowledged",e,u.direction),d=Number.MIN_VALUE,setTimeout(g,f.Ir)};if(d>=f.Tr||C){var P="["+e+"] ["+u.direction+"] Failure detected with frame rate ["+l+"] FPS, audio bit rate ["+p+"] bps, video bit rate ["+m+"] bps, connection state ["+s.connectionState+"], and ice connection state ["+s.iceConnectionState+"]",x="["+e+"] ["+u.direction+"] Failure detected with 0 bps audio and video for [5] seconds",D=C?x:P;h(null,{type:"condition",message:D,report:r,frameRate:l,videoBitRate:m,audioBitRate:p,acknowledgeFailure:M})?M():f.Ct.error(D+": [%s]",r)}else setTimeout(g,d>0?f.Rr:f.Ir)},function(t){h(t,{type:"error",message:"Unable to get Connection statistics. Connection may have failed."})})},f.Ir)}.call(this,this.Ut,this.yr,s,u,c)},s.prototype.setMonitorTrackState=function(i,n){e.Rt(i,"track"),e.Sn(n,"state");var r=o.call(this,this.yr);if(!t.find(r,function(t){return t.id===i.id}))return this.Ct.warn("[%s] Unable to find track [%s] [%s] in peer connection",this.Ut,i.kind,i.id);if(!n)return this.Ct.info("[%s] Pausing monitoring of track [%s] [%s]",this.Ut,i.kind,i.id),this.br.push(i);var s=this.br.length;this.br=t.filter(this.br,function(t){return t.id!==i.id}),s!==this.br.length&&this.Ct.info("[%s] Starting monitoring of track [%s] [%s] after it was paused",this.Ut,i.kind,i.id)},s.prototype.toString=function(){return"PeerConnectionMonitor["+this.Ut+"]"},s}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(3)],void 0===(r=function(t){"use strict";function e(){this.init()}return e.prototype.init=function(){if(!t.global.AudioContext&&!t.global.webkitAudioContext)throw new Error("Browser does not support AudioContext");this.xr=new(t.global.AudioContext||t.global.webkitAudioContext)},e.prototype.getNativeAudioContext=function(){return this.xr},e.prototype.toString=function(){return"AudioContext"},e}.apply(e,n))||(t.exports=r)},function(t,e,i){var n;void 0===(n=function(){"use strict";return{package:"telemetry",messages:[{name:"LogData",fields:[{rule:"required",type:"LogLevel",name:"level",id:1},{rule:"required",type:"string",name:"timestamp",id:2},{rule:"required",type:"string",name:"category",id:3},{rule:"required",type:"string",name:"message",id:4},{rule:"optional",type:"string",name:"source",id:5},{rule:"optional",type:"string",name:"fullQualifiedName",id:11},{rule:"optional",type:"string",name:"sessionId",id:6},{rule:"optional",type:"string",name:"userId",id:7},{rule:"optional",type:"string",name:"environment",id:8},{rule:"optional",type:"string",name:"version",id:9},{rule:"optional",type:"float",name:"runtime",id:10}]},{name:"StoreLogRecords",fields:[{rule:"repeated",type:"LogData",name:"records",id:1}]},{name:"StoreLogRecordsResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"required",type:"uint64",name:"storedRecords",id:2}]},{name:"MetricValue",fields:[{rule:"optional",type:"string",name:"string",id:1},{rule:"optional",type:"float",name:"float",id:2},{rule:"optional",type:"uint64",name:"uint64",id:3},{rule:"optional",type:"int64",name:"int64",id:4},{rule:"optional",type:"bool",name:"boolean",id:5},{rule:"optional",type:"string",name:"timestamp",id:6}]},{name:"MetricData",fields:[{rule:"required",type:"string",name:"timestamp",id:1},{rule:"optional",type:"string",name:"sessionId",id:2},{rule:"optional",type:"string",name:"streamId",id:3},{rule:"optional",type:"string",name:"source",id:4},{rule:"optional",type:"string",name:"resource",id:5},{rule:"optional",type:"string",name:"kind",id:6},{rule:"required",type:"Metric",name:"metric",id:7},{rule:"optional",type:"MetricValue",name:"value",id:8},{rule:"optional",type:"MetricValue",name:"previousValue",id:9},{rule:"optional",type:"uint64",name:"elapsed",id:10},{rule:"optional",type:"string",name:"fullQualifiedName",id:11},{rule:"optional",type:"string",name:"environment",id:12},{rule:"optional",type:"string",name:"version",id:13},{rule:"optional",type:"string",name:"tool",id:14},{rule:"optional",type:"string",name:"toolVersion",id:15},{rule:"required",type:"float",name:"runtime",id:16}]},{name:"SubmitMetricRecords",fields:[{rule:"repeated",type:"MetricData",name:"records",id:1}]},{name:"SubmitMetricRecordsResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"required",type:"uint64",name:"storedRecords",id:2}]}],enums:[{name:"LogLevel",values:[{name:"Trace",id:0},{name:"Debug",id:1},{name:"Info",id:2},{name:"Warn",id:3},{name:"Error",id:4},{name:"Fatal",id:5}]},{name:"Metric",values:[{name:"RoundTripTime",id:0},{name:"DownlinkThroughputCapacity",id:26},{name:"Initialized",id:1},{name:"Provisioned",id:2},{name:"SetupCompleted",id:3},{name:"Offset",id:4},{name:"TimeToFirstFrame",id:5},{name:"Playing",id:6},{name:"Stalled",id:7},{name:"Buffering",id:8},{name:"Seeking",id:22},{name:"Stopped",id:9},{name:"BitRateAdaptation",id:10},{name:"ResolutionChanged",id:11},{name:"DisplayResolutionChanged",id:23},{name:"VideoBitRate",id:28},{name:"AudioBitRate",id:29},{name:"FrameRateChanged",id:12},{name:"FramesDropped",id:13},{name:"PacketsLost",id:14},{name:"PictureLost",id:15},{name:"PlayoutDelayChanged",id:16},{name:"CodecChanged",id:17},{name:"PlayerEvent",id:21},{name:"MetricDropped",id:18},{name:"NetworkOffline",id:19},{name:"NetworkOnline",id:20},{name:"NetworkType",id:27},{name:"ApplicationForeground",id:24},{name:"ApplicationBackground",id:25}]}]}}.apply(e,[]))||(t.exports=n)},function(t,e,i){var n,r;n=[i(0),i(90),i(88),i(87)],void 0===(r=function(t,e,i,n){"use strict";function r(e,r){var s=this;this.Dr={},this.Dr[n.package]=new i(n),t.forEach(e,function(t){s.Dr[t.package]=new i(t)}),this.Or=r||3}return r.prototype.getApiVersion=function(){return this.Or},r.prototype.encode=function(i,n){if("string"!=typeof i)throw new Error("'type' must be a string");if("object"!=typeof n)throw new Error("'data' must be an object");var r=i.split("."),s=t.get(r,[0]),o=t.get(r,[1]),a=t.get(this.Dr,[s]),u=new e;return a.write(o,n,u),u.finish()},r.prototype.decode=function(i,n){if("string"!=typeof i)throw new Error("'type' must be a string");var r=i.split("."),s=t.get(r,[0]),o=t.get(r,[1]),a=t.get(this.Dr,[s]),u=new e(n);return a.read(o,u)},r}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(5),i(2),i(40),i(86)],void 0===(r=function(t,e,i,n,r,s){"use strict";var o="continuation",a=2e3,u=3e5,c=18e3;function h(n,s,o,a,u){e.Rt(n,"logger"),e.It(s,"sendCallback"),e.It(o,"receiveCallback"),this.Ct=n,this.Ar=new r(a,u),this.qr=0,this.vr=new i.NamedEvents,this.Ur={},this.Fr={},this.Nr={},this.jr={},this.Lr={},this.Br={},this._r=o,this.Wr=s,o(t.bind(f,this))}function f(e){if(this.bn)return this.Ct.warn("Proto already disposed of. Unable process message");var i,n,r;try{i=this.Ar.decode("mq.Message",s.toByteArray(e.data)),r=this.Ur[i.requestId],this.Ct.info(">> [%s] [%s]",i.messageType,i.type),n=this.Ar.decode(i.type,i.payload)}catch(t){if(this.Ct.error(t),r)return r(t);throw t}switch(function(e,i,n){var r=t.now(),s=this.Lr[e.requestId];if(t.ee(s)){var o=r-s;e.wallTime=[o].concat(e.wallTime)}this.vr.fireAsync("received",[{key:e.requestId,messageType:e.messageType,type:e.type,wallTime:e.wallTime,received:r,bytes:n,payload:i}]),delete this.Lr[e.requestId]}.call(this,i,n,e.data.length),i.messageType){case"Response":if(n.status!==o&&delete this.Ur[i.requestId],clearTimeout(this.jr[i.requestId]),delete this.jr[i.requestId],!r)return;return"mq.Error"===i.type?r(n,null):r(null,n);case"Request":var a=t.bind(this.sendResponse,this,i.requestId,i.type+"Response"),u=this.Nr[i.type];this.Fr[i.requestId]=t.now(),u?u(n,a):this.Ct.info("Received request without a subscribed listener");break;case"Event":return function(t,e){this.vr.fire(t,e,this)}.call(this,i.type,[n]);default:return this.Ct.warn(">> Unsupported message type [%s]",i.messageType)}}function d(e,i,n,r,s,c,h){return h&&h.status===o?(!this.Br[e]&&this.Ur[e]&&(this.Br[e]=function(e,i){return setTimeout(t.bind(p,this,e,u,i),u)}.call(this,e,s)),function(e,i,n,r,s,o){if(!r||!r.continuationId&&!r.routeKey)return this.Ct.warn("Received request for continuation without a continuationId or routeKey"),o();var u=t.assign({},n,{continuationId:r.continuationId,routeKey:r.routeKey}),c={requestId:e,type:i,payload:this.Ar.encode(i,u),messageType:"Request"},h=this;return setTimeout(function(){if(h.Ur[e])return l.call(h,e,c,u,s,o)},a)}.call(this,e,i,n,h,r,s)):(clearTimeout(this.Br[e]),delete this.Br[e],s(c,h))}function l(e,i,n,r,s){this.jr[e]&&clearTimeout(this.jr[e]);var o=r||c;return this.jr[e]=setTimeout(t.bind(p,this,e,o,s),o),m.call(this,i,n)}function m(e,i){var n=s.toString(this.Ar.encode("mq.Message",e));return function(e,i,n){var r=t.now();this.Lr[e.requestId]=r,this.vr.fireAsync("sent",[{key:e.requestId,messageType:e.messageType,type:e.type,received:r,bytes:n,payload:i}])}.call(this,e,i,n.length),this.Wr(n)}function p(t,e,i){if(this.Ur[t])return function(t,e){this.vr.fireAsync("timeout",[{key:t,timeout:e}]),delete this.Lr[t]}.call(this,t,e),this.Ct.warn("Request [%s] has not completed in [%s] ms. Dropping request.",t,e),delete this.Ur[t],i(null,{status:"timeout"})}return h.prototype.onEvent=function(t,i){return this.bn?this.Ct.warn("Proto already disposed of. Unable to listen for event"):(e.qt(t,"eventName"),e.It(i,"handler"),this.vr.listen(t,i))},h.prototype.onRequest=function(t,i){if(this.bn)return this.Ct.warn("Proto already disposed of. Unable to listen for request");e.qt(t,"requestName"),e.It(i,"handler"),this.Nr[t]&&this.Ct.warn("May not set multiple handlers for the same request. Overriding existing handlers for request [%s]",t),this.Nr[t]=i;var r=this;return new n.Disposable(function(){r.Nr[t]=null})},h.prototype.sendRequest=function(i,n,r,s){if(this.bn)return this.Ct.warn("Proto already disposed of. Unable to send request"),r(null,{status:"proto-disposed"});s=s||{},e.qt(i,"type"),e.Rt(n,"message"),e.Rt(s,"settings"),r&&e.It(r,"callback"),s.timeout&&e.ee(s.timeout,"settings.timeout");var o="C"+(this.qr++).toString(),a={requestId:o,type:i,payload:this.Ar.encode(i,n),messageType:"Request"};return this.Ur[o]=t.bind(d,this,o,i,n,s.timeout,r),l.call(this,o,a,n,s.timeout,r)},h.prototype.sendResponse=function(i,n,r,s){if(this.bn)return this.Ct.warn("Proto already disposed of. Unable to send response"),s(null,{status:"proto-disposed"});e.qt(i,"requestId"),e.qt(n,"type"),e.Rt(r,"message");var o=this.Fr[i];o||(this.Ct.error("Already responded to request [%s]",i),s(new Error("no-response-handler")));var a={requestId:i,type:n,payload:this.Ar.encode(n,r),messageType:"Response",wallTime:[t.now()-o]};return m.call(this,a,r),delete this.Fr[i],s(null,{status:"ok"})},h.prototype.disposeOfRequests=function(){t.forOwn(this.jr,function(t){clearTimeout(t)}),t.forOwn(this.Br,function(t){clearTimeout(t)}),this.Ur={},this.Fr={},this.Nr={},this.jr={},this.Lr={},this.Br={}},h.prototype.dispose=function(){this.bn=!0,this._r=null,this.Wr=null,this.disposeOfRequests(),this.vr.dispose()},h.prototype.getApiVersion=function(){return this.Ar.getApiVersion()},h.prototype.toString=function(){return"Proto["+this.zr.toString()+"]"},h}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(91)],void 0===(r=function(t){"use strict";return t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(95)],void 0===(r=function(t){return t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(2)],void 0===(r=function(t,e,i){"use strict";function n(t,e){this.latestValue=null,this.subscribeCallbacks={},this.subscriptionTimeout=100,this.subscriptionCount=0,this.resetOnChange=!1,this.lastChangeTime=0,this.isPendingChanges=!1,this.beforeChange=e,s.call(this,t)}function r(e){return void 0===e||null===e?e:t.isArray(e)?e.slice():e}function s(t){var e=t;this.beforeChange&&(e=this.beforeChange(t)),this.latestValue=r(e)}function o(e,i){if(this.lastChangeTime=t.now(),!this.isPendingChanges&&0!==this.subscriptionCount){if(this.isPendingChanges=!0,i)return a.call(this);(function e(i){var n=this;setTimeout(function(){var i=t.now()-n.lastChangeTime;n.resetOnChange&&i<n.subscriptionTimeout?e.call(n,n.subscriptionTimeout-i):a.call(n)},i)}).call(this,e)}}function a(){try{(function(){var e=this;t.forOwn(e.subscribeCallbacks,function(i){t.It(i)&&i(e.latestValue)})}).call(this)}finally{this.isPendingChanges=!1}}return n.prototype.getValue=function(){return r(this.latestValue)},n.prototype.setValue=function(t){t!==this.latestValue&&(s.call(this,t),o.call(this,this.subscriptionTimeout))},n.prototype.subscribe=function(n,r){e.It(n,"callback"),r&&e.Rt(r,"options");var s,a=this,u=t.uniqueId();return a.subscribeCallbacks[u]=n,a.subscriptionCount+=1,r&&("notify"===r.initial&&o.call(a,a.subscriptionTimeout,!0),r.listenForChanges&&(s=setInterval(function(){var t=r.listenForChanges.callback();t!==a.latestValue&&a.setValue(t)},r.listenForChanges.timeout))),new i.Disposable(function(){delete a.subscribeCallbacks[u],s&&(clearInterval(s),s=null),a.subscriptionCount-=1})},n.prototype.extend=function(i){switch(e.Rt(i,"options"),i.method){case"notifyWhenChangesStop":this.subscriptionTimeout=i.timeout,this.resetOnChange=!0;break;case"notifyAtFixedRate":this.subscriptionTimeout=i.timeout}return t.ee(i.rateLimit)&&(this.subscriptionTimeout=i.rateLimit),this},n}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(2)],void 0===(r=function(t,e,i){"use strict";function n(){this.Vr=[]}function r(i,n,r){var s=this;t.isNullOrUndefined(i)&&(i=[]),e.isArray(i,"args");var o=function(){t.forEach(s.Vr,function(t){t.apply(n,i)})};r?setTimeout(function(){o(),r()},0):o()}return n.prototype.fire=function(t,e){r.call(this,t,e)},n.prototype.fireAsync=function(t,e,i){r.call(this,t,e,i||function(){})},n.prototype.listen=function(n){var r=this;return e.It(n,"listener"),r.Vr.push(n),new i.Disposable(function(){r.Vr=t.remove(r.Vr,function(t){return t===n})})},n.prototype.size=function(){return this.Vr.length},n.prototype.dispose=function(){this.Vr=[]},n.prototype.toString=function(){return"Event|"+this.size()},n}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(4),i(2),i(20),i(6),i(19),i(38),i(78),i(17),i(73),i(72),i(37),i(9),i(71),i(69),i(68),i(16),i(65),i(34),i(61),i(33),i(7),i(3),i(36)],void 0===(r=function(t,e,i,n,r,s,o,a,u,c,h,f,d,l,m,p,v,g,y,w,b,k,S,E,T){"use strict";var I="2018-09-17T15:08:57Z";function R(s){s=s||{},e.Rt(s,"options"),s.streamingSourceMapping&&(e.Rt(s.streamingSourceMapping,"options.streamingSourceMapping"),e.qt(s.streamingSourceMapping.replacement,"options.streamingSourceMapping.replacement"),s.streamingSourceMapping.patternToReplace instanceof RegExp||e.qt(s.streamingSourceMapping.patternToReplace,"options.streamingSourceMapping.patternToReplace")),t.isNullOrUndefined(s.disableMultiplePCastInstanceWarning)||e.Sn(s.disableMultiplePCastInstanceWarning,"options.disableMultiplePCastInstanceWarning"),t.isNullOrUndefined(s.disableGlobalErrorListener)||e.Sn(s.disableGlobalErrorListener,"options.disableGlobalErrorListener"),t.isNullOrUndefined(s.disableBeforeUnload)||e.Sn(s.disableBeforeUnload,"options.disableBeforeUnload"),t.isNullOrUndefined(s.disableConsoleLogging)||e.Sn(s.disableConsoleLogging,"options.disableConsoleLogging"),this.Hr=new i.Observable("offline"),this.in=s.uri||c.DefaultPCastUri,this.Gr=s.deviceId||"",this.kt=I,this.Ct=s.logger||r.createPCastLogger(this.in,s.disableConsoleLogging),this.Jr=s.metricsTransmitter||m.createMetricsTransmitter(this.in),this.Kr=new h(s,this.Ct),this.lr=s.shaka,this.Xr=s.videojs||E.global.videojs,this.Qr=s.rtmp||{},this.$r=s.streamingSourceMapping,this.v=new n.DisposableList,this.Yr=s.disableMultiplePCastInstanceWarning,this.Zr=!0,this.ts=[],this.es=[],this.kn=new k(s.features);var o=this,a=t.filter(this.kn.getFeatures(),k.isFeatureSupported),u=function(t){o.Ct.error("Window Error Event Triggered with pcast in [%s] state",o.Hr.getValue(),t?t.error:"Unknown Error")};this.Ct.info("Device supports features [%s], user selected [%s]",a,this.kn.getFeatures()),t.addEventListener(E.global,"unload",function(){return o.Ct.info("Window Unload Event Triggered"),o.stop("window-unload")}),s.disableGlobalErrorListener||(t.addEventListener(E.global,"error",u),E.global.__phenixGlobalErrorListenerDisposable&&E.global.__phenixGlobalErrorListenerDisposable.dispose(),E.global.__phenixGlobalErrorListenerDisposable=new n.Disposable(function(){t.removeEventListener(E.global,"unload",u)})),s.disableBeforeUnload||t.addEventListener(E.global,"beforeunload",function(){return o.Ct.info("Window Before Unload Event Triggered"),o.stop("window-beforeunload")}),E.webrtcSupported||"ReactNative"!==E.browser||E.shim(),E.webrtcSupported&&(function(){var t=this,e=new E.RTCPeerConnection;"Safari"===E.browser&&E.browserVersion>10&&(e.addTransceiver("audio"),e.addTransceiver("video"));try{var i=function(i){var n=T.getH264ProfileIds(i.sdp);if(t.es=T.getSupportedCodecs(i.sdp),t.Ct.info("Supported WebRTC video codecs [%s]",t.es),0===n.length)return t.Ct.info("Unable to find local h264 profile level id",i.sdp);t.Ct.info("Found local h264 profile level ids [%s]",n,i.sdp),t.ts=n,e.close&&e.close()},n=function(i){t.Ct.error("Unable to create offer to get local h264 profile level id",i),e.close&&e.close()},r={offerToReceiveAudio:!0,offerToReceiveVideo:!0};if("function"==typeof E.global.Promise)return e.createOffer(r).then(i).catch(n);e.createOffer(i,n,r)}catch(i){t.Ct.error("Failed to set environment defaults. Creating the Offer failed",i),e.close&&e.close()}}.call(this),L.call(this))}function C(){if(D.call(this)&&"offline"===this.Hr.getValue())return this.Ct.warn("[PCast] connected after being offline. Going offline."),K.call(this,"critical-network-issue"),this.stop("critical-network-issue");var t=this;this.ns=!0,t.rs||t.Vn.authenticate(t.Un,function(e,i){t.ss&&(e?(t.Ct.error("Failed to authenticate [%s]",e),K.call(t,"unauthorized"),t.ss.call(t,t,"unauthorized","")):"ok"!==i.status?(t.Ct.warn("Failed to authenticate, status [%s]",i.status),K.call(t,"unauthorized"),t.ss.call(t,t,"unauthorized","")):(K.call(t,"online"),t.ss.call(t,t,i.status,i.sessionId)))})}function M(){K.call(this,"reconnecting")}function P(){K.call(this,"reconnected"),this.Ct.info("Attempting to re-authenticate after reconnect event"),function(){var t=this;t.rs||t.Vn.authenticate(t.Un,function(e,i){var n=!0===t.ns;if(e)return t.Ct.error("Unable to authenticate after reconnect to WebSocket [%s]",e),K.call(t,"reconnect-failed");if("ok"!==i.status){t.Ct.warn("Unable to authenticate after reconnect to WebSocket, status [%s]",i.status);var r="capacity"===i.status?i.status:"reconnect-failed";return K.call(t,r)}return t.ns=!0,t.Ct.info("Successfully authenticated after reconnect to WebSocket"),K.call(t,"online",null,n)})}.call(this)}function x(){if(D.call(this)&&"reconnecting"===this.Hr.getValue())return this.Ct.warn("[PCast] disconnected after attempting to reconnect. Going offline."),K.call(this,"critical-network-issue"),this.stop("critical-network-issue");this.ns=!1,K.call(this,"offline")}function D(){return t.reduce(this.os,function(t,e){return t?"closed"===e.iceConnectionState:t},!0)}function O(t){switch(t){case"":case"none":case"ended":return"ended";case"server-error":case"session-error":case"not-ready":case"error":case"died":return"failed";case"censored":return"censored";case"maintenance":return"maintenance";case"capacity":return"capacity";case"app-background":return"app-background";case"egress-failed":return"egress-failed";case"egress-setup-failed":return"egress-setup-failed";default:return"custom"}}function A(t){var e=t.streamId,i=t.reason;return U.call(this,e,i)}function q(e){var i=e.streamId,n=e.status,r=e.reason,s=this.as[i];s&&s.dataQualityChangedCallback(n,r);var o=this.xn[i];o&&t.It(o.dataQualityChangedCallback)&&o.dataQualityChangedCallback(o,n,r)}function U(e,i){this.Ct.info("[%s] Stream ended with reason [%s]",e,i);var n=this.as[e];n&&n.streamEndedCallback(O(i),i,!0),delete this.as[e];var r=this.xn[e];r&&t.It(r.publisherEndedCallback)&&r.publisherEndedCallback(r,O(i),i),delete this.xn[e];var s=this.os[e];s&&X.call(this,e,s,"ended"),delete this.os[e]}function F(e,i,n,r,s,o){var a,u=this,c=!1,h=function(h){if(!i.failed&&!c){var f=T.getNumberOfActiveSections(n),d=h.stream||t.get(h,["streams",0]),l="real-time";if(!d)return i.failed=!0,u.Ct.warn("[%s] No remote stream",e),s.call(u,void 0,"failed");if(a&&clearTimeout(a),f===d.getTracks().length){c=!0,u.Ct.info("[%s] Got remote stream",e),r.setProperty("kind",l);var m=t.assign({networkLag:u.us},o),p=new b(e,d,n,r,m,u.Ct),v=new y(l,p,u.Ct);v.on(S.streamEvents.playerError.name,function(t,e){u.Ct.warn("Phenix Real-Time Stream Error [%s] [%s]",t,e),v.streamErrorCallback(l,e)}),v.on(S.streamEvents.stopped.name,function(t){!i.stopped&&u.Vn&&(u.Ct.info("[%s] media stream has stopped with reason",e,t),X.call(u,e,n,"stop"),u.Vn.destroyStream(e,t||"",function(t,i){t?u.Ct.error("[%s] failed to destroy stream [%s]",e,t):"ok"===i.status?u.Ct.info("[%s] destroyed stream",e):u.Ct.warn("[%s] failed to destroy stream, status [%s]",e,i.status)}),i.stopped=!0)}),u.as[e]=v,s.call(u,p)}else a=setTimeout(function(){return i.failed=!0,u.Ct.warn("[%s] Did not receive all tracks within [%s] ms",e,3e3),s.call(u,void 0,"failed")},3e3)}};t.addEventListener(n,"addstream",h),t.addEventListener(n,"track",h)}function N(e,i,n){var r=this;t.addEventListener(i,"icecandidate",function(t){var i=t.candidate;i?r.Ct.info("[%s] ICE candidate: [%s] [%s] [%s]",e,i.sdpMid,i.sdpMLineIndex,i.candidate):r.Ct.info("[%s] ICE candidate discovery complete",e),n&&n(i)})}function j(e,i){var n=this;t.addEventListener(i,"negotiationneeded",function(t){n.Ct.info("[%s] Negotiation needed")}),t.addEventListener(i,"iceconnectionstatechange",function(t){n.Ct.info("[%s] ICE connection state changed [%s]",e,i.iceConnectionState)}),t.addEventListener(i,"icegatheringstatechange ",function(t){n.Ct.info("[%s] ICE gathering state changed [%s]",e,i.iceGatheringState)}),t.addEventListener(i,"signalingstatechange",function(t){n.Ct.info("[%s] Signaling state changed [%s]",e,i.signalingState)}),t.addEventListener(i,"connectionstatechange",function(t){n.Ct.info("[%s] Connection state changed [%s]",e,i.connectionState)})}function L(e){var i=this;switch(E.browser){case"Edge":return E.getDestinations(function(n){0===t.filter(n,function(t){return"audio"===t.kind}).length?(i.Zr&&i.Ct.info("Detected no audio devices attached to machine"),i.Zr=!1):i.Zr=!0,e&&e()});default:e&&e()}}function B(e,i,n,r,s,o){if("IE"===E.browser)throw new Error("Subscribing in real-time not supported on IE without the PhenixP2P Plugin");var a=this,u={failed:!1,stopped:!1},c=n.match(/a=crypto:/i),h=n.match(/m=application /i),f=new E.RTCPeerConnection(e,{optional:[{DtlsSrtpKeyAgreement:!c},{RtpDataChannels:h}]});if(it(f),a.os[i]=f,"Firefox"===E.browser||"Edge"===E.browser){if(n.match(/(\nm=video)/g)&&n.match(/(\nm=audio)/g)){var d=/(a=candidate)((.|\n)*)(?=m=)/g;n=n.replace(d,n.match(d)+"a=end-of-candidates\n")}n=(n+="a=end-of-candidates").replace(/(\na=ice-options:trickle)/g,"")}"ReactNative"===E.browser&&(n=et(n));var l=function(t){u.failed||(u.failed=!0,u.stopped=!0,delete a.os[i],delete a.as[i],delete a.cs[i],X.call(a,i,f,"failure"),s.call(a,void 0,t||"failed"))};F.call(a,i,u,f,r,s,o),N.call(a,i,f,function(t){a.cs[i]&&a.cs[i](t)}),j.call(a,i,f);var m=new E.RTCSessionDescription({type:"offer",sdp:n}),p={mandatory:{}};if("Chrome"===E.browser||"ReactNative"===E.browser?(p.mandatory.OfferToReceiveVideo=!1!==o.receiveVideo,p.mandatory.OfferToReceiveAudio=!1!==o.receiveAudio):(p.mandatory.offerToReceiveVideo=!1!==o.receiveVideo,p.mandatory.offerToReceiveAudio=!1!==o.receiveAudio),"function"==typeof E.global.Promise)return f.setRemoteDescription(m).then(t.bind(W,a)).then(function(){return f.createAnswer(p)}).then(t.bind(z,a)).then(function(t){return new E.global.Promise(function(e,n){V.call(a,i,t,e,n)})}).then(function(t){return f.setLocalDescription(t)}).then(t.bind(_,a)).catch(l);f.setRemoteDescription(m,function(){W.call(a),f.createAnswer(function(e){z.call(a,e),V.call(a,i,e,function(e){f.setLocalDescription(e,t.bind(_,a),l)},l)},l,p)},l)}function _(){this.Ct.debug("Set local description (answer)")}function W(){this.Ct.debug("Set remote description (offer)")}function z(t){return this.Ct.info("Created answer [%s]",t.sdp),t}function V(e,i,n,r){var s=this;s.Vn.setAnswerDescription(e,i.sdp,function(i,o){if(i)return s.Ct.error("Failed to set answer description [%s]",i),r();if("ok"!==o.status)return s.Ct.warn("Failed to set answer description, status [%s]",o.status),r(o.status);o&&t.includes(o.options,"ice-candidates")&&(s.cs=t.bind(H,s,e));var a=o.sessionDescription.sdp;if(tt()){var u=t.get(function(){var e=t.get(E,["global","navigator","userAgent"],"");if(/iP(hone|od|ad)/.test(e)){var i=e.match(/.*OS (\d+)_(\d+)_?(\d+)? like Mac OS X/);return{major:parseInt(t.get(i,[1],0),10),minor:parseInt(t.get(i,[2],0),10),patch:parseInt(t.get(i,[3],0),10)}}}(),["major"]);s.Ct.info("iOS Version is [%s]",u),u<11&&(a=a.replace("BUNDLE audio video","BUNDLE video audio"))}var c=new E.RTCSessionDescription({type:"answer",sdp:a});n(c)})}function H(e,i){var n=this,r=[];i?[].push(i):r.push("completed"),n.Vn.addIceCandidates(e,i,r,function(i,r){return i?n.Ct.error("Failed to add ICE candidate [%s]",i):"ok"!==r.status?n.Ct.warn("Failed to add ICE candidate, status [%s]",r.status):void(t.includes(r.options,"cancel")&&delete n.cs[e])})}function G(i,n,r,s,a){var u=/a=x-rtmp:(rtmp:\/\/[^\n]*)/m,c=n.match(u),h=n.match(/a=x-playlist:([^\n]*[.]mpd\??[^\s]*)/m),f=n.match(/a=x-playlist:([^\n]*[.]m3u8\??[^\s]*)/m),d=t.get(h,[1],""),l=t.get(f,[1],""),m=h&&2===h.length,p=f&&2===f.length,v=!!c,g=[];(m||p)&&g.push("streaming"),v&&g.push("rtmp");var y=this.kn.getPreferredFeatureFromPublisherCapabilities(g,!0);switch(this.$r&&(d=d.replace(this.$r.patternToReplace,this.$r.replacement),l=l.replace(this.$r.patternToReplace,this.$r.replacement)),y){case S.types.rtmp.name:var w=[],b=o.parseEnvFromPcastBaseUri(this.in);for(this.Ct.info("Selecting flash playback for rtmp.");c;){var E=t.get(c,[1],""),T=t.get(E.match(/(rtmp:\/\/[^\n\s]*)/),[0]),I=t.get(E.match(/bitrate=([^\n\s;]*)/),[1]),R=t.get(E.match(/resolution=([^\n\s;]*)/),[1]);n=n.replace(E,""),T&&w.push({uri:T,bitrate:I,resolution:R}),c=n.match(u)}return J.call(this,i,w,S.types.rtmp.name,r,s,t.assign({env:b},this.Qr,a));case S.types.dash.name:return this.Ct.info("Selecting dash playback for live stream."),a.isDrmProtectedContent=/[?&]drmToken=([^&]*)/.test(d)||/x-widevine-service-certificate/.test(n),a.isDrmProtectedContent&&(a.widevineServiceCertificateUrl=n.match(/a=x-widevine-service-certificate:([^\n][^\s]*)/m)[1],a.playreadyLicenseUrl=n.match(/a=x-playready-license-url:([^\n][^\s]*)/m)[1]),this.lr&&!this.lr.Player.isBrowserSupported()?(this.Ct.warn("[%s] Shaka does not support this browser",i),s.call(this,void 0,"browser-unsupported")):J.call(this,i,d,S.types.dash.name,r,s,a);case S.types.hls.name:return this.Ct.info("Selecting hls playback for live stream."),a.isDrmProtectedContent=/[?&]drmToken=([^&]*)/.test(l),a.hlsTargetDuration&&(e.ee(a.hlsTargetDuration,"options.hlsTargetDuration"),l=l+(l.indexOf("?")>-1?"&":"?")+"targetDuration="+a.hlsTargetDuration),J.call(this,i,l,S.types.hls.name,r,s,t.assign({preferNative:k.shouldUseNativeHls},a))}return this.Ct.warn("[%s] Device does not support [%s] playback. Creating live viewer stream failed.",i,k.mapPCastCapabilitiesToFeatures(g)),s.call(this,void 0,"failed")}function J(t,e,i,n,r,s){var o=this,a=new w(i,t,e,n,s,this.lr,this.Ct),u=new y(i,a,this.Ct);n.setProperty("kind",i),u.on(S.streamEvents.playerError.name,function(t,e){o.Ct.warn("Phenix Live Stream Player Error [%s] [%s]",t,e),u.streamErrorCallback(t,e)}),u.on(S.streamEvents.stopped.name,function(e){if(!o.Vn)return o.Ct.warn("Unable to destroy stream [%s]",t);o.Vn.destroyStream(t,e||"",function(e,i){e?o.Ct.error("[%s] failed to destroy stream, [%s]",t,e):"ok"===i.status||o.Ct.warn("[%s] failed to destroy stream, status [%s]",t,i.status)})}),this.as[t]=u,r.call(this,u.getPhenixMediaStream())}function K(t,e,i){var n,r=this.getStatus();if(r!==t&&("critical-network-issue"!==(n=r)&&"offline"!==n||"offline"!==t)){if(this.Hr.setValue(t),i)return;switch(t){case"connecting":case"reconnecting":case"reconnected":break;case"critical-network-issue":case"unauthorized":case"reconnect-failed":case"offline":return this.hs.call(this);case"online":return this.fs.call(this)}}}function X(t,e,i){"closed"===e.signalingState||e.__closing||(this.Ct.debug("[%s] close peer connection [%s]",t,i),e.close(),e.__closing=!0)}function Q(e){if(!e)return e;var i=t.isArray(e)?[]:{},n=t.bind($,null,i);return t.isArray(e)?t.forEach(e,n):t.forOwn(e,n),i}function $(e,i,n){if(null!==i){if(t.Rt(i)||t.isArray(i))return e[n]=Q(i);if(!t.Xt(i)||!t.Xt(n))return e[n]=i;var r=t.startsWith(i.toLowerCase(),n.toLowerCase())?i.substring(n.length,i.length).toLowerCase():i;e[n]=r}}function Y(e){return"Firefox"===E.browser&&function(e){if(!e)return e;t.forEach(e.iceServers,function(e){e.urls=t.filter(e.urls,function(e){return!t.startsWith(e,"turns")})})}(e),e}R.prototype.getBaseUri=function(){return this.in},R.prototype.getStatus=function(){return this.Hr.getValue()},R.prototype.getObservableStatus=function(){return this.Hr},R.prototype.isStarted=function(){return this.hr},R.prototype.reAuthenticate=function(t){if(e.qt(t,"authToken"),"online"===this.Hr.getValue())return this.Ct.warn("Already authenticated. Denying request to re-authenticate");this.Ct.info("Attempting to re-authenticate with new auth token [%s]",t),this.Un=t,P.call(this)},R.prototype.start=function(i,n,r,s){if(e.qt(i,"authToken"),e.It(n,"authenticationCallback"),e.It(r,"onlineCallback"),e.It(s,"offlineCallback"),this.hr)throw new Error('"Already started"');t.ee(E.global.__phenixInstantiatedPCastCount)?E.global.__phenixInstantiatedPCastCount++:E.global.__phenixInstantiatedPCastCount=1,E.global.__phenixInstantiatedPCastCount>1&&!this.Yr&&this.Ct.warn("Avoid using multiple instances of PCast as this uses unnecessary resources and will reduce performance. This is your [%s] simultaneous instance. Remember to dispose all resources when done with them by calling .stop() or .dispose()",E.global.__phenixInstantiatedPCastCount),this.rs=!1,this.hr=!0,this.Un=i,this.ss=n,this.fs=r,this.hs=s,this.nn=new v(this.Ct,this.Jr),this.ds=new c(this.kt,this.in,this.Ct,this.nn),K.call(this,"connecting"),this.os={},this.as={},this.cs={},this.xn={},this.ls=[],this.v.add(this.ds),this.v.add(this.nn);var o=this;o.ds.resolveUri(function(e,i){if(e){switch(o.Ct.error("Failed to connect to [%s]",o.in,e),K.call(o,"offline"),e.code){case 0:o.ss.call(o,o,"network-unavailable","");break;case 503:o.ss.call(o,o,"capacity","");break;default:o.ss.call(o,o,"failed","")}return o.rs=!0,void(o.hr=!1)}o.Ct.info("Discovered end point [%s] with RTT [%s]",i.uri,i.roundTripTime),o.us=i.roundTripTime/2,o.ms=i.uri,function(e){this.Vn=new u(e,this.Gr,this.kt,this.Ct),this.Vn.onEvent("connected",t.bind(C,this)),this.Vn.onEvent("reconnecting",t.bind(M,this)),this.Vn.onEvent("reconnected",t.bind(P,this)),this.Vn.onEvent("disconnected",t.bind(x,this)),this.Vn.onEvent("pcast.StreamEnded",t.bind(A,this)),this.Vn.onEvent("pcast.StreamDataQuality",t.bind(q,this)),this.Ct.setObservableSessionId&&this.Ct.setObservableSessionId(this.Vn.getObservableSessionId()),this.ps&&(this.ps.dispose(),this.nn.setSessionId(null)),this.ps=this.Vn.getObservableSessionId().subscribe(t.bind(this.nn.setSessionId,this.nn))}.call(o,i.uri)})},R.prototype.stop=function(i){if(i=i||"",e.Xt(i,"reason"),this.hr){this.Ct.info("Stopping pcast instance with reason [%s]",i),this.rs=!0,this.hr=!1,delete this.ss;try{var n=this;t.forOwn(this.as,function(t,e){U.call(n,e,i)}),t.forOwn(this.xn,function(e,r){U.call(n,r,i),t.includes(e.getOptions(),"detached")||e.stop(i,!0)}),t.forOwn(this.os,function(t,e){U.call(n,e,i)}),t.forEach(this.ls,function(e){var i=e.getTracks();t.forEach(i,function(t){t.stop()})})}finally{this.Vn&&(this.Vn.disconnect(),this.Vn=null),this.Ct.setObservableSessionId&&this.Ct.setObservableSessionId(null),this.ps&&(this.ps.dispose(),this.nn.setSessionId(null)),E.global.__phenixInstantiatedPCastCount--,this.v.dispose()}}},R.prototype.getUserMedia=function(t,i,n){if("IE"===E.browser)throw new Error("Publishing not supported on IE");return e.Rt(t,"options"),e.It(i,"callback"),n&&e.It(n,"onScreenShare"),new f(this.Ct,this.Kr,n).getUserMedia(t,i)},R.prototype.publish=function(i,n,r,s,o){if("IE"===E.browser)throw new Error("Publishing not supported on IE");if(!this.hr)throw new Error("PCast not started. Unable to publish. Please start pcast first.");if(s=s||[],o=o||{},e.qt(i,"streamToken"),e.It(r,"callback"),e.isArray(s,"tags"),e.Rt(o,"options"),!t.Rt(n)&&!t.Xt(n))throw new Error('"streamToPublish" must be an object or URI');var a=this,u=t.assign({},o,{negotiate:!0});t.Xt(n)?(u.negotiate=!1,u.connectUri=n):u.connectUri=o.connectUri,s.length>0&&(u.tags=s);var c=new p(this.getProtocol().getSessionId(),this.Ct,this.Jr);c.setProperty("resource","upload"),this.Vn.setupStream("upload",i,u,2*a.us,function(i,s){if(i)return a.Ct.error("Failed to create uploader [%s]",i),r.call(a,a,"failed");if("ok"===s.status){var h=s.createStreamResponse.streamId;if(c.setStreamId(h),c.setStartOffset(s.createStreamResponse.offset),c.recordMetric("Provisioned"),c.recordMetric("RoundTripTime",{uint64:2*a.us},null,{resource:a.ms,kind:"https"}),!0===u.negotiate){var f=s.createStreamResponse.createOfferDescriptionResponse.sessionDescription.sdp,l=Y(Q(s.createStreamResponse.rtcConfiguration));if("Opera"===E.browser&&a.ts.length>0){var m=t.get(T.getH264ProfileIds(f),[0]),p=T.getH264ProfileIdWithSameProfileAndEqualToOrHigherLevel(a.ts,m);p?m!==p&&(a.Ct.info("[%s] Replacing publisher h264 profile level id [%s] with new value [%s] in offer sdp",h,m,p),f=T.replaceH264ProfileId(f,m,p)):a.Ct.warn("[%s] Unable to find new publisher h264 profile level id to replace [%s]. Rejected environment defaults of [%s]",h,m,a.ts)}return function(i,n,r,s,o,a,u,c){var h=this,f={failed:!1,stopped:!1},l=s.match(/a=crypto:/i),m=s.match(/m=application /i),p=new E.RTCPeerConnection(i,{optional:[{DtlsSrtpKeyAgreement:!l},{RtpDataChannels:m}]}),v=null,y=null;if(it(p),h.os[r]=p,p.addStream(n),"Firefox"===E.browser||"Edge"===E.browser){if(s.match(/(\nm=video)/g)&&s.match(/(\nm=audio)/g)){var w=/(a=candidate)((.|\n)*)(?=m=)/g;s=s.replace(w,s.match(w)+"a=end-of-candidates\n")}s=(s+="a=end-of-candidates").replace(/(\na=ice-options:trickle)/g,"")}var b=function(t){f.failed||(f.failed=!0,f.stopped=!0,delete h.os[r],delete h.xn[r],delete h.cs[r],X.call(h,r,p,"failure"),a.call(h,void 0,t||"failed"))},k=function(){var i=/(b=AS:([0-9]*)[\n\r]*)/gi,o=/(mid:video)([\n\r]*)/gi,u=0,l=i.exec(s);l&&l.length>=3&&(u=1e3*l[2]);var m={getStreamId:function(){return r},getStream:function(){return n},isActive:function(){return!f.stopped},hasEnded:function(){switch(p.iceConnectionState){case"new":case"checking":case"connected":case"completed":return!1;case"disconnected":case"failed":case"closed":default:return!0}},stop:function(t){!f.stopped&&h.Vn&&(h.Ct.info("[%s] stopping publisher with reason [%s]",r,t||"client-action"),X.call(h,r,p,"closed"),h.Vn.destroyStream(r,t||"",function(t,e){t?h.Ct.error("[%s] failed to destroy stream [%s]",r,t):"ok"===e.status?h.Ct.info("[%s] destroyed stream",r):h.Ct.warn("[%s] failed to destroy stream, status [%s]",r,e.status)}),f.stopped=!0)},setPublisherEndedCallback:function(t){e.It(t,"callback"),this.publisherEndedCallback=t},setDataQualityChangedCallback:function(t){e.It(t,"callback"),this.dataQualityChangedCallback=t},limitBandwidth:function(t){if("Edge"===E.browser)return h.Ct.warn("Limit bandwidth not support on [%s]",E.browser);e.ee(t,"bandwidthLimit");var n=u?Math.min(t,u):t,r=p.remoteDescription;h.Ct.info("Changing bandwidth limit to [%s]",n);var s=r.sdp.replace(i,"");s=s.replace(o,function(t,e,i,r,s){return[e,i,"b=AS:",Math.ceil(n/1e3),i].join("")});var a=new E.RTCSessionDescription({type:r.type,sdp:s});return p.setRemoteDescription(a),{dispose:function(){p.setRemoteDescription(r)}}},getMonitor:function(){return y},monitor:function(i,s){e.Rt(i,"options"),e.It(s,"callback");var o=new d(r,p,h.Ct);return i.direction="outbound",o.start(i,function(){return h.xn[r]===m&&!f.stopped},function(t,e){return t&&h.Ct.warn("[%s] Publisher monitor triggered unrecoverable error [%s]",t),h.Ct.warn("[%s] Publisher triggered monitor condition for [%s]",r,e.type),s(m,"client-side-failure",e)}),t.forEach(n.getTracks(),function(e){t.addEventListener(e,"readystatechange",function(){if("ended"===e.readyState)return h.Ct.warn("[%s] Publisher track has failed [%s]",r,e),s(m,"camera-track-failure",{type:e.kind+"-track-ended",message:"Publisher "+e.kind+" track has ended in an unrecoverable way. This may require reconfiguring your camera or microphone."})})}),y=o,o},setRemoteMediaStreamCallback:function(t){e.It(t,"callback"),this.remoteMediaStreamCallback=t,v&&t(m,v)},getOptions:function(){return c},getStats:function(t){e.It(t,"callback"),this.wr||(this.wr={});var i=this;return E.getStats(p,null,function(e){t(g.convertPeerConnectionStats(e,i.wr))})}};h.xn[r]=m,a.call(h,m)};F.call(h,r,f,p,o,function(t){var e=h.xn[r];v=t,e&&e.remoteMediaStreamCallback&&e.remoteMediaStreamCallback(e,t)},u),N.call(h,r,p,function(t){h.cs[r]&&h.cs[r](t)}),j.call(h,r,p);var S=new E.RTCSessionDescription({type:"offer",sdp:s}),T={mandatory:{}};if("Chrome"===E.browser||"ReactNative"===E.browser?(T.mandatory.OfferToReceiveVideo=!0===u.receiveVideo,T.mandatory.OfferToReceiveAudio=!0===u.receiveAudio):(T.mandatory.offerToReceiveVideo=!0===u.receiveVideo,T.mandatory.offerToReceiveAudio=!0===u.receiveAudio),"function"==typeof E.global.Promise)return p.setRemoteDescription(S).then(t.bind(W,h)).then(function(){return p.createAnswer(T)}).then(t.bind(z,h)).then(function(t){return new E.global.Promise(function(e,i){V.call(h,r,t,e,i)})}).then(function(t){return p.setLocalDescription(t)}).then(t.bind(_,h)).then(k).catch(b);h.Ct.info("[%s] Using legacy callback api",r),p.setRemoteDescription(S,function(){W.call(h),p.createAnswer(function(t){z.call(h,t),V.call(h,r,t,function(t){p.setLocalDescription(t,function(){_.call(h),k()},b)},b)},b,T)},b)}.call(a,l,n,h,f,c,function(t,e){c.recordMetric("SetupCompleted",{string:e?"failed":"ok"}),e?r.call(a,a,"failed",null):r.call(a,a,"ok",t)},o,s.createStreamResponse.options)}return function(t,i,n){var r=this,s={stopped:!1},o={getStreamId:function(){return t},getStream:function(){return r.Ct.debug("[%s] Unable to get stream on publisher of remote origin.",t),null},getStats:function(){return r.Ct.debug("[%s] Unable to get stream stats on publisher of remote origin.",t),null},isActive:function(){return!s.stopped},hasEnded:function(){return s.stopped},stop:function(e){s.stopped||(r.Ct.info("[%s] stopping publisher with reason [%s]",t,e),r.Vn.destroyStream(t,e||"",function(e,i){e?r.Ct.error("[%s] failed to destroy stream [%s]",t,e):"ok"===i.status?r.Ct.info("[%s] destroyed stream",t):r.Ct.warn("[%s] failed to destroy stream, status [%s]",t,i.status)}),s.stopped=!0)},setPublisherEndedCallback:function(t){e.It(t,"callback"),this.publisherEndedCallback=t},setDataQualityChangedCallback:function(t){e.It(t,"callback"),this.dataQualityChangedCallback=t},getOptions:function(){return n},monitor:function(t,i){e.Rt(t,"options"),e.It(i,"callback")},getMonitor:function(){return null}};r.xn[t]=o,i(o)}.call(a,h,function(t,e){c.recordMetric("SetupCompleted",{string:e?"failed":"ok"}),e?r.call(a,a,"failed",null):r.call(a,a,"ok",t)},s.createStreamResponse.options)}switch(a.Ct.warn("Failed to create uploader, status [%s]",s.status),s.status){case"timeout":case"capacity":case"unauthorized":return r.call(a,a,s.status);default:return r.call(a,a,"failed")}})},R.prototype.subscribe=function(i,n,r){if(!this.hr)throw new Error("PCast not started. Unable to subscribe. Please start pcast first.");r=r||{},e.qt(i,"streamToken"),e.It(n,"callback"),e.Rt(r,"options");var s=this;L.call(s,function(){var e=t.assign({},r,{negotiate:!1!==r.negotiate}),o=new p(s.getProtocol().getSessionId(),s.Ct,s.Jr),a=t.assign({},r);a.canPlaybackAudio=s.Zr,!s.Zr&&r.disableAudioIfNoOutputFound&&!1!==r.receiveAudio&&(e.receiveAudio=!1,a.receiveAudio=!1,a.forcedAudioDisabled=!0),o.setProperty("resource","download"),s.Vn.setupStream("download",i,e,2*s.us,function(e,i){if(e)return s.Ct.error("Failed to create downloader [%s]",e),n.call(s,s,"failed");if("ok"===i.status){var r=i.createStreamResponse.streamId,u=i.createStreamResponse.createOfferDescriptionResponse.sessionDescription.sdp,c=Y(Q(i.createStreamResponse.rtcConfiguration)),h=t.bind(B,s,c),f=u.match(/a=x-playlist:/)||u.match(/a=x-rtmp:/);if(f&&(h=G),o.setStreamId(r),o.setStartOffset(i.createStreamResponse.offset),o.recordMetric("Provisioned"),o.recordMetric("RoundTripTime",{uint64:2*s.us},null,{resource:s.getBaseUri(),kind:"https"}),a.originStartTime=t.now()-i.createStreamResponse.offset+s.us,!f&&("Chrome"===E.browser&&E.browserVersion>=62&&Z()||"Opera"===E.browser)&&s.ts.length>0){var d=t.get(T.getH264ProfileIds(u),[0]),l=T.getH264ProfileIdWithSameOrHigherProfileAndEqualToOrHigherLevel(s.ts,d);l?d!==l&&(s.Ct.info("[%s] Replacing subscriber h264 profile level id [%s] with new value [%s] in offer sdp",r,d,l),u=T.replaceH264ProfileId(u,d,l)):s.Ct.warn("[%s] Unable to find new subscriber h264 profile level id to replace [%s]. Rejected environment defaults of [%s]",r,d,s.ts)}return h.call(s,r,u,o,function(t,e){o.recordMetric("SetupCompleted",{string:e?"failed":"ok"}),e?n.call(s,s,"failed",null):n.call(s,s,"ok",t)},a)}switch(s.Ct.warn("Failed to create downloader, status [%s]",i.status),i.status){case"capacity":case"stream-ended":case"origin-stream-ended":case"streaming-not-available":case"unauthorized":case"timeout":return n.call(s,s,i.status);default:return n.call(s,s,"failed")}})})},R.prototype.getProtocol=function(){return this.Vn},R.prototype.getLogger=function(){return this.Ct},R.prototype.toString=function(){var t=this.getProtocol();return"PCast["+(t?t.getSessionId():"")||"unauthenticated,"+(t?t.toString():"uninitialized")+"]"};var Z=function(){var e=t.get(E,["global","navigator","userAgent"],"");return tt()||/Android|webOS|BlackBerry|IEMobile|Opera Mini|Mobile|mobile|CriOS/i.test(e)},tt=function(){var e=t.get(E,["global","navigator","userAgent"],"");return/iPad|iPhone|iPod/.test(e)&&!E.global.MSStream},et=function(e){var i=e.match(/(?=a=group:BUNDLE).*/),n=t.get(t.get(i,[0],"").split("a=group:BUNDLE "),[1],""),r=n.split(" ").sort(function(t,i){return e.indexOf("m="+t)>e.indexOf("m="+i)});return r.length>0&&(e=e.replace(n,r.join(" "))),e},it=function(e){if(t.isUndefined(e.onaddstream)){var i=[],n=[];t.addEventListener(e,"track",function(e){t.forEach(e.streams,function(e){t.includes(i,e)||i.push(e)})}),e.getRemoteStreams=function(){return i},e.getLocalStreams=function(){return n},e.addStream=function(i){t.includes(n,i)||n.push(i),t.forEach(i.getTracks(),function(t){e.addTrack(t,i)})}}};return R}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1)],void 0===(r=function(t,e){"use strict";function i(t){this.init(t)}function n(e,i){if(this.vs&&this.vs.dispose(),!i)return this.gs.limitBandwidth(e);var n=i.getObservableMembers();this.vs=n.subscribe(t.bind(r,this,e),{initial:"notify"})}function r(t,e){if(e.length!==this.ys){this.ys=e.length;var i=t/Math.max(1,this.ys-1);this.gs.limitBandwidth(i)}}return i.prototype.init=function(t){e.Rt(t,"publisher"),this.gs=t,this.ys=0,this.ws=null,this.vs=null},i.prototype.connect=function(i,r){e.Rt(i,"roomService"),r=r||{};var s=i.getObservableActiveRoom(),o=r.roomBandwidthLimit||5e6;this.ws=s.subscribe(t.bind(n,this,o),{initial:"notify"})},i.prototype.close=function(){this.ws&&this.ws.dispose(),this.vs&&this.vs.dispose(),this.ws=null,this.vs=null},i.prototype.toString=function(){return"PublisherBandwidthAdjuster"},i}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(20),i(17),i(47)],void 0===(r=function(t,e,i,n,r){"use strict";function s(t,r){e.isArray(t,"userMediaStreams"),r=r||{},this.in=r.uri||n.DefaultPCastUri,this.Ct=r.logger||i.createPCastLogger(this.in),this.bs=[],this.xn=t}function o(t,e,i){var n=new r(i);n.connect(t,e),this.bs.push(n)}return s.prototype.start=function(e,i){i=i||{},t.forEach(this.xn,t.bind(o,this,e,i))},s.prototype.stop=function(){t.forEach(this.bs,function(t){t.close()}),this.bs=[]},s.prototype.toString=function(){return"BandwidthMonitor"},s}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(22)],void 0===(r=function(t,e,i){"use strict";function n(t){e.Rt(t,"roomService"),this.Qn=t}function r(t,e,n){return n&&n.room&&(n.channel=new i(n.room),delete n.room),t(e,n)}return n.prototype.start=function(){return this.Qn.start.apply(this.Qn,arguments)},n.prototype.getChannelInfo=function(i,n,s){return i?e.qt(i,"channelId"):e.qt(n,"alias"),e.It(s,"callback"),this.Qn.getRoomInfo(i,n,t.bind(r,null,s))},n.prototype.createChannel=function(i,n){return e.Rt(i,"channel"),e.qt(i.name,"channel.name"),e.qt(i.type,"channel.type"),e.Xt(i.description,"channel.description"),e.It(n,"callback"),this.Qn.createRoom(i,t.bind(r,null,n))},n.prototype.enterChannel=function(i,n,s){return i?e.qt(i,"roomId"):e.qt(n,"alias"),e.It(s,"callback"),this.Qn.enterRoom(i,n,t.bind(r,null,s))},n.prototype.leaveChannel=function(){return this.Qn.leaveRoom.apply(this.Qn,arguments)},n.prototype.getChatService=function(){return this.Qn.getChatService.apply(this.Qn,arguments)},n.prototype.getSelf=function(){return this.Qn.getSelf.apply(this.Qn,arguments)},n.prototype.getObservableActiveChannel=function(){return this.Qn.getObservableActiveRoom.apply(this.Qn,arguments)},n.prototype.updateSelf=function(){return this.Qn.updateSelf.apply(this.Qn,arguments)},n.prototype.updateMember=function(){return this.Qn.updateMember.apply(this.Qn,arguments)},n.prototype.updateChannel=function(){return this.Qn.updateRoom.apply(this.Qn,arguments)},n.prototype.revertChannelChanges=function(){return this.Qn.revertRoomChanges.apply(this.Qn,arguments)},n.prototype.revertMemberChanges=function(){return this.Qn.revertMemberChanges.apply(this.Qn,arguments)},n.prototype.isInChannel=function(){return this.Qn.isInRoom.apply(this.Qn,arguments)},n.prototype.toString=function(){return"ChannelService"},n.prototype.stop=function(){return this.Qn.stop.apply(this.Qn,arguments)},n}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(4),i(2),i(24),i(49),i(22),i(23),i(15),i(11),i(12),i(14)],void 0===(r=function(t,e,i,n,r,s,o,a,u,c,h,f){"use strict";var d={maxOfflineTime:864e5,maxReconnectFrequency:6e4};function l(i){e.Rt(i,"options"),i.roomExpress&&e.Rt(i.roomExpress,"options.roomExpress");var n=t.assign({reconnectOptions:d},i);this.ks=i.roomExpress||new r(n),this.Ss=!i.roomExpress,this.Ct=this.ks.getPCastExpress().getPCast().getLogger()}function m(e,i,n){n&&t.hasIndexOrKey(n,"roomService")&&(n.channelService=n.roomService?new s(n.roomService):null,delete n.roomService),n&&t.hasIndexOrKey(n,"room")&&(n.channel=n.room?new o(n.room):null,delete n.room),e(i,n)}return l.prototype.dispose=function(){this.Ss&&this.ks.dispose(),this.Ct.info("Disposed Channel Express Instance")},l.prototype.getRoomExpress=function(){return this.ks},l.prototype.getPCastExpress=function(){return this.ks.getPCastExpress()},l.prototype.createChannel=function(i,n){e.Rt(i,"options"),e.Rt(i.channel,"options.channel");var r=t.assign({room:i.channel},i);r.room.type=c.types.channel.name,delete r.channel,this.ks.createRoom(r,t.bind(m,null,n))},l.prototype.joinChannel=function(i,n,r){e.Rt(i,"options"),e.It(n,"joinChannelCallback"),e.It(r,"subscriberCallback"),i.videoElement&&e.Rt(i.videoElement,"options.videoElement"),i.streamSelectionStrategy&&e.qt(i.streamSelectionStrategy,"options.streamSelectionStrategy");var s,o,u,f=t.assign({type:c.types.channel.name,role:h.roles.audience.name},i),d=new a(i.streamSelectionStrategy,this.Ct),l="",p=this;f.channelId&&(f.roomId=f.channelId),delete f.channelId,p.ks.joinRoom(f,function(e,i){var r=!i||t.assign({},i);if(i&&i.roomService){var o=i.roomService.leaveRoom,a=i.roomService.getObservableActiveRoom().getValue();u=i.roomService,l=a?a.getRoomId():"",p.Ct.info("Joined channel [%s] with [%s] selection strategy",l,d.getStrategy()),r.roomService.leaveRoom=function(t){s&&s.stop("leave-channel"),o(t)}}m(n,e,r)},function e(n,a){var c=t.filter(n,function(t){return t.getObservableRole().getValue()===h.roles.presenter.name&&t.getObservableStreams().getValue().length>0}),f=!!a||!s||!o,m=d.getNext(c,f),v=m?m.getObservableStreams().getValue()[0]:null,g=v?v.getPCastStreamId():"";if(!m||!v)return 0===c.length?(d.reset(),s=null,o=null,r(null,{status:"no-stream-playing"})):a?(p.Ct.info("Unable to find a new presenter to replace stream [%s] that ended in channel [%s] with status [%s] and [%s] black-listed members",o,l,a,d.getNumberOfBlackListedMembers()),o&&s&&s.isActive()&&s.stop("presenter-failure"),r(null,{status:a||"unable-to-recover"})):r(null,{status:"no-stream-playing"});if(!g)return p.Ct.info("Channel [%s] presenter has no stream",l),r(null,{status:"no-stream-playing"});if(g===o)return a?(p.Ct.info("Unable to find a new presenter to replace stream [%s] that ended in channel [%s] with status [%s]",o,l,a),o&&s&&s.stop("same-presenter-failure"),r(null,{status:a||"unable-to-recover"})):void 0;o&&s&&s.stop("change-presenter");var y=function(t){var i=u?u.getObservableActiveRoom().getValue():null,n=i?i.getObservableMembers().getValue():[];if(i)return e(n,t)},w=t.assign({},{monitor:{callback:t.bind(function(t,e,i){if(o===t)return e?y("unable-to-subscribe"):"app-background"===i.reason?r(e,i):i.retry&&"high-availability"!==d.getStrategy()?i.retry():"ok"!==i.status?"custom"===i.reason&&"client-side-failure"!==i.description?r(e,i):y(i.status):void 0},this,g),options:{conditionCountForNotificationThreshold:8}}},i),b=o?a?"recovered-from-failure":"stream-override":"stream-started";o=g,p.ks.subscribeToMemberStream(v,w,t.bind(function(t,e,i){if(o===t){if(i&&"ok"===i.status&&(i.reason=b),e||i&&"ok"!==i.status)return p.Ct.info("[%s] Issue with stream [%s]. Trying next member",t,i?i.status:"",e),y(i?i.status:"");i&&i.mediaStream?s=i.mediaStream:(o=null,s=null),r(e,i)}},this,g))})},l.prototype.publishToChannel=function(i,n){e.Rt(i,"options"),e.It(n,"callback");var r=t.assign({memberRole:h.roles.presenter.name,streamType:f.types.presentation.name,room:i.channel},i);r.room.type=c.types.channel.name,delete r.channel,this.ks.publishToRoom(r,t.bind(m,null,n))},l.prototype.publishScreenToChannel=function(i,n){e.Rt(i,"options"),e.It(n,"callback");var r=t.assign({memberRole:h.roles.presenter.name,streamType:f.types.presentation.name,room:i.channel},i);r.room.type=c.types.channel.name,delete r.channel,this.ks.publishScreenToRoom(r,t.bind(m,null,n))},l}.apply(e,n))||(t.exports=r)},function(t,e,i){var n;void 0===(n=function(){"use strict";return{errorSeverity:{recoverable:{id:1,name:"RECOVERABLE"},critical:{id:2,name:"CRITICAL"}}}}.apply(e,[]))||(t.exports=n)},function(t,e,i){var n,r;n=[i(0),i(1)],void 0===(r=function(t,e){"use strict";var i=[{"16x9":[{2160:3840},{1080:1920},{768:1366},{720:1280},{576:1024},{480:853},{360:640},{180:320}]},{"4x3":[{1200:1600},{1080:1440},{720:960},{600:800},{576:768},{480:640},{360:480},{288:352},{240:320},{144:176},{120:160}]}],n={fallbackToLower:{id:0,name:"fallbackToLower"},fallbackToHigher:{id:1,name:"fallbackToHigher"},fallbackToLowerThenHigher:{id:2,name:"fallbackToLowerThenHigher"},exact:{id:3,name:"exact"}};function r(t){e.Rt(t,"options"),t.resolutionSelectionStrategy&&e.Pe(t.resolutionSelectionStrategy,n,"options.resolutionSelectionStrategy"),t.aspectRatio&&e.qt(t.aspectRatio,"options.aspectRatio"),t.resolutionHeight&&e.ee(t.resolutionHeight,"options.resolutionHeight"),t.frameRate&&e.ee(t.frameRate,"options.frameRate"),this.Es=t.resolutionSelectionStrategy||n.fallbackToLowerThenHigher.name,this.Ts=t.aspectRatio||"16x9",this.Is=t.resolutionHeight||720,this.Rs=t.frameRate||15}function s(t){return e.ee(t,"value"),2*Math.floor((t+1)/2)}function o(e,n){var r,s,o,a,l=u(n,i),m=c(n,i),p=c(e.toString(),l),v=0===p,g=i.length-1===m;if(t.ee(p)){if(v)return g?null:(s=u(r=h(++m,i),i),o=h(p=d(this.Is,s),l),a=this.calculateWidthByAspectRatio(o,r),{aspectRatio:r,height:parseInt(o),width:parseInt(a)});p--}else if(!(p=d(e,l)))return;return r=h(m,i),o=h(p,s=f(m,i)),a=s[p][o],{aspectRatio:r,height:parseInt(o),width:parseInt(a)}}function a(e,n){var r,s,o,a,d,l,m=u(n,i),p=c(n,i),v=c(e.toString(),m),g=v===m.length-1,y=i.length-1===p;if(t.ee(v)){if(g)return y?null:(r=h(++p,i),o=this.Is,a=this.calculateWidthByAspectRatio(o,r),{aspectRatio:r,height:parseInt(o),width:parseInt(a)});v++}else if(d=e,l=m,!(v=t.keys(l[l.length-1])[0]>d?null:t.reduce(l,function(e,i,n){if(!e)return n;var r=t.keys(l[e])[0],s=t.keys(i)[0];return s>d?e:Math.abs(d-s)<Math.abs(d-r)?n:e})))return;return r=h(p,i),o=h(v,s=f(p,i)),a=s[v][o],{aspectRatio:r,height:parseInt(o),width:parseInt(a)}}function u(e,i){var n=t.find(i,function(t){return t.hasOwnProperty(e)});return n?n[e]:null}function c(e,i){return t.findIndex(i,function(t){return t.hasOwnProperty(e)})}function h(e,i){return t.keys(i[e])[0]}function f(e,i){var n=t.keys(i[e]);return i[e][n[0]]}function d(e,i){return t.keys(i[0])[0]<e?null:t.reduce(i,function(n,r,s){if(!n)return s;var o=t.keys(i[n])[0],a=t.keys(r)[0];return a<e?n:Math.abs(e-a)<Math.abs(e-o)?s:n})}return r.prototype.getDefaultResolution=function(){var t=u(this.Ts,i),e=u(this.Is,t)||this.calculateWidthByAspectRatio(this.Is,this.Ts);return{height:this.Is,width:e,aspectRatio:this.Ts}},r.prototype.getDefaultFrameRate=function(){return this.Rs},r.prototype.getNextResolution=function(t,i){switch(e.ee(t,"height"),e.qt(i,"aspectRatio"),this.Es){case n.fallbackToLower.name:return a.call(this,t,i);case n.fallbackToHigher.name:return o.call(this,t,i);case n.fallbackToLowerThenHigher.name:var r=null;return t>this.Is?r=o.call(this,t,i):(r=a.call(this,t,i))&&r.height||(r=o.call(this,this.Is,this.Ts)),r;case n.exact.name:default:return}},r.prototype.canResolveNextResolution=function(){return this.Es!==n.exact.name},r.prototype.calculateWidthByAspectRatio=function(t,e){switch(e){case"16x9":return s(16/9*t);case"4x3":return s(4/3*t);default:throw new Error("Aspect Ratio not supported")}},r}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1)],void 0===(r=function(t,e){"use strict";function i(t){e.Rt(t,"logger"),this.Ct=t,this.init()}return i.prototype.init=function(){},i.prototype.onValue=function(t){this.Cs=t},i.prototype.startDetection=function(i,n){return function(i,n){e.Rt(i,"audioVolumeMeter");var r=this,s=(n=n||{}).speakingHysteresisInterval||50,o=n.silenceHysteresisInterval||1500;e.ee(s,"options.speakingHysteresisInterval"),e.ee(o,"options.silenceHysteresisInterval");var a=!1,u=t.now()+s,c=t.now()+o;i.onValue(function(n){e.Rt(i,"audioVolumeMeter"),e.ee(n.date,"value.date"),e.ee(n.value,"value.value"),e.ee(n.smoothedValue,"value.smoothedValue"),e.ee(n.smoothedPeakValue,"value.smoothedPeakValue"),e.ee(n.clipped,"value.clipped");var h=n.value>.01&&n.value>2*n.smoothedValue&&n.value>.25*n.smoothedPeakValue,f=n.value>.8*n.smoothedValue,d=n.value<.5*n.smoothedValue,l=!h;(h||a&&f)&&u<n.date?(c=t.utc(n.date)+o,a||(a=!0,r.Ct.info("Speaking detected"),r.Cs&&r.Cs("speaking"))):(d||!a&&l)&&c<n.date&&(u=t.utc(n.date)+s,a&&(a=!1,r.Ct.info("Silence detected"),r.Cs&&r.Cs("silence")))})}.call(this,i,n)},i.prototype.toString=function(){return"AudioSpeakerDetection"},i}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1)],void 0===(r=function(t,e){"use strict";function i(t){e.Rt(t,"logger"),this.Ct=t}function n(e){for(var i=e.inputBuffer.getChannelData(0),n=0,r=0,s=0;s<i.length;s++)n+=i[s]*i[s],Math.abs(i[s])>.99&&r++;this.Ms=Math.sqrt(n/i.length),this.Ps=this.xs*this.Ms+(1-this.xs)*this.Ps,this.Ds=Math.max(this.Ms,this.xs*this.Ms+(1-this.xs)*this.Ds),this.Os=r,this.Cs&&this.Cs.call(this,{date:t.now(),value:this.Ms,smoothedValue:this.Ps,smoothedPeakValue:this.Ds,clipped:this.Os})}return i.prototype.init=function(i,r){e.Rt(i,"context"),e.It(i.createScriptProcessor,"context.createScriptProcessor"),r=parseFloat(r||1/16),e.ee(r,"alpha"),this.As=i,this.xs=r,this.Ms=0,this.Ps=0,this.Ds=0,this.Os=0,this.qs=i.createScriptProcessor(4096,1,1),t.addEventListener(this.qs,"audioprocess",t.bind(n,this))},i.prototype.onValue=function(t){this.Cs=t},i.prototype.getValue=function(){return this.Ms},i.prototype.getSmoothedValue=function(){return this.Ps},i.prototype.getSmoothedPeakValue=function(){return this.Ds},i.prototype.setAlpha=function(t){e.ee(t,"alpha"),this.xs=parseFloat(t)},i.prototype.connect=function(t){return function(t){e.Rt(t,"stream"),t.getAudioTracks().length>0?(this.Us=this.As.createMediaStreamSource(t),this.Us.connect(this.qs),this.qs.connect(this.As.destination)):this.Ct.info("Stream has no audio tracks")}.call(this,t)},i.prototype.stop=function(){return function(){this.Us&&this.Us.disconnect(),this.qs.disconnect()}.call(this)},i.prototype.toString=function(){return"AudioVolumeMeter"},i}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(54)],void 0===(r=function(t,e,i){"use strict";function n(t){e.Rt(t,"logger"),this.Ct=t,this.Fs={}}return n.prototype.stopAllMeters=function(){t.forOwn(this.Fs,function(t){t.stop()})},n.prototype.getAudioVolumeMeter=function(t){return e.Rt(t,"stream"),e.qt(t.id,"streamId"),this.Fs[t.id]||(this.Fs[t.id]=new i(this.Ct)),this.Fs[t.id]},n.prototype.getAudioVolumeMeters=function(){return t.values(this.Fs)},n.prototype.toString=function(){return"AudioVolumeMeterFactory"},n}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(20),i(17),i(38),i(55),i(53)],void 0===(r=function(t,e,i,n,r,s,o){"use strict";function a(o,a){e.isArray(o,"userMediaStreams"),a=a||{},this.in=a.uri||n.DefaultPCastUri,this.Ct=a.logger||i.createPCastLogger(this.in),this.xr=a.audioContext||new r,this.Ns=this.xr.getNativeAudioContext(),this.js=null,this.Ls=o,this.Bs=!t.Rt(a.audioContext),this._s=new s(this.Ct),t.forEach(this.Ls,t.bind(u,this,a))}function u(t,i){e.Rt(i,"stream"),e.Rt(t,"options");var n=this._s.getAudioVolumeMeter(i);n.init(this.Ns,t.alpha),n.connect(i)}function c(t,i){e.Rt(i,"stream"),e.Rt(t,"options");var n=this._s.getAudioVolumeMeter(i),r=new o(this.Ct);t.alpha&&n.setAlpha(t.alpha),r.onValue(this.js),r.startDetection(n,t)}return a.prototype.start=function(i,n){e.It(n,"callback"),this.js=n,i=i||{},t.forEach(this.Ls,t.bind(c,this,i))},a.prototype.stop=function(){t.forEach(this.getAudioVolumeMeters(),function(t){t.onValue(function(){})}),this.js=null},a.prototype.getAudioVolumeMeter=function(t){return e.Rt(t,"stream"),this._s.getAudioVolumeMeter(t)},a.prototype.getAudioVolumeMeters=function(){return this._s.getAudioVolumeMeters()},a.prototype.dispose=function(){this.Bs&&this.Ns.close(),this._s.stopAllMeters(),this.Ls=null},a.prototype.toString=function(){return"AudioSpeakerDetector"},a}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(4),i(2),i(28)],void 0===(r=function(t,e,i,n,r){"use strict";function s(t){e.Rt(t,"pcast"),e.It(t.getLogger,"pcast.getLogger"),e.It(t.getProtocol,"pcast.getProtocol"),this.Wn=t,this.Ct=t.getLogger(),this.Vn=t.getProtocol(),this.w=new i.Observable(!1),this.Ws=null,e.Rt(this.Ct,"this._logger"),e.Rt(this.Vn,"this._protocol"),this.ar=new r(this.Wn)}function o(t){switch(e.Rt(t,"event"),e.qt(t.roomId,"event.roomId"),e.qt(t.eventType,"event.eventType"),e.isArray(t.chatMessages,"event.chatMessages"),t.eventType){case"Message":this.Ct.debug("[%s] Room messages [%s]",t.roomId,t.chatMessages);var i=this.zs[t.roomId];f(t.chatMessages),i&&i(null,{status:"ok",chatMessages:t.chatMessages});break;default:this.Ct.warn("Unsupported room conversation event [%s]",t.eventType)}}function a(t){}function u(e){this.Ws&&this.Ws!==e&&function(){var e=this;t.forOwn(this.zs,function(t,i){c.call(e,i,1)})}.call(this)}function c(t,i){e.qt(t,"roomId"),e.ee(i,"batchSize"),h.call(this),this.ar.assertAuthorized();var n=this.ar.getPCastSessionId();this.Ws=n,this.Ct.info("Subscribe to room [%s] conversation with batch size of [%s]",t,i);var r=this;this.Vn.subscribeToRoomConversation(n,t,i,function(e,i){var n=r.zs[t];if(!n)return r.Ct.warn("No subscription callback set for room [%s]",t);if(e)return r.Ct.error("Subscribe to room conversation failed with error [%s]",e),n(e,null);var s={status:i.status};if("ok"!==i.status)return delete r.zs[t],r.Ct.warn("Subscribe to room conversation failed with status [%s]",i.status),n(null,s);s.chatMessages=i.chatMessages,f(s.chatMessages),n(null,s)})}function h(){if(!this.w.getValue())throw new Error("ChatService not Enabled. Please start before performing actions.")}function f(e){t.forEach(e,function(e){!function(e){e.timestamp&&(e.timestamp=t.utc(e.timestamp)),e.from&&(e.from.lastUpdate=t.utc(e.from.lastUpdate))}(e)})}return s.prototype.start=function(){if(!this.w.getValue()){this.v=new n.DisposableList,this.zs={},this.w.setValue(!0),function(){var e=this.ar.getObservableStatus().subscribe(t.bind(a,this)),i=this.ar.getObservableSessionId().subscribe(t.bind(u,this));this.v.add(e),this.v.add(i)}.call(this);var e=this.Vn.onEvent("chat.RoomConversationEvent",t.bind(o,this));this.v.add(e)}},s.prototype.stop=function(){this.w.getValue()&&this.v&&this.v.dispose()},s.prototype.getObservableChatEnabled=function(){return this.w},s.prototype.sendMessageToRoom=function(t,i,n,r,s,o){(function(t,i,n,r,s,o){e.qt(t,"roomId"),e.qt(i,"screenName"),e.qt(n,"role"),e.ee(r,"lastUpdate"),e.qt(s,"message"),e.It(o,"callback"),h.call(this),this.ar.assertAuthorized();var a={messageId:"",timestamp:0,from:{sessionId:this.ar.getPCastSessionId(),screenName:i,role:n,lastUpdate:r},message:s};this.Ct.info("Send message to room [%s] from [%s]",t,i);var u=this;return this.Vn.sendMessageToRoom(t,a,function(t,e){if(t)return u.Ct.error("Send message to room failed with error [%s]",t),o(t,null);var i={status:e.status};"ok"!==e.status&&u.Ct.warn("Send message to room failed with status [%s]",e.status),o(null,i)})}).call(this,t,i,n,r,s,o)},s.prototype.subscribeAndLoadMessages=function(t,e,i){var r=function(t,e){var i=this;this.zs[t]=e;var r=new n.Disposable(function(){i.zs[t]===e&&delete i.zs[t]});return this.v.add(r),r}.call(this,t,i);return c.call(this,t,e),r},s.prototype.getMessages=function(t,i,n,r,s){(function(t,i,n,r,s){e.qt(t,"roomId"),e.It(s,"callback"),r&&n||e.ee(i,"batchSize"),r&&e.qt(r,"beforeMessageId"),n&&e.qt(n,"afterMessageId"),h.call(this),this.ar.assertAuthorized();var o=this.ar.getPCastSessionId();this.Ct.info("Get messages from room [%s] conversation with batch size of [%s], after [%s], and before [%s]",t,i,n,r);var a=this;this.Vn.getMessages(o,t,i,n,r,function(t,e){if(t)return a.Ct.error("Get messages from room conversation failed with error [%s]",t),s(t,null);var i={status:e.status};if("ok"!==e.status)return a.Ct.warn("Get messages from room conversation failed with status [%s]",e.status),s(null,i);i.chatMessages=e.chatMessages,f(i.chatMessages),s(null,i)})}).call(this,t,i,n,r,s)},s.prototype.toString=function(){return"ChatService"},s}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(4),i(2),i(57)],void 0===(r=function(t,e,i,n,r){"use strict";var s=100;function o(t){e.Rt(t,"roomService"),e.Rt(t.Wn,"roomService._pcast"),e.Rt(t.Ct,"roomService._logger"),this.Qn=t,this.Wn=t.Wn,this.Ct=t.Ct,this.Vs=new r(this.Wn),this.Hs=new i.ObservableArray([]),this.Gs=[],this.v=new n.DisposableList,this.Js=null}function a(t){t&&this.Js===t.getRoomId()||(c.call(this),t&&u.call(this))}function u(){c.call(this),this.Ks=function(e){var i=this.Qn.getObservableActiveRoom().getValue().getRoomId();this.Js=i;var n=this;return this.Hs.setValue([]),this.Vs.subscribeAndLoadMessages(i,e,function(e,i){if(e)throw e;if("ok"!==i.status)throw new Error("Unable to subscribe to room chat. Status "+status);var r=n.Hs.getValue();t.forEach(i.chatMessages,function(t){r.push(t)}),r.length>s&&r.splice(0,r.length-s),n.Hs.setValue(r)})}.call(this,this.Xs)}function c(){this.Ks&&this.Ks.dispose&&this.Ks.dispose()}return o.prototype.start=function(e){this.Xs=e||0,this.Vs.start(),function(){var e=this.Qn.getObservableActiveRoom().subscribe(t.bind(a,this));this.v.add(e)}.call(this),u.call(this)},o.prototype.stop=function(){this.Vs.stop(),c.call(this),this.v&&this.v.dispose()},o.prototype.getObservableChatMessages=function(){return this.Hs},o.prototype.getObservableChatEnabled=function(){return this.Vs.getObservableChatEnabled()},o.prototype.sendMessageToRoom=function(t,e){var i=this.Qn.getObservableActiveRoom().getValue().getRoomId(),n=this.Qn.nr.getValue(),r=n.getObservableScreenName().getValue(),s=n.getObservableRole().getValue(),o=n.getLastUpdate();this.Vs.sendMessageToRoom(i,r,s,o,t,e)},o.prototype.getMessages=function(t,e,i,n){var r=this.Qn.getObservableActiveRoom().getValue().getRoomId();return this.Vs.getMessages(r,t,e,i,n)},o.prototype.toString=function(){return"RoomChatService"},o}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(4),i(31)],void 0===(r=function(t,e,i,n){"use strict";function r(t,e,i,n,r,s,o,a,u){this.init(t,e,i,n,r,s,o,a,u)}function s(){throw new Error("ImmutableRoom is Immutable")}function o(){throw new Error("Unable to subscribe to Immutable [ImmutableRoom]")}function a(e){t.isArray(e)?t.forEach(e,function(t){u(t)}):t.Rt(e)&&t.forOwn(e,function(t){u(t)})}function u(t){!function(t){(t instanceof i.Observable||t instanceof i.ObservableArray)&&(t.setValue=s,t.subscribe=o,a(t.getValue()))}(t),a(t)}return r.prototype.init=function(t,e,i,r,s,o,u,c,h){this.rn=new n(null,e,i,r,s,o,u,c,h),a(this.rn)},r.prototype.getRoomId=function(){return this.rn.getRoomId()},r.prototype.getObservableAlias=function(){return this.rn.getObservableAlias()},r.prototype.getObservableName=function(){return this.rn.getObservableName()},r.prototype.getObservableDescription=function(){return this.rn.getObservableDescription()},r.prototype.getObservableType=function(){return this.rn.getObservableType()},r.prototype.getObservableMembers=function(){return this.rn.getObservableMembers()},r.prototype.getObservableBridgeId=function(){return this.rn.getObservableBridgeId()},r.prototype.getObservablePin=function(){return this.rn.getObservablePin()},r.prototype.toString=function(){return this.rn.toString()},r.prototype.toJson=function(){return this.rn.toJson()},r.prototype.commitChanges=s,r.prototype.reload=s,r.prototype.en=s,r.prototype.sn=s,r.prototype.an=s,r.prototype.un=s,r}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(5),i(6),i(2),i(3),i(9),i(7)],void 0===(r=function(t,e,i,n,r,s,o,a){"use strict";function u(e,n,s,a,u){this.Ct=u,this.Xi=e,this.Qs=n,this.dr=s,this.h=a,this.At=null,this.lt=null,this.pr=new o(u),this.vr=new i.NamedEvents,this.v=new r.DisposableList,this.Vi=t.bind(c,this),this.Ki=t.bind(h,this)}function c(t){this.Ct.info("[%s] Loading Phenix Real-Time stream player stalled caused by [%s] event.",this.Xi,t.type)}function h(){this.Ct.info("[%s] Phenix Real-Time stream ended.",this.Xi)}return u.prototype.on=function(t,e){return this.vr.listen(t,e)},u.prototype.start=function(e){var i=!!t.find(this.Qs.getTracks(),function(t){return"audio"===t.kind});return this.h.canPlaybackAudio||(this.h.disableAudioIfNoOutputFound&&this.h.forcedAudioDisabled?this.Ct.warn("[%s] Missing audio playback device. Audio has been disabled on stream. Try setting up an audio device and re-subscribe in order to receive audio.",this.Xi):!this.h.disableAudioIfNoOutputFound&&i&&this.Ct.warn("[%s] Missing audio playback device. May experience audio and/or video failure. Try setting up an audio device OR pass the [disableAudioIfNoOutputFound] option when subscribing to disable audio playback when no devices are attached.",this.Xi)),this.lt=s.attachMediaStream(e,this.Qs),this.v.add(this.dr.recordTimeToFirstFrame(e)),this.v.add(this.dr.recordRebuffering(e)),this.v.add(this.dr.recordVideoResolutionChanges(this,e)),this.v.add(this.dr.recordVideoPlayingAndPausing(e)),!1===this.h.receiveAudio&&(e.muted=!0),t.addEventListener(e,"stalled",this.Vi,!1),t.addEventListener(e,"pause",this.Vi,!1),t.addEventListener(e,"suspend",this.Vi,!1),t.addEventListener(e,"ended",this.Ki,!1),this.pr.start(this,e),e},u.prototype.stop=function(e){this.pr.stop(),this.v.dispose(),this.lt&&(t.removeEventListener(this.lt,"stalled",this.Vi,!1),t.removeEventListener(this.lt,"pause",this.Vi,!1),t.removeEventListener(this.lt,"suspend",this.Vi,!1),t.removeEventListener(this.lt,"ended",this.Ki,!1),t.It(this.lt.pause)&&this.lt.pause(),"Edge"===s.browser&&(this.lt.src=""),this.lt.src&&"IE"===s.browser?this.lt.src=null:this.lt.src&&(this.lt.src=""),this.lt.srcObject&&(this.lt.srcObject=null),this.lt=null),this.Ct.info("[%s] Phenix real-time renderer has been destroyed",this.Xi),this.vr.fire(a.rendererEvents.ended.name,[e])},u.prototype.getStats=function(){if(!this.lt)return{width:0,height:0,currentTime:0,lag:0,networkState:a.networkStates.networkNoSource.id};var e=(t.now()-this.h.originStartTime)/1e3,i=this.h.networkLag/1e3;return{width:this.lt.videoWidth||this.lt.width,height:this.lt.videoHeight||this.lt.height,currentTime:e,lag:i,networkState:this.lt.networkState}},u.prototype.setDataQualityChangedCallback=function(t){e.It(t,"callback"),this.dataQualityChangedCallback=t},u.prototype.addVideoDisplayDimensionsChangedCallback=function(t,e){return this.pr.addVideoDisplayDimensionsChangedCallback(t,e)},u}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(5),i(3),i(16),i(37),i(60),i(7)],void 0===(r=function(t,e,i,n,r,s,o,a){"use strict";var u=5e3;function c(e,n,r,s,o,a){this.Xi=e,this.Qs=n,this.yr=r,this.dr=s,this.h=o,this.Ct=a,this.mr=[],this.pr=null,this.vr=new i.NamedEvents,this.$s=[],t.addEventListener(r,"iceconnectionstatechange",t.bind(f,this))}function h(i){return t.reduce(i.getTracks(),function(t,i){return t&&function(t){return e.Rt(t,"track"),"ended"===t.readyState}(i)},!0)}function f(){var e=this;switch(this.yr.iceConnectionState){case"checking":case"connecting":if(t.ee(this.Ys))return;this.Zs=t.now(),this.Ys=setTimeout(function(){e.Ct.warn("[%s] Stream has not connected withing [%s] ms.",e.Xi,u),e.vr.fire(a.streamEvents.playerError.name,["real-time",new Error("connection-timeout")])},u);break;case"connected":t.ee(this.Ys)&&(clearTimeout(this.Ys),this.Ys=null),this.Ct.info("[%s] Ice Connection completed after [%s] ms",this.Xi,t.now()-this.Zs),this.Zs=null}}return c.prototype.on=function(t,e){this.vr.listen(t,e)},c.prototype.createRenderer=function(){var e=this,i=new o(this.Xi,this.Qs,this.dr,this.h,this.Ct);return i.on(a.rendererEvents.error.name,function(t,i){e.vr.fire(a.streamEvents.playerError.name,[t,i])}),i.on(a.rendererEvents.ended.name,function(n){e.mr=t.filter(e.mr,function(t){return t!==i}),0===e.mr.length&&(e.dr.stop(),e.vr.fire(a.streamEvents.playerEnded.name,[n]))}),this.mr.push(i),i},c.prototype.select=function(t){e.It(t,"trackSelectCallback"),e.It(n.global.MediaStream,"rtc.global.MediaStream");for(var i=this.Qs.getTracks(),r=new n.global.MediaStream,s=0;s<i.length;s++)t(i[s],s)&&r.addTrack(i[s]);if(0===r.getTracks().length)return this.Ct.warn("No tracks selected");var o=this,u=new c(this.Xi,r,this.yr,this.dr,this.h,this.Ct);return u.on(a.streamEvents.stopped.name,function(t){h(o.Qs)&&o.vr.fire(a.streamEvents.stopped.name,[t])}),this.$s.push(u),u},c.prototype.setStreamEndedCallback=function(t){e.It(t,"callback"),this.to=t},c.prototype.setStreamErrorCallback=function(t){e.It(t,"callback"),this.eo=t},c.prototype.streamEndedCallback=function(e,i,n){t.forEach(this.$s,function(t){t.streamEndedCallback(i,n)}),t.It(this.to)&&this.to(this,i,n)},c.prototype.streamErrorCallback=function(e,i,n){t.forEach(this.$s,function(t){t.streamErrorCallback(i,n)}),t.It(this.eo)&&this.eo(e,i,n)},c.prototype.stop=function(e){var i;this.isActive()&&((i=this.Qs)&&t.It(i.stop,"stream.stop")&&i.stop(),t.forEach(i&&i.getTracks?i.getTracks():[],function(t){t.stop()}),this.Ct.info("[%s] stop [real-time] media stream with reason [%s]",this.Xi,e),this.vr.fire(a.streamEvents.stopped.name,[e]),this.gr=!0)},c.prototype.monitor=function(t,i){e.Rt(t,"options"),e.It(i,"callback");var n=this,r=new s(n.Xi,n.yr,n.Ct);return t.direction="inbound",r.start(t,function(){return n.isActive()},function(t,e){return t&&n.Ct.warn("[%s] Media stream monitor triggered unrecoverable error [%s]",t),n.Ct.warn("[%s] Media stream triggered monitor condition for [%s]",n.Xi,e.type),i(n,"client-side-failure",e)}),this.io=r,r},c.prototype.getMonitor=function(){return this.io},c.prototype.getStream=function(){return this.Qs},c.prototype.isActive=function(){return!this.gr&&!h(this.Qs)},c.prototype.getStreamId=function(){return this.Xi},c.prototype.getStats=function(t){e.It(t,"callback"),this.wr||(this.wr={});var i=this;return n.getStats(this.yr,null,function(e){t(r.convertPeerConnectionStats(e,i.wr))})},c.prototype.getRenderer=function(){return t.get(this.mr,[0],null)},c}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(8),i(5),i(6),i(2),i(13),i(3),i(9),i(7)],void 0===(r=function(t,e,i,n,r,s,o,a,u,c){"use strict";var h=6e3,f=15e3,d={local:"https://local.phenixrts.com/public/rtmp/rtmp-flash-renderer-2018.3.13.swf",staging:"https://stg.phenixrts.com/public/rtmp/rtmp-flash-renderer-2018.3.13.swf",production:"https://phenixrts.com/public/rtmp/rtmp-flash-renderer-2018.3.13.swf"};function l(i,r,o,a,c){e.Rt(a,"options"),a.env&&e.qt(a.env,"options.env");var h=d[a.env||"production"];this.Ct=c,this.Xi=i,this.no=t.map(r,function(t){return t.uri=encodeURI(t.uri).replace(/[#]/g,"%23"),t}),this.dr=o,this.h=a,this.At=null,this.ro=null,this.so=null,this.vr=new n.NamedEvents,this.pr=new u(c),this.v=new s.DisposableList,this.Vi=t.bind(v,this),this.Ki=t.bind(g,this),this.Qi=t.bind(m,this),this.ct=a.swfSrc||h}function m(t){this.vr.fire(c.rendererEvents.error.name,["flash-player",t])}function p(){var e=!this.oo||t.now()-this.oo>f;return this.so&&!this.ao&&this.ci&&0!==this.so.buffered.length&&e}function v(e){var i=this;i.Ct.info("[%s] Loading flash player stalled caused by [%s] event.",i.Xi,e.type);var n=i.so.currentTime;setTimeout(function(){i.so&&i.so.currentTime===n&&!i.so.paused&&p.call(i)&&(i.Ct.warn("Reloading stream after being stalled for [%s] seconds",h/1e3),function(){p.call(this)&&(this.Ct.warn("Reloading unhealthy stream that was active for at least [%s] seconds",f/1e3),this.oo=t.now(),function(){this.ro.destroy(),this.start(this.uo)}.call(this))}.call(i))},h)}function g(){this.Ct.info("[%s] Flash player ended.",this.Xi)}l.isSupported=function(){return function(){var e=[10,0,0],i=[0,0,0];if(t.Sn(y))return y;if(t.get(a.global.navigator,["plugins","Shockwave Flash"])){var n=a.global.navigator.plugins["Shockwave Flash"].description;if(n&&t.get(a.global.navigator,["mimeTypes","application/x-shockwave-flash","enabledPlugin"],!1))for(var r=0,s=(i=n.replace("Shockwave Flash","").replace(/^\s+/,"").replace(/\sr/gi,".").split(".")).length;r<s;r++)i[r]=parseInt(i[r].match(/\d+/),10)}else if(a.global.ActiveXObject)try{var o=new a.global.ActiveXObject("ShockwaveFlash.ShockwaveFlash");if(o){var u=o.GetVariable("$version")||"",c=t.get(u.split(" "),[1],i).split(",");i=[parseInt(c[0],10),parseInt(c[1],10),parseInt(c[2],10)]}}catch(t){console.error(t)}return y=i[0]>e[0]||i[0]===e[0]&&i[1]>0||i[0]===e[0]&&0===i[1]&&i[2]>=0}()},l.prototype.on=function(t,e){return this.vr.listen(t,e)},l.prototype.start=function(e){var i={streamId:this.Xi,swfSrc:this.ct};return this.uo=e,this.ro=new a.PhenixVideo(e,this.no,"flash",i),this.ro.hookUpEvents(),this.so=this.ro.getElement(),this.v.add(this.dr.recordTimeToFirstFrame(this.uo)),this.v.add(this.dr.recordRebuffering(this.uo)),this.v.add(this.dr.recordVideoResolutionChanges(this,this.uo)),this.v.add(this.dr.recordVideoPlayingAndPausing(this.uo)),this.so&&this.so.play(),t.addEventListener(this.uo,"stalled",this.Vi,!1),t.addEventListener(this.uo,"pause",this.Vi,!1),t.addEventListener(this.uo,"suspend",this.Vi,!1),t.addEventListener(this.uo,"ended",this.Ki,!1),t.addEventListener(this.uo,"error",this.Qi,!1),e},l.prototype.stop=function(e){var i=this;if(this.v.dispose(),this.ro){var n=function(){i.so&&(t.removeEventListener(i.uo,"stalled",i.Vi,!1),t.removeEventListener(i.uo,"pause",i.Vi,!1),t.removeEventListener(i.uo,"suspend",i.Vi,!1),t.removeEventListener(i.uo,"ended",i.Ki,!1),t.removeEventListener(i.uo,"error",i.Qi,!1)),i.so=null,i.uo=null,i.vr.fire(c.rendererEvents.ended.name,[e])};try{this.ro.destroy(),this.ro=null,n(),this.Ct.info("[%s] Flash player has been destroyed",this.Xi)}catch(t){i.Ct.error("[%s] Error while destroying Flash player [%s]",i.Xi,t.code,t),n(),i.vr.fire(c.rendererEvents.error.name,["flash-player",t])}}},l.prototype.getStats=function(){if(!this.so)return{width:0,height:0,currentTime:0,lag:0,networkState:c.networkStates.networkNoSource.id};var e={},i=this.so.currentTime,n=(t.now()-this.h.originStartTime)/1e3;return e.lag=Math.max(0,n-i),e.estimatedBandwidth>0?e.networkState=c.networkStates.networkLoading.id:e.playTime>0?e.networkState=c.networkStates.networkIdle.id:e.video?e.networkState=c.networkStates.networkEmpty.id:e.networkState=c.networkStates.networkNoSource.id,e},l.prototype.setDataQualityChangedCallback=function(t){e.It(t,"callback"),this.dataQualityChangedCallback=t},l.prototype.getPlayer=function(){return this.ci},l.prototype.addVideoDisplayDimensionsChangedCallback=function(t,e){return this.pr.addVideoDisplayDimensionsChangedCallback(t,e)};var y=null;return l}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(8),i(5),i(6),i(2),i(13),i(3),i(9),i(7)],void 0===(r=function(t,e,i,n,r,s,o,a,u,c){"use strict";var h=6e3,f=15e3;function d(e,i,r,o,a){this.Ct=a,this.Xi=e,this.co=encodeURI(i).replace(/[#]/g,"%23"),this.dr=r,this.h=o,this.At=null,this.lt=null,this.pr=new u(a),this.Hi={time:0,buffered:null,averageLength:0,count:0,lastCurrentTime:0,lastCurrentTimeOccurenceTimestamp:0},this.vr=new n.NamedEvents,this.v=new s.DisposableList,this.Vi=t.bind(g,this),this.Gi=t.bind(v,this),this.Ki=t.bind(w,this)}function l(t){if(p.call(this)&&t&&(3===t.code||t.severity===o.errors.severity.RECOVERABLE))return this.Ct.warn("Reloading unhealthy stream after error event [%s]",t),m.call(this);this.vr.fire(c.rendererEvents.error.name,["phenix-player",t])}function m(){p.call(this)&&(this.Ct.warn("Reloading unhealthy stream that was active for at least [%s] seconds",f/1e3),this.oo=t.now(),function(){this.ci.dispose(),this.ci=null,this.start(this.lt)}.call(this))}function p(){var e=!this.oo||t.now()-this.oo>f;return this.lt&&!this.ao&&this.ci&&0!==this.lt.buffered.length&&e}function v(){if(this.Hi.time=t.now(),0===this.lt.buffered.length)return this.Ct.debug("[%s] Phenix live stream player progress event fired without any buffered content",this.Xi);var e=this.lt.buffered.end(this.lt.buffered.length-1);if(this.Hi.buffered!==e){if(null!==this.Hi.buffered){var i=this.Hi.averageLength*this.Hi.count+(e-this.Hi.buffered),n=this.Hi.lastCurrentTime===this.lt.currentTime;this.Hi.count+=1,this.Hi.averageLength=i/this.Hi.count,n||(this.Hi.lastCurrentTimeOccurenceTimestamp=t.now());var r=this.Hi.lastCurrentTimeOccurenceTimestamp&&t.now()-this.Hi.lastCurrentTimeOccurenceTimestamp>h;n&&r&&this.lt&&!this.lt.paused&&p.call(this)&&(this.Ct.warn("Reloading stream after current time has not changed for [%s] seconds due to unregistered stall.",h/1e3),m.call(this))}this.Hi.buffered=e,this.Hi.lastCurrentTime=this.lt.currentTime}}function g(e){var i=this;if(i.Ct.info("[%s] Loading Phenix Live stream player stalled caused by [%s] event.",i.Xi,e.type),0!==i.Hi.time&&!i.lt.paused){var n=i.lt.currentTime;setTimeout(function(){t.now()-i.Hi.time>y.call(i)&&i.ao&&i.stop("ended")},y.call(i)),setTimeout(function(){i.lt&&i.lt.currentTime===n&&!i.lt.paused&&p.call(i)&&(i.Ct.warn("Reloading stream after being stalled for [%s] seconds",h/1e3),m.call(i))},h)}}function y(){return 1.5*this.Hi.averageLength<2e3?2e3:1.5*this.Hi.averageLength}function w(){this.Ct.info("[%s] Phenix live stream player ended.",this.Xi)}return d.isSupported=function(){return o.isSupported},d.prototype.on=function(t,e){return this.vr.listen(t,e)},d.prototype.start=function(e){var n,r,s,a=(r=(n=this.Ct).getAppenders(),s=new i.Logger,t.forEach(r,function(t){t instanceof i.ConsoleAppender&&(t=new i.ConsoleAppender).setThreshold(i.level.INFO),s.addAppender(t)}),s.setUserId(n.getUserId()),s.setEnvironment(n.getEnvironment()),s.setApplicationVersion(n.getApplicationVersion()),s.setObservableSessionId(n.getObservableSessionId()),s);return this.ho=a,this.lt=e,this.v.add(this.dr.recordTimeToFirstFrame(e)),this.v.add(this.dr.recordRebuffering(e)),this.v.add(this.dr.recordVideoResolutionChanges(this,e)),this.v.add(this.dr.recordVideoPlayingAndPausing(e)),function(){var e=t.assign({bandwidthToStartAt:3e6},this.h);t.includes(this.co,".mpd")&&this.h.isDrmProtectedContent&&(e.drm={"com.widevine.alpha":{serverCertificateUrl:this.h.widevineServiceCertificateUrl,mediaKeySystemConfiguration:{persistentState:"required"}},"com.microsoft.playready":{licenseServerUrl:this.h.playreadyLicenseUrl}});var i=new o.WebPlayer(this.ho,this.lt,e);t.now()-this.h.originStartTime<6e3&&this.h.isDrmProtectedContent&&t.includes(this.co,".m3u8")?setTimeout(t.bind(i.start,i,this.co),6e3):i.start(this.co),this.ci=i,t.addEventListener(this.ci,"error",t.bind(l,this))}.call(this),!1===this.h.receiveAudio&&(e.muted=!0),t.addEventListener(e,"stalled",this.Vi,!1),t.addEventListener(e,"pause",this.Vi,!1),t.addEventListener(e,"suspend",this.Vi,!1),t.addEventListener(e,"progress",this.Gi,!1),t.addEventListener(e,"ended",this.Ki,!1),this.pr.start(this,e),e},d.prototype.stop=function(e,i){var n=this;if(!n.fo){if(i)return n.ao=!0;if(this.pr.stop(),this.v.dispose(),this.ci){var r=function(){n.lt&&(t.removeEventListener(n.lt,"stalled",n.Vi,!1),t.removeEventListener(n.lt,"pause",n.Vi,!1),t.removeEventListener(n.lt,"suspend",n.Vi,!1),t.removeEventListener(n.lt,"progress",n.Gi,!1),t.removeEventListener(n.lt,"ended",n.Ki,!1),"Edge"===a.browser&&(n.lt.src="")),n.vr.fire(c.rendererEvents.ended.name,[""]),n.ci=null,n.lt=null};n.fo=!0;try{n.ci.dispose(),n.Ct.info("[%s] Phenix live stream has been destroyed",n.Xi),r()}catch(t){n.Ct.error("[%s] Error while destroying Phenix live stream player [%s]",n.Xi,t.code,t),r(),n.vr.fire(c.rendererEvents.error.name,["phenix-player",t])}}}},d.prototype.getStats=function(){if(!this.ci)return{width:0,height:0,currentTime:0,lag:0,networkState:c.networkStates.networkNoSource.id};var e=this.ci.getStats(),i=e.currentTime||this.lt.currentTime,n=(t.now()-this.h.originStartTime)/1e3;return e.isNative&&"Hls"===e.deliveryType&&(e.currentTime=n-e.lag),e.isNative||(e.lag=Math.max(0,n-i)),e.estimatedBandwidth>0?e.networkState=c.networkStates.networkLoading.id:e.playTime>0?e.networkState=c.networkStates.networkIdle.id:e.video?e.networkState=c.networkStates.networkEmpty.id:e.networkState=c.networkStates.networkNoSource.id,e},d.prototype.setDataQualityChangedCallback=function(t){e.It(t,"callback"),this.dataQualityChangedCallback=t},d.prototype.getPlayer=function(){return this.ci},d.prototype.addVideoDisplayDimensionsChangedCallback=function(t,e){return this.pr.addVideoDisplayDimensionsChangedCallback(t,e)},d}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(5),i(6),i(2),i(3),i(9),i(7)],void 0===(r=function(t,e,i,n,r,s,o,a){"use strict";var u=null;function c(e,n,s,a,u,c){this.Ct=c,this.Xi=e,this.co=encodeURI(n).replace(/[#]/g,"%23"),this.dr=s,this.h=a,this.At=null,this.lt=null,this.pr=new o(c),this.Hi={time:0,buffered:null,averageLength:0,count:0},this.vr=new i.NamedEvents,this.v=new r.DisposableList,this.lr=u,this.Vi=t.bind(f,this),this.Gi=t.bind(h,this),this.Ki=t.bind(l,this)}function h(){if(this.Hi.time=t.now(),0===this.lt.buffered.length)return this.Ct.debug("[%s] Shaka live stream player progress event fired without any buffered content",this.Xi);var e=this.lt.buffered.end(this.lt.buffered.length-1);if(this.Hi.buffered!==e){if(null!==this.Hi.buffered){var i=this.Hi.averageLength*this.Hi.count+(e-this.Hi.buffered);this.Hi.count+=1,this.Hi.averageLength=i/this.Hi.count}this.Hi.buffered=e}}function f(){var e=this;e.Ct.info("[%s] Loading Shaka live stream player stream stalled.",e.Xi),0!==e.Hi.time&&setTimeout(function(){t.now()-e.Hi.time>d.call(e)&&e.ao&&e.stop("ended")},d.call(e))}function d(){return 1.5*this.Hi.averageLength<2e3?2e3:1.5*this.Hi.averageLength}function l(){this.Ct.info("[%s] Shaka live stream player ended.",this.Xi)}return c.prototype.on=function(t,e){return this.vr.listen(t,e)},c.prototype.start=function(e){var i=this;i.ci=new this.lr.Player(e),this.v.add(this.dr.recordTimeToFirstFrame(e)),this.v.add(this.dr.recordRebuffering(e)),this.v.add(this.dr.recordVideoResolutionChanges(this,e));var r={abr:{defaultBandwidthEstimate:2e6},manifest:{retryParameters:{timeout:1e4}},streaming:{rebufferingGoal:2,bufferingGoal:10,bufferBehind:30,retryParameters:{timeout:1e4,maxAttempts:10,backoffFactor:1.1}}};function o(n){i.ci.configure(n),!1===i.h.receiveAudio&&(e.muted=!0),t.addEventListener(i.ci,"error",function(t){i.vr.fire(a.rendererEvents.error.name,["player",t])}),t.addEventListener(e,"stalled",i.Vi,!1),t.addEventListener(e,"pause",i.Vi,!1),t.addEventListener(e,"suspend",i.Vi,!1),t.addEventListener(e,"progress",i.Gi,!1),t.addEventListener(e,"ended",i.Ki,!1),i.ci.load(i.co).then(function(){i.Ct.info("[%s] DASH live stream has been loaded",i.Xi),t.It(e.play)&&e.play()}).catch(function(t){i.Ct.error("[%s] Error while loading DASH live stream [%s]",i.Xi,t.code,t),i.vr.fire(a.rendererEvents.error.name,["shaka",t])}),i.pr.start(this,e),i.lt=e}return this.h.isDrmProtectedContent?(function(){var e;if(!t.It(Uint8Array))throw e="Uint8Array support required for DRM",this.Ct.error(e),new Error(e);if(!t.It(s.global.atob))throw e="rtc.global.atob support required for DRM",this.Ct.error(e),new Error(e)}.call(i),function(t){var e=this;t.getNetworkingEngine().registerResponseFilter(function(i,n){if(i.toString()===e.lr.net.NetworkingEngine.RequestType.LICENSE.toString()){var r=new Uint8Array(n.data),o=String.fromCharCode.apply(null,r),a=JSON.parse(o),u=a.license,c=s.global.atob(u);n.data=new Uint8Array(c.length);for(var h=0;h<c.length;++h)n.data[h]=c.charCodeAt(h);a.trackRestrictions&&t.configure({restrictions:a.trackRestrictions})}})}.call(i,i.ci),function(t,e,i){t.drm||(t.drm={}),t.drm.advanced||(t.drm.advanced={}),t.manifest||(t.manifest={}),t.manifest.dash||(t.manifest.dash={}),function(t,e,i){function r(e,n){e?i(e):(u=n.data,t.drm.advanced["com.widevine.alpha"]={serverCertificate:function(t){for(var e=t.length,i=new Uint8Array(e),n=0;n<e;n++)i[n]=t.charCodeAt(n);return i}(n.data),persistentStateRequired:!0,distinctiveIdentifierRequired:!1},i(null,t))}t.manifest.dash.customScheme=function(t){if("com.phenixrts.widevine"===t.getAttribute("schemeIdUri")||"com.phenixp2p.widevine"===t.getAttribute("schemeIdUri"))return[{keySystem:"com.widevine.alpha",licenseServerUri:decodeURIComponent(t.getAttribute("widevineLicenseServerUrl"))}]},u?r(null,u):n.get(e.widevineServiceCertificateUrl,{mimeType:"text/plain; charset=x-user-defined"},r)}.call(this,t,e,i)}.call(i,r,i.h,function(t,e){if(t)throw i.Ct.error("Failed to add DRM configuration to shaka player",t),t;o(e)})):o(r),e},c.prototype.stop=function(e,i){var n=this;if(!n.fo){if(i)return n.ao=!0;if(this.pr.stop(),this.v.dispose(),this.ci){var r=function(){n.lt&&(t.removeEventListener(n.lt,"stalled",n.Vi,!1),t.removeEventListener(n.lt,"pause",n.Vi,!1),t.removeEventListener(n.lt,"suspend",n.Vi,!1),t.removeEventListener(n.lt,"progress",n.Gi,!1),t.removeEventListener(n.lt,"ended",n.Ki,!1),"Edge"===s.browser&&(n.lt.src="")),n.vr.fire(a.rendererEvents.ended.name,[""]),n.ci=null,n.lt=null};n.ci.destroy().then(function(){n.Ct.info("[%s] Shaka live stream player has been destroyed",n.Xi)}).then(function(){r()}).catch(function(t){n.Ct.error("[%s] Error while destroying shaka live stream player [%s]",n.Xi,t.code,t),r(),n.vr.fire(a.rendererEvents.error.name,["shaka",t])}),n.fo=!0}}},c.prototype.getStats=function(){if(!this.ci)return{width:0,height:0,currentTime:0,lag:0,networkState:a.networkStates.networkNoSource.id};var e=t.assign(this.ci.getStats(),{currentTime:0,lag:0}),i=t.get(this.lt,["currentTime"],0),n=(t.now()-this.h.originStartTime)/1e3,r=Math.max(0,n-i);return this.lt&&(e.currentTime=i,e.lag=r),e.estimatedBandwidth>0?e.networkState=a.networkStates.networkLoading.id:e.playTime>0?e.networkState=a.networkStates.networkIdle.id:e.video?e.networkState=a.networkStates.networkEmpty.id:e.networkState=a.networkStates.networkNoSource.id,e},c.prototype.setDataQualityChangedCallback=function(t){e.It(t,"callback"),this.dataQualityChangedCallback=t},c.prototype.getPlayer=function(){return this.ci},c.prototype.addVideoDisplayDimensionsChangedCallback=function(t,e){return this.pr.addVideoDisplayDimensionsChangedCallback(t,e)},c}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(7)],void 0===(r=function(t,e,i){"use strict";function n(t,n,r){e.qt(t,"type"),e.Rt(n,"stream"),e.Rt(r,"logger"),this.Bt=t,this.e=n,this.Ct=r,this.do=null;var s=this;this.e.on(i.streamEvents.playerEnded.name,function(t){if(s.Ct.info("[%s] [%s] player ended.",s.e.getStreamId(),s.Bt),s.lo=!0,s.do)return s.do();s.streamEndedCallback(function(e){switch(t){case"":case"none":case"ended":return"ended";case"server-error":case"session-error":case"not-ready":case"error":case"died":return"failed";case"censored":return"censored";case"maintenance":return"maintenance";case"capacity":return"capacity";case"app-background":return"app-background";default:return"custom"}}(),t)})}return n.prototype.on=function(t,e){return this.e.on(t,e)},n.prototype.streamErrorCallback=function(e,i){t.It(this.e.streamErrorCallback)?(this.Ct.debug("[%s] [%s] live stream error event [%s]",this.e.getStreamId(),this.Bt,i),this.e.streamErrorCallback(this.e,e,i)):this.Ct.error("[%s] [%s] live stream error event [%s]",this.e.getStreamId(),this.Bt,i)},n.prototype.streamEndedCallback=function(e,i,n){var r=this.e.getRenderer();if(!this.mo){if(n&&!this.do&&this.e.isActive()&&r&&!this.lo)return this.do=t.bind(this.streamEndedCallback,this,e,i),this.Ct.info("[%s] [%s] stream ended. Waiting for end of player.",this.e.getStreamId(),this.Bt),void(r&&r.stop(i,n));this.mo=!0,t.It(this.e.streamEndedCallback)&&this.e.streamEndedCallback(this.e,e,i),this.e.stop(i),r&&r.stop(i,n)}},n.prototype.dataQualityChangedCallback=function(e,i){var n=this.e.getRenderer();n&&t.It(n.dataQualityChangedCallback)&&n.dataQualityChangedCallback(n,e,i)},n.prototype.getPhenixMediaStream=function(){return this.e},n}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(5),i(2),i(3)],void 0===(r=function(t,e,i,n,r){function s(t){if(e.Rt(t,"logger"),this.Ct=t,this.vr=new i.NamedEvents,this.v=new n.DisposableList,this.v.add(this.vr),!this.isSupported())return this.Ct.info("Network monitor is not supported.");this.po=o.call(this),function(){var t=this;navigator.connection.addEventListener("change",function(){t.vr.fireAsync("NetworkChange",[o.call(t),t.po]),t.po=o.call(t)})}.call(this)}function o(){return{downlinkThroughputCapacity:this.getDownlinkThroughputCapacity(),effectiveType:this.getEffectiveType(),rtt:this.getRoundTripTime()}}return s.prototype.isSupported=function(){return r.global.navigator&&r.global.navigator.connection},s.prototype.getDownlinkThroughputCapacity=function(){return this.isSupported()?r.global.navigator.connection.downlink||r.global.navigator.connection.downlinkMax:-1},s.prototype.getEffectiveType=function(){return this.isSupported()?r.global.navigator.connection.effectiveType||r.global.navigator.connection.type:"Unknown"},s.prototype.getRoundTripTime=function(){return this.isSupported()?r.global.navigator.connection.rtt||r.global.navigator.connection.type:-1},s.prototype.onNetworkChange=function(t){if(this.isSupported())return e.It(t,"callback"),this.vr.listen("NetworkChange",t)},s.prototype.dispose=function(){this.v.dispose()},s}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(5),i(2)],void 0===(r=function(t,e,i,n){"use strict";var r=3e3;function s(){this.vr=new i.NamedEvents,this.vo=t.now(),this.v=new n.DisposableList,this.go=!0,this.v.add(this.vr),function(){if(o())return function(){if(o()){var t=this;chrome.extension.onRequest.addListener(function(e,i,n){"is_selected"===e&&chrome.tabs.getSelected(null,function(e){var r=e.id===i.tab.id;a.call(t,r),n(!!r)})})}}.call(this);(function(){var e,i,s=this;function o(){var t=!document[e];a.call(s,t)}"object"==typeof document&&(void 0!==document.msHidden?(e="msHidden",i="msvisibilitychange"):void 0!==document.webkitHidden?(e="webkitHidden",i="webkitvisibilitychange"):void 0!==document.hidden&&(e="hidden",i="visibilitychange"),void 0!==document.addEventListener&&void 0!==document[e]?(t.addEventListener(document,i,o,!1),s.v.add(new n.Disposable(function(){t.removeEventListener(document,i,o,!1)}))):function(){var e=this;e.yo=setInterval(function(){var t=document.hasFocus();a.call(e,t)},r),e.v.add(new n.Disposable(function(){t.ee(e.yo)&&clearInterval(e.yo),e.yo=null}))}.call(s))}).call(this)}.call(this)}function o(){return"undefined"!=typeof chrome&&chrome.extension&&chrome.extension.onRequest}function a(t){if(e.Sn(t,"isForeground"),this.go!==t)return t?(this.go=!0,u.call(this,"foreground")):(this.go=!1,u.call(this,"background"))}function u(e){var i=t.now(),n=i-this.vo;this.vo=i,this.vr.fire(e,[n])}return s.prototype.isForeground=function(){return this.go},s.prototype.getTimeSinceLastChange=function(){return t.now()-this.vo},s.prototype.onForeground=function(t){return e.It(t,"callback"),this.vr.listen("foreground",t)},s.prototype.onBackground=function(t){return e.It(t,"callback"),this.vr.listen("background",t)},s}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(2),i(35),i(66),i(3)],void 0===(r=function(t,e,i,n,r,s){"use strict";var o=s.global.__phenixPageLoadTime||s.global.__pageLoadTime||t.now(),a="production",u="2018-09-17T15:08:57Z";function c(e,s){this.wo=a,this.kt=u,this.Hn=null,this.bo={resource:"session",kind:"event"},this.Ct=e,this.Jr=s,this.ko=new r(this.Ct),this.So=t.now(),this.v=new i.DisposableList,this.Eo=[],this.v.add(n.onBackground(t.bind(h,this,!1))),this.v.add(n.onForeground(t.bind(h,this,!0))),this.ko.isSupported()&&(this.v.add(this.ko.onNetworkChange(t.bind(m,this))),this.v.add(this.ko),f.call(this),l.call(this),d.call(this))}function h(t,e){var i=t?"ApplicationForeground":"ApplicationBackground";this.recordMetric(i,{uint64:e}),p.call(this,"Application has gone into the [%s] after [%s] ms",t?"foreground":"background",e)}function f(){var t=this.ko.getEffectiveType();this.recordMetric("NetworkType",{string:t},null,{resource:s.browser}),p.call(this,"[%s] has started with Network effective type of [%s]",this.Hn?"Session":"Application",t)}function d(e,i){var n=e||this.ko.getRoundTripTime(),r=i||-1;if(this.recordMetric("RoundTripTime",{uint32:n},{uint32:r},{resource:s.browser}),t.isNullOrUndefined(i))return p.call(this,"Network RTT [%s]",n);p.call(this,"Network RTT changed to [%s] from [%s]",n,r)}function l(e,i){var n=e||this.ko.getDownlinkThroughputCapacity(),r=i||-1;if(this.recordMetric("DownlinkThroughputCapacity",{float:n},{float:r},{resource:s.browser}),t.isNullOrUndefined(i))return p.call(this,"Network downlink throughput capacity [%s]",n);p.call(this,"Network downlink throughput capacity changed to [%s] from [%s]",n,r)}function m(t,e){e.downlinkThroughputCapacity!==t.downlinkThroughputCapacity&&l.call(this,t.downlinkThroughputCapacity,e.downlinkThroughputCapacity),e.rtt!==t.rtt&&d.call(this,t.rtt,e.rtt),e.effectiveType!==t.effectiveType&&function(t,e){var i=t||this.ko.getEffectiveType(),n=e;this.recordMetric("NetworkType",{string:i},{string:n},{resource:s.browser}),p.call(this,"Network effective type has changed to [%s] from [%s]",i,n||"New")}.call(this,t.effectiveType,e.effectiveType)}function p(){var e=Array.prototype.slice.call(arguments);if(0===e.length)throw new Error("Invalid logging arguments.");var i="[%s] [SessionTelemetry] [%s] "+e[0],n=e.slice(1),r=[i,this.Hn,t.now()-this.So].concat(n);this.Ct.info.apply(this.Ct,r)}function v(){return(t.now()-o)/1e3}function g(i,n){if(e.qt(i.metric,"record.metric"),!this.Hn)return this.Eo.push({record:i,since:n});var r=t.assign({},this.bo,i);this.Jr.submitMetric(i.metric,n,this.Hn,null,this.wo,this.kt,r)}return c.prototype.setSessionId=function(t){!t&&this.Hn&&g.call(this,{metric:"Stopped",elapsed:this.elapsed()},v()),this.Hn=t,t&&(g.call(this,{metric:"Initialized",elapsed:this.elapsed()},v()),function(){if(this.Hn)for(var t=this.Eo.length;t>0;){var e=this.Eo.splice(t-1,1);1===e.length&&g.call(this,e[0].record,e[0].since),t--}}.call(this),function(){var t=n.isForeground(),e=n.getTimeSinceLastChange(),i=t?"ApplicationForeground":"ApplicationBackground";this.recordMetric(i,{uint64:e}),p.call(this,"Session has started in the [%s] after [%s] ms",t?"foreground":"background",e)}.call(this),this.ko.isSupported()&&(f.call(this),l.call(this),d.call(this)))},c.prototype.setProperty=function(t,i){e.qt(t,"name"),e.qt(i,"value"),this.bo[t]=i},c.prototype.recordMetric=function(i,n,r,s){e.qt(i,"metric");var o=t.assign({},{metric:i,elapsed:this.elapsed(),value:n,previousValue:r},s||{});g.call(this,o,v())},c.prototype.elapsed=function(){return t.now()-this.So},c.prototype.dispose=function(){this.v.dispose(),this.recordMetric("Stopped"),p.call(this,"Session telemetry stopped")},c}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(2),i(3)],void 0===(r=function(t,e,i,n){"use strict";var r=n.global.__phenixPageLoadTime||n.global.__pageLoadTime||t.now(),s="production",o="2018-09-17T15:08:57Z";function a(n,r,a){e.qt(n,"sessionId"),this.wo=s,this.kt=o,this.Hn=n,this.bo={},this.Ct=r,this.Jr=a,this.So=t.now(),this.v=new i.DisposableList,this.To=[],this.Io=[],this.Ro=[],this.Co=null,u.call(this,"Stream initializing")}function u(){var e=Array.prototype.slice.call(arguments);if(0===e.length)throw new Error("Invalid logging arguments.");var i="[%s] [StreamTelemetry] [%s] "+e[0],n=e.slice(1),r=[i,this.Xi,t.now()-this.So].concat(n);this.Ct.debug.apply(this.Ct,r)}function c(){return(t.now()-r)/1e3}function h(i,n){e.qt(i.metric,"record.metric");var r=t.assign({},this.bo,i);this.Jr.submitMetric(i.metric,n,this.Hn,this.Xi,this.wo,this.kt,r)}return a.prototype.setProperty=function(t,i){e.qt(t,"name"),e.qt(i,"value"),this.bo[t]=i},a.prototype.recordMetric=function(i,n,r,s){e.qt(i,"metric");var o=t.assign({},{metric:i,elapsed:this.elapsed(),value:n,previousValue:r},s||{});h.call(this,o,c())},a.prototype.setStreamId=function(i){if(e.qt(i,"streamId"),this.Xi)throw new Error("Stream ID can only be set once.");this.Xi=i;var n=t.now();h.call(this,{metric:"Initialized",elapsed:this.elapsed()-n+this.So},c()-(n-this.So)/1e3)},a.prototype.setStartOffset=function(t){if(e.ee(t,"startOffset"),this.Mo)throw new Error("Start offset can only be set once.");this.Mo=t,this.recordMetric("Offset",{uint64:t})},a.prototype.getStartOffset=function(){return this.Mo},a.prototype.elapsed=function(){return t.now()-this.So},a.prototype.stop=function(){this.v.dispose(),this.recordMetric("Stopped"),u.call(this,"Stream stopped")},a.prototype.recordTimeToFirstFrame=function(e){var n=this,r=t.now(),s=function(){n.Co||(n.Co=t.now()-r,n.recordMetric("TimeToFirstFrame",{uint64:n.Co}),u.call(n,"First frame [%s]",n.Co),o.dispose())};t.addEventListener(e,"loadeddata",s),t.addEventListener(e,"loadedmetadata",s);var o=new i.Disposable(function(){t.removeEventListener(e,"loadeddata",s),t.removeEventListener(e,"loadedmetadata",s)});return this.v.add(o),o},a.prototype.recordVideoResolutionChanges=function(e,n){var r=this,s={width:n.videoWidth,height:n.videoHeight};if(t.find(this.To,function(t){return t===n}))return new i.Disposable(t.noop);this.To.push(n);var o=e.addVideoDisplayDimensionsChangedCallback(function(t,e){s.width===e.width&&s.height===e.height||(r.recordMetric("ResolutionChanged",{string:e.width+"x"+e.height},{string:s.width+"x"+s.height}),s={width:e.width,height:e.height},u.call(r,"Resolution changed: width [%s] height [%s]",e.width,e.height))});return this.v.add(o),o},a.prototype.recordRebuffering=function(e){var r,s,o=this;if(t.find(this.Io,function(t){return t===e}))return new i.Disposable(t.noop);this.Io.push(e);var a=function(){r||(o.recordMetric("Stalled"),r=t.now(),u.call(o,"[buffering] Stream has stalled"))},c=function(i){var a=e.buffered.length,c=!("playing"===i.type||a>0)||("progress"===i.type||"timeupdate"===i.type)&&e.buffered.end(a-1)===s;if(r&&(a||"Edge"===n.browser)&&!c){"progress"===i.type&&(s=e.buffered.end(a-1));var h=t.now()-r;o.recordMetric("Buffering",{uint64:h}),u.call(o,"[buffering] Stream has recovered from stall after [%s] milliseconds",h),r=null}};t.addEventListener(e,"stalled",a),t.addEventListener(e,"pause",a),t.addEventListener(e,"suspend",a),t.addEventListener(e,"play",c),t.addEventListener(e,"playing",c),t.addEventListener(e,"progress",c),t.addEventListener(e,"timeupdate",c);var h=new i.Disposable(function(){t.removeEventListener(e,"stalled",a),t.removeEventListener(e,"pause",a),t.removeEventListener(e,"suspend",a),t.removeEventListener(e,"play",c),t.removeEventListener(e,"playing",c),t.removeEventListener(e,"progress",c),t.removeEventListener(e,"timeupdate",c)});return this.v.add(h),h},a.prototype.recordVideoPlayingAndPausing=function(e){var n=this;if(t.find(this.Ro,function(t){return t===e}))return new i.Disposable(t.noop);this.Ro.push(e);var r=function(){e.paused?n.recordMetric("Playing",{boolean:!1}):n.recordMetric("Playing",{boolean:!0})};t.addEventListener(e,"pause",r),t.addEventListener(e,"playing",r);var s=new i.Disposable(function(){t.removeEventListener(e,"pause",r),t.removeEventListener(e,"playing",r)});return this.v.add(s),s},a}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(18),i(3),i(39)],void 0===(r=function(t,e,i,n,r){function s(s){e.Xt(s,"uri"),this.Po="/telemetry/metrics",this.xo="object"==typeof location?location.hostname:n.browser+"-"+n.browserVersion+"-unknown",this.Do=!0,this.Oo=(n.browser||"Browser")+"/"+(n.browserVersion||"?"),this.Ao=new i.BatchHttpProto(s+this.Po,[r],"telemetry.SubmitMetricRecords",{maxAttempts:3,maxBufferedRecords:1e3,maxBatchSize:512}),this.Ao.on("capacity",t.bind(o,this))}function o(e){this.Ao.addRecordToBeginning({metric:"MetricDropped",value:{uint64:e},timestamp:t.isoString(),sessionId:this.qo,streamId:this.Uo,source:this.Oo,fullQualifiedName:this.xo,environment:this.Fo,version:this.No,runtime:this.jo})}return s.prototype.isEnabled=function(){return this.Do},s.prototype.setEnabled=function(t){e.Sn(t,"enabled"),this.Do=t},s.prototype.submitMetric=function(i,n,r,s,o,a,u){this.Do&&(e.qt(i,"metric"),e.Rt(u,"value"),this.jo=n,this.qo=r,this.Uo=s,this.Fo=o,this.No=a,function(e,i){var n=t.assign({},i,{metric:e,timestamp:t.isoString(),sessionId:this.qo,streamId:this.Uo,source:this.Oo,fullQualifiedName:this.xo,environment:this.Fo,version:this.No,runtime:this.jo});this.Ao.addRecord(n)}.call(this,i,u))},s}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(19),i(70)],void 0===(r=function(t,e,i,n){var r={urls:{local:"",staging:"https://telemetry-stg.phenixrts.com",production:"https://telemetry.phenixrts.com"}};function s(){this.Lo={}}return s.prototype.createMetricsTransmitter=function(t){var e=i.parseEnvFromPcastBaseUri(t||""),s=r.urls[e];return this.Lo[e]||(this.Lo[e]=function(t){var e=new n(t);return t||e.setEnabled(!1),e}.call(this,s)),this.Lo[e]},new s}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(3)],void 0===(r=function(t,e,i){"use strict";var n=2e3;function r(t,i,n){e.Rt(t,"logger"),e.Rt(i,"screenShareExtensionManager"),n&&e.It(n,"onScreenShare"),this.Ct=t,this.Kr=i,this.zn=n}function s(r,s,a){var u=this,c=function(t){a(o(t),void 0,t)},h=function(r){(function(r){var s={},o={},a=this;setTimeout(function u(){(function(i){return t.reduce(i.getTracks(),function(t,i){return t&&function(t){return e.Oe(t,"track"),"ended"===t.readyState}(i)},!0)})(r)||(t.forEach(r.getTracks(),function(e){if(i.global.Event&&t.hasIndexOrKey(s,e.id)&&s[e.id]!==e.enabled){var n=new i.global.Event("trackenabledchange");n.data=e,e.dispatchEvent(n),a.Ct.info("[%s] Detected track [%s] enabled change to [%s]",r.id,e.id,e.enabled)}if(i.global.Event&&t.hasIndexOrKey(o,e.id)&&o[e.id]!==e.readyState){var u=new i.global.Event("readystatechange");u.data=e,e.dispatchEvent(u),a.Ct.info("[%s] Detected track [%s] Ready State change to [%s]",r.id,e.id,e.readyState)}s[e.id]=e.enabled,o[e.id]=e.readyState}),setTimeout(u,n))},n)}).call(u,r),s("ok",r)};return function(t,e){var i=this;if(t.screen)return i.Kr.isScreenSharingEnabled(function(n){return n?i.Kr.getScreenSharingConstraints(t,e):i.Kr.installExtension(function(n,r){return n||r&&"ok"!==r.status?e(n,r):i.Kr.getScreenSharingConstraints(t,e)})});var n={audio:t.audio||!1,video:t.video||!1};e(null,{status:"ok",constraints:n})}.call(this,r,function(e,n){if("ok"!==t.get(n,["status"]))return c(e);if("cancelled"!==n.status){var s=n.constraints;if(u.zn&&(r.screen||r.screenAudio)&&"Chrome"===i.browser&&!(s=u.zn(s)))throw new Error("onScreenShare must return an object of user media constraints");try{i.getUserMedia(s,h,c)}catch(t){c(t)}}else a("cancelled",null)})}r.prototype.getUserMedia=function(i,n){e.Rt(i,"options"),e.It(n,"callback"),function(e,i){var n=this,r=function(t,e){n.ls&&n.ls.push(e),i(n,t,e)},o=function(t,r,s){e.screenAudio&&n.Ct.warn("Screen capture with audio is only supported on Windows or Chrome OS."),i(n,t,r,s)},a=e.screen||e.screenAudio,u=e.video||e.audio;return a&&u?s.call(n,{screen:e.screen},function(i,a){return s.call(n,{audio:e.audio,video:e.video},function(e,i){!function(e,i){e&&t.It(e.addTrack)&&t.forEach(i,function(t){e.addTrack(t)})}(i,a.getTracks()),r(e,i)},function(e,i,n){!function(e){if(e&&t.It(e.stop)&&e.stop(),e&&t.It(e.getTracks))for(var i=e.getTracks(),n=0;n<i.length;n++){i[n].stop()}}(a),o(e,i,n)})},o):s.call(n,e,r,o)}.call(this,i,n)};var o=function(t){return"unavailable"===t.code?"conflict":"permission-denied"===t.message?"permission-denied":"PermissionDeniedError"===t.name?"permission-denied":"InternalError"===t.name&&"Starting video failed"===t.message?"conflict":"SourceUnavailableError"===t.name?"conflict":"SecurityError"===t.name&&"The operation is insecure."===t.message?"permission-denied":"failed"};return r}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(4),i(3)],void 0===(r=function(t,e,i,n){"use strict";var r="icngjadgidcmifnehjcielbmiapkhjpn",s=t.freeze({url:"https://addons.mozilla.org/firefox/downloads/file/474686/pcast_screen_sharing-1.0.3-an+fx.xpi",iconUrl:"https://phenixp2p.com/public/images/phenix-logo-unicolor-64x64.png",hash:"sha256:4972e9718ea7f7c896abc12d1a9e664d5f3efe498539b082ab7694f9d7af4f3b"}),o=100,a=450,u=52;function c(o,a){o=o||{},e.Rt(o,"options"),e.Rt(a,"logger"),this.Ct=a,this.Bo=o.screenSharingExtensionId||function(){switch(n.browser){case"Chrome":return r;case"Firefox":default:return""}}(),this._o=o.screenSharingAddOn||s,this.Wo=!1,this.zo=new i.Observable(!1),"Chrome"===n.browser&&this.Bo&&function(){var t=l.call(this);if("object"==typeof document){for(var e=document.getElementsByTagName("link"),i=0;i<e.length;i++)if(e[i].href===t)return;this.Ct.debug("Adding Chrome Web Store link [%s]",t);var n=document.createElement("link");n.rel="chrome-webstore-item",n.href=t,document.getElementsByTagName("head")[0].appendChild(n)}}.call(this),f.call(this,t.bind(h,this))}function h(t){this.zo.setValue(!0),this.Wo=t}function f(e){var i=this;if("Chrome"===n.browser&&i.Bo){var r=v.call(this);if(!r)return e(!1);try{r.sendMessage(i.Bo,{type:"version"},function(t){t&&"ok"===t.status?(i.Ct.info("Screen sharing enabled using version [%s]",t.version),e(!0)):(i.Ct.info("Screen sharing NOT available"),e(!1))})}catch(t){t.message&&i.Ct.warn(t.message,t),e(!1)}}else"Firefox"===n.browser&&n.browserVersion>=u?e(!0):"Firefox"===n.browser&&t.Rt(n.global.PCastScreenSharing)?e(!0):e(!1)}function d(t){if(this.zo.getValue())return t();var e=this.zo.subscribe(function(){return e.dispose(),t()})}function l(){return"https://chrome.google.com/webstore/detail/"+this.Bo}function m(e,i){switch(n.browser){case"Chrome":return function(t){var e=this,i=v.call(this);if(!i)return t(new Error("not-available"));try{i.sendMessage(e.Bo,{type:"get-desktop-media",sources:["screen","window","tab","audio"]},function(i){return!i?f.call(e,function(i){return h.call(e,i),t(new Error("extension-failure"))}):"ok"!==i.status?t(new Error(i.status),i):void t(null,i)})}catch(i){i.message&&e.Ct.warn(i.message),t(i,{status:"failed"})}}.call(this,function(n,r){if(n||r&&"ok"!==r.status)return i(n,r);r.data||r.options||(r.options={canRequestAudioTrack:!0}),r.data&&t.hasIndexOrKey(r.data,"hasAudio")&&!r.options&&(r.options={canRequestAudioTrack:r.data.hasAudio}),i(null,{status:"ok",constraints:function(e,i,n){var r={};return t.Rt(e)&&t.Rt(e.screen)&&(r.video=e.screen),t.Rt(e)&&t.Rt(e.screenAudio)&&n.canRequestAudioTrack&&(r.audio=e.screenAudio),e.screen&&t.set(r,["video","mandatory"],{chromeMediaSource:"desktop",chromeMediaSourceId:i}),e.screenAudio&&n.canRequestAudioTrack&&t.set(r,["audio","mandatory"],{chromeMediaSource:"system",chromeMediaSourceId:i}),r}(e,r.streamId,r.options)})});case"Firefox":i(null,{status:"ok",constraints:function(e,i){var n={video:{}};return t.Rt(e)&&t.Rt(e.screen)&&(n.video=e.screen),n.video.mediaSource=n.video.mediaSource||"window",n}(e)});break;default:i(new Error("not-supported"),{status:"not-supported"})}}function p(e){var i=this;if(!i.Wo){var r=function(t,n){return"cancelled"===n?e(null,{status:"cancelled"}):"ok"!==n?e(new Error("screen-sharing-installation-failed"),{status:n}):void f.call(i,function(t){if(i.Wo=t,!i.Wo)return e(new Error("screen-sharing-installation-failed"),{status:n});e(null,{status:"ok"})})};switch(n.browser){case"Chrome":(function(t){var e=this,i=l.call(this);try{chrome.webstore.install(i,function(){return t(null,"ok")},function(i){if(i){if(i.match(/cancelled/gi))return e.Ct.info("User cancelled screen sharing"),t(new Error(i),"cancelled");e.Ct.warn(i)}return t(new Error(i||"failed"),"failed")})}catch(i){i.message&&e.Ct.warn(i.message),t(i,"failed")}}).call(i,r);break;case"Firefox":(function(e){try{var i,r={"PCast Screen Sharing":{URL:this._o.url,IconURL:this._o.iconUrl,Hash:this._o.hash,toString:function(){return this.URL}}},s=a,u=function(){i&&clearInterval(i),e(null,"ok")},c=function(){i&&clearInterval(i),e(new Error("failed"),"failed")};i=setInterval(function(){return t.Rt(n.global.PCastScreenSharing)?u():s--<0?c():void 0},o),InstallTrigger.install(r,function(t,e){0===e?u():c()})}catch(t){t.message&&this.Ct.warn(t.message),e("failed",t)}}).call(i,r);break;default:e(new Error("not-supported"),{status:"not-supported"})}}}function v(){switch(n.browser){case"Chrome":return"undefined"!=typeof chrome&&chrome.runtime&&chrome.runtime.sendMessage?chrome.runtime:(this.Ct.info("Screen sharing NOT available. Runtime not supported"),null);case"Firefox":default:return null}}return c.prototype.isScreenSharingEnabled=function(t){var e=this;return d.call(this,function(){return t(e.Wo)})},c.prototype.installExtension=function(e){return d.call(this,t.bind(p,this,e))},c.prototype.getScreenSharingConstraints=function(e,i){return d.call(this,t.bind(m,this,e,i))},c.prototype.toString=function(){return"ScreenShareExtensionManager["+n.browser+"]"},c}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(6),i(2)],void 0===(r=function(t,e,i,n){"use strict";function r(t,i,r,s){e.Rt(t,"logger"),e.qt(i,"version"),e.It(r,"onClosestEndpointFound"),s&&e.It(s,"onAnEndpointResolved"),this.Ct=t,this.kt=i,this.Vo=r,s&&(this.Ho=s),this.Go=!1,this.Jo=Number.MAX_VALUE,this.Ko="",this.v=new n.DisposableList}return r.prototype.isResolved=function(){return this.Go},r.prototype.dispose=function(){this.v.dispose()},r.prototype.measurementCallback=function(t,e,i){return e<this.Jo&&(this.Ct.info("Current closest end point is [%s] with latency of [%s] ms",i,e),this.Jo=e,this.Ko=i),this.isResolved()},r.prototype.completeCallback=function(t){if(this.Ko&&this.Jo<Number.MAX_VALUE&&!this.isResolved())return this.Go=!0,this.Vo(null,{uri:this.Ko,roundTripTime:this.Jo})},r.prototype.resolveAll=function(t){for(var e=0;e<t.length;e++)this.resolve(t[e],4)},r.prototype.resolve=function(e,n){var r=this,s=1,o=0;!function e(a){var u=t.now();r.Ct.info("[%s] Checking end point [%s]",s,a);var c=i.getWithRetry(a,{timeout:15e3,queryParameters:{version:r.kt,_:t.now()},retryOptions:{maxAttempts:1}},function(i,c){var h=t.now()-u,f=h>30;if(r.Ho&&(i?r.Ho(i):r.Ho(null,{time:h,endPoint:a})),s++,!i){if(r.measurementCallback(a,h,c.data))return;o++}return s<=n&&!r.isResolved()&&(f||i)?(i&&r.Ct.info("Retrying after failure to resolve end point [%s] with [%s]",a,i),e(a)):0===o?r.Ct.warn("Unable to resolve end point [%s] with [%s]",a,i):r.completeCallback(a)});r.v.add(c)}(e)},r}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(74)],void 0===(r=function(t){return t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n;void 0===(n=function(){"use strict";return{package:"chat",options:{optimize_for:"LITE_RUNTIME"},messages:[{name:"Room",fields:[{rule:"optional",type:"string",name:"roomId",id:1},{rule:"optional",type:"string",name:"alias",id:2},{rule:"required",type:"string",name:"name",id:3},{rule:"required",type:"string",name:"description",id:4},{rule:"required",type:"RoomType",name:"type",id:5},{rule:"repeated",type:"string",name:"options",id:6},{rule:"optional",type:"string",name:"bridgeId",id:7},{rule:"optional",type:"string",name:"pin",id:8}]},{name:"Stream",fields:[{rule:"required",type:"StreamType",name:"type",id:1},{rule:"required",type:"string",name:"uri",id:2},{rule:"required",type:"TrackState",name:"audioState",id:3},{rule:"required",type:"TrackState",name:"videoState",id:4}]},{name:"Member",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"screenName",id:2},{rule:"required",type:"MemberRole",name:"role",id:3},{rule:"repeated",type:"Stream",name:"streams",id:4},{rule:"required",type:"MemberState",name:"state",id:5},{rule:"required",type:"uint64",name:"lastUpdate",id:6}]},{name:"MemberUpdate",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"optional",type:"string",name:"screenName",id:2},{rule:"optional",type:"MemberRole",name:"role",id:3},{rule:"required",type:"bool",name:"updateStreams",id:7,options:{default:!1}},{rule:"repeated",type:"Stream",name:"streams",id:4},{rule:"optional",type:"MemberState",name:"state",id:5},{rule:"required",type:"uint64",name:"lastUpdate",id:6}]},{name:"ChatUser",fields:[{rule:"optional",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"screenName",id:2},{rule:"required",type:"MemberRole",name:"role",id:3},{rule:"required",type:"uint64",name:"lastUpdate",id:4}]},{name:"ChatMessage",fields:[{rule:"required",type:"string",name:"messageId",id:1},{rule:"required",type:"uint64",name:"timestamp",id:2},{rule:"required",type:"ChatUser",name:"from",id:3},{rule:"required",type:"string",name:"message",id:4}]},{name:"CreateRoom",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"Room",name:"room",id:2}]},{name:"CreateRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"Room",name:"room",id:2}]},{name:"JoinRoom",fields:[{rule:"optional",type:"string",name:"roomId",id:1},{rule:"optional",type:"string",name:"alias",id:2},{rule:"required",type:"string",name:"sessionId",id:3},{rule:"required",type:"Member",name:"member",id:4},{rule:"repeated",type:"string",name:"options",id:5},{rule:"required",type:"uint64",name:"timestamp",id:6}]},{name:"JoinRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"Room",name:"room",id:2},{rule:"repeated",type:"Member",name:"members",id:3},{rule:"optional",type:"Member",name:"self",id:5},{rule:"repeated",type:"string",name:"options",id:4}]},{name:"UpdateRoom",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"Room",name:"room",id:2},{rule:"required",type:"uint64",name:"timestamp",id:3}]},{name:"UpdateRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"UpdateMember",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"optional",type:"string",name:"roomId",id:5},{rule:"required",type:"MemberUpdate",name:"member",id:2},{rule:"repeated",type:"string",name:"options",id:3},{rule:"required",type:"uint64",name:"timestamp",id:4}]},{name:"UpdateMemberResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"uint64",name:"lastUpdate",id:2}]},{name:"LeaveRoom",fields:[{rule:"required",type:"string",name:"roomId",id:1},{rule:"required",type:"string",name:"sessionId",id:2},{rule:"required",type:"uint64",name:"timestamp",id:3}]},{name:"LeaveRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"DestroyRoom",fields:[{rule:"required",type:"string",name:"roomId",id:1}]},{name:"DestroyRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"GetRoomInfo",fields:[{rule:"optional",type:"string",name:"roomId",id:1},{rule:"optional",type:"string",name:"alias",id:2},{rule:"optional",type:"string",name:"sessionId",id:3},{rule:"optional",type:"string",name:"applicationId",id:4},{rule:"optional",type:"string",name:"secret",id:5},{rule:"repeated",type:"string",name:"options",id:6}]},{name:"GetRoomInfoResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"Room",name:"room",id:2},{rule:"repeated",type:"Member",name:"members",id:3},{rule:"repeated",type:"string",name:"options",id:4}]},{name:"RoomEvent",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"roomId",id:2},{rule:"required",type:"RoomEventType",name:"eventType",id:3},{rule:"repeated",type:"Member",name:"members",id:4},{rule:"optional",type:"Room",name:"room",id:5},{rule:"repeated",type:"string",name:"options",id:6},{rule:"required",type:"uint64",name:"timestamp",id:7}]},{name:"SendMessageToRoom",fields:[{rule:"required",type:"string",name:"roomId",id:1},{rule:"required",type:"ChatMessage",name:"chatMessage",id:2}]},{name:"SendMessageToRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"FetchRoomConversation",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"roomId",id:2},{rule:"optional",type:"string",name:"afterMessageId",id:3},{rule:"optional",type:"string",name:"beforeMessageId",id:4},{rule:"required",type:"uint32",name:"limit",id:5},{rule:"repeated",type:"RoomConversationOption",name:"options",id:6}]},{name:"FetchRoomConversationResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"ChatMessage",name:"chatMessages",id:2}]},{name:"RoomConversationEvent",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"roomId",id:2},{rule:"required",type:"RoomConversationEventType",name:"eventType",id:3},{rule:"repeated",type:"ChatMessage",name:"chatMessages",id:4}]},{name:"RoomBridgeIdle",fields:[{rule:"required",type:"string",name:"roomId",id:1},{rule:"required",type:"string",name:"bridgeId",id:2}]}],enums:[{name:"RoomType",values:[{name:"DirectChat",id:0},{name:"MultiPartyChat",id:1},{name:"ModeratedChat",id:2},{name:"TownHall",id:3},{name:"Channel",id:4}]},{name:"MemberRole",values:[{name:"Participant",id:0},{name:"Moderator",id:1},{name:"Presenter",id:2},{name:"Audience",id:3}]},{name:"MemberState",values:[{name:"Active",id:0},{name:"Passive",id:1},{name:"HandRaised",id:2},{name:"Inactive",id:3},{name:"Offline",id:4}]},{name:"RoomEventType",values:[{name:"MemberJoined",id:0},{name:"MemberLeft",id:1},{name:"MemberUpdated",id:2},{name:"RoomUpdated",id:3},{name:"RoomEnded",id:4}]},{name:"TrackState",values:[{name:"TrackEnabled",id:0},{name:"TrackDisabled",id:1},{name:"TrackEnded",id:2}]},{name:"StreamType",values:[{name:"User",id:0},{name:"Presentation",id:1},{name:"Audio",id:2}]},{name:"RoomConversationOption",values:[{name:"Subscribe",id:0}]},{name:"RoomConversationEventType",values:[{name:"Message",id:0}]}]}}.apply(e,[]))||(t.exports=n)},function(t,e,i){var n;void 0===(n=function(){"use strict";return{package:"pcast",options:{optimize_for:"LITE_RUNTIME"},messages:[{name:"Authenticate",fields:[{rule:"optional",type:"uint32",name:"apiVersion",id:9,options:{default:0}},{rule:"required",type:"string",name:"clientVersion",id:1},{rule:"optional",type:"string",name:"device",id:12},{rule:"required",type:"string",name:"deviceId",id:2},{rule:"optional",type:"string",name:"manufacturer",id:13},{rule:"required",type:"string",name:"platform",id:3},{rule:"required",type:"string",name:"platformVersion",id:4},{rule:"required",type:"string",name:"authenticationToken",id:5},{rule:"optional",type:"string",name:"connectionId",id:6},{rule:"optional",type:"string",name:"connectionRouteKey",id:10},{rule:"optional",type:"string",name:"remoteAddress",id:11},{rule:"optional",type:"string",name:"sessionId",id:7},{rule:"optional",type:"string",name:"applicationId",id:8}]},{name:"AuthenticateResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"sessionId",id:2},{rule:"optional",type:"string",name:"redirect",id:3},{rule:"repeated",type:"string",name:"roles",id:4}]},{name:"Bye",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"reason",id:2}]},{name:"ByeResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"SessionDescription",fields:[{rule:"required",type:"Type",name:"type",id:1,options:{default:"Offer"}},{rule:"required",type:"string",name:"sdp",id:2}],enums:[{name:"Type",values:[{name:"Offer",id:0},{name:"Answer",id:1}]}]},{name:"CreateStream",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"optional",type:"string",name:"originStreamId",id:2},{rule:"repeated",type:"string",name:"originStreamIds",id:10},{rule:"repeated",type:"string",name:"options",id:3},{rule:"optional",type:"string",name:"connectUri",id:8},{rule:"repeated",type:"string",name:"connectOptions",id:9},{rule:"repeated",type:"string",name:"tags",id:4},{rule:"optional",type:"string",name:"userAgent",id:11},{rule:"optional",type:"SetRemoteDescription",name:"setRemoteDescription",id:5},{rule:"optional",type:"CreateOfferDescription",name:"createOfferDescription",id:6},{rule:"optional",type:"CreateAnswerDescription",name:"createAnswerDescription",id:7}]},{name:"IceServer",fields:[{rule:"repeated",type:"string",name:"urls",id:1},{rule:"optional",type:"string",name:"username",id:2},{rule:"optional",type:"string",name:"credential",id:3}]},{name:"RtcConfiguration",fields:[{rule:"optional",type:"BundlePolicy",name:"bundlePolicy",id:1},{rule:"optional",type:"uint32",name:"iceCandidatePoolSize",id:3},{rule:"repeated",type:"IceServer",name:"iceServers",id:4},{rule:"optional",type:"IceTransportPolicy",name:"iceTransportPolicy",id:5},{rule:"optional",type:"string",name:"peerIdentity",id:6},{rule:"optional",type:"RtcpMuxPolicy",name:"rtcpMuxPolicy",id:7}],enums:[{name:"BundlePolicy",values:[{name:"BundlePolicyBalanced",id:1},{name:"BundlePolicyMaxCompat",id:2},{name:"BundlePolicyMaxBundle",id:3}]},{name:"IceTransportPolicy",values:[{name:"IceTransportPolicyAll",id:1},{name:"IceTransportPolicyPublic",id:2},{name:"IceTransportPolicyRelay",id:3}]},{name:"RtcpMuxPolicy",values:[{name:"RtcpMuxPolicyNegotiate",id:1},{name:"RtcpMuxPolicyRequire",id:2}]}]},{name:"CreateStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"streamId",id:2},{rule:"optional",type:"string",name:"instanceRouteKey",id:5},{rule:"repeated",type:"string",name:"streamUris",id:8},{rule:"optional",type:"RtcConfiguration",name:"rtcConfiguration",id:9},{rule:"optional",type:"SetRemoteDescriptionResponse",name:"setRemoteDescriptionResponse",id:3},{rule:"optional",type:"CreateOfferDescriptionResponse",name:"createOfferDescriptionResponse",id:4},{rule:"optional",type:"CreateAnswerDescriptionResponse",name:"createAnswerDescriptionResponse",id:6},{rule:"repeated",type:"string",name:"options",id:7},{rule:"optional",type:"uint64",name:"offset",id:10,options:{default:0}}]},{name:"SetLocalDescription",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"required",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"optional",type:"uint32",name:"apiVersion",id:3,options:{default:0}}]},{name:"SetLocalDescriptionResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"string",name:"options",id:2}]},{name:"SetRemoteDescription",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"required",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"optional",type:"uint32",name:"apiVersion",id:3,options:{default:0}}]},{name:"SetRemoteDescriptionResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"repeated",type:"string",name:"options",id:3}]},{name:"CreateOfferDescription",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"repeated",type:"string",name:"options",id:2},{rule:"optional",type:"uint32",name:"apiVersion",id:3,options:{default:0}}]},{name:"CreateOfferDescriptionResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"repeated",type:"string",name:"options",id:3}]},{name:"CreateAnswerDescription",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"repeated",type:"string",name:"options",id:2},{rule:"optional",type:"uint32",name:"apiVersion",id:3,options:{default:0}}]},{name:"CreateAnswerDescriptionResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"repeated",type:"string",name:"options",id:3}]},{name:"IceCandidate",fields:[{rule:"required",type:"string",name:"candidate",id:1},{rule:"required",type:"uint32",name:"sdpMLineIndex",id:2},{rule:"required",type:"string",name:"sdpMid",id:3}]},{name:"AddIceCandidates",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"repeated",type:"IceCandidate",name:"candidates",id:2},{rule:"repeated",type:"string",name:"options",id:3},{rule:"optional",type:"uint32",name:"apiVersion",id:4,options:{default:0}}]},{name:"AddIceCandidatesResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"string",name:"options",id:2}]},{name:"UpdateStreamState",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"required",type:"string",name:"signalingState",id:2},{rule:"required",type:"string",name:"iceGatheringState",id:3},{rule:"required",type:"string",name:"iceConnectionState",id:4},{rule:"optional",type:"uint32",name:"apiVersion",id:5,options:{default:0}}]},{name:"UpdateStreamStateResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"string",name:"options",id:2}]},{name:"DestroyStream",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"optional",type:"string",name:"reason",id:2},{rule:"repeated",type:"string",name:"options",id:3}]},{name:"DestroyStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"ConnectionDisconnected",fields:[{rule:"required",type:"string",name:"connectionId",id:1},{rule:"required",type:"uint32",name:"reasonCode",id:2},{rule:"optional",type:"string",name:"description",id:3}]},{name:"ConnectionDisconnectedResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"StreamStarted",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"repeated",type:"string",name:"tags",id:3}]},{name:"SourceStreamStarted",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"repeated",type:"string",name:"capabilities",id:3},{rule:"repeated",type:"string",name:"tags",id:4}]},{name:"StreamEnded",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"string",name:"reason",id:3},{rule:"repeated",type:"string",name:"tags",id:4},{rule:"optional",type:"string",name:"continuationId",id:5},{rule:"optional",type:"string",name:"routeKey",id:6}]},{name:"SourceStreamEnded",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"string",name:"reason",id:3},{rule:"repeated",type:"string",name:"capabilities",id:4},{rule:"repeated",type:"string",name:"tags",id:5}]},{name:"StreamEndedResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"continuationId",id:2},{rule:"optional",type:"string",name:"routeKey",id:3}]},{name:"StreamIdle",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"repeated",type:"string",name:"options",id:3},{rule:"repeated",type:"string",name:"tags",id:4}]},{name:"StreamArchived",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"uint64",name:"startTime",id:4},{rule:"required",type:"string",name:"uri",id:3}]},{name:"SessionEnded",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"reason",id:2},{rule:"required",type:"float",name:"duration",id:3}]},{name:"ResourceIdle",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"routeKey",id:2}]},{name:"ResourceIdleResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"StreamPlaylist",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"PlaylistType",name:"playlistType",id:3},{rule:"required",type:"string",name:"uri",id:4},{rule:"required",type:"bool",name:"isVariant",id:5,options:{default:!0}}],enums:[{name:"PlaylistType",values:[{name:"Live",id:0},{name:"OnDemand",id:1}]}]},{name:"StreamRtmp",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"required",type:"string",name:"uri",id:2},{rule:"required",type:"uint32",name:"height",id:3},{rule:"required",type:"uint32",name:"bitrate",id:4}]},{name:"SendEventToClient",fields:[{rule:"required",type:"string",name:"connectionId",id:1},{rule:"required",type:"string",name:"type",id:2},{rule:"required",type:"bytes",name:"payload",id:3}]},{name:"SendEventToClientResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"SendRequestToClient",fields:[{rule:"required",type:"string",name:"connectionId",id:1},{rule:"required",type:"string",name:"type",id:2},{rule:"required",type:"bytes",name:"payload",id:3}]},{name:"SendRequestToClientResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"type",id:2},{rule:"optional",type:"bytes",name:"payload",id:3}]},{name:"SetupStream",fields:[{rule:"required",type:"string",name:"streamToken",id:1},{rule:"required",type:"CreateStream",name:"createStream",id:2}]},{name:"SetupStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"CreateStreamResponse",name:"createStreamResponse",id:2}]},{name:"SetupPlaylistStream",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamToken",id:2},{rule:"repeated",type:"string",name:"options",id:3},{rule:"repeated",type:"string",name:"tags",id:4}]},{name:"PlaylistStreamManifest",fields:[{rule:"required",type:"string",name:"manifest",id:1},{rule:"required",type:"bool",name:"isProtectedContent",id:2},{rule:"optional",type:"string",name:"drmToken",id:3}]},{name:"SetupPlaylistStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"PlaylistStreamManifest",name:"manifests",id:2},{rule:"optional",type:"uint64",name:"offset",id:3,options:{default:0}}]},{name:"StreamDataQuality",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"uint64",name:"timestamp",id:3},{rule:"required",type:"DataQualityStatus",name:"status",id:4},{rule:"required",type:"DataQualityReason",name:"reason",id:5}],enums:[{name:"DataQualityStatus",values:[{name:"NoData",id:0},{name:"AudioOnly",id:1},{name:"All",id:2}]},{name:"DataQualityReason",values:[{name:"None",id:0},{name:"UploadLimited",id:1},{name:"DownloadLimited",id:2},{name:"PublisherLimited",id:3},{name:"NetworkLimited",id:4}]}]},{name:"StreamDataQualityResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"CallbackEvent",fields:[{rule:"optional",type:"uint32",name:"apiVersion",id:1,options:{default:0}},{rule:"required",type:"string",name:"entity",id:2},{rule:"required",type:"string",name:"what",id:3},{rule:"required",type:"string",name:"data",id:4},{rule:"optional",type:"string",name:"sessionId",id:5}]},{name:"Uri",fields:[{rule:"optional",type:"string",name:"protocol",id:1,options:{default:"http"}},{rule:"required",type:"string",name:"host",id:2},{rule:"optional",type:"uint32",name:"port",id:3,options:{default:80}},{rule:"optional",type:"string",name:"method",id:4,options:{default:"POST"}},{rule:"optional",type:"string",name:"path",id:5,options:{default:"/"}}]},{name:"SetApplicationCallback",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"required",type:"Uri",name:"callback",id:3}]},{name:"SetApplicationCallbackResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"endpoint",id:2}]},{name:"IssueAuthenticationToken",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"repeated",type:"string",name:"capabilities",id:3}]},{name:"IssueAuthenticationTokenResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"authenticationToken",id:2}]},{name:"IssueStreamToken",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"required",type:"string",name:"sessionId",id:3},{rule:"optional",type:"string",name:"originStreamId",id:4},{rule:"repeated",type:"string",name:"alternateOriginStreamIds",id:6},{rule:"repeated",type:"string",name:"capabilities",id:5},{rule:"optional",type:"bool",name:"permissive",id:7,options:{default:!1}}]},{name:"IssueStreamTokenResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"streamToken",id:2}]},{name:"IssueDrmToken",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"optional",type:"string",name:"sessionId",id:3},{rule:"required",type:"string",name:"originStreamId",id:4},{rule:"repeated",type:"string",name:"capabilities",id:5}]},{name:"IssueDrmTokenResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"drmToken",id:2}]},{name:"TerminateStream",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"optional",type:"string",name:"streamId",id:3,oneof:"streamOrToken"},{rule:"optional",type:"string",name:"streamToken",id:5,oneof:"streamOrToken"},{rule:"optional",type:"string",name:"reason",id:4}],oneofs:{streamOrToken:[3,5]}},{name:"TerminateStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"DeleteStream",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"optional",type:"string",name:"streamId",id:3,oneof:"streamOrToken"},{rule:"optional",type:"string",name:"streamToken",id:5,oneof:"streamOrToken"},{rule:"optional",type:"string",name:"reason",id:4}],oneofs:{streamOrToken:[3,5]}},{name:"DeleteStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"Stream",fields:[{rule:"required",type:"string",name:"streamId",id:1}]},{name:"ListStreams",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"optional",type:"string",name:"start",id:3},{rule:"required",type:"uint32",name:"length",id:4},{rule:"repeated",type:"string",name:"options",id:5}]},{name:"ListStreamsResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"start",id:2},{rule:"optional",type:"uint32",name:"length",id:3},{rule:"repeated",type:"Stream",name:"streams",id:4}]},{name:"GetPlaylistUris",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"required",type:"string",name:"streamId",id:3},{rule:"repeated",type:"string",name:"options",id:4}]},{name:"GetPlaylistUrisResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"Playlist",name:"playlists",id:2},{rule:"optional",type:"StreamMetadata",name:"streamInfo",id:3}],messages:[{name:"PlaylistMetadata",fields:[{rule:"optional",type:"uint32",name:"bitrate",id:1},{rule:"optional",type:"uint32",name:"height",id:2},{rule:"optional",type:"float",name:"framesPerSecond",id:3}]},{name:"StreamMetadata",fields:[{rule:"required",type:"string",name:"startTime",id:1},{rule:"optional",type:"string",name:"endTime",id:2}]},{name:"Playlist",fields:[{rule:"required",type:"string",name:"name",id:1},{rule:"required",type:"PlaylistType",name:"type",id:2},{rule:"required",type:"string",name:"uri",id:3},{rule:"required",type:"bool",name:"isVariant",id:4},{rule:"required",type:"bool",name:"isProtected",id:5},{rule:"required",type:"PlaylistMetadata",name:"info",id:6}]}],enums:[{name:"PlaylistType",values:[{name:"Hls",id:0},{name:"Dash",id:1}]}]}]}}.apply(e,[]))||(t.exports=n)},function(t,e,i){var n,r;n=[i(0),i(1),i(4),i(18),i(3),i(77),i(76)],void 0===(r=function(t,e,i,n,r,s,o){"use strict";var a=5;function u(t,r,u,c){e.qt(t,"uri"),e.Xt(r,"deviceId"),e.qt(u,"version"),e.Rt(c,"logger"),this.Gr=r,this.kt=u,this.Ct=c,this.Xo=new n.MQWebSocket(t,this.Ct,[s,o],a),this.Qo=new i.Observable(null).extend({rateLimit:0})}return u.prototype.onEvent=function(t,e){return this.Xo.onEvent(t,e)},u.prototype.disconnect=function(){return this.Qo.setValue(null),this.Xo.disconnect()},u.prototype.authenticate=function(t,i){e.qt(t,"authToken"),e.It(i,"callback");var n={apiVersion:this.Xo.getApiVersion(),clientVersion:this.kt,deviceId:this.Gr,platform:r.browser,platformVersion:r.browserVersion.toString(),authenticationToken:t};this.getSessionId()&&(n.sessionId=this.getSessionId());var s=this;return this.Xo.sendRequest("pcast.Authenticate",n,function(t,e){if(e){var n=s.Qo.getValue();n&&n!==e.sessionId&&s.Xo.disposeOfPendingRequests(),s.Qo.setValue(e.sessionId)}return i(t,e)})},u.prototype.getSessionId=function(){return this.Qo.getValue()},u.prototype.getObservableSessionId=function(){return this.Qo},u.prototype.bye=function(t,i){e.qt(t,"reason"),e.It(i,"callback");var n={sessionId:this.getSessionId(),reason:t};return this.Xo.sendRequest("pcast.Bye",n,i)},u.prototype.setupStream=function(i,n,s,o,a){e.qt(i,"streamType"),e.qt(n,"streamToken"),e.Rt(s,"options"),e.It(a,"callback");var u=r.browser||"UnknownBrowser",c=u+"-"+(r.browserVersion||0),h="rtt[http]="+o,f={streamToken:n,createStream:{sessionId:this.getSessionId(),options:["data-quality-notifications",h],connectUri:s.connectUri,connectOptions:s.connectOptions||[],tags:s.tags||[],userAgent:t.get(r,["global","navigator","userAgent"],c)}};return s.negotiate&&(f.createStream.createOfferDescription={streamId:"",options:[i,u,c],apiVersion:this.Xo.getApiVersion()},"undefined"!=typeof screen&&f.createStream.createOfferDescription.options.push("screen="+screen.width+"x"+screen.height)),!1===s.receiveAudio&&f.createStream.options.push("no-audio"),!1===s.receiveVideo&&f.createStream.options.push("no-video"),this.Xo.sendRequest("pcast.SetupStream",f,a)},u.prototype.setAnswerDescription=function(t,i,n){e.qt(t,"streamId"),e.qt(i,"sdp"),e.It(n,"callback");var r={streamId:t,sessionDescription:{type:"Answer",sdp:i},apiVersion:this.Xo.getApiVersion()};return this.Xo.sendRequest("pcast.SetRemoteDescription",r,n)},u.prototype.addIceCandidates=function(i,n,r,s){e.qt(i,"streamId"),e.isArray(n,"candidates"),e.Rt(r,"options"),e.It(s,"callback");var o={streamId:i,candidates:t.map(n,function(t,i){return e.qt(t.candidate,"candidate["+i+"].candidate"),e.ee(t.sdpMLineIndex,"candidate["+i+"].sdpMLineIndex"),e.qt(t.sdpMid,"candidate["+i+"].sdpMid"),{candidate:t.candidate,sdpMLineIndex:t.sdpMLineIndex,sdpMid:t.sdpMid}}),options:r,apiVersion:this.Xo.getApiVersion()};return this.Xo.sendRequest("pcast.AddIceCandidates",o,s)},u.prototype.updateStreamState=function(t,i,n,r,s){e.qt(t,"streamId"),e.qt(i,"signalingState"),e.qt(n,"iceGatheringState"),e.qt(r,"iceConnectionState"),e.It(s,"callback");var o={streamId:t,signalingState:i,iceGatheringState:n,iceConnectionState:r,apiVersion:this.Xo.getApiVersion()};return this.Xo.sendRequest("pcast.UpdateStreamState",o,s)},u.prototype.destroyStream=function(t,i,n){e.qt(t,"streamId"),e.Xt(i,"reason"),e.It(n,"callback");var r={streamId:t,reason:i};return this.Xo.sendRequest("pcast.DestroyStream",r,n)},u.prototype.getRoomInfo=function(t,i,n){t?e.Xt(t,"roomId"):e.Xt(i,"alias"),e.It(n,"callback");var r={roomId:t,alias:i,sessionId:this.getSessionId()};return this.Xo.sendRequest("chat.GetRoomInfo",r,n)},u.prototype.createRoom=function(t,i){e.Rt(t,"room"),e.qt(t.name,"room.name"),e.qt(t.type,"room.type"),e.qt(t.description,"room.description"),e.It(i,"callback");var n={sessionId:this.getSessionId(),room:t};return this.Xo.sendRequest("chat.CreateRoom",n,i)},u.prototype.enterRoom=function(t,i,n,r,s){t?e.Xt(t,"roomId"):e.Xt(i,"alias"),e.Rt(n,"member"),e.ee(r,"timestamp"),e.It(s,"callback");var o={roomId:t,alias:i,sessionId:this.getSessionId(),member:n,timestamp:r};return this.Xo.sendRequest("chat.JoinRoom",o,s)},u.prototype.leaveRoom=function(t,i,n){e.Xt(t,"roomId"),e.ee(i,"timestamp"),e.It(n,"callback");var r={roomId:t,sessionId:this.getSessionId(),timestamp:i};return this.Xo.sendRequest("chat.LeaveRoom",r,n)},u.prototype.updateMember=function(t,i,n,r){e.qt(t,"roomId"),e.Rt(i,"member"),e.ee(n,"timestamp"),e.It(r,"callback"),i.updateStreams=i.hasOwnProperty("streams");var s={sessionId:this.getSessionId(),roomId:t,member:i,timestamp:n};return this.Xo.sendRequest("chat.UpdateMember",s,r)},u.prototype.updateRoom=function(t,i,n){e.Rt(t,"room"),e.ee(i,"timestamp"),e.It(n,"callback");var r={sessionId:this.getSessionId(),room:t,timestamp:i};return this.Xo.sendRequest("chat.UpdateRoom",r,n)},u.prototype.sendMessageToRoom=function(t,i,n){e.qt(t,"roomId"),e.Rt(i,"chatMessage");var r={roomId:t,chatMessage:i};return this.Xo.sendRequest("chat.SendMessageToRoom",r,n)},u.prototype.subscribeToRoomConversation=function(t,i,n,r){e.qt(t,"sessionId"),e.qt(i,"roomId"),e.ee(n,"batchSize");var s={sessionId:t,roomId:i,limit:n,options:["Subscribe"]};return this.Xo.sendRequest("chat.FetchRoomConversation",s,r)},u.prototype.getMessages=function(t,i,n,r,s,o){e.qt(t,"sessionId"),e.qt(i,"roomId"),s&&r||e.ee(n,"batchSize");var a={sessionId:t,roomId:i,limit:n||0,options:[]};return s&&(e.qt(s,"beforeMessageId"),a.beforeMessageId=s),r&&(e.qt(r,"afterMessageId"),a.afterMessageId=r),this.Xo.sendRequest("chat.FetchRoomConversation",a,o)},u.prototype.toString=function(){return"PCastProtocol["+this.Xo.toString()+"]"},u}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(1),i(10)],void 0===(r=function(t,e){"use strict";return{toString:function(t){var e=0,i=t.length,n=[],r=[];if(e===i)return"";for(;e<i;)n.push(t[e++]),n.length>=1024&&(r.push(String.fromCharCode.apply(String,n)),n=[]);return r.join("")+String.fromCharCode.apply(String,n)},toByteArray:function(i){t.Xt(i,"data");for(var n,r=0,s=new e.Uint8Array(i.length);r<i.length;){if((n=i.charCodeAt(r))>255)throw RangeError("illegal char code: "+n);s[r++]=n}return s}}}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(2)],void 0===(r=function(t,e,i){"use strict";var n=1,r=2,s=1500,o={clientAborted:{id:4e3,name:"Aborted by Client"}};function a(){}function u(e,i,n,r,s){h(r=r||{});var o=d(e,f(r.queryParameters||{},i)),a=t.bind(v,this,t.now(),s);if(!o)return s(l());r.responseType&&(o.responseType=r.responseType),m(o,r),o.addEventListener("readystatechange",t.bind(p,this,o,r,a)),o.timeout=r.timeout||15e3,o.send(n)}function c(e,i,n,r,s){var o=t.bind(e,this,i,n,r),a={startTime:t.now(),isDisposed:!1};return g.call(this,i,r,o,a,s)}function h(i){e.Rt(i,"settings"),i.queryParameters&&e.Rt(i.queryParameters,"settings.queryParameters"),i.mimeType&&e.Tt(i.mimeType,"settings.mimeType"),i.accept&&e.Tt(i.accept,"settings.accept"),i.contentType&&e.Tt(i.contentType,"settings.contentType"),i.responseType&&e.Tt(i.responseType,"settings.responseType"),t.isNullOrUndefined(i.timeout)||e.ee(i.timeout,"settings.timeout")}function f(e,i){var n=i.lastIndexOf("#"),r=i.indexOf("?"),s=t.reduce(e,function(t,e,i){return(t+=t?"&":"")+i.toString()+"="+e.toString()},""),o=-1===n?"":i.substring(n+1),a=-1===r?"":i.substring(r+1,o?n:i.length),u=s+(a?"&"+a:"");return i=i.replace("?"+a,"").replace("#"+o,""),u&&(i+="?"+u),o&&(i+="#"+o),i}function d(t,e){var i=new XMLHttpRequest;if("withCredentials"in i)i.open(t,e,!0);else{if("undefined"==typeof XDomainRequest)return;(i=new XDomainRequest).open(t,e)}return i}function l(){var t=new Error("unsupported");return t.code="unsupported",t}function m(e,i){var n=i.contentType||"application/json",r=i.accept||n,s=t.assign({},{"Content-Type":n,Accept:r},t.get(i,["headers"],{}));t.forOwn(s,function(t,i){e.setRequestHeader(i,t)})}function p(i,n,r){if(4===i.readyState)if(200===i.status){var s=function(e){var i=e.getAllResponseHeaders();return t.reduce(i.trim().split(/[\r\n]+/),function(t,e){var i=e.split(": "),n=i.shift(),r=i.join(": ");return n&&(t[n]=r),t},{})}(i);r(null,{data:i.response||i.responseText,headers:s,rawXhr:i})}else{var o=new Error(0===i.status?"timeout":i.statusText),a=t.get(n,["retryOptions","additionalRetryErrorCodes"],[]);t.forEach(a,function(t){e.ee(t,"additionalRetryErrorCode")}),o.code=i.status,(i.status>=500&&i.status<600||t.includes(a,i.status))&&(o.retryable=!0),r(o)}}function v(e,i,n,r){r&&t.set(r,["stats","successResponseTime"],t.now()-e),i(n,r)}function g(e,a,u,c,h,f){f=f||1;var d=this,l=t.get(a,["delay"],null),m=t.get(a,["retryOptions","delay"],s),p=t.get(a,["retryOptions","backoff"],r),v=t.get(a,["retryOptions","maxAttempts"],n),w=f>1?m*Math.pow(f,p):l,b=function(i,n){return c.isDisposed?h(y(o.clientAborted)):i&&i.retryable&&f<v?g.call(d,e,a,u,c,h,f+1):function(e,i,n,r,s){s&&(t.set(s,["stats","totalResponseTimeForAllAttempts"],t.now()-e),t.set(s,["stats","attempts"],i)),n(r,s)}.call(d,c.startTime,f,h,i,n)},k=new i.Disposable(function(){t.ee(c.mostRecentTimeout)&&clearTimeout(c.mostRecentTimeout),c.isDisposed=!0});return!t.ee(l)&&1===f||t.get(a,["retryOptions","sync"],!1)?(u.call(d,b),k):(function(t,e,i,n,r,s){var a=this;n.mostRecentTimeout=setTimeout(function(){if(n.isDisposed)return s(y(o.clientAborted));i.call(a,s)},r)}.call(d,e,a,u,c,w,b),k)}function y(t){var e=new Error(t.name);return e.code=t.id,e}return a.prototype.get=function(e,i,n){h(i=i||{});var r=d("GET",f(i.queryParameters||{},e)),s=t.bind(v,this,t.now(),n);if(!r)return n(l());i.mimeType&&r.overrideMimeType(i.mimeType),i.responseType&&(r.responseType=i.responseType),m(r,i),r.addEventListener("readystatechange",t.bind(p,this,r,i,s)),r.timeout=i.timeout||3e3,r.send()},a.prototype.post=function(t,e,i,n){return u.call(this,"POST",t,e,i,n)},a.prototype.put=function(t,e,i,n){return u.call(this,"PUT",t,e,i,n)},a.prototype.delete=function(t,e,i,n){return u.call(this,"DELETE",t,e,i,n)},a.prototype.getWithRetry=function(e,i,n){var r=t.bind(this.get,this,e,i),s={startTime:t.now(),isDisposed:!1};return g.call(this,e,i,r,s,n)},a.prototype.postWithRetry=function(t,e,i,n){return c.call(this,this.post,t,e,i,n)},a.prototype.putWithRetry=function(t,e,i,n){return c.call(this,this.put,t,e,i,n)},a.prototype.deleteWithRetry=function(t,e,i,n){return c.call(this,this.delete,t,e,i,n)},new a}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(5),i(10),i(42),i(6),i(4),i(2)],void 0===(r=function(t,e,i,n,r,s,o,a){var u=0,c={capacity:"capacity",error:"error",response:"response"},h="__phenixBatchHttpMessages";function f(s,u,c,f){e.qt(s,"uri"),u=u||{},e.Rt(u,"options"),u.requestType&&e.qt(u.requestType,"options.requestType"),u.maxAttempts&&e.ee(u.maxAttempts,"options.maxAttempts"),u.maxBufferedRecords&&e.ee(u.maxBufferedRecords,"options.maxBufferedRecords"),u.maxBatchSize&&e.ee(u.maxBatchSize,"options.maxBatchSize"),u.contentType&&e.qt(u.contentType,"options.maxBatchSize"),c&&e.It(c,"serializeRequest"),f&&e.It(f,"deserializeResponse"),this.$o=h+"|"+s,this.Yo=u.requestType||"POST",this.Zo=u.requestTimeout||3e4,this.ta=u.maxAttempts||5,this.ea=u.maxBufferedRecords||1e3,this.ia=u.maxBatchSize||100,this.na=u.contentType||"application/json",this.ra=c,this.sa=f,this.Ji=s,this.Eo=p.call(this)||[],this.Do=!0,this.vr=new i.NamedEvents,this.oa=new o.Observable(!0),this.v=new a.DisposableList,this.aa=!1,this.ua=!1,this.v.add(this.oa.subscribe(t.bind(l,this))),this.v.add(function(){var t=this;return r.listenForNetworkChange(function(){m.call(t,t.aa)})}.call(this)),this.v.add(this.vr),g.call(this,[]),l.call(this);var d=this;t.addEventListener(n,"beforeunload",function(){v.call(d,d.Eo),d.ua=!0,d.Eo=[]})}function d(){if(this.Eo.length>this.ea){var t=this.Eo.length-this.ea/2;this.Eo=this.Eo.slice(t),this.vr.fireAsync(c.capacity,[null,{numberOfDeletedRecords:t}])}}function l(){if(this.oa.getValue()&&0!==this.Eo.length&&this.Eo.length===this.ia){m.call(this,!0);var e={records:t.take(this.Eo,this.ia)};this.Eo=this.Eo.slice(this.ia);var i=this;try{(function(e,i,n){var r=this,o=this.ra?this.ra(t.assign({},i)):i;switch(this.Yo){case"POST":return s.postWithRetry(e,o,{timeout:this.Zo,contentType:this.na,retryOptions:{maxAttempts:this.ta,additionalRetryErrorCodes:[0]}},function(t,e){if(t)return"timeout"!==t.message||function(){return this.Eo.length>=this.ea}.call(r)?(m.call(r,!1),r.vr.fire(c.error,[t])):n();m.call(r,!1);var i=r.sa?r.sa(e.data):e.data;return r.vr.fire(c.response,[i])});default:throw new Error("Invalid request type")}}).call(this,this.Ji,e,function(){setTimeout(function(){i.Eo=i.Eo.concat(e.records),m.call(i,!1)},u)})}catch(t){setTimeout(function(){return m.call(i,!1),i.vr.fire(c.error,[t])},u)}}}function m(t){this.aa=t,this.oa.setValue(!t&&r.isOnline())}f.prototype.on=function(t,i){return e.qt(t,"eventName"),e.It(i,"callback"),this.vr.listen(t,i)},f.prototype.addRecord=function(t){if(this.ua)return v.call(this,[t]);this.Eo.push(t),l.call(this),d.call(this)},f.prototype.addRecordToBeginning=function(t){this.Eo.unshift(t),l.call(this),d.call(this)},f.prototype.dispose=function(){this.Eo=[],this.v.dispose()};var p=function(){if(!n.localStorage)return null;var t=n.localStorage.getItem(this.$o);return t?JSON.parse(t):[]},v=function(t){if(!n.localStorage||!t||0===t.length)return null;var e=p.call(this).concat(t);return g.call(this,e)},g=function(t){return n.localStorage&&t?n.localStorage.setItem(this.$o,JSON.stringify(t)):null};return f}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(81)],void 0===(r=function(t){"use strict";return t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(82),i(40),i(79)],void 0===(r=function(t,e,i,n,r){"use strict";function s(t,e,i){return r.toString(t.encode(e,i))}function o(t,e,i){return t.decode(e+"Response",r.toByteArray(i))}return function(r,a,u,c,h){e.qt(r,"uri"),e.isArray(a,"protocols"),e.qt(u,"type"),e.Rt(c,"options");var f=t.assign({},c||{},{contentType:"application/protobuf"}),d=new n(a,h);return new i(r,f,t.bind(s,this,d,u),t.bind(o,this,d,u))}}.apply(e,n))||(t.exports=r)},function(t,e,i){var n;!function(){for(var r={},s=[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,43,47],o=[],a=0,u=s.length;a<u;++a)o[s[a]]=a;r.encode=function(t,e){for(var i,n;null!==(i=t());)e(s[i>>2&63]),n=(3&i)<<4,null!==(i=t())?(e(s[63&((n|=i>>4&15)|i>>4&15)]),n=(15&i)<<2,null!==(i=t())?(e(s[63&(n|i>>6&3)]),e(s[63&i])):(e(s[63&n]),e(61))):(e(s[63&n]),e(61),e(61))},r.decode=function(t,e){var i,n,r;function s(t){throw Error("Illegal character code: "+t)}for(;null!==(i=t());)if(void 0===(n=o[i])&&s(i),null!==(i=t())&&(void 0===(r=o[i])&&s(i),e(n<<2>>>0|(48&r)>>4),null!==(i=t()))){if(void 0===(n=o[i])){if(61===i)break;s(i)}if(e((15&r)<<4>>>0|(60&n)>>2),null!==(i=t())){if(void 0===(r=o[i])){if(61===i)break;s(i)}e((3&n)<<6>>>0|r)}}},r.test=function(t){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(t)},void 0!==t&&t.exports?t.exports=r:void 0===(n=function(){return r}.call(e,i,e,t))||(t.exports=n)}()},function(t,e,i){t.exports=i(84)},function(t,e,i){var n,r;n=[i(0),i(1),i(10),i(85)],void 0===(r=function(t,e,i,n){"use strict";function r(){this.ca=[],this.ha=""}return r.prototype.push=function(){this.ca.length+arguments.length>1024&&(this.ha+=String.fromCharCode.apply(String,this.ca),this.ca.length=0),Array.prototype.push.apply(this.ca,arguments)},r.prototype.build=function(){return this.ha+String.fromCharCode.apply(String,this.ca)},{toString:function(e){var i=0,s=e.length,o=new r;return n.encode(function(){return i<s?e[i++]:null},t.bind(o.push,o)),o.build()},toByteArray:function(t){e.Xt(t,"data");var r,s,o=[];return n.decode((r=t,s=0,function(){return s<r.length?r.charCodeAt(s++):null}),function(t){o.push(t)}),new i.Uint8Array(o)}}}.apply(e,n))||(t.exports=r)},function(t,e,i){var n;void 0===(n=function(){"use strict";return{package:"mq",messages:[{name:"Message",fields:[{rule:"optional",type:"MessageType",name:"messageType",id:7,options:{default:"Request"}},{rule:"optional",type:"string",name:"sessionId",id:1},{rule:"optional",type:"string",name:"requestId",id:2},{rule:"required",type:"string",name:"type",id:3},{rule:"optional",type:"string",name:"encoding",id:4},{rule:"required",type:"bytes",name:"payload",id:5},{rule:"repeated",type:"double",name:"wallTime",id:6}],enums:[{name:"MessageType",values:[{name:"Request",id:0},{name:"Response",id:1},{name:"Event",id:2}]}]},{name:"Error",fields:[{rule:"required",type:"string",name:"reason",id:1}]},{name:"PingPong",fields:[{rule:"required",type:"uint64",name:"originTimestamp",id:1},{rule:"optional",type:"uint64",name:"count",id:2}]}]}}.apply(e,[]))||(t.exports=n)},function(t,e,i){var n,r;n=[i(0)],void 0===(r=function(t){"use strict";function e(e){this.fa=e,this.da={},this.la={},function e(i,n){t.get(i,["messages","length"],0)>0&&function(i,n){var r=this;n.messages=t.reduce(i,function(i,s){if(!n[s.name]){var o=t.reduce(s.fields,function(t,e){return t[e.id]=!0,t},{});return i[s.name]={parent:n,type:s.name,fieldIds:o},e.call(r,s,i[s.name]),i}},{})}.call(this,i.messages,n),t.get(i,["enums","length"],0)>0&&function(e,i){i.enums=t.reduce(e,function(e,i){return e[i.name]=t.reduce(i.values,function(t,e){return t[e.name]=e,t},{}),e},{})}.call(this,i.enums,n)}.call(this,this.fa,this.da),function e(i,n){var s=this;t.forEach(i.messages,function(i){n.messages[i.name].fields=t.reduce(i.fields,t.bind(r,this,n.messages[i.name]),{}),i.messages&&e.call(s,i,n.messages[i.name])})}.call(this,this.fa,this.da)}function i(e,i,n,r){var o,a=this,u=(o=e.messages[i],t.reduce(o.fields,function(e,i){return e[i.name]=t.clone(i.defaultValue),e},{}));return n.readFields(function(t,n,r){if(e.messages[i].fieldIds[t]){var o=e.messages[i].fields[t];"repeated"===o.rule?n[o.name].push(s.call(a,e.messages[i],i,t,r)):n[o.name]=s.call(a,e.messages[i],i,t,r)}},u,r)}function n(e,i,r,s){var o=this,a=e.messages[i];t.forEach(t.keys(a.fields),function(a){return function e(i,r,s,o,a,u){var c=this,h=i.messages[r].fields[s],f=o[h.name];if(t.isUndefined(u)||(f=f[u]),h.defaultValue!==f&&!t.isUndefined(f)){if(t.isArray(f)){if("repeated"!==h.rule)throw new Error("Invalid type. Array is not valid with rule ["+h.rule+"]");return t.forEach(f,function(t,n){e.call(c,i,r,s,o,a,n)})}if(t.Rt(h.schema)&&t.Rt(f))return a.writeMessage(s,t.bind(n,this,h.schema.parent,h.type),f);var d=t.isUndefined(f)?h.defaultValue:f;if(t.Rt(h.schema)&&!h.schema.fields){var l=t.ee(f)?f:t.get(h.schema,[d,"id"]);return a.writeVarintField(s,l)}switch(h.type){case"string":return a.writeStringField(s,d);case"float":return a.writeFloatField(s,d);case"double":return a.writeDoubleField(s,d);case"bool":return a.writeBooleanField(s,d);case"enum":case"uint32":case"uint64":case"int32":case"int64":return a.writeVarintField(s,d);case"sint32":case"sint64":return a.writeSVarintField(s,d);case"fixed32":return a.writeFixed32Field(s,d);case"fixed64":return a.writeFixed64Field(s,d);case"sfixed32":return a.writeSFixed32Field(s,d);case"sfixed64":return a.writeSFixed64Field(s,d);case"bytes":return a.writeBytesField(s,d);default:throw new Error("Unexpected type: "+h.type)}}}.call(o,e,i,parseInt(a),r,s)})}function r(e,i,n){return i[n.id]={rule:n.rule,type:n.type,name:n.name,schema:function e(i,n){return t.get(n,["messages",i])?n.messages[i]:t.get(n,["enums",i])?n.enums[i]:n.parent?e(i,n.parent):i}.call(this,n.type,e),defaultValue:function(e,i,n){if("repeated"===e)return[];switch(i){case"float":case"double":case"uint32":case"uint64":case"int32":case"int64":case"sint32":case"sint64":case"fixed32":case"fixed64":case"sfixed32":case"sfixed64":case"string":case"enum":case"bool":case"long":default:return t.isUndefined(n)?null:n}}(n.rule,n.type,t.get(n,["options","default"]))},i}function s(e,n,r,s){var o="int32"===n||"int64"===n?"true":"",a=e.fields[r];if(t.Rt(a.schema)){if(a.schema.fields)return i.call(this,a.schema.parent,a.type,s,s.readVarint()+s.pos);var u=s.readVarint(o),c=t.getEnumName(a.schema,u);if(t.isNullOrUndefined(c))throw new Error("Unsupported enum id ["+u+"] for field ["+a.name+"] on message ["+e.type+"]");return c}switch(a.type){case"string":return s.readString(o);case"float":return s.readFloat(o);case"double":return s.readDouble(o);case"bool":return s.readBoolean(o);case"enum":return s.readVarint(o);case"uint32":case"uint64":case"int32":case"int64":return s.readVarint(o);case"sint32":case"sint64":return s.readSVarint(o);case"fixed32":return s.readFixed32(o);case"fixed64":return s.readFixed64(o);case"sfixed32":return s.readSFixed32(o);case"sfixed64":return s.readSFixed64(o);case"bytes":return s.readBytes(o);default:throw new Error("Unexpected type: "+a.type)}}return e.prototype.read=function(t,e,n){if(!this.da.messages[t])throw new Error("Unsupported proto type ["+t+"]");return i.call(this,this.da,t,e,n)},e.prototype.write=function(t,e,i){if(!this.da.messages[t])throw new Error("Unsupported proto type ["+t+"]");return n.call(this,this.da,t,e,i)},e.prototype.getDefaults=function(){},e}.apply(e,n))||(t.exports=r)},function(t,e){e.read=function(t,e,i,n,r){var s,o,a=8*r-n-1,u=(1<<a)-1,c=u>>1,h=-7,f=i?r-1:0,d=i?-1:1,l=t[e+f];for(f+=d,s=l&(1<<-h)-1,l>>=-h,h+=a;h>0;s=256*s+t[e+f],f+=d,h-=8);for(o=s&(1<<-h)-1,s>>=-h,h+=n;h>0;o=256*o+t[e+f],f+=d,h-=8);if(0===s)s=1-c;else{if(s===u)return o?NaN:1/0*(l?-1:1);o+=Math.pow(2,n),s-=c}return(l?-1:1)*o*Math.pow(2,s-n)},e.write=function(t,e,i,n,r,s){var o,a,u,c=8*s-r-1,h=(1<<c)-1,f=h>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,l=n?0:s-1,m=n?1:-1,p=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=h):(o=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-o))<1&&(o--,u*=2),(e+=o+f>=1?d/u:d*Math.pow(2,1-f))*u>=2&&(o++,u/=2),o+f>=h?(a=0,o=h):o+f>=1?(a=(e*u-1)*Math.pow(2,r),o+=f):(a=e*Math.pow(2,f-1)*Math.pow(2,r),o=0));r>=8;t[i+l]=255&a,l+=m,a/=256,r-=8);for(o=o<<r|a,c+=r;c>0;t[i+l]=255&o,l+=m,o/=256,c-=8);t[i+l-m]|=128*p}},function(t,e,i){"use strict";t.exports=r;var n=i(89);function r(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}function s(t){return t.type===r.Bytes?t.readVarint()+t.pos:t.pos+1}function o(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function a(t,e,i){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.ceil(Math.log(e)/(7*Math.LN2));i.realloc(n);for(var r=i.pos-1;r>=t;r--)i.buf[r+n]=i.buf[r]}function u(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function c(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function h(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function f(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function d(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function l(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function m(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function p(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function v(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function g(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function y(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function w(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}r.Varint=0,r.Fixed64=1,r.Bytes=2,r.Fixed32=5,r.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var n=this.readVarint(),r=n>>3,s=this.pos;this.type=7&n,t(r,e,this),this.pos===s&&this.skip(n)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=g(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=w(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=g(this.buf,this.pos)+4294967296*g(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=g(this.buf,this.pos)+4294967296*w(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=n.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=n.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,n=this.buf;return e=127&(i=n[this.pos++]),i<128?e:(e|=(127&(i=n[this.pos++]))<<7,i<128?e:(e|=(127&(i=n[this.pos++]))<<14,i<128?e:(e|=(127&(i=n[this.pos++]))<<21,i<128?e:function(t,e,i){var n,r,s=i.buf;if(n=(112&(r=s[i.pos++]))>>4,r<128)return o(t,n,e);if(n|=(127&(r=s[i.pos++]))<<3,r<128)return o(t,n,e);if(n|=(127&(r=s[i.pos++]))<<10,r<128)return o(t,n,e);if(n|=(127&(r=s[i.pos++]))<<17,r<128)return o(t,n,e);if(n|=(127&(r=s[i.pos++]))<<24,r<128)return o(t,n,e);if(n|=(1&(r=s[i.pos++]))<<31,r<128)return o(t,n,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=n[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=function(t,e,i){for(var n="",r=e;r<i;){var s,o,a,u=t[r],c=null,h=u>239?4:u>223?3:u>191?2:1;if(r+h>i)break;1===h?u<128&&(c=u):2===h?128==(192&(s=t[r+1]))&&(c=(31&u)<<6|63&s)<=127&&(c=null):3===h?(s=t[r+1],o=t[r+2],128==(192&s)&&128==(192&o)&&((c=(15&u)<<12|(63&s)<<6|63&o)<=2047||c>=55296&&c<=57343)&&(c=null)):4===h&&(s=t[r+1],o=t[r+2],a=t[r+3],128==(192&s)&&128==(192&o)&&128==(192&a)&&((c=(15&u)<<18|(63&s)<<12|(63&o)<<6|63&a)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,h=1):c>65535&&(c-=65536,n+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),n+=String.fromCharCode(c),r+=h}return n}(this.buf,this.pos,t);return this.pos=t,e},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){var i=s(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){var e=s(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){var e=s(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){var e=s(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){var e=s(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){var e=s(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){var e=s(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){var e=s(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){var e=s(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===r.Varint)for(;this.buf[this.pos++]>127;);else if(e===r.Bytes)this.pos=this.readVarint()+this.pos;else if(e===r.Fixed32)this.pos+=4;else{if(e!==r.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),y(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),y(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),y(this.buf,-1&t,this.pos),y(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),y(this.buf,-1&t,this.pos),y(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var i,n;if(t>=0?(i=t%4294967296|0,n=t/4294967296|0):(n=~(-t/4294967296),4294967295^(i=~(-t%4294967296))?i=i+1|0:(i=0,n=n+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,i){i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos]=127&t}(i,0,e),function(t,e){var i=(7&t)<<4;e.buf[e.pos++]|=i|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(n,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,i){for(var n,r,s=0;s<e.length;s++){if((n=e.charCodeAt(s))>55295&&n<57344){if(!r){n>56319||s+1===e.length?(t[i++]=239,t[i++]=191,t[i++]=189):r=n;continue}if(n<56320){t[i++]=239,t[i++]=191,t[i++]=189,r=n;continue}n=r-55296<<10|n-56320|65536,r=null}else r&&(t[i++]=239,t[i++]=191,t[i++]=189,r=null);n<128?t[i++]=n:(n<2048?t[i++]=n>>6|192:(n<65536?t[i++]=n>>12|224:(t[i++]=n>>18|240,t[i++]=n>>12&63|128),t[i++]=n>>6&63|128),t[i++]=63&n|128)}return i}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&a(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),n.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),n.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var n=this.pos-i;n>=128&&a(i,n,this),this.pos=i-1,this.writeVarint(n),this.pos+=n},writeMessage:function(t,e,i){this.writeTag(t,r.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){this.writeMessage(t,u,e)},writePackedSVarint:function(t,e){this.writeMessage(t,c,e)},writePackedBoolean:function(t,e){this.writeMessage(t,d,e)},writePackedFloat:function(t,e){this.writeMessage(t,h,e)},writePackedDouble:function(t,e){this.writeMessage(t,f,e)},writePackedFixed32:function(t,e){this.writeMessage(t,l,e)},writePackedSFixed32:function(t,e){this.writeMessage(t,m,e)},writePackedFixed64:function(t,e){this.writeMessage(t,p,e)},writePackedSFixed64:function(t,e){this.writeMessage(t,v,e)},writeBytesField:function(t,e){this.writeTag(t,r.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,r.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,r.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,r.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,r.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,r.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,r.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,r.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,r.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,r.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}}},function(t,e,i){var n,r;n=[i(0),i(10),i(5),i(4),i(2)],void 0===(r=function(t,e,i,n,r){"use strict";function s(){var r="undefined"==typeof navigator||navigator.onLine;this.ma=new n.Observable(r).extend({timeout:0}),this.vr=new i.NamedEvents,t.addEventListener(e,"online",t.bind(this.vr.fire,this.vr,"online",[])),t.addEventListener(e,"offline",t.bind(this.vr.fire,this.vr,"offline",[])),t.addEventListener(e,"unload",t.bind(this.vr.dispose,this.vr)),this.vr.listen("online",t.bind(this.ma.setValue,this.ma,!0)),this.vr.listen("offline",t.bind(this.ma.setValue,this.ma,!1))}function o(e,i){var n=this;if(this.ma.setValue(!1),!t.ee(i))return e(!1);n.offlineTimeout=setTimeout(function(){e&&!n.ma.getValue()&&e(!1)},i)}function a(t){this.ma.setValue(!0),t&&t(!0)}return s.prototype.listenForNetworkChange=function(e,i){var n=new r.DisposableList,s=t.bind(a,this,e),u=t.bind(o,this,e,i);return n.add(this.vr.listen("online",s)),n.add(this.vr.listen("offline",u)),n},s.prototype.isOnline=function(){return this.ma.getValue()},new s}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(42)],void 0===(r=function(t,e,i){"use strict";var n=15e3,r=1e3,s=1e3,o=4,a={byebye:{code:1e3,reason:"byebye",desc:"Client closed"},backoffLimitReached:{code:4e3,reason:"backoff-limit-reached",desc:"Reached the limit in terms of the number of reconnects"},networkDisconnect:{code:4001,reason:"network-disconnect",desc:"Network connection monitor determined loss to internet connectivity"},reconnecting:{code:4002,reason:"reconnecting",desc:"Closing WebSocket in order to attempt to establish another connection"}},u={connecting:{code:0,state:"CONNECTING",desc:"The connection is not yet open"},open:{code:1,state:"OPEN",desc:"The connection is open and ready to communicate"},closing:{code:2,state:"CLOSING",desc:"The connection is in the process of closing"},closed:{code:3,state:"CLOSED",desc:"The connection is closed or could not be opened"}};function c(c,h,d,y){e.qt(c,"uri"),e.Rt(h,"logger"),t.isNullOrUndefined(d)?d=o:e.ee(d,"maxReconnectAttempts"),this.Ji=c,this.Ct=h,this.pa=d,this.va=y||s,this.ga=!1,this.rs=!1,this.ya=[],this.wa="connecting",this.Ct.info("Connecting WebSocket to [%s]",c),this.zr=f.call(this,p,l);var w=this;this.ba=null,this.ka=i.listenForNetworkChange(function(e){if(e)return t.ee(w.ba)&&(clearTimeout(w.ba),w.ba=null),function(){var t=this;setTimeout(function(){return t.rs?t.Ct.info("Unable to go back online after network reconnect. Client has stopped WebSocket."):t.zr.readyState!==u.open.code?(t.Ct.info("Network Reconnected. Attempting to reconnect WebSocket."),t.reconnect()):t.Sa?(t.Ct.info("Network Reconnected with WebSocket status of [%s].",u.open.state),p.call(t)):("online"===t.wa&&"reconnected"===this.wa||v.call(t),void t.Ct.info("Network Reconnected."))},r)}.call(w);t.ee(w.ba)||(m.call(w),w.ba=setTimeout(function(){return function(){this.Ct.warn("Network not reconnected after [%s]. Going Offline and disconnecting WebSocket connection.",n),this.Sa=!0,g.call(this,a.networkDisconnect)}.call(w)},n))},0)}function h(t){return this.zr.readyState===u.closed.code?l.call(this,t):this.zr.close(t.code,t.reason)}function f(e,i){var n=new WebSocket(this.Ji);return n.onopen=t.bind(e,this),n.onclose=t.bind(i,this),n.onmessage=t.bind(w,this),n.onerror=t.bind(y,this),n}function d(t){this.zr.readyState!==u.open.code&&this.reconnect(t+1)}function l(t){switch(t.code){case a.reconnecting.code:return;case a.byebye.code:case a.backoffLimitReached.code:case a.networkDisconnect.code:return g.call(this,t);default:if(this.ga)return;return m.call(this,t),this.Ct.info("Attempting to re-establish socket connection after disconnect event with code [%s] and reason [%s]",t.code,t.reason),this.reconnect()}}function m(t){this.Ct.info("WebSocket is reconnecting"),this.wa="reconnecting",this.onreconnecting&&this.onreconnecting(t)}function p(t){this.Ct.info("WebSocket Connected"),function(){var t=this.ya.length;if(0!==t)for(this.Ct.info("Sending [%s] queued messages",t);t>0;){t--;var e=this.ya.shift();this.send(e)}}.call(this),this.wa="connected",this.onconnected&&this.onconnected(t)}function v(t){this.Ct.info("Successfully reconnected to WebSocket"),this.wa="reconnected",this.onreconnected&&this.onreconnected(t)}function g(t){this.Ct.info("WebSocket Disconnected [%s]: [%s]",t.code,t.reason),this.wa="disconnected",this.ondisconnected&&this.ondisconnected(t)}function y(t){this.Ct.error("An error occurred on the WebSocket connection [%s]",t.data||t),this.onerror&&this.onerror(t)}function w(t){this.Ct.debug(">> [%s]",t.data),this.onmessage&&this.onmessage(t)}return c.prototype.onmessage=null,c.prototype.onconnected=null,c.prototype.onreconnecting=null,c.prototype.onreconnected=null,c.prototype.ondisconnected=null,c.prototype.onerror=null,c.prototype.send=function(t){return i.isOnline(),this.zr.send(t)},c.prototype.reconnect=function(e){this.zr.onclose=null,this.zr.onerror=null,this.ga=!0;var i,n=this;if(t.ee(e)||(e=1),this.rs)return this.Ct.info("Client has stopped WebSocket after [%s] reconnect attempts",e-1);if(e>this.pa)return this.Ct.warn("Unable to reconnect WebSocket after [%s] attempts",this.pa),h.call(this,a.backoffLimitReached);h.call(this,a.reconnecting);try{this.zr=f.call(n,function(){return i&&clearTimeout(i),n.ga=!1,n.zr.onclose=t.bind(l,n),v.call(n)},function(){e+1>n.pa&&(i&&clearTimeout(i),d.call(n,e))})}catch(t){this.Ct.warn("Unable to create WebSocket connection [%s]",t)}i=function(t){var e=this;return setTimeout(function(){d.call(e,t)},t*t*this.va)}.call(this,e)},c.prototype.disconnect=function(){return this.ka.dispose(),this.rs=!0,t.ee(this.ba)&&(clearTimeout(this.ba),this.ba=null),this.zr.close(a.byebye.code,a.byebye.reason)},c.prototype.toString=function(){return"ReconnectedWebSocket["+this.Ji+","+this.zr.readyState+"]"},c}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(92)],void 0===(r=function(t){"use strict";return t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(5),i(93),i(41)],void 0===(r=function(t,e,i,n,r){"use strict";function s(s,o,m,p){e.qt(s,"uri"),e.Rt(o,"logger"),e.isArray(m,"protocols"),this.Ji=s,this.Ct=o,this.Ct.info("Connecting to [%s]",s),this.zr=new n(this.Ji,this.Ct),this.Ea=new r(this.Ct,t.bind(l,this),t.bind(d,this),m,p),this.vr=new i.NamedEvents,this.zr.onconnected=t.bind(u,this),this.zr.onreconnecting=t.bind(a,this),this.zr.onreconnected=t.bind(c,this),this.zr.ondisconnected=t.bind(h,this),this.zr.onerror=t.bind(f,this),this.Ta=!1}function o(t,e){this.vr.fire(t,e,this)}function a(t){o.call(this,"reconnecting")}function u(t){o.call(this,"connected")}function c(t){o.call(this,"reconnected")}function h(t){o.call(this,"disconnected",[t.code,t.reason]),this.Ta&&(this.vr.dispose(),this.Ea.dispose())}function f(t){o.call(this,"error",[t.data])}function d(t){this.zr.onmessage=t}function l(t){this.zr&&this.zr.send(t)}return s.prototype.onEvent=function(t,e){return this.vr.listen(t,e),this.Ea.onEvent(t,e)},s.prototype.onRequest=function(t,e){return this.Ea.onRequest(t,e)},s.prototype.sendRequest=function(t,e,i,n){return this.Ea.sendRequest(t,e,i,n)},s.prototype.sendResponse=function(t,e,i,n){return this.Ea.sendResponse(t,e,i,n)},s.prototype.disconnect=function(){return this.Ta=!0,this.zr.disconnect()},s.prototype.disposeOfPendingRequests=function(){return this.Ct.info("Disposing of pending MQ WebSocket requests"),this.Ea.disposeOfRequests()},s.prototype.getApiVersion=function(){return this.Ea.getApiVersion()},s.prototype.toString=function(){return"MQWebSocket["+this.zr.toString()+"]"},s}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0)],void 0===(r=function(t){"use strict";function e(t){this.Ia=t||""}return e.prototype.detect=function(){var e="Unknown",i="?",n=this.Ia.match(/(Chrome|Chromium|Firefox|Opera|Safari)+\//),r=this.Ia.match(/(Chrome|Chromium|Firefox|Version)+\/([0-9]+)\./),s=!1;return n&&n.length>=2?e=n[1]:this.Ia.match(/^\(?Mozilla/)&&(e="Mozilla",(this.Ia.match(/MSIE/)||this.Ia.match(/; Trident\/.*rv:[0-9]+/))&&(e="IE",(r=this.Ia.match(/MSIE ([0-9]+)/))?(i=parseInt(r[1],10),(r=this.Ia.match(/MSIE [0-9]+.*MSIE ([0-9]+)/))&&(i=parseInt(r[1],10))):(r=this.Ia.match(/rv:([0-9]+)/))&&(i=parseInt(r[1],10)))),"Chrome"===e&&this.Ia.match(/OPR\//)?(e="Opera",r=this.Ia.match(/(OPR)\/([0-9]+)\./)):"Chrome"===e&&this.Ia.match(/Edge\//)?(e="Edge",r=this.Ia.match(/(Edge)\/([0-9]+)\./)):"Firefox"!==e&&"IE"!==e||!this.Ia.match(/Opera/)?"Mozilla"===e&&this.Ia.match(/iphone|ipod|ipad/i)&&(e="Safari",i=parseInt(t.get(this.Ia.match(/OS\s([0-9]+)/),[1]),10),s=!0):(e="Opera",r=this.Ia.match(/(Opera) ([0-9]+)\./)),"Chrome"===e&&(this.Ia.match(/; wv/)||this.Ia.match(/Android/)&&this.Ia.match(/Version\/[0-9].[0-9]/))&&(s=!0),"IE"!==e&&r&&r.length>=3&&(i=parseInt(r[2],10)),"ReactNative"===navigator.product&&(e="ReactNative",i=navigator.productSub||"?"),{browser:e,version:i,isWebview:s}},e}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(3),i(8),i(18),i(39)],void 0===(r=function(t,e,i,n,r,s){function o(o){e.Xt(o,"uri"),this.Po="/telemetry/logs",this.xo="object"==typeof location?location.hostname:i.browser+"-"+i.browserVersion+"-unknown",this.Ra=n.level.TRACE,this.Do=!0,this.Oo=(i.browser||"Browser")+"/"+(i.browserVersion||"?"),this.jo=0,this.Ao=new r.BatchHttpProto(o+this.Po,[s],"telemetry.StoreLogRecords",{maxAttempts:3,maxBufferedRecords:1e3,maxBatchSize:512}),this.Ao.on("capacity",t.bind(a,this))}function a(e){this.Ao.addRecordToBeginning({level:"Warn",timestamp:t.isoString(),category:"websdk/telemetryLogger",message:"Deleted "+e+" records",source:this.Oo,fullQualifiedName:this.xo,sessionId:this.qo,userId:this.Ca,environment:this.Fo,version:this.No,runtime:this.jo})}return o.prototype.setThreshold=function(t){e.ee(t,"level"),this.Ra=t},o.prototype.getThreshold=function(){return this.Ra},o.prototype.isEnabled=function(){return this.Do},o.prototype.setEnabled=function(t){e.Sn(t,"enabled"),this.Do=t},o.prototype.log=function(i,n,r,s,o,a,u,c,h){h.level<this.Ra||!this.Do||(e.isArray(s,"messages"),this.jo=i,this.qo=o,this.Ca=a,this.Fo=u,this.No=c,function(e,i,n){this.Ao.addRecord({level:e,timestamp:t.isoString(),category:i,message:n.join(" "),source:this.Oo,fullQualifiedName:this.xo,sessionId:this.qo,userId:this.Ca,environment:this.Fo,version:this.No,runtime:this.jo})}.call(this,n,r,s))},o}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(19),i(96)],void 0===(r=function(t,e,i,n){var r={urls:{local:"",staging:"https://telemetry-stg.phenixrts.com",production:"https://telemetry.phenixrts.com"}};function s(){this.Ma={}}return s.prototype.getAppender=function(t){var e=i.parseEnvFromPcastBaseUri(t||""),s=r.urls[e];return this.Ma[e]||(this.Ma[e]=function(t){var e=new n(t);return t||e.setEnabled(!1),e}.call(this,s)),this.Ma[e]},new s}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1)],void 0===(r=function(t,e){"use strict";function i(t){e.Rt(t,"observable"),this.Pa=t,this.xa=null,this.Do=!1}return i.prototype.start=function(e,i){this.Do=!0,this.xa=this.Pa.subscribe(t.noop,{listenForChanges:{callback:e,timeout:i||500}})},i.prototype.stop=function(){this.Do=!1,this.xa&&this.xa.dispose(),this.xa=null},i.prototype.isEnabled=function(){return this.Do},i}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(44)],void 0===(r=function(t,e,i){"use strict";function n(t,n){var r=t;void 0!==r&&null!==r||(r=[]),e.isArray(r,"valuesToSet"),this.observableArray=new i(r,n)}return n.prototype.getValue=function(){return this.observableArray.getValue()},n.prototype.setValue=function(t){return void 0!==t&&null!==t||(t=[]),void 0!==t&&e.isArray(t,"values"),this.observableArray.setValue(t)},n.prototype.subscribe=function(t,e){return this.observableArray.subscribe(t,e)},n.prototype.push=function(t){var e=this.observableArray.getValue();e.push(t),this.observableArray.setValue(e)},n.prototype.pop=function(){var t=this.observableArray.getValue(),e=t.pop();return this.observableArray.setValue(t),e},n.prototype.remove=function(e){var i=this.observableArray.getValue(),n=function(i){return t.It(e)?e(i):i===e},r=t.filter(i,n);return r.length>0&&this.observableArray.setValue(t.remove(i,n)),r},n.prototype.removeAll=function(){var t=this.observableArray.getValue();return this.observableArray.setValue([]),t},n.prototype.extend=function(t){return this.observableArray.extend(t),this},n}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(45)],void 0===(r=function(t,e,i){"use strict";function n(){this.f={}}return n.prototype.fire=function(i,n,r){e.qt(i,"name"),t.includes(t.keys(this.f),i)&&this.f[i].fire(n,r)},n.prototype.fireAsync=function(i,n,r){e.qt(i,"name"),t.includes(t.keys(this.f),i)&&this.f[i].fireAsync(n,r)},n.prototype.listen=function(n,r){return e.qt(n,"name"),(t.includes(t.keys(this.f),n)?this.f[n]:this.f[n]=new i).listen(r)},n.prototype.size=function(e){return t.includes(t.keys(this.f),e)?this.f[e].size():0},n.prototype.dispose=function(){t.forOwn(this.f,function(t){t.dispose()}),this.f={}},n.prototype.toString=function(){return"NamedEvents|"+t.keys(this.f).length},n}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0)],void 0===(r=function(t){"use strict";function e(){this.Da=[]}return e.prototype.add=function(e){if(!e||!t.It(e.dispose))throw new Error('"disposable" must be a disposable or implement dispose');this.Da.push(e)},e.prototype.dispose=function(){var e=[];return t.forEach(this.Da,function(t){e.push(t.dispose())}),this.Da=[],e},e.prototype.toString=function(){return t.toString(this)},e}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1)],void 0===(r=function(t,e){"use strict";function i(t){e.It(t,"cleanup"),this.Oa=t}return i.prototype.dispose=function(){return this.Oa.call()},i.prototype.toString=function(){return t.toString(this)},i}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(21)],void 0===(r=function(t,e,i){"use strict";function n(){this.Ra=i.level.TRACE}n.prototype.setThreshold=function(t){e.ee(t,"level"),this.Ra=t},n.prototype.getThreshold=function(){return this.Ra},n.prototype.log=function(t,e,n,o,a,u,c,h,f){f.level<this.Ra||(o[0]=t+" ["+n+"] "+e+" "+o[0],f.level>i.level.INFO?s(o):r(o))};var r=function(t){console.log.apply(console,t)}||function(){},s=function(t){console.error.apply(console,t)}||r;return n}.apply(e,n))||(t.exports=r)},function(t,e){var i;i=function(){return this}();try{i=i||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e,i){(function(i){var n;void 0===(n=function(){"use strict";return function(){return"undefined"!=typeof window?window:void 0!==i?i:"undefined"!=typeof self?self:{}}}.apply(e,[]))||(t.exports=n)}).call(this,i(104))},function(t,e,i){var n,r;n=[i(0)],void 0===(r=function(t){var e=function(){};return e.prototype.Rt=function(i,n){if(e.prototype.Xt("name",n),!t.Rt(i))throw new Error('"'+n+'" must be an object. Received ['+typeof i+"]")},e.prototype.isArray=function(i,n){if(e.prototype.Xt("name",n),!t.isArray(i))throw new Error('"'+n+'" must be an array. Received ['+typeof i+"]")},e.prototype.Xt=function(e,i){if(!t.Xt(i))throw new Error('"name" must be a string. Received ['+typeof i+"]");if(!t.Xt(e))throw new Error('"'+i+'" must be a string. Received ['+typeof e+"]")},e.prototype.Sn=function(i,n){if(e.prototype.Xt("name",n),!t.Sn(i))throw new Error('"'+n+'" must be a boolean. Received ['+typeof i+"]")},e.prototype.ee=function(i,n){if(e.prototype.Xt("name",n),!t.ee(i))throw new Error('"'+n+'" must be a number. Received ['+typeof i+"]")},e.prototype.It=function(i,n){if(e.prototype.Xt("name",n),!t.It(i))throw new Error('"'+n+'" must be a function. Received ['+typeof i+"]")},e.prototype.Tt=function(t,i){e.prototype.qt(t,i)},e.prototype.qt=function(t,i){if(e.prototype.Xt("name",i),e.prototype.Xt(t,i),""===t)throw new Error('"'+i+'" must not be empty')},e.prototype.Wt=function(i,n,r){if(e.prototype.Xt("name",r),!t.Rt(i))throw new Error('"'+r+'" must be an instance. Received ['+typeof i+"]");if(!(i instanceof n))throw new Error('"'+r+'" must be a valid instance of class '+t.get(n,["name"],"undefined"))},e.prototype.Oe=function(i,n){if(e.prototype.Xt("name",n),t.isUndefined(i))throw new Error('"'+n+'" must not be undefined')},e.prototype.Pe=function(i,n,r){e.prototype.qt(r,"name");var s=t.getEnumName(n,i);if(t.isNullOrUndefined(s))throw new Error('"'+r+'" must be a valid type. Unable to locate type ['+i+"]");return s},e.prototype.xe=function(i,n){e.prototype.Xt(n,"name"),e.prototype.isArray(i,n),t.forEach(i,function(t,i){e.prototype.Xt(t,n+"["+i+"]")})},new e}.apply(e,n))||(t.exports=r)},function(t,e,i){var n;void 0===(n=function(){"use strict";var t=function(){};t.clone=function(e){return t.isArray(e)?e.slice():t.Rt(e)?t.assign({},e):e},t.get=function(e,i,r){if(t.isNullOrUndefined(e))return r;n(e,"objectToTraverse");var s=i;if(t.Xt(s))s=o(i);else if(!t.isArray(s))throw new Error("Unsupported path type "+typeof i);var a=t.reduce(s,function(e,i){if(t.Rt(e)||t.isArray(e))return e[i]},e);return t.isUndefined(a)?r:a},t.set=function(e,i,r){if(!t.Rt(e))return e;n(e,"objectToTraverse");var s=e,a=i;if(t.Xt(a))a=o(i);else if(!t.isArray(a))throw new Error("Unsupported path type "+typeof i);return t.forEach(a,function(e,i){!function(e,i,n){if(t.ee(parseInt(i))&&t.isArray(e))return e[i]=n;if(t.Xt(i)&&t.Rt(e))return e[i]=n;throw new Error("Unsupported type "+typeof i+" when setting property or index")}(s,e,function(e,i,n,r){if(e.length-1===i)return r;var s=e[i],o=e[i+1];if(t.isArray(n[s])||t.Rt(n[s]))return n[s];if(!t.isArray(n[s])&&t.ee(parseInt(o)))return[];if(!t.Rt(n[s])&&t.Xt(o))return{};throw new Error("Unsupported type "+typeof s+" when setting property or index")}(a,i,s,r)),s=s[e]}),e},t.bind=function(e,i){var n=Array.prototype.slice.call(arguments,2);return function(){if(!t.It(e))throw new TypeError("_.bind - callback must be a function. Received ["+typeof e+"]");var r=n.concat(Array.prototype.slice.call(arguments));return e.apply(i,r)}},t.now=function(){return(new Date).getTime()},t.utc=function(e){return t.ee(e)?e:e?Math.floor(e):NaN},t.isoString=function(){var e=new Date;return e.toISOString?e.toISOString():e.getUTCFullYear()+"-"+t.pad(e.getUTCMonth()+1,2)+"-"+t.pad(e.getUTCDate(),2)+"T"+t.pad(e.getUTCHours(),2)+":"+t.pad(e.getUTCMinutes(),2)+":"+t.pad(e.getUTCSeconds(),2)+"."+(e.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"},t.map=function(e,i){n(e,"collection");var r=[];return e.constructor===Array?t.forEach(e,function(e,n){t.Xt(i)&&t.Rt(e)?r.push(e[i]):t.It(i)&&r.push(i(e,n))}):t.forOwn(e,function(e,n){t.It(i)&&r.push(i(e,n))}),r},t.values=function(e){if(!t.Rt(e)||t.isArray(e))throw new Error("_.values argument, Collection, must be an object. Received ["+typeof e+"]");return t.map(e,function(t){return t})},t.keys=function(e){if(!t.Rt(e)||t.isArray(e))throw new Error("_.keys argument, Collection, must be an object. Received ["+typeof e+"]");return t.map(e,function(t,e){return e})},t.forEach=function(i,n){if(!t.It(n))throw new Error("_.forEach argument, Callback, must be a function. Received ["+typeof n+"]");e(i,"collection");for(var r=0;r<i.length;r++)if(!1===n(i[r],r))return},t.forOwn=function(e,i){if(!t.It(i))throw new Error("Callback must be a function. Received ["+typeof i+"]");n(e,"objectWithProperties");for(var r=Object.keys(e),s=0;s<r.length;s++){var o=r[s];(e.hasOwnProperty(o)||Object.prototype.hasOwnProperty.call(e,o))&&i(e[o],o)}},t.argumentsToArray=function(e){if(!t.Rt(e)||!e.length)throw new Error("Collection must be arguments. Received ["+typeof e+"]");for(var i=[],n=0;n<e.length;n++)i.push(e[n]);return i},t.assign=function(e){t.isNullOrUndefined(e)&&(e={}),n(e,"target");var i=t.argumentsToArray(arguments);return i.shift(),t.forEach(i,function(i,r){t.isNullOrUndefined(i)||(n(i,"_.assign(sources["+r+"])"),t.forOwn(i,function(t,i){e[i]=t}))}),e},t.includes=function(e,i){if(t.Xt(e))return s(i,"Includes value and search parameter"),e.indexOf(i)>-1;if(t.isUndefined(e)||t.isUndefined(i))return!1;n(e,"collection");var r=!1,o=function(t){t===i&&(r=!0)};return e.constructor===Array?t.forEach(e,o):t.forOwn(e,o),r},t.reduce=function(e,i,r){n(e,"collection");var s=r===t.noop()?null:r;return e.constructor===Array?t.forEach(e,function(t,e){s=i(s,t,e)}):t.forOwn(e,function(t,e){s=i(s,t,e)}),s},t.sample=function(t){return e(t,"collection"),t[Math.floor(Math.random()*t.length)]},t.uniqueId=function(){return(t.now()*Math.random()).toString()},t.find=function(i,n,r){var s;return e(i,"collection"),t.forEach(i,function(t,e){if(n(t)&&e>=(r||0))return s=t}),s},t.findIndex=function(i,n,r){var s;return e(i,"collection"),t.forEach(i,function(t,e){if(n(t,e)&&e>=(r||0))return s=e}),s},t.filter=function(i,n){e(i,"collection");var r=[];return t.forEach(i,function(t){n(t)&&r.push(t)}),r},t.remove=function(i,n){return e(i,"collection"),t.filter(i,function(t){return!n(t)})},t.take=function(t,i){return e(t,"collection"),t.slice(0,i)},t.hasDifferences=function(e,i,n){return t.findDifferences(e,i,n).length>0},t.findDifferences=function(e,i,n){var r=[],s={};function o(o,a){s[a]=1,(t.Rt(o)||t.isArray(o))&&n?t.hasIndexOrKey(i,a)&&t.sameTypes(e[a],i[a])?t.hasDifferences(e[a],i[a],n)&&r.push(a):r.push(a):e[a]!==i[a]&&r.push(a)}if(t.isArray(e)&&t.isArray(i))e.length>i.length?t.forEach(e,o):t.forEach(i,o);else{if(!t.Rt(e)||!t.Rt(i)||t.isArray(e)||t.isArray(i))throw new Error("Object types do not match");t.forOwn(e,o),t.forOwn(i,function(t,e){s.hasOwnProperty(e)||r.push(e)})}return r},t.hasIndexOrKey=function(e,i){return t.isArray(e)?e.length>parseInt(i):!!t.Rt(e)&&e.hasOwnProperty(i)},t.startsWith=function(t,e){return s(t,"value"),s(e,"prefix"),0===t.indexOf(e)},t.sameTypes=function(e,i){return t.isNullOrUndefined(e)||t.isNullOrUndefined(i)?t.isNullOrUndefined(e)&&t.isNullOrUndefined(i):t.isArray(e)||t.isArray(i)?t.isArray(e)&&t.isArray(i):typeof e==typeof i},t.freeze=function(t){return"freeze"in Object?Object.freeze(t):t},t.noop=function(){},t.Rt=function(t){return null!==t&&"object"==typeof t},t.isArray=function(e){return!!t.Rt(e)&&e.constructor===Array},t.Xt=function(t){return"string"==typeof t},t.ee=function(t){return!isNaN(t)&&"number"==typeof t},t.Sn=function(t){return"boolean"==typeof t},t.It=function(t){return"function"==typeof t},t.isNullOrUndefined=function(e){return null===e||t.isUndefined(e)},t.isUndefined=function(t){return void 0===t},t.getEnumName=function(e,i){var n=null,r=t.map(e,function(t){return t});return t.ee(i)?n=t.find(r,function(t){return t.id===i}):t.Xt(i)&&(n=t.find(r,function(t){return t.name.toLowerCase()===i.toLowerCase()})),n?n.name:null},t.toString=function(e){if(t.Xt(e))return e;if(t.Sn(e))return e?"true":"false";if(t.ee(e))return e.toString();var i="";if(e)if(t.It(e.toString))i=e.toString();else if(t.Rt(e.toString))try{i=e.toString()}catch(t){i="[object invalid toString()]"}if(0!==i.indexOf("[object"))return i;var n=[];return i+JSON.stringify(e,function(e,i){if(t.Rt(i)&&!t.isNullOrUndefined(i)){if(t.includes(n,i))return"<recursive>";n.push(i)}return""===e?i:t.toString(i)})},t.pad=function(t,e){i(t,"value"),i(e,"numberToPad");for(var n=t.toString().length,r=0;r<e-n;r++)t="0"+t.toString();return t.toString()},t.addEventListener=function(t,e,i,o){n(t,"target"),s(e,"eventName"),r(i,"listener"),t.phenixAddEventListener?t.phenixAddEventListener.call(t,e,i,!!o):t.addEventListener?t.addEventListener(e,i,!!o):t.attachEvent&&t.attachEvent("on"+e,i)},t.removeEventListener=function(t,e,i,o){n(t,"target"),s(e,"eventName"),r(i,"listener"),t.phenixRemoveEventListener?t.phenixRemoveEventListener.call(t,e,i,!!o):t.removeEventListener?t.removeEventListener(e,i,!!o):t.detachEvent&&t.detachEvent("on"+e,i)};var e=function(e){if(!t.isArray(e))throw new Error("Input must be an array. Received ["+typeof e+"]")},i=function(e,i){if(s(i,"name"),!t.ee(e))throw new Error(i+" must be a number. Received ["+typeof e+"]")},n=function(e,i){if(s(i,"name"),!t.Rt(e))throw new Error("collection type not supported - "+i+" must be an array or object. Received ["+typeof e+"]")},r=function(e,i){if(s(i,"name"),!t.It(e))throw new Error(i+" must be a function. Received ["+typeof e+"]")},s=function(e,i){if(!t.Xt(i))throw new Error("Name must be a string. Received ["+typeof i+"]");if(!t.Xt(e))throw new Error(i+" must be a string. Received ["+typeof e+"]")};function o(e){var i=e.split("."),n=[];return t.forEach(i,function(e){n=n.concat(function(e){for(var i="",n=[],r=0,s=0;s<e.length;s++)if("["===e[s]){if(r++,!t.Xt(i)||r>1)return[e];i&&(n.push(i),i="")}else if("]"===e[s]){if(0!=--r)return[e];n.push(i),i=""}else{if(s===e.length-1)return[e];i+=e[s]}return n}(e))}),n}return t}.apply(e,[]))||(t.exports=n)},function(t,e,i){var n,r;n=[i(0),i(1),i(10),i(21)],void 0===(r=function(t,e,i,n){"use strict";var r="websdk",s=i.__phenixPageLoadTime||i.__pageLoadTime||t.now(),o="production",a="2018-09-17T15:08:57Z",u="2018.3.13";function c(){this.Aa=[],this.qa=null,this.Hn=null,this.wo=o,this.Ua=a}function h(t){this.Hn=t,t?this.info("Session started on websdk version [%s] ([%s]), user agent [%s]",a,u,navigator.userAgent):this.info("Websdk version [%s] ([%s]), user agent [%s]",a,u,navigator.userAgent)}function f(e,i){var o=(t.now()-s)/1e3,a=function(t){switch(t){case n.level.TRACE:return"Trace";case n.level.DEBUG:return"Debug";case n.level.INFO:return"Info";case n.level.WARN:return"Warn";case n.level.ERROR:return"Error";case n.level.FATAL:return"Fatal";default:throw new Error("Unsupported Logging Level "+t)}}(i.level),u=i.name||r,c=this;t.forEach(this.Aa,function(t){try{t.log(o,a,u,d(Array.prototype.slice.call(e)),c.Hn,c.qa,c.wo,c.Ua,i)}catch(t){}})}c.prototype.trace=function(){return f.call(this,arguments,{level:n.level.TRACE})},c.prototype.debug=function(){return f.call(this,arguments,{level:n.level.DEBUG})},c.prototype.info=function(){return f.call(this,arguments,{level:n.level.INFO})},c.prototype.warn=function(){return f.call(this,arguments,{level:n.level.WARN})},c.prototype.error=function(){return f.call(this,arguments,{level:n.level.ERROR})},c.prototype.fatal=function(){return f.call(this,arguments,{level:n.level.FATAL})},c.prototype.addAppender=function(t){e.Rt(t,"appender"),e.It(t.log,"appender.log"),this.Aa.push(t)},c.prototype.getAppenders=function(){return this.Aa},c.prototype.getUserId=function(){return this.qa},c.prototype.setUserId=function(t){this.qa=t},c.prototype.getEnvironment=function(){return this.wo},c.prototype.setEnvironment=function(t){this.wo=t},c.prototype.getApplicationVersion=function(){return this.Ua},c.prototype.setApplicationVersion=function(t){this.Ua=t},c.prototype.getObservableSessionId=function(){return this.Qo},c.prototype.setObservableSessionId=function(i){this.Qo=i,this.Fa&&this.Fa.dispose(),i&&(e.Rt(i,"observableSessionId"),this.Fa=this.Qo.subscribe(t.bind(h,this),{initial:"notify"}))};var d=function(e){if(0!==e.length){var i=[],n=[];return t.forEach(e,function(e){i.push(t.toString(e)),e instanceof Error&&n.push(e.stack)}),l(i.concat(n))}},l=function(t){for(var e=t[0],i=0;e.indexOf&&t.length>1&&i>=0;)if((i=e.indexOf("%",i))>0)switch(e.substring(i+1,i+2)){case"%":e=e.substring(0,i)+e.substring(i+1),i++;break;case"s":case"d":t[0]=e=e.substring(0,i)+t[1]+e.substring(i+2),t.splice(1,1);break;default:return t}return t};return c}.apply(e,n))||(t.exports=r)},function(t,e,i){"use strict";var n,r;n=[i(3),i(8),i(46),i(32),i(56),i(48),i(27),i(26),i(24),i(50),i(25)],void 0===(r=function(t,e,i,n,r,s,o,a,u,c,h){return t.global.PhenixPCast=i,{express:{PCastExpress:a,RoomExpress:u,ChannelExpress:c},lowLevel:{PCast:i,RoomService:n},media:{AudioSpeakerDetector:r,UserMediaResolver:o},net:{AdminApiProxyClient:h},utils:{BandwidthMonitor:s,logging:e,rtc:t},AudioSpeakerDetector:r,BandwidthMonitor:s,logging:e,PCast:i,RoomService:n,RTC:t,UserMediaResolver:o}}.apply(e,n))||(t.exports=r)}])});