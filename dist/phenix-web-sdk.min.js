/**
 * Copyright 2018 Phenix Inc. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
!function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b():"function"==typeof define&&define.amd?define("phenix-web-sdk",[],b):"object"==typeof exports?exports["phenix-web-sdk"]=b():a["phenix-web-sdk"]=b()}(this,function(){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,b),e.l=!0,e.exports}var c={};return b.m=a,b.c=c,b.i=function(a){return a},b.d=function(a,c,d){b.o(a,c)||Object.defineProperty(a,c,{configurable:!1,enumerable:!0,get:d})},b.n=function(a){var c=a&&a.__esModule?function(){return a["default"]}:function(){return a};return b.d(c,"a",c),c},b.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},b.p="",b(b.s=94)}([function(a,b,c){var d,e;d=[c(49)],e=function(a){"use strict";return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(40)],e=function(a){return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){!function(b,d){a.exports=d(c(0),c(1),c(4))}(this,function(a,b,c){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,b),e.l=!0,e.exports}var c={};return b.m=a,b.c=c,b.i=function(a){return a},b.d=function(a,c,d){b.o(a,c)||Object.defineProperty(a,c,{configurable:!1,enumerable:!0,get:d})},b.n=function(a){var c=a&&a.__esModule?function(){return a["default"]}:function(){return a};return b.d(c,"a",c),c},b.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},b.p="",b(b.s=10)}([function(a,b,c){var d,e;d=[],e=function(){"use strict";function a(a){this._userAgent=a}return a.prototype.detect=function(){var a="Unknown",b="?",c=this._userAgent.match(/(Chrome|Chromium|Firefox|Opera|Safari)+\//),d=this._userAgent.match(/(Chrome|Chromium|Firefox|Version)+\/([0-9]+)\./);return c&&c.length>=2?a=c[1]:this._userAgent.match(/^\(?Mozilla/)&&(a="Mozilla",(this._userAgent.match(/MSIE/)||this._userAgent.match(/; Trident\/.*rv:[0-9]+/))&&(a="IE",d=this._userAgent.match(/MSIE [0-9]+.*MSIE ([0-9]+)/)||this._userAgent.match(/MSIE ([0-9]+)/)||this._userAgent.match(/rv:([0-9]+)/),d&&(b=parseInt(d[1],10)))),"Chrome"===a&&this._userAgent.match(/OPR\//)?(a="Opera",d=this._userAgent.match(/(OPR)\/([0-9]+)\./)):"Chrome"===a&&this._userAgent.match(/Edge\//)?(a="Edge",d=this._userAgent.match(/(Edge)\/([0-9]+)\./)):"Firefox"!==a&&"IE"!==a||!this._userAgent.match(/Opera/)||(a="Opera",d=this._userAgent.match(/(Opera) ([0-9]+)\./)),"IE"!==a&&d&&d.length>=3&&(b=parseInt(d[2],10)),{browser:a,version:b}},a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(b,c){b.exports=a},function(a,b,c){var d,e;d=[c(3)],e=function(a){"use strict";function b(b,d,e){var f=this;this._ghost=b,this._stream=d,this._isUsingPlugin=e,this._events={};var g=function(a){f._loaded=!0,f._enabled=a===!0,a?h.call(f):m("Failed to create Phenix video element"),f._onReady&&f._onReady(f._enabled)};try{if(this._video=c(e),this._video.className=this._ghost.className,this._video.height=this._ghost.height,this._video.width=this._ghost.width,this._ghost.style.cssText="visibility:hidden !important;width:0px !important;height:0px !important;margin:0px !important;padding:0px !important;border-style:none !important;border-width:0px !important;max-width:0px !important;max-height:0px !important;outline:none !important",this._video.onunload=function(){f._loaded=!1},j.call(this),document.body&&document.body.contains||l("document.body.contains is not supported"),document.body&&document.body.contains&&document.body.contains(this._ghost)&&this._ghost.parentNode.replaceChild(this._video,this._ghost),!e)return g(!0);var i=new a;i.waitForReady(this._video,g)}catch(k){m("Error while loading Phenix RTC"+k),g(!1)}}function c(a){var b=document.createElement("video");return a&&(b=document.createElement("object"),b.type="application/x-phenix-video"),b}function d(a,b,c){if(!this._isUsingPlugin)return this._video.addEventListener(a,b,c);var d=this._events[a];d||(d=this._events[a]=[],this._loaded&&f.call(this,a)),d.push(b)}function e(a,b,c){if(!this._isUsingPlugin)return this._video.removeEventListener(a,b,c);var d=this._events[a];if(d){var e=d.indexOf(b);e>=0&&(d=d.splice(e,1),d.length>0?this._events[a]=d:delete this._events[a])}}function f(a){function b(){var b=c._events[a];if(b)for(var d=0;d<b.length;d++)b[d].apply(c,arguments)}var c=this;c._video.phenixSetEventListener(a,b)}function g(a,b){var c;document.createEvent?(c=document.createEvent("HTMLEvents"),c.initEvent(b,!0,!0)):(c=document.createEventObject(),c.eventType=b),c.eventName=b,setTimeout(function(){document.createEvent?a.dispatchEvent(c):a.fireEvent("on"+c.eventType,c)})}function h(){for(var a=Object.keys(this._events),b=0;b<a.length;b++)f.call(this,a[b]);this.hookUpEvents(),i.call(this),this._video.id=this._ghost.id,this._video.style.cssText=this._ghost.cssText,this._video.className=this._ghost.className,this._video.innerHtml=this._ghost.innerHtml,this._video.width=this._ghost.width,this._video.height=this._ghost.height,this._video.autoplay=this._ghost.autoplay,this._video.muted=this._ghost.muted,this._video.defaultMuted=this._ghost.defaultMuted,this._video.volume=this._ghost.volume,this._stream&&(this._video.src=this._stream)}function i(){var a=this,b=["style"];if(window.MutationObserver){var c=new MutationObserver(function(c){c.forEach(function(c){"attributes"===c.type&&c.target===a._ghost&&b.indexOf(c.attributeName)===-1&&(a._video[c.attributeName]=a._ghost[c.attributeName])})}),d={attributes:!0};c.observe(a._ghost,d)}else l("Falling back to use of DOM event listeners. This results in degraded performance for further DOM modifications and does not work for IE prior to version 9. See https://developer.mozilla.org/en-US/docs/Web/Guide/Events/Mutation_events for details."),a._ghost.addEventListener?a._ghost.addEventListener("DOMAttrModified",function(b){a._video[b.target.tagName]=a._ghost[b.target.tagName]},!1):a._ghost.attachEvent("onpropertychange",function(b){a._video[b.target.tagName]=a._ghost[b.target.tagName]})}function j(){var a=this;if(window.MutationObserver){var b=new MutationObserver(function(b){b.forEach(function(b){if("childList"===b.type)for(var c=0;c<b.addedNodes.length;c++){var d=b.addedNodes[c];b.target!==a._video&&(d===a._ghost?(b.target.replaceChild(a._video,a._ghost),h.call(a)):k(b.target,a._ghost)&&(a._ghost.parentNode.replaceChild(a._video,a._ghost),h.call(a)))}})}),c={childList:!0,attributes:!1,characterData:!1,subtree:!0};b.observe(document.body,c)}else l("Falling back to use of DOM event listeners. This results in degraded performance for further DOM modifications and does not work for IE prior to version 9. See https://developer.mozilla.org/en-US/docs/Web/Guide/Events/Mutation_events for details."),d(a._ghost,"DOMNodeInserted",function(){a._ghost.parentNode.replaceChild(a._video,a._ghost)},!1)}function k(a,b){for(var c=b.parentNode;null!==c;){if(c===a)return!0;c=c.parentNode}return!1}var l=function(){console.log.apply(console,arguments)}||function(){},m=function(){console.error.apply(console,arguments)}||l;return b.prototype.hookUpEvents=function(){var a=this,b=this._ghost;this.addEventListener("error",function(){g(b,"error")}),this.addEventListener("mute",function(){b.muted=a._video.muted,g(b,"mute")}),this.addEventListener("unmute",function(){b.muted=a._video.muted,g(b,"unmute")}),this.addEventListener("ended",function(){b.ended=a._video.ended,g(b,"ended")}),this.addEventListener("loadedmetadata",function(){b.width=a._video.width,b.height=a._video.height,g(b,"loadedmetadata")}),this.addEventListener("loadeddata",function(){b.width=a._video.width,b.height=a._video.height,g(b,"loadeddata")}),this.addEventListener("resize",function(){b.width=a._video.width,b.height=a._video.height,g(b,"resize")})},b.prototype.onReady=function(a){var b=this;this._loaded?setTimeout(function(){a(b._enabled)},1):this._onReady=a},b.prototype.getElement=function(){return this._video},b.prototype.addEventListener=function(a,b,c){d.call(this,a,b,c)},b.prototype.removeEventListener=function(a,b,c){e.call(this,a,b,c)},b}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0)],e=function(a){"use strict";function b(a){this._timeout=a||15e3}var c=new a(navigator.userAgent).detect(),d=4,e=function(){console.error.apply(console,arguments)}||console.log;return b.prototype.waitForReadyWithTimeout=function(a,b,f){var g=!1,h=1,i=h,j=function(a){g||(g=!0,b(a))},k=function l(){a.readyState===d?j(!0):a.phenixVersion?j(!0):(h=Math.min(h+1e3,2*h),i+=h,i>f?(e("Timed out while waiting for <object> to load"),j(!1)):setTimeout(l,h))};a.hasOwnProperty&&a.hasOwnProperty("onload")||"IE"!==c.browser&&e("No means of detecting when <object> is loaded"),a.onload=function(){j(!0)},k()},b.prototype.waitForReady=function(a,b){a.phenixVersion?b(!0):this.waitForReadyWithTimeout(a,b,this._timeout)},b}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,c){a.exports=b},function(a,b){a.exports=c},function(a,b,c){var d,e;d=[c(1),c(4),c(5),c(0),c(12),c(11)],e=function(a,b,c,d,e,f){"use strict";var g=new d(navigator.userAgent).detect(),h={RTCPeerConnection:e.RTCPeerConnection,RTCSessionDescription:e.RTCSessionDescription,RTCIceCandidate:e.RTCIceCandidate,getSources:e.getSources,getUserMedia:e.getUserMedia,getStats:e.getStats,attachMediaStream:e.attachMediaStream,attachUriStream:e.attachUriStream,reattachMediaStream:e.reattachMediaStream,browser:g.browser,browserVersion:g.version,webrtcSupported:e.webrtcSupported,phenixSupported:!1,isPhenixEnabled:function(){return!1},onLoaded:void 0};if(f.isSupported()){h.phenixSupported=!0;var i=new f,j=function(){h.RTCPeerConnection=i.getRTCPeerConnectionConstructor(),h.RTCSessionDescription=i.getRTCSessionDescriptionConstructor(),h.RTCIceCandidate=i.getRTCIceCandidateConstructor(),h.getSources=i.getSourcesDelegate(),h.getUserMedia=i.getUserMediaDelegate(),h.getStats=i.getStatsDelegate(),Function.prototype.bind?(h.attachMediaStream=i.attachMediaStream.bind(i),h.reattachMediaStream=i.reattachMediaStream.bind(i),h.isPhenixEnabled=i.isEnabled.bind(i)):(h.attachMediaStream=function(){i.attachMediaStream.apply(i,arguments)},h.reattachMediaStream=function(){i.reattachMediaStream.apply(i,arguments)},h.isPhenixEnabled=function(){return i.isEnabled()}),h.webrtcSupported=!0,h.phenixSupported=!0,h.phenixVersion=i.getVersion(),h.onLoaded&&h.onLoaded.call()};i.isEnabled()?j():i.onReady(function(a){a&&(j(),h.onload&&"function"==typeof h.onload&&h.onload())}),i.onLoaded(function(){j()})}else h.phenixSupported=!1;return h}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";var a=function(a){window.RTCPeerConnection=a.RTCPeerConnection,window.RTCSessionDescription=a.RTCSessionDescription,window.RTCIceCandidate=a.RTCIceCandidate};return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b){var c;c=function(){return this}();try{c=c||Function("return this")()||(0,eval)("this")}catch(d){"object"==typeof window&&(c=window)}a.exports=c},function(a,b,c){(function(b){var c,c;!function(b){a.exports=b()}(function(){return function a(b,d,e){function f(h,i){if(!d[h]){if(!b[h]){var j="function"==typeof c&&c;if(!i&&j)return c(h,!0);if(g)return c(h,!0);var k=new Error("Cannot find module '"+h+"'");throw k.code="MODULE_NOT_FOUND",k}var l=d[h]={exports:{}};b[h][0].call(l.exports,function(a){var c=b[h][1][a];return f(c?c:a)},l,l.exports,a,b,d,e)}return d[h].exports}for(var g="function"==typeof c&&c,h=0;h<e.length;h++)f(e[h]);return f}({1:[function(a,b,c){"use strict";var d={};d.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},d.localCName=d.generateIdentifier(),d.splitLines=function(a){return a.trim().split("\n").map(function(a){return a.trim()})},d.splitSections=function(a){var b=a.split("\nm=");return b.map(function(a,b){return(b>0?"m="+a:a).trim()+"\r\n"})},d.matchPrefix=function(a,b){return d.splitLines(a).filter(function(a){return 0===a.indexOf(b)})},d.parseCandidate=function(a){var b;b=0===a.indexOf("a=candidate:")?a.substring(12).split(" "):a.substring(10).split(" ");for(var c={foundation:b[0],component:parseInt(b[1],10),protocol:b[2].toLowerCase(),priority:parseInt(b[3],10),ip:b[4],port:parseInt(b[5],10),type:b[7]},d=8;d<b.length;d+=2)switch(b[d]){case"raddr":c.relatedAddress=b[d+1];break;case"rport":c.relatedPort=parseInt(b[d+1],10);break;case"tcptype":c.tcpType=b[d+1];break;default:c[b[d]]=b[d+1]}return c},d.writeCandidate=function(a){var b=[];b.push(a.foundation),b.push(a.component),b.push(a.protocol.toUpperCase()),b.push(a.priority),b.push(a.ip),b.push(a.port);var c=a.type;return b.push("typ"),b.push(c),"host"!==c&&a.relatedAddress&&a.relatedPort&&(b.push("raddr"),b.push(a.relatedAddress),b.push("rport"),b.push(a.relatedPort)),a.tcpType&&"tcp"===a.protocol.toLowerCase()&&(b.push("tcptype"),b.push(a.tcpType)),a.ufrag&&(b.push("ufrag"),b.push(a.ufrag)),"candidate:"+b.join(" ")},d.parseIceOptions=function(a){return a.substr(14).split(" ")},d.parseRtpMap=function(a){var b=a.substr(9).split(" "),c={payloadType:parseInt(b.shift(),10)};return b=b[0].split("/"),c.name=b[0],c.clockRate=parseInt(b[1],10),c.numChannels=3===b.length?parseInt(b[2],10):1,c},d.writeRtpMap=function(a){var b=a.payloadType;return void 0!==a.preferredPayloadType&&(b=a.preferredPayloadType),"a=rtpmap:"+b+" "+a.name+"/"+a.clockRate+(1!==a.numChannels?"/"+a.numChannels:"")+"\r\n"},d.parseExtmap=function(a){var b=a.substr(9).split(" ");return{id:parseInt(b[0],10),direction:b[0].indexOf("/")>0?b[0].split("/")[1]:"sendrecv",uri:b[1]}},d.writeExtmap=function(a){return"a=extmap:"+(a.id||a.preferredId)+(a.direction&&"sendrecv"!==a.direction?"/"+a.direction:"")+" "+a.uri+"\r\n"},d.parseFmtp=function(a){for(var b,c={},d=a.substr(a.indexOf(" ")+1).split(";"),e=0;e<d.length;e++)b=d[e].trim().split("="),c[b[0].trim()]=b[1];return c},d.writeFmtp=function(a){var b="",c=a.payloadType;if(void 0!==a.preferredPayloadType&&(c=a.preferredPayloadType),a.parameters&&Object.keys(a.parameters).length){var d=[];Object.keys(a.parameters).forEach(function(b){d.push(b+"="+a.parameters[b])}),b+="a=fmtp:"+c+" "+d.join(";")+"\r\n"}return b},d.parseRtcpFb=function(a){var b=a.substr(a.indexOf(" ")+1).split(" ");return{type:b.shift(),parameter:b.join(" ")}},d.writeRtcpFb=function(a){var b="",c=a.payloadType;return void 0!==a.preferredPayloadType&&(c=a.preferredPayloadType),a.rtcpFeedback&&a.rtcpFeedback.length&&a.rtcpFeedback.forEach(function(a){b+="a=rtcp-fb:"+c+" "+a.type+(a.parameter&&a.parameter.length?" "+a.parameter:"")+"\r\n"}),b},d.parseSsrcMedia=function(a){var b=a.indexOf(" "),c={ssrc:parseInt(a.substr(7,b-7),10)},d=a.indexOf(":",b);return d>-1?(c.attribute=a.substr(b+1,d-b-1),c.value=a.substr(d+1)):c.attribute=a.substr(b+1),c},d.getMid=function(a){var b=d.matchPrefix(a,"a=mid:")[0];if(b)return b.substr(6)},d.parseFingerprint=function(a){var b=a.substr(14).split(" ");return{algorithm:b[0].toLowerCase(),value:b[1]}},d.getDtlsParameters=function(a,b){var c=d.matchPrefix(a+b,"a=fingerprint:");return{role:"auto",fingerprints:c.map(d.parseFingerprint)}},d.writeDtlsParameters=function(a,b){var c="a=setup:"+b+"\r\n";return a.fingerprints.forEach(function(a){c+="a=fingerprint:"+a.algorithm+" "+a.value+"\r\n"}),c},d.getIceParameters=function(a,b){var c=d.splitLines(a);c=c.concat(d.splitLines(b));var e={usernameFragment:c.filter(function(a){return 0===a.indexOf("a=ice-ufrag:")})[0].substr(12),password:c.filter(function(a){return 0===a.indexOf("a=ice-pwd:")})[0].substr(10)};return e},d.writeIceParameters=function(a){return"a=ice-ufrag:"+a.usernameFragment+"\r\na=ice-pwd:"+a.password+"\r\n"},d.parseRtpParameters=function(a){for(var b={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=d.splitLines(a),e=c[0].split(" "),f=3;f<e.length;f++){var g=e[f],h=d.matchPrefix(a,"a=rtpmap:"+g+" ")[0];if(h){var i=d.parseRtpMap(h),j=d.matchPrefix(a,"a=fmtp:"+g+" ");switch(i.parameters=j.length?d.parseFmtp(j[0]):{},i.rtcpFeedback=d.matchPrefix(a,"a=rtcp-fb:"+g+" ").map(d.parseRtcpFb),b.codecs.push(i),i.name.toUpperCase()){case"RED":case"ULPFEC":b.fecMechanisms.push(i.name.toUpperCase())}}}return d.matchPrefix(a,"a=extmap:").forEach(function(a){b.headerExtensions.push(d.parseExtmap(a))}),b},d.writeRtpDescription=function(a,b){var c="";c+="m="+a+" ",c+=b.codecs.length>0?"9":"0",c+=" UDP/TLS/RTP/SAVPF ",c+=b.codecs.map(function(a){return void 0!==a.preferredPayloadType?a.preferredPayloadType:a.payloadType}).join(" ")+"\r\n",c+="c=IN IP4 0.0.0.0\r\n",c+="a=rtcp:9 IN IP4 0.0.0.0\r\n",b.codecs.forEach(function(a){c+=d.writeRtpMap(a),c+=d.writeFmtp(a),c+=d.writeRtcpFb(a)});var e=0;return b.codecs.forEach(function(a){a.maxptime>e&&(e=a.maxptime)}),e>0&&(c+="a=maxptime:"+e+"\r\n"),c+="a=rtcp-mux\r\n",b.headerExtensions.forEach(function(a){c+=d.writeExtmap(a)}),c},d.parseRtpEncodingParameters=function(a){var b,c=[],e=d.parseRtpParameters(a),f=e.fecMechanisms.indexOf("RED")!==-1,g=e.fecMechanisms.indexOf("ULPFEC")!==-1,h=d.matchPrefix(a,"a=ssrc:").map(function(a){return d.parseSsrcMedia(a)}).filter(function(a){return"cname"===a.attribute}),i=h.length>0&&h[0].ssrc,j=d.matchPrefix(a,"a=ssrc-group:FID").map(function(a){var b=a.split(" ");return b.shift(),b.map(function(a){return parseInt(a,10)})});j.length>0&&j[0].length>1&&j[0][0]===i&&(b=j[0][1]),e.codecs.forEach(function(a){if("RTX"===a.name.toUpperCase()&&a.parameters.apt){var d={ssrc:i,codecPayloadType:parseInt(a.parameters.apt,10),rtx:{ssrc:b}};c.push(d),f&&(d=JSON.parse(JSON.stringify(d)),d.fec={ssrc:b,mechanism:g?"red+ulpfec":"red"},c.push(d))}}),0===c.length&&i&&c.push({ssrc:i});var k=d.matchPrefix(a,"b=");return k.length&&(k=0===k[0].indexOf("b=TIAS:")?parseInt(k[0].substr(7),10):0===k[0].indexOf("b=AS:")?1e3*parseInt(k[0].substr(5),10)*.95-16e3:void 0,c.forEach(function(a){a.maxBitrate=k})),c},d.parseRtcpParameters=function(a){var b={},c=d.matchPrefix(a,"a=ssrc:").map(function(a){return d.parseSsrcMedia(a)}).filter(function(a){return"cname"===a.attribute})[0];c&&(b.cname=c.value,b.ssrc=c.ssrc);var e=d.matchPrefix(a,"a=rtcp-rsize");b.reducedSize=e.length>0,b.compound=0===e.length;var f=d.matchPrefix(a,"a=rtcp-mux");return b.mux=f.length>0,b},d.parseMsid=function(a){var b,c=d.matchPrefix(a,"a=msid:");if(1===c.length)return b=c[0].substr(7).split(" "),{stream:b[0],track:b[1]};var e=d.matchPrefix(a,"a=ssrc:").map(function(a){return d.parseSsrcMedia(a)}).filter(function(a){return"msid"===a.attribute});return e.length>0?(b=e[0].value.split(" "),{stream:b[0],track:b[1]}):void 0},d.generateSessionId=function(){return Math.random().toString().substr(2,21)},d.writeSessionBoilerplate=function(a,b){var c,e=void 0!==b?b:2;return c=a?a:d.generateSessionId(),"v=0\r\no=thisisadapterortc "+c+" "+e+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},d.writeMediaSection=function(a,b,c,e){var f=d.writeRtpDescription(a.kind,b);if(f+=d.writeIceParameters(a.iceGatherer.getLocalParameters()),f+=d.writeDtlsParameters(a.dtlsTransport.getLocalParameters(),"offer"===c?"actpass":"active"),f+="a=mid:"+a.mid+"\r\n",f+=a.direction?"a="+a.direction+"\r\n":a.rtpSender&&a.rtpReceiver?"a=sendrecv\r\n":a.rtpSender?"a=sendonly\r\n":a.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",a.rtpSender){var g="msid:"+e.id+" "+a.rtpSender.track.id+"\r\n";f+="a="+g,f+="a=ssrc:"+a.sendEncodingParameters[0].ssrc+" "+g,a.sendEncodingParameters[0].rtx&&(f+="a=ssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" "+g,f+="a=ssrc-group:FID "+a.sendEncodingParameters[0].ssrc+" "+a.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return f+="a=ssrc:"+a.sendEncodingParameters[0].ssrc+" cname:"+d.localCName+"\r\n",a.rtpSender&&a.sendEncodingParameters[0].rtx&&(f+="a=ssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" cname:"+d.localCName+"\r\n"),f},d.getDirection=function(a,b){for(var c=d.splitLines(a),e=0;e<c.length;e++)switch(c[e]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[e].substr(2)}return b?d.getDirection(b):"sendrecv"},d.getKind=function(a){var b=d.splitLines(a),c=b[0].split(" ");return c[0].substr(2)},d.isRejected=function(a){return"0"===a.split(" ",2)[1]},b.exports=d},{}],2:[function(a,c,d){(function(b){"use strict";var d=a("./adapter_factory.js");c.exports=d({window:b.window})}).call(this,"undefined"!=typeof b?b:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./adapter_factory.js":3}],3:[function(a,b,c){"use strict";b.exports=function(b,c){var d=b&&b.window,e={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(var f in c)hasOwnProperty.call(c,f)&&(e[f]=c[f]);var g=a("./utils"),h=g.log,i=g.detectBrowser(d),j={browserDetails:i,extractVersion:g.extractVersion,disableLog:g.disableLog,disableWarnings:g.disableWarnings},k=a("./chrome/chrome_shim")||null,l=a("./edge/edge_shim")||null,m=a("./firefox/firefox_shim")||null,n=a("./safari/safari_shim")||null;switch(i.browser){case"chrome":if(!k||!k.shimPeerConnection||!e.shimChrome)return h("Chrome shim is not included in this adapter release."),j;h("adapter.js shimming chrome."),j.browserShim=k,k.shimGetUserMedia(d),k.shimMediaStream(d),g.shimCreateObjectURL(d),k.shimSourceObject(d),k.shimPeerConnection(d),k.shimOnTrack(d),k.shimAddTrackRemoveTrack(d),k.shimGetSendersWithDtmf(d);break;case"firefox":if(!m||!m.shimPeerConnection||!e.shimFirefox)return h("Firefox shim is not included in this adapter release."),j;h("adapter.js shimming firefox."),j.browserShim=m,m.shimGetUserMedia(d),g.shimCreateObjectURL(d),m.shimSourceObject(d),m.shimPeerConnection(d),m.shimOnTrack(d);break;case"edge":if(!l||!l.shimPeerConnection||!e.shimEdge)return h("MS edge shim is not included in this adapter release."),j;h("adapter.js shimming edge."),j.browserShim=l,l.shimGetUserMedia(d),g.shimCreateObjectURL(d),l.shimPeerConnection(d),l.shimReplaceTrack(d);break;case"safari":if(!n||!e.shimSafari)return h("Safari shim is not included in this adapter release."),j;h("adapter.js shimming safari."),j.browserShim=n,g.shimCreateObjectURL(d),n.shimRTCIceServerUrls(d),n.shimCallbacksAPI(d),n.shimLocalStreamsAPI(d),n.shimRemoteStreamsAPI(d),n.shimGetUserMedia(d);break;default:h("Unsupported browser!")}return j}},{"./chrome/chrome_shim":4,"./edge/edge_shim":6,"./firefox/firefox_shim":9,"./safari/safari_shim":11,"./utils":12}],4:[function(a,b,c){"use strict";var d=a("../utils.js"),e=d.log,f={shimMediaStream:function(a){a.MediaStream=a.MediaStream||a.webkitMediaStream},shimOnTrack:function(a){if("object"==typeof a&&a.RTCPeerConnection&&!("ontrack"in a.RTCPeerConnection.prototype)){Object.defineProperty(a.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(a){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=a)}});var b=a.RTCPeerConnection.prototype.setRemoteDescription;a.RTCPeerConnection.prototype.setRemoteDescription=function(){var c=this;return c._ontrackpoly||(c._ontrackpoly=function(b){b.stream.addEventListener("addtrack",function(d){var e;e=a.RTCPeerConnection.prototype.getReceivers?c.getReceivers().find(function(a){return a.track.id===d.track.id}):{track:d.track};var f=new Event("track");f.track=d.track,f.receiver=e,f.streams=[b.stream],c.dispatchEvent(f)}),b.stream.getTracks().forEach(function(d){var e;e=a.RTCPeerConnection.prototype.getReceivers?c.getReceivers().find(function(a){return a.track.id===d.id}):{track:d};var f=new Event("track");f.track=d,f.receiver=e,f.streams=[b.stream],c.dispatchEvent(f)})},c.addEventListener("addstream",c._ontrackpoly)),b.apply(c,arguments)}}},shimGetSendersWithDtmf:function(a){if("object"==typeof a&&a.RTCPeerConnection&&!("getSenders"in a.RTCPeerConnection.prototype)&&"createDTMFSender"in a.RTCPeerConnection.prototype){var b=function(a,b){return{track:b,get dtmf(){return void 0===this._dtmf&&("audio"===b.kind?this._dtmf=a.createDTMFSender(b):this._dtmf=null),this._dtmf},_pc:a}};if(!a.RTCPeerConnection.prototype.getSenders){a.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var c=a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addTrack=function(a,d){var e=this,f=c.apply(e,arguments);return f||(f=b(e,a),e._senders.push(f)),f};var d=a.RTCPeerConnection.prototype.removeTrack;a.RTCPeerConnection.prototype.removeTrack=function(a){var b=this;d.apply(b,arguments);var c=b._senders.indexOf(a);c!==-1&&b._senders.splice(c,1)}}var e=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(a){var c=this;c._senders=c._senders||[],e.apply(c,[a]),a.getTracks().forEach(function(a){c._senders.push(b(c,a))})};var f=a.RTCPeerConnection.prototype.removeStream;a.RTCPeerConnection.prototype.removeStream=function(a){var b=this;b._senders=b._senders||[],f.apply(b,[b._streams[a.id]||a]),a.getTracks().forEach(function(a){var c=b._senders.find(function(b){return b.track===a});c&&b._senders.splice(b._senders.indexOf(c),1)})}}else if("object"==typeof a&&a.RTCPeerConnection&&"getSenders"in a.RTCPeerConnection.prototype&&"createDTMFSender"in a.RTCPeerConnection.prototype&&a.RTCRtpSender&&!("dtmf"in a.RTCRtpSender.prototype)){var g=a.RTCPeerConnection.prototype.getSenders;a.RTCPeerConnection.prototype.getSenders=function(){var a=this,b=g.apply(a,[]);return b.forEach(function(b){b._pc=a}),b},Object.defineProperty(a.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},shimSourceObject:function(a){var b=a&&a.URL;"object"==typeof a&&(!a.HTMLMediaElement||"srcObject"in a.HTMLMediaElement.prototype||Object.defineProperty(a.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(a){var c=this;return this._srcObject=a,this.src&&b.revokeObjectURL(this.src),a?(this.src=b.createObjectURL(a),a.addEventListener("addtrack",function(){c.src&&b.revokeObjectURL(c.src),c.src=b.createObjectURL(a)}),void a.addEventListener("removetrack",function(){c.src&&b.revokeObjectURL(c.src),c.src=b.createObjectURL(a)})):void(this.src="")}}))},shimAddTrackRemoveTrack:function(a){if(!a.RTCPeerConnection.prototype.addTrack){var b=a.RTCPeerConnection.prototype.getLocalStreams;a.RTCPeerConnection.prototype.getLocalStreams=function(){var a=this,c=b.apply(this);return a._reverseStreams=a._reverseStreams||{},c.map(function(b){return a._reverseStreams[b.id]})};var c=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(b){var d=this;if(d._streams=d._streams||{},d._reverseStreams=d._reverseStreams||{},b.getTracks().forEach(function(a){var b=d.getSenders().find(function(b){return b.track===a});if(b)throw new DOMException("Track already exists.","InvalidAccessError")}),!d._reverseStreams[b.id]){var e=new a.MediaStream(b.getTracks());d._streams[b.id]=e,d._reverseStreams[e.id]=b,b=e}c.apply(d,[b])};var d=a.RTCPeerConnection.prototype.removeStream;a.RTCPeerConnection.prototype.removeStream=function(a){var b=this;b._streams=b._streams||{},b._reverseStreams=b._reverseStreams||{},d.apply(b,[b._streams[a.id]||a]),delete b._reverseStreams[b._streams[a.id]?b._streams[a.id].id:a.id],delete b._streams[a.id]},a.RTCPeerConnection.prototype.addTrack=function(b,c){var d=this;if("closed"===d.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var e=[].slice.call(arguments,1);if(1!==e.length||!e[0].getTracks().find(function(a){return a===b}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");var f=d.getSenders().find(function(a){return a.track===b});if(f)throw new DOMException("Track already exists.","InvalidAccessError");d._streams=d._streams||{},d._reverseStreams=d._reverseStreams||{};var g=d._streams[c.id];if(g)g.addTrack(b),d.dispatchEvent(new Event("negotiationneeded"));else{var h=new a.MediaStream([b]);d._streams[c.id]=h,d._reverseStreams[h.id]=c,d.addStream(h)}return d.getSenders().find(function(a){return a.track===b})},a.RTCPeerConnection.prototype.removeTrack=function(a){var b=this;if("closed"===b.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!a._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");var c=a._pc===b;if(!c)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");b._streams=b._streams||{};var d;Object.keys(b._streams).forEach(function(c){var e=b._streams[c].getTracks().find(function(b){return a.track===b});e&&(d=b._streams[c])}),d&&(1===d.getTracks().length?b.removeStream(d):d.removeTrack(a.track),b.dispatchEvent(new Event("negotiationneeded")))}}},shimPeerConnection:function(a){var b=d.detectBrowser(a);if(a.RTCPeerConnection){var c=a.RTCPeerConnection;a.RTCPeerConnection=function(a,b){if(a&&a.iceServers){for(var e=[],f=0;f<a.iceServers.length;f++){var g=a.iceServers[f];!g.hasOwnProperty("urls")&&g.hasOwnProperty("url")?(d.deprecated("RTCIceServer.url","RTCIceServer.urls"),g=JSON.parse(JSON.stringify(g)),g.urls=g.url,e.push(g)):e.push(a.iceServers[f])}a.iceServers=e}return new c(a,b)},a.RTCPeerConnection.prototype=c.prototype,Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get:function(){return c.generateCertificate}})}else a.RTCPeerConnection=function(b,c){return e("PeerConnection"),b&&b.iceTransportPolicy&&(b.iceTransports=b.iceTransportPolicy),new a.webkitRTCPeerConnection(b,c)},a.RTCPeerConnection.prototype=a.webkitRTCPeerConnection.prototype,a.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get:function(){return a.webkitRTCPeerConnection.generateCertificate}});var f=a.RTCPeerConnection.prototype.getStats;a.RTCPeerConnection.prototype.getStats=function(a,b,c){var d=this,e=arguments;if(arguments.length>0&&"function"==typeof a)return f.apply(this,arguments);if(0===f.length&&(0===arguments.length||"function"!=typeof arguments[0]))return f.apply(this,[]);var g=function(a){var b={},c=a.result();return c.forEach(function(a){var c={id:a.id,timestamp:a.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[a.type]||a.type};a.names().forEach(function(b){c[b]=a.stat(b)}),b[c.id]=c}),b},h=function(a){return new Map(Object.keys(a).map(function(b){return[b,a[b]]}))};if(arguments.length>=2){var i=function(a){e[1](h(g(a)))};return f.apply(this,[i,arguments[0]])}return new Promise(function(a,b){f.apply(d,[function(b){a(h(g(b)))},b])}).then(b,c)},b.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(b){var c=a.RTCPeerConnection.prototype[b];a.RTCPeerConnection.prototype[b]=function(){var a=arguments,b=this,d=new Promise(function(d,e){c.apply(b,[a[0],d,e])});return a.length<2?d:d.then(function(){a[1].apply(null,[])},function(b){a.length>=3&&a[2].apply(null,[b])})}}),b.version<52&&["createOffer","createAnswer"].forEach(function(b){var c=a.RTCPeerConnection.prototype[b];a.RTCPeerConnection.prototype[b]=function(){var a=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var b=1===arguments.length?arguments[0]:void 0;return new Promise(function(d,e){c.apply(a,[d,e,b])})}return c.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(b){var c=a.RTCPeerConnection.prototype[b];a.RTCPeerConnection.prototype[b]=function(){return arguments[0]=new("addIceCandidate"===b?a.RTCIceCandidate:a.RTCSessionDescription)(arguments[0]),c.apply(this,arguments)}});var g=a.RTCPeerConnection.prototype.addIceCandidate;a.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?g.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}};b.exports={shimMediaStream:f.shimMediaStream,shimOnTrack:f.shimOnTrack,shimAddTrackRemoveTrack:f.shimAddTrackRemoveTrack,shimGetSendersWithDtmf:f.shimGetSendersWithDtmf,shimSourceObject:f.shimSourceObject,
shimPeerConnection:f.shimPeerConnection,shimGetUserMedia:a("./getusermedia")}},{"../utils.js":12,"./getusermedia":5}],5:[function(a,b,c){"use strict";var d=a("../utils.js"),e=d.log;b.exports=function(a){var b=d.detectBrowser(a),c=a&&a.navigator,f=function(a){if("object"!=typeof a||a.mandatory||a.optional)return a;var b={};return Object.keys(a).forEach(function(c){if("require"!==c&&"advanced"!==c&&"mediaSource"!==c){var d="object"==typeof a[c]?a[c]:{ideal:a[c]};void 0!==d.exact&&"number"==typeof d.exact&&(d.min=d.max=d.exact);var e=function(a,b){return a?a+b.charAt(0).toUpperCase()+b.slice(1):"deviceId"===b?"sourceId":b};if(void 0!==d.ideal){b.optional=b.optional||[];var f={};"number"==typeof d.ideal?(f[e("min",c)]=d.ideal,b.optional.push(f),f={},f[e("max",c)]=d.ideal,b.optional.push(f)):(f[e("",c)]=d.ideal,b.optional.push(f))}void 0!==d.exact&&"number"!=typeof d.exact?(b.mandatory=b.mandatory||{},b.mandatory[e("",c)]=d.exact):["min","max"].forEach(function(a){void 0!==d[a]&&(b.mandatory=b.mandatory||{},b.mandatory[e(a,c)]=d[a])})}}),a.advanced&&(b.optional=(b.optional||[]).concat(a.advanced)),b},g=function(a,d){if(a=JSON.parse(JSON.stringify(a)),a&&"object"==typeof a.audio){var g=function(a,b,c){b in a&&!(c in a)&&(a[c]=a[b],delete a[b])};a=JSON.parse(JSON.stringify(a)),g(a.audio,"autoGainControl","googAutoGainControl"),g(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=f(a.audio)}if(a&&"object"==typeof a.video){var h=a.video.facingMode;h=h&&("object"==typeof h?h:{ideal:h});var i=b.version<61;if(h&&("user"===h.exact||"environment"===h.exact||"user"===h.ideal||"environment"===h.ideal)&&(!c.mediaDevices.getSupportedConstraints||!c.mediaDevices.getSupportedConstraints().facingMode||i)){delete a.video.facingMode;var j;if("environment"===h.exact||"environment"===h.ideal?j=["back","rear"]:"user"!==h.exact&&"user"!==h.ideal||(j=["front"]),j)return c.mediaDevices.enumerateDevices().then(function(b){b=b.filter(function(a){return"videoinput"===a.kind});var c=b.find(function(a){return j.some(function(b){return a.label.toLowerCase().indexOf(b)!==-1})});return!c&&b.length&&j.indexOf("back")!==-1&&(c=b[b.length-1]),c&&(a.video.deviceId=h.exact?{exact:c.deviceId}:{ideal:c.deviceId}),a.video=f(a.video),e("chrome: "+JSON.stringify(a)),d(a)})}a.video=f(a.video)}return e("chrome: "+JSON.stringify(a)),d(a)},h=function(a){return{name:{PermissionDeniedError:"NotAllowedError",InvalidStateError:"NotReadableError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotReadableError",MediaDeviceKillSwitchOn:"NotReadableError"}[a.name]||a.name,message:a.message,constraint:a.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}},i=function(a,b,d){g(a,function(a){c.webkitGetUserMedia(a,b,function(a){d(h(a))})})};c.getUserMedia=i;var j=function(a){return new Promise(function(b,d){c.getUserMedia(a,b,d)})};if(c.mediaDevices||(c.mediaDevices={getUserMedia:j,enumerateDevices:function(){return new Promise(function(b){var c={audio:"audioinput",video:"videoinput"};return a.MediaStreamTrack.getSources(function(a){b(a.map(function(a){return{label:a.label,kind:c[a.kind],deviceId:a.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),c.mediaDevices.getUserMedia){var k=c.mediaDevices.getUserMedia.bind(c.mediaDevices);c.mediaDevices.getUserMedia=function(a){return g(a,function(a){return k(a).then(function(b){if(a.audio&&!b.getAudioTracks().length||a.video&&!b.getVideoTracks().length)throw b.getTracks().forEach(function(a){a.stop()}),new DOMException("","NotFoundError");return b},function(a){return Promise.reject(h(a))})})}}else c.mediaDevices.getUserMedia=function(a){return j(a)};"undefined"==typeof c.mediaDevices.addEventListener&&(c.mediaDevices.addEventListener=function(){e("Dummy mediaDevices.addEventListener called.")}),"undefined"==typeof c.mediaDevices.removeEventListener&&(c.mediaDevices.removeEventListener=function(){e("Dummy mediaDevices.removeEventListener called.")})}},{"../utils.js":12}],6:[function(a,b,c){"use strict";var d=a("../utils"),e=a("./rtcpeerconnection_shim");b.exports={shimGetUserMedia:a("./getusermedia"),shimPeerConnection:function(a){var b=d.detectBrowser(a);if(a.RTCIceGatherer&&(a.RTCIceCandidate||(a.RTCIceCandidate=function(a){return a}),a.RTCSessionDescription||(a.RTCSessionDescription=function(a){return a}),b.version<15025)){var c=Object.getOwnPropertyDescriptor(a.MediaStreamTrack.prototype,"enabled");Object.defineProperty(a.MediaStreamTrack.prototype,"enabled",{set:function(a){c.set.call(this,a);var b=new Event("enabled");b.enabled=a,this.dispatchEvent(b)}})}!a.RTCRtpSender||"dtmf"in a.RTCRtpSender.prototype||Object.defineProperty(a.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new a.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),a.RTCPeerConnection=e(a,b.version)},shimReplaceTrack:function(a){!a.RTCRtpSender||"replaceTrack"in a.RTCRtpSender.prototype||(a.RTCRtpSender.prototype.replaceTrack=a.RTCRtpSender.prototype.setTrack)}}},{"../utils":12,"./getusermedia":7,"./rtcpeerconnection_shim":8}],7:[function(a,b,c){"use strict";b.exports=function(a){var b=a&&a.navigator,c=function(a){return{name:{PermissionDeniedError:"NotAllowedError"}[a.name]||a.name,message:a.message,constraint:a.constraint,toString:function(){return this.name}}},d=b.mediaDevices.getUserMedia.bind(b.mediaDevices);b.mediaDevices.getUserMedia=function(a){return d(a)["catch"](function(a){return Promise.reject(c(a))})}}},{}],8:[function(a,b,c){"use strict";function d(a){var b=a.filter(function(a){return"audio"===a.kind}),c=a.filter(function(a){return"video"===a.kind});for(a=[];b.length||c.length;)b.length&&a.push(b.shift()),c.length&&a.push(c.shift());return a}function e(a,b){var c=!1;return a=JSON.parse(JSON.stringify(a)),a.filter(function(a){if(a&&(a.urls||a.url)){var d=a.urls||a.url;a.url&&!a.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var e="string"==typeof d;return e&&(d=[d]),d=d.filter(function(a){var d=0===a.indexOf("turn:")&&a.indexOf("transport=udp")!==-1&&a.indexOf("turn:[")===-1&&!c;return d?(c=!0,!0):0===a.indexOf("stun:")&&b>=14393}),delete a.url,a.urls=e?d[0]:d,!!d.length}return!1})}function f(a,b){var c={codecs:[],headerExtensions:[],fecMechanisms:[]},d=function(a,b){a=parseInt(a,10);for(var c=0;c<b.length;c++)if(b[c].payloadType===a||b[c].preferredPayloadType===a)return b[c]},e=function(a,b,c,e){var f=d(a.parameters.apt,c),g=d(b.parameters.apt,e);return f&&g&&f.name.toLowerCase()===g.name.toLowerCase()};return a.codecs.forEach(function(d){for(var f=0;f<b.codecs.length;f++){var g=b.codecs[f];if(d.name.toLowerCase()===g.name.toLowerCase()&&d.clockRate===g.clockRate){if("rtx"===d.name.toLowerCase()&&d.parameters&&g.parameters.apt&&!e(d,g,a.codecs,b.codecs))continue;g=JSON.parse(JSON.stringify(g)),g.numChannels=Math.min(d.numChannels,g.numChannels),c.codecs.push(g),g.rtcpFeedback=g.rtcpFeedback.filter(function(a){for(var b=0;b<d.rtcpFeedback.length;b++)if(d.rtcpFeedback[b].type===a.type&&d.rtcpFeedback[b].parameter===a.parameter)return!0;return!1});break}}}),a.headerExtensions.forEach(function(a){for(var d=0;d<b.headerExtensions.length;d++){var e=b.headerExtensions[d];if(a.uri===e.uri){c.headerExtensions.push(e);break}}}),c}function g(a,b,c){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[b][a].indexOf(c)!==-1}var h=a("sdp");b.exports=function(a,b){var c=function(c){var d=this,f=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(a){d[a]=f[a].bind(f)}),this.needNegotiation=!1,this.onicecandidate=null,this.onaddstream=null,this.ontrack=null,this.onremovestream=null,this.onsignalingstatechange=null,this.oniceconnectionstatechange=null,this.onicegatheringstatechange=null,this.onnegotiationneeded=null,this.ondatachannel=null,this.canTrickleIceCandidates=null,this.localStreams=[],this.remoteStreams=[],this.getLocalStreams=function(){return d.localStreams},this.getRemoteStreams=function(){return d.remoteStreams},this.localDescription=new a.RTCSessionDescription({type:"",sdp:""}),this.remoteDescription=new a.RTCSessionDescription({type:"",sdp:""}),this.signalingState="stable",this.iceConnectionState="new",this.iceGatheringState="new",this.iceOptions={gatherPolicy:"all",iceServers:[]},c&&c.iceTransportPolicy)switch(c.iceTransportPolicy){case"all":case"relay":this.iceOptions.gatherPolicy=c.iceTransportPolicy}this.usingBundle=c&&"max-bundle"===c.bundlePolicy,c&&c.iceServers&&(this.iceOptions.iceServers=e(c.iceServers,b)),this._config=c||{},this.transceivers=[],this._localIceCandidatesBuffer=[],this._sdpSessionId=h.generateSessionId()};return c.prototype._emitGatheringStateChange=function(){var a=new Event("icegatheringstatechange");this.dispatchEvent(a),null!==this.onicegatheringstatechange&&this.onicegatheringstatechange(a)},c.prototype._emitBufferedCandidates=function(){var a=this,b=h.splitSections(a.localDescription.sdp);this._localIceCandidatesBuffer.forEach(function(c){var d=!c.candidate||0===Object.keys(c.candidate).length;if(d)for(var e=1;e<b.length;e++)b[e].indexOf("\r\na=end-of-candidates\r\n")===-1&&(b[e]+="a=end-of-candidates\r\n");else b[c.candidate.sdpMLineIndex+1]+="a="+c.candidate.candidate+"\r\n";if(a.localDescription.sdp=b.join(""),a.dispatchEvent(c),null!==a.onicecandidate&&a.onicecandidate(c),!c.candidate&&"complete"!==a.iceGatheringState){var f=a.transceivers.every(function(a){return a.iceGatherer&&"completed"===a.iceGatherer.state});f&&"complete"!==a.iceGatheringStateChange&&(a.iceGatheringState="complete",a._emitGatheringStateChange())}}),this._localIceCandidatesBuffer=[]},c.prototype.getConfiguration=function(){return this._config},c.prototype._createTransceiver=function(a){var b=this.transceivers.length>0,c={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:a,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,wantReceive:!0};if(this.usingBundle&&b)c.iceTransport=this.transceivers[0].iceTransport,c.dtlsTransport=this.transceivers[0].dtlsTransport;else{var d=this._createIceAndDtlsTransports();c.iceTransport=d.iceTransport,c.dtlsTransport=d.dtlsTransport}return this.transceivers.push(c),c},c.prototype.addTrack=function(b,c){for(var d,e=0;e<this.transceivers.length;e++)this.transceivers[e].track||this.transceivers[e].kind!==b.kind||(d=this.transceivers[e]);return d||(d=this._createTransceiver(b.kind)),d.track=b,d.stream=c,d.rtpSender=new a.RTCRtpSender(b,d.dtlsTransport),this._maybeFireNegotiationNeeded(),d.rtpSender},c.prototype.addStream=function(a){var c=this;if(b>=15025)this.localStreams.push(a),a.getTracks().forEach(function(b){c.addTrack(b,a)});else{var d=a.clone();a.getTracks().forEach(function(a,b){var c=d.getTracks()[b];a.addEventListener("enabled",function(a){c.enabled=a.enabled})}),d.getTracks().forEach(function(a){c.addTrack(a,d)}),this.localStreams.push(d)}this._maybeFireNegotiationNeeded()},c.prototype.removeStream=function(a){var b=this.localStreams.indexOf(a);b>-1&&(this.localStreams.splice(b,1),this._maybeFireNegotiationNeeded())},c.prototype.getSenders=function(){return this.transceivers.filter(function(a){return!!a.rtpSender}).map(function(a){return a.rtpSender})},c.prototype.getReceivers=function(){return this.transceivers.filter(function(a){return!!a.rtpReceiver}).map(function(a){return a.rtpReceiver})},c.prototype._createIceGatherer=function(b,c){var d=this,e=new a.RTCIceGatherer(d.iceOptions);return e.onlocalcandidate=function(a){var f=new Event("icecandidate");f.candidate={sdpMid:b,sdpMLineIndex:c};var g=a.candidate,i=!g||0===Object.keys(g).length;i?void 0===e.state&&(e.state="completed"):(g.component=1,f.candidate.candidate=h.writeCandidate(g));var j=h.splitSections(d.localDescription.sdp);i?j[f.candidate.sdpMLineIndex+1]+="a=end-of-candidates\r\n":j[f.candidate.sdpMLineIndex+1]+="a="+f.candidate.candidate+"\r\n",d.localDescription.sdp=j.join("");var k=d._pendingOffer?d._pendingOffer:d.transceivers,l=k.every(function(a){return a.iceGatherer&&"completed"===a.iceGatherer.state});switch(d.iceGatheringState){case"new":i||d._localIceCandidatesBuffer.push(f),i&&l&&d._localIceCandidatesBuffer.push(new Event("icecandidate"));break;case"gathering":d._emitBufferedCandidates(),i||(d.dispatchEvent(f),null!==d.onicecandidate&&d.onicecandidate(f)),l&&(d.dispatchEvent(new Event("icecandidate")),null!==d.onicecandidate&&d.onicecandidate(new Event("icecandidate")),d.iceGatheringState="complete",d._emitGatheringStateChange());break;case"complete":}},e},c.prototype._createIceAndDtlsTransports=function(){var b=this,c=new a.RTCIceTransport(null);c.onicestatechange=function(){b._updateConnectionState()};var d=new a.RTCDtlsTransport(c);return d.ondtlsstatechange=function(){b._updateConnectionState()},d.onerror=function(){Object.defineProperty(d,"state",{value:"failed",writable:!0}),b._updateConnectionState()},{iceTransport:c,dtlsTransport:d}},c.prototype._disposeIceAndDtlsTransports=function(a){var b=this.transceivers[a].iceGatherer;b&&(delete b.onlocalcandidate,delete this.transceivers[a].iceGatherer);var c=this.transceivers[a].iceTransport;c&&(delete c.onicestatechange,delete this.transceivers[a].iceTransport);var d=this.transceivers[a].dtlsTransport;d&&(delete d.ondtlsstatechange,delete d.onerror,delete this.transceivers[a].dtlsTransport)},c.prototype._transceive=function(a,c,d){var e=f(a.localCapabilities,a.remoteCapabilities);c&&a.rtpSender&&(e.encodings=a.sendEncodingParameters,e.rtcp={cname:h.localCName,compound:a.rtcpParameters.compound},a.recvEncodingParameters.length&&(e.rtcp.ssrc=a.recvEncodingParameters[0].ssrc),a.rtpSender.send(e)),d&&a.rtpReceiver&&("video"===a.kind&&a.recvEncodingParameters&&b<15019&&a.recvEncodingParameters.forEach(function(a){delete a.rtx}),e.encodings=a.recvEncodingParameters,e.rtcp={cname:a.rtcpParameters.cname,compound:a.rtcpParameters.compound},a.sendEncodingParameters.length&&(e.rtcp.ssrc=a.sendEncodingParameters[0].ssrc),a.rtpReceiver.receive(e))},c.prototype.setLocalDescription=function(b){var c=this;if(!g("setLocalDescription",b.type,this.signalingState)){var d=new Error("Can not set local "+b.type+" in state "+this.signalingState);return d.name="InvalidStateError",arguments.length>2&&"function"==typeof arguments[2]&&a.setTimeout(arguments[2],0,d),Promise.reject(d)}var e,i;if("offer"===b.type)this._pendingOffer&&(e=h.splitSections(b.sdp),i=e.shift(),e.forEach(function(a,b){var d=h.parseRtpParameters(a);c._pendingOffer[b].localCapabilities=d}),this.transceivers=this._pendingOffer,delete this._pendingOffer);else if("answer"===b.type){e=h.splitSections(c.remoteDescription.sdp),i=e.shift();var j=h.matchPrefix(i,"a=ice-lite").length>0;e.forEach(function(a,b){var d=c.transceivers[b],e=d.iceGatherer,g=d.iceTransport,k=d.dtlsTransport,l=d.localCapabilities,m=d.remoteCapabilities,n=h.isRejected(a);if(!n&&!d.isDatachannel){var o=h.getIceParameters(a,i),p=h.getDtlsParameters(a,i);j&&(p.role="server"),c.usingBundle&&0!==b||(g.start(e,o,j?"controlling":"controlled"),k.start(p));var q=f(l,m);c._transceive(d,q.codecs.length>0,!1)}})}switch(this.localDescription={type:b.type,sdp:b.sdp},b.type){case"offer":this._updateSignalingState("have-local-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+b.type+'"')}var k=arguments.length>1&&"function"==typeof arguments[1];if(k){var l=arguments[1];a.setTimeout(function(){l(),"new"===c.iceGatheringState&&(c.iceGatheringState="gathering",c._emitGatheringStateChange()),c._emitBufferedCandidates()},0)}var m=Promise.resolve();return m.then(function(){k||("new"===c.iceGatheringState&&(c.iceGatheringState="gathering",c._emitGatheringStateChange()),a.setTimeout(c._emitBufferedCandidates.bind(c),500))}),m},c.prototype.setRemoteDescription=function(c){var d=this;if(!g("setRemoteDescription",c.type,this.signalingState)){var e=new Error("Can not set remote "+c.type+" in state "+this.signalingState);return e.name="InvalidStateError",arguments.length>2&&"function"==typeof arguments[2]&&a.setTimeout(arguments[2],0,e),Promise.reject(e)}var f={},i=[],j=h.splitSections(c.sdp),k=j.shift(),l=h.matchPrefix(k,"a=ice-lite").length>0,m=h.matchPrefix(k,"a=group:BUNDLE ").length>0;this.usingBundle=m;var n=h.matchPrefix(k,"a=ice-options:")[0];switch(n?this.canTrickleIceCandidates=n.substr(14).split(" ").indexOf("trickle")>=0:this.canTrickleIceCandidates=!1,j.forEach(function(e,g){var j=h.splitLines(e),n=h.getKind(e),o=h.isRejected(e),p=j[0].substr(2).split(" ")[2],q=h.getDirection(e,k),r=h.parseMsid(e),s=h.getMid(e)||h.generateIdentifier();if("application"===n&&"DTLS/SCTP"===p)return void(d.transceivers[g]={mid:s,isDatachannel:!0});var t,u,v,w,x,y,z,A,B,C,D,E=h.parseRtpParameters(e);o||(C=h.getIceParameters(e,k),D=h.getDtlsParameters(e,k),D.role="client"),z=h.parseRtpEncodingParameters(e);var F=h.parseRtcpParameters(e),G=h.matchPrefix(e,"a=end-of-candidates",k).length>0,H=h.matchPrefix(e,"a=candidate:").map(function(a){return h.parseCandidate(a)}).filter(function(a){return"1"===a.component||1===a.component});("offer"===c.type||"answer"===c.type)&&!o&&m&&g>0&&d.transceivers[g]&&(d._disposeIceAndDtlsTransports(g),d.transceivers[g].iceGatherer=d.transceivers[0].iceGatherer,d.transceivers[g].iceTransport=d.transceivers[0].iceTransport,d.transceivers[g].dtlsTransport=d.transceivers[0].dtlsTransport,d.transceivers[g].rtpSender&&d.transceivers[g].rtpSender.setTransport(d.transceivers[0].dtlsTransport),d.transceivers[g].rtpReceiver&&d.transceivers[g].rtpReceiver.setTransport(d.transceivers[0].dtlsTransport)),"offer"!==c.type||o?"answer"!==c.type||o||(t=d.transceivers[g],u=t.iceGatherer,v=t.iceTransport,w=t.dtlsTransport,x=t.rtpReceiver,y=t.sendEncodingParameters,A=t.localCapabilities,d.transceivers[g].recvEncodingParameters=z,d.transceivers[g].remoteCapabilities=E,d.transceivers[g].rtcpParameters=F,m&&0!==g||((l||G)&&H.length&&v.setRemoteCandidates(H),v.start(u,C,"controlling"),w.start(D)),d._transceive(t,"sendrecv"===q||"recvonly"===q,"sendrecv"===q||"sendonly"===q),!x||"sendrecv"!==q&&"sendonly"!==q?delete t.rtpReceiver:(B=x.track,r?(f[r.stream]||(f[r.stream]=new a.MediaStream),f[r.stream].addTrack(B),i.push([B,x,f[r.stream]])):(f["default"]||(f["default"]=new a.MediaStream),f["default"].addTrack(B),i.push([B,x,f["default"]])))):(t=d.transceivers[g]||d._createTransceiver(n),t.mid=s,t.iceGatherer||(t.iceGatherer=m&&g>0?d.transceivers[0].iceGatherer:d._createIceGatherer(s,g)),!G||!H.length||m&&0!==g||t.iceTransport.setRemoteCandidates(H),A=a.RTCRtpReceiver.getCapabilities(n),b<15019&&(A.codecs=A.codecs.filter(function(a){return"rtx"!==a.name})),y=[{ssrc:1001*(2*g+2)}],"sendrecv"!==q&&"sendonly"!==q||(x=new a.RTCRtpReceiver(t.dtlsTransport,n),B=x.track,r?(f[r.stream]||(f[r.stream]=new a.MediaStream,Object.defineProperty(f[r.stream],"id",{get:function(){return r.stream}})),Object.defineProperty(B,"id",{get:function(){return r.track}}),f[r.stream].addTrack(B),i.push([B,x,f[r.stream]])):(f["default"]||(f["default"]=new a.MediaStream),f["default"].addTrack(B),i.push([B,x,f["default"]]))),t.localCapabilities=A,t.remoteCapabilities=E,t.rtpReceiver=x,t.rtcpParameters=F,t.sendEncodingParameters=y,t.recvEncodingParameters=z,d._transceive(d.transceivers[g],!1,"sendrecv"===q||"sendonly"===q))}),this.remoteDescription={type:c.type,sdp:c.sdp},c.type){case"offer":this._updateSignalingState("have-remote-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+c.type+'"')}return Object.keys(f).forEach(function(b){var c=f[b];if(c.getTracks().length){d.remoteStreams.push(c);var e=new Event("addstream");e.stream=c,d.dispatchEvent(e),null!==d.onaddstream&&a.setTimeout(function(){d.onaddstream(e)},0),i.forEach(function(b){var e=b[0],f=b[1];if(c.id===b[2].id){var g=new Event("track");g.track=e,g.receiver=f,g.streams=[c],d.dispatchEvent(g),null!==d.ontrack&&a.setTimeout(function(){d.ontrack(g)},0)}})}}),a.setTimeout(function(){d&&d.transceivers&&d.transceivers.forEach(function(a){a.iceTransport&&"new"===a.iceTransport.state&&a.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),a.iceTransport.addRemoteCandidate({}))})},4e3),arguments.length>1&&"function"==typeof arguments[1]&&a.setTimeout(arguments[1],0),Promise.resolve()},c.prototype.close=function(){this.transceivers.forEach(function(a){a.iceTransport&&a.iceTransport.stop(),a.dtlsTransport&&a.dtlsTransport.stop(),a.rtpSender&&a.rtpSender.stop(),a.rtpReceiver&&a.rtpReceiver.stop()}),this._updateSignalingState("closed")},c.prototype._updateSignalingState=function(a){this.signalingState=a;var b=new Event("signalingstatechange");this.dispatchEvent(b),null!==this.onsignalingstatechange&&this.onsignalingstatechange(b)},c.prototype._maybeFireNegotiationNeeded=function(){var b=this;"stable"===this.signalingState&&this.needNegotiation!==!0&&(this.needNegotiation=!0,a.setTimeout(function(){if(b.needNegotiation!==!1){b.needNegotiation=!1;var a=new Event("negotiationneeded");b.dispatchEvent(a),null!==b.onnegotiationneeded&&b.onnegotiationneeded(a)}},0))},c.prototype._updateConnectionState=function(){var a,b=this,c={"new":0,closed:0,connecting:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(a){c[a.iceTransport.state]++,c[a.dtlsTransport.state]++}),c.connected+=c.completed,a="new",c.failed>0?a="failed":c.connecting>0||c.checking>0?a="connecting":c.disconnected>0?a="disconnected":c["new"]>0?a="new":(c.connected>0||c.completed>0)&&(a="connected"),a!==b.iceConnectionState){b.iceConnectionState=a;var d=new Event("iceconnectionstatechange");this.dispatchEvent(d),null!==this.oniceconnectionstatechange&&this.oniceconnectionstatechange(d)}},c.prototype.createOffer=function(){var c=this;if(this._pendingOffer)throw new Error("createOffer called while there is a pending offer.");var e;1===arguments.length&&"function"!=typeof arguments[0]?e=arguments[0]:3===arguments.length&&(e=arguments[2]);var f=this.transceivers.filter(function(a){return"audio"===a.kind}).length,g=this.transceivers.filter(function(a){return"video"===a.kind}).length;if(e){if(e.mandatory||e.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==e.offerToReceiveAudio&&(f=e.offerToReceiveAudio===!0?1:e.offerToReceiveAudio===!1?0:e.offerToReceiveAudio),void 0!==e.offerToReceiveVideo&&(g=e.offerToReceiveVideo===!0?1:e.offerToReceiveVideo===!1?0:e.offerToReceiveVideo)}for(this.transceivers.forEach(function(a){"audio"===a.kind?(f--,f<0&&(a.wantReceive=!1)):"video"===a.kind&&(g--,g<0&&(a.wantReceive=!1))});f>0||g>0;)f>0&&(this._createTransceiver("audio"),f--),g>0&&(this._createTransceiver("video"),g--);var i=d(this.transceivers),j=h.writeSessionBoilerplate(this._sdpSessionId);i.forEach(function(d,e){var f=d.track,g=d.kind,j=h.generateIdentifier();d.mid=j,d.iceGatherer||(d.iceGatherer=c.usingBundle&&e>0?i[0].iceGatherer:c._createIceGatherer(j,e));var k=a.RTCRtpSender.getCapabilities(g);b<15019&&(k.codecs=k.codecs.filter(function(a){return"rtx"!==a.name})),k.codecs.forEach(function(a){"H264"===a.name&&void 0===a.parameters["level-asymmetry-allowed"]&&(a.parameters["level-asymmetry-allowed"]="1")});var l=[{ssrc:1001*(2*e+1)}];f&&b>=15019&&"video"===g&&(l[0].rtx={ssrc:1001*(2*e+1)+1}),d.wantReceive&&(d.rtpReceiver=new a.RTCRtpReceiver(d.dtlsTransport,g)),d.localCapabilities=k,d.sendEncodingParameters=l}),"max-compat"!==this._config.bundlePolicy&&(j+="a=group:BUNDLE "+i.map(function(a){return a.mid}).join(" ")+"\r\n"),j+="a=ice-options:trickle\r\n",i.forEach(function(a,b){j+=h.writeMediaSection(a,a.localCapabilities,"offer",a.stream),j+="a=rtcp-rsize\r\n"}),this._pendingOffer=i;var k=new a.RTCSessionDescription({type:"offer",sdp:j});return arguments.length&&"function"==typeof arguments[0]&&a.setTimeout(arguments[0],0,k),Promise.resolve(k)},c.prototype.createAnswer=function(){var c=h.writeSessionBoilerplate(this._sdpSessionId);this.usingBundle&&(c+="a=group:BUNDLE "+this.transceivers.map(function(a){return a.mid}).join(" ")+"\r\n"),this.transceivers.forEach(function(a,d){if(a.isDatachannel)return void(c+="m=application 0 DTLS/SCTP 5000\r\nc=IN IP4 0.0.0.0\r\na=mid:"+a.mid+"\r\n");if(a.stream){var e;"audio"===a.kind?e=a.stream.getAudioTracks()[0]:"video"===a.kind&&(e=a.stream.getVideoTracks()[0]),e&&b>=15019&&"video"===a.kind&&(a.sendEncodingParameters[0].rtx={ssrc:1001*(2*d+2)+1})}var g=f(a.localCapabilities,a.remoteCapabilities),i=g.codecs.filter(function(a){return"rtx"===a.name.toLowerCase()}).length;!i&&a.sendEncodingParameters[0].rtx&&delete a.sendEncodingParameters[0].rtx,c+=h.writeMediaSection(a,g,"answer",a.stream),a.rtcpParameters&&a.rtcpParameters.reducedSize&&(c+="a=rtcp-rsize\r\n")});var d=new a.RTCSessionDescription({type:"answer",sdp:c});return arguments.length&&"function"==typeof arguments[0]&&a.setTimeout(arguments[0],0,d),Promise.resolve(d)},c.prototype.addIceCandidate=function(b){if(b){var c=b.sdpMLineIndex;if(b.sdpMid)for(var d=0;d<this.transceivers.length;d++)if(this.transceivers[d].mid===b.sdpMid){c=d;break}var e=this.transceivers[c];if(e){var f=Object.keys(b.candidate).length>0?h.parseCandidate(b.candidate):{};if("tcp"===f.protocol&&(0===f.port||9===f.port))return Promise.resolve();if(f.component&&"1"!==f.component&&1!==f.component)return Promise.resolve();e.iceTransport.addRemoteCandidate(f);var g=h.splitSections(this.remoteDescription.sdp);g[c+1]+=(f.type?b.candidate.trim():"a=end-of-candidates")+"\r\n",this.remoteDescription.sdp=g.join("")}}else for(var i=0;i<this.transceivers.length;i++)if(this.transceivers[i].iceTransport.addRemoteCandidate({}),this.usingBundle)return Promise.resolve();return arguments.length>1&&"function"==typeof arguments[1]&&a.setTimeout(arguments[1],0),Promise.resolve()},c.prototype.getStats=function(){var b=[];this.transceivers.forEach(function(a){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(c){a[c]&&b.push(a[c].getStats())})});var c=arguments.length>1&&"function"==typeof arguments[1]&&arguments[1],d=function(a){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[a.type]||a.type};return new Promise(function(e){var f=new Map;Promise.all(b).then(function(b){b.forEach(function(a){Object.keys(a).forEach(function(b){a[b].type=d(a[b]),f.set(b,a[b])})}),c&&a.setTimeout(c,0,f),e(f)})})},c}},{sdp:1}],9:[function(a,b,c){"use strict";var d=a("../utils"),e={shimOnTrack:function(a){"object"!=typeof a||!a.RTCPeerConnection||"ontrack"in a.RTCPeerConnection.prototype||Object.defineProperty(a.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(a){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=a),this.addEventListener("addstream",this._ontrackpoly=function(a){a.stream.getTracks().forEach(function(b){var c=new Event("track");c.track=b,c.receiver={track:b},c.streams=[a.stream],this.dispatchEvent(c)}.bind(this))}.bind(this))}})},shimSourceObject:function(a){"object"==typeof a&&(!a.HTMLMediaElement||"srcObject"in a.HTMLMediaElement.prototype||Object.defineProperty(a.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(a){this.mozSrcObject=a}}))},shimPeerConnection:function(a){var b=d.detectBrowser(a);if("object"==typeof a&&(a.RTCPeerConnection||a.mozRTCPeerConnection)){a.RTCPeerConnection||(a.RTCPeerConnection=function(c,d){if(b.version<38&&c&&c.iceServers){for(var e=[],f=0;f<c.iceServers.length;f++){var g=c.iceServers[f];if(g.hasOwnProperty("urls"))for(var h=0;h<g.urls.length;h++){var i={url:g.urls[h]};0===g.urls[h].indexOf("turn")&&(i.username=g.username,i.credential=g.credential),e.push(i)}else e.push(c.iceServers[f])}c.iceServers=e}return new a.mozRTCPeerConnection(c,d)},a.RTCPeerConnection.prototype=a.mozRTCPeerConnection.prototype,a.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get:function(){return a.mozRTCPeerConnection.generateCertificate}}),a.RTCSessionDescription=a.mozRTCSessionDescription,a.RTCIceCandidate=a.mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(b){var c=a.RTCPeerConnection.prototype[b];a.RTCPeerConnection.prototype[b]=function(){return arguments[0]=new("addIceCandidate"===b?a.RTCIceCandidate:a.RTCSessionDescription)(arguments[0]),c.apply(this,arguments)}});var c=a.RTCPeerConnection.prototype.addIceCandidate;a.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?c.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var e=function(a){var b=new Map;return Object.keys(a).forEach(function(c){b.set(c,a[c]),b[c]=a[c]}),b},f={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},g=a.RTCPeerConnection.prototype.getStats;a.RTCPeerConnection.prototype.getStats=function(a,c,d){return g.apply(this,[a||null]).then(function(a){if(b.version<48&&(a=e(a)),b.version<53&&!c)try{a.forEach(function(a){a.type=f[a.type]||a.type})}catch(d){if("TypeError"!==d.name)throw d;a.forEach(function(b,c){a.set(c,Object.assign({},b,{type:f[b.type]||b.type}))})}return a}).then(c,d)}}}};b.exports={shimOnTrack:e.shimOnTrack,shimSourceObject:e.shimSourceObject,shimPeerConnection:e.shimPeerConnection,shimGetUserMedia:a("./getusermedia")}},{"../utils":12,"./getusermedia":10}],10:[function(a,b,c){"use strict";var d=a("../utils"),e=d.log;b.exports=function(a){var b=d.detectBrowser(a),c=a&&a.navigator,f=a&&a.MediaStreamTrack,g=function(a){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[a.name]||a.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[a.message]||a.message,constraint:a.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},h=function(a,d,f){var h=function(a){if("object"!=typeof a||a.require)return a;var b=[];return Object.keys(a).forEach(function(c){if("require"!==c&&"advanced"!==c&&"mediaSource"!==c){var d=a[c]="object"==typeof a[c]?a[c]:{ideal:a[c]};if(void 0===d.min&&void 0===d.max&&void 0===d.exact||b.push(c),void 0!==d.exact&&("number"==typeof d.exact?d.min=d.max=d.exact:a[c]=d.exact,delete d.exact),void 0!==d.ideal){a.advanced=a.advanced||[];var e={};"number"==typeof d.ideal?e[c]={min:d.ideal,max:d.ideal}:e[c]=d.ideal,a.advanced.push(e),delete d.ideal,Object.keys(d).length||delete a[c]}}}),b.length&&(a.require=b),a};return a=JSON.parse(JSON.stringify(a)),b.version<38&&(e("spec: "+JSON.stringify(a)),a.audio&&(a.audio=h(a.audio)),a.video&&(a.video=h(a.video)),e("ff37: "+JSON.stringify(a))),c.mozGetUserMedia(a,d,function(a){f(g(a))})},i=function(a){return new Promise(function(b,c){h(a,b,c)})};if(c.mediaDevices||(c.mediaDevices={getUserMedia:i,addEventListener:function(){},removeEventListener:function(){}}),c.mediaDevices.enumerateDevices=c.mediaDevices.enumerateDevices||function(){return new Promise(function(a){var b=[{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}];a(b);
})},b.version<41){var j=c.mediaDevices.enumerateDevices.bind(c.mediaDevices);c.mediaDevices.enumerateDevices=function(){return j().then(void 0,function(a){if("NotFoundError"===a.name)return[];throw a})}}if(b.version<49){var k=c.mediaDevices.getUserMedia.bind(c.mediaDevices);c.mediaDevices.getUserMedia=function(a){return k(a).then(function(b){if(a.audio&&!b.getAudioTracks().length||a.video&&!b.getVideoTracks().length)throw b.getTracks().forEach(function(a){a.stop()}),new DOMException("The object can not be found here.","NotFoundError");return b},function(a){return Promise.reject(g(a))})}}if(!(b.version>55&&"autoGainControl"in c.mediaDevices.getSupportedConstraints())){var l=function(a,b,c){b in a&&!(c in a)&&(a[c]=a[b],delete a[b])},m=c.mediaDevices.getUserMedia.bind(c.mediaDevices);if(c.mediaDevices.getUserMedia=function(a){return"object"==typeof a&&"object"==typeof a.audio&&(a=JSON.parse(JSON.stringify(a)),l(a.audio,"autoGainControl","mozAutoGainControl"),l(a.audio,"noiseSuppression","mozNoiseSuppression")),m(a)},f&&f.prototype.getSettings){var n=f.prototype.getSettings;f.prototype.getSettings=function(){var a=n.apply(this,arguments);return l(a,"mozAutoGainControl","autoGainControl"),l(a,"mozNoiseSuppression","noiseSuppression"),a}}if(f&&f.prototype.applyConstraints){var o=f.prototype.applyConstraints;f.prototype.applyConstraints=function(a){return"audio"===this.kind&&"object"==typeof a&&(a=JSON.parse(JSON.stringify(a)),l(a,"autoGainControl","mozAutoGainControl"),l(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}c.getUserMedia=function(a,e,f){return b.version<44?h(a,e,f):(d.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),void c.mediaDevices.getUserMedia(a).then(e,f))}}},{"../utils":12}],11:[function(a,b,c){"use strict";var d=a("../utils"),e={shimLocalStreamsAPI:function(a){if("object"==typeof a&&a.RTCPeerConnection){if("getLocalStreams"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"getStreamById"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.getStreamById=function(a){var b=null;return this._localStreams&&this._localStreams.forEach(function(c){c.id===a&&(b=c)}),this._remoteStreams&&this._remoteStreams.forEach(function(c){c.id===a&&(b=c)}),b}),!("addStream"in a.RTCPeerConnection.prototype)){var b=a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addStream=function(a){this._localStreams||(this._localStreams=[]),this._localStreams.indexOf(a)===-1&&this._localStreams.push(a);var c=this;a.getTracks().forEach(function(d){b.call(c,d,a)})},a.RTCPeerConnection.prototype.addTrack=function(a,c){c&&(this._localStreams?this._localStreams.indexOf(c)===-1&&this._localStreams.push(c):this._localStreams=[c]),b.call(this,a,c)}}"removeStream"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.removeStream=function(a){this._localStreams||(this._localStreams=[]);var b=this._localStreams.indexOf(a);if(b!==-1){this._localStreams.splice(b,1);var c=this,d=a.getTracks();this.getSenders().forEach(function(a){d.indexOf(a.track)!==-1&&c.removeTrack(a)})}})}},shimRemoteStreamsAPI:function(a){"object"==typeof a&&a.RTCPeerConnection&&("getRemoteStreams"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),"onaddstream"in a.RTCPeerConnection.prototype||Object.defineProperty(a.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(a){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=a),this.addEventListener("track",this._onaddstreampoly=function(a){var b=a.streams[0];if(this._remoteStreams||(this._remoteStreams=[]),!(this._remoteStreams.indexOf(b)>=0)){this._remoteStreams.push(b);var c=new Event("addstream");c.stream=a.streams[0],this.dispatchEvent(c)}}.bind(this))}}))},shimCallbacksAPI:function(a){if("object"==typeof a&&a.RTCPeerConnection){var b=a.RTCPeerConnection.prototype,c=b.createOffer,d=b.createAnswer,e=b.setLocalDescription,f=b.setRemoteDescription,g=b.addIceCandidate;b.createOffer=function(a,b){var d=arguments.length>=2?arguments[2]:arguments[0],e=c.apply(this,[d]);return b?(e.then(a,b),Promise.resolve()):e},b.createAnswer=function(a,b){var c=arguments.length>=2?arguments[2]:arguments[0],e=d.apply(this,[c]);return b?(e.then(a,b),Promise.resolve()):e};var h=function(a,b,c){var d=e.apply(this,[a]);return c?(d.then(b,c),Promise.resolve()):d};b.setLocalDescription=h,h=function(a,b,c){var d=f.apply(this,[a]);return c?(d.then(b,c),Promise.resolve()):d},b.setRemoteDescription=h,h=function(a,b,c){var d=g.apply(this,[a]);return c?(d.then(b,c),Promise.resolve()):d},b.addIceCandidate=h}},shimGetUserMedia:function(a){var b=a&&a.navigator;b.getUserMedia||(b.webkitGetUserMedia?b.getUserMedia=b.webkitGetUserMedia.bind(b):b.mediaDevices&&b.mediaDevices.getUserMedia&&(b.getUserMedia=function(a,c,d){b.mediaDevices.getUserMedia(a).then(c,d)}.bind(b)))},shimRTCIceServerUrls:function(a){var b=a.RTCPeerConnection;a.RTCPeerConnection=function(a,c){if(a&&a.iceServers){for(var e=[],f=0;f<a.iceServers.length;f++){var g=a.iceServers[f];!g.hasOwnProperty("urls")&&g.hasOwnProperty("url")?(d.deprecated("RTCIceServer.url","RTCIceServer.urls"),g=JSON.parse(JSON.stringify(g)),g.urls=g.url,delete g.url,e.push(g)):e.push(a.iceServers[f])}a.iceServers=e}return new b(a,c)},a.RTCPeerConnection.prototype=b.prototype,Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get:function(){return b.generateCertificate}})}};b.exports={shimCallbacksAPI:e.shimCallbacksAPI,shimLocalStreamsAPI:e.shimLocalStreamsAPI,shimRemoteStreamsAPI:e.shimRemoteStreamsAPI,shimGetUserMedia:e.shimGetUserMedia,shimRTCIceServerUrls:e.shimRTCIceServerUrls}},{"../utils":12}],12:[function(a,b,c){"use strict";var d=!0,e=!0,f={disableLog:function(a){return"boolean"!=typeof a?new Error("Argument type: "+typeof a+". Please use a boolean."):(d=a,a?"adapter.js logging disabled":"adapter.js logging enabled")},disableWarnings:function(a){return"boolean"!=typeof a?new Error("Argument type: "+typeof a+". Please use a boolean."):(e=!a,"adapter.js deprecation warnings "+(a?"disabled":"enabled"))},log:function(){if("object"==typeof window){if(d)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},deprecated:function(a,b){e&&console.warn(a+" is deprecated, please use "+b+" instead.")},extractVersion:function(a,b,c){var d=a.match(b);return d&&d.length>=c&&parseInt(d[c],10)},detectBrowser:function(a){var b=a&&a.navigator,c={};if(c.browser=null,c.version=null,"undefined"==typeof a||!a.navigator)return c.browser="Not a browser.",c;if(b.mozGetUserMedia)c.browser="firefox",c.version=this.extractVersion(b.userAgent,/Firefox\/(\d+)\./,1);else if(b.webkitGetUserMedia)if(a.webkitRTCPeerConnection)c.browser="chrome",c.version=this.extractVersion(b.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!b.userAgent.match(/Version\/(\d+).(\d+)/))return c.browser="Unsupported webkit-based browser with GUM support but no WebRTC support.",c;c.browser="safari",c.version=this.extractVersion(b.userAgent,/AppleWebKit\/(\d+)\./,1)}else if(b.mediaDevices&&b.userAgent.match(/Edge\/(\d+).(\d+)$/))c.browser="edge",c.version=this.extractVersion(b.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!b.mediaDevices||!b.userAgent.match(/AppleWebKit\/(\d+)\./))return c.browser="Not a supported browser.",c;c.browser="safari",c.version=this.extractVersion(b.userAgent,/AppleWebKit\/(\d+)\./,1)}return c},shimCreateObjectURL:function(a){var b=a&&a.URL;if("object"==typeof a&&a.HTMLMediaElement&&"srcObject"in a.HTMLMediaElement.prototype){var c=b.createObjectURL.bind(b),d=b.revokeObjectURL.bind(b),e=new Map,g=0;b.createObjectURL=function(a){if("getTracks"in a){var b="polyblob:"+ ++g;return e.set(b,a),f.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream"),b}return c(a)},b.revokeObjectURL=function(a){d(a),e["delete"](a)};var h=Object.getOwnPropertyDescriptor(a.HTMLMediaElement.prototype,"src");Object.defineProperty(a.HTMLMediaElement.prototype,"src",{get:function(){return h.get.apply(this)},set:function(a){return this.srcObject=e.get(a)||null,h.set.apply(this,[a])}});var i=a.HTMLMediaElement.prototype.setAttribute;a.HTMLMediaElement.prototype.setAttribute=function(){return 2===arguments.length&&"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=e.get(arguments[1])||null),i.apply(this,arguments)}}}};b.exports={log:f.log,deprecated:f.deprecated,disableLog:f.disableLog,disableWarnings:f.disableWarnings,extractVersion:f.extractVersion,shimCreateObjectURL:f.shimCreateObjectURL,detectBrowser:f.detectBrowser.bind(f)}},{}]},{},[2])(2)})}).call(b,c(8))},function(a,b,c){"use strict";var d,e;d=[c(6),c(7)],e=function(a,b){return a.onLoaded=function(){b(a)},a.onLoaded(),a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(1),c(4),c(5),c(3),c(2)],e=function(a,b,c,d,e){"use strict";function f(){var a=this;this._root=h(),this._version="?";var b=function(b){a._loaded=!0,a._enabled=b===!0,a._version=a._phenixRTC.phenixVersion||"?.?.?.?",q(b?"Phenix RTC "+a._version:"No Phenix RTC"),a._onReady&&a._onReady(a._enabled)};try{this._phenixRTC=i(this._root),this._phenixRTC.onunload=function(){a._loaded=!1};var c=new d;c.waitForReady(this._phenixRTC,b)}catch(e){r("Error while loading Phenix RTC"+e)}}function g(){this._root&&document.getElementById("phenixRTC")!==this._root&&(document.body.appendChild(this._root),this._onLoaded&&this._onLoaded.call(this))}function h(){var a=document.createElement("div");return a.id="phenixRTC",a.style.cssText="visibility:hidden !important;width:0px !important;height:0px !important;margin:0px !important;padding:0px !important;border-style:none !important;border-width:0px !important;max-width:0px !important;max-height:0px !important;outline:none !important",document.body.appendChild(a),a}function i(a){var b=document.createElement("object");return b.type="application/x-phenix-rtc",a.appendChild(b),b}function j(a,b){if(!a)throw new Error("Can not attach a stream to a undefined element");if(a.phenixVersion)return a.src=b,a;var c=new e(a,b,(!0));return c.getElement().phenixPresenter=c,c.getElement()}function k(b){var c=function(){var c=null;switch(arguments.length){case 0:c=new b;break;case 1:c=new b(arguments[0]);break;case 2:c=new b(arguments[0],arguments[1]);break;case 3:c=new b(arguments[0],arguments[1],arguments[2]);break;case 4:c=new b(arguments[0],arguments[1],arguments[2],arguments[3]);break;case 5:c=new b(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]);break;default:throw new Error("Unsupported number of arguments in Phenix Object Constructor")}return c.phenixAddEventListener=a.bind(l,c),c.phenixRemoveEventListener=a.bind(m,c),c};return a.forOwn(b,function(a,b){c[b]=a}),c}function l(a,c){b.stringNotEmpty(a,"name"),b.isFunction(c,"listener"),n.call(this,a),o.call(this,a,c)}function m(a,b){p.call(this,a,b)}function n(b){if(!this.events||!this.events[b]){this.events||(this.events={});var d=this.events;d[b]={observable:(new c.Observable).extend({timeout:0}),subscription:null,listeners:[]},this.phenixSetEventListener(b,a.bind(d[b].observable.setValue,d[b].observable)),d[b].subscription=d[b].observable.subscribe(function(c){var e=d[b],f=e.listeners;a.forEach(f,function(a){a(c)})})}}function o(a,b){if(!this.events||!this.events[a])throw new Error("No event observable for event: "+name);this.events[a].listeners.push(b)}function p(b,c){this.events&&this.events.events[b]&&(this.events[b].listeners=a.filter(this.events[b].listeners,function(a){return c!==a}))}var q=function(){console.log.apply(console,arguments)}||function(){},r=function(){console.error.apply(console,arguments)}||q;return f.prototype.onReady=function(a){var b=this;this._loaded?setTimeout(function(){a(b._enabled)},1):this._onReady=a},f.prototype.onLoaded=function(a){this._onLoaded=a},f.prototype.isLoaded=function(){return this._loaded===!0},f.isSupported=function(){if(navigator.plugins)for(var a=navigator.plugins,b=0;b<a.length;b++)if(a[b].name.indexOf("PhenixRTC")>=0)return!0;if(navigator.userAgent.match(/MSIE/)||navigator.userAgent.match(/Trident/))try{return new window.ActiveXObject("PhenixP2P.RTC"),!0}catch(c){return!1}return!1},f.prototype.isEnabled=function(){return g.call(this),this._phenixRTC&&void 0!==this._phenixRTC.phenixVersion},f.prototype.getVersion=function(){return g.call(this),this._version},f.prototype.getRTCPeerConnectionConstructor=function(){return g.call(this),k(this._phenixRTC.RTCPeerConnection)},f.prototype.getRTCSessionDescriptionConstructor=function(){return g.call(this),k(this._phenixRTC.RTCSessionDescription)},f.prototype.getRTCIceCandidateConstructor=function(){return g.call(this),k(this._phenixRTC.RTCIceCandidate)},f.prototype.getSourcesDelegate=function(){var a=this;return function(b){return g.call(a),a._phenixRTC.getSources(b)}},f.prototype.getUserMediaDelegate=function(){var a=this;return function(b,c,d){return g.call(a),a._phenixRTC.getUserMedia(b,c,d)}},f.prototype.getStatsDelegate=function(){return function(a,b,c,d){return a.getStats(b,c,d)}},f.prototype.attachMediaStream=function(a,b){return g.call(this),j.call(this,a,b)},f.prototype.reattachMediaStream=function(a,b){return g.call(this),this.attachMediaStream(a,b.src)},f}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(1),c(0),c(9),c(2)],e=function(a,b,c,d){"use strict";function e(){if(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(x=j),navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&(y=f),!window.RTCPeerConnection)return s("[%s] browser version [%s] does not appear to be WebRTC-capable",t.browser,t.version);switch(t.browser){case"Firefox":s("Firefox detected",t),A=function(a,b){s("Attaching media stream");var c=a.muted;return a.mozSrcObject=b,a.play(),c===!0&&(a.muted=!0),a},C=function(a,b){s("Reattaching media stream");var c=a.muted;return a.mozSrcObject=b.mozSrcObject,a.play(),c===!0&&(a.muted=!0),a},z=function(b,c,d,e){b.getStats(c,a.bind(n,this,b,d),e)},D=!0;break;case"Opera":s("Opera detected",t),A=k,C=m,z=function(b,c,d,e){b.getStats(a.bind(n,this,b,d),c,e)},D=!0;break;case"Chrome":s("Webkit detected",t),A=k,C=m,z=function(b,c,d,e){b.getStats(a.bind(n,this,b,d),c,e)},D=!0;break;case"Edge":s("Edge detected",t),A=k,C=m,z=function(b,c,d,e){b.getStats(c,a.bind(n,this,b,d),e)},D=!0;break;case"Safari":s("Safari detected",t),A=function(b,c){return a.isObject(c)&&(b.__phenixHasPlayedWebRtc=!0),b=k(b,c)},B=function(a,b){return a.__phenixHasPlayedWebRtc?(a=new d(a,b,(!1)).getElement(),a.play(),a):l(a,b)},C=m,z=function(b,c,d,e){b.getStats(c).then(a.bind(n,this,b,d),e)},D=!0;break;default:s("Browser does not appear to be WebRTC-capable",t)}}function f(b,c,d){var e=a.bind(g,this,b,c,d);navigator.getUserMedia(b,e,d)}function g(a,b,c,d){setTimeout(function(){for(var e=d.getTracks(),f=0;f<e.length;f++){var g=e[f];if(g.onended=function(a){s(a.timeStamp,"Track",g.id,g.label,"ended")},s("Track",g.id,g.label,e[f].kind,"readyState=",e[f].readyState),"ended"===g.readyState)return h("User media not available",c,e)}var i=(a.audio?1:0)+(a.video?1:0);return e.length!==i?h("Unable to get all requested user media.",c,e):void b(d)},100)}function h(a,b,c){try{var d=new Error(a);d.code="unavailable",b(d)}finally{i(c)}}function i(a){for(var b=0;b<a.length;b++)a[b].stop()}function j(a){navigator.mediaDevices.enumerateDevices().then(function(b){var c=[];b.forEach(function(a){"audioinput"===a.kind?c.push({kind:"audio",id:a.deviceId,label:a.label}):"videoinput"===a.kind&&c.push({kind:"video",id:a.deviceId,label:a.label})}),a(c)})}function k(a,b){return"undefined"!=typeof a.srcObject?a.srcObject=b:"undefined"!=typeof a.mozSrcObject?a.mozSrcObject=b:"undefined"!=typeof a.src?a.src=URL.createObjectURL(b):s("Error attaching stream to element."),a.play(),a}function l(a,b){return a.src=b,a.play(),a}function m(a,b){return a.src=b.src,a}function n(a,b,c){b(o(a,c))}function o(b,c){switch(t.browser){case"Edge":c.forEach(function(a){a.mediaType=p(b,a.codecId),a.bytesSent=r(a.packetsSent,a.mediaType),a.bytesReceived=r(a.packetsReceived,a.mediaType)});break;case"Safari":c.forEach(function(b){a.includes(b.id.toLowerCase(),"audio")&&a.includes(b.id.toLowerCase(),"rtp")&&(b.mediaType="audio"),a.includes(b.id.toLowerCase(),"video")&&a.includes(b.id.toLowerCase(),"rtp")&&(b.mediaType="video")})}return c}function p(b,c){if(c){var d;return q(b,function(b){a.startsWith(b,"video")&&a.includes(b.toLowerCase(),c.toLowerCase())&&(d="video"),a.startsWith(b,"audio")&&a.includes(b.toLowerCase(),c.toLowerCase())&&(d="audio")}),d}}function q(b,c){var d=b.localDescription.sdp.split("m="),e=b.remoteDescription.sdp.split("m=");return d.length===e.length&&a.findIndex(d,function(a,b){return c(a,b,e)})}function r(a,b){var c=parseInt(a)||0;return"audio"===b?100*c:"video"===b?1080*c:void 0}var s=function(){console.log.apply(console,arguments)},t=new b(navigator.userAgent).detect(),u=window.RTCPeerConnection,v=window.RTCSessionDescription,w=window.RTCIceCandidate,x=null,y=null,z=null,A=null,B=null,C=null,D=!1;e();var E={RTCPeerConnection:u,RTCSessionDescription:v,RTCIceCandidate:w,getSources:x,getUserMedia:y,getStats:z,attachMediaStream:A,attachUriStream:B||l,reattachMediaStream:C,webrtcSupported:D};return E.exportGlobal=function(){window.RTCPeerConnection=E.RTCPeerConnection,window.RTCSessionDescription=E.RTCSessionDescription,window.RTCIceCandidate=E.RTCIceCandidate},E}.apply(b,d),!(void 0!==e&&(a.exports=e))}])})},function(a,b,c){var d,e;d=[c(45),c(46)],e=function(a,b){return{Disposable:a,DisposableList:b}}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(23),c(53),c(54)],e=function(a,b,c){"use strict";return{Observable:a,ObservableArray:b,ObservableMonitor:c}}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(21),c(47)],e=function(a,b){return{Event:a,NamedEvents:b}}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(48)],e=function(a){"use strict";return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";var a={networkStates:{networkEmpty:{id:0,name:"NETWORK_EMPTY"},networkIdle:{id:1,name:"NETWORK_IDLE"},networkLoading:{id:2,name:"NETWORK_LOADING"},networkNoSource:{id:3,name:"NETWORK_NO_SOURCE"}},types:{realTime:{id:0,name:"RealTime"},dash:{id:1,name:"dash"},hls:{id:2,name:"hls"}},streamEvents:{playerEnded:{id:0,name:"playerended"},playerError:{id:1,name:"playererror"},stopped:{id:2,name:"stopped"}},rendererEvents:{ended:{id:0,name:"ended"},error:{id:1,name:"error"}}};return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(51),c(50),c(11)],e=function(a,b,c){"use strict";return{createLogger:function(){return new a},Logger:a,ConsoleAppender:b,level:c.level}}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(5)],e=function(a,b,c){"use strict";function d(a,b){if(!a)throw new Error("'logger' must be specified.");this._logger=a,this._dimensionsChangedEvent=new c.Event,this._dimensionsChangedIntervalId=null,this._toBeStarted=!1,this._videoElement=null,this._dimensionsChangedData={pollFrequency:h,previousWidth:0,previousHeight:0},b&&b.pollFrequency&&(this._dimensionsChangedData.pollFrequency=b.pollFrequency>=i?b.pollFrequency:i),this._renderer=null}function e(b,c){c&&!a.isUndefined(c.videoWidth)||this._logger.warn("Attempting to start dimensions changed monitor without providing proper 'video' element."),this._renderer=b,this._videoElement=c,this._toBeStarted=!0,g.call(this)}function f(){this._toBeStarted=!1,this._dimensionsChangedIntervalId&&(clearInterval(this._dimensionsChangedIntervalId),this._dimensionsChangedIntervalId=null),this._dimensionsChangedEvent.dispose()}function g(){if(this._toBeStarted&&!this._dimensionsChangedIntervalId&&0!==this._dimensionsChangedEvent.size()){var a=this;this._dimensionsChangedData.previousWidth=this._videoElement.videoWidth,this._dimensionsChangedData.previousHeight=this._videoElement.videoHeight,this._dimensionsChangedIntervalId=setInterval(function(){a._videoElement.videoWidth===a._dimensionsChangedData.previousWidth&&a._videoElement.videoHeight===a._dimensionsChangedData.previousHeight||(a._dimensionsChangedData.previousWidth=a._videoElement.videoWidth,a._dimensionsChangedData.previousHeight=a._videoElement.videoHeight,a._dimensionsChangedEvent.fireAsync([a._renderer,{width:a._videoElement.videoWidth,height:a._videoElement.videoHeight}]))},a._dimensionsChangedData.pollFrequency)}}var h=500,i=15;return d.prototype.start=function(a,b){e.call(this,a,b)},d.prototype.stop=function(){f.call(this)},d.prototype.addVideoDisplayDimensionsChangedCallback=function(a){return b.isFunction(a,"addVideoDisplayDimensionsChangedCallback"),g.call(this),this._dimensionsChangedEvent.listen(a)},d.prototype.toString=function(){return"DimensionsChangedMonitor[pollFrequency="+this._dimensionsChangedData.pollFrequency+", previousHeight="+this._dimensionsChangedData.previousHeight+", previousWidth="+this._dimensionsChangedData.previousHeight+", state="+(this._dimensionsChangedIntervalId?"running":"stopped")+"]"},d}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e,f;!function(g,h){e=[c(39)],d=h,f="function"==typeof d?d.apply(b,e):d,!(void 0!==f&&(a.exports=f))}(this,function(a){"use strict";function b(a){var b=0;return function(){return b<a.length?a.charCodeAt(b++):null}}function c(){var a=[],b=[];return function(){return 0===arguments.length?b.join("")+i.apply(String,a):(a.length+arguments.length>1024&&(b.push(i.apply(String,a)),a.length=0),void Array.prototype.push.apply(a,arguments))}}function d(a,b,c,d,e){var f,g,h=8*e-d-1,i=(1<<h)-1,j=i>>1,k=-7,l=c?e-1:0,m=c?-1:1,n=a[b+l];for(l+=m,f=n&(1<<-k)-1,n>>=-k,k+=h;k>0;f=256*f+a[b+l],l+=m,k-=8);for(g=f&(1<<-k)-1,f>>=-k,k+=d;k>0;g=256*g+a[b+l],l+=m,k-=8);if(0===f)f=1-j;else{if(f===i)return g?NaN:(n?-1:1)*(1/0);g+=Math.pow(2,d),f-=j}return(n?-1:1)*g*Math.pow(2,f-d)}function e(a,b,c,d,e,f){var g,h,i,j=8*f-e-1,k=(1<<j)-1,l=k>>1,m=23===e?Math.pow(2,-24)-Math.pow(2,-77):0,n=d?0:f-1,o=d?1:-1,p=b<0||0===b&&1/b<0?1:0;for(b=Math.abs(b),isNaN(b)||b===1/0?(h=isNaN(b)?1:0,g=k):(g=Math.floor(Math.log(b)/Math.LN2),b*(i=Math.pow(2,-g))<1&&(g--,i*=2),b+=g+l>=1?m/i:m*Math.pow(2,1-l),b*i>=2&&(g++,i/=2),g+l>=k?(h=0,g=k):g+l>=1?(h=(b*i-1)*Math.pow(2,e),g+=l):(h=b*Math.pow(2,l-1)*Math.pow(2,e),g=0));e>=8;a[c+n]=255&h,n+=o,h/=256,e-=8);for(g=g<<e|h,j+=e;j>0;a[c+n]=255&g,n+=o,g/=256,j-=8);a[c+n-o]|=128*p}var f=function(a,b,c){if("undefined"==typeof a&&(a=f.DEFAULT_CAPACITY),"undefined"==typeof b&&(b=f.DEFAULT_ENDIAN),"undefined"==typeof c&&(c=f.DEFAULT_NOASSERT),!c){if(a=0|a,a<0)throw RangeError("Illegal capacity");b=!!b,c=!!c}this.buffer=0===a?h:new ArrayBuffer(a),this.view=0===a?null:new Uint8Array(this.buffer),this.offset=0,this.markedOffset=-1,this.limit=a,this.littleEndian=b,this.noAssert=c};f.VERSION="5.0.1",f.LITTLE_ENDIAN=!0,f.BIG_ENDIAN=!1,f.DEFAULT_CAPACITY=16,f.DEFAULT_ENDIAN=f.BIG_ENDIAN,f.DEFAULT_NOASSERT=!1,f.Long=a||null;var g=f.prototype;g.__isByteBuffer__,Object.defineProperty(g,"__isByteBuffer__",{value:!0,enumerable:!1,configurable:!1});var h=new ArrayBuffer(0),i=String.fromCharCode;f.accessor=function(){return Uint8Array},f.allocate=function(a,b,c){return new f(a,b,c)},f.concat=function(a,b,c,d){"boolean"!=typeof b&&"string"==typeof b||(d=c,c=b,b=void 0);for(var e,g=0,h=0,i=a.length;h<i;++h)f.isByteBuffer(a[h])||(a[h]=f.wrap(a[h],b)),e=a[h].limit-a[h].offset,e>0&&(g+=e);if(0===g)return new f(0,c,d);var j,k=new f(g,c,d);for(h=0;h<i;)j=a[h++],e=j.limit-j.offset,e<=0||(k.view.set(j.view.subarray(j.offset,j.limit),k.offset),k.offset+=e);return k.limit=k.offset,k.offset=0,k},f.isByteBuffer=function(a){return(a&&a.__isByteBuffer__)===!0},f.type=function(){return ArrayBuffer},f.wrap=function(a,b,c,d){if("string"!=typeof b&&(d=c,c=b,b=void 0),"string"==typeof a)switch("undefined"==typeof b&&(b="utf8"),b){case"base64":return f.fromBase64(a,c);case"hex":return f.fromHex(a,c);case"binary":return f.fromBinary(a,c);case"utf8":return f.fromUTF8(a,c);case"debug":return f.fromDebug(a,c);default:throw Error("Unsupported encoding: "+b)}if(null===a||"object"!=typeof a)throw TypeError("Illegal buffer");var e;if(f.isByteBuffer(a))return e=g.clone.call(a),e.markedOffset=-1,e;if(a instanceof Uint8Array)e=new f(0,c,d),a.length>0&&(e.buffer=a.buffer,e.offset=a.byteOffset,e.limit=a.byteOffset+a.byteLength,e.view=new Uint8Array(a.buffer));else if(a instanceof ArrayBuffer)e=new f(0,c,d),a.byteLength>0&&(e.buffer=a,e.offset=0,e.limit=a.byteLength,e.view=a.byteLength>0?new Uint8Array(a):null);else{if("[object Array]"!==Object.prototype.toString.call(a))throw TypeError("Illegal buffer");e=new f(a.length,c,d),e.limit=a.length;for(var h=0;h<a.length;++h)e.view[h]=a[h]}return e},g.writeBitSet=function(a,b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if(!(a instanceof Array))throw TypeError("Illegal BitSet: Not an array");if("number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}var d,e=b,f=a.length,g=f>>3,h=0;for(b+=this.writeVarint32(f,b);g--;)d=1&!!a[h++]|(1&!!a[h++])<<1|(1&!!a[h++])<<2|(1&!!a[h++])<<3|(1&!!a[h++])<<4|(1&!!a[h++])<<5|(1&!!a[h++])<<6|(1&!!a[h++])<<7,this.writeByte(d,b++);if(h<f){var i=0;for(d=0;h<f;)d|=(1&!!a[h++])<<i++;this.writeByte(d,b++)}return c?(this.offset=b,this):b-e},g.readBitSet=function(a){var b="undefined"==typeof a;b&&(a=this.offset);var c,d=this.readVarint32(a),e=d.value,f=e>>3,g=0,h=[];for(a+=d.length;f--;)c=this.readByte(a++),h[g++]=!!(1&c),h[g++]=!!(2&c),h[g++]=!!(4&c),h[g++]=!!(8&c),h[g++]=!!(16&c),h[g++]=!!(32&c),h[g++]=!!(64&c),h[g++]=!!(128&c);if(g<e){var i=0;for(c=this.readByte(a++);g<e;)h[g++]=!!(c>>i++&1)}return b&&(this.offset=a),h},g.readBytes=function(a,b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+a>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+"+a+") <= "+this.buffer.byteLength)}var d=this.slice(b,b+a);return c&&(this.offset+=a),d},g.writeBytes=g.append,g.writeInt8=function(a,b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a|=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}b+=1;var d=this.buffer.byteLength;return b>d&&this.resize((d*=2)>b?d:b),b-=1,this.view[b]=a,c&&(this.offset+=1),this},g.writeByte=g.writeInt8,g.readInt8=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+1) <= "+this.buffer.byteLength)}var c=this.view[a];return 128===(128&c)&&(c=-(255-c+1)),b&&(this.offset+=1),c},g.readByte=g.readInt8,g.writeUint8=function(a,b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a>>>=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}b+=1;var d=this.buffer.byteLength;return b>d&&this.resize((d*=2)>b?d:b),b-=1,this.view[b]=a,c&&(this.offset+=1),this},g.writeUInt8=g.writeUint8,g.readUint8=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+1) <= "+this.buffer.byteLength)}var c=this.view[a];return b&&(this.offset+=1),c},g.readUInt8=g.readUint8,g.writeInt16=function(a,b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a|=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}b+=2;var d=this.buffer.byteLength;return b>d&&this.resize((d*=2)>b?d:b),b-=2,this.littleEndian?(this.view[b+1]=(65280&a)>>>8,this.view[b]=255&a):(this.view[b]=(65280&a)>>>8,this.view[b+1]=255&a),c&&(this.offset+=2),this},g.writeShort=g.writeInt16,g.readInt16=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+2) <= "+this.buffer.byteLength)}var c=0;return this.littleEndian?(c=this.view[a],c|=this.view[a+1]<<8):(c=this.view[a]<<8,c|=this.view[a+1]),32768===(32768&c)&&(c=-(65535-c+1)),b&&(this.offset+=2),c},g.readShort=g.readInt16,g.writeUint16=function(a,b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a>>>=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}b+=2;var d=this.buffer.byteLength;return b>d&&this.resize((d*=2)>b?d:b),b-=2,this.littleEndian?(this.view[b+1]=(65280&a)>>>8,this.view[b]=255&a):(this.view[b]=(65280&a)>>>8,this.view[b+1]=255&a),c&&(this.offset+=2),this},g.writeUInt16=g.writeUint16,g.readUint16=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+2) <= "+this.buffer.byteLength)}var c=0;return this.littleEndian?(c=this.view[a],c|=this.view[a+1]<<8):(c=this.view[a]<<8,c|=this.view[a+1]),b&&(this.offset+=2),c},g.readUInt16=g.readUint16,g.writeInt32=function(a,b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a|=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}b+=4;var d=this.buffer.byteLength;return b>d&&this.resize((d*=2)>b?d:b),b-=4,this.littleEndian?(this.view[b+3]=a>>>24&255,this.view[b+2]=a>>>16&255,this.view[b+1]=a>>>8&255,this.view[b]=255&a):(this.view[b]=a>>>24&255,this.view[b+1]=a>>>16&255,this.view[b+2]=a>>>8&255,this.view[b+3]=255&a),c&&(this.offset+=4),this},g.writeInt=g.writeInt32,g.readInt32=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+4) <= "+this.buffer.byteLength)}var c=0;return this.littleEndian?(c=this.view[a+2]<<16,c|=this.view[a+1]<<8,c|=this.view[a],c+=this.view[a+3]<<24>>>0):(c=this.view[a+1]<<16,c|=this.view[a+2]<<8,c|=this.view[a+3],c+=this.view[a]<<24>>>0),c|=0,b&&(this.offset+=4),c},g.readInt=g.readInt32,g.writeUint32=function(a,b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal value: "+a+" (not an integer)");
if(a>>>=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}b+=4;var d=this.buffer.byteLength;return b>d&&this.resize((d*=2)>b?d:b),b-=4,this.littleEndian?(this.view[b+3]=a>>>24&255,this.view[b+2]=a>>>16&255,this.view[b+1]=a>>>8&255,this.view[b]=255&a):(this.view[b]=a>>>24&255,this.view[b+1]=a>>>16&255,this.view[b+2]=a>>>8&255,this.view[b+3]=255&a),c&&(this.offset+=4),this},g.writeUInt32=g.writeUint32,g.readUint32=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+4) <= "+this.buffer.byteLength)}var c=0;return this.littleEndian?(c=this.view[a+2]<<16,c|=this.view[a+1]<<8,c|=this.view[a],c+=this.view[a+3]<<24>>>0):(c=this.view[a+1]<<16,c|=this.view[a+2]<<8,c|=this.view[a+3],c+=this.view[a]<<24>>>0),b&&(this.offset+=4),c},g.readUInt32=g.readUint32,a&&(g.writeInt64=function(b,c){var d="undefined"==typeof c;if(d&&(c=this.offset),!this.noAssert){if("number"==typeof b)b=a.fromNumber(b);else if("string"==typeof b)b=a.fromString(b);else if(!(b&&b instanceof a))throw TypeError("Illegal value: "+b+" (not an integer or Long)");if("number"!=typeof c||c%1!==0)throw TypeError("Illegal offset: "+c+" (not an integer)");if(c>>>=0,c<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}"number"==typeof b?b=a.fromNumber(b):"string"==typeof b&&(b=a.fromString(b)),c+=8;var e=this.buffer.byteLength;c>e&&this.resize((e*=2)>c?e:c),c-=8;var f=b.low,g=b.high;return this.littleEndian?(this.view[c+3]=f>>>24&255,this.view[c+2]=f>>>16&255,this.view[c+1]=f>>>8&255,this.view[c]=255&f,c+=4,this.view[c+3]=g>>>24&255,this.view[c+2]=g>>>16&255,this.view[c+1]=g>>>8&255,this.view[c]=255&g):(this.view[c]=g>>>24&255,this.view[c+1]=g>>>16&255,this.view[c+2]=g>>>8&255,this.view[c+3]=255&g,c+=4,this.view[c]=f>>>24&255,this.view[c+1]=f>>>16&255,this.view[c+2]=f>>>8&255,this.view[c+3]=255&f),d&&(this.offset+=8),this},g.writeLong=g.writeInt64,g.readInt64=function(b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+8) <= "+this.buffer.byteLength)}var d=0,e=0;this.littleEndian?(d=this.view[b+2]<<16,d|=this.view[b+1]<<8,d|=this.view[b],d+=this.view[b+3]<<24>>>0,b+=4,e=this.view[b+2]<<16,e|=this.view[b+1]<<8,e|=this.view[b],e+=this.view[b+3]<<24>>>0):(e=this.view[b+1]<<16,e|=this.view[b+2]<<8,e|=this.view[b+3],e+=this.view[b]<<24>>>0,b+=4,d=this.view[b+1]<<16,d|=this.view[b+2]<<8,d|=this.view[b+3],d+=this.view[b]<<24>>>0);var f=new a(d,e,(!1));return c&&(this.offset+=8),f},g.readLong=g.readInt64,g.writeUint64=function(b,c){var d="undefined"==typeof c;if(d&&(c=this.offset),!this.noAssert){if("number"==typeof b)b=a.fromNumber(b);else if("string"==typeof b)b=a.fromString(b);else if(!(b&&b instanceof a))throw TypeError("Illegal value: "+b+" (not an integer or Long)");if("number"!=typeof c||c%1!==0)throw TypeError("Illegal offset: "+c+" (not an integer)");if(c>>>=0,c<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}"number"==typeof b?b=a.fromNumber(b):"string"==typeof b&&(b=a.fromString(b)),c+=8;var e=this.buffer.byteLength;c>e&&this.resize((e*=2)>c?e:c),c-=8;var f=b.low,g=b.high;return this.littleEndian?(this.view[c+3]=f>>>24&255,this.view[c+2]=f>>>16&255,this.view[c+1]=f>>>8&255,this.view[c]=255&f,c+=4,this.view[c+3]=g>>>24&255,this.view[c+2]=g>>>16&255,this.view[c+1]=g>>>8&255,this.view[c]=255&g):(this.view[c]=g>>>24&255,this.view[c+1]=g>>>16&255,this.view[c+2]=g>>>8&255,this.view[c+3]=255&g,c+=4,this.view[c]=f>>>24&255,this.view[c+1]=f>>>16&255,this.view[c+2]=f>>>8&255,this.view[c+3]=255&f),d&&(this.offset+=8),this},g.writeUInt64=g.writeUint64,g.readUint64=function(b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+8) <= "+this.buffer.byteLength)}var d=0,e=0;this.littleEndian?(d=this.view[b+2]<<16,d|=this.view[b+1]<<8,d|=this.view[b],d+=this.view[b+3]<<24>>>0,b+=4,e=this.view[b+2]<<16,e|=this.view[b+1]<<8,e|=this.view[b],e+=this.view[b+3]<<24>>>0):(e=this.view[b+1]<<16,e|=this.view[b+2]<<8,e|=this.view[b+3],e+=this.view[b]<<24>>>0,b+=4,d=this.view[b+1]<<16,d|=this.view[b+2]<<8,d|=this.view[b+3],d+=this.view[b]<<24>>>0);var f=new a(d,e,(!0));return c&&(this.offset+=8),f},g.readUInt64=g.readUint64),g.writeFloat32=function(a,b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a)throw TypeError("Illegal value: "+a+" (not a number)");if("number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}b+=4;var d=this.buffer.byteLength;return b>d&&this.resize((d*=2)>b?d:b),b-=4,e(this.view,a,b,this.littleEndian,23,4),c&&(this.offset+=4),this},g.writeFloat=g.writeFloat32,g.readFloat32=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+4) <= "+this.buffer.byteLength)}var c=d(this.view,a,this.littleEndian,23,4);return b&&(this.offset+=4),c},g.readFloat=g.readFloat32,g.writeFloat64=function(a,b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a)throw TypeError("Illegal value: "+a+" (not a number)");if("number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}b+=8;var d=this.buffer.byteLength;return b>d&&this.resize((d*=2)>b?d:b),b-=8,e(this.view,a,b,this.littleEndian,52,8),c&&(this.offset+=8),this},g.writeDouble=g.writeFloat64,g.readFloat64=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+8) <= "+this.buffer.byteLength)}var c=d(this.view,a,this.littleEndian,52,8);return b&&(this.offset+=8),c},g.readDouble=g.readFloat64,f.MAX_VARINT32_BYTES=5,f.calculateVarint32=function(a){return a>>>=0,a<128?1:a<16384?2:a<1<<21?3:a<1<<28?4:5},f.zigZagEncode32=function(a){return((a|=0)<<1^a>>31)>>>0},f.zigZagDecode32=function(a){return a>>>1^-(1&a)|0},g.writeVarint32=function(a,b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a|=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}var d,e=f.calculateVarint32(a);b+=e;var g=this.buffer.byteLength;for(b>g&&this.resize((g*=2)>b?g:b),b-=e,a>>>=0;a>=128;)d=127&a|128,this.view[b++]=d,a>>>=7;return this.view[b++]=a,c?(this.offset=b,this):e},g.writeVarint32ZigZag=function(a,b){return this.writeVarint32(f.zigZagEncode32(a),b)},g.readVarint32=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+1) <= "+this.buffer.byteLength)}var c,d=0,e=0;do{if(!this.noAssert&&a>this.limit){var f=Error("Truncated");throw f.truncated=!0,f}c=this.view[a++],d<5&&(e|=(127&c)<<7*d),++d}while(0!==(128&c));return e|=0,b?(this.offset=a,e):{value:e,length:d}},g.readVarint32ZigZag=function(a){var b=this.readVarint32(a);return"object"==typeof b?b.value=f.zigZagDecode32(b.value):b=f.zigZagDecode32(b),b},a&&(f.MAX_VARINT64_BYTES=10,f.calculateVarint64=function(b){"number"==typeof b?b=a.fromNumber(b):"string"==typeof b&&(b=a.fromString(b));var c=b.toInt()>>>0,d=b.shiftRightUnsigned(28).toInt()>>>0,e=b.shiftRightUnsigned(56).toInt()>>>0;return 0==e?0==d?c<16384?c<128?1:2:c<1<<21?3:4:d<16384?d<128?5:6:d<1<<21?7:8:e<128?9:10},f.zigZagEncode64=function(b){return"number"==typeof b?b=a.fromNumber(b,!1):"string"==typeof b?b=a.fromString(b,!1):b.unsigned!==!1&&(b=b.toSigned()),b.shiftLeft(1).xor(b.shiftRight(63)).toUnsigned()},f.zigZagDecode64=function(b){return"number"==typeof b?b=a.fromNumber(b,!1):"string"==typeof b?b=a.fromString(b,!1):b.unsigned!==!1&&(b=b.toSigned()),b.shiftRightUnsigned(1).xor(b.and(a.ONE).toSigned().negate()).toSigned()},g.writeVarint64=function(b,c){var d="undefined"==typeof c;if(d&&(c=this.offset),!this.noAssert){if("number"==typeof b)b=a.fromNumber(b);else if("string"==typeof b)b=a.fromString(b);else if(!(b&&b instanceof a))throw TypeError("Illegal value: "+b+" (not an integer or Long)");if("number"!=typeof c||c%1!==0)throw TypeError("Illegal offset: "+c+" (not an integer)");if(c>>>=0,c<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}"number"==typeof b?b=a.fromNumber(b,!1):"string"==typeof b?b=a.fromString(b,!1):b.unsigned!==!1&&(b=b.toSigned());var e=f.calculateVarint64(b),g=b.toInt()>>>0,h=b.shiftRightUnsigned(28).toInt()>>>0,i=b.shiftRightUnsigned(56).toInt()>>>0;c+=e;var j=this.buffer.byteLength;switch(c>j&&this.resize((j*=2)>c?j:c),c-=e,e){case 10:this.view[c+9]=i>>>7&1;case 9:this.view[c+8]=9!==e?128|i:127&i;case 8:this.view[c+7]=8!==e?h>>>21|128:h>>>21&127;case 7:this.view[c+6]=7!==e?h>>>14|128:h>>>14&127;case 6:this.view[c+5]=6!==e?h>>>7|128:h>>>7&127;case 5:this.view[c+4]=5!==e?128|h:127&h;case 4:this.view[c+3]=4!==e?g>>>21|128:g>>>21&127;case 3:this.view[c+2]=3!==e?g>>>14|128:g>>>14&127;case 2:this.view[c+1]=2!==e?g>>>7|128:g>>>7&127;case 1:this.view[c]=1!==e?128|g:127&g}return d?(this.offset+=e,this):e},g.writeVarint64ZigZag=function(a,b){return this.writeVarint64(f.zigZagEncode64(a),b)},g.readVarint64=function(b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+1) <= "+this.buffer.byteLength)}var d=b,e=0,f=0,g=0,h=0;if(h=this.view[b++],e=127&h,128&h&&(h=this.view[b++],e|=(127&h)<<7,(128&h||this.noAssert&&"undefined"==typeof h)&&(h=this.view[b++],e|=(127&h)<<14,(128&h||this.noAssert&&"undefined"==typeof h)&&(h=this.view[b++],e|=(127&h)<<21,(128&h||this.noAssert&&"undefined"==typeof h)&&(h=this.view[b++],f=127&h,(128&h||this.noAssert&&"undefined"==typeof h)&&(h=this.view[b++],f|=(127&h)<<7,(128&h||this.noAssert&&"undefined"==typeof h)&&(h=this.view[b++],f|=(127&h)<<14,(128&h||this.noAssert&&"undefined"==typeof h)&&(h=this.view[b++],f|=(127&h)<<21,(128&h||this.noAssert&&"undefined"==typeof h)&&(h=this.view[b++],g=127&h,(128&h||this.noAssert&&"undefined"==typeof h)&&(h=this.view[b++],g|=(127&h)<<7,128&h||this.noAssert&&"undefined"==typeof h))))))))))throw Error("Buffer overrun");var i=a.fromBits(e|f<<28,f>>>4|g<<24,!1);return c?(this.offset=b,i):{value:i,length:b-d}},g.readVarint64ZigZag=function(b){var c=this.readVarint64(b);return c&&c.value instanceof a?c.value=f.zigZagDecode64(c.value):c=f.zigZagDecode64(c),c}),g.writeCString=function(a,c){var d="undefined"==typeof c;d&&(c=this.offset);var e,f=a.length;if(!this.noAssert){if("string"!=typeof a)throw TypeError("Illegal str: Not a string");for(e=0;e<f;++e)if(0===a.charCodeAt(e))throw RangeError("Illegal str: Contains NULL-characters");if("number"!=typeof c||c%1!==0)throw TypeError("Illegal offset: "+c+" (not an integer)");if(c>>>=0,c<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}f=k.calculateUTF16asUTF8(b(a))[1],c+=f+1;var g=this.buffer.byteLength;return c>g&&this.resize((g*=2)>c?g:c),c-=f+1,k.encodeUTF16toUTF8(b(a),function(a){this.view[c++]=a}.bind(this)),this.view[c++]=0,d?(this.offset=c,this):f},g.readCString=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+1) <= "+this.buffer.byteLength)}var d,e=a,f=-1;return k.decodeUTF8toUTF16(function(){if(0===f)return null;if(a>=this.limit)throw RangeError("Illegal range: Truncated data, "+a+" < "+this.limit);return f=this.view[a++],0===f?null:f}.bind(this),d=c(),!0),b?(this.offset=a,d()):{string:d(),length:a-e}},g.writeIString=function(a,c){var d="undefined"==typeof c;if(d&&(c=this.offset),!this.noAssert){if("string"!=typeof a)throw TypeError("Illegal str: Not a string");if("number"!=typeof c||c%1!==0)throw TypeError("Illegal offset: "+c+" (not an integer)");if(c>>>=0,c<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}var e,f=c;e=k.calculateUTF16asUTF8(b(a),this.noAssert)[1],c+=4+e;var g=this.buffer.byteLength;if(c>g&&this.resize((g*=2)>c?g:c),c-=4+e,this.littleEndian?(this.view[c+3]=e>>>24&255,this.view[c+2]=e>>>16&255,this.view[c+1]=e>>>8&255,this.view[c]=255&e):(this.view[c]=e>>>24&255,this.view[c+1]=e>>>16&255,this.view[c+2]=e>>>8&255,this.view[c+3]=255&e),c+=4,k.encodeUTF16toUTF8(b(a),function(a){this.view[c++]=a}.bind(this)),c!==f+4+e)throw RangeError("Illegal range: Truncated data, "+c+" == "+(c+4+e));return d?(this.offset=c,this):c-f},g.readIString=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+4) <= "+this.buffer.byteLength)}var c=a,d=this.readUint32(a),e=this.readUTF8String(d,f.METRICS_BYTES,a+=4);return a+=e.length,b?(this.offset=a,e.string):{string:e.string,length:a-c}},f.METRICS_CHARS="c",f.METRICS_BYTES="b",g.writeUTF8String=function(a,c){var d="undefined"==typeof c;if(d&&(c=this.offset),!this.noAssert){if("number"!=typeof c||c%1!==0)throw TypeError("Illegal offset: "+c+" (not an integer)");if(c>>>=0,c<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}var e,f=c;e=k.calculateUTF16asUTF8(b(a))[1],c+=e;var g=this.buffer.byteLength;return c>g&&this.resize((g*=2)>c?g:c),c-=e,k.encodeUTF16toUTF8(b(a),function(a){this.view[c++]=a}.bind(this)),d?(this.offset=c,this):c-f},g.writeString=g.writeUTF8String,f.calculateUTF8Chars=function(a){return k.calculateUTF16asUTF8(b(a))[0]},f.calculateUTF8Bytes=function(a){return k.calculateUTF16asUTF8(b(a))[1]},f.calculateString=f.calculateUTF8Bytes,g.readUTF8String=function(a,b,d){"number"==typeof b&&(d=b,b=void 0);var e="undefined"==typeof d;if(e&&(d=this.offset),"undefined"==typeof b&&(b=f.METRICS_CHARS),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal length: "+a+" (not an integer)");if(a|=0,"number"!=typeof d||d%1!==0)throw TypeError("Illegal offset: "+d+" (not an integer)");if(d>>>=0,d<0||d+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+d+" (+0) <= "+this.buffer.byteLength)}var g,h=0,i=d;if(b===f.METRICS_CHARS){if(g=c(),k.decodeUTF8(function(){return h<a&&d<this.limit?this.view[d++]:null}.bind(this),function(a){++h,k.UTF8toUTF16(a,g)}),h!==a)throw RangeError("Illegal range: Truncated data, "+h+" == "+a);return e?(this.offset=d,g()):{string:g(),length:d-i}}if(b===f.METRICS_BYTES){if(!this.noAssert){if("number"!=typeof d||d%1!==0)throw TypeError("Illegal offset: "+d+" (not an integer)");if(d>>>=0,d<0||d+a>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+d+" (+"+a+") <= "+this.buffer.byteLength)}var j=d+a;if(k.decodeUTF8toUTF16(function(){return d<j?this.view[d++]:null}.bind(this),g=c(),this.noAssert),d!==j)throw RangeError("Illegal range: Truncated data, "+d+" == "+j);return e?(this.offset=d,g()):{string:g(),length:d-i}}throw TypeError("Unsupported metrics: "+b)},g.readString=g.readUTF8String,g.writeVString=function(a,c){var d="undefined"==typeof c;if(d&&(c=this.offset),!this.noAssert){if("string"!=typeof a)throw TypeError("Illegal str: Not a string");if("number"!=typeof c||c%1!==0)throw TypeError("Illegal offset: "+c+" (not an integer)");if(c>>>=0,c<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}var e,g,h=c;e=k.calculateUTF16asUTF8(b(a),this.noAssert)[1],g=f.calculateVarint32(e),c+=g+e;var i=this.buffer.byteLength;if(c>i&&this.resize((i*=2)>c?i:c),c-=g+e,c+=this.writeVarint32(e,c),k.encodeUTF16toUTF8(b(a),function(a){this.view[c++]=a}.bind(this)),c!==h+e+g)throw RangeError("Illegal range: Truncated data, "+c+" == "+(c+e+g));return d?(this.offset=c,this):c-h},g.readVString=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+1) <= "+this.buffer.byteLength)}var c=a,d=this.readVarint32(a),e=this.readUTF8String(d.value,f.METRICS_BYTES,a+=d.length);return a+=e.length,b?(this.offset=a,e.string):{string:e.string,length:a-c}},g.append=function(a,b,c){"number"!=typeof b&&"string"==typeof b||(c=b,b=void 0);var d="undefined"==typeof c;if(d&&(c=this.offset),!this.noAssert){if("number"!=typeof c||c%1!==0)throw TypeError("Illegal offset: "+c+" (not an integer)");if(c>>>=0,c<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}a instanceof f||(a=f.wrap(a,b));var e=a.limit-a.offset;if(e<=0)return this;c+=e;var g=this.buffer.byteLength;return c>g&&this.resize((g*=2)>c?g:c),c-=e,this.view.set(a.view.subarray(a.offset,a.limit),c),a.offset+=e,d&&(this.offset+=e),this},g.appendTo=function(a,b){return a.append(this,b),this},g.assert=function(a){return this.noAssert=!a,this},g.capacity=function(){return this.buffer.byteLength},g.clear=function(){return this.offset=0,this.limit=this.buffer.byteLength,this.markedOffset=-1,this},g.clone=function(a){var b=new f(0,this.littleEndian,this.noAssert);return a?(b.buffer=new ArrayBuffer(this.buffer.byteLength),b.view=new Uint8Array(b.buffer)):(b.buffer=this.buffer,b.view=this.view),b.offset=this.offset,b.markedOffset=this.markedOffset,b.limit=this.limit,b},g.compact=function(a,b){if("undefined"==typeof a&&(a=this.offset),"undefined"==typeof b&&(b=this.limit),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal begin: Not an integer");if(a>>>=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal end: Not an integer");if(b>>>=0,a<0||a>b||b>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+b+" <= "+this.buffer.byteLength)}if(0===a&&b===this.buffer.byteLength)return this;var c=b-a;if(0===c)return this.buffer=h,this.view=null,this.markedOffset>=0&&(this.markedOffset-=a),this.offset=0,this.limit=0,this;var d=new ArrayBuffer(c),e=new Uint8Array(d);return e.set(this.view.subarray(a,b)),this.buffer=d,this.view=e,this.markedOffset>=0&&(this.markedOffset-=a),this.offset=0,this.limit=c,this},g.copy=function(a,b){if("undefined"==typeof a&&(a=this.offset),"undefined"==typeof b&&(b=this.limit),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal begin: Not an integer");if(a>>>=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal end: Not an integer");if(b>>>=0,a<0||a>b||b>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+b+" <= "+this.buffer.byteLength)}if(a===b)return new f(0,this.littleEndian,this.noAssert);var c=b-a,d=new f(c,this.littleEndian,this.noAssert);return d.offset=0,d.limit=c,d.markedOffset>=0&&(d.markedOffset-=a),this.copyTo(d,0,a,b),d},g.copyTo=function(a,b,c,d){var e,g;if(!this.noAssert&&!f.isByteBuffer(a))throw TypeError("Illegal target: Not a ByteBuffer");if(b=(g="undefined"==typeof b)?a.offset:0|b,c=(e="undefined"==typeof c)?this.offset:0|c,d="undefined"==typeof d?this.limit:0|d,b<0||b>a.buffer.byteLength)throw RangeError("Illegal target range: 0 <= "+b+" <= "+a.buffer.byteLength);if(c<0||d>this.buffer.byteLength)throw RangeError("Illegal source range: 0 <= "+c+" <= "+this.buffer.byteLength);var h=d-c;return 0===h?a:(a.ensureCapacity(b+h),a.view.set(this.view.subarray(c,d),b),e&&(this.offset+=h),g&&(a.offset+=h),this)},g.ensureCapacity=function(a){var b=this.buffer.byteLength;return b<a?this.resize((b*=2)>a?b:a):this},g.fill=function(a,b,c){var d="undefined"==typeof b;if(d&&(b=this.offset),"string"==typeof a&&a.length>0&&(a=a.charCodeAt(0)),"undefined"==typeof b&&(b=this.offset),"undefined"==typeof c&&(c=this.limit),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a|=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal begin: Not an integer");if(b>>>=0,"number"!=typeof c||c%1!==0)throw TypeError("Illegal end: Not an integer");if(c>>>=0,b<0||b>c||c>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+b+" <= "+c+" <= "+this.buffer.byteLength)}if(b>=c)return this;for(;b<c;)this.view[b++]=a;return d&&(this.offset=b),this},g.flip=function(){return this.limit=this.offset,this.offset=0,this},g.mark=function(a){if(a="undefined"==typeof a?this.offset:a,!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+0) <= "+this.buffer.byteLength)}return this.markedOffset=a,this},g.order=function(a){if(!this.noAssert&&"boolean"!=typeof a)throw TypeError("Illegal littleEndian: Not a boolean");return this.littleEndian=!!a,this},g.LE=function(a){return this.littleEndian="undefined"==typeof a||!!a,this},g.BE=function(a){return this.littleEndian="undefined"!=typeof a&&!a,this},g.prepend=function(a,b,c){"number"!=typeof b&&"string"==typeof b||(c=b,b=void 0);var d="undefined"==typeof c;if(d&&(c=this.offset),!this.noAssert){if("number"!=typeof c||c%1!==0)throw TypeError("Illegal offset: "+c+" (not an integer)");if(c>>>=0,c<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}a instanceof f||(a=f.wrap(a,b));var e=a.limit-a.offset;if(e<=0)return this;var g=e-c;if(g>0){var h=new ArrayBuffer(this.buffer.byteLength+g),i=new Uint8Array(h);i.set(this.view.subarray(c,this.buffer.byteLength),e),this.buffer=h,this.view=i,this.offset+=g,this.markedOffset>=0&&(this.markedOffset+=g),this.limit+=g,c+=g}else{new Uint8Array(this.buffer)}return this.view.set(a.view.subarray(a.offset,a.limit),c-e),a.offset=a.limit,d&&(this.offset-=e),this},g.prependTo=function(a,b){return a.prepend(this,b),this},g.printDebug=function(a){"function"!=typeof a&&(a=console.log.bind(console)),a(this.toString()+"\n-------------------------------------------------------------------\n"+this.toDebug(!0))},g.remaining=function(){return this.limit-this.offset},g.reset=function(){return this.markedOffset>=0?(this.offset=this.markedOffset,this.markedOffset=-1):this.offset=0,this},g.resize=function(a){if(!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal capacity: "+a+" (not an integer)");if(a|=0,a<0)throw RangeError("Illegal capacity: 0 <= "+a)}if(this.buffer.byteLength<a){var b=new ArrayBuffer(a),c=new Uint8Array(b);c.set(this.view),this.buffer=b,this.view=c}return this},g.reverse=function(a,b){if("undefined"==typeof a&&(a=this.offset),"undefined"==typeof b&&(b=this.limit),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal begin: Not an integer");if(a>>>=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal end: Not an integer");if(b>>>=0,a<0||a>b||b>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+b+" <= "+this.buffer.byteLength)}return a===b?this:(Array.prototype.reverse.call(this.view.subarray(a,b)),this)},g.skip=function(a){if(!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal length: "+a+" (not an integer)");a|=0}var b=this.offset+a;if(!this.noAssert&&(b<0||b>this.buffer.byteLength))throw RangeError("Illegal length: 0 <= "+this.offset+" + "+a+" <= "+this.buffer.byteLength);return this.offset=b,this},g.slice=function(a,b){if("undefined"==typeof a&&(a=this.offset),"undefined"==typeof b&&(b=this.limit),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal begin: Not an integer");if(a>>>=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal end: Not an integer");if(b>>>=0,a<0||a>b||b>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+b+" <= "+this.buffer.byteLength)}var c=this.clone();return c.offset=a,c.limit=b,c},g.toBuffer=function(a){var b=this.offset,c=this.limit;if(!this.noAssert){if("number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: Not an integer");if(b>>>=0,"number"!=typeof c||c%1!==0)throw TypeError("Illegal limit: Not an integer");if(c>>>=0,b<0||b>c||c>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+b+" <= "+c+" <= "+this.buffer.byteLength)}if(!a&&0===b&&c===this.buffer.byteLength)return this.buffer;if(b===c)return h;var d=new ArrayBuffer(c-b);return new Uint8Array(d).set(new Uint8Array(this.buffer).subarray(b,c),0),d},g.toArrayBuffer=g.toBuffer,g.toString=function(a,b,c){if("undefined"==typeof a)return"ByteBufferAB(offset="+this.offset+",markedOffset="+this.markedOffset+",limit="+this.limit+",capacity="+this.capacity()+")";switch("number"==typeof a&&(a="utf8",b=a,c=b),a){case"utf8":return this.toUTF8(b,c);case"base64":return this.toBase64(b,c);case"hex":return this.toHex(b,c);case"binary":return this.toBinary(b,c);case"debug":return this.toDebug();case"columns":return this.toColumns();default:throw Error("Unsupported encoding: "+a)}};var j=function(){for(var a={},b=[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,43,47],c=[],d=0,e=b.length;d<e;++d)c[b[d]]=d;return a.encode=function(a,c){for(var d,e;null!==(d=a());)c(b[d>>2&63]),e=(3&d)<<4,null!==(d=a())?(e|=d>>4&15,c(b[63&(e|d>>4&15)]),e=(15&d)<<2,null!==(d=a())?(c(b[63&(e|d>>6&3)]),c(b[63&d])):(c(b[63&e]),c(61))):(c(b[63&e]),c(61),c(61))},a.decode=function(a,b){function d(a){throw Error("Illegal character code: "+a)}for(var e,f,g;null!==(e=a());)if(f=c[e],"undefined"==typeof f&&d(e),null!==(e=a())&&(g=c[e],"undefined"==typeof g&&d(e),b(f<<2>>>0|(48&g)>>4),null!==(e=a()))){if(f=c[e],"undefined"==typeof f){if(61===e)break;d(e)}if(b((15&g)<<4>>>0|(60&f)>>2),null!==(e=a())){if(g=c[e],"undefined"==typeof g){if(61===e)break;d(e)}b((3&f)<<6>>>0|g)}}},a.test=function(a){return/^(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?$/.test(a)},a}();g.toBase64=function(a,b){if("undefined"==typeof a&&(a=this.offset),"undefined"==typeof b&&(b=this.limit),a=0|a,b=0|b,a<0||b>this.capacity||a>b)throw RangeError("begin, end");var d;return j.encode(function(){return a<b?this.view[a++]:null}.bind(this),d=c()),d()},f.fromBase64=function(a,c){if("string"!=typeof a)throw TypeError("str");var d=new f(a.length/4*3,c),e=0;return j.decode(b(a),function(a){d.view[e++]=a}),d.limit=e,d},f.btoa=function(a){return f.fromBinary(a).toBase64()},f.atob=function(a){return f.fromBase64(a).toBinary()},g.toBinary=function(a,b){if("undefined"==typeof a&&(a=this.offset),"undefined"==typeof b&&(b=this.limit),a|=0,b|=0,a<0||b>this.capacity()||a>b)throw RangeError("begin, end");if(a===b)return"";for(var c=[],d=[];a<b;)c.push(this.view[a++]),c.length>=1024&&(d.push(String.fromCharCode.apply(String,c)),c=[]);return d.join("")+String.fromCharCode.apply(String,c)},f.fromBinary=function(a,b){if("string"!=typeof a)throw TypeError("str");for(var c,d=0,e=a.length,g=new f(e,b);d<e;){if(c=a.charCodeAt(d),c>255)throw RangeError("illegal char code: "+c);g.view[d++]=c}return g.limit=e,g},g.toDebug=function(a){for(var b,c=-1,d=this.buffer.byteLength,e="",f="",g="";c<d;){if(c!==-1&&(b=this.view[c],e+=b<16?"0"+b.toString(16).toUpperCase():b.toString(16).toUpperCase(),a&&(f+=b>32&&b<127?String.fromCharCode(b):".")),++c,a&&c>0&&c%16===0&&c!==d){for(;e.length<51;)e+=" ";g+=e+f+"\n",e=f=""}e+=c===this.offset&&c===this.limit?c===this.markedOffset?"!":"|":c===this.offset?c===this.markedOffset?"[":"<":c===this.limit?c===this.markedOffset?"]":">":c===this.markedOffset?"'":a||0!==c&&c!==d?" ":""}if(a&&" "!==e){for(;e.length<51;)e+=" ";g+=e+f+"\n"}return a?g:e},f.fromDebug=function(a,b,c){for(var d,e,g=a.length,h=new f((g+1)/3|0,b,c),i=0,j=0,k=!1,l=!1,m=!1,n=!1,o=!1;i<g;){switch(d=a.charAt(i++)){case"!":if(!c){if(l||m||n){o=!0;break}l=m=n=!0}h.offset=h.markedOffset=h.limit=j,k=!1;break;case"|":if(!c){if(l||n){o=!0;break}l=n=!0}h.offset=h.limit=j,k=!1;break;case"[":if(!c){if(l||m){o=!0;break}l=m=!0}h.offset=h.markedOffset=j,k=!1;break;case"<":if(!c){if(l){o=!0;break}l=!0}h.offset=j,k=!1;break;case"]":if(!c){if(n||m){o=!0;break}n=m=!0}h.limit=h.markedOffset=j,k=!1;break;case">":if(!c){if(n){o=!0;break}n=!0}h.limit=j,k=!1;break;case"'":if(!c){if(m){o=!0;break}m=!0}h.markedOffset=j,k=!1;break;case" ":k=!1;break;default:if(!c&&k){o=!0;break}if(e=parseInt(d+a.charAt(i++),16),!c&&(isNaN(e)||e<0||e>255))throw TypeError("Illegal str: Not a debug encoded string");h.view[j++]=e,k=!0}if(o)throw TypeError("Illegal str: Invalid symbol at "+i)}if(!c){if(!l||!n)throw TypeError("Illegal str: Missing offset or limit");if(j<h.buffer.byteLength)throw TypeError("Illegal str: Not a debug encoded string (is it hex?) "+j+" < "+g)}return h},g.toHex=function(a,b){if(a="undefined"==typeof a?this.offset:a,b="undefined"==typeof b?this.limit:b,!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal begin: Not an integer");if(a>>>=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal end: Not an integer");if(b>>>=0,a<0||a>b||b>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+b+" <= "+this.buffer.byteLength)}for(var c,d=new Array(b-a);a<b;)c=this.view[a++],c<16?d.push("0",c.toString(16)):d.push(c.toString(16));return d.join("")},f.fromHex=function(a,b,c){if(!c){if("string"!=typeof a)throw TypeError("Illegal str: Not a string");if(a.length%2!==0)throw TypeError("Illegal str: Length not a multiple of 2")}for(var d,e=a.length,g=new f(e/2|0,b),h=0,i=0;h<e;h+=2){if(d=parseInt(a.substring(h,h+2),16),!c&&(!isFinite(d)||d<0||d>255))throw TypeError("Illegal str: Contains non-hex characters");g.view[i++]=d}return g.limit=i,g};var k=function(){var a={};return a.MAX_CODEPOINT=1114111,a.encodeUTF8=function(a,b){var c=null;for("number"==typeof a&&(c=a,a=function(){return null});null!==c||null!==(c=a());)c<128?b(127&c):c<2048?(b(c>>6&31|192),b(63&c|128)):c<65536?(b(c>>12&15|224),b(c>>6&63|128),b(63&c|128)):(b(c>>18&7|240),b(c>>12&63|128),b(c>>6&63|128),b(63&c|128)),c=null},a.decodeUTF8=function(a,b){for(var c,d,e,f,g=function(a){a=a.slice(0,a.indexOf(null));var b=Error(a.toString());throw b.name="TruncatedError",b.bytes=a,b};null!==(c=a());)if(0===(128&c))b(c);else if(192===(224&c))null===(d=a())&&g([c,d]),b((31&c)<<6|63&d);else if(224===(240&c))(null===(d=a())||null===(e=a()))&&g([c,d,e]),b((15&c)<<12|(63&d)<<6|63&e);else{if(240!==(248&c))throw RangeError("Illegal starting byte: "+c);(null===(d=a())||null===(e=a())||null===(f=a()))&&g([c,d,e,f]),b((7&c)<<18|(63&d)<<12|(63&e)<<6|63&f)}},a.UTF16toUTF8=function(a,b){for(var c,d=null;;){if(null===(c=null!==d?d:a()))break;c>=55296&&c<=57343&&null!==(d=a())&&d>=56320&&d<=57343?(b(1024*(c-55296)+d-56320+65536),
d=null):b(c)}null!==d&&b(d)},a.UTF8toUTF16=function(a,b){var c=null;for("number"==typeof a&&(c=a,a=function(){return null});null!==c||null!==(c=a());)c<=65535?b(c):(c-=65536,b((c>>10)+55296),b(c%1024+56320)),c=null},a.encodeUTF16toUTF8=function(b,c){a.UTF16toUTF8(b,function(b){a.encodeUTF8(b,c)})},a.decodeUTF8toUTF16=function(b,c){a.decodeUTF8(b,function(b){a.UTF8toUTF16(b,c)})},a.calculateCodePoint=function(a){return a<128?1:a<2048?2:a<65536?3:4},a.calculateUTF8=function(a){for(var b,c=0;null!==(b=a());)c+=b<128?1:b<2048?2:b<65536?3:4;return c},a.calculateUTF16asUTF8=function(b){var c=0,d=0;return a.UTF16toUTF8(b,function(a){++c,d+=a<128?1:a<2048?2:a<65536?3:4}),[c,d]},a}();return g.toUTF8=function(a,b){if("undefined"==typeof a&&(a=this.offset),"undefined"==typeof b&&(b=this.limit),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal begin: Not an integer");if(a>>>=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal end: Not an integer");if(b>>>=0,a<0||a>b||b>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+b+" <= "+this.buffer.byteLength)}var d;try{k.decodeUTF8toUTF16(function(){return a<b?this.view[a++]:null}.bind(this),d=c())}catch(e){if(a!==b)throw RangeError("Illegal range: Truncated data, "+a+" != "+b)}return d()},f.fromUTF8=function(a,c,d){if(!d&&"string"!=typeof a)throw TypeError("Illegal str: Not a string");var e=new f(k.calculateUTF16asUTF8(b(a),!0)[1],c,d),g=0;return k.encodeUTF16toUTF8(b(a),function(a){e.view[g++]=a}),e.limit=g,e},f})},function(a,b,c){var d,e;d=[],e=function(){"use strict";var a={level:{TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,FATAL:5}};return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(57),c(56),c(25)],e=function(a,b,c){return{MQWebSocket:a,BatchHttpProto:b,MQService:c}}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(6),c(44)],e=function(a,b,c){"use strict";function d(a,b,c,d){if("string"!=typeof a)throw new Error('Must pass a valid "version"');if("string"!=typeof b)throw new Error('Must pass a valid "baseUri"');if("object"!=typeof c)throw new Error('Must pass a valid "logger"');this._version=a,this._baseUri=b,this._logger=c,this._sessionTelemetry=d}function e(a,b){if(0===a.lastIndexOf("wss:",0))b(void 0,{uri:a+"/ws",roundTripTime:0});else if(0===a.lastIndexOf("https:",0)){var d=this;f.call(d,a,function(a,e){if(a)return b(a);var f=new c(d._logger,d._version,b,function(a,b){return a?void d._logger.warn("An error occured in resolving an endpoint",a):void d._sessionTelemetry.recordMetric("RoundTripTime",{uint64:b.time},null,{resource:b.endPoint,kind:"https"})});f.resolveAll(e)})}else b(new Error("Uri not supported"))}function f(c,d){b.getWithRetry(c+"/pcast/endPoints",{timeout:15e3,queryParameters:{version:"2018-01-13T00:05:28Z",_:a.now()}},function(a,b){if(a)return d(new Error("Failed to resolve an end point",a));var c=b.split(",");c.length<1&&d(new Error("Failed to discover end points")),d(void 0,c)},g)}var g=4;return d.DefaultPCastUri="https://pcast.phenixp2p.com",d.prototype.getBaseUri=function(){return this._baseUri},d.prototype.resolveUri=function(a){return e.call(this,this._baseUri,a)},d.prototype.toString=function(){return"PCastEndPoint["+this._baseUri+"]"},d}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(8),c(74)],e=function(a,b,c,d){"use strict";function e(){}return e.prototype.createPCastLogger=function(a,e){a&&b.isStringNotEmpty(a,"baseUri");var f=new c.Logger,g=d.getAppender(a);return g.setThreshold(c.level.INFO),e||f.addAppender(new c.ConsoleAppender),f.addAppender(g),f.isPCastLogger=!0,f},new e}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";var a={roles:{participant:{id:0,name:"Participant"},moderator:{id:1,name:"Moderator"},presenter:{id:2,name:"Presenter"},audience:{id:3,name:"Audience"}},states:{active:{id:0,name:"Active"},passive:{id:1,name:"Passive"},handRaised:{id:2,name:"HandRaised"},inactive:{id:3,name:"Inactive"},offline:{id:4,name:"Offline"}}};return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";var a={types:{directChat:{id:0,name:"DirectChat"},multiPartyChat:{id:1,name:"MultiPartyChat"},moderatedChat:{id:2,name:"ModeratedChat"},townHall:{id:3,name:"TownHall"},channel:{id:4,name:"Channel"}},events:{memberJoined:{id:0,name:"MemberJoined"},memberLeft:{id:1,name:"MemberLeft"},memberUpdated:{id:2,name:"MemberUpdated"},roomUpdated:{id:3,name:"RoomUpdated"},roomEnded:{id:4,name:"RoomEnded"}}};return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(4),c(14),c(6),c(63),c(13),c(91),c(92),c(64),c(9),c(90),c(88),c(87),c(83),c(80),c(7),c(2),c(78)],e=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){"use strict";function t(e){e=e||{},b.isObject(e,"options"),e.streamingSourceMapping&&(b.isObject(e.streamingSourceMapping,"options.streamingSourceMapping"),b.isStringNotEmpty(e.streamingSourceMapping.replacement,"options.streamingSourceMapping.replacement"),e.streamingSourceMapping.patternToReplace instanceof RegExp||b.isStringNotEmpty(e.streamingSourceMapping.patternToReplace,"options.streamingSourceMapping.patternToReplace")),this._observableStatus=new c.Observable("offline"),this._baseUri=e.uri||g.DefaultPCastUri,this._deviceId=e.deviceId||"",this._version=Y,this._logger=e.logger||d.createPCastLogger(this._baseUri,e.disableConsoleLogging),this._metricsTransmitter=e.metricsTransmitter||l.createMetricsTransmitter(this._baseUri),this._sessionTelemetry=new n(this._logger,this._metricsTransmitter),this._endPoint=new g(this._version,this._baseUri,this._logger,this._sessionTelemetry),this._screenShareExtensionManager=new h(e,this._logger),this._shaka=e.shaka,this._videojs=e.videojs||window.videojs,this._status="offline",this._streamingSourceMapping=e.streamingSourceMapping;var f=this;a.addEventListener(window,"unload",function(){return f._logger.info("Window Unload Event Triggered"),f.stop()}),e.disableBeforeUnload||a.addEventListener(window,"beforeunload",function(){return f._logger.info("Window Before Unload Event Triggered"),f.stop()}),r.webrtcSupported&&H.call(this)}function u(b){this._protocol=new f(b,this._deviceId,this._version,this._logger),this._protocol.onEvent("connected",a.bind(v,this)),this._protocol.onEvent("reconnecting",a.bind(w,this)),this._protocol.onEvent("reconnected",a.bind(x,this)),this._protocol.onEvent("disconnected",a.bind(y,this)),this._protocol.onEvent("pcast.StreamEnded",a.bind(A,this)),this._protocol.onEvent("pcast.StreamDataQuality",a.bind(B,this)),this._logger.setObservableSessionId&&this._logger.setObservableSessionId(this._protocol.getObservableSessionId()),this._sessionTelemetrySubscription&&(this._sessionTelemetrySubscription.dispose(),this._sessionTelemetry.setSessionId(null)),this._sessionTelemetrySubscription=this._protocol.getObservableSessionId().subscribe(a.bind(this._sessionTelemetry.setSessionId,this._sessionTelemetry))}function v(){var a=this;this._connected=!0,a._stopped||a._protocol.authenticate(a._authToken,function(b,c){a._authenticationCallback&&(b?(a._logger.error("Failed to authenticate [%s]",b),M.call(a,"offline"),a._authenticationCallback.call(a,a,"unauthorized",""),a.stop("unauthorized")):"ok"!==c.status?(a._logger.warn("Failed to authenticate, status [%s]",c.status),M.call(a,"offline"),a._authenticationCallback.call(a,a,"unauthorized",""),a.stop("unauthorized")):(M.call(a,"online"),a._authenticationCallback.call(a,a,c.status,c.sessionId)))})}function w(){M.call(this,"reconnecting")}function x(){M.call(this,"reconnected"),this._logger.info("Attempting to re-authenticate after reconnect event");var a=this;a._stopped||a._protocol.authenticate(a._authToken,function(b,c){var d=a._connected===!0;return b?(a._logger.error("Unable to authenticate after reconnect to WebSocket [%s]",b),M.call(a,"offline")):"ok"!==c.status?(a._logger.warn("Unable to authenticate after reconnect to WebSocket, status [%s]",c.status),M.call(a,"offline")):(a._connected=!0,a._logger.info("Successfully authenticated after reconnect to WebSocket"),M.call(a,"online",d))})}function y(){this._connected=!1,M.call(this,"offline")}function z(a){switch(a){case"":case"none":case"ended":return"ended";case"server-error":case"session-error":case"not-ready":case"error":case"died":return"failed";case"censored":return"censored";case"maintenance":return"maintenance";case"capacity":return"capacity";case"app-background":return"app-background";default:return"custom"}}function A(a){var b=a.streamId,c=a.reason;return C.call(this,b,c)}function B(a){var b=a.streamId,c=a.status,d=a.reason,e=this._mediaStreams[b];e&&e.dataQualityChangedCallback(c,d);var f=this._publishers[b];f&&"function"==typeof f.dataQualityChangedCallback&&f.dataQualityChangedCallback(f,c,d)}function C(a,b){this._logger.info("[%s] Stream ended with reason [%s]",a,b);var c=this._mediaStreams[a];c&&c.streamEndedCallback(z(b),b,!0),delete this._mediaStreams[a];var d=this._publishers[a];d&&"function"==typeof d.publisherEndedCallback&&d.publisherEndedCallback(d,z(b),b),delete this._publishers[a];var e=this._peerConnections[a];e&&Q.call(this,a,e,"ended"),delete this._peerConnections[a]}function D(c,d,e,f,g,h){var i=this,l=function(l){function m(){return O(o)}function n(a){d.stopped||(i._logger.info("[%s] stop media stream",c),Q.call(i,c,e,"stop"),i._protocol.destroyStream(c,a||"",function(a,b){return a?void i._logger.error("[%s] failed to destroy stream [%s]",c,a):"ok"!==b.status?void i._logger.warn("[%s] failed to destroy stream, status [%s]",c,b.status):void i._logger.info("[%s] destroyed stream",c)}),d.stopped=!0)}if(!d.failed){var o=l.stream;if(!o)return d.failed=!0,i._logger.warn("[%s] No remote stream",c),g.call(i,void 0,"failed");i._logger.info("[%s] Got remote stream",c),f.setProperty("kind","real-time");var p=function t(g){var l={children:[],monitor:null,renderer:null,isStopped:!1,isStreamEnded:!1,mediaStream:{createRenderer:function(){var b=null,c=new k(i._logger);return{start:function(a){return b=r.attachMediaStream(a,g),f.recordTimeToFirstFrame(b),f.recordRebuffering(b),f.recordVideoResolutionChanges(this,b),h.receiveAudio===!1&&(b.muted=!0),l.renderer=this,c.start(this,b),b},stop:function(){c.stop(),f.stop(),b&&("function"==typeof b.pause&&b.pause(),"Edge"===r.browser&&(b.src=""),b.src&&"IE"===r.browser?b.src=null:b.src&&(b.src=""),b.srcObject&&(b.srcObject=null),b=null),l.renderer=null},getStats:function(){if(!b)return{width:0,height:0,currentTime:0,lag:0,networkState:q.networkStates.networkNoSource.id};var c=(a.now()-h.originStartTime)/1e3,d=i._networkOneWayLatency/1e3;return{width:b.videoWidth||b.width,height:b.videoHeight||b.height,currentTime:c,lag:d,networkState:b.networkState}},setDataQualityChangedCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.dataQualityChangedCallback=a},addVideoDisplayDimensionsChangedCallback:function(a,b){c.addVideoDisplayDimensionsChangedCallback(a,b)}}},setStreamEndedCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.streamEndedCallback=a},setStreamErrorCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.streamErrorCallback=a},stop:function(a){l.isStopped||(N(g),(m()||"Edge"===r.browser||"IE"===r.browser)&&n(a),l.isStopped=!0)},monitor:function p(a,b){if("object"!=typeof a)throw new Error('"options" must be an object');if("function"!=typeof b)throw new Error('"callback" must be a function');var p=new j(c,e,i._logger);return a.direction="inbound",p.start(a,function(){return l.mediaStream.isActive()},function(a){return i._logger.warn("[%s] Media stream triggered monitor condition for [%s]",c,a),b(l.mediaStream,"client-side-failure",a)}),l.monitor=p,p},getMonitor:function(){return l.monitor},getStats:function(a){b.isFunction(a,"callback"),this._lastStats||(this._lastStats={});var c=this;return r.getStats(e,null,function(b){a(R(b,c._lastStats))})},getStream:function(){return g},isActive:function(){var a=d.stopped,b="object"!=typeof i._mediaStreams[c],e=l.isStopped;return!a&&!b&&!e},getStreamId:function(){return c},select:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');if("function"!=typeof window.MediaStream)throw new Error("MediaStream not supported in current browser");for(var b=o.getTracks(),c=new window.MediaStream,d=0;d<b.length;d++)a(b[d],d)&&c.addTrack(b[d]);if(0===c.getTracks().length)return i._logger.warn("No tracks selected");var e=t(c);return l.children.push(e),e.mediaStream}},streamErrorCallback:function(a,b){for(var c=0;c<l.children.length;c++)l.children[c].streamErrorCallback(a,b);var d=l.mediaStream;"function"==typeof d.streamErrorCallback&&d.streamErrorCallback(d,a,b)},streamEndedCallback:function(a,b){for(var c=0;c<l.children.length;c++)l.children[c].streamEndedCallback(a,b);if(!l.isStreamEnded){var d=l.mediaStream;l.isStreamEnded=!0,"function"==typeof d.streamEndedCallback&&d.streamEndedCallback(d,a,b),d.stop(),l.renderer&&l.renderer.stop()}},dataQualityChangedCallback:function(a,b){for(var c=0;c<l.children.length;c++)l.children[c].dataQualityChangedCallback(a,b);var d=l.renderer;d&&"function"==typeof d.dataQualityChangedCallback&&d.dataQualityChangedCallback(d,a,b)}};return l},s=p(o);i._mediaStreams[c]=s,g.call(i,s.mediaStream)}};a.addEventListener(e,"addstream",l)}function E(b,c,d){var e=this,f=function(a){var c=a.candidate;c?e._logger.debug("[%s] ICE candidate: [%s] [%s] [%s]",b,c.sdpMid,c.sdpMLineIndex,c.candidate):e._logger.info("[%s] ICE candidate discovery complete",b),d&&d(c)};a.addEventListener(c,"icecandidate",f)}function F(b,c){var d=this,e=function(a){d._logger.info("[%s] Negotiation needed")},f=function(a){d._logger.info("[%s] ICE connection state changed [%s]",b,c.iceConnectionState)},g=function(a){d._logger.info("[%s] ICE gathering state changed [%s]",b,c.iceGatheringState)},h=function(a){d._logger.info("[%s] Signaling state changed [%s]",b,c.signalingState)},i=function(a){d._logger.info("[%s] Connection state changed [%s]",b,c.connectionState)};a.addEventListener(c,"negotiationneeded",e),a.addEventListener(c,"iceconnectionstatechange",f),a.addEventListener(c,"icegatheringstatechange ",g),a.addEventListener(c,"signalingstatechange",h),a.addEventListener(c,"connectionstatechange",i)}function G(a,b,c){var d=this,e={stopped:!1},f={getStreamId:function(){return a},getStream:function(){return d._logger.debug("[%s] Unable to get stream on publisher of remote origin.",a),null},getStats:function(){return d._logger.debug("[%s] Unable to get stream stats on publisher of remote origin.",a),null},isActive:function(){return!e.stopped},hasEnded:function(){return e.stopped},stop:function(b){e.stopped||(d._protocol.destroyStream(a,b||"",function(b,c){return b?void d._logger.error("[%s] failed to destroy stream [%s]",a,b):"ok"!==c.status?void d._logger.warn("[%s] failed to destroy stream, status [%s]",a,c.status):void d._logger.info("[%s] destroyed stream",a)}),e.stopped=!0)},setPublisherEndedCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.publisherEndedCallback=a},setDataQualityChangedCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.dataQualityChangedCallback=a},getOptions:function(){return c},monitor:function(a,b){if("object"!=typeof a)throw new Error('"options" must be an object');if("function"!=typeof b)throw new Error('"callback" must be a function')},getMonitor:function(){return null}};d._publishers[a]=f,b(f)}function H(){var a=this,b=new r.RTCPeerConnection;"Safari"===r.browser&&r.browserVersion>10&&(b.addTransceiver("audio"),b.addTransceiver("video")),b.createOffer(function(b){var c=s.getH264ProfileId(b.sdp);return c?(a._logger.info("Found local h264 profile level id [%s]",c),void(a._h264ProfileId=c)):a._logger.info("Unable to find local h264 profile level id")},function(b){a._logger.error("Unable to create offer to get local h264 profile level id",b)},{offerToReceiveAudio:!0,offerToReceiveVideo:!0})}function I(c,d,e,f,g,h,i,k){function l(){function c(c){m._logger.info("Created answer [%s]",c.sdp),m._protocol.setAnswerDescription(e,c.sdp,function(c,g){function i(){var a=/(b=AS:([0-9]*)[\n\r]*)/gi,c=/(mid:video)([\n\r]*)/gi;m._logger.info("Set local description (answer)");var g=0,i=a.exec(f);i&&i.length>=3&&(g=1e3*i[2]);var l={getStreamId:function(){return e},getStream:function(){return d},isActive:function(){return!n.stopped},hasEnded:function(){switch(q.iceConnectionState){case"new":case"checking":case"connected":case"completed":return!1;case"disconnected":case"failed":case"closed":return!0;default:return!0}},stop:function(a){n.stopped||(Q.call(m,e,q,"closed"),m._protocol.destroyStream(e,a||"",function(a,b){return a?void m._logger.error("[%s] failed to destroy stream [%s]",e,a):"ok"!==b.status?void m._logger.warn("[%s] failed to destroy stream, status [%s]",e,b.status):void m._logger.info("[%s] destroyed stream",e)}),n.stopped=!0)},setPublisherEndedCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.publisherEndedCallback=a},setDataQualityChangedCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.dataQualityChangedCallback=a},limitBandwidth:function(b){if("Edge"===r.browser)return m._logger.warn("Limit bandwidth not support on [%s]",r.browser);if("number"!=typeof b)throw new Error('"bandwidthLimit" must be a number');var d=g?Math.min(b,g):b,e=q.remoteDescription;m._logger.info("Changing bandwidth limit to [%s]",d);var f=e.sdp.replace(a,"");f=f.replace(c,function(a,b,c,e,f){return[b,c,"b=AS:",Math.ceil(d/1e3),c].join("")});var h=new r.RTCSessionDescription({type:e.type,sdp:f});return q.setRemoteDescription(h),{dispose:function(){q.setRemoteDescription(e)}}},monitor:function o(a,b){if("object"!=typeof a)throw new Error('"options" must be an object');if("function"!=typeof b)throw new Error('"callback" must be a function');var o=new j(e,q,m._logger);return a.direction="outbound",o.start(a,function(){return m._publishers[e]===l&&!n.stopped},function(a){return m._logger.warn("[%s] Publisher triggered monitor condition for [%s]",e,a),b(l,"client-side-failure",a)}),u=o,o},getMonitor:function(){return u},setRemoteMediaStreamCallback:function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.remoteMediaStreamCallback=a,s&&a(l,s)},getOptions:function(){return k},getStats:function(a){b.isFunction(a,"callback"),this._lastStats||(this._lastStats={});var c=this;return r.getStats(q,null,function(b){a(R(b,c._lastStats))})}};m._publishers[e]=l,h.call(m,l)}if(c)return m._logger.error("Failed to set answer description [%s]",c),w();if("ok"!==g.status)return m._logger.warn("Failed to set answer description, status [%s]",g.status),w();a.includes(g.options,"ice-candidates")&&(t=function(b){var c=[],d=[];b?c.push(b):d.push("completed"),m._protocol.addIceCandidates(e,c,d,function(b,c){return b?void m._logger.error("Failed to add ICE candidate [%s]",b):"ok"!==c.status?void m._logger.warn("Failed to add ICE candidate, status [%s]",c.status):void(a.includes(c.options,"cancel")&&(t=null))})});var l=new r.RTCSessionDescription({type:"answer",sdp:g.sessionDescription.sdp});q.setLocalDescription(l,i,w)})}m._logger.info("Set remote description (offer)");var g={mandatory:{}};"Chrome"===r.browser?(g.mandatory.OfferToReceiveVideo=i.receiveVideo===!0,g.mandatory.OfferToReceiveAudio=i.receiveAudio===!0):(g.mandatory.offerToReceiveVideo=i.receiveVideo===!0,g.mandatory.offerToReceiveAudio=i.receiveAudio===!0),q.createAnswer(c,w,g)}var m=this,n={failed:!1,stopped:!1},o=f.match(/a=crypto:/i),p=f.match(/m=application /i),q=new r.RTCPeerConnection(c,{optional:[{DtlsSrtpKeyAgreement:!o},{RtpDataChannels:p}]}),s=null,t=null,u=null;if(m._peerConnections[e]=q,q.addStream(d),"Firefox"===r.browser||"Edge"===r.browser){if(f.match(/(\nm=video)/g)&&f.match(/(\nm=audio)/g)){var v=/(a=candidate)((.|\n)*)(?=m=)/g;f=f.replace(v,f.match(v)+"a=end-of-candidates\n")}f+="a=end-of-candidates",f=f.replace(/(\na=ice-options:trickle)/g,"")}var w=function(){n.failed||(n.failed=!0,n.stopped=!0,delete m._peerConnections[e],Q.call(m,e,q,"failure"),h.call(m,void 0,"failed"))};D.call(m,e,n,q,g,function(a){var b=m._publishers[e];s=a,b&&b.remoteMediaStreamCallback&&b.remoteMediaStreamCallback(b,a)},i),E.call(m,e,q,function(a){t&&t(a)}),F.call(m,e,q);var x=new r.RTCSessionDescription({type:"offer",sdp:f});q.setRemoteDescription(x,l,w)}function J(b,c,d,e,f,g){function h(){function b(b){i._logger.info("Created answer [%s]",b.sdp),i._protocol.setAnswerDescription(c,b.sdp,function(b,d){function e(){i._logger.debug("Set local description (answer)")}if(b)return i._logger.error("Failed to set answer description [%s]",b),p();if("ok"!==d.status)return i._logger.warn("Failed to set answer description, status [%s]",d.status),p();a.includes(d.options,"ice-candidates")&&(n=function(b){var d=[],e=[];b?d.push(b):e.push("completed"),i._protocol.addIceCandidates(c,b,e,function(b,c){return b?void i._logger.error("Failed to add ICE candidate [%s]",b):"ok"!==c.status?void i._logger.warn("Failed to add ICE candidate, status [%s]",c.status):void(a.includes(c.options,"cancel")&&(n=null))})});var f=new r.RTCSessionDescription({type:"answer",sdp:d.sessionDescription.sdp});m.setLocalDescription(f,e,p)})}i._logger.debug("Set remote description (offer)");var d={mandatory:{}};"Chrome"===r.browser?(d.mandatory.OfferToReceiveVideo=g.receiveVideo!==!1,d.mandatory.OfferToReceiveAudio=g.receiveAudio!==!1):(d.mandatory.offerToReceiveVideo=g.receiveVideo!==!1,d.mandatory.offerToReceiveAudio=g.receiveAudio!==!1),m.createAnswer(b,p,d)}if("IE"===r.browser)throw new Error("Subscribing in real-time not supported on IE without the PhenixP2P Plugin");var i=this,j={failed:!1,stopped:!1},k=d.match(/a=crypto:/i),l=d.match(/m=application /i),m=new r.RTCPeerConnection(b,{optional:[{DtlsSrtpKeyAgreement:!k},{RtpDataChannels:l}]}),n=null;if(i._peerConnections[c]=m,"Firefox"===r.browser||"Edge"===r.browser){if(d.match(/(\nm=video)/g)&&d.match(/(\nm=audio)/g)){var o=/(a=candidate)((.|\n)*)(?=m=)/g;d=d.replace(o,d.match(o)+"a=end-of-candidates\n")}d+="a=end-of-candidates",d=d.replace(/(\na=ice-options:trickle)/g,"")}var p=function(){j.failed||(j.failed=!0,j.stopped=!0,delete i._peerConnections[c],Q.call(i,c,m,"failure"),f.call(i,void 0,"failed"))};D.call(i,c,j,m,e,f,g),E.call(i,c,m,function(a){n&&n(a)}),F.call(i,c,m);var q=new r.RTCSessionDescription({type:"offer",sdp:d});m.setRemoteDescription(q,h,p)}function K(b,c,d,e,f){var g=this,h=c.match(/a=x-playlist:([^\n]*[.]mpd\??[^\s]*)/m),i=c.match(/a=x-playlist:([^\n]*[.]m3u8\??[^\s]*)/m),j=a.get(h,[1],""),k=a.get(i,[1],"");this._streamingSourceMapping&&(j=j.replace(this._streamingSourceMapping.patternToReplace,this._streamingSourceMapping.replacement),k=k.replace(this._streamingSourceMapping.patternToReplace,this._streamingSourceMapping.replacement));var l=_()||"Safari"===r.browser;return h&&2===h.length&&!l?(f.isDrmProtectedContent=/[?&]drmToken=([^&]*)/.test(h[1])||/x-widevine-service-certificate/.test(c),f.isDrmProtectedContent&&(f.widevineServiceCertificateUrl=c.match(/a=x-widevine-service-certificate:([^\n][^\s]*)/m)[1],f.playreadyLicenseUrl=c.match(/a=x-playready-license-url:([^\n][^\s]*)/m)[1]),this._shaka&&!this._shaka.Player.isBrowserSupported()?(this._logger.warn("[%s] Shaka does not support this browser",b),e.call(this,void 0,"browser-unsupported")):L.call(g,b,j,q.types.dash.name,d,e,f)):i&&2===i.length&&"maybe"===document.createElement("video").canPlayType("application/vnd.apple.mpegURL")?(f.isDrmProtectedContent=/[?&]drmToken=([^&]*)/.test(i[1]),L.call(g,b,k,q.types.hls.name,d,e,f)):(g._logger.warn("[%s] Offer does not contain a supported manifest",b,c),e.call(g,void 0,"failed"))}function L(a,b,c,d,e,f){var g=this,h=new p(c,a,b,d,f,this._shaka,this._logger),i=new o(c,h,this._logger),j=this._shaka&&c===q.types.dash.name?"shaka":c,k=function(a,b){g._logger.warn("Phenix Live Stream Player Error [%s] [%s]",a,b),i.streamErrorCallback(j,b.detail)},l=function(b){g._protocol.destroyStream(a,b||"",function(b,c){return b?void g._logger.error("[%s] failed to destroy stream, [%s]",a,b):"ok"!==c.status?void g._logger.warn("[%s] failed to destroy stream, status [%s]",a,c.status):void 0})};d.setProperty("kind",c),i.on(q.streamEvents.playerError.name,k),i.on(q.streamEvents.stopped.name,l),this._mediaStreams[a]=i,e.call(this,i.getPhenixMediaStream())}function M(a,b){var c=this.getStatus();if(c!==a){if(this._observableStatus.setValue(a),b)return;switch(a){case"connecting":case"reconnecting":case"reconnected":break;case"offline":this._offlineCallback.call(this);break;case"online":this._onlineCallback.call(this)}}}function N(b){if(b&&a.isFunction(b.stop,"stream.stop")&&b.stop(),b&&a.isFunction(b.getTracks,"stream.getTracks"))for(var c=b.getTracks(),d=0;d<c.length;d++){var e=c[d];e.stop()}}function O(b){return a.reduce(b.getTracks(),function(a,b){return a&&P(b)},!0)}function P(a){if("object"!=typeof a)throw new Error("Invalid track.");return"ended"===a.readyState}function Q(a,b,c){"closed"===b.signalingState||b.__closing||(this._logger.debug("[%s] close peer connection [%s]",a,c),b.close(),b.__closing=!0)}function R(b,c){if(!b)return null;var d=[],e=function(b,e,f,g,h){if(b){a.hasIndexOrKey(c,b)||(c[b]={timestamp:0});var i=parseFloat(f)-c[b].timestamp,j=S(parseFloat(g),c[b].bytesSent,i),k=T(parseFloat(h),c[b].bytesReceived,i);c[b].bytesSent=parseFloat(g),c[b].bytesReceived=parseFloat(h),c[b].timestamp=parseFloat(f),d.push({uploadRate:j,downloadRate:k,mediaType:e,ssrc:b})}};return a.isFunction(b.result)?a.forEach(b.result(),function(a){if("ssrc"===a.type){var b=a.stat("ssrc"),c=a.stat("bytesSent"),d=a.stat("bytesReceived"),f=a.stat("mediaType"),g=a.timestamp.getTime();e(b,f,g,c,d)}}):a.isFunction(b.values)?a.forEach(Array.from(b.values()),function(b){if(a.hasIndexOrKey(b,"ssrc")){if(!b.ssrc||a.includes(b.id,"rtcp"))return;e(b.ssrc,b.mediaType,b.timestamp,b.bytesSent,b.bytesReceived)}}):a.forEach(b,function(b){if(a.hasIndexOrKey(b,"ssrc")){if(!b.ssrc||a.includes(b.id,"rtcp"))return;e(b.ssrc,b.mediaType,b.timestamp,b.bytesSent,b.bytesReceived)}}),d}function S(a,b,c){if(a){var d=b||0,e=8e3*(a-d)/c;return Math.round(e/1e3)}return 0}function T(a,b,c){if(a){var d=b||0,e=8e3*(a-d)/c;return Math.round(e/1e3)}return 0}function U(b){if(!b)return b;var c=a.isArray(b)?[]:{},d=a.bind(V,null,c);return a.isArray(b)?a.forEach(b,d):a.forOwn(b,d),c}function V(b,c,d){if(null!==c){if(a.isObject(c)||a.isArray(c))return b[d]=U(c);if(!a.isString(c)||!a.isString(d))return b[d]=c;var e=a.startsWith(c.toLowerCase(),d.toLowerCase()),f=e?c.substring(d.length,c.length).toLowerCase():c;b[d]=f}}function W(a){return"Firefox"===r.browser&&X(a),a}function X(b){return b?(a.forEach(b.iceServers,function(b){b.urls=a.filter(b.urls,function(b){return!a.startsWith(b,"turns")})}),b):b}var Y="2018-01-13T00:05:28Z",Z=!0;t.prototype.getBaseUri=function(){return this._endPoint.getBaseUri()},t.prototype.getStatus=function(){return this._observableStatus.getValue()},t.prototype.getObservableStatus=function(){return this._observableStatus},t.prototype.start=function(a,b,c,d){if("string"!=typeof a)throw new Error('"authToken" must be a string');if("function"!=typeof b)throw new Error('"authenticationCallback" must be a function');if("function"!=typeof c)throw new Error('"onlineCallback" must be a function');if("function"!=typeof d)throw new Error('"offlineCallback" must be a function');if(this._started)throw new Error('"Already started"');this._stopped=!1,this._started=!0,this._authToken=a,this._authenticationCallback=b,this._onlineCallback=c,this._offlineCallback=d,M.call(this,"connecting"),this._peerConnections={},this._mediaStreams={},this._publishers={},this._gumStreams=[];var e=this;e._endPoint.resolveUri(function(a,b){if(a){switch(e._logger.error("Failed to connect to [%s]",e._baseUri,a),M.call(e,"offline"),a.code){case 0:e._authenticationCallback.call(e,e,"network-unavailable","");break;case 503:e._authenticationCallback.call(e,e,"capacity","");break;default:e._authenticationCallback.call(e,e,"failed","")}return e._stopped=!0,void(e._started=!1)}e._logger.info("Discovered end point [%s] with RTT [%s]",b.uri,b.roundTripTime),e._networkOneWayLatency=b.roundTripTime/2,e._resolvedEndPoint=b.uri,u.call(e,b.uri)})},t.prototype.stop=function(){if(this._started){this._stopped=!0,this._started=!1,delete this._authenticationCallback;try{var b="",c=this;a.forOwn(this._mediaStreams,function(a,d){C.call(c,d,b)}),a.forOwn(this._publishers,function(d,e){C.call(c,e,b),a.includes(d.getOptions(),"detached")||d.stop(b)}),a.forOwn(this._peerConnections,function(a,d){C.call(c,d,b)}),a.forEach(this._gumStreams,function(b){var c=b.getTracks();a.forEach(c,function(a){a.stop()})})}finally{this._protocol&&(this._protocol.disconnect(),this._protocol=null),this._logger.setObservableSessionId&&this._logger.setObservableSessionId(null),this._sessionTelemetrySubscription&&(this._sessionTelemetrySubscription.dispose(),this._sessionTelemetry.setSessionId(null))}}},t.prototype.getUserMedia=function(a,c,d){if("IE"===r.browser)throw new Error("Publishing not supported on IE");b.isObject(a,"options"),b.isFunction(c,"callback"),d&&b.isFunction(d,"onScreenShare");var e=new i(this._logger,this._screenShareExtensionManager,d);return e.getUserMedia(a,c)},t.prototype.publish=function(b,c,d,e,f){if("Edge"===r.browser)throw new Error("Publishing not supported on Edge");if("IE"===r.browser)throw new Error("Publishing not supported on IE");if(!this._started)throw new Error("PCast not started. Unable to publish. Please start pcast first.");if("string"!=typeof b)throw new Error('"streamToken" must be a string');if("object"!=typeof c&&"string"!=typeof c)throw new Error('"streamToPublish" must be an object or URI');if("function"!=typeof d)throw new Error('"callback" must be a function');if(e=e||[],!Array.isArray(e))throw new Error('"tags" must be an array');if(f=f||{},"object"!=typeof f)throw new Error('"options" must be an object');var g=this,h="upload",i=a.assign({},f,{negotiate:!0});"string"==typeof c?(i.negotiate=!1,i.connectUri=c):i.connectUri=f.connectUri,e.length>0&&(i.tags=e);var j=new m(this.getProtocol().getSessionId(),this._logger,this._metricsTransmitter);j.setProperty("resource",h),this._protocol.setupStream(h,b,i,function(a,b){if(a)return g._logger.error("Failed to create uploader [%s]",a),d.call(g,g,"failed");if("ok"===b.status){var e=b.createStreamResponse.streamId;if(j.setStreamId(e),j.setStartOffset(b.createStreamResponse.offset),j.recordMetric("Provisioned"),j.recordMetric("RoundTripTime",{uint64:2*g._networkOneWayLatency},null,{resource:g._resolvedEndPoint,kind:"https"}),i.negotiate===!0){var h=b.createStreamResponse.createOfferDescriptionResponse.sessionDescription.sdp,k=W(U(b.createStreamResponse.rtcConfiguration));return I.call(g,k,c,e,h,j,function(a,b){j.recordMetric("SetupCompleted",{string:b?"failed":"ok"}),b?d.call(g,g,"failed",null):d.call(g,g,"ok",a)},f,b.createStreamResponse.options)}return G.call(g,e,function(a,b){j.recordMetric("SetupCompleted",{string:b?"failed":"ok"}),b?d.call(g,g,"failed",null):d.call(g,g,"ok",a)},b.createStreamResponse.options)}switch(g._logger.warn("Failed to create uploader, status [%s]",b.status),b.status){case"capacity":case"unauthorized":return d.call(g,g,b.status);default:return d.call(g,g,"failed")}})},t.prototype.subscribe=function(b,c,d){if(!this._started)throw new Error("PCast not started. Unable to subscribe. Please start pcast first.");if("string"!=typeof b)throw new Error('"streamToken" must be a string');if("function"!=typeof c)throw new Error('"callback" must be a function');if(d=d||{},"object"!=typeof d)throw new Error('"options" must be an object');var e=this,f="download",g=a.assign({},d,{negotiate:d.negotiate!==!1}),h=new m(this.getProtocol().getSessionId(),this._logger,this._metricsTransmitter),i=a.assign({},{
useNativeHlsPlayer:Z},d);h.setProperty("resource",f),this._protocol.setupStream(f,b,g,function(b,d){if(b)return e._logger.error("Failed to create downloader [%s]",b),c.call(e,e,"failed");if("ok"===d.status){var f=d.createStreamResponse.streamId,g=d.createStreamResponse.createOfferDescriptionResponse.sessionDescription.sdp,j=W(U(d.createStreamResponse.rtcConfiguration)),k=a.bind(J,e,j);if(g.match(/a=x-playlist:/)&&(k=K),h.setStreamId(f),h.setStartOffset(d.createStreamResponse.offset),h.recordMetric("Provisioned"),h.recordMetric("RoundTripTime",{uint64:2*e._networkOneWayLatency},null,{resource:e.getBaseUri(),kind:"https"}),i.originStartTime=a.now()-d.createStreamResponse.offset+e._networkOneWayLatency,"Chrome"===r.browser&&r.browserVersion>=62&&e._h264ProfileId&&$()){var l=s.getH264ProfileId(g);l!==e._h264ProfileId&&(e._logger.info("[%s] Replacing h264 profile level id [%s] with new value [%s] in offer sdp",f,l,e._h264ProfileId),g=s.replaceH264ProfileId(g,e._h264ProfileId))}return k.call(e,f,g,h,function(a,b){h.recordMetric("SetupCompleted",{string:b?"failed":"ok"}),b?c.call(e,e,"failed",null):c.call(e,e,"ok",a)},i)}switch(e._logger.warn("Failed to create downloader, status [%s]",d.status),d.status){case"capacity":case"stream-ended":case"origin-stream-ended":case"streaming-not-available":case"unauthorized":return c.call(e,e,d.status);default:return c.call(e,e,"failed")}})},t.prototype.getProtocol=function(){return this._protocol},t.prototype.getLogger=function(){return this._logger},t.prototype.toString=function(){var a=this.getProtocol(),b=a?a.getSessionId():"";return"PCast["+b||"unauthenticated,"+(a?a.toString():"uninitialized")+"]"};var $=function(){var a=window.navigator.userAgent;return _()||/Android|webOS|BlackBerry|IEMobile|Opera Mini|Mobile|mobile|CriOS/i.test(a)},_=function(){var a=window.navigator.userAgent;return/iPad|iPhone|iPod/.test(a)&&!window.MSStream};return t}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(26),c(20),c(17),c(2),c(84)],e=function(a,b,c,d,e,f,g){"use strict";function h(a){b.isObject(a,"options"),b.isStringNotEmpty(a.backendUri,"options.backendUri"),b.isObject(a.authenticationData,"options.authenticationData"),a.authToken&&b.isStringNotEmpty(a.authToken,"options.authToken"),a.onError&&b.isFunction(a.onError,"options.onError"),this._pcast=null,this._subscribers={},this._publishers={},this._adminAPI=new c(a.backendUri,a.authenticationData),this._pcast=new e(a),this._logger=this._pcast.getLogger(),this._isInstantiated=!1,this._reauthCount=0,this._authToken=a.authToken,this._onError=a.onError,i.call(this)}function i(){var a=this;return this._authToken?this._pcast.start(this._authToken,function(b,c,d){j.call(a,null,{status:c,sessionId:d})},function(){j.call(a,null,{status:"ok"})},function(){j.call(a,null,{status:"offline"})}):void this._adminAPI.createAuthenticationToken(function(b,c){return b?j.call(a,b):"ok"!==c.status?j.call(a,null,c):void a._pcast.start(c.authenticationToken,function(b,c,d){j.call(a,null,{status:c,sessionId:d})},function(){j.call(a,null,{status:"ok"})},function(){j.call(a,null,{status:"offline"})})})}function j(a,b){if(a)return k.call(this,a);var c=this;if(b&&"ok"!==b.status&&"offline"!==b.status)switch(c._reauthCount++,b.status){case"unauthorized":return delete this._authToken,c._reauthCount>1?k.call(this,new Error(b.status)):(c._logger.info("[Express] Attempting to create new authToken and re-connect after [%s] response",v),i.call(c));case"capacity":case"network-unavailable":return setTimeout(function(){i.call(c)},w*c._reauthCount*c._reauthCount);case"failed":default:return k.call(this,new Error(b.status))}this._reauthCount=0,c._isInstantiated||c._logger.info("Express API successfully instantiated"),c._isInstantiated=!0}function k(a){if(!this._onError)throw a;this._onError(a)}function l(a,c,d,e){var f=this;return b.isArray(c.capabilities,"options.capabilities"),c.streamToken?m.call(f,c.streamToken,a,c,d,e):void f._adminAPI.createStreamTokenForPublishing(f._pcast.getProtocol().getSessionId(),c.capabilities,function(b,g){return b?e(b):"ok"!==g.status?e(null,g):void m.call(f,g.streamToken,a,c,d,e)},1)}function m(c,d,e,g,h){var i=this,j=!1;e.tags&&b.isArray(e.tags,"options.tags"),e.connectOptions&&b.isArray(e.connectOptions,"options.connectOptions");var k=function(b,k,n){var p=function(b){var f=a.uniqueId();i._publishers[f]=!0,n.stop(b,!0),m.call(i,c,d,e,g,h),delete i._publishers[f]};if(k===v&&e.streamToken){i._logger.info("[Express] Attempting to create new streamToken and re-publish after [%s] response",v);var q=a.assign({},e);return delete q.streamToken,l.call(i,d,q,g,h)}if("ok"!==k)return h(null,{status:k});i._publishers[n.getStreamId()]=n,e.videoElement&&!j&&(f.attachMediaStream(e.videoElement,d),j=!0);var r=!0,s=function(){},w=a.bind(u,i,s,p,r);if(e.monitor){var x=a.bind(t,i,e.monitor.callback,p);n.monitor(e.monitor.options||{},x),w=a.bind(u,i,e.monitor.callback,p,r)}n.setPublisherEndedCallback(w);var y=o.call(i,n,e.videoElement,g);h(null,{status:"ok",publisher:y})};i._pcast.publish(c,d,k,e.tags,{connectOptions:e.connectOptions})}function n(b,c,d){var e=this;e._pcast.subscribe(b,function(f,h,i){var j=function(f){var g=a.uniqueId();e._subscribers[g]=!0,i.stop(f),e._logger.warn("[%s] Stream failure occurred with reason [%s]. Attempting to recover from failure.",c.streamId,f),n.call(e,b,c,d),delete e._subscribers[g]};if(h===v&&c.streamToken){e._logger.info("[%s] [Express] Attempting to create new streamToken and re-subscribe after [%s] response",c.streamId,v);var k=a.assign({},c);return delete k.streamToken,e.subscribe(k,d)}if("streaming-not-ready"===h)return d(null,{status:h,retry:a.bind(j,e,h)});if("ok"!==h)return d(null,{status:h});e._subscribers[i.getStreamId()]=i;var l;c.videoElement&&(l=i.createRenderer(),l.start(c.videoElement));var m=!1,o=function(){},q=a.bind(u,e,o,j,m);if(c.monitor){var r=a.bind(t,e,c.monitor.callback,j);i.monitor(c.monitor.options||{},r),q=a.bind(u,e,c.monitor.callback,j,m)}i.setStreamEndedCallback(q);var s=p.call(e,i,l),w={status:"ok",mediaStream:s};i.setStreamErrorCallback(function(a,b,c){if("shaka"!==b||c.severity===g.errorSeverity.critical.id)return e._logger.warn("[%s] Error while playing stream with Express API. Stopping stream.",s.getStreamId(),c),s.stop(),d(c)}),l&&(w.renderer=l),d(null,w)},c.subscriberOptions)}function o(b,c,d){var e=a.bind(b.stop,b);return b.stop=function(a,f){if(e(a),c&&(c.src="",c.srcObject=null),d&&b.getStream()&&!f){var g=b.getStream();g&&g.getTracks().forEach(function(a){a.stop()})}},b.enableAudio=function(){return q(b.getStream(),!0)},b.disableAudio=function(){return q(b.getStream(),!1)},b.enableVideo=function(){return r(b.getStream(),!0)},b.disableVideo=function(){return r(b.getStream(),!1)},b.setPublisherEndedCallback=function(){},b}function p(b,c){var d=a.bind(b.stop,b);return b.stop=function(a){c&&c.stop(),d(a)},b.enableAudio=function(){return q(b.getStream(),!0)},b.disableAudio=function(){return q(b.getStream(),!1)},b.enableVideo=function(){return r(b.getStream(),!0)},b.disableVideo=function(){return r(b.getStream(),!1)},b.setStreamEndedCallback=function(){},b}function q(a,b){if(a)return s(a.getAudioTracks(),b),b}function r(a,b){if(a)return s(a.getVideoTracks(),b),b}function s(c,d){b.isArray(c,"tracks"),a.forEach(c,function(a){a.enabled=d})}function t(b,c,d,e,f){switch(e){case"client-side-failure":b(null,{status:e,retry:a.bind(c,null,e)})}}function u(a,b,c,d,e,f){var g={status:"stream-ended",reason:e,description:f};switch(e){case"ended":case"censored":var h={status:e,reason:e,description:f};return c?h.publisher=d:h.mediaStream=d,a(null,h);case"custom":return a(null,g);case"capacity":return setTimeout(function(){return b(e)},w);case"failed":case"maintenance":return b(e);case"app-background":default:return g.retry=b,a(null,g)}}var v="unauthorized",w=1e3,x=500;h.prototype.dispose=function(){this._pcast&&this._pcast.stop()},h.prototype.getPCast=function(){return this._pcast},h.prototype.getAdminAPI=function(){return this._adminAPI},h.prototype.getUserMedia=function(c,e){var f=this;b.isObject(c.mediaConstraints,"options.mediaConstraints"),b.isFunction(e,"callback"),c.resolution&&b.isNumber(c.resolution,"options.resolution"),c.frameRate&&b.isNumber(c.frameRate,"options.frameRate"),c.aspectRatio&&b.isStringNotEmpty(c.aspectRatio,"options.aspectRatio"),c.onResolveMedia&&b.isFunction(c.onResolveMedia,"options.onResolveMedia"),c.onScreenShare&&b.isFunction(c.onScreenShare,"options.onScreenShare");var g=new d(f._pcast,c.aspectRatio,c.resolution,c.frameRate,function(d){return d=c.onScreenShare?c.onScreenShare(d):d,d.resolution&&b.isNumber(d.resolution,"clientOptions.resolution"),d.frameRate&&b.isNumber(d.frameRate,"screenOptions.frameRate"),d.aspectRatio&&b.isStringNotEmpty(d.aspectRatio,"screenOptions.aspectRatio"),a.assign({resolutionHeight:d.resolution},d)});g.getUserMedia(c.mediaConstraints,function(b,d){return b?e(b):(c.onResolveMedia&&c.onResolveMedia(d.options),void e(null,a.assign({status:"ok"},d)))})},h.prototype.publish=function(a,c){b.isObject(a,"options"),b.isFunction(c,"callback"),a.capabilities&&b.isArray(a.capabilities,"options.capabilities"),a.connectOptions&&b.isArray(a.connectOptions,"options.connectOptions"),a.mediaConstraints?b.isObject(a.mediaConstraints,"options.mediaConstraints"):b.isObject(a.userMediaStream,"options.userMediaStream"),a.videoElement&&b.isObject(a.videoElement,"options.videoElement"),a.monitor&&(b.isObject(a.monitor,"options.monitor"),b.isFunction(a.monitor.callback,"options.monitor.callback"),a.monitor.options&&b.isObject(a.monitor.options,"options.monitor.options")),a.streamToken&&b.isStringNotEmpty(a.streamToken,"options.streamToken");var d=this;this.waitForOnline(function(){return a.userMediaStream?l.call(d,a.userMediaStream,a,!1,c):void d.getUserMedia(a,function(b,e){return b?c(b):"ok"!==e.status?c(null,e):void l.call(d,e.userMedia,a,!0,c)})})};var y=["streaming","low-latency","on-demand","uld","vvld","vld","ld","sd","hd","fhd","uhd"];return h.prototype.publishRemote=function(c,d){if(b.isObject(c,"options"),b.isFunction(d,"callback"),b.isStringNotEmpty(c.streamUri,"options.streamUri"),c.capabilities&&b.isArray(c.capabilities,"options.capabilities"),c.connectOptions&&b.isArray(c.connectOptions,"options.connectOptions"),c.mediaConstraints)throw new Error("Invalid argument, Media Constraints, for publishing remote.");if(c.videoElement)throw new Error("May not view remote stream publisher. Please subscribe to view.");c.prerollSkipDuration&&b.isNumber(c.prerollSkipDuration,"options.prerollSkipDuration"),c.monitor&&(b.isObject(c.monitor,"options.monitor"),b.isFunction(c.monitor.callback,"options.monitor.callback"),c.monitor.options&&b.isObject(c.monitor.options,"options.monitor.options")),c.frameRate&&(b.isObject(c.frameRate,"options.frameRate"),c.frameRate.exact&&b.isNumber(c.frameRate.exact,"options.frameRate.exact"),c.frameRate.max&&b.isNumber(c.frameRate.max,"options.frameRate.max")),c.streamToken&&b.isStringNotEmpty(c.streamToken,"options.streamToken");var e=this;this.waitForOnline(function(){var b=a.assign({connectOptions:[],capabilities:[]},c);a.includes(b.capabilities,"publish-uri")||b.capabilities.push("publish-uri"),a.forEach(y,function(c){a.includes(b.capabilities,c)&&b.connectOptions.push("publisher-capability="+c)}),c.frameRate&&c.frameRate.exact&&b.connectOptions.push("source-uri-video-fps="+c.frameRate.exact),c.frameRate&&c.frameRate.max&&b.connectOptions.push("source-uri-video-fps-max="+c.frameRate.max),b.connectOptions.push("source-uri-preroll-skip-duration="+(a.isNumber(c.prerollSkipDuration)?c.prerollSkipDuration:x).toString()),l.call(e,b.streamUri,b,!1,d)})},h.prototype.publishScreen=function(b,c){var d=a.assign({mediaConstraints:{screen:!0}},b);return a.set(d,["monitor","options"],a.assign({},{monitorFrameRate:!1,videoBitRateThreshold:100,conditionCountForNotificationThreshold:8},a.get(d,["monitor","options"],{}))),this.publish(d,c)},h.prototype.subscribe=function(a,c){b.isObject(a,"options"),b.isFunction(c,"callback"),b.isStringNotEmpty(a.streamId,"options.streamId"),b.isObject(a.capabilities,"options.capabilities"),a.videoElement&&b.isObject(a.videoElement,"options.videoElement"),a.monitor&&(b.isObject(a.monitor,"options.monitor"),b.isFunction(a.monitor.callback,"options.monitor.callback"),a.monitor.options&&b.isObject(a.monitor.options,"options.monitor.options")),a.streamToken&&b.isStringNotEmpty(a.streamToken,"options.streamToken"),a.subscriberOptions&&b.isObject(a.subscriberOptions,"options.subscriberOptions");var d=this;this.waitForOnline(function(){return a.streamToken?n.call(d,a.streamToken,a,c):void d._adminAPI.createStreamTokenForSubscribing(d._pcast.getProtocol().getSessionId(),a.capabilities,a.streamId,null,function(b,e){return b?c(b):"ok"!==e.status?c(null,e):void n.call(d,e.streamToken,a,c)},1)})},h.prototype.subscribeToScreen=function(b,c){var d=a.assign({},b);return a.set(d,["monitor","options"],a.assign({},{monitorFrameRate:!1,videoBitRateThreshold:100,conditionCountForNotificationThreshold:8},a.get(d,["monitor","options"],{}))),this.subscribe(d,c)},h.prototype.waitForOnline=function(a){if(b.isFunction(a,"callback"),"online"===this._pcast.getStatus())return a();var c=this._pcast.getObservableStatus().subscribe(function(b){if("online"===b)return c.dispose(),a()})},h}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(4),c(3),c(27),c(31),c(77),c(30),c(71),c(16),c(15)],e=function(a,b,c,d,e,f,g,h,i,j,k){"use strict";function l(a){b.isObject(a,"pcast"),b.isFunction(a.getLogger,"pcast.getLogger"),b.isFunction(a.getProtocol,"pcast.getProtocol"),this._pcast=a,this._logger=a.getLogger(),this._protocol=a.getProtocol(),this._self=new c.Observable(null),this._activeRoom=new c.Observable(null),this._cachedRoom=new c.Observable(null),this._roomChatService=null,b.isObject(this._logger,"this._logger"),b.isObject(this._protocol,"this._protocol"),this._authService=new e(this._pcast)}function m(){this._self.setValue(null),this._activeRoom.setValue(null),this._cachedRoom.setValue(null),this._roomChatService=null,this._disposables&&this._disposables.dispose(),this._disposables=null}function n(a){var b=this._self.getValue().toJson(),c=this;this._self.setValue(new h(c,b.state,a||"",b.screenName,b.role,b.streams,b.lastUpdate))}function o(){var b=this,c=b._activeRoom.getValue(),d=b._self.getValue().getSessionId();if(a.isObject(c)&&d){var e=c.getRoomId(),f=c.getObservableAlias().getValue();b.leaveRoom(function(){b.enterRoom(e,f,function(){b._logger.info("Room Reset Completed")})})}}function p(c){b.isObject(c,"event"),b.isString(c.roomId,"event.roomId"),b.isString(c.eventType,"event.eventType"),b.isArray(c.members,"event.members"),a.forEach(c.members,function(a){b.isObject(a,"member")});var d=this;switch(c.eventType){case j.events.memberJoined.name:return d._logger.debug("[%s] Member joined [%s]",c.roomId,c.members),q.call(d,c.roomId,c.members);case j.events.memberLeft.name:return d._logger.debug("[%s] Member left [%s]",c.roomId,c.members),r.call(d,c.roomId,c.members);case j.events.memberUpdated.name:return d._logger.debug("[%s] Member updated [%s]",c.roomId,c.members),s.call(d,c.roomId,c.members);case j.events.roomUpdated.name:return d._logger.debug("[%s] Room updated [%s]",c.roomId,c.room),t.call(d,c.roomId,c.room);case j.events.roomEnded.name:d._logger.info("[%s] Room ended",c.roomId);break;default:d._logger.warn("Unsupported room event [%s]",c.eventType)}}function q(b,c){var d=this._activeRoom.getValue(),e=this._cachedRoom.getValue();if(d&&d.getRoomId()===b){d._removeMembers(c),d._addMembers(c),e._removeMembers(c),e._addMembers(c);var f=this,g=function(a){return a.sessionId===f.getSelf().getSessionId()},h=a.find(c,g);h&&(M.call(f,d),d._updateMembers([h])),this._logger.info("[%s] Room has now [%d] members",b,d.getObservableMembers().getValue().length)}}function r(a,b){var c=this._activeRoom.getValue(),d=this._cachedRoom.getValue();c&&c.getRoomId()===a&&(c._removeMembers(b),d._removeMembers(b),this._logger.info("[%s] Room has now [%d] members",a,c.getObservableMembers().getValue().length))}function s(a,b){var c=this._activeRoom.getValue(),d=this._cachedRoom.getValue();if(c&&c.getRoomId()===a){var e=z.call(this,b);c._updateMembers(e),d._updateMembers(e),this._logger.info("[%s] Room has [%d] updated members",a,b.length)}}function t(a,b){var c=this._activeRoom.getValue(),d=this._cachedRoom.getValue();c&&c.getRoomId()===a&&(d._update(b),c._update(b))}function u(a){this.getSelf()&&this.getSelf().getSessionId()===a||n.call(this,a)}function v(a,b){var c=b.getValue(),d=c.getObservableMembers().getValue();return w(a,d)}function w(b,c){return a.find(c,function(a){return b===a.getSessionId()})}function x(b){this._logger.info("PCast status changed to [%s]",b),"offline"!==b.toLowerCase()&&"offline"===this._lastPcastStatus||"offline"===b.toLowerCase()&&"offline"!==this._lastPcastStatus&&!a.isNullOrUndefined(this._lastPcastStatus),this._lastPcastStatus=b}function y(){var b=this._self.subscribe(a.bind(o,this)),c=this._authService.getObservableStatus().subscribe(a.bind(x,this)),d=this._authService.getObservableSessionId().subscribe(a.bind(u,this));this._disposables.add(b),this._disposables.add(c),this._disposables.add(d)}function z(b){var c=this;return a.map(b,function(a){var b=v(a.sessionId,c._cachedRoom),d=new h(null,a.state,a.sessionId,a.screenName,a.role,a.streams,a.lastUpdate),e=A(d,b);return e.lastUpdate=a.lastUpdate,e})}function A(b,c){var d=B(b,c);return d.sessionId=b.getSessionId(),d.lastUpdate=c?c.getLastUpdate():a.now(),d}function B(b,c){if(!c)return b.toJson();var d={},e=b.toJson(),f=c.toJson(),g=a.findDifferences(e,f,!0);return a.forEach(g,function(a){d[a]=e[a]}),d}function C(b,c,d){this._authService.assertAuthorized();var e=this;this._protocol.getRoomInfo(b,c,function(b,c){if(b)return e._logger.error("Request to get room info failed with error [%s]",b),d(b,null);var f={status:c.status};return"ok"!==c.status?(e._logger.warn("Request to get room info failed with status [%s]",c.status),d(null,f)):(f.room=a.freeze(J.call(this,c)),void d(null,f))})}function D(b,c){this._authService.assertAuthorized();var d=this,e=E(b);this._protocol.createRoom(e,function(b,e){if(b)return d._logger.error("Creating room failed with error [%s]",b),c(b,null);var f={status:e.status};return"ok"!==e.status&&"already-exists"!==e.status?(d._logger.warn("Creating room failed with status [%s]",e.status),c(null,f)):(f.room=a.freeze(J.call(this,e)),void c(null,f))})}function E(a){var b=this;return new f(b,"",a.alias,a.name,a.description,a.type,[],a.bridgeId,a.pin).toJson()}function F(b,c,d){var e=this._activeRoom.getValue();if(e){var f=b===e.getRoomId()||c===e.getObservableAlias().getValue();return this._logger.info("Unable to join room. Already in [%s]/[%s] room.",e.getRoomId(),e.getObservableAlias().getValue()),d(null,a.assign({room:e},f?O:P))}this._authService.assertAuthorized();var g=this._self.getValue(),h=g.getObservableScreenName().getValue(),i=g.getObservableRole().getValue(),j=A.call(this,g,null),k=a.now();this._logger.info("Enter room [%s]/[%s] with screen name [%s] and role [%s]",b,c,h,i);var l=this;this._protocol.enterRoom(b,c,j,k,function(a,b){if(a)return l._logger.error("Joining of room failed with error [%s]",a),d(a,null);var c={status:b.status};return"ok"!==b.status?(l._logger.warn("Joining of room failed with status [%s]",b.status),d(null,c)):(c.room=L.call(l,b),"ok"===b.status&&b.self&&l.getSelf()._update(b.self),void d(null,c))})}function G(b){if(!this._activeRoom.getValue())return this._logger.info("Unable to leave room. Not currently in a room."),b(null,N);if(!this._isLeavingRoom){this._authService.assertAuthorized();var c=this._activeRoom.getValue().getRoomId(),d=a.now();this._logger.info("Leave room [%s]",c);var e=this;this._isLeavingRoom=!0,this._protocol.leaveRoom(c,d,function(a,c){if(e._isLeavingRoom=!1,a)return e._logger.error("Leaving room failed with error [%s]",a),b(a,null);var d={status:c.status};return"ok"!==c.status?(e._logger.warn("Leaving room failed with status [%s]",c.status),b(null,d)):(e._roomChatService&&e._roomChatService.stop(),e._roomChatService=null,e._activeRoom.setValue(null),e._cachedRoom.setValue(null),void b(null,d))})}}function H(b,c){if(!this._activeRoom.getValue())return this._logger.warn("Not in a room. Please Enter a room before updating member."),c(null,N);this._authService.assertAuthorized();var d=b.getSessionId()===this.getSelf().getSessionId(),e=v(b.getSessionId(),this._cachedRoom),f=A.call(this,b,e),g=a.now(),h=d&&!e,i=d&&f.role===k.roles.audience.name;h&&(f.lastUpdate=b.getObservableLastUpdate().getValue()),this._logger.info("Updating member info for active room");var j=this;this._protocol.updateMember(f,g,function(a,b){if(a)return j._logger.error("Update of member failed with error [%s]",a),c(a,null);var d={status:b.status};"ok"!==b.status&&j._logger.warn("Update of member failed with status [%s]",b.status),"ok"===b.status&&i&&j.getSelf().getObservableLastUpdate().setValue(b.lastUpdate),c(null,d)})}function I(b){if(!this._activeRoom.getValue())return this._logger.warn("Not in a room. Please Enter a room before updating member."),b(null,N);this._authService.assertAuthorized();var c=this._activeRoom.getValue(),d=a.now(),e=this;this._protocol.updateRoom(c.toJson(),d,function(a,c){if(a)return e._logger.error("Update of room failed with error [%s]",a),b(a,null);var d={status:c.status};"ok"!==c.status&&e._logger.warn("Update of room failed with status [%s]",c.status),b(null,d)})}function J(a){var b=a.room,c=a.members||[],d=this;return new g(d,b.roomId,b.alias,b.name,b.description,b.type,c,b.bridgeId,b.pin)}function K(a){var b=a.room,c=a.members,d=this;return new f(d,b.roomId,b.alias,b.name,b.description,b.type,c,b.bridgeId,b.pin)}function L(a){var b=K.call(this,a),c=K.call(this,a);return M.call(this,b),this._activeRoom.setValue(b),this._cachedRoom.setValue(c),b}function M(b){var c=this._self.getValue(),d=b.getObservableMembers().getValue(),e=a.findIndex(d,function(a){return c.getSessionId()===a.getSessionId()});return a.isNumber(e)?(c._update(d[e].toJson()),d[e]=c,void b.getObservableMembers().setValue(d)):this._logger.info("Self not in server room model.")}var N=a.freeze({status:"not-in-room"}),O=a.freeze({status:"already-in-room"}),P=a.freeze({status:"in-another-room"});return l.prototype.start=function(e,f){if(this._started)return this._logger.warn("RoomService already started.");b.isStringNotEmpty(e,"role"),b.isStringNotEmpty(f,"screenName");var g=k.states.passive.name,i=this._authService.getPCastSessionId(),j=f,l=[],m=a.now(),n=this,o=new h(n,g,i,j,e,l,m);this._self=new c.Observable(o),this._disposables=new d.DisposableList;var q=this._protocol.onEvent("chat.RoomEvent",a.bind(p,this));return this._disposables.add(q),y.call(this),this._started=!0,o},l.prototype.getRoomInfo=function(a,c,d){a?b.isStringNotEmpty(a,"roomId"):b.isStringNotEmpty(c,"alias"),b.isFunction(d,"callback"),C.call(this,a,c,d)},l.prototype.createRoom=function(a,c){b.isObject(a,"room"),b.isStringNotEmpty(a.name,"room.name"),b.isStringNotEmpty(a.type,"room.type"),b.isString(a.description,"room.description"),b.isFunction(c,"callback"),D.call(this,a,c)},l.prototype.enterRoom=function(a,c,d){a?b.isStringNotEmpty(a,"roomId"):b.isStringNotEmpty(c,"alias"),b.isFunction(d,"callback"),F.call(this,a,c,d)},l.prototype.leaveRoom=function(a){var b=this;return G.call(b,a)},l.prototype.getRoomChatService=function(){return!this._roomChatService&&this._activeRoom.getValue()&&(this._roomChatService=new i(this)),this._roomChatService},l.prototype.getSelf=function(){return this._self.getValue()},l.prototype.getObservableActiveRoom=function(){return this._activeRoom},l.prototype.updateSelf=function(a){b.isFunction(a,"callback"),H.call(this,this.getSelf(),a)},l.prototype.updateMember=function(a,c){b.isFunction(c,"callback"),b.isObject(a,"member"),H.call(this,a,c)},l.prototype.updateRoom=function(a){b.isFunction(a,"callback"),I.call(this,a)},l.prototype.revertRoomChanges=function(){var a=this._activeRoom.getValue(),b=this._cachedRoom.getValue();return a&&b?void a._update(b.toJson()):this._logger.warn("Unable to revert changes to room. Not currently in a room.")},l.prototype.revertMemberChanges=function(a){b.isObject(a,"member");var c=v(a.getSessionId(),this._cachedRoom),d=v(a.getSessionId(),this._activeRoom);return c&&d?void d._update(c.toJson()):this._logger.warn("Unable to revert changes to member. Member is currently not in room.")},l.prototype.toString=function(){return"RoomService"},l.prototype.stop=function(){var a=this._activeRoom.getValue(),b=this;return a?this.leaveRoom(function(a,c){a&&b._logger.warn("Failure to stop room service. Unable to leave room",a),c&&"ok"!==c.status&&b._logger.warn("Failure to stop room service. Unable to leave room. Status: [%s]",c.status),c&&"ok"===c.status&&(m.call(b),b._started=!1)}):(m.call(this),void(b._started=!1))},l}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(2)],e=function(a,b,c){"use strict";function d(a,c,d,e,f){b.isObject(a,"pcast"),this._pcast=a,this._logger=a.getLogger(),this._defaultAspectRatio=c||"16x9",this._defaultResolutionHeight=d||720,this._defaultFrameRate=e||15,this._onScreenShare=f}function e(a,b){switch(b){case"16x9":return f(16/9*a);case"4x3":return f(4/3*a);default:throw new Error("Aspect Ratio not supported")}}function f(a){return b.isNumber(a,"value"),2*Math.floor((a+1)/2)}function g(a,b,c){var d=a.video,e=a.audio,f=a.screen,g=b.width,h=b.height,i={};return d&&(i.video={height:h,width:g,frameRate:c},d.deviceId&&(i.video.deviceId=d.deviceId),d.facingMode&&(i.video.facingMode=d.facingMode),g||delete i.video.width,h||delete i.video.height,c||delete i.video.frameRate,g||h||c||d.deviceId||d.facingMode||(i.video=!0)),e&&(i.audio=!0,e.deviceId&&(i.audio={deviceId:e.deviceId})),f&&(i.screen=!0),i}function h(a,b,c){var d=a.video,e=a.audio,f=a.screen,g=a.screenAudio,h=b.width,i=b.height,j={};return d&&(j.video={height:{min:i,ideal:i,max:i},width:{min:h,ideal:h,max:h},frameRate:{ideal:c,max:c}},d.deviceId&&(j.video.deviceId={exact:d.deviceId}),d.facingMode&&(j.video.facingMode=d.facingMode),h||delete j.video.width,i||delete j.video.height,c||delete j.video.frameRate,h||i||c||d.deviceId||d.facingMode||(j.video=!0)),e&&(j.audio={},e.deviceId&&(j.audio.deviceId={exact:e.deviceId}),e.mediaSource&&(j.audio.mediaSource=e.mediaSource),e.mediaSourceId&&(j.audio.mediaSourceId=e.mediaSourceId),e.deviceId||e.mediaSource||e.mediaSourceId||(j.audio=!0)),g&&(j.screenAudio={},g.deviceId&&(j.screenAudio.deviceId={exact:g.deviceId}),g.mediaSource&&(j.screenAudio.mediaSource=g.mediaSource),g.mediaSourceId&&(j.screenAudio.mediaSourceId=g.mediaSourceId),g.deviceId||g.mediaSource||g.mediaSourceId||(j.screenAudio=!0)),f&&(j.screen={height:{min:i,ideal:i,max:i},width:{min:h,ideal:h,max:h},frameRate:{ideal:c,max:c}},h||delete j.screen.width,i||delete j.screen.height,c||delete j.screen.frameRate,f.mediaSource&&(j.screen.mediaSource=f.mediaSource),h||i||c||f.mediaSource||(j.screen=!0)),f&&d&&(j.screen=!0),j}function i(a,b,c){var d=a.video,e=a.audio,f=a.screen,g=a.screenAudio,h=b.width,i=b.height,j={};return d&&(j.video={mandatory:{minHeight:i,maxHeight:i,minWidth:h,maxWidth:h,maxFrameRate:c}},d.deviceId&&(j.video.mandatory.sourceId=d.deviceId),d.facingMode&&(j.video.facingMode=d.facingMode),d.mediaSource&&(j.video.mandatory.mediaSource=d.mediaSource),d.mediaSourceId&&(j.video.mandatory.mediaSourceId=d.mediaSourceId),h||(delete j.video.mandatory.minWidth,delete j.video.mandatory.maxWidth),i||(delete j.video.mandatory.minHeight,delete j.video.mandatory.maxHeight),c||delete j.video.mandatory.maxFrameRate,h||i||c||d.deviceId||d.facingMode||d.mediaSource||d.mediaSourceId||(j.video=!0)),e&&(j.audio={mandatory:{}},e.deviceId&&(j.audio.mandatory.sourceId=e.deviceId),e.mediaSource&&(j.audio.mandatory.mediaSource=e.mediaSource),e.mediaSourceId&&(j.audio.mandatory.mediaSourceId=e.mediaSourceId),e.deviceId||e.mediaSource||e.mediaSourceId||(j.audio=!0)),g&&(j.screenAudio={mandatory:{}},g.deviceId&&(j.screenAudio.mandatory.sourceId=g.deviceId),g.mediaSource&&(j.screenAudio.mandatory.mediaSource=g.mediaSource),g.mediaSourceId&&(j.screenAudio.mandatory.mediaSourceId=g.mediaSourceId),g.deviceId||g.mediaSource||g.mediaSourceId||(j.screenAudio=!0)),f&&(j.screen={mandatory:{minHeight:i,maxHeight:i,minWidth:h,maxWidth:h,maxFrameRate:c}},h||(delete j.screen.mandatory.minWidth,delete j.screen.mandatory.maxWidth),i||(delete j.screen.mandatory.minHeight,delete j.screen.mandatory.maxHeight),c||delete j.screen.mandatory.maxFrameRate,f.mediaSource&&(j.screen.mandatory.mediaSource=f.mediaSource),f.mediaSourceId&&(j.screen.mandatory.mediaSourceId=f.mediaSourceId),h||i||c||f.mediaSource||(j.screen=!0)),f&&d&&(j.screen=!0),j}function j(a,b,d,f){var g=this.getVendorSpecificConstraints(a,b||{},d),h=!!g.video,i=this;this._pcast.getUserMedia(g,function(c,e,g,k){if("ok"===e)return f(null,{userMedia:g,options:{frameRate:h?d:null,resolution:h?b.height:null,aspectRatio:h?b.aspectRatio:null}});var l=b,o=d,p=m(k);if(k&&("ConstraintNotSatisfiedError"===k.name||"OverconstrainedError"===k.name)||"OverconstrainedError"===k.constructor.name)switch(p.toLowerCase()){case"width":case"height":if(!b)break;return i._logger.warn("Unable to get user media with constraint [%s] with height [%s] and width [%s]. Retrying with next closest resolution.",p,l.height,l.width),l=n.call(i,b.height,b.aspectRatio),j.call(i,a,l,o,f);case"framerate":default:if(!d)break;return i._logger.warn("Unable to get user media with constraint [%s] and framerate [%s]. Retrying without frame rate constraint.",p,d),o=null,j.call(i,a,l,o,f)}return i._logger.error("Unable to get user media with status [%s]",e,k),f(k)},function(a){var b=a;if(i._onScreenShare&&"Chrome"===c.browser){var d=k(a);b=i._onScreenShare(d);var f;b.resolutionHeight&&b.aspectRatio&&(f={width:e(b.resolution,b.aspectRatio),height:b.resolutionHeight}),b=l.call(i,d,f,b.frameRate)}return b})}function k(b){var c=a.get(b,["video","mandatory","chromeMediaSource"]),d=a.get(b,["audio","mandatory","chromeMediaSource"]),e=a.get(b,["video","mandatory","chromeMediaSourceId"]),f=a.get(b,["audio","mandatory","chromeMediaSourceId"]),g={};return(c||f)&&(a.set(g,["screen","mediaSource"],c),a.set(g,["screen","mediaSourceId"],e)),(d||f)&&(a.set(g,["screenAudio","mediaSource"],d),a.set(g,["screenAudio","mediaSourceId"],f)),g}function l(b,c,d){var e=this.getVendorSpecificConstraints(b,c,d);e.screen&&(e.video=e.screen,delete e.screen),e.screenAudio&&(e.audio=e.screenAudio,delete e.screenAudio);var f=a.get(e,["video","mandatory","mediaSource"]),g=a.get(e,["audio","mandatory","mediaSource"]),h=a.get(e,["video","mandatory","mediaSourceId"]),i=a.get(e,["audio","mandatory","mediaSourceId"]);return(f||h)&&(a.set(e,["video","mandatory","chromeMediaSource"],f),a.set(e,["video","mandatory","chromeMediaSourceId"],h),delete e.video.mandatory.mediaSource,delete e.video.mandatory.mediaSourceId),(g||i)&&(a.set(e,["audio","mandatory","chromeMediaSource"],g),a.set(e,["audio","mandatory","chromeMediaSourceId"],i),delete e.audio.mandatory.mediaSource,delete e.audio.mandatory.mediaSourceId),e}function m(a){return a.constraintName?a.constraintName:a.constraint?a.constraint:""}function n(b,c){var d,f,g,h,i=o(c,t),j=p(c,t),k=p(b.toString(),i);if(a.isNumber(k)){if(k===i.length-1)return i.length-1===0?null:(j++,d=q(j,t),g=this._defaultResolutionHeight,h=e(g,d),{aspectRatio:d,height:parseInt(g),width:parseInt(h)});k++}else k=s(b,i);return d=q(j,t),f=r(j,t),g=q(k,f),h=f[k][g],{aspectRatio:d,height:parseInt(g),width:parseInt(h)}}function o(b,c){var d=a.find(c,function(a){return a.hasOwnProperty(b)});return d?d[b]:null}function p(b,c){return a.findIndex(c,function(a){return a.hasOwnProperty(b)})}function q(b,c){var d=a.keys(c[b]);return d[0]}function r(b,c){var d=a.keys(c[b]);return c[b][d[0]]}function s(b,c){return a.reduce(c,function(d,e,f){if(!d)return f;var g=a.keys(c[d])[0],h=a.keys(e)[0];return Math.abs(b-h)<Math.abs(b-g)?f:d;
})}var t=[{"16x9":[{2160:3840},{1080:1920},{768:1366},{720:1280},{576:1024},{480:853},{360:640},{180:320}]},{"4x3":[{1200:1600},{1080:1440},{720:960},{600:800},{576:768},{480:640},{360:480},{288:352},{240:320},{144:176},{120:160}]}];return d.prototype.getUserMedia=function(a,c){b.isObject(a,"deviceOptions");var d=o(this._defaultAspectRatio,t),f=o(this._defaultResolutionHeight,d)||e(this._defaultResolutionHeight,this._defaultAspectRatio),g={height:this._defaultResolutionHeight,width:f,aspectRatio:this._defaultAspectRatio};j.call(this,a,g,this._defaultFrameRate,c)},d.prototype.getVendorSpecificConstraints=function(a,b,d){if(b=b||{},!a||!a.audio&&!a.video&&!a.screen&&!a.screenAudio)throw new Error("Invalid device options. Must pass in at least one device option.");return"Firefox"===c.browser&&c.browserVersion>38||"Chrome"===c.browser&&c.browserVersion>52&&!a.screen&&!a.screenAudio||"Safari"===c.browser&&c.browserVersion>10||"Opera"===c.browser&&c.browserVersion>40?h(a,b,d):"Edge"===c.browser?g(a,b,d):i(a,b,d)},d}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(3)],e=function(a,b,c){"use strict";function d(){this._listeners=[]}function e(c,d,e){var f=this;a.isNullOrUndefined(c)&&(c=[]),b.isArray(c,"args");var g=function(){a.forEach(f._listeners,function(a){a.apply(d,c)})};e?setTimeout(function(){g(),e()},0):g()}return d.prototype.fire=function(a,b){e.call(this,a,b)},d.prototype.fireAsync=function(a,b,c){e.call(this,a,b,c||function(){})},d.prototype.listen=function(d){var e=this;return b.isFunction(d,"listener"),e._listeners.push(d),new c.Disposable(function(){e._listeners=a.remove(e._listeners,function(a){return a===d})})},d.prototype.size=function(){return this._listeners.length},d.prototype.dispose=function(){this._listeners=[]},d.prototype.toString=function(){return"Event|"+this.size()},d}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(52)],e=function(a){"use strict";return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(3)],e=function(a,b,c){"use strict";function d(a,b){this.latestValue=null,this.subscribeCallbacks={},this.subscriptionTimeout=100,this.subscriptionCount=0,this.resetOnChange=!1,this.lastChangeTime=0,this.isPendingChanges=!1,this.beforeChange=b,f.call(this,a)}function e(b){return"undefined"==typeof b||null===b?b:a.isArray(b)?b.slice():b}function f(a){var b=a;this.beforeChange&&(b=this.beforeChange(a)),this.latestValue=e(b)}function g(b,c){if(this.lastChangeTime=a.now(),!this.isPendingChanges&&0!==this.subscriptionCount){if(this.isPendingChanges=!0,c)return i.call(this);h.call(this,b)}}function h(b){var c=this;setTimeout(function(){var b=a.now()-c.lastChangeTime;c.resetOnChange&&b<c.subscriptionTimeout?h.call(c,c.subscriptionTimeout-b):i.call(c)},b)}function i(){try{j.call(this)}finally{this.isPendingChanges=!1}}function j(){var b=this;a.forOwn(b.subscribeCallbacks,function(c){a.isFunction(c)&&c(b.latestValue)})}return d.prototype.getValue=function(){return e(this.latestValue)},d.prototype.setValue=function(a){a!==this.latestValue&&(f.call(this,a),g.call(this,this.subscriptionTimeout))},d.prototype.subscribe=function(d,e){b.isFunction(d,"callback"),e&&b.isObject(e,"options");var f,h=this,i=a.uniqueId();return h.subscribeCallbacks[i]=d,h.subscriptionCount+=1,e&&("notify"===e.initial&&g.call(h,h.subscriptionTimeout,!0),e.listenForChanges&&(f=setInterval(function(){var a=e.listenForChanges.callback();a!==h.latestValue&&h.setValue(a)},e.listenForChanges.timeout))),new c.Disposable(function(){delete h.subscribeCallbacks[i],f&&(clearInterval(f),f=null),h.subscriptionCount-=1})},d.prototype.extend=function(c){switch(b.isObject(c,"options"),c.method){case"notifyWhenChangesStop":this.subscriptionTimeout=c.timeout,this.resetOnChange=!0;break;case"notifyAtFixedRate":this.subscriptionTimeout=c.timeout}return a.isNumber(c.rateLimit)&&(this.subscriptionTimeout=c.rateLimit),this},d}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(62),c(58)],e=function(a,b,c){"use strict";function d(d,e){var f=b.loadJson(c);a.forEach(d,function(a){f=b.loadJson(a,f)}),this._builders=f.build(),this._apiVersion=e||3}function e(a){for(var b=a.split("."),c=this._builders,d=0;d<b.length-1;d++)if(c=c[b[d]],!c)throw new Error('Unsupported type "'+a+'"');if(c=c[b[b.length-1]],"function"!=typeof c)throw new Error('Unsupported type "'+a+'"');return c}function f(b){if(b&&b.$type&&b.$type.children)a.forOwn(b.$type.children,function(c){var d=b[c.name],e=c&&c.element?c.element.resolvedType:null;if(a.isArray(d))b[c.name]=[],a.forEach(d,function(a){b[c.name].push(f(a))});else if(e&&"Message"===e.className&&e.children)b[c.name]=f(d);else if(e&&"Enum"===e.className&&e.children){var g=a.getEnumName(e.children,d);g&&(b[c.name]=g)}else d&&a.isFunction(d.toNumber)&&(b[c.name]=d.toNumber())});else if(b&&a.isFunction(b.toNumber))return b.toNumber();return b}return d.prototype.getApiVersion=function(){return this._apiVersion},d.prototype.encode=function(a,b){if("string"!=typeof a)throw new Error("'type' must be a string");if("object"!=typeof b)throw new Error("'data' must be an object");var c=e.call(this,a);return c.encode(b)},d.prototype.decode=function(a,b){if("string"!=typeof a)throw new Error("'type' must be a string");var c=e.call(this,a);return f(c.decode(b))},d}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(5),c(3),c(24),c(10)],e=function(a,b,c,d,e,f){"use strict";function g(d,f,g,h,j){b.isObject(d,"logger"),b.isFunction(f,"sendCallback"),b.isFunction(g,"receiveCallback"),this._logger=d,this._mqProtocol=new e(h,j),this._nextRequestId=0,this._namedEvents=new c.NamedEvents,this._requests={},this._responses={},this._requestListeners={},this._requestTimeouts={},this._requestTimestamps={},this._continuationTimeouts={},this._receiveCallback=g,this._sendCallback=f,g(a.bind(i,this))}function h(a,b){this._namedEvents.fire(a,b,this)}function i(b){if(this._disposed)return this._logger.warn("Proto already disposed of. Unable process message");var c,d,e;try{c=this._mqProtocol.decode("mq.Message",f.wrap(b.data,"base64")),e=this._requests[c.requestId],this._logger.info(">> [%s] [%s]",c.messageType,c.type),d=this._mqProtocol.decode(c.type,c.payload)}catch(g){if(this._logger.error(g),e)return e(g);throw g}switch(p.call(this,c,d,b.data.length),c.messageType){case"Response":if(d.status!==t&&delete this._requests[c.requestId],clearTimeout(this._requestTimeouts[c.requestId]),delete this._requestTimeouts[c.requestId],!e)return;if("mq.Error"===c.type){var i=d;return e(i,null)}return e(null,d);case"Request":var j=a.bind(this.sendResponse,this,c.requestId,c.type+"Response"),k=this._requestListeners[c.type];this._responses[c.requestId]=a.now(),k?k(d,j):this._logger.info("Received request without a subscribed listener");break;case"Event":return h.call(this,c.type,[d]);default:return this._logger.warn(">> Unsupported message type [%s]",c.messageType)}}function j(a,b,c,d,e,f,g){return g&&g.status===t?(!this._continuationTimeouts[a]&&this._requests[a]&&(this._continuationTimeouts[a]=n.call(this,a,e)),k.call(this,a,b,c,g,d,e)):(clearTimeout(this._continuationTimeouts[a]),delete this._continuationTimeouts[a],e(f,g))}function k(b,c,d,e,f,g){if(!e||!e.continuationId&&!e.routeKey)return this._logger.warn("Received request for continuation without a continuationId or routeKey"),g();var h=a.assign({},d,{continuationId:e.continuationId,routeKey:e.routeKey}),i={requestId:b,type:c,payload:this._mqProtocol.encode(c,h),messageType:"Request"},j=this;return setTimeout(function(){if(j._requests[b])return l.call(j,b,i,h,f,g)},u)}function l(b,c,d,e,f){this._requestTimeouts[b]&&clearTimeout(this._requestTimeouts[b]);var g=e||w;return this._requestTimeouts[b]=setTimeout(a.bind(o,this,b,g,f),g),m.call(this,c,d)}function m(a,b){var c=this._mqProtocol.encode("mq.Message",a).toString("base64");return q.call(this,a,b,c.length),this._sendCallback(c)}function n(b,c){return setTimeout(a.bind(o,this,b,v,c),v)}function o(a,b,c){if(this._requests[a])return r.call(this,a,b),this._logger.warn("Request [%s] has not completed in [%s] ms. Dropping request.",a,b),delete this._requests[a],c(null,{status:"timeout"})}function p(b,c,d){var e=a.now(),f=this._requestTimestamps[b.requestId];if(a.isNumber(f)){var g=e-f;b.wallTime=[g].concat(b.wallTime)}this._namedEvents.fireAsync("received",[{key:b.requestId,messageType:b.messageType,type:b.type,wallTime:b.wallTime,received:e,bytes:d,payload:c}]),delete this._requestTimestamps[b.requestId]}function q(b,c,d){var e=a.now();this._requestTimestamps[b.requestId]=e,this._namedEvents.fireAsync("sent",[{key:b.requestId,messageType:b.messageType,type:b.type,received:e,bytes:d,payload:c}])}function r(a,b){this._namedEvents.fireAsync("timeout",[{key:a,timeout:b}]),delete this._requestTimestamps[a]}var s="C",t="continuation",u=2e3,v=3e5,w=18e3;return g.prototype.onEvent=function(a,c){return this._disposed?this._logger.warn("Proto already disposed of. Unable to listen for event"):(b.isStringNotEmpty(a,"eventName"),b.isFunction(c,"handler"),this._namedEvents.listen(a,c))},g.prototype.onRequest=function(a,c){if(this._disposed)return this._logger.warn("Proto already disposed of. Unable to listen for request");b.isStringNotEmpty(a,"requestName"),b.isFunction(c,"handler"),this._requestListeners[a]&&this._logger.warn("May not set multiple handlers for the same request. Overriding existing handlers for request [%s]",a),this._requestListeners[a]=c;var e=this;return new d.Disposable(function(){e._requestListeners[a]=null})},g.prototype.sendRequest=function(c,d,e,f){if(this._disposed)return this._logger.warn("Proto already disposed of. Unable to send request"),e(null,{status:"proto-disposed"});f=f||{},b.isStringNotEmpty(c,"type"),b.isObject(d,"message"),b.isObject(f,"settings"),e&&b.isFunction(e,"callback"),f.timeout&&b.isNumber(f.timeout,"settings.timeout");var g=s+(this._nextRequestId++).toString(),h={requestId:g,type:c,payload:this._mqProtocol.encode(c,d),messageType:"Request"};return this._requests[g]=a.bind(j,this,g,c,d,f.timeout,e),l.call(this,g,h,d,f.timeout,e)},g.prototype.sendResponse=function(c,d,e,f){if(this._disposed)return this._logger.warn("Proto already disposed of. Unable to send response"),f(null,{status:"proto-disposed"});b.isStringNotEmpty(c,"requestId"),b.isStringNotEmpty(d,"type"),b.isObject(e,"message");var g=this._responses[c];g||(this._logger.error("Already responded to request [%s]",c),f(new Error("no-response-handler")));var h={requestId:c,type:d,payload:this._mqProtocol.encode(d,e),messageType:"Response",wallTime:[a.now()-g]};return m.call(this,h,e),delete this._responses[c],f(null,{status:"ok"})},g.prototype.dispose=function(){this._disposed=!0,this._receiveCallback=null,this._sendCallback=null,a.forOwn(this._requestTimeouts,function(a){clearTimeout(a)}),a.forOwn(this._continuationTimeouts,function(a){clearTimeout(a)}),this._requests={},this._responses={},this._requestListeners={},this._requestTimeouts={},this._requestTimestamps={},this._continuationTimeouts={},this._namedEvents.dispose()},g.prototype.getApiVersion=function(){return this._mqProtocol.getApiVersion()},g.prototype.toString=function(){return"Proto["+this._webSocket.toString()+"]"},g}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(6)],e=function(a,b,c){"use strict";function d(a,c){b.isStringNotEmpty(a,"backendUri"),b.isObject(c,"authenticationData"),this._backendUri=a,this._authenticationData=c}function e(b){return a.assign({},b,this._authenticationData)}function f(a,b,c){if(b)return a(b,{});var d=JSON.parse(c);return"ok"!==d.status?a(null,{status:d.status}):a(null,d)}return d.prototype.createAuthenticationToken=function(b){var d=e.call(this,{});c.postWithRetry(this._backendUri+"/auth",JSON.stringify(d),null,a.bind(f,this,b),1)},d.prototype.createStreamTokenForPublishing=function(d,g,h){b.isStringNotEmpty(d,"sessionId"),b.isObject(g,"capabilities");var i=e.call(this,{sessionId:d,capabilities:g});c.postWithRetry(this._backendUri+"/stream",JSON.stringify(i),null,a.bind(f,this,h),1)},d.prototype.createStreamTokenForSubscribing=function(d,g,h,i,j){b.isStringNotEmpty(d,"sessionId"),b.isObject(g,"capabilities"),a.isNullOrUndefined(i)||(b.isArray(i,"additionalStreamIds"),a.forEach(i,function(a){b.isStringNotEmpty(a,"alternateOriginStreamId")}));var k=e.call(this,{sessionId:d,capabilities:g,originStreamId:h});i&&i.length>0&&(k.alternateOriginStreamIds=i),c.postWithRetry(this._backendUri+"/stream",JSON.stringify(k),null,a.bind(f,this,j),1)},d.prototype.getStreams=function(b){c.getWithRetry(this._backendUri+"/streams",null,a.bind(f,this,b),1)},d}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1)],e=function(a,b){"use strict";function c(a){b.isObject(a,"pcast"),b.isFunction(a.getObservableStatus,"pcast.getObservableStatus"),b.isFunction(a.getLogger,"pcast.getLogger"),b.isFunction(a.getProtocol,"pcast.getProtocol"),this._pcast!==a&&(this._pcast=a,this._logger=a.getLogger(),this._protocol=a.getProtocol(),b.isObject(this._logger,"this._logger"),b.isObject(this._protocol,"this._protocol"),b.isFunction(this._protocol.getObservableSessionId,"this._protocol.getObservableSessionId"),b.isFunction(this._pcast.getObservableStatus,"this._pcast.getObservableStatus"),this._sessionId=this._protocol.getObservableSessionId(),this._status=this._pcast.getObservableStatus())}function d(a){return null!==a&&void 0!==a&&""!==a}function e(a){return null!==a&&void 0!==a&&""!==a&&"offline"!==a.toLowerCase()}return c.prototype.assertAuthorized=function(){if(!e(this.getPCastStatus()))throw new Error("Unable to perform action. Status [%s]. Please wait to reconnect.",this.getPCastStatus());if(!d(this.getPCastSessionId()))throw new Error("Unable to perform action. Invalid sessionId [%s]",this.getPCastSessionId())},c.prototype.getObservableSessionId=function(){return this._sessionId},c.prototype.getObservableStatus=function(){return this._status},c.prototype.getPCastSessionId=function(){return this._sessionId.getValue()},c.prototype.getPCastStatus=function(){return this._status.getValue()},c}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0)],e=function(a){"use strict";var b={};return b.parseEnvFromPcastBaseUri=function(b){return b=b.toLowerCase(),a.includes(b,"local")?"local":a.includes(b,"stg")?"staging":"production"},b}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";var a={"package":"telemetry",messages:[{name:"LogData",fields:[{rule:"required",type:"LogLevel",name:"level",id:1},{rule:"required",type:"string",name:"timestamp",id:2},{rule:"required",type:"string",name:"category",id:3},{rule:"required",type:"string",name:"message",id:4},{rule:"optional",type:"string",name:"source",id:5},{rule:"optional",type:"string",name:"fullQualifiedName",id:11},{rule:"optional",type:"string",name:"sessionId",id:6},{rule:"optional",type:"string",name:"userId",id:7},{rule:"optional",type:"string",name:"environment",id:8},{rule:"optional",type:"string",name:"version",id:9},{rule:"optional",type:"float",name:"runtime",id:10}]},{name:"StoreLogRecords",fields:[{rule:"repeated",type:"LogData",name:"records",id:1}]},{name:"StoreLogRecordsResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"required",type:"uint64",name:"storedRecords",id:2}]},{name:"MetricValue",fields:[{rule:"optional",type:"string",name:"string",id:1},{rule:"optional",type:"float",name:"float",id:2},{rule:"optional",type:"uint64",name:"uint64",id:3},{rule:"optional",type:"int64",name:"int64",id:4},{rule:"optional",type:"bool",name:"boolean",id:5},{rule:"optional",type:"string",name:"timestamp",id:6}]},{name:"MetricData",fields:[{rule:"required",type:"string",name:"timestamp",id:1},{rule:"optional",type:"string",name:"sessionId",id:2},{rule:"optional",type:"string",name:"streamId",id:3},{rule:"optional",type:"string",name:"source",id:4},{rule:"optional",type:"string",name:"resource",id:5},{rule:"optional",type:"string",name:"kind",id:6},{rule:"required",type:"Metric",name:"metric",id:7},{rule:"optional",type:"MetricValue",name:"value",id:8},{rule:"optional",type:"MetricValue",name:"previousValue",id:9},{rule:"optional",type:"uint64",name:"elapsed",id:10},{rule:"optional",type:"string",name:"fullQualifiedName",id:11},{rule:"optional",type:"string",name:"environment",id:12},{rule:"optional",type:"string",name:"version",id:13},{rule:"optional",type:"string",name:"tool",id:14},{rule:"optional",type:"string",name:"toolVersion",id:15},{rule:"required",type:"float",name:"runtime",id:16}]},{name:"SubmitMetricRecords",fields:[{rule:"repeated",type:"MetricData",name:"records",id:1}]},{name:"SubmitMetricRecordsResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"required",type:"uint64",name:"storedRecords",id:2}]}],enums:[{name:"LogLevel",values:[{name:"Trace",id:0},{name:"Debug",id:1},{name:"Info",id:2},{name:"Warn",id:3},{name:"Error",id:4},{name:"Fatal",id:5}]},{name:"Metric",values:[{name:"RoundTripTime",id:0},{name:"DownlinkThroughputCapacity",id:26},{name:"Initialized",id:1},{name:"Provisioned",id:2},{name:"SetupCompleted",id:3},{name:"Offset",id:4},{name:"TimeToFirstFrame",id:5},{name:"Playing",id:6},{name:"Stalled",id:7},{name:"Buffering",id:8},{name:"Seeking",id:22},{name:"Stopped",id:9},{name:"BitRateAdaptation",id:10},{name:"ResolutionChanged",id:11},{name:"DisplayResolutionChanged",id:23},{name:"FrameRateChanged",id:12},{name:"FramesDropped",id:13},{name:"PacketsLost",id:14},{name:"PictureLost",id:15},{name:"PlayoutDelayChanged",id:16},{name:"CodecChanged",id:17},{name:"PlayerEvent",id:21},{name:"MetricDropped",id:18},{name:"NetworkOffline",id:19},{name:"NetworkOnline",id:20},{name:"NetworkType",id:27},{name:"ApplicationForeground",id:24},{name:"ApplicationBackground",id:25}]}]};return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(4),c(32),c(15)],e=function(a,b,c,d,e){"use strict";function f(a,b,c,d,e,f,g){this.init(a,b,c,d,e,f,g)}function g(a){return new d(a.uri,a.type,a.audioState,a.videoState)}function h(b){var c=this._streams.getValue(),e=[];a.forEach(b,function(b){var f=d.parsePCastStreamIdFromStreamUri(b.uri),h=a.find(c,function(a){var c=a.getUri()===b.uri,d=a.isPCastStream()&&a.getPCastStreamId()===f,e=c||d;return a.getType()===b.type&&e});h?h._update(b):h=g(b),e.push(h)}),this._streams.setValue(e)}function i(b){if(b=a.getEnumName(k,b),!b)throw new Error('"role" must be a valid member role');return b}function j(b){if(b=a.getEnumName(l,b),!b)throw new Error('"state" must be a valid member state');return b}var k=e.roles,l=e.states;return f.prototype.init=function(d,e,f,g,h,k,l){b.isString(f,"sessionId"),b.isString(g,"screenName"),b.isArray(k,"streams"),b.isNumber(a.utc(l),"lastUpdate"),d&&b.isObject(d,"roomService"),this._sessionId=new c.Observable(f),this._screenName=new c.Observable(g),this._streams=new c.ObservableArray([]),this._state=new c.Observable(e,j).extend({rateLimit:500}),this._role=new c.Observable(h,i),this._lastUpdate=new c.Observable(l,a.utc),this._roomService=d,this.setStreams(k)},f.prototype.getObservableState=function(){return this._state},f.prototype.getSessionId=function(){return this._sessionId.getValue()},f.prototype.getObservableScreenName=function(){return this._screenName},f.prototype.getObservableRole=function(){return this._role},f.prototype.getObservableStreams=function(){return this._streams},f.prototype.getObservableLastUpdate=function(){return this._lastUpdate},f.prototype.getLastUpdate=function(){return this._lastUpdate.getValue()},f.prototype.getStreams=function(){return a.map(this._streams.getValue(),function(a){return a.toJson()})},f.prototype.commitChanges=function(a){b.isObject(this._roomService,"this._roomService"),this._roomService.updateMember(this,a)},f.prototype.reload=function(){b.isObject(this._roomService,"this._roomService"),this._roomService.revertMemberChanges(this)},f.prototype.setStreams=function(b){var c=a.map(b,function(a){return g(a)});this._streams.setValue(c)},f.prototype.toString=function(){return this.getObservableRole().getValue()+"["+this.getObservableScreenName().getValue()+","+this.getSessionId()+"]"},f.prototype.toJson=function(){var b={sessionId:this._sessionId.getValue(),screenName:this._screenName.getValue(),role:this._role.getValue(),state:this._state.getValue(),streams:[],lastUpdate:this._lastUpdate.getValue()};return a.forEach(this._streams.getValue(),function(a){b.streams.push(a.toJson())}),b},f.prototype._update=function(b){a.isObject(b)&&(b.hasOwnProperty("state")&&this._state.setValue(b.state),b.hasOwnProperty("screenName")&&this._screenName.setValue(b.screenName),b.hasOwnProperty("role")&&this._role.setValue(b.role),b.hasOwnProperty("lastUpdate")&&this._lastUpdate.setValue(b.lastUpdate),b.hasOwnProperty("streams")&&h.call(this,b.streams))},f}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(4),c(30),c(16)],e=function(a,b,c,d,e){"use strict";function f(a,b,c,d,e,f,g,h,i){this.init(a,b,c,d,e,f,g,h,i)}function g(a){var b=h(a,this._roomService);this._members.setValue(b)}function h(b,c){return a.map(b,function(a){return new d(c,a.state,a.sessionId,a.screenName,a.role,a.streams,a.lastUpdate)})}function i(b){if(b=a.getEnumName(j,b),!b)throw new Error('"type" must be a valid room type');return b}var j=e.types;return f.prototype.init=function(a,d,e,f,h,j,k,l,m){b.isStringNotEmpty(f,"name"),b.isStringNotEmpty(h,"description"),b.isArray(k,"members"),d&&b.isStringNotEmpty(d,"id"),e&&b.isStringNotEmpty(e,"alias"),l&&b.isStringNotEmpty(l,"bridgeId"),m&&b.isStringNotEmpty(m,"pin"),a&&b.isObject(a,"roomService"),this._roomId=new c.Observable(d),this._alias=new c.Observable(e),this._name=new c.Observable(f),this._description=new c.Observable(h),this._type=new c.Observable(j,i),this._members=new c.ObservableArray([]).extend({method:"notifyWhenChangesStop",timeout:400}),this._options=new c.ObservableArray,this._bridgeId=new c.Observable(l),this._pin=new c.Observable(m),this._roomService=a,g.call(this,k)},f.prototype.getRoomId=function(){return this._roomId.getValue()},f.prototype.getObservableAlias=function(){return this._alias},f.prototype.getObservableName=function(){return this._name},f.prototype.getObservableDescription=function(){return this._description},f.prototype.getObservableType=function(){return this._type},f.prototype.getObservableMembers=function(){return this._members},f.prototype.getObservableBridgeId=function(){return this._bridgeId},f.prototype.getObservablePin=function(){return this._pin},f.prototype.toString=function(){return this._type.getValue()+"["+this._roomId.getValue()+"]"},f.prototype.toJson=function(){return{roomId:this._roomId.getValue(),alias:this._alias.getValue(),name:this._name.getValue(),description:this._description.getValue(),type:this._type.getValue(),pin:this._pin.getValue(),bridgeId:this._bridgeId.getValue()}},f.prototype.commitChanges=function(a){b.isObject(this._roomService,"this._roomService"),this._roomService.updateRoom(this,a)},f.prototype.reload=function(){b.isObject(this._roomService,"this._roomService"),this._roomService.revertRoomChanges(this)},f.prototype._update=function(b){a.isObject(b)&&(b.roomId&&this._roomId.setValue(b.roomId),b.alias&&this._alias.setValue(b.alias),b.name&&this._name.setValue(b.name),b.description&&this._description.setValue(b.description),b.type&&this._type.setValue(b.type),b.options&&this._options.setValue(b.options),b.bridgeId&&this._bridgeId.setValue(b.bridgeId),b.pin&&this._pin.setValue(b.pin),b.members)},f.prototype._addMembers=function(b){var c=this,d=h(b);a.forEach(d,function(a){c._members.push(a)})},f.prototype._removeMembers=function(b){var c=this;a.forEach(b,function(a){c._members.remove(function(b){return a.sessionId===b.getSessionId()&&a.lastUpdate>=b.getObservableLastUpdate().getValue()})})},f.prototype._updateMembers=function(b){a.forEach(this._members.getValue(),function(c){var d=a.find(b,function(a){return c.getSessionId()===a.sessionId&&a.lastUpdate>c.getObservableLastUpdate().getValue()});d&&c._update(d)})},f}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(4),c(33),c(34)],e=function(a,b,c,d,e){"use strict";function f(a,b,c,d){this.init(a,b,c,d)}function g(b){return a.includes(b,n)?n:o}function h(a,b){return f.parsePCastStreamIdFromStreamUri(a)===f.parsePCastStreamIdFromStreamUri(b)}function i(b){var c={},d=b.split("?");if(2!==d.length)return c;var e=d[1],f=e.split("&");return a.forEach(f,function(a){var b=a.split("="),d=b[0];c[d]=b[1]}),c}function j(b){if(b=a.getEnumName(l,b),!b)throw new Error('"type" must be a valid stream type');return b}function k(b){if(b=a.getEnumName(m,b),!b)throw new Error('"state" must be a valid track state');return b}var l=d.types,m=e.states,n="pcast://phenixp2p.com/",o="pcast://phenixrts.com/";return f.prototype.init=function(a,d,e,g){b.isString(a,"uri"),this._uri=new c.Observable(a),this._type=new c.Observable(d,j),this._audioState=new c.Observable(e||m.trackEnabled.name,k),this._videoState=new c.Observable(g||m.trackEnabled.name,k),this._streamId=f.parsePCastStreamIdFromStreamUri(a)},f.prototype.getUri=function(){return this._uri.getValue()},f.prototype.getType=function(){return this._type.getValue()},f.prototype.getObservableAudioState=function(){return this._audioState},f.prototype.getObservableVideoState=function(){return this._videoState},f.prototype.toJson=function(){return{uri:this._uri.getValue(),type:this._type.getValue(),audioState:this._audioState.getValue(),videoState:this._videoState.getValue()}},f.prototype._update=function(b){a.isObject(b)&&(b.hasOwnProperty("uri")&&b.uri!==this._uri.getValue()&&h(b.uri,this._uri.getValue())&&(this._uri.setValue(b.uri),this._streamId=f.parsePCastStreamIdFromStreamUri(b.uri)),b.hasOwnProperty("audioState")&&this._audioState.setValue(b.audioState),b.hasOwnProperty("videoState")&&this._videoState.setValue(b.videoState))},f.prototype.isPCastStream=function(){return!!this._streamId},f.prototype.getPCastStreamId=function(){return this._streamId},f.prototype.getInfo=function(){return i(this._uri.getValue())},f.getPCastPrefix=function(){return n},f.parsePCastStreamIdFromStreamUri=function(b){var c=a.includes(b,g(b));return c?b.replace(g(b),"").split("?")[0]:null},f.getInfoFromStreamUri=function(a){return i(a)},f}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";var a={types:{user:{id:0,name:"User"},presentation:{id:1,name:"Presentation"},audio:{id:2,name:"Audio"}}};return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";var a={states:{trackEnabled:{id:0,name:"TrackEnabled"},trackDisabled:{id:1,name:"TrackDisabled"},trackEnded:{id:2,name:"TrackEnded"}}};return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b){},function(a,b,c){var d,e;d=[c(0),c(1),c(14),c(13),c(65),c(68),c(66)],e=function(a,b,c,d,e,f,g){"use strict";function h(g,h){b.isArray(g,"userMediaStreams"),h=h||{},this._baseUri=h.uri||d.DefaultPCastUri,this._logger=h.logger||c.createPCastLogger(this._baseUri),this._audioContext=h.audioContext||new e,this._nativeAudioContext=this._audioContext.getNativeAudioContext(),this._onSpeakingChanged=null,this._userMediaStreams=g,this._disposeOfAudioContext=!a.isObject(h.audioContext),this._audioVolumeMeterFactory=new f(this._logger),a.forEach(this._userMediaStreams,a.bind(i,this,h))}function i(a,c){b.isObject(c,"stream"),b.isObject(a,"options");var d=this._audioVolumeMeterFactory.getAudioVolumeMeter(c);d.init(this._nativeAudioContext,a.alpha),d.connect(c)}function j(a,c){b.isObject(c,"stream"),b.isObject(a,"options");var d=this._audioVolumeMeterFactory.getAudioVolumeMeter(c),e=new g(this._logger);a.alpha&&d.setAlpha(a.alpha),e.onValue(this._onSpeakingChanged),e.startDetection(d,a)}return h.prototype.start=function(c,d){b.isFunction(d,"callback"),this._onSpeakingChanged=d,c=c||{},a.forEach(this._userMediaStreams,a.bind(j,this,c))},h.prototype.stop=function(){a.forEach(this.getAudioVolumeMeters(),function(a){a.onValue(function(){})}),this._onSpeakingChanged=null},h.prototype.getAudioVolumeMeter=function(a){return b.isObject(a,"stream"),this._audioVolumeMeterFactory.getAudioVolumeMeter(a)},h.prototype.getAudioVolumeMeters=function(){return this._audioVolumeMeterFactory.getAudioVolumeMeters()},h.prototype.dispose=function(){this._disposeOfAudioContext&&this._nativeAudioContext.close(),this._audioVolumeMeterFactory.stopAllMeters(),this._userMediaStreams=null},h.prototype.toString=function(){return"AudioSpeakerDetector"},h}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(14),c(13),c(69)],e=function(a,b,c,d,e){"use strict";function f(a,e){b.isArray(a,"userMediaStreams"),e=e||{},this._baseUri=e.uri||d.DefaultPCastUri,this._logger=e.logger||c.createPCastLogger(this._baseUri),this._publisherAdjusters=[],this._publishers=a}function g(a,b,c){var d=new e(c);d.connect(a,b),this._publisherAdjusters.push(d)}return f.prototype.start=function(b,c){c=c||{},a.forEach(this._publishers,a.bind(g,this,b,c))},f.prototype.stop=function(){a.forEach(this._publisherAdjusters,function(a){a.close()}),this._publisherAdjusters=[]},f.prototype.toString=function(){return"BandwidthMonitor"},f}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(3),c(26),c(18),c(19),c(72),c(32),c(16),c(15),c(33),c(34)],e=function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";function m(a){b.isObject(a,"options"),a.pcastExpress?b.isObject(a.pcastExpress,"options.pcastExpress"):(b.isStringNotEmpty(a.backendUri,"options.backendUri"),b.isObject(a.authenticationData,"options.authenticationData")),this._pcastExpress=a.pcastExpress||new e(a),this._shouldDisposeOfPCastExpress=!a.pcastExpress,this._roomServices={},this._roomServicePublishers={},this._activeRoomServices=[],this._membersSubscriptions={},this._logger=this._pcastExpress.getPCast().getLogger()}function n(b,c,d){var e=this,g=a.uniqueId();this._pcastExpress.waitForOnline(function(){var a=o.call(e,b,c);if(a)return d(null,{status:"ok",roomService:a});e._roomServices[g]=new f(e._pcastExpress.getPCast());var h=p.call(e,e._roomServices[g],g);d(null,{status:"ok",roomService:h})})}function o(b,c){return a.find(this._activeRoomServices,function(a){var d=a.getObservableActiveRoom().getValue();return d&&(d.getRoomId()===b||d.getObservableAlias().getValue()===c)})}function p(a,b){var c=this,d=a.stop,e=a.leaveRoom;return a.stop=function(){d.call(a),delete c._roomServices[b]},a.leaveRoom=function(b){var d=a.getObservableActiveRoom().getValue();e.call(a,function(e,f){return e?(a.stop(),b(e)):"ok"!==f.status&&"not-in-room"!==f.status?b(null,f):(d&&c._membersSubscriptions[d.getRoomId()]&&(c._membersSubscriptions[d.getRoomId()].dispose(),delete c._membersSubscriptions[d.getRoomId()]),c._logger.info("Successfully disposed of Express Room Service [%s]",d?d.getRoomId():"Uninitialized"),a.stop(),b(null,f))})},a}function q(b,c,d){var e=this,f=0,g=function(b,c){if(b)return d(b);if("ok"!==c.status&&"streaming-not-ready"!==c.status)return d(null,c);if(f++,"streaming-not-ready"===c.status&&f<3)return setTimeout(c.retry,f*f*1e3);if("streaming-not-ready"===c.status&&f>=3)return d(null,{status:c.status});var e=a.assign({},c,{status:"ok"});return f>1?(e.reason="stream-failure-recovered",d(null,e)):void d(null,e)};return c?e._pcastExpress.subscribeToScreen(b,g):e._pcastExpress.subscribe(b,g)}function r(b,c,d){var e,f,g=this,h=function(h,i){if(f&&e&&clearInterval(f),h)return d(h);if("ok"!==i.status)return d(null,i);s.call(g,i.publisher,c),t.call(g,e,c),e=i.publisher;var j=a.bind(e.stop,e);e.stop=function(){clearInterval(f),j()},b.enableWildcardCapability&&(f=setInterval(function(){g._logger.debug("Refresh wildcard viewer stream token for [%s] interval of [%s] has expired. Creating new token.",e.getStreamId(),I);var a=o.call(g,c.getRoomId()),f=a?a.getObservableActiveRoom().getValue():c;u.call(g,b,e,f,function(a,b){
(a||"ok"!==b.status)&&d(a,b)})},I)),u.call(g,b,i.publisher,c,d)};return a.get(b,["mediaConstraints","screen"],!1)?(a.set(b,["streamInfo","isScreen"],!0),this._pcastExpress.publishScreen(b,h)):void this._pcastExpress.publish(b,h)}function s(a,b){this._roomServicePublishers[b.getRoomId()]||(this._roomServicePublishers[b.getRoomId()]=[]),this._roomServicePublishers[b.getRoomId()].push(a)}function t(b,c){this._roomServicePublishers[c.getRoomId()]&&b&&(this._roomServicePublishers[c.getRoomId()]=a.filter(this._roomServicePublishers[c.getRoomId()],function(a){return a.getStreamId()!==b.getStreamId()}))}function u(b,c,d,e){var f,h=this,j=b.streamType,k=b.streamInfo,l="high-availability"===b.viewerStreamSelectionStrategy&&d.getObservableType().getValue()===i.types.channel.name,m=null,n=e;if(!b.enableWildcardCapability){var p=E(c,j,k),q=a.assign({},b,{streams:x.call(h,p,d)});return w.call(h,q,n,c,d)}if(l){var r=g.getSimilarMembers(b.screenName,d.getObservableMembers().getValue());m=v(r),n=function(i,j){e(i,j);var k=a.get(j,"roomService",o.call(h,d.getRoomId()));if(!i&&"ok"===j.status&&!f&&k){var l=k.getObservableActiveRoom().getValue();f=l.getObservableMembers().subscribe(function(d){var i=g.getSimilarMembers(b.screenName,d),j=v(i),k=j.length===m.length&&a.reduce(j,function(b,c){return b?a.includes(m,c):b},!0);k||(h._logger.debug("Members with similar content to stream [%s] have changed. Generating new wildcard viewer token",c.getStreamId()),f.dispose(),f=null,u.call(h,b,c,l,function(a,b){(a||"ok"!==b.status)&&e(a,b)}))})}}}m&&m.length>0?h._logger.debug("Creating [real-time] viewer wildcard stream token for published stream [%s] with [%s] additional streams",c.getStreamId(),m.length):h._logger.debug("Creating [real-time] viewer wildcard stream token for published stream [%s]",c.getStreamId()),h._pcastExpress.getAdminAPI().createStreamTokenForSubscribing("*",[],c.getStreamId(),m,function(f,g){return f?e(f):"ok"!==g.status?e(null,g):(m&&m.length>0?h._logger.debug("Creating [broadcast] viewer wildcard stream token for published stream [%s] with [%s] additional streams",c.getStreamId(),m.length):h._logger.debug("Creating [broadcast] viewer wildcard stream token for published stream [%s]",c.getStreamId()),void h._pcastExpress.getAdminAPI().createStreamTokenForSubscribing("*",["broadcast"],c.getStreamId(),m,function(f,i){if(f)return e(f);if("ok"!==i.status)return e(null,i);if(a.includes(b.capabilities,"streaming"))return m&&m.length>0?h._logger.debug("Creating [streaming] viewer wildcard stream token for published stream [%s] with [%s] additional streams",c.getStreamId(),m.length):h._logger.debug("Creating [streaming] viewer wildcard stream token for published stream [%s]",c.getStreamId()),h._pcastExpress.getAdminAPI().createStreamTokenForSubscribing("*",["streaming"],c.getStreamId(),m,function(f,l){if(f)return e(f);if("ok"!==l.status)return e(null,l);if(a.includes(b.capabilities,"drm"))return m&&m.length>0?h._logger.debug("Creating [drm-open-access] and [drm-hollywood] viewer wildcard stream token for published stream [%s] with [%s] additional streams",c.getStreamId(),m.length):h._logger.debug("Creating [drm-open-access] and [drm-hollywood] viewer wildcard stream token for published stream [%s]",c.getStreamId()),h._pcastExpress.getAdminAPI().createStreamTokenForSubscribing("*",["streaming","drm-open-access"],c.getStreamId(),m,function(f,o){return f?e(f):"ok"!==o.status?e(null,o):h._pcastExpress.getAdminAPI().createStreamTokenForSubscribing("*",["streaming","drm-hollywood"],c.getStreamId(),m,function(f,m){if(f)return e(f);if("ok"!==m.status)return e(null,m);var p=[o.streamToken,m.streamToken],q=E(c,j,k,g.streamToken,i.streamToken,l.streamToken,p),r=a.assign({},b,{streams:x.call(h,q,d)});w.call(h,r,n,c,d)})});var o=E(c,j,k,g.streamToken,i.streamToken,l.streamToken),p=a.assign({},b,{streams:x.call(h,o,d)});w.call(h,p,n,c,d)});var l=E(c,j,k,g.streamToken,i.streamToken),o=a.assign({},b,{streams:x.call(h,l,d)});w.call(h,o,n,c,d)}))})}function v(b){return a.reduce(b,function(b,c){var d=a.get(c.getObservableStreams().getValue(),"0"),e=d?d.getPCastStreamId():"";return e&&b.push(e),b},[])}function w(b,c,d,e){var f=this,g=o.call(f,e.getRoomId()),h={publisher:d,roomService:g},i=function(i,j){if(i)return c(i);if("ok"===j.status){g=o.call(f,e.getRoomId());var k=g.getSelf().getObservableStreams().getValue(),l=a.find(k,function(a){return a.getPCastStreamId()===d.getStreamId()});F.call(f,d.getStream(),l)}if("ok"===j.status&&!d._cleanUpRoomWrapper){var m=a.bind(d.stop,d);d._cleanUpRoomWrapper=!0,d.stop=function(){t.call(f,d,e);var a=x.call(f,null,e),g=o.call(f,e.getRoomId());m(),g&&y.call(f,a,b.memberRole,g,function(a){if(a)return c(a)})}}return c(null,a.assign({},h,j))};y.call(f,b.streams,b.memberRole,g,i)}function x(b,c){var d=o.call(this,c.getRoomId()),e=b?[b]:[];if(!d)return e;var f=d.getSelf();if(!f)return e;var g=a.map(f.getObservableStreams().getValue(),function(a){return a.toJson()}),i=this._roomServicePublishers[c.getRoomId()]||[],j=a.map(i,function(a){return a.getStreamId()});return g&&0!==g.length?(b&&(g=a.filter(g,function(a){var c=a.uri===b.uri,d=h.parsePCastStreamIdFromStreamUri(a.uri),e=!!d,f=e&&d===h.parsePCastStreamIdFromStreamUri(b.uri),g=a.type===b.type;return!c&&!f||!g}),g.push(b)),a.filter(g,function(b){return a.includes(j,h.parsePCastStreamIdFromStreamUri(b.uri)||b.uri)})):e}function y(a,b,c,d){var e=c.getObservableActiveRoom().getValue();if(a){var f=c.getSelf();f.setStreams(a)}b&&f.getObservableRole().setValue(b),e&&c.getSelf()&&z.call(this,c.getSelf(),d)}function z(a,b){var c=0,d=this,e=5;a.commitChanges(function f(g,h){return g&&c++,h&&"ok"!==h.status&&c++,h&&"ok"===h.status?(c=0,!b||b(null,h)):c>=e?(d._logger.warn("Unable to update self after [%s] attempts.",e),b(new Error("Unable to update self"))):c>0&&c<e?(d._logger.warn("Unable to update self after [%s] attempts. Retrying.",c),a.commitChanges(f)):void 0})}function A(a,b,c){return b?a(b):c.retry?c.retry():void a(b,c)}function B(a){switch(a){case i.types.channel.name:return"Room Channel";case i.types.moderatedChat.name:return"Moderated Chat";case i.types.multiPartyChat.name:return"Multi Party Chat";case i.types.townHall.name:return"Town Hall";case i.types.directChat.name:return"Direct Chat";default:throw new Error("Unsupported Room Type")}}function C(b){var c=!0,d=h.getInfoFromStreamUri(b);return 0===a.values(d).length?c:!!d.streamTokenForLiveStream||!!d.streamTokenStreaming}function D(b,c){var d=h.getInfoFromStreamUri(b),e=(d.streamTokenForLiveStream||d.streamTokenStreaming)&&a.includes(c,"streaming");if(!a.includes(c,"drm-open-access")||!a.includes(c,"drm-hollywood"))return e&&d.streamTokenForLiveStreamWithDrmOpenAccess&&(a.includes(c,"drm-open-access")||H())?d.streamTokenForLiveStreamWithDrmOpenAccess:e&&d.streamTokenForLiveStreamWithDrmHollywood&&a.includes(c,"drm-hollywood")?d.streamTokenForLiveStreamWithDrmHollywood:!e||a.includes(c,"drm-open-access")||a.includes(c,"drm-hollywood")?d.streamTokenForBroadcastStream&&a.includes(c,"broadcast")?d.streamTokenForBroadcastStream:a.includes(c,"streaming")||a.includes(c,"broadcast")?void 0:d.streamToken:d.streamTokenForLiveStream||d.streamTokenStreaming}function E(c,d,e,f,g,i,j){var k=c.getStream(),m=k?k.getAudioTracks():null,n=k?k.getVideoTracks():null,o=m.length>0&&m[0].enabled,p=n.length>0&&n[0].enabled,q={uri:h.getPCastPrefix()+c.getStreamId(),type:d,audioState:o?l.states.trackEnabled.name:l.states.trackDisabled.name,videoState:p?l.states.trackEnabled.name:l.states.trackDisabled.name},r=a.assign({},e,{streamToken:f,streamTokenForBroadcastStream:g,streamTokenForLiveStream:i});f||delete r.streamToken,g||delete r.streamTokenForBroadcastStream,i||delete r.streamTokenForLiveStream,j&&(b.isArray(j,"drmStreamTokens"),r.streamTokenForLiveStreamWithDrmOpenAccess=j[0],r.streamTokenForLiveStreamWithDrmHollywood=j[1]);var s=a.reduce(r,function(a,b,c){var d=a?"&":"?";return a+d+c+"="+b},"");return s.length>0&&(q.uri=q.uri+s),q}function F(b,c){var d=b.getTracks(),e=this;a.forEach(d,function(d){a.addEventListener(d,"StateChange",function(){var a=d.enabled?l.states.trackEnabled.name:l.states.trackDisabled.name,f=G.call(e,c);e._logger.info("[%s] [%s] Track state changed to [%s], updating room member stream state [%s]",b.id,d.id,d.enabled,a),"video"===d.kind?c.getObservableVideoState().setValue(a):c.getObservableAudioState().setValue(a),f&&z.call(e,f)})})}function G(b){var c=a.find(this._activeRoomServices,function(c){var d=c.getSelf(),e=d?d.getObservableStreams().getValue():[];return a.find(e,function(a){return b===a})});return c?c.getSelf():null}function H(){return/(android)/i.test(navigator.userAgent)}var I=3e5,J=!0;return m.prototype.dispose=function(){a.forOwn(this._membersSubscriptions,function(a){a.dispose()}),a.forOwn(this._roomServicePublishers,function(b){a.forEach(b,function(a){a.stop()})}),a.forOwn(this._roomServices,function(a){a.stop()}),this._membersSubscriptions={},this._roomServicePublishers={},this._roomServices={},this._activeRoomServices=[],this._shouldDisposeOfPCastExpress&&this._pcastExpress.dispose()},m.prototype.getPCastExpress=function(){return this._pcastExpress},m.prototype.createRoom=function(c,d){b.isFunction(d,"callback"),b.isObject(c.room,"options.room"),b.isStringNotEmpty(c.room.name,"options.room.name"),b.isStringNotEmpty(c.room.type,"options.room.type"),c.room.description&&b.isStringNotEmpty(c.room.description,"options.room.description");var e=c.room.description||B(c.room.type);n.call(this,null,null,function(b,f){if(b)return d(b);if("ok"!==f.status)return d(null,f);var g=f.roomService,h=a.assign({},c.room);h.description||(h.description=e),g.createRoom(h,function(a,b){return a?d(a):(g.stop(),d(null,b))})})},m.prototype.createChannel=function(c,d){b.isObject(c,"options"),b.isObject(c.room,"options.room");var e=a.assign({},c);e.room.type=i.types.channel.name,this.createRoom(e,d)},m.prototype.joinRoom=function(c,d,e){b.isObject(c,"options"),b.isFunction(d,"joinRoomCallback"),b.isStringNotEmpty(c.role,"options.role"),e&&b.isFunction(e,"membersChangedCallback"),c.screenName&&b.isStringNotEmpty(c.screenName,"options.screenName"),c.roomId&&b.isStringNotEmpty(c.roomId,"options.roomId"),c.alias&&b.isStringNotEmpty(c.alias,"options.alias"),c.streams&&b.isArray(c.streams,"options.streams");var f=this,g=c.role,h=c.screenName||a.uniqueId();n.call(this,c.roomId,c.alias,function(a,b){if(a)return d(a);if("ok"!==b.status)return d(null,b);var i=b.roomService,j=i.getObservableActiveRoom().getValue();return j||i.start(g,h),c.streams&&y.call(f,c.streams,c.role,i,function(a){if(a)return d(a)}),j&&e?(d(null,{status:"ok",roomService:i}),j.getObservableMembers().subscribe(e,{initial:"notify"})):void i.enterRoom(c.roomId,c.alias,function(a,b){if(a)return i.stop(),d(a);if("not-found"===b.status)return i.stop(),d(null,{status:"room-not-found"});if("ok"!==b.status&&"already-in-room"!==b.status)return i.stop(),d(null,b);var c=b.room;return f._activeRoomServices.push(i),d(null,{status:"ok",roomService:i}),e?c.getObservableMembers().subscribe(e,{initial:"notify"}):void 0})})},m.prototype.joinChannel=function(c,d,e){b.isObject(c,"options"),b.isFunction(d,"joinChannelCallback"),b.isFunction(e,"subscriberCallback"),c.videoElement&&b.isObject(c.videoElement,"options.videoElement"),c.streamSelectionStrategy&&b.isStringNotEmpty(c.streamSelectionStrategy,"options.streamSelectionStrategy");var f,h,k,l=a.assign({type:i.types.channel.name,role:j.roles.audience.name},c),m=new g(c.streamSelectionStrategy,this._logger),n="",o=this,p=function(b,c){var e=!c||a.assign({},c);if(c&&c.roomService){var g=c.roomService.leaveRoom,h=c.roomService.getObservableActiveRoom().getValue();k=c.roomService,n=h?h.getRoomId():"",o._logger.info("Joined channel [%s] with [%s] selection strategy",n,m.getStrategy()),e.roomService.leaveRoom=function(a){f&&f.stop(),g(a)}}d(b,e)};this.joinRoom(l,p,function q(b,d){function g(a,b,c){if(h===a)return b?t("unable-to-subscribe"):"app-background"===c.reason?e(b,c):c.retry&&"high-availability"!==m.getStrategy()?c.retry():"ok"!==c.status?t(c.status):void 0}var i=a.filter(b,function(a){return a.getObservableRole().getValue()===j.roles.presenter.name}),l=!!d||!f||!h,p=m.getNext(i,l),r=p?p.getObservableStreams().getValue()[0]:null,s=r?r.getPCastStreamId():"";if(!p||!r)return 0===i.length?e(null,{status:"no-stream-playing"}):d?(o._logger.info("Unable to find a new presenter to replace stream [%s] that ended in channel [%s] with status [%s] and [%s] black-listed members",h,n,d,m.getNumberOfBlackListedMembers()),e(null,{status:d||"unable-to-recover"})):e(null,{status:"no-stream-playing"});if(!C(r.getUri())&&a.includes(c.capabilities,"streaming"))return e(null,{status:"streaming-not-available"});if(!s)return o._logger.info("Channel [%s] presenter has no stream",n),e(null,{status:"no-stream-playing"});if(s!==h){h&&f&&f.stop();var t=function(a){var b=k?k.getObservableActiveRoom().getValue():null,c=b?b.getObservableMembers().getValue():[];if(b)return q(c,a)},u=a.assign({},{monitor:{callback:a.bind(g,this,s),options:{conditionCountForNotificationThreshold:8}}},c),v=d?"recovered-from-failure":"stream-override",w=h?v:"stream-started";h=s;var x=function(a,b,c){if(h===a){if(c&&"ok"===c.status&&(c.reason=w),b||c&&"ok"!==c.status)return o._logger.info("[%s] Issue with stream. Trying next member",a,c?c.status:"",b),t(c?c.status:"");c&&c.mediaStream?f=c.mediaStream:(h=null,f=null),e(b,c)}};o.subscribeToMemberStream(r,u,a.bind(x,this,s))}else if(d)return o._logger.info("Unable to find a new presenter to replace stream [%s] that ended in channel [%s] with status [%s]",h,n,d),e(null,{status:d||"unable-to-recover"})})},m.prototype.publishToRoom=function(c,d){b.isObject(c,"options"),b.isFunction(d,"callback"),b.isObject(c.room,"options.room"),c.streamUri?b.isStringNotEmpty(c.streamUri,"options.streamUri"):c.mediaConstraints?b.isObject(c.mediaConstraints,"options.mediaConstraints"):b.isObject(c.userMediaStream,"options.userMediaStream"),c.videoElement&&b.isObject(c.videoElement,"options.videoElement"),c.screenName&&b.isStringNotEmpty(c.screenName,"options.screenName"),c.capabilities&&b.isArray(c.capabilities,"options.capabilities"),c.tags&&b.isArray(c.tags,"options.tags"),c.streamInfo&&b.isObject(c.streamInfo,"options.streamInfo"),c.viewerStreamSelectionStrategy&&b.isStringNotEmpty(c.viewerStreamSelectionStrategy,"options.viewerStreamSelectionStrategy"),a.isUndefined(c.enableWildcardCapability)&&(c.enableWildcardCapability=J),b.isValidType(c.streamType,k.types,"options.streamType"),b.isValidType(c.memberRole,j.roles,"options.memberRole"),b.isBoolean(c.enableWildcardCapability,"options.enableWildcardCapability");var e=this,f=c.screenName||a.uniqueId();this.createRoom(c,function(b,g){if(b)return d(b);if("ok"!==g.status&&"already-exists"!==g.status)return d(null,g);var h=g.room,i=a.assign({monitor:{callback:a.bind(A,e,d),options:{conditionCountForNotificationThreshold:8}},streamInfo:{}},c);if(c.streamUri){var k=a.assign({connectOptions:[]},i),l=a.find(k.connectOptions,function(b){return a.startsWith(b,"room-id")});return l||(k.connectOptions=k.connectOptions.concat(["room-id="+h.getRoomId(),"member-role="+c.memberRole,"member-stream-type="+c.streamType,"screen-name="+f])),c.enableWildcardCapability&&k.connectOptions.concat(["member-stream-token-type=Wildcard","member-stream-token-refresh-interval="+I]),e._pcastExpress.publishRemote(k,d)}var m=a.assign({},c,{role:j.roles.audience.name,roomId:h.getRoomId()});e.joinRoom(m,function(a,b){if(a)return d(a);if("ok"!==b.status&&"already-in-room"!==b.status)return d(null,g);var c=b.roomService.getObservableActiveRoom().getValue();r.call(e,i,c,d)})})},m.prototype.publishScreenToRoom=function(b,c){var d=a.assign({},b,{mediaConstraints:{screen:!0}});this.publishToRoom(d,c)},m.prototype.publishToChannel=function(c,d){b.isObject(c,"options"),b.isFunction(d,"callback");var e=a.assign({memberRole:j.roles.presenter.name,streamType:k.types.presentation.name},c);c.room.type=i.types.channel.name,this.publishToRoom(e,d)},m.prototype.subscribeToMemberStream=function(d,e,f){b.isObject(d,"memberStream"),b.isObject(e,"options"),b.isFunction(f,"callback");var g=d.getUri(),h=d.getPCastStreamId(),i=D(g,e.capabilities),j=a.get(d.getInfo(),["isScreen"],!1);if(!h)throw this._logger.error("Invalid Member Stream. Unable to parse streamId from uri"),new Error("Invalid Member Stream. Unable to parse streamId from uri");var k=a.assign({},{streamId:h,streamToken:i},e),m=new c.DisposableList;q.call(this,k,j,function(a,b){m.dispose(),b&&"ok"===b.status&&b.mediaStream&&b.mediaStream.getStream()&&(m.add(d.getObservableAudioState().subscribe(function(a){var c=b.mediaStream.getMonitor(),d=b.mediaStream.getStream().getAudioTracks();c&&1===d.length&&c.setMonitorTrackState(d[0],a===l.states.trackEnabled.name)},{initial:"notify"})),m.add(d.getObservableVideoState().subscribe(function(a){var c=b.mediaStream.getMonitor(),d=b.mediaStream.getStream().getVideoTracks();c&&1===d.length&&c.setMonitorTrackState(d[0],a===l.states.trackEnabled.name)},{initial:"notify"}))),f(a,b)})},m}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e,f;!function(c,g){e=[],d=g,f="function"==typeof d?d.apply(b,e):d,!(void 0!==f&&(a.exports=f))}(this,function(){"use strict";function a(a,b,c){this.low=0|a,this.high=0|b,this.unsigned=!!c}function b(a){return(a&&a.__isLong__)===!0}function c(a,b){var c,d,f;return b?(a>>>=0,(f=0<=a&&a<256)&&(d=i[a])?d:(c=e(a,(0|a)<0?-1:0,!0),f&&(i[a]=c),c)):(a|=0,(f=-128<=a&&a<128)&&(d=h[a])?d:(c=e(a,a<0?-1:0,!1),f&&(h[a]=c),c))}function d(a,b){if(isNaN(a)||!isFinite(a))return b?q:p;if(b){if(a<0)return q;if(a>=m)return v}else{if(a<=-n)return w;if(a+1>=n)return u}return a<0?d(-a,b).neg():e(a%l|0,a/l|0,b)}function e(b,c,d){return new a(b,c,d)}function f(a,b,c){if(0===a.length)throw Error("empty string");if("NaN"===a||"Infinity"===a||"+Infinity"===a||"-Infinity"===a)return p;if("number"==typeof b?(c=b,b=!1):b=!!b,c=c||10,c<2||36<c)throw RangeError("radix");var e;if((e=a.indexOf("-"))>0)throw Error("interior hyphen");if(0===e)return f(a.substring(1),b,c).neg();for(var g=d(j(c,8)),h=p,i=0;i<a.length;i+=8){var k=Math.min(8,a.length-i),l=parseInt(a.substring(i,i+k),c);if(k<8){var m=d(j(c,k));h=h.mul(m).add(d(l))}else h=h.mul(g),h=h.add(d(l))}return h.unsigned=b,h}function g(b){return b instanceof a?b:"number"==typeof b?d(b):"string"==typeof b?f(b):e(b.low,b.high,b.unsigned)}a.prototype.__isLong__,Object.defineProperty(a.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1}),a.isLong=b;var h={},i={};a.fromInt=c,a.fromNumber=d,a.fromBits=e;var j=Math.pow;a.fromString=f,a.fromValue=g;var k=1<<24,l=4294967296,m=0x10000000000000000,n=m/2,o=c(k),p=c(0);a.ZERO=p;var q=c(0,!0);a.UZERO=q;var r=c(1);a.ONE=r;var s=c(1,!0);a.UONE=s;var t=c(-1);a.NEG_ONE=t;var u=e(-1,2147483647,!1);a.MAX_VALUE=u;var v=e(-1,-1,!0);a.MAX_UNSIGNED_VALUE=v;var w=e(0,-2147483648,!1);a.MIN_VALUE=w;var x=a.prototype;return x.toInt=function(){return this.unsigned?this.low>>>0:this.low},x.toNumber=function(){return this.unsigned?(this.high>>>0)*l+(this.low>>>0):this.high*l+(this.low>>>0)},x.toString=function(a){if(a=a||10,a<2||36<a)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(w)){var b=d(a),c=this.div(b),e=c.mul(b).sub(this);return c.toString(a)+e.toInt().toString(a)}return"-"+this.neg().toString(a)}for(var f=d(j(a,6),this.unsigned),g=this,h="";;){var i=g.div(f),k=g.sub(i.mul(f)).toInt()>>>0,l=k.toString(a);if(g=i,g.isZero())return l+h;for(;l.length<6;)l="0"+l;h=""+l+h}},x.getHighBits=function(){return this.high},x.getHighBitsUnsigned=function(){return this.high>>>0},x.getLowBits=function(){return this.low},x.getLowBitsUnsigned=function(){return this.low>>>0},x.getNumBitsAbs=function(){if(this.isNegative())return this.eq(w)?64:this.neg().getNumBitsAbs();for(var a=0!=this.high?this.high:this.low,b=31;b>0&&0==(a&1<<b);b--);return 0!=this.high?b+33:b+1},x.isZero=function(){return 0===this.high&&0===this.low},x.isNegative=function(){return!this.unsigned&&this.high<0},x.isPositive=function(){return this.unsigned||this.high>=0},x.isOdd=function(){return 1===(1&this.low)},x.isEven=function(){return 0===(1&this.low)},x.equals=function(a){return b(a)||(a=g(a)),(this.unsigned===a.unsigned||this.high>>>31!==1||a.high>>>31!==1)&&(this.high===a.high&&this.low===a.low)},x.eq=x.equals,x.notEquals=function(a){return!this.eq(a)},x.neq=x.notEquals,x.lessThan=function(a){return this.comp(a)<0},x.lt=x.lessThan,x.lessThanOrEqual=function(a){return this.comp(a)<=0},x.lte=x.lessThanOrEqual,x.greaterThan=function(a){return this.comp(a)>0},x.gt=x.greaterThan,x.greaterThanOrEqual=function(a){return this.comp(a)>=0},x.gte=x.greaterThanOrEqual,x.compare=function(a){if(b(a)||(a=g(a)),this.eq(a))return 0;var c=this.isNegative(),d=a.isNegative();return c&&!d?-1:!c&&d?1:this.unsigned?a.high>>>0>this.high>>>0||a.high===this.high&&a.low>>>0>this.low>>>0?-1:1:this.sub(a).isNegative()?-1:1},x.comp=x.compare,x.negate=function(){return!this.unsigned&&this.eq(w)?w:this.not().add(r)},x.neg=x.negate,x.add=function(a){b(a)||(a=g(a));var c=this.high>>>16,d=65535&this.high,f=this.low>>>16,h=65535&this.low,i=a.high>>>16,j=65535&a.high,k=a.low>>>16,l=65535&a.low,m=0,n=0,o=0,p=0;return p+=h+l,o+=p>>>16,p&=65535,o+=f+k,n+=o>>>16,o&=65535,n+=d+j,m+=n>>>16,n&=65535,m+=c+i,m&=65535,e(o<<16|p,m<<16|n,this.unsigned)},x.subtract=function(a){return b(a)||(a=g(a)),this.add(a.neg())},x.sub=x.subtract,x.multiply=function(a){if(this.isZero())return p;if(b(a)||(a=g(a)),a.isZero())return p;if(this.eq(w))return a.isOdd()?w:p;if(a.eq(w))return this.isOdd()?w:p;if(this.isNegative())return a.isNegative()?this.neg().mul(a.neg()):this.neg().mul(a).neg();if(a.isNegative())return this.mul(a.neg()).neg();if(this.lt(o)&&a.lt(o))return d(this.toNumber()*a.toNumber(),this.unsigned);var c=this.high>>>16,f=65535&this.high,h=this.low>>>16,i=65535&this.low,j=a.high>>>16,k=65535&a.high,l=a.low>>>16,m=65535&a.low,n=0,q=0,r=0,s=0;return s+=i*m,r+=s>>>16,s&=65535,r+=h*m,q+=r>>>16,r&=65535,r+=i*l,q+=r>>>16,r&=65535,q+=f*m,n+=q>>>16,q&=65535,q+=h*l,n+=q>>>16,q&=65535,q+=i*k,n+=q>>>16,q&=65535,n+=c*m+f*l+h*k+i*j,n&=65535,e(r<<16|s,n<<16|q,this.unsigned)},x.mul=x.multiply,x.divide=function(a){if(b(a)||(a=g(a)),a.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?q:p;var c,e,f;if(this.unsigned){if(a.unsigned||(a=a.toUnsigned()),a.gt(this))return q;if(a.gt(this.shru(1)))return s;f=q}else{if(this.eq(w)){if(a.eq(r)||a.eq(t))return w;if(a.eq(w))return r;var h=this.shr(1);return c=h.div(a).shl(1),c.eq(p)?a.isNegative()?r:t:(e=this.sub(a.mul(c)),f=c.add(e.div(a)))}if(a.eq(w))return this.unsigned?q:p;if(this.isNegative())return a.isNegative()?this.neg().div(a.neg()):this.neg().div(a).neg();if(a.isNegative())return this.div(a.neg()).neg();f=p}for(e=this;e.gte(a);){c=Math.max(1,Math.floor(e.toNumber()/a.toNumber()));for(var i=Math.ceil(Math.log(c)/Math.LN2),k=i<=48?1:j(2,i-48),l=d(c),m=l.mul(a);m.isNegative()||m.gt(e);)c-=k,l=d(c,this.unsigned),m=l.mul(a);l.isZero()&&(l=r),f=f.add(l),e=e.sub(m)}return f},x.div=x.divide,x.modulo=function(a){return b(a)||(a=g(a)),this.sub(this.div(a).mul(a))},x.mod=x.modulo,x.not=function(){return e(~this.low,~this.high,this.unsigned)},x.and=function(a){return b(a)||(a=g(a)),e(this.low&a.low,this.high&a.high,this.unsigned)},x.or=function(a){return b(a)||(a=g(a)),e(this.low|a.low,this.high|a.high,this.unsigned)},x.xor=function(a){return b(a)||(a=g(a)),e(this.low^a.low,this.high^a.high,this.unsigned)},x.shiftLeft=function(a){return b(a)&&(a=a.toInt()),0===(a&=63)?this:a<32?e(this.low<<a,this.high<<a|this.low>>>32-a,this.unsigned):e(0,this.low<<a-32,this.unsigned)},x.shl=x.shiftLeft,x.shiftRight=function(a){return b(a)&&(a=a.toInt()),0===(a&=63)?this:a<32?e(this.low>>>a|this.high<<32-a,this.high>>a,this.unsigned):e(this.high>>a-32,this.high>=0?0:-1,this.unsigned)},x.shr=x.shiftRight,x.shiftRightUnsigned=function(a){if(b(a)&&(a=a.toInt()),a&=63,0===a)return this;var c=this.high;if(a<32){var d=this.low;return e(d>>>a|c<<32-a,c>>>a,this.unsigned)}return 32===a?e(c,0,this.unsigned):e(c>>>a-32,0,this.unsigned)},x.shru=x.shiftRightUnsigned,x.toSigned=function(){return this.unsigned?e(this.low,this.high,!1):this},x.toUnsigned=function(){return this.unsigned?this:e(this.low,this.high,!0)},x.toBytes=function(a){return a?this.toBytesLE():this.toBytesBE()},x.toBytesLE=function(){var a=this.high,b=this.low;return[255&b,b>>>8&255,b>>>16&255,b>>>24&255,255&a,a>>>8&255,a>>>16&255,a>>>24&255]},x.toBytesBE=function(){var a=this.high,b=this.low;return[a>>>24&255,a>>>16&255,a>>>8&255,255&a,b>>>24&255,b>>>16&255,b>>>8&255,255&b]},a})},function(a,b,c){var d,e;d=[c(0)],e=function(a){var b=function(){};return b.prototype.isObject=function(c,d){b.prototype.isString("name",d);var e='"'+d+'" must be an object';if(!a.isObject(c))throw new Error(e)},b.prototype.isArray=function(c,d){b.prototype.isString("name",d);var e='"'+d+'" must be an array';if(!a.isArray(c))throw new Error(e)},b.prototype.isString=function(b,c){var d='"'+c+'" must be a string';if(!a.isString(c))throw new Error('"name" must be a string');if(!a.isString(b))throw new Error(d)},b.prototype.isBoolean=function(c,d){b.prototype.isString("name",d);var e='"'+d+'" must be a boolean';if(!a.isBoolean(c))throw new Error(e)},b.prototype.isNumber=function(c,d){b.prototype.isString("name",d);var e='"'+d+'" must be a number';if(!a.isNumber(c))throw new Error(e)},b.prototype.isFunction=function(c,d){b.prototype.isString("name",d);var e='"'+d+'" must be a function';if(!a.isFunction(c))throw new Error(e)},b.prototype.stringNotEmpty=function(a,c){b.prototype.isStringNotEmpty(a,c)},b.prototype.isStringNotEmpty=function(a,c){b.prototype.isString("name",c);var d='"'+c+'" must not be empty';if(b.prototype.isString(a,c),""===a)throw new Error(d)},b.prototype.isInstanceOf=function(c,d,e){if(b.prototype.isString("name",e),!a.isObject(c))throw new Error('"'+e+'" must be an instance');if(!(c instanceof d))throw new Error('"'+e+'" must be a valid instance of class')},b.prototype.isNotUndefined=function(c,d){if(b.prototype.isString("name",d),a.isUndefined(c))throw new Error('"'+d+'" must not be undefined')},b.prototype.isValidType=function(c,d,e){if(b.prototype.isStringNotEmpty(e,"name"),c=a.getEnumName(d,c),a.isNullOrUndefined(c))throw new Error('"'+e+'" must be a valid type');return c},b.prototype.isArrayOfString=function(c,d){b.prototype.isString(d,"name"),b.prototype.isArray(c,d),a.forEach(c,function(a,c){b.prototype.isString(a,d+"["+c+"]")})},new b}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(5),c(22),c(6),c(4),c(3)],e=function(a,b,c,d,e,f,g){function h(d,e,h,i){b.isStringNotEmpty(d,"uri"),e=e||{},b.isObject(e,"options"),e.requestType&&b.isStringNotEmpty(e.requestType,"options.requestType"),e.maxAttempts&&b.isNumber(e.maxAttempts,"options.maxAttempts"),e.maxBufferedRecords&&b.isNumber(e.maxBufferedRecords,"options.maxBufferedRecords"),e.maxBatchSize&&b.isNumber(e.maxBatchSize,"options.maxBatchSize"),e.contentType&&b.isStringNotEmpty(e.contentType,"options.maxBatchSize"),h&&b.isFunction(h,"serializeRequest"),i&&b.isFunction(i,"deserializeResponse"),this._requestType=e.requestType||"POST",this._maxAttempts=e.maxAttempts||3,this._maxBufferedRecords=e.maxBufferedRecords||1e3,this._maxBatchSize=e.maxBatchSize||100,this._contentType=e.contentType||"application/json",this._serializeRequest=h,this._deserializeResponse=i,this._uri=d,this._records=[],this._isEnabled=!0,this._namedEvents=new c.NamedEvents,this._canSendRequestObservable=new f.Observable((!0)),this._disposables=new g.DisposableList,this._pending=!1,this._disposables.add(this._canSendRequestObservable.subscribe(a.bind(j,this))),this._disposables.add(k.call(this)),this._disposables.add(this._namedEvents)}function i(){if(this._records.length>this._maxBufferedRecords){var a=this._records.length-this._maxBufferedRecords/2;this._records=this._records.slice(a),this._namedEvents.fireAsync(o.capacity,[null,{numberOfDeletedRecords:a}])}}function j(){if(this._canSendRequestObservable.getValue()&&0!==this._records.length){m.call(this,!0);var b={records:a.take(this._records,this._maxBatchSize)};this._records=this._records.slice(this._maxBatchSize);var c=this;try{l.call(this,this._uri,b,function(){setTimeout(function(){c._records=c._records.concat(b.records),m.call(c,!1)},n)})}catch(d){setTimeout(function(){return m.call(c,!1),c._namedEvents.fire(o.error,[d])},n)}}}function k(){function a(){m.call(b,b._pending)}var b=this;return d.listenForNetworkChange(a)}function l(b,c,d){function f(a,b){if(a)return"timeout"===a.message?d():(m.call(g,!1),g._namedEvents.fire(o.error,[a]));m.call(g,!1);var c=g._deserializeResponse?g._deserializeResponse(b):b;return g._namedEvents.fire(o.response,[c])}var g=this,h=this._serializeRequest?this._serializeRequest(a.assign({},c)):c;switch(this._requestType){case"POST":return e.postWithRetry(b,h,{contentType:this._contentType},f,this._maxAttempts);default:throw new Error("Invalid request type")}}function m(a){this._pending=a,this._canSendRequestObservable.setValue(!a&&d.isOnline())}var n=0,o={capacity:"capacity",error:"error",response:"response"};return h.prototype.on=function(a,c){return b.isStringNotEmpty(a,"eventName"),b.isFunction(c,"callback"),this._namedEvents.listen(a,c)},h.prototype.addRecord=function(a){this._records.push(a),j.call(this),i.call(this)},h.prototype.addRecordToBeginning=function(a){this._records.unshift(a),j.call(this),i.call(this)},h.prototype.dispose=function(){this._records=[],this._disposables.dispose()},h}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(41)],e=function(a){"use strict";return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(6)],e=function(a,b,c){"use strict";function d(a,c,d,e){b.isObject(a,"logger"),b.isStringNotEmpty(c,"version"),b.isFunction(d,"onClosestEndpointFound"),e&&b.isFunction(e,"onAnEndpointResolved"),this._logger=a,this._version=c,this._onClosestEndpointFound=d,e&&(this._onAnEndpointResolved=e),this._done=!1,this._minTime=Number.MAX_VALUE,this._minResponseText=""}var e=4,f=30;return d.prototype.isResolved=function(){return this._done},d.prototype.measurementCallback=function(a,b,c){return b<this._minTime&&(this._logger.info("Current closest end point is [%s] with latency of [%s] ms",c,b),this._minTime=b,this._minResponseText=c),this.isResolved()},d.prototype.completeCallback=function(a){if(this._minResponseText&&this._minTime<Number.MAX_VALUE&&!this.isResolved())return this._done=!0,this._onClosestEndpointFound(null,{uri:this._minResponseText,roundTripTime:this._minTime})},d.prototype.resolveAll=function(a){for(var b=0;b<a.length;b++)this.resolve(a[b],e)},d.prototype.resolve=function(b,d){var e=this,g=1,h=0,i=function j(b){var i=1,k=a.now();e._logger.info("[%s] Checking end point [%s]",g,b),c.getWithRetry(b,{timeout:15e3,queryParameters:{version:e._version,_:a.now()}},function(c,i){var l=a.now(),m=l-k,n=m>f;if(e._onAnEndpointResolved&&(c?e._onAnEndpointResolved(c):e._onAnEndpointResolved(null,{time:m,endPoint:b})),g++,!c){if(e.measurementCallback(b,m,i))return;h++}return g<=d&&!e.isResolved()&&(n||c)?(c&&e._logger.info("Retrying after failure to resolve end point [%s] with [%s]",b,c),j(b)):0===h?e._logger.warn("Unable to resolve end point [%s] with [%s]",b,c):e.completeCallback(b)},i)};i(b)},d}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(43)],e=function(a){return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1)],e=function(a,b){"use strict";function c(a){b.isFunction(a,"cleanup"),this._cleanup=a}return c.prototype.dispose=function(){return this._cleanup.call()},c.prototype.toString=function(){return a.toString(this)},c}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0)],e=function(a){"use strict";function b(){this._list=[]}return b.prototype.add=function(b){if(!b||!a.isFunction(b.dispose))throw new Error('"disposable" must be a disposable or implement dispose');
this._list.push(b)},b.prototype.dispose=function(){var b=[];return a.forEach(this._list,function(a){b.push(a.dispose())}),this._list=[],b},b.prototype.toString=function(){return a.toString(this)},b}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(21)],e=function(a,b,c){"use strict";function d(){this._events={}}return d.prototype.fire=function(c,d,e){b.isStringNotEmpty(c,"name"),a.includes(a.keys(this._events),c)&&this._events[c].fire(d,e)},d.prototype.fireAsync=function(c,d,e){b.isStringNotEmpty(c,"name"),a.includes(a.keys(this._events),c)&&this._events[c].fireAsync(d,e)},d.prototype.listen=function(d,e){b.isStringNotEmpty(d,"name");var f=a.includes(a.keys(this._events),d)?this._events[d]:this._events[d]=new c;return f.listen(e)},d.prototype.size=function(b){return a.includes(a.keys(this._events),b)?this._events[b].size():0},d.prototype.dispose=function(){a.forOwn(this._events,function(a){a.dispose()}),this._events={}},d.prototype.toString=function(){return"NamedEvents|"+a.keys(this._events).length},d}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1)],e=function(a,b){"use strict";function c(){}function d(c){b.isObject(c,"settings"),c.queryParameters&&b.isObject(c.queryParameters,"settings.queryParameters"),c.mimeType&&b.stringNotEmpty(c.mimeType,"settings.mimeType"),c.accept&&b.stringNotEmpty(c.accept,"settings.accept"),c.contentType&&b.stringNotEmpty(c.contentType,"settings.contentType"),c.responseType&&b.stringNotEmpty(c.responseType,"settings.responseType"),a.isNullOrUndefined(c.timeout)||b.isNumber(c.timeout,"settings.timeout")}function e(b,c){var d=a.reduce(b,function(a,b,c){return a+=a?"&":"?",a+c.toString()+"="+b.toString()},"");return d.length>0?c+d:c}function f(a,b){var c=new XMLHttpRequest;if("withCredentials"in c)c.open(a,b,!0);else{if("undefined"==typeof XDomainRequest)return;c=new XDomainRequest,c.open(a,b)}return c}function g(){var a=new Error("unsupported");return a.code="unsupported",a}function h(b,c){var d=c.contentType||"application/json",e=c.accept||d,f=a.assign({},{"Content-Type":d,Accept:e},a.get(c,["headers"],{}));a.forOwn(f,function(a,c){b.setRequestHeader(c,a)})}function i(a,b){if(4===a.readyState)if(200===a.status)b(null,a.response||a.responseText);else{var c=new Error(0===a.status?"timeout":a.statusText);c.code=a.status,a.status>=500&&a.status<600&&(c.retryable=!0),b(c)}}function j(a,b,c,d,e){d?a&&d.retryable?b():c(d):c(null,e)}var k={get:"GET",post:"POST"},l=3e3;return c.prototype.get=function(b,c,j){c=c||{},d(c);var m=e(c.queryParameters||{},b),n=f(k.get,m,j);return n?(c.mimeType&&n.overrideMimeType(c.mimeType),c.responseType&&(n.responseType=c.responseType),h(n,c),n.addEventListener("readystatechange",a.bind(i,this,n,j)),n.timeout=c.timeout||l,void n.send()):j(g())},c.prototype.post=function(b,c,j,l){j=j||{},d(j);var m=e(j.queryParameters||{},b),n=f(k.post,m,l);return n?(j.responseType&&(n.responseType=j.responseType),h(n,j),n.addEventListener("readystatechange",a.bind(i,this,n,l)),n.timeout=j.timeout||15e3,void n.send(c)):l(g())},c.prototype.getWithRetry=function m(b,c,d,e,f){a.isNumber(f)||(f=1);var g=f<e,h=a.bind(m,this,b,c,d,e,f+1),i=a.bind(j,this,g,h,d);this.get(b,c,i)},c.prototype.postWithRetry=function n(b,c,d,e,f,g){a.isNumber(g)||(g=1);var h=g<f,i=a.bind(n,this,b,c,d,e,f,g+1),k=a.bind(j,this,h,i,e);this.post(b,c,d,k)},new c}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";function a(a){var c=a.split("."),d=[];return e.forEach(c,function(a){d=d.concat(b(a))}),d}function b(a){for(var b="",c=[],d=0,f=0;f<a.length;f++)if("["===a[f]){if(d++,!e.isString(b)||d>1)return[a];b&&(c.push(b),b="")}else if("]"===a[f]){if(d--,0!==d)return[a];c.push(b),b=""}else{if(f===a.length-1)return[a];b+=a[f]}return c}function c(a,b,c,d){if(a.length-1===b)return d;var f=a[b],g=a[b+1];if(e.isArray(c[f])||e.isObject(c[f]))return c[f];if(!e.isArray(c[f])&&e.isNumber(parseInt(g)))return[];if(!e.isObject(c[f])&&e.isString(g))return{};throw new Error("Unsupported type "+typeof f+" when setting property or index")}function d(a,b,c){if(e.isNumber(parseInt(b))&&e.isArray(a))return a[b]=c;if(e.isString(b)&&e.isObject(a))return a[b]=c;throw new Error("Unsupported type "+typeof b+" when setting property or index")}var e=function(){};e.get=function(b,c,d){if(e.isNullOrUndefined(b))return d;h(b,"objectToTraverse");var f=c;if(e.isString(f))f=a(c);else if(!e.isArray(f))throw new Error("Unsupported path type "+typeof c);var g=e.reduce(f,function(a,b){if(e.isObject(a)||e.isArray(a))return a[b]},b);return e.isUndefined(g)?d:g},e.set=function(b,f,g){if(!e.isObject(b))return b;h(b,"objectToTraverse");var i=b,j=f;if(e.isString(j))j=a(f);else if(!e.isArray(j))throw new Error("Unsupported path type "+typeof f);return e.forEach(j,function(a,b){d(i,a,c(j,b,i,g)),i=i[a]}),b},e.bind=function(a,b){var c=Array.prototype.slice.call(arguments,2);return function(){if(!e.isFunction(a))throw new TypeError("_.bind - callback must be a function");var d=c.concat(Array.prototype.slice.call(arguments));return a.apply(b,d)}},e.now=function(){return(new Date).getTime()},e.utc=function(a){return e.isNumber(a)?a:a?Math.floor(a):NaN},e.isoString=function(){var a=new Date;return a.toISOString?a.toISOString():a.getUTCFullYear()+"-"+e.pad(a.getUTCMonth()+1,2)+"-"+e.pad(a.getUTCDate(),2)+"T"+e.pad(a.getUTCHours(),2)+":"+e.pad(a.getUTCMinutes(),2)+":"+e.pad(a.getUTCSeconds(),2)+"."+(a.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"},e.map=function(a,b){h(a,"collection");var c=[];return a.constructor===Array?e.forEach(a,function(a,d){e.isString(b)&&e.isObject(a)?c.push(a[b]):e.isFunction(b)&&c.push(b(a,d))}):e.forOwn(a,function(a,d){e.isFunction(b)&&c.push(b(a,d))}),c},e.values=function(a){if(!e.isObject(a)||e.isArray(a))throw new Error("Collection must be an object.");return e.map(a,function(a){return a})},e.keys=function(a){if(!e.isObject(a)||e.isArray(a))throw new Error("Collection must be an object.");return e.map(a,function(a,b){return b})},e.forEach=function(a,b){if(!e.isFunction(b))throw new Error("Callback must be a function");f(a,"collection");for(var c=0;c<a.length;c++){var d=b(a[c],c);if(d===!1)return}},e.forOwn=function(a,b){if(!e.isFunction(b))throw new Error("Callback must be a function");h(a,"objectWithProperties");for(var c=Object.keys(a),d=0;d<c.length;d++){var f=c[d];(a.hasOwnProperty(f)||Object.prototype.hasOwnProperty.call(a,f))&&b(a[f],f)}},e.argumentsToArray=function(a){if(!e.isObject(a)||!a.length)throw new Error("Collection must be arguments");for(var b=[],c=0;c<a.length;c++)b.push(a[c]);return b},e.assign=function(a){h(a,"target");var b=e.argumentsToArray(arguments);return b.shift(),e.forEach(b,function(b,c){h(b,"source "+c),e.forOwn(b,function(b,c){a[c]=b})}),a},e.includes=function(a,b){if(e.isString(a))return j(b,"Includes value and search parameter"),a.indexOf(b)>-1;if(e.isUndefined(a)||e.isUndefined(b))return!1;h(a,"collection");var c=!1,d=function(a){a===b&&(c=!0)};return a.constructor===Array?e.forEach(a,d):e.forOwn(a,d),c},e.reduce=function(a,b,c){h(a,"collection");var d=c===e.noop()?null:c;return a.constructor===Array?e.forEach(a,function(a,c){d=b(d,a,c)}):e.forOwn(a,function(a,c){d=b(d,a,c)}),d},e.sample=function(a){return f(a,"collection"),a[Math.floor(Math.random()*a.length)]},e.uniqueId=function(){return(e.now()*Math.random()).toString()},e.find=function(a,b,c){f(a,"collection");var d;return e.forEach(a,function(a,e){if(b(a)&&e>=(c||0))return d=a}),d},e.findIndex=function(a,b,c){f(a,"collection");var d;return e.forEach(a,function(a,e){if(b(a,e)&&e>=(c||0))return d=e}),d},e.filter=function(a,b){f(a,"collection");var c=[];return e.forEach(a,function(a){b(a)&&c.push(a)}),c},e.remove=function(a,b){f(a,"collection");var c=function(a){return!b(a)};return e.filter(a,c)},e.take=function(a,b){return f(a,"collection"),a.slice(0,b)},e.hasDifferences=function(a,b,c){return e.findDifferences(a,b,c).length>0},e.findDifferences=function(a,b,c){function d(d,h){g[h]=1,(e.isObject(d)||e.isArray(d))&&c?e.hasIndexOrKey(b,h)&&e.sameTypes(a[h],b[h])?e.hasDifferences(a[h],b[h],c)&&f.push(h):f.push(h):a[h]!==b[h]&&f.push(h)}var f=[],g={};if(e.isArray(a)&&e.isArray(b))a.length>b.length?e.forEach(a,d):e.forEach(b,d);else{if(!e.isObject(a)||!e.isObject(b)||e.isArray(a)||e.isArray(b))throw new Error("Object types do not match");e.forOwn(a,d),e.forOwn(b,function(a,b){g.hasOwnProperty(b)||f.push(b)})}return f},e.hasIndexOrKey=function(a,b){return e.isArray(a)?a.length>parseInt(b):!!e.isObject(a)&&a.hasOwnProperty(b)},e.startsWith=function(a,b){return j(a,"value"),j(b,"prefix"),0===a.indexOf(b)},e.sameTypes=function(a,b){return e.isNullOrUndefined(a)||e.isNullOrUndefined(b)?e.isNullOrUndefined(a)&&e.isNullOrUndefined(b):e.isArray(a)||e.isArray(b)?e.isArray(a)&&e.isArray(b):typeof a==typeof b},e.freeze=function(a){return"freeze"in Object?Object.freeze(a):a},e.noop=function(){},e.isObject=function(a){return null!==a&&"object"==typeof a},e.isArray=function(a){return!!e.isObject(a)&&a.constructor===Array},e.isString=function(a){return"string"==typeof a},e.isNumber=function(a){return!isNaN(a)&&"number"==typeof a},e.isBoolean=function(a){return"boolean"==typeof a},e.isFunction=function(a){return"function"==typeof a},e.isNullOrUndefined=function(a){return null===a||e.isUndefined(a)},e.isUndefined=function(a){return"undefined"==typeof a},e.getEnumName=function(a,b){var c=null,d=e.map(a,function(a){return a});return e.isNumber(b)?c=e.find(d,function(a){return a.id===b}):e.isString(b)&&(c=e.find(d,function(a){return a.name.toLowerCase()===b.toLowerCase()})),c?c.name:null},e.toString=function(a){if(e.isString(a))return a;if(e.isBoolean(a))return a?"true":"false";if(e.isNumber(a))return a.toString();var b="";if(a)if(e.isFunction(a.toString))b=a.toString();else if(e.isObject(a.toString))try{b=a.toString()}catch(c){b="[object invalid toString()]"}if(0!==b.indexOf("[object"))return b;var d=[];return b+JSON.stringify(a,function(a,b){if(e.isObject(b)&&!e.isNullOrUndefined(b)){if(e.includes(d,b))return"<recursive>";d.push(b)}return""===a?b:e.toString(b)})},e.pad=function(a,b){g(a,"value"),g(b,"numberToPad");for(var c=a.toString().length,d=0;d<b-c;d++)a="0"+a.toString();return a.toString()},e.addEventListener=function(a,b,c,d){h(a,"target"),j(b,"eventName"),i(c,"listener"),a.phenixAddEventListener?a.phenixAddEventListener.call(a,b,c,!!d):a.addEventListener?a.addEventListener(b,c,!!d):a.attachEvent&&a.attachEvent("on"+b,c)},e.removeEventListener=function(a,b,c,d){h(a,"target"),j(b,"eventName"),i(c,"listener"),a.phenixRemoveEventListener?a.phenixRemoveEventListener.call(a,b,c,!!d):a.removeEventListener?a.removeEventListener(b,c,!!d):a.detachEvent&&a.detachEvent("on"+b,c)};var f=function(a){if(!e.isArray(a))throw new Error("Input must be an array.")},g=function(a,b){if(j(b,"name"),!e.isNumber(a))throw new Error(b+" must be a number.")},h=function(a,b){if(j(b,"name"),!e.isObject(a))throw new Error("collection type not supported - "+b+" must be an array or object.")},i=function(a,b){if(j(b,"name"),!e.isFunction(a))throw new Error(b+" must be a function.")},j=function(a,b){if(!e.isString(b))throw new Error("Name must be a string.");if(!e.isString(a))throw new Error(b+" must be a string.")};return e}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(11)],e=function(a,b,c){"use strict";function d(){this._minLevel=c.level.TRACE}d.prototype.setThreshold=function(a){b.isNumber(a,"level"),this._minLevel=a},d.prototype.getThreshold=function(){return this._minLevel},d.prototype.log=function(a,b,d,g,h,i,j,k,l){l.level<this._minLevel||(g[0]=a+" ["+d+"] "+b+" "+g[0],l.level>c.level.INFO?f(g):e(g))};var e=function(a){console.log.apply(console,a)}||function(){},f=function(a){console.error.apply(console,a)}||e;return d}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(11)],e=function(a,b,c){"use strict";function d(){this._appenders=[],this._userId=null,this._sessionId=null,this._environment=j,this._applicationVersion=k}function e(a){this._sessionId=a,a?this.info("Session started on websdk version [%s] ([%s]), user agent [%s]",k,l,navigator.userAgent):this.info("Websdk version [%s] ([%s]), user agent [%s]",k,l,navigator.userAgent)}function f(b,c){var d=a.now(),e=(d-i)/1e3,f=g(c.level),j=c.name||h,k=this;a.forEach(this._appenders,function(a){try{a.log(e,f,j,m(Array.prototype.slice.call(b)),k._sessionId,k._userId,k._environment,k._applicationVersion,c)}catch(d){}})}function g(a){switch(a){case c.level.TRACE:return"Trace";case c.level.DEBUG:return"Debug";case c.level.INFO:return"Info";case c.level.WARN:return"Warn";case c.level.ERROR:return"Error";case c.level.FATAL:return"Fatal";default:throw new Error("Unsupported Logging Level "+a)}}var h="websdk",i=window.__phenixPageLoadTime||window.__pageLoadTime||a.now(),j="production",k="2018-01-13T00:05:28Z",l="2018.1.5";d.prototype.trace=function(){return f.call(this,arguments,{level:c.level.TRACE})},d.prototype.debug=function(){return f.call(this,arguments,{level:c.level.DEBUG})},d.prototype.info=function(){return f.call(this,arguments,{level:c.level.INFO})},d.prototype.warn=function(){return f.call(this,arguments,{level:c.level.WARN})},d.prototype.error=function(){return f.call(this,arguments,{level:c.level.ERROR})},d.prototype.fatal=function(){return f.call(this,arguments,{level:c.level.FATAL})},d.prototype.addAppender=function(a){b.isObject(a,"appender"),b.isFunction(a.log,"appender.log"),this._appenders.push(a)},d.prototype.getAppenders=function(){return this._appenders},d.prototype.getUserId=function(){return this._userId},d.prototype.setUserId=function(a){this._userId=a},d.prototype.getEnvironment=function(){return this._environment},d.prototype.setEnvironment=function(a){this._environment=a},d.prototype.getApplicationVersion=function(){return this._applicationVersion},d.prototype.setApplicationVersion=function(a){this._applicationVersion=a},d.prototype.getObservableSessionId=function(){return this._observableSessionId},d.prototype.setObservableSessionId=function(c){this._observableSessionId=c,this._sessionIdSubscription&&this._sessionIdSubscription.dispose(),c&&(b.isObject(c,"observableSessionId"),this._sessionIdSubscription=this._observableSessionId.subscribe(a.bind(e,this),{initial:"notify"}))};var m=function(b){if(0!==b.length){var c=[],d=[];return a.forEach(b,function(b){c.push(a.toString(b)),b instanceof Error&&d.push(b.stack)}),n(c.concat(d))}},n=function(a){for(var b=a[0],c=0;b.indexOf&&a.length>1&&c>=0;)if(c=b.indexOf("%",c),c>0){var d=b.substring(c+1,c+2);switch(d){case"%":b=b.substring(0,c)+b.substring(c+1),c++;break;case"s":case"d":a[0]=b=b.substring(0,c)+a[1]+b.substring(c+2),a.splice(1,1);break;default:return a}}return a};return d}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(5),c(4),c(3)],e=function(a,b,c,d){"use strict";function e(){var d="undefined"==typeof navigator||navigator.onLine;this._onlineObservable=new c.Observable(d).extend({timeout:0}),this._namedEvents=new b.NamedEvents,"undefined"!=typeof window&&(a.addEventListener(window,"online",a.bind(this._namedEvents.fire,this._namedEvents,"online",[])),a.addEventListener(window,"offline",a.bind(this._namedEvents.fire,this._namedEvents,"offline",[])),a.addEventListener(window,"unload",a.bind(this._namedEvents.dispose,this._namedEvents))),this._namedEvents.listen("online",a.bind(this._onlineObservable.setValue,this._onlineObservable,!0)),this._namedEvents.listen("offline",a.bind(this._onlineObservable.setValue,this._onlineObservable,!1))}function f(b,c){var d=this;return this._onlineObservable.setValue(!1),a.isNumber(c)?void(d.offlineTimeout=setTimeout(function(){b&&!d._onlineObservable.getValue()&&b(!1)},c)):b(!1)}function g(a){this._onlineObservable.setValue(!0),a&&a(!0)}return e.prototype.listenForNetworkChange=function(b,c){var e=new d.DisposableList,h=a.bind(g,this,b),i=a.bind(f,this,b,c);return e.add(this._namedEvents.listen("online",h)),e.add(this._namedEvents.listen("offline",i)),e},e.prototype.isOnline=function(){return this._onlineObservable.getValue()},new e}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(23)],e=function(a,b,c){"use strict";function d(a,d){var e=a;void 0!==e&&null!==e||(e=[]),b.isArray(e,"valuesToSet"),this.observableArray=new c(e,d)}return d.prototype.getValue=function(){return this.observableArray.getValue()},d.prototype.setValue=function(a){return void 0!==a&&null!==a||(a=[]),void 0!==a&&b.isArray(a,"values"),this.observableArray.setValue(a)},d.prototype.subscribe=function(a,b){return this.observableArray.subscribe(a,b)},d.prototype.push=function(a){var b=this.observableArray.getValue();b.push(a),this.observableArray.setValue(b)},d.prototype.pop=function(){var a=this.observableArray.getValue(),b=a.pop();return this.observableArray.setValue(a),b},d.prototype.remove=function(b){var c=this.observableArray.getValue(),d=function(c){return a.isFunction(b)?b(c):c===b},e=a.filter(c,d);return e.length>0&&this.observableArray.setValue(a.remove(c,d)),e},d.prototype.removeAll=function(){var a=this.observableArray.getValue();return this.observableArray.setValue([]),a},d.prototype.extend=function(a){return this.observableArray.extend(a),this},d}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1)],e=function(a,b){"use strict";function c(a){b.isObject(a,"observable"),this._observable=a,this._listenerSubscription=null,this._isEnabled=!1}return c.prototype.start=function(b,c){this._isEnabled=!0,this._listenerSubscription=this._observable.subscribe(a.noop,{listenForChanges:{callback:b,timeout:c||500}})},c.prototype.stop=function(){this._isEnabled=!1,this._listenerSubscription&&this._listenerSubscription.dispose(),this._listenerSubscription=null},c.prototype.isEnabled=function(){return this._isEnabled},c}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){!function(b,d){a.exports=d(c(1),c(0),c(8),c(5),c(3),c(6))}(this,function(a,b,c,d,e,f){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,b),e.l=!0,e.exports}var c={};return b.m=a,b.c=c,b.d=function(a,c,d){b.o(a,c)||Object.defineProperty(a,c,{configurable:!1,enumerable:!0,get:d})},b.n=function(a){var c=a&&a.__esModule?function(){return a["default"]}:function(){return a};return b.d(c,"a",c),c},b.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},b.p="",b(b.s=15)}([function(b,c){b.exports=a},function(a,c){a.exports=b},function(a,b){a.exports=c},function(a,b){a.exports=d},function(a,b,c){var d,e;d=[c(1),c(0),c(2),c(3),c(8),c(5),c(16),c(17),c(10),c(11)],void 0!==(e=function(a,b,c,d,e,f,g,h,i,j){"use strict";function k(a,e){e&&b.isStringNotEmpty(e,"playlistUrl"),this.parsedPlaylist=null,this._logger=a||new c.Logger,this.playlistUrl=e,this.baseUrl=e?e.substring(0,e.lastIndexOf("/")+1):"",this._name=e?e.substring(e.lastIndexOf("/"),e.length):"",this._trackAddedEvent=new d.Event,this._playlistTracksByMimeType={},this._mimeTypes=[],this._deliveryType=m(this.playlistUrl),this._type=null}function l(c,d){b.isInstanceOf(c,f,"track"),d=d||a.noop,b.isFunction(d,"eventCallback");var e=c.getMimeType();this._playlistTracksByMimeType[e]||(this._playlistTracksByMimeType[e]=[]),a.includes(this._playlistTracksByMimeType[e],c)||this._playlistTracksByMimeType[e].push(c),a.includes(this._mimeTypes,e)||this._mimeTypes.push(e),this._trackAddedEvent.fireAsync([c],this,d)}function m(a){return/[.]mpd\??[^\s]*/i.test(a)?"Dash":/[.]m3u8\??[^\s]*/i.test(a)?"Hls":null}var n=5;return k.prototype.toString=function(){return"Playlist [playlistUrl="+this.playlistUrl+", baseUrl="+this.baseUrl+", mimeTypes="+this._mimeTypes+", trackAddedEvent(size)="+this._trackAddedEvent.size()+", playlistTracks="+this.getAllPlaylistTracks()+"]"},k.prototype.dispose=function(){a.forOwn(this._playlistTracksByMimeType,function(b){a.forEach(b,function(a){a.dispose()})}),this._playlistTracksByMimeType={},this._trackAddedEvent.dispose()},k.prototype.getPlaylistTracksByMimeType=function(a){return this._playlistTracksByMimeType[a]},k.prototype.fetch=function(b){(function(b){var c=this;e.getWithRetry(c.playlistUrl,{},function(d,f){d&&c._logger.error("Failed to load playlist [%s]. Status code: [%s] (status text: [%s])",c.playlistUrl,d.code,d.message),function(b,c){var d=null,f=[],k=this;switch(this._deliveryType){case"Dash":d=new i(k._logger,b),k.parsedPlaylist=d,k._playbackDurationSinceAvailable=k.parsedPlaylist.publishTime?k.parsedPlaylist.publishTime.getTime()-k.parsedPlaylist.availabilityStartTime.getTime():null,k._suggestedPresentationDelayTotalMillis=a.get(k.parsedPlaylist,["suggestedPresentationDelay","totalMillis"],null),k._totalMediaTimeInMillis=a.get(k.parsedPlaylist,["mediaPresentationDuration","totalMillis"],1/0),k._minBufferTimeTotalMillis=a.get(k.parsedPlaylist,["minBufferTime","totalMillis"],null),k._type=k.parsedPlaylist.type,f=function(b){var c=this;return a.map(b.representations,function(a){return{chunkDuration:a.duration,dataChunkUrlTemplate:a.media,codec:a.mseCodec,bandwidth:a.bandwidth,height:a.height,trackId:a.id,initUrl:a.initialization,mimeType:a.mimeType,totalNumberOfChunks:Math.ceil(c._totalMediaTimeInMillis/a.duration)}})}.call(k,k.parsedPlaylist),a.forEach(f,function(a){l.call(k,new g(k._logger,a))}),c();break;case"Hls":d=new j(k._logger,k._name,b),k.parsedPlaylist=d,k._playbackDurationSinceAvailable=0,k._minBufferTimeTotalMillis=0,k._suggestedPresentationDelayTotalMillis=0,k._totalMediaTimeInMillis=1/0;var o=0;a.forEach(d.streamVariants,function(a){var b=k.baseUrl+a.name,f=new h(k._logger,{mediaSegmentPlaylistUrl:b,codecs:a.codecs.join("|"),bandwidth:a.bandwidth,trackId:a.name,mimeType:"application/octet-stream",height:null});e.getWithRetry(b,{},function(a,b){return a?k._logger.error("Failed to load playlist [%s]. Status code: [%s] (status text: [%s])",k.playlistUrl,a.code,a.message):(f.updateMediaSegments(b),l.call(k,f),++o===d.streamVariants.length&&(k._type=f.isComplete()?"static":"dynamic","static"===k._type&&(k._totalMediaTimeInMillis=1e3*f.getPlayableDuration()),c()),void 0)},n)});break;default:throw k._logger.error("[%s] Unsupported Delivery Type [%s]",k.playlistUrl,m(k.playlistUrl)),new Error("Unsupported Delivery Type "+m(k.playlistUrl))}}.call(c,f,function(){b(d,{raw:f,parsed:c.parsedPlaylist})})},n)}).call(this,b)},k.prototype.getType=function(){return this._type},k.prototype.getDeliveryType=function(){return this._deliveryType},k.prototype.getPlaylistTracksByBandwidthPerMimeType=function(c,d){b.isObject(d,"restrictions");var e=this;return a.map(this._mimeTypes,function(b){var f=function(b,c){return 0===a.keys(c).length?b:a.filter(b,function(b){return function(b,c){var d=b.getHeight()||0,e=b.getBandwidth()||0;return a.reduce(c,function(a,b,c){switch(c){case"maxHeight":return d<=b;case"minHeight":return d>=b;case"maxBandwidth":return e<=b;case"minBandwidth":return e>=b;default:throw new Error("Unknown restriction "+c)}},!1)}(b,c)})}(e.getPlaylistTracksByMimeType(b),d),g=a.reduce(f,function(a,b){return b.getBandwidth()>c?a:a&&a.getBandwidth()>b.getBandwidth()?a:b},null)||e.getPlaylistTrackByMimeTypeAndNextHighestBandwidth(0,b);if(g)return g;var h=a.get(a.filter(f,function(a){return!a.getBandwidth()}),"0");return h?(e._logger.debug("Unable to get track with bandwidth [%s]. Falling back to track [%s].",h.getTrackId()),h):void e._logger.warn("Unable to get track with bandwidth [%s]. No other tracks to fallback on.")})},k.prototype.getPlaylistTrackByBandwidthAndMimeType=function(b,c){return a.find(this.getPlaylistTracksByBandwidthPerMimeType(b,{}),function(a){return a.getMimeType()===c})},k.prototype.getPlaylistTrackByMimeTypeAndNextHighestBandwidth=function(b,c){return a.reduce(this.getPlaylistTracksByMimeType(c),function(a,c){return c.getBandwidth()<=b?a:a?a.getBandwidth()>c.getBandwidth()?c:a:c},null)},k.prototype.getAllPlaylistTracks=function(){return[].concat.apply([],a.values(this._playlistTracksByMimeType))},k.prototype.getMimeTypes=function(){return this._mimeTypes},k.prototype.getPlaybackDurationSinceAvailable=function(){return this._playbackDurationSinceAvailable},k.prototype.getSuggestedPresentationDelayTotalMillis=function(){return this._suggestedPresentationDelayTotalMillis},k.prototype.getTotalMediaTimeInMillis=function(){return this._totalMediaTimeInMillis},k.prototype.getMinBufferTimeTotalMillis=function(){return this._minBufferTimeTotalMillis},k.prototype.addEventListener=function(a,c){if(b.isString(a,"eventName"),b.isFunction(c,"listener"),"trackadded"!==a)throw new Error('Event "'+a+'" is unknown.');return this._trackAddedEvent.listen(c)},k}.apply(b,d))&&(a.exports=e)},function(a,b,c){var d,e;d=[c(0),c(3),c(2)],void 0!==(e=function(a,b,c){"use strict";function d(a,b,c){}return d.prototype.toString=function(){throw new Error("Must be implemented")},d.prototype.dispose=function(){throw new Error("Must be implemented")},d.prototype.getMseCodec=function(){throw new Error("Must be implemented")},d.prototype.getTrackId=function(){throw new Error("Must be implemented")},d.prototype.getChunkDuration=function(){throw new Error("Must be implemented")},d.prototype.getBandwidth=function(){throw new Error("Must be implemented")},d.prototype.getHeight=function(){throw new Error("Must be implemented")},d.prototype.getMimeType=function(){throw new Error("Must be implemented")},d.prototype.getTotalNumberOfChunks=function(){throw new Error("Must be implemented")},d.prototype.getCurrentChunkId=function(){throw new Error("Must be implemented")},d.prototype.setCurrentChunkId=function(a){throw new Error("Must be implemented")},d.prototype.incrementCurrentChunkId=function(){throw new Error("Must be implemented")},d.prototype.addDataChunk=function(a,b,c){throw new Error("Must be implemented")},d.prototype.getChunks=function(){throw new Error("Must be implemented")},d.prototype.addEventListener=function(a,b){throw new Error("Must be implemented")},d}.apply(b,d))&&(a.exports=e)},function(a,b,c){var d,e;d=[c(1),c(2)],void 0!==(e=function(a,b){"use strict";function c(a,c){this._options=c||{},this._logger=a||new b.Logger,this._rateDataPoints={},this._ewmaPeriods=c.ewmaPeriods||null,this._ewmaMultiplier=this._ewmaPeriods?2/(this._ewmaPeriods+1):null}function d(a,b,c,d,e){var f=(c*(a.length-1)+e(b))/a.length;if(d>0)for(;b.added-a[0].added>d;){var g=a.shift();f=(f*(a.length+1)-e(g))/a.length}return f}return c.prototype.toString=function(){var b=this;return"StatsProvider [rateDataPoints(keys)="+a.keys(this._rateDataPoints)+", rateDataPoints="+a.toString(a.map(this._rateDataPoints,function(a,c){return b.getRateAverages(c)}))+", options="+this._options+"]"},c.prototype.dispose=function(){delete this._rateDataPoints},c.prototype.addRateDataPoint=function(b,c,e,f){if(!a.isNullOrUndefined(this._rateDataPoints)){this._rateDataPoints[b]||(this._rateDataPoints[b]={tenSecDataPoints:[],thirtySecDataPoints:[],oneMinDataPoints:[],twoMinDataPoints:[],ewmaDataPoints:[],tenSecAverageRate:0,thirtySecAverageRate:0,oneMinAverageRate:0,twoMinAverageRate:0,ewmaRate:0,smaRate:0,tenSecAverageDuration:0,thirtySecAverageDuration:0,oneMinAverageDuration:0,twoMinAverageDuration:0,ewmaDuration:0,smaDuration:0});var g={duration:c,amount:e,durationToSecondsFactor:f,rate:e/(c*f),added:a.now()};(function(a,b){var c=function(a){return a.rate},e=function(a){return a.duration};a.tenSecDataPoints.push(b),a.thirtySecDataPoints.push(b),a.oneMinDataPoints.push(b),a.twoMinDataPoints.push(b),a.tenSecAverageRate=d.call(this,a.tenSecDataPoints,b,a.tenSecAverageRate,1e4,c),a.thirtySecAverageRate=d.call(this,a.thirtySecDataPoints,b,a.thirtySecAverageRate,3e4,c),a.oneMinAverageRate=d.call(this,a.oneMinDataPoints,b,a.oneMinAverageRate,6e4,c),a.twoMinAverageRate=d.call(this,a.twoMinDataPoints,b,a.twoMinAverageRate,12e4,c),a.tenSecAverageDuration=d.call(this,a.tenSecDataPoints,b,a.tenSecAverageDuration,1e4,e),a.thirtySecAverageDuration=d.call(this,a.thirtySecDataPoints,b,a.thirtySecAverageDuration,3e4,e),a.oneMinAverageDuration=d.call(this,a.oneMinDataPoints,b,a.oneMinAverageDuration,6e4,e),a.twoMinAverageDuration=d.call(this,a.twoMinDataPoints,b,a.twoMinAverageDuration,12e4,e),this._ewmaMultiplier&&(a.ewmaDataPoints.push(b),a.smaRate=d.call(this,a.ewmaDataPoints,b,a.smaRate,-1,c),a.smaDuration=d.call(this,a.ewmaDataPoints,b,a.smaDuration,-1,e),a.ewmaDataPoints.length>=this._ewmaPeriods&&(a.ewmaDataPoints.shift(),a.ewmaDataPoints.length===this._ewmaPeriods?(a.ewmaRate=a.smaRate,a.ewmaDuration=a.smaDuration):(a.ewmaRate=this._ewmaMultiplier*(a.smaRate-a.ewmaRate)+a.ewmaRate,a.ewmaDuration=this._ewmaMultiplier*(a.smaDuration-a.ewmaDuration)+a.ewmaDuration)))}).call(this,this._rateDataPoints[b],g)}},c.prototype.getRateAverages=function(b){if(!a.get(this,["_rateDataPoints",b]))return{tenSecAverageRate:0,thirtySecAverageRate:0,oneMinAverageRate:0,twoMinAverageRate:0,ewmaRate:0,tenSecAverageDuration:0,thirtySecAverageDuration:0,oneMinAverageDuration:0,twoMinAverageDuration:0,ewmaDuration:0};var c=this._rateDataPoints[b];return{tenSecAverageRate:c.tenSecAverageRate,thirtySecAverageRate:c.thirtySecAverageRate,oneMinAverageRate:c.oneMinAverageRate,twoMinAverageRate:c.twoMinAverageRate,ewmaRate:c.ewmaRate,tenSecAverageDuration:c.tenSecAverageDuration,thirtySecAverageDuration:c.thirtySecAverageDuration,oneMinAverageDuration:c.oneMinAverageDuration,twoMinAverageDuration:c.twoMinAverageDuration,ewmaDuration:c.ewmaDuration}},c}.apply(b,d))&&(a.exports=e)},function(a,b){a.exports=e},function(a,b){a.exports=f},function(a,b,c){var d;void 0!==(d=function(){"use strict";function a(a,b,c,d){}return a.prototype.toString=function(){throw new Error("Must be implemented")},a.prototype.dispose=function(){throw new Error("Must be implemented")},a.prototype.initialize=function(a,b,c,d){throw new Error("Must be implemented")},a.prototype.getStreamDurationBeforeInitialization=function(){throw new Error("Must be implemented")},a.prototype.getLocalToServerTimeOffset=function(){throw new Error("Must be implemented")},a.prototype.setActiveTracks=function(a){throw new Error("Must be implemented")},a.prototype.initializePlaylistTracks=function(a,b,c,d){throw new Error("Must be implemented")},a.prototype.startRequestingDataForActiveTracks=function(){throw new Error("Must be implemented")},a.prototype.isFetchingData=function(){throw new Error("Must be implemented")},a.prototype.seekToChunk=function(a){throw new Error("Must be implemented")},a.prototype.stopRequestingAllData=function(){throw new Error("Must be implemented")},a}.apply(b,[]))&&(a.exports=d)},function(a,b,c){var d,e;d=[c(1),c(0),c(19)],void 0!==(e=function(a,b,c){"use strict";function d(d,f){b.isStringNotEmpty(f,"mpdXml"),b.isObject(d,"logger"),this._mpdXml=f,this._logger=d,this.minBufferTime=0,this.type=null,this.publishTime=null,this.availabilityStartTime=null,this.timeShiftBufferDepth=0,this.suggestedPresentationDelay=0,this.minimumUpdatePeriod=0,this.maxSegmentDuration=0,this.profiles=null,this.moreInfoUrl=null,this.programInfoTitle=null,this.representations=[],function(){b.isStringNotEmpty(this._mpdXml,"mpdXml");var d,f=c.parseXml(this._mpdXml),j=f.getElementsByTagName("parsererror");if(j&&j.length>0)throw d="Failed to parse MPD Playlist XML: "+j.item(0).innerText+" (source xml: "+this._mpdXml+")",this._logger.error(d),new Error(d);if("MPD"!==f.documentElement.nodeName)throw d='Invalid MPD Playlist XML. Does not start with "MPD": '+this._mpdXml,this._logger.error(d),new Error(d);this.minBufferTime=e(h(f.documentElement,"minBufferTime")),this.type=h(f.documentElement,"type"),this.publishTime=g(h(f.documentElement,"publishTime")),this.availabilityStartTime=g(h(f.documentElement,"availabilityStartTime")),this.timeShiftBufferDepth=e(h(f.documentElement,"timeShiftBufferDepth")),this.suggestedPresentationDelay=e(h(f.documentElement,"suggestedPresentationDelay")),this.minimumUpdatePeriod=e(h(f.documentElement,"minimumUpdatePeriod")),this.maxSegmentDuration=e(h(f.documentElement,"maxSegmentDuration")),
this.mediaPresentationDuration=e(h(f.documentElement,"mediaPresentationDuration")),this.profiles=h(f.documentElement,"profiles");var k=f.getElementsByTagName("ProgramInformation");if(k&&k.length>=1){var l=k.item(0);this.programInfoTitle=i(l,"Title").childNodes[0].nodeValue,this.moreInfoUrl=h(l,"moreInformationURL")}var m=f.getElementsByTagName("ContentProtection");if(this.contentProtectionTags=[],m.length>0)for(var n=0;n<m.length;n++){var o=m.item(n),p=a.reduce(o.attributes,function(a,b){return a[b.name]=b.value,a},{});this.contentProtectionTags.push(p)}for(var q=f.getElementsByTagName("Representation"),r=0;r<q.length;r++){var s=function(a){var b={};if(b.id=h(a,"id"),b.mimeType=h(a,"mimeType"),b.codecs=h(a,"codecs"),b.mseCodec=c.getMSECodec(b.mimeType,b.codecs),b.isAudio=b.mimeType.indexOf("audio")>=0,b.isVideo=b.mimeType.indexOf("video")>=0,!c.isCodecSupported(b.mseCodec))return this._logger.debug("MPD representation has unsupported codec. Skipping stream id [%s] (mimeType=[%s], codecs=[%s])",b.id,b.mimeType,b.codecs),null;var d=h(a,"bandwidth");b.bandwidth=d?parseInt(d,10):null;var e=h(a,"height");b.height=e?parseInt(e,10):null;var f=i(a,"SegmentTemplate");return f&&(b.timescale=parseInt(h(f,"timescale")),b.media=h(f,"media"),b.startNumber=parseInt(h(f,"startNumber")),b.duration=parseInt(h(f,"duration")),b.initialization=h(f,"initialization")),b}.call(this,q.item(r));s&&this.representations.push(s)}}.call(this)}function e(a){if(!a)return null;var b=/^(-)?P(?:(-?[0-9,.]*)Y)?(?:(-?[0-9,.]*)M)?(?:(-?[0-9,.]*)W)?(?:(-?[0-9,.]*)D)?(?:T(?:(-?[0-9,.]*)H)?(?:(-?[0-9,.]*)M)?(?:(-?[0-9,.]*)S)?)?$/.exec(a);if(b){var c="-"===b[1]?-1:1,d={year:f(b[2],c),month:f(b[3],c),week:f(b[4],c),day:f(b[5],c),hour:f(b[6],c),minute:f(b[7],c),second:f(b[8],c)};return d.totalMillis=1e3*(d.second+60*(d.minute+60*(d.hour+24*d.day))),d}return null}function f(a,b){var c=a&&parseFloat(a.replace(",","."));return(isNaN(c)?0:c)*b}function g(a){if(!a)return null;var b=new Date;return b.setTime(Date.parse(a)),b}function h(a,b){var c=a.attributes.getNamedItem(b);return c?c.value:null}function i(a,b){for(var c=0;c<a.childNodes.length;c++){var d=a.childNodes.item(c);if(d.nodeName===b)return d}return null}return d.prototype.toString=function(){return"Mpd [minBufferTime="+this.minBufferTime+", type="+this.type+", publishTime="+this.publishTime+", availabilityStartTime="+this.availabilityStartTime+", timeShiftBufferDepth="+this.timeShiftBufferDepth+", suggestedPresentationDelay="+this.suggestedPresentationDelay+", minimumUpdatePeriod="+this.minimumUpdatePeriod+", maxSegmentDuration="+this.maxSegmentDuration+", profiles="+this.profiles+", moreInfoUrl="+this.moreInfoUrl+", programInfoTitle="+this.programInfoTitle+", representations="+JSON.stringify(this.representations)+"]"},d}.apply(b,d))&&(a.exports=e)},function(a,b,c){var d,e;d=[c(1),c(0)],void 0!==(e=function(a,b){"use strict";function c(c,e,f){b.isStringNotEmpty(f,"M3u8VariantPlaylistString"),b.isStringNotEmpty(e,"name"),b.isObject(c,"logger"),this._rawM3u8VariantPlaylist=f,this._name=e,this._logger=c,function(b){var c=b.match(/[^\r\n]+/g),e=this;return a.forEach(c,function(b,f){var g=b.match(/(?!#)EXT.+?(?=[:\n\r])/),h=a.get(g,["0"],null),i=b.trim().substring(h?h.length+2:0,b.length);switch(h){case"EXT-X-STREAM-INF":e.streamVariants=e.streamVariants||[];var j=[i,c[f+1]];e.streamVariants.push(function(b){var c=(function(b){var c=a.get(b.match(/(?:CODECS=).*?",/),["0"],""),d=a.get(c.split("="),["1"],"");return d.substring(1,d.length-2)}(b[0])||"").split(","),e=(d(b[0],"FRAME-RATE")||"").trim();return{programId:d(b[0],"PROGRAM-ID"),codecs:c,bandwidth:parseInt(d(b[0],"BANDWIDTH")),averageBandwidth:parseInt(d(b[0],"AVERAGE-BANDWIDTH")),frameRate:parseInt(parseInt(e)||0),name:a.get(b,["1"],"").trim()}}(j));break;case"EXT-X-ALLOW-CACHE":e.allowCache="YES"===i;break;case"#EXT-X-COMBINED":e.combined="YES"===i;break;case"EXTM3U":case null:break;default:return e._logger.debug("[%s] [Variant] Playlist unsupported key type [%s]",e._name,h)}}),e}.call(this,this._rawM3u8VariantPlaylist)}function d(b,c){var d=new RegExp("(?:"+c+"=).*?(?=[,\n\r])"),e=new RegExp("(?:"+c+"=).*?$"),f=a.get(b.match(d)||b.match(e),["0"],"");return a.get(f.split("="),["1"])}return c.prototype.toString=function(){return"M3u8VariantPlaylist[name="+this._name+",numberOfStreamVariants="+this.streamVariants.length+"]"},c}.apply(b,d))&&(a.exports=e)},function(a,b,c){var d,e;d=[c(1),c(0),c(8)],void 0!==(e=function(a,b,c){"use strict";function d(a){b.isObject(a,"logger"),this._logger=a,this._currentRequestId=0,this._requests={}}function e(b,c,d,j,k){k=k||1;var l=this,m=a.get(c,["delay"],null),n=a.get(c,["retryOptions","delay"],g),o=a.get(c,["retryOptions","backoff"],i),p=a.get(c,["retryOptions","maxAttempts"],h),q=k>1?n*Math.pow(k,o):m,r=a.now(),s=function(f,g){return f&&k<=p?(r=a.now(),e.call(l,b,c,d,j,k+1)):j(f,{requestTime:a.now()-r,data:g})};return a.isNumber(m)||1!==k?(r+=m,void function(a,b,c,d,e){var g=this;this._requests[c]=setTimeout(function(){f.call(g,a,b,c,e)},d)}.call(l,b,c,d,q,s)):f.call(l,b,c,d,s)}function f(a,b,d,e){var f=this;c.get(a,b,function(b,c){return f._requests[d]?(b&&f._logger.debug("Status code: [%s] (status text: [%s]) for get [%s]",b.code,b.message,a),void e(b,c)):f._logger.debug("Request handler disposed of before response received for get [%s]",a)})}var g=0,h=1,i=1;return d.prototype.toString=function(){return"HttpRequestManager"},d.prototype.disposePendingRequests=function(){a.forOwn(this._requests,function(b){a.isNumber(b)&&clearTimeout(b)}),this._requests={}},d.prototype.dispose=function(){this.disposePendingRequests(),this._currentRequestId=0},d.prototype.getWithRetry=function(a,c,d){b.isStringNotEmpty(a,"url"),b.isObject(c,"options"),b.isFunction(d,"callback");var f=this._currentRequestId++,g=this;this._requests[f]=!0,e.call(this,a,c,f,function(a,b){return delete g._requests[f],d(a,b)})},d}.apply(b,d))&&(a.exports=e)},function(a,b,c){var d,e;d=[c(1),c(0),c(2),c(3),c(7),c(14),c(4),c(9),c(23)],void 0!==(e=function(a,b,c,d,e,f,g,h,i){"use strict";function j(j,l,m,n,o){b.isInstanceOf(l,g,"playlist"),b.isNotUndefined(m,"videoElement"),b.isNotUndefined(m.videoWidth,"videoElement.videoWidth"),b.isNotUndefined(n,"playlistChunkFeeder"),b.isInstanceOf(n,h,"playlistChunkFeeder"),a.isUndefined(a.get(o,"bandwidthToStartAt"))||b.isNumber(o.bandwidthToStartAt,"options.bandwidthToStartAt"),a.isUndefined(a.get(o,"trackRestrictions"))||b.isObject(o.trackRestrictions,"options.trackRestrictions"),a.isUndefined(a.get(o,"bufferSizeToPauseFetch"))||b.isNumber(o.bufferSizeToPauseFetch,"options.bufferSizeToPauseFetch"),a.isUndefined(a.get(o,"bufferSizeToResumeFetch"))||b.isNumber(o.bufferSizeToResumeFetch,"options.bufferSizeToResumeFetch"),a.isUndefined(a.get(o,"maximumFastForwardFrequency"))||b.isNumber(o.maximumFastForwardFrequency,"options.maximumFastForwardFrequency"),a.isUndefined(a.get(o,"playbackRateToRecover"))||b.isNumber(o.playbackRateToRecover,"options.playbackRateToRecover");var p=this;this._options=o,this._videoElement=m,this._feeder=n,this._playlist=l,this._disposables=new e.DisposableList,this._logger=j||new c.Logger,this._bandwidthLimit=a.get(o,"bandwidthToStartAt",t),this._trackRestrictions=a.get(o,"trackRestrictions",{}),this._bufferSizeToPauseFetch=a.get(o,"bufferSizeToPauseFetch",u),this._bufferSizeToResumeFetch=a.get(o,"bufferSizeToResumeFetch",v),this._targetBufferSize=a.get(o,"targetBufferSize",x),this._maximumFastForwardFrequency=a.get(o,"maximumFastForwardFrequency",z),this._playbackRateToRecover=a.get(o,"playbackRateToRecover",y),this._playbackStarted=!1,this._isWaiting=!1,this._bufferStats=[],this._browserDetails=new f(window.navigator.userAgent).detect(),function(){var b=this,c=a.get(this._playlist,["parsedPlaylist","contentProtectionTags"],[]);if(0!==c.length)return i.isSupported()?(this._encryptedMediaHandler=new i(this._logger,this._videoElement,c,a.get(this._options,"drm")),this._encryptedMediaHandler.addEventListener("error",function(a){b._playerErrorEvent.fire([a])}),this._encryptedMediaHandler.addEventListener("trackRestrictionsAvailable",function(c){a.keys(c).length>0&&(b._trackRestrictions=c,k.call(b),b._videoElement.play())}),this._disposables.add(this._encryptedMediaHandler),void 0):this._logger.error("DRM not supported by the browser")}.call(this),this._playbackStarted=!1,this._mediaSourceBuffers={},this._bufferDetails={},this._playbackTimeLeftEvent=new d.Event,this._playerStartedEvent=new d.Event,this._playerErrorEvent=new d.Event,this._disposables.add(this._feeder),this._disposables.add(this._playbackTimeLeftEvent),this._disposables.add(this._playerStartedEvent),this._disposables.add(this._playerErrorEvent),this._disposables.add(new e.Disposable(function(){null!==p._switchTrackDisposable&&window.clearTimeout(p._switchTrackDisposable)}))}function k(){var a=this._playlist.getPlaylistTracksByBandwidthPerMimeType(this._bandwidthLimit,this._trackRestrictions);return this._feeder.setActiveTracks(a),a}function l(b){var c=this._videoElement.currentTime,d=this._videoElement.duration,e=m(b,c),f=a.isNumber(e)?b.buffered.end(e):0,g=0===f?0:f-c;return{bufferedLength:b.buffered.length,current:c,bufferEnd:f,timeBufferedButNotPlayed:g,duration:d,timestampOffset:b.timestampOffset}}function m(a,b){for(var c=0;c<a.buffered.length;c++){var d=a.buffered.start(c),e=a.buffered.end(c);if(d<=b&&b<=e)return c}}function n(){var b=!0,c=!1;a.forOwn(this._mediaSourceBuffers,a.bind(function(a){var d=l.call(this,a.buffer),e=parseFloat(d.timeBufferedButNotPlayed);e<this._bufferSizeToPauseFetch&&(b=!1),e<this._bufferSizeToResumeFetch&&(c=!0)},this)),b&&this._feeder.isFetchingData()&&(this._logger.debug("Pausing feeder due to excess buffer"),D.call(this)),c&&!this._feeder.isFetchingData()&&(this._logger.debug("Starting feeder due to limited buffer"),E.call(this))}function o(a,b){var c=this._mediaSourceBuffers[r(a)],d=this._bufferDetails[s(a)];if(d.chunks.length>0){if(this._videoElement.error)return this._logger.error("Unable to continue appending to buffer. Video element error code [%s] and message [%s]",this._videoElement.error.code,this._videoElement.error.message),D.call(this),this._playerErrorEvent.fire([this._videoElement.error]);var e=d.chunks.shift();this._logger.debug("Appending chunk to buffer for track [%s]",a.getTrackId()),c.buffer.appendBuffer(new Uint8Array(e))}else b&&(n.call(this),d.chunkAddRequested=!0)}function p(b){var c=this._mediaSourceBuffers[r(b)],d=a.bind(function(a){this._logger.warn("Buffer Error [%s]",a)},this),e=!!c.track;if(c.track!==b){var f=this._bufferDetails[s(b)];if(c.track&&c.track!==b&&e&&(c.buffer.removeEventListener("updateend",c.updateEndListener),c.buffer.removeEventListener("error",d),f&&(f.addInitChunkFirst=!0,f.chunkAddRequested=!0,f.chunks=[])),c.track=b,c.updateEndListener=a.bind(c.updateEnd,this,b),c.buffer.addEventListener("updateend",c.updateEndListener),c.buffer.addEventListener("error",d),c.buffer.onerror=d,!e){var g="Dash"===this._playlist.getDeliveryType()?[b.getInitChunkData()]:[];f.chunks=[].concat(g,a.map(b.getChunks(),function(a){return a.data})),"static"===this._playlist.getType()&&"Edge"!==this._browserDetails.browser&&"IE"!==this._browserDetails.browser&&this._mediaSource.setLiveSeekableRange(0,this._playlist.getTotalMediaTimeInMillis()/1e3),o.call(this,b,!1)}}}function q(b){this._logger.debug("Creating MSE buffers for all tracks."),a.forEach(b,a.bind(function(b){(function(b){var c=this,d={track:b,chunks:[],chunkAddRequested:!1},f=r(b),g=!a.includes(a.keys(c._mediaSourceBuffers),f),h=g?c._mediaSource.addSourceBuffer(b.getMseCodec()):c._mediaSourceBuffers[f].buffer,i=s(b);c._bufferDetails[i]=d,g&&(h.mode="segments","static"===c._playlist.getType()&&(h.appendWindowEnd=c._playlist.getTotalMediaTimeInMillis()/1e3),c._logger.debug("Creating MSE Buffer for [%s] with mode [%s]",c._playlist.getType(),h.mode),c._mediaSourceBuffers[f]={buffer:h,updateEnd:function(a){h.updating||o.call(this,a,!0)}},c._disposables.add(new e.Disposable(function(){c._logger.debug("Cleaning up sourceBuffer [%s]",f),c._mediaSource.removeSourceBuffer(h)})));var j=b.addEventListener("chunkadded",a.bind(function(b,e){d.addInitChunkFirst&&"Dash"===c._playlist.getDeliveryType()&&(d.addInitChunkFirst=!1,this._logger.debug("Pushing track [%s] chunk [%s] into buffer",b.getTrackId(),"Init"),d.chunks.push(b.getInitChunkData())),this._logger.debug("Pushing track [%s] chunk [%s] into buffer",b.getTrackId(),e.chunkId),d.chunks.push(e.data),d.chunkAddRequested&&(d.chunkAddRequested=!1,h.updating||o.call(this,b,!1));var f=a.now()-this._lastUpdate>=w,g=a.now()-this._lastPlayAttempt>=500;this._isWaiting&&f&&g&&!this._videoElement.paused&&(this._logger.trace("Starting after wait [%s]",a.now()-this._lastUpdate),this._lastPlayAttempt=a.now(),this._videoElement.play())},c,b));c._disposables.add(j)}).call(this,b)},this))}function r(a){return a.getMseCodec().indexOf("video")>=0?"video":a.getMseCodec().indexOf("audio")>=0?"audio":"other"}function s(a){return a.getTrackId()+"_"+a.getMseCodec()}var t=2e6,u=60,v=30,w=1e3,x=5,y=1.03,z=300,A=300,B=2,C=3e5;j.prototype.toString=function(){return a.toString(this)},j.prototype.dispose=function(){this._disposables.dispose(),this._videoElement&&(this._videoElement.load(),this._videoElement.src="",this._videoElement.mediaKeys&&this._videoElement.setMediaKeys(null)),this._playbackStarted=!1,this._mediaSourceBuffers={},this._bufferDetails={},this._bufferStats=[],this._mediaSource=null,this._playlist=null,this._videoElement=null},j.prototype.start=function(){(function(){var b=this;b._mediaSource=new MediaSource;var c=function(){(function(){var b=this,c=k.call(this),d=b._playlist.getAllPlaylistTracks().sort(function(a,b){return-1*(a.getBandwidth()-b.getBandwidth())}),f=a.filter(d,function(b){return!a.includes(c,b)});if(this._logger.info("Initializing feeder with [%s] [%s] playlist of duration [%s]",b._playlist.getType(),b._playlist.getDeliveryType(),b._playlist.getTotalMediaTimeInMillis()/1e3),"static"===b._playlist.getType())b._mediaSource.duration=b._playlist.getTotalMediaTimeInMillis()/1e3;else if("Hls"===b._playlist.getDeliveryType()){b._mediaSource.duration=1/0;var g=a.reduce(c,function(b,c){var d=a.get(c.getLastSegment(),["timestamp"],0);return a.isNullOrUndefined(b)?d:d<b?d:b})||0;b._feeder.seekToChunk(g)}this._logger.debug("Loading tracks: numberOfTracksToInitialize=[%s], all tracks: [%s]",c.length,d),this._feeder.initialize(c,f,function(){q.call(b,c);var d=k.call(b);a.forEach(d,function(a){p.call(b,a)}),function(){var b=this,c=a.bind(function(){this._isWaiting=!1,this._lastUpdate=a.now();var b;a.forOwn(this._mediaSourceBuffers,a.bind(function(a){var c=l.call(this,a.buffer);(!b||b>c.timeBufferedButNotPlayed)&&(b=c.timeBufferedButNotPlayed),this._playbackTimeLeftEvent.fire([c.timeBufferedButNotPlayed,a.track],this)},this)),n.call(this),function(b){this._bufferStats.push({size:b,timestamp:a.now()});for(var c=a.get(this._bufferStats,[0,"timestamp"],a.now());a.now()-c>C;)this._bufferStats.shift(),c=a.get(this._bufferStats,[0,"timestamp"],a.now());this._bufferStatsMin=Math.min.apply(null,a.map(this._bufferStats,function(a){return a.size}))}.call(this,b),function(b){if("Dash"===this._playlist.getDeliveryType()||"dynamic"===this._playlist.getType()){var c=this._targetBufferSize+.5,d=this._lastPlaybackRateChange,e=a.now()-this._startTime>A,f=!d||a.now()-d>1e3*this._maximumFastForwardFrequency,g=this._bufferStatsMin>B;b>=c&&1===this._videoElement.playbackRate&&e&&f&&g?(this._logger.info("Adjusting playback rate to [%s] to reduce buffer size from [%s] with minimum buffer size of [%s]",this._playbackRateToRecover,b,this._bufferStatsMin),this._videoElement.playbackRate=this._playbackRateToRecover):g||1===this._videoElement.playbackRate||(this._logger.info("Resuming normal playback rate with buffer size of [%s] and minimum buffer size of [%s]",b,this._bufferStatsMin),this._videoElement.playbackRate=1,this._lastPlaybackRateChange=a.now())}}.call(this,b||0)},b),d=function(a,c,d){b._logger.debug("VIDEO EVENT: [%s]",a),c&&c.call(b,d)},f=a.bind(d,b,"stalled",null),g=a.bind(d,b,"suspend",null),h=a.bind(d,b,"ended",null),i=a.bind(d,b,"error",null),j=a.bind(d,b,"pause",null),k=a.bind(d,b,"play",null),o=a.bind(d,b,"waiting",function(){this._playbackStarted&&(this._logger.debug("Waiting for new chunk or end of track"),this._isWaiting=!0)}),p=a.bind(d,b,"seeking",function(b){var c=a.keys(this._mediaSourceBuffers),d=a.get(c,"0",null),e=this._mediaSourceBuffers[d],f=this;if(e&&this._ready&&"Hls"!==this._playlist.getDeliveryType()){var g=m(e.buffer,b.timeStamp/1e3),h=m(e.buffer,this._videoElement.currentTime),i=a.reduce(this._mediaSourceBuffers,function(b,c){var d=m(c.buffer,f._videoElement.currentTime),e=a.isNumber(d)?c.buffer.buffered.end(d):0;return b?e<b?e:b:e})||this._videoElement.currentTime;if(this._feeder.stopRequestingAllData(),this._logger.debug("Pausing of feeder completed."),this._feeder.seekToChunk("dynamic"===this._playlist.getType()?this._videoElement.currentTime:i),g!==h||a.isNullOrUndefined(h)){if(this._feeder.isFetchingData())return;this._feeder.startRequestingDataForActiveTracks(this._bandwidthLimit)}}}),q=a.bind(d,b,"durationchange",function(){return"dynamic"!==b._playlist.getType()?(b._videoElement.removeEventListener("durationchange",q,!1),b._ready=!0):void(0!==a.get(b,["_videoElement","buffered","length"],0)&&function(a){var b=this;setTimeout(function(){if(b._videoElement.currentTime<b._videoElement.buffered.start(b._videoElement.buffered.length-1)){var c=b._videoElement.buffered.end(b._videoElement.buffered.length-1);b._videoElement.currentTime=c>0?c:0}b._videoElement.currentTime>=b._videoElement.buffered.start(b._videoElement.buffered.length-1)&&(b._ready=!0,a())},10)}.call(b,function(){b._videoElement.removeEventListener("durationchange",q,!1)}))});b._videoElement.addEventListener("timeupdate",c,!1),b._videoElement.addEventListener("ended",h,!1),b._videoElement.addEventListener("error",i,!1),b._videoElement.addEventListener("pause",j,!1),b._videoElement.addEventListener("stalled",f,!1),b._videoElement.addEventListener("suspend",g,!1),b._videoElement.addEventListener("play",k,!1),b._videoElement.addEventListener("waiting",o,!1),b._videoElement.addEventListener("seeking",p,!1),b._videoElement.addEventListener("durationchange",q,!1),b._disposables.add(new e.Disposable(function(){b._logger.debug("Cleaning up videoElement listeners"),b._videoElement.removeEventListener("timeupdate",c,!1),b._videoElement.removeEventListener("ended",h,!1),b._videoElement.removeEventListener("error",i,!1),b._videoElement.removeEventListener("pause",j,!1),b._videoElement.removeEventListener("stalled",f,!1),b._videoElement.removeEventListener("suspend",g,!1),b._videoElement.removeEventListener("play",k,!1),b._videoElement.removeEventListener("waiting",o,!1),b._videoElement.removeEventListener("seeking",p,!1),b._videoElement.removeEventListener("durationchange",q,!1)})),E.call(b),b._lastPlayAttempt=a.now(),"Edge"===this._browserDetails.browser||"IE"===this._browserDetails.browser?(b._videoElement.play(),b._playbackStarted=!0,b._playerStartedEvent.fireAsync([],this),b._logger.debug("Playback Started")):b._videoElement.play().then(function(){b._playbackStarted=!0,b._playerStartedEvent.fireAsync([],this),b._logger.debug("Playback Started")})["catch"](function(a){b._logger.error("Playback Failed [%s]",a)})}.call(b)},function(){"Hls"!==b._playlist.getDeliveryType()&&q.call(b,f)},function(a){return b._logger.error("Unable to initialize playlist chunk feeder",a),b._playerErrorEvent.fire([a])})}).call(b)};b._mediaSource.addEventListener("sourceopen",c),b._disposables.add(new e.Disposable(function(){b._logger.debug("Cleaning up sourceopen listener"),b._mediaSource.removeEventListener("sourceopen",c)})),b._videoElement.src=window.URL.createObjectURL(b._mediaSource)}).call(this),this._startTime=a.now()},j.prototype.getBandwidthLimit=function(){return this._bandwidthLimit},j.prototype.getTimeLeft=function(){return this._videoElement?l.call(this,this._videoElement).timeBufferedButNotPlayed:0},j.prototype.changeBandwidthLimit=function(b,c){this._logger.debug("Changing playback bandwidth limit: [%s], current limit: [%s]",b,this._bandwidthLimit),this._bandwidthLimit=b,this._switchTrackDisposable=setTimeout(a.bind(function(b){var c=this,d=this._feeder.getActiveTracks(),e=k.call(this),f=a.filter(e,function(b){return!a.find(d,function(a){return a.getTrackId()===b.getTrackId()})});a.forEach(f,function(a){p.call(c,a),c._logger.info("Switched [%s] to track [%s] with [%s] bandwidth limit",r(a),a.getTrackId(),c._bandwidthLimit)});var g=a.reduce(e,function(b,d){var e=c._mediaSourceBuffers[r(d)],f=m(e.buffer,c._videoElement.currentTime),g=d.getChunkDuration()/1e3;if(!a.isNumber(f))return b;var h=Math.round(e.buffer.buffered.end(f)/g)*g;return!a.isNumber(b)||b>h?h:b});a.isNumber(g)||(g=c._videoElement.currentTime),this._feeder.stopRequestingAllData(),this._feeder.seekToChunk(g),this._logger.debug("Pausing of feeder completed."),this._feeder.isFetchingData()||(this._feeder.startRequestingDataForActiveTracks(this._bandwidthLimit),b())},this,c||a.noop),250)},j.prototype.addEventListener=function(c,d){switch(b.isString(c,"eventName"),b.isFunction(d,"listener"),c){case"playbacktimeleft":return this._playbackTimeLeftEvent.listen(d);case"started":var e=this._playerStartedEvent.listen(d);return this._playbackStarted&&setTimeout(a.bind(d,this),0),e;case"error":return this._playerErrorEvent.listen(d);default:throw new Error('Event "'+c+'" is unknown.')}};var D=function(){this._feeder.stopRequestingAllData(),this._logger.debug("Pausing of feeder completed.")},E=function(){return this._feeder.isFetchingData()?this._logger.debug("Unable to start requesting data. Feeder is already fetching data."):void this._feeder.startRequestingDataForActiveTracks()};return j}.apply(b,d))&&(a.exports=e)},function(a,b,c){var d,e;d=[c(22)],void 0!==(e=function(a){return a}.apply(b,d))&&(a.exports=e)},function(a,b,c){"use strict";var d,e;d=[c(4),c(20),c(21),c(13),c(6),c(24)],void 0!==(e=function(a,b,c,d,e,f){return{Playlist:a,MpdPlaylistChunkFeeder:b,M3u8PlaylistChunkFeeder:c,WebPlayer:d,StatsProvider:e,AdaptiveStreamingManager:f,isSupported:!!window.MediaSource}}.apply(b,d))&&(a.exports=e)},function(a,b,c){var d,e;d=[c(0),c(3),c(2),c(5)],void 0!==(e=function(a,b,c,d){"use strict";function e(d,e,h){if(a.isObject(d,"logger"),a.isObject(e,"playlistTrackConfig"),a.isStringNotEmpty(e.codec,"playlistTrackConfig.codec"),a.isStringNotEmpty(e.mimeType,"playlistTrackConfig.mimeType"),a.isNumber(e.bandwidth,"playlistTrackConfig.bandwidth"),a.isNumber(e.chunkDuration,"playlistTrackConfig.chunkDuration"),a.isStringNotEmpty(e.trackId,"playlistTrackConfig.trackId"),a.isStringNotEmpty(e.initUrl,"playlistTrackConfig.initUrl"),a.isStringNotEmpty(e.dataChunkUrlTemplate,"playlistTrackConfig.dataChunkUrlTemplate"),a.isNumber(e.chunkDuration,"playlistTrackConfig.chunkDuration"),h=h||{},this._logger=d||new c.Logger,this._mseCodec=e.codec,this._chunkDuration=e.chunkDuration,this._bandwidth=e.bandwidth,this._height=e.height,this._trackId=e.trackId,this._mimeType=e.mimeType,this._initUrl=e.initUrl,this._dataChunkUrlTemplate=e.dataChunkUrlTemplate,this._totalNumberOfChunks=e.totalNumberOfChunks,this._currentChunkId=null,this._maxChunksToCache=h.maxChunksToCache||f,this._lowWaterMaxChunks=h.lowWaterMaxChunks||g,a.isNumber(this._maxChunksToCache,"options.maxChunksToCache"),a.isNumber(this._lowWaterMaxChunks,"options.lowWaterMaxChunks"),this._lowWaterMaxChunks>=this._maxChunksToCache)throw new Error('The "maxChunksToCache" cannot be less than or equal to the "lowWaterMaxChunks"');this._initChunk=null,this._dataChunks=[],this._chunkAddedEvent=new b.Event}var f=20,g=15;return e.prototype=Object.create(d.prototype),e.prototype.constructor=e,e.prototype.toString=function(){return"MpdPlaylistTrack [mseCodec="+this._mseCodec+", maxChunksToCache="+this._maxChunksToCache+", lowWaterMaxChunks="+this._lowWaterMaxChunks+", initChunk="+this._initChunk+", dataChunks(size)="+this._dataChunks.length+", chunkAddedEvent(size)="+this._chunkAddedEvent.size()+", trackId="+(this._trackId?this._trackId:"n/a")+", bandwidth="+(this.bandwidth?this.bandwidth:"n/a")+"]"},e.prototype.dispose=function(){this._dataChunks=[],this._chunkAddedEvent.dispose()},e.prototype.getMseCodec=function(){return this._mseCodec},e.prototype.getTrackId=function(){return this._trackId},e.prototype.getChunkDuration=function(){return this._chunkDuration},e.prototype.getBandwidth=function(){return this._bandwidth},e.prototype.getHeight=function(){return this._height},e.prototype.getMimeType=function(){return this._mimeType},e.prototype.getTotalNumberOfChunks=function(){return this._totalNumberOfChunks},e.prototype.getInitChunkData=function(){return this._initChunk},e.prototype.setInitChunkData=function(a){this._initChunk=a},e.prototype.getCurrentChunkId=function(){return this._currentChunkId},e.prototype.setCurrentChunkId=function(a){this._currentChunkId=a},e.prototype.incrementCurrentChunkId=function(){null===this._currentChunkId&&this._logger.error("[%s] Attempting to increment `CurrentChunkId` that is not initialized",this._trackId),this._currentChunkId++},e.prototype.getInitUrl=function(){return this._initUrl},e.prototype.getDataChunkUrlTemplate=function(){return this._dataChunkUrlTemplate},e.prototype.addDataChunk=function(b,c,d){a.isNotUndefined(b,"dataChunk"),d=d||function(){},a.isFunction(d,"eventCallback");var e={data:b,chunkId:c,timestamp:c*this._chunkDuration/1e3};if(this._dataChunks.push(e),this._dataChunks.length>this._maxChunksToCache)for(;this._dataChunks.length>this._lowWaterMaxChunks;)this._dataChunks.shift();this._chunkAddedEvent.fireAsync([e],this,d)},e.prototype.getChunks=function(){return this._dataChunks},e.prototype.addEventListener=function(b,c){if(a.isString(b,"eventName"),a.isFunction(c,"listener"),"chunkadded"!==b)throw new Error('Event "'+b+'" is unknown.');return this._chunkAddedEvent.listen(c)},e}.apply(b,d))&&(a.exports=e)},function(a,b,c){var d,e;d=[c(1),c(0),c(3),c(2),c(5),c(18)],void 0!==(e=function(a,b,c,d,e,f){"use strict";function g(e,f,g){if(b.isObject(e,"logger"),b.isObject(f,"playlistTrackConfig"),b.isStringNotEmpty(f.codecs,"playlistTrackConfig.codecs"),b.isNumber(f.bandwidth,"playlistTrackConfig.bandwidth"),b.isStringNotEmpty(f.trackId,"playlistTrackConfig.trackId"),g=g||{},this._logger=e||new d.Logger,this._mseCodec=function(a){return a.split("|").length>1?"video/mp4":"audio/mp4"}(f.codecs),this._bandwidth=f.bandwidth,this._height=f.height,this._trackId=f.trackId,this._mimeType=f.mimeType,this._totalNumberOfChunks=f.totalNumberOfChunks,this._mediaSegments=[],this._isComplete=!1,this._playableDuration=0,this._mediaSegmentPlaylistUrlInfo=function(b){var c=b.split("?")[0],d=a.get(b.split("?"),[1],""),e=a.reduce(d.split("&"),function(a,b){var c=b.split("=")[0];return c&&(a[c]=b.split("=")[1]),a},{});return{url:c,queryParameters:e}}(f.mediaSegmentPlaylistUrl),this._currentChunkId=null,this._maxChunksToCache=g.maxChunksToCache||h,this._lowWaterMaxChunks=g.lowWaterMaxChunks||i,b.isNumber(this._maxChunksToCache,"options.maxChunksToCache"),b.isNumber(this._lowWaterMaxChunks,"options.lowWaterMaxChunks"),this._lowWaterMaxChunks>=this._maxChunksToCache)throw new Error('The "maxChunksToCache" cannot be less than or equal to the "lowWaterMaxChunks"');this._initChunk=null,this._dataChunks=[],this._chunkAddedEvent=new c.Event,this._segmentsReadyEvent=new c.Event}var h=20,i=15;return g.prototype=Object.create(e.prototype),g.prototype.constructor=g,g.prototype.toString=function(){return"M3u8PlaylistTrack"},g.prototype.dispose=function(){this._dataChunks=[],this._chunkAddedEvent.dispose()},g.prototype.getMseCodec=function(){return this._mseCodec},g.prototype.getTrackId=function(){return this._trackId},g.prototype.getChunkDuration=function(){return this._chunkDuration},g.prototype.getBandwidth=function(){return this._bandwidth},g.prototype.getHeight=function(){return this._height},g.prototype.getMimeType=function(){return this._mimeType},g.prototype.getTotalNumberOfChunks=function(){return this._totalNumberOfChunks},g.prototype.getPlayableDuration=function(){return this._playableDuration},g.prototype.isComplete=function(){return this._isComplete},g.prototype.hasSegments=function(){return this._mediaSegments.length>0},g.prototype.getSegmentByTimestamp=function(b){return a.find(this._mediaSegments,function(a){return a.timestamp<=b&&b<a.timestamp+a.duration})},g.prototype.getLastSegment=function(){return a.get(this._mediaSegments,[this._mediaSegments.length-1],null)},g.prototype.getMediaSegmentPlaylistUrlInfo=function(){return this._mediaSegmentPlaylistUrlInfo},g.prototype.getClosestSegmentNotGreaterThanTimestamp=function(a){return a>this._playableDuration?this._mediaSegments[this._mediaSegments.length-1]:this.getSegmentByTimestamp(a)},g.prototype.isLastMediaSegment=function(b){var c=this.getSegmentByTimestamp(b),d=!this._isComplete&&a.get(c,["timestamp"],0)+a.get(c,["duration"],0)===this._playableDuration,e=!this._isComplete&&b>this._playableDuration;return this._playableDuration===b||d||e},g.prototype.updateMediaSegments=function(b){var c=new f(this._logger,this._trackId,b),d=this._totalNumberOfChunks||0,e=a.map(this._mediaSegments,function(a){return a.name}),g=this,h=a.get(this._mediaSegments,[this._mediaSegments.length-1]),i=a.get(h,["timestamp"])+a.get(h,["duration"])||void 0;a.forEach(c.mediaSegments,function(b){a.includes(e,b.name)||(b.timestamp=a.isUndefined(i)?0:i,g._mediaSegments.push(b),g._playableDuration+=b.duration,i=b.timestamp+b.duration,g._logger.trace("[%s]:[%s]:[%s] Got new segment from playlist [%s]",(new Date).getHours(),(new Date).getMinutes(),(new Date).getSeconds(),b.name))}),d!==this._mediaSegments.length&&(this._isComplete=c.isComplete,this._totalNumberOfChunks=this._mediaSegments.length,this._segmentsReadyEvent.fireAsync([this._mediaSegments],null,a.noop))},g.prototype.addDataChunk=function(a,c,d){b.isNotUndefined(a,"dataChunk"),d=d||function(){},b.isFunction(d,"eventCallback");var e={data:a,chunkId:c,timestamp:c*this._chunkDuration/1e3};if(this._dataChunks.push(e),this._dataChunks.length>this._maxChunksToCache)for(;this._dataChunks.length>this._lowWaterMaxChunks;)this._dataChunks.shift();this._chunkAddedEvent.fireAsync([e],this,d)},g.prototype.getChunks=function(){return this._dataChunks},g.prototype.addEventListener=function(a,c){switch(b.isString(a,"eventName"),b.isFunction(c,"listener"),a){case"chunkadded":return this._chunkAddedEvent.listen(c);case"segmentsready":return this._segmentsReadyEvent.listen(c);default:throw new Error('Event "'+a+'" is unknown.')}},g}.apply(b,d))&&(a.exports=e)},function(a,b,c){var d,e;d=[c(1),c(0)],void 0!==(e=function(a,b){"use strict";function c(c,e,f){b.isStringNotEmpty(f,"m3u8String"),b.isObject(c,"logger"),this._rawM3U8=f,this._logger=c,this._name=e,this.mediaSegments=[],function(b){var c=b.match(/[^\r\n]+/g),e=this;return a.forEach(c,function(b,f){var g=b.match(/(?!#)EXT.+?(?=[:\n\r])/),h=a.get(g,["0"],null),i=b.trim().substring(h?h.length+2:0,b.length);switch("#EXT-X-ENDLIST"===b&&(h="EXT-X-ENDLIST"),h){case"EXT-X-VERSION":e.version=parseFloat(i);break;case"EXT-X-PROGRAM-DATE-TIME":e.programDateTime=function(a){return a?new Date(a.trim()):null}(i);break;case"EXT-X-TARGETDURATION":e.targetDuration=1e3*parseFloat(i)||0;break;case"EXT-X-MEDIA-SEQUENCE":e.mediaSequence=parseInt(i);break;case"EXTINF":var j=[i,c[f+1]];e.mediaSegments.push(d(j,e.mediaSegments+1));break;case"EXT-X-ENDLIST":e.isComplete=!0;break;case"EXTM3U":case null:break;default:return e._logger.debug("[%s] [Segment] Playlist unsupported key type [%s]",e._name,h)}}),e}.call(this,this._rawM3U8);var g=0;a.forEach(this.mediaSegments,function(a){a.timestamp=g,g+=a.duration}),this.playableDuration=g,this.isComplete=!!this.isComplete}c.prototype.toString=function(){return"vod"};var d=function(b){var c=a.get(b,["0"],"").split(","),d=a.get(c,["0"],0),e=a.get(c,["1"],"").trim(),f=a.get(b,["1"],"").trim();
return{duration:parseFloat(d),title:e,name:f}};return c}.apply(b,d))&&(a.exports=e)},function(a,b,c){var d,e;d=[c(0)],void 0!==(e=function(a){"use strict";function b(){}return b.prototype.isCodecSupported=function(b){return a.isStringNotEmpty(b,"codec"),window.MediaSource&&"function"==typeof window.MediaSource.isTypeSupported&&window.MediaSource.isTypeSupported(b)},b.prototype.parseXml=function(b){if(a.isStringNotEmpty(b,"xmlString"),void 0!==window.DOMParser)return(new window.DOMParser).parseFromString(b,"text/xml");if(void 0!==window.ActiveXObject&&new window.ActiveXObject("Microsoft.XMLDOM")){var c=new window.ActiveXObject("Microsoft.XMLDOM");return c.async="false",c.loadXML(b),c}throw new Error("No XML parser found")},b.prototype.getMSECodec=function(b,c){return a.isStringNotEmpty(b,"mpdMimeType"),a.isStringNotEmpty(c,"mpdCodecs"),b+'; codecs="'+c+'"'},new b}.apply(b,d))&&(a.exports=e)},function(a,b,c){var d,e;d=[c(1),c(0),c(2),c(3),c(12),c(9),c(4),c(5),c(6),c(10)],void 0!==(e=function(a,b,c,d,e,f,g,h,i,j){"use strict";function k(d,f,h,k){b.isInstanceOf(f,g,"playlist"),b.isInstanceOf(f.parsedPlaylist,j,"playlist.parsedPlaylist"),b.isInstanceOf(h,i,"statsProvider"),b.isStringNotEmpty(f.playlistUrl,"playlist.playlistUrl"),b.isStringNotEmpty(f.baseUrl,"playlist.baseUrl"),k&&k.defaultPresentationDelay&&b.isNumber(k.defaultPresentationDelay,"options.defaultPresentationDelay"),this._playlist=f,this._baseUrl=this._playlist.baseUrl,this._statsProvider=h,this._logger=d||new c.Logger,this._httpRequestManager=new e(this._logger),this._activeTracks=[],this._currentPlaybackTimeInSeconds=0,this._keepFetchingData=!1,this._defaultPresentationDelay=a.get(k,"defaultPresentationDelay",u),this._bufferSize=Math.max(this._playlist.getSuggestedPresentationDelayTotalMillis(),this._playlist.getMinBufferTimeTotalMillis(),this._defaultPresentationDelay),this._streamDurationBeforeInitialization=Math.max(this._playlist.getPlaybackDurationSinceAvailable()-this._bufferSize,0)}function l(c,d,e,f){e=e||a.noop,b.isArray(c,"tracks"),b.isFunction(e,"done");var g=0,i=this;a.forEach(c,function(a){b.isInstanceOf(a,h,"track"),a.setCurrentChunkId(function(a){var b=Math.max(Math.floor(this._streamDurationBeforeInitialization/a),0);return"static"===this._playlist.getType()&&(b=0),this._logger.trace("Getting chunk index to start: [%s], playbackTimePassed=[%s], duration=[%s]",b,this._streamDurationBeforeInitialization,a),b}.call(i,a.getChunkDuration())),function(a,b,c){var d=this;(function(a,b){var c=this;c._logger.trace("Fetching init chunk for [%s]: [%s], nextChunkId=[%s]",a.getMseCodec(),c._baseUrl+a.getInitUrl(),a.getCurrentChunkId()),q.call(c,c._baseUrl+a.getInitUrl(),null,function(d,e){c._logger.trace("DONE Fetching init chunk for [%s]: [%s], nextChunkId=[%s]",a.getMseCodec(),c._baseUrl+a.getInitUrl(),a.getCurrentChunkId()+(d?": FAILED: "+d.code:": data="+e.data.byteLength)),b(d,e.data)})}).call(d,a,function(e,f){if(e){var g=new Error("Failed to fetch init chunk of stream for config [%s]",a);return g.cause=e,d._logger.error("[%s] (Cause: [%s])",g.message,e),c(g)}if(a.setInitChunkData(f),b){var h=Math.min(Math.floor(d._bufferSize/a.getChunkDuration),1);return d._logger.debug("Got init chunk: data chunksToFetch=[%s], initBufferSize=[%s], chunkDuration=[%s]",h,d._bufferSize,a.getChunkDuration()),p.call(d,a,h,null,c)}c()})}.call(i,a,d,function(a){return a?f(a):void(++g===c.length&&e())})})}function m(){var b=this;a.forEach(b._activeTracks,function(a){a.setCurrentChunkId(n.call(b,a.getChunkDuration()))})}function n(a){var b=a/1e3;return Math.floor(this._currentPlaybackTimeInSeconds/b)}function o(b){var c=this,d=c._activeTracks.length;a.forEach(c._activeTracks,function(e,f){!function(e,f){if(a.find(c._activeTracks,function(a){return a.getMimeType()===e.getMimeType()})===e){var g=n.call(c,e.getChunkDuration()),h=g>=e.getTotalNumberOfChunks();if("static"===c._playlist.getType()&&h)return f===d-1&&(c._keepFetchingData=!1),c._logger.info("Finished getting chunks for [static] track [%s] [%s]",e.getTrackId(),e.getMimeType());p.call(c,e,1,b,function(a){if(a&&a.causes&&a.causes.length>0&&"not yet available"===a.causes[0].feederReason?c._logger.info("Failed to get next chunk (packet not yet available) for [%s]|[%s]. Trying to fetch again in [%s] ms.",e.getMseCodec(),e.getBandwidth(),s):(a&&c._logger.warn("Failed to get next chunk (# of errors=[%s], errors=[%s]). Moving on.",a.causes?a.causes.length:"n/a",a),d--),d<=0&&(c._logger.debug("Done fetching chunk with index [%s] for each active track. Moving on to next chunk. (keep fetching=[%s])",g,c._keepFetchingData),c._keepFetchingData)){if("dynamic"===c._playlist.getType())return o.call(c,t);o.call(c,null)}})}}(e,f)})}function p(a,b,c,d){var e=this;(function(a,b,c){var d=this,e=function(a,b){return a.replace("$Number%05d$",("00000"+b).substr(-5))}(d._baseUrl+a.getDataChunkUrlTemplate(),a.getCurrentChunkId()),f=a.getCurrentChunkId();d._logger.trace("Fetching data chunk for [%s]: [%s], nextChunkId=[%s]",a.getMseCodec(),e,a.getCurrentChunkId());var g=a.getMseCodec();q.call(d,e,b,function(b,h){return d._logger.trace("DONE Fetching data chunk for [%s] : [%s], nextChunkId=[%s]",g,e,a.getCurrentChunkId()+(b?": FAILED: "+b.code:": data="+h.data.byteLength)),b||d._statsProvider.addRateDataPoint(g,h.requestTime,h.data.byteLength,.001),b||f!==a.getCurrentChunkId()?void(b?(b.feederReason=404===b.code?"not yet available":"other",c(b)):c(null,h.data)):(a.incrementCurrentChunkId(),d._currentPlaybackTimeInSeconds=a.getChunkDuration()*a.getCurrentChunkId()/1e3,a.addDataChunk(h.data,f,function(){c(b)}))})}).call(e,a,c,function(f){return f&&e._logger.trace('Failed to fetch data chunk of stream for config [%s]". Error: [%s]',a,f),!f&&b>1&&p.call(e,a,b,c,d),d(f)})}function q(b,c,d){var e=this,f={responseType:"arraybuffer",retryOptions:{delay:s,maxAttempts:r},timeout:v};if(a.isNumber(c)&&0!==c)f.delay=c;else if(!a.isNullOrUndefined(c))throw new Error('"delay" must be a positive number above 0 or null or undefined');return this._httpRequestManager.getWithRetry(b,f,function(a,c){a&&e._logger.debug("Failed to load next stream data chunk. Status code: [%s] (status text: [%s]) for [%s]",a.code,a.message,b),d(a,c)})}var r=15,s=400,t=500,u=5e3,v=5e3;return k.prototype=Object.create(f.prototype),k.prototype.constructor=k,k.prototype.toString=function(){return"MpdPlaylistChunkFeeder [mpdPlaylistUrl="+this._playlist.playlistUrl+", baseUrl="+this._baseUrl+", defaultPresentationDelay="+this._defaultPresentationDelay+"]"},k.prototype.dispose=function(){this.stopRequestingAllData(a.noop),this._httpRequestManager.dispose(),this._playlist.dispose(),this._statsProvider.dispose(),this._activeTracks=null,this._currentPlaybackTimeInSeconds=0},k.prototype.initialize=function(c,d,e,f,g){var h=this;e=e||a.noop,b.isFunction(e,"done"),this._initializedAt=a.now(),l.call(h,c,!0,e,function(a){return h._logger.error("Unable to initialize active tracks",a),g(a)}),l.call(h,d,!1,f,function(a){return h._logger.error("Unable to initialize alternate tracks",a),g(a)})},k.prototype.getStreamDurationBeforeInitialization=function(){return this._streamDurationBeforeInitialization},k.prototype.getLocalToServerTimeOffset=function(){return this._localToServerTimeOffset},k.prototype.setActiveTracks=function(a){this._activeTracks=a},k.prototype.getActiveTracks=function(){return this._activeTracks},k.prototype.startRequestingDataForActiveTracks=function(){return this.isFetchingData()?this._logger.debug("Unable to start requesting data. Feeder is already fetching data."):(this._keepFetchingData=!0,this._logger.debug("Starting requesting data at timestamp [%s]",this._currentPlaybackTimeInSeconds),m.call(this),o.call(this,null),void 0)},k.prototype.isFetchingData=function(){return this._keepFetchingData},k.prototype.seekToChunk=function(a){this._currentPlaybackTimeInSeconds=Math.floor(a),this._logger.debug("Seeking to timestamp [%s]",this._currentPlaybackTimeInSeconds),m.call(this)},k.prototype.stopRequestingAllData=function(){this._keepFetchingData&&(this._keepFetchingData=!1,this._logger.debug("Pausing requesting of data at timestamp [%s]",this._currentPlaybackTimeInSeconds),this._httpRequestManager.disposePendingRequests())},k}.apply(b,d))&&(a.exports=e)},function(a,b,c){var d,e;d=[c(1),c(0),c(2),c(3),c(12),c(9),c(4),c(5),c(6),c(11)],void 0!==(e=function(a,b,c,d,e,f,g,h,i,j){"use strict";function k(a,d,f,h){b.isInstanceOf(d,g,"playlist"),b.isInstanceOf(d.parsedPlaylist,j,"playlist.parsedPlaylist"),b.isStringNotEmpty(d.playlistUrl,"playlist.playlistUrl"),b.isStringNotEmpty(d.baseUrl,"playlist.baseUrl"),this._playlist=d,this._baseUrl=this._playlist.baseUrl,this._statsProvider=f,this._logger=a||new c.Logger,this._httpRequestManager=new e(this._logger),this._options=h,this._activeTracks=[],this._currentPlaybackTimeInSeconds=0,this._keepFetchingData=!1,this._bufferSize=Math.max(this._playlist.getSuggestedPresentationDelayTotalMillis(),this._playlist.getMinBufferTimeTotalMillis(),this._defaultPresentationDelay),this._streamDurationBeforeInitialization=Math.max(this._playlist.getPlaybackDurationSinceAvailable()-this._bufferSize,0)}function l(){var b=this;a.isNumber(b._mediaSegmentRequestTimeout)||(b._mediaSegmentRequestTimeout=setTimeout(function(){(function(b){var c=this,d=0;a.forEach(this._activeTracks,function(e){var f=e.getMediaSegmentPlaylistUrlInfo(),g=a.assign({version:a.now()},f.queryParameters),h={retryOptions:{delay:r,maxAttempts:s},queryParameters:g};c._httpRequestManager.getWithRetry(f.url,h,function(a,g){return a?c._logger.debug("Unable to get media segment playlist [%s]",f.url):(g&&e.updateMediaSegments(g),void(++d===c._activeTracks.length&&b()))})},q)}).call(b,function(){a.isNullOrUndefined(b._mediaSegmentRequestTimeout)||(b._mediaSegmentRequestTimeout=null,l.call(b))})},q))}function m(b){var c=this,d=c._activeTracks.length;c._waitingForNextSegment=!1,a.forEach(c._activeTracks,function(e,f){!function(e){a.find(c._activeTracks,function(a){return a.getMimeType()===e.getMimeType()})!==e?c._logger.debug("Wrong track type [%s]. Pausing fetching for track [%s]",e.getMimeType(),e.getTrackId()):e.isLastMediaSegment(c._currentPlaybackTimeInSeconds)?("dynamic"===c._playlist.getType()&&(c._waitingForNextSegment=!0),c._logger.debug("No more chunks. Pausing fetching for track [%s]",e.getMimeType(),e.getTrackId())):n.call(c,e,1,b,function(a){if(a&&a.causes&&a.causes.length>0&&"not yet available"===a.causes[0].feederReason?c._logger.info("Failed to get next chunk (packet not yet available) for [%s]|[%s]. Trying to fetch again in [%s] ms.",e.getMseCodec(),e.getBandwidth(),p):(a&&c._logger.warn("Failed to get next chunk (# of errors=[%s], errors=[%s]). Moving on.",a.causes?a.causes.length:"n/a",JSON.stringify(a)),d--),d<=0){c._logger.debug("Done fetching chunk for timestamp [%s] for each active track. Moving on to next chunk. (keep fetching=[%s])",c._currentPlaybackTimeInSeconds,c._keepFetchingData);var b=e.isLastMediaSegment(c._currentPlaybackTimeInSeconds);if("static"===c._playlist.getType()&&b)return c._keepFetchingData=!1,c._logger.info("Finished getting chunks for [static] track [%s] [%s]",e.getTrackId(),e.getMimeType());if(b)return c._waitingForNextSegment=!0,c._logger.debug("Waiting for new segment on the Segment Playlist for [dynaimic] track [%s] [%s]",e.getTrackId(),e.getMimeType());c._keepFetchingData&&m.call(c,null)}})}(e)})}function n(b,c,d,e){var f=this;(function(b,c,d){var e=this,f=b.getSegmentByTimestamp(e._currentPlaybackTimeInSeconds),g=e._baseUrl+f.name;e._logger.trace("Fetching data chunk for [%s]: [%s], next segment=[%s]",b.getMseCodec(),g,f.name);var h=b.getMseCodec();(function(b,c,d){var e=this,f={responseType:"arraybuffer",retryOptions:{delay:p,maxAttempts:o},timeout:t};if(a.isNumber(c))f.delay=c;else if(!a.isNullOrUndefined(c))throw new Error('"delay" must be a number or null or undefined');return this._httpRequestManager.getWithRetry(b,f,function(a,c){a&&e._logger.debug("Failed to load next stream data chunk. Status code: [%s] (status text: [%s]) for [%s]",a.code,a.message,b),d(a,c)})}).call(e,g,c,function(a,c){return e._logger.trace("DONE Fetching data chunk for [%s] : [%s], next segment=[%s]",h,g,f.name+(a?": FAILED: "+a.code:": data="+c.data.byteLength)),a||e._statsProvider.addRateDataPoint(h,c.requestTime,c.data.byteLength,.001),a?void(a?(a.feederReason=404===a.code?"not yet available":"other",d(a)):d(null,c.data)):(e._logger.debug("Finished fetching [%s]. Updating timestamp to fetch to [%s]",f.name,f.timestamp+f.duration),e._currentPlaybackTimeInSeconds=f.timestamp+f.duration,b.addDataChunk(c.data,f.name,function(){d(a)}))})}).call(f,b,d,function(a){return a&&f._logger.trace('Failed to fetch data chunk of stream for config [%s]". Error: [%s]',JSON.stringify(b),a),!a&&c>1&&n.call(f,b,c,d,e),e(a)})}var o=15,p=700,q=200,r=10,s=2,t=5e3;return k.prototype=Object.create(f.prototype),k.prototype.constructor=k,k.prototype.toString=function(){return"M3u8PlaylistChunkFeeder [mpdPlaylistUrl="+this._playlist.playlistUrl+", baseUrl="+this._baseUrl+", defaultPresentationDelay="+this._defaultPresentationDelay+"]"},k.prototype.dispose=function(){this.stopRequestingAllData(a.noop),this._httpRequestManager.dispose(),this._playlist.dispose(),this._statsProvider.dispose(),this._activeTracks=null,this._currentPlaybackTimeInSeconds=0,this._segmentsReadyDisposable&&(this._segmentsReadyDisposable.dispose(),this._segmentsReadyDisposable=null)},k.prototype.initialize=function(c,d,e,f,g){e=e||a.noop,b.isFunction(e,"done"),this.setActiveTracks(c),"dynamic"===this._playlist.getType()&&l.call(this);var h=this,i=0,j=function(b){n.call(h,b,1,null,function(b){return b?g(b):void(++i===c.length&&(h._initializedAt=a.now(),e(),f()))})};a.forEach(c,function(a){return h._segmentsReadyDisposable=a.addEventListener("segmentsready",function(){if(h._waitingForNextSegment){if(h._logger.debug("Continuing fetching of track [%s] segments after wait",a.getTrackId()),!h._initializedAt)return j(a);m.call(h,null)}}),a.hasSegments()?j(a):h._waitingForNextSegment=!0})},k.prototype.getStreamDurationBeforeInitialization=function(){return this._streamDurationBeforeInitialization},k.prototype.getLocalToServerTimeOffset=function(){return this._localToServerTimeOffset},k.prototype.setActiveTracks=function(b){this._activeTracks=b;var c=a.map(b,function(a){return a.getTrackId()});this._logger.debug("Setting active tracks [%s]",c)},k.prototype.getActiveTracks=function(){return this._activeTracks},k.prototype.startRequestingDataForActiveTracks=function(){return this.isFetchingData()?this._logger.debug("Unable to start requesting data. Feeder is already fetching data."):(this._keepFetchingData=!0,this._logger.debug("Starting requesting data at timestamp [%s]",this._currentPlaybackTimeInSeconds),"dynamic"===this._playlist.getType()&&l.call(this),m.call(this,null),void 0)},k.prototype.isFetchingData=function(){return this._keepFetchingData},k.prototype.seekToChunk=function(b){var c=a.get(this._activeTracks,["0"]),d=c.getClosestSegmentNotGreaterThanTimestamp(b),e=a.get(d,["timestamp"]);a.isUndefined(e)?c||(this._currentPlaybackTimeInSeconds=b):this._currentPlaybackTimeInSeconds=Math.floor(d.timestamp),this._logger.debug("Seeking to timestamp [%s]",this._currentPlaybackTimeInSeconds)},k.prototype.stopRequestingAllData=function(){this._keepFetchingData&&(this._keepFetchingData=!1,this._waitingForNextSegment=!1,this._logger.debug("Pausing requesting of data at timestamp [%s]",this._currentPlaybackTimeInSeconds),this._httpRequestManager.disposePendingRequests(),clearTimeout(this._mediaSegmentRequestTimeout),this._mediaSegmentRequestTimeout=null)},k}.apply(b,d))&&(a.exports=e)},function(a,b,c){var d;void 0!==(d=function(){"use strict";function a(a){this._userAgent=a}return a.prototype.detect=function(){var a="Unknown",b="?",c=this._userAgent.match(/(Chrome|Chromium|Firefox|Opera|Safari)+\//),d=this._userAgent.match(/(Chrome|Chromium|Firefox|Version)+\/([0-9]+)\./);return c&&c.length>=2?a=c[1]:this._userAgent.match(/^\(?Mozilla/)&&(a="Mozilla",(this._userAgent.match(/MSIE/)||this._userAgent.match(/; Trident\/.*rv:[0-9]+/))&&(a="IE",(d=this._userAgent.match(/MSIE ([0-9]+)/))?(b=parseInt(d[1],10),(d=this._userAgent.match(/MSIE [0-9]+.*MSIE ([0-9]+)/))&&(b=parseInt(d[1],10))):(d=this._userAgent.match(/rv:([0-9]+)/))&&(b=parseInt(d[1],10)))),"Chrome"===a&&this._userAgent.match(/OPR\//)?(a="Opera",d=this._userAgent.match(/(OPR)\/([0-9]+)\./)):"Chrome"===a&&this._userAgent.match(/Edge\//)?(a="Edge",d=this._userAgent.match(/(Edge)\/([0-9]+)\./)):"Firefox"!==a&&"IE"!==a||!this._userAgent.match(/Opera/)||(a="Opera",d=this._userAgent.match(/(Opera) ([0-9]+)\./)),"IE"!==a&&d&&d.length>=3&&(b=parseInt(d[2],10)),{browser:a,version:b}},a}.apply(b,[]))&&(a.exports=d)},function(a,b,c){var d,e;d=[c(1),c(0),c(2),c(3),c(8),c(7),c(14)],void 0!==(e=function(a,b,c,d,e,f,g){"use strict";function h(g,h,i,j){b.isObject(h,"videoElement");var s=this;this._videoElement=h,this._logger=g||new c.Logger,this._mediaKeys=null,this._licenseRequestRetryTimeout=null,this._disposables=new f.DisposableList;var t=a.bind(r,this);this._videoElement.addEventListener(q,t,!1),this._disposables.add(new f.Disposable(function(){s._videoElement.removeEventListener(q,t,!1)})),this._disposables.add(new f.Disposable(function(){null!==s._licenseRequestRetryTimeout&&window.clearTimeout(s._licenseRequestRetryTimeout)})),this._defaultMediaKeySystemConfig={initDataTypes:["cenc"],videoCapabilities:[{contentType:'video/mp4; codecs="avc1.42c01f"'}],audioCapabilities:[{contentType:'audio/mp4; codecs="mp4a.40.2"'}],persistentState:"optional",distinctiveIdentifier:"optional"},this._config={},"Edge"===k.browser||"IE"===k.browser?this._selectedKeySystem=m:this._selectedKeySystem=l,function(b,c){var d=this,e=function(b){return a.keys(a.reduce(b,function(a,b){return a[b]=1,a},{}))}(a.keys(b).concat(a.keys(c)));a.forEach(e,function(e){a.set(d._config,[e],a.assign({},a.get(b,[e],{}),a.get(c,[e],{}))),a.set(d._config,[e,"mediaKeySystemConfiguration"],a.assign({},d._defaultMediaKeySystemConfig,a.get(b,[e,"mediaKeySystemConfiguration"],{}),a.get(c,[e,"mediaKeySystemConfiguration"],{})))})}.call(this,function(b){return a.reduce(b,function(b,c){var d="com.phenixp2p.widevine"===c.schemeIdUri||"com.phenixrts.widevine"===c.schemeIdUri?l:c.schemeIdUri===n?m:c.schemeIdUri;return b[d]={licenseServerUrl:"com.phenixp2p.widevine"===c.schemeIdUri||"com.phenixrts.widevine"===c.schemeIdUri?decodeURIComponent(c.widevineLicenseServerUrl):c.licenseServerUrl,serverCertificateUrl:c.serverCertificateUrl},a.forOwn(c,function(c,e){a.startsWith(e,"mediaKeySystemConfiguration.")&&a.set(b[d],e,c)}),b},{})}(i),j||{}),function(){b.isObject(this._config,"this._config"),a.forOwn(this._config,function(a,c){b.isValidType(c,o,c),b.isStringNotEmpty(a.licenseServerUrl,c+"[licenseServerUrl]"),c===l&&b.isStringNotEmpty(a.serverCertificateUrl,c+"[serverCertificateUrl]"),b.isObject(a.mediaKeySystemConfiguration,c+"[mediaKeySystemConfiguration]"),b.isArrayOfString(a.mediaKeySystemConfiguration.initDataTypes,c+"[mediaKeySystemConfiguration][initDataTypes]"),b.isArray(a.mediaKeySystemConfiguration.videoCapabilities,c+"[mediaKeySystemConfiguration][videoCapabilities]"),b.isArray(a.mediaKeySystemConfiguration.audioCapabilities,c+"[mediaKeySystemConfiguration][audioCapabilities]"),b.isStringNotEmpty(a.mediaKeySystemConfiguration.persistentState,c+"[mediaKeySystemConfiguration][persistentState]"),b.isStringNotEmpty(a.mediaKeySystemConfiguration.distinctiveIdentifier,c+"[mediaKeySystemConfiguration][distinctiveIdentifier]")})}.call(this),this._drmErrorEvent=new d.Event,this._drmTrackEventRestrictionsAvailableEvent=new d.Event,this._disposables.add(this._drmErrorEvent),this._disposables.add(this._drmTrackEventRestrictionsAvailableEvent),p&&function(){var b=this;if(!this._videoElement.mediaKeys){var c=a.get(this._config,[this._selectedKeySystem,"mediaKeySystemConfiguration"]);window.navigator.requestMediaKeySystemAccess(this._selectedKeySystem,[c]).then(function(c){c.createMediaKeys()["catch"](function(a){b._drmErrorEvent.fire([a]),b._logger.error("Unable to create MediaKeys",a)}).then(function(a){return b._mediaKeys=a,b._videoElement.setMediaKeys(a)})["catch"](function(a){b._drmErrorEvent.fire([a]),b._logger.error("Unable to set MediaKeys",a)}).then(function(){return new window.Promise(function(c,d){var f=a.get(b._config,[b._selectedKeySystem,"serverCertificateUrl"]);return f?void!function(a,b){e.get(a,{mimeType:"text/plain; charset=x-user-defined"},b)}(f,function(a,e){if(a)return d(a);var f=function(a){for(var b=a.length,c=new window.Uint8Array(b),d=0;d<b;d++)c[d]=a.charCodeAt(d);return c}(e);return b._mediaKeys.setServerCertificate(f).then(c)["catch"](d)}):(b._logger.info("Not fetching server certificate because [%s] -> [serverCertificateUrl] is not set",b._selectedKeySystem),c())})})["catch"](function(a){b._logger.warn("Failed to set service certificate",a)})})["catch"](function(a){b._drmErrorEvent.fire([a]),b._logger.error("Unable to request MediaKeySystemAccess with error [%s]",a)})}}.call(this)}function i(a){var b=this,c=a.target;j.call(this,a.message,function(a,d){c.update(d)["catch"](function(a){b._drmErrorEvent.fire([a]),b._logger.error("Update of keySession with license failed [%s]",a)})})}function j(b,c){var d,f=this,g=a.get(this._config,[this._selectedKeySystem,"licenseServerUrl"]),h={};if(this._selectedKeySystem===m){var i=(new DOMParser).parseFromString(String.fromCharCode.apply(null,new window.Uint16Array(b)),"application/xml");if(!i.getElementsByTagName("Challenge")[0])return c(new Error("[Playready] Cannot find `challenge` in key message"));d=atob(i.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue);var j=i.getElementsByTagName("name"),k=i.getElementsByTagName("value");if(j.length!==k.length)return c(new Error("[Playready] Mismatched header name/value pair in key message"));h.headers={};for(var l=0;l<j.length;l++){var n=a.get(j,[l,"childNodes",0,"nodeValue"]),o=a.get(k,[l,"childNodes",0,"nodeValue"]);n&&o&&(h.headers[n]=o)}h.responseType="arraybuffer"}else h.contentType="application/octet-stream",d=b;e.post(g,d,h,function(a,b){if(a)return f._drmErrorEvent.fire([a]),f._logger.error("Failed to get license with [%s]",a),c(a);if(f._selectedKeySystem===m)return c(null,b);var d=null,e=null;try{f._logger.debug("Attempting to unwrap license response"),d=(b=JSON.parse(b)).license,b.trackRestrictions&&f._drmTrackEventRestrictionsAvailableEvent.fire([b.trackRestrictions])}catch(a){if(!(a instanceof SyntaxError))return f._drmErrorEvent.fire([a]),f._logger.error("Unexpected error [%s]",a);f._logger.debug("Unwrapping of license failed. Assuming that license response is already unwrapped"),d=b}try{e=function(a){for(var b=window.atob(a),c=new Uint8Array(b.length),d=0;d<b.length;++d)c[d]=b.charCodeAt(d);return c}(d)}catch(b){f._drmErrorEvent.fire([a]),f._logger.error("Failed to convert base64 license string [%s] to binary",d),c(b)}c(a,e)})}var k=new g(window.navigator.userAgent).detect(),l="com.widevine.alpha",m="com.microsoft.playready",n="urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95",o=a.freeze([{id:1,name:"org.w3.clearkey"},{id:2,name:l},{id:3,name:m},{id:4,name:n}]),p=!!window.navigator.requestMediaKeySystemAccess,q="encrypted";p||(q="msneedkey"),h.isSupported=function(){return"IE"===k.browser&&11===k.version||!(a.isNullOrUndefined(window.navigator.requestMediaKeySystemAccess)||a.isNullOrUndefined(window.Promise)||a.isNullOrUndefined(window.Uint8Array)||a.isNullOrUndefined(window.atob))},h.prototype.addEventListener=function(a,c){switch(b.isString(a,"eventName"),b.isFunction(c,"listener"),a){case"trackRestrictionsAvailable":return this._drmTrackEventRestrictionsAvailableEvent.listen(c);case"error":return this._drmErrorEvent.listen(c);default:throw new Error('Event "'+a+'" is unknown.')}},h.prototype.toString=function(){return"EncryptedMediaHandler [config="+JSON.stringify(this._config)+"]"},h.prototype.dispose=function(){this._disposables.dispose(),delete this._mediaKeys};var r=function(b,c){var d=this;if(c=c||1,!p)try{this._videoElement.msSetMediaKeys(new window.MSMediaKeys(this._selectedKeySystem))}catch(e){d._drmErrorEvent.fire([new Error('Unable to create MediaKeys ("'+this._selectedKeySystem+'"). Error: '+e.message)])}if(!this._mediaKeys&&!d._videoElement.msKeys){if(c<=20)return d._logger.debug("Attempt [%s] for checking if the media keys have been set",c),void(d._licenseRequestRetryTimeout=setTimeout(function(){r.call(d,b,c+1)},200));var e="Unable to find media keys after "+(c-1)+" attempts";d._logger.warn(e),d._drmErrorEvent.fire([e])}if(d._videoElement.msKeys){var g=d._videoElement.msKeys.createSession("video/mp4",b.initData);g||d._drmErrorEvent.fire([new Error("Could not create key session")]);var h=function(a){j.call(d,a.message.buffer,function(a,b){g.update(new Uint8Array(b))})};g.addEventListener("mskeymessage",h,!1),d._disposables.add(new f.Disposable(function(){g.removeEventListener("mskeymessage",h,!1)}));var k=function(){d._drmErrorEvent.fire([new Error("Unexpected `keyerror` event from key session. Code: "+g.error.code+", systemCode: "+g.error.systemCode)])};return g.addEventListener("mskeyerror",k,!1),void d._disposables.add(new f.Disposable(function(){g.removeEventListener("mskeyerror",k,!1)}))}var l=d._mediaKeys.createSession();return l.addEventListener("message",a.bind(i,d),!1),d._disposables.add(new f.Disposable(function(){l.removeEventListener("message",a.bind(i,d),!1)})),l.generateRequest(b.initDataType,b.initData).then(function(){d._logger.info("passing the media data to CDM")})["catch"](function(a){d._drmErrorEvent.fire([a]),d._logger.error("Unable to create or initialize key session [%s]",a)})};return h}.apply(b,d))&&(a.exports=e)},function(a,b,c){var d,e;d=[c(1),c(0),c(2),c(7),c(25),c(4),c(13),c(6)],void 0!==(e=function(a,b,c,d,e,f,g,h){"use strict";function i(i,q,r,s){b.isInstanceOf(q,f,"playlist"),b.isNotUndefined(r,"webPlayer"),b.isInstanceOf(r,g,"webPlayer"),b.isInstanceOf(s,h,"statsProvider"),this._playlist=q,this._webPlayer=r,this._statsProvider=s,this._logger=i||new c.Logger,this._bandwidthChangeDetails={nextSwitchCheckTime:a.now()+5e3,oldBandwidth:-1},this._disposables=new d.DisposableList,this._webPlayer.addEventListener("started",a.bind(function(){var b=this;this._bandwidthLimits=a.reduce(this._playlist.getMimeTypes(),function(c,d){var e=b._playlist.getPlaylistTracksByMimeType(d)||[],f=a.filter(e,function(b){return a.isNumber(b.getBandwidth())}),g=a.map(f,function(a){return a.getBandwidth()});return e.length>f.length&&b._logger.info("Excluding [%s] tracks without Bandwidth from ABR switching.",e.length-f.length),c[d]={max:Math.max.apply(null,g),min:Math.min.apply(null,g)},c},{}),this._logger.debug("Listening for bandwidth changes with max and min bandwidths of [%s]",this._bandwidthLimits),this._webPlayer.addEventListener("playbacktimeleft",a.bind(function(b,c){if(!this._bandwidthChangeDetails.isInProgress&&e.isForeground()){var d=this._bandwidthLimits[c.getMimeType()],f=this;if(this._bandwidthChangeDetails.nextSwitchCheckTime>0){if(this._bandwidthChangeDetails.nextSwitchCheckTime>a.now())return;this._bandwidthChangeDetails.nextSwitchCheckTime=0,this._bandwidthChangeDetails.oldBandwidth=-1}var g=a.bind(function(){this._bandwidthChangeDetails.isInProgress=!1},this);if(j.call(f,c,b)&&c.getBandwidth()<d.max){this._bandwidthChangeDetails.isInProgress=!0;var h=this._playlist.getPlaylistTrackByMimeTypeAndNextHighestBandwidth(c.getBandwidth(),c.getMimeType());this._playbackTimeout=setTimeout(function(){j.call(f,c,f._webPlayer.getTimeLeft())?(f._logger.info("Switching to higher quality track with [%s] time left in buffer and ewma of [%s].",f._webPlayer.getTimeLeft(),l.call(f,c)),f._bandwidthChangeDetails.nextSwitchCheckTime=a.now()+1e3*b+n,f._bandwidthChangeDetails.oldBandwidth=c.getBandwidth(),f._webPlayer.changeBandwidthLimit(h.getBandwidth(),g)):f._bandwidthChangeDetails.isInProgress=!1},p)}else if(k.call(f,c,b)&&c.getBandwidth()>d.min){this._bandwidthChangeDetails.isInProgress=!0;var i=this._playlist.getPlaylistTrackByBandwidthAndMimeType(c.getBandwidth()-1,c.getMimeType());this._playbackTimeout=setTimeout(function(){k.call(f,c,f._webPlayer.getTimeLeft())?(f._logger.info("Switching to lower quality track with [%s] time left in buffer and ewma of [%s].",f._webPlayer.getTimeLeft(),l.call(f,c)),f._bandwidthChangeDetails.nextSwitchCheckTime=a.now()+1e3*b+o,f._bandwidthChangeDetails.oldBandwidth=c.getBandwidth(),f._webPlayer.changeBandwidthLimit(i.getBandwidth(),g)):f._bandwidthChangeDetails.isInProgress=!1},p)}}},this))},this)),this._disposables.add(e.onBackground(a.bind(m,this,!1))),this._disposables.add(e.onForeground(a.bind(m,this,!0))),this._backgroundTimeout=null,this._foregroundBandwidth=null}function j(a,b){var c=this._statsProvider.getRateAverages(a.getMseCodec()).ewmaDuration,d=a.getChunkDuration();return b>3.5||c>0&&c<=3*d/4&&b/(d/1e3)>2}function k(a,b){var c=this._statsProvider.getRateAverages(a.getMseCodec()).ewmaDuration,d=a.getChunkDuration();return b<1.2||c>0&&c>=7*d/8&&b/(d/1e3)<=1.5}function l(a){return this._statsProvider.getRateAverages(a.getMseCodec()).ewmaDuration}function m(b){if(null!==this._playbackTimeout&&(clearTimeout(this._playbackTimeout),this._playbackTimeout=null),b){if(clearTimeout(this._backgroundTimeout),this._backgroundTimeout=null,null===this._foregroundBandwidth||this._foregroundBandwidth===this._webPlayer.getBandwidthLimit())return;var c=this._foregroundBandwidth;return this._foregroundBandwidth=null,this._bandwidthChangeDetails.nextSwitchCheckTime=a.now()+n,this._logger.info("Detected change to [foreground] for tab. Reverting to [%s] previous bandwidth limit",c),this._webPlayer.changeBandwidthLimit(c)}var d=this;this._backgroundTimeout=setTimeout(function(){e.isForeground()||(d._foregroundBandwidth=d._webPlayer.getBandwidthLimit())},q)}var n=15e3,o=5e3,p=500,q=3e3;return i.prototype.dispose=function(){null!==this._playbackTimeout&&clearTimeout(this._playbackTimeout),null!==this._backgroundTimeout&&clearTimeout(this._backgroundTimeout),this._disposables.dispose(),this._backgroundTimeout=null,this._playbackTimeout=null},i}.apply(b,d))&&(a.exports=e)},function(a,b,c){var d,e;d=[c(1),c(0),c(3),c(7)],void 0!==(e=function(a,b,c,d){function e(){this._namedEvents=new c.NamedEvents,this._timeOfLastTabFocusChange=a.now(),this._disposables=new d.DisposableList,this._isForeground=!0,this._disposables.add(this._namedEvents),function(){return f()?function(){if(f()){var a=this;chrome.extension.onRequest.addListener(function(b,c,d){"is_selected"===b&&chrome.tabs.getSelected(null,function(b){var e=b.id===c.tab.id;g.call(a,e),d(!!e)})})}}.call(this):void function(){function b(){var a=!document[c];g.call(f,a)}var c,e,f=this;void 0!==document.hidden?(c="hidden",e="visibilitychange"):void 0!==document.msHidden?(c="msHidden",e="msvisibilitychange"):void 0!==document.webkitHidden&&(c="webkitHidden",e="webkitvisibilitychange"),void 0!==document.addEventListener&&void 0!==document[c]?(a.addEventListener(document,e,b,!1),f._disposables.add(new d.Disposable(function(){a.removeEventListener(document,e,b,!1)}))):function(){var b=this;b._documentFocusInterval=setInterval(function(){var a=document.hasFocus();g.call(b,a)},i),b._disposables.add(new d.Disposable(function(){a.isNumber(b._documentFocusInterval)&&clearInterval(b._documentFocusInterval),b._documentFocusInterval=null}))}.call(f)}.call(this)}.call(this)}function f(){return"undefined"!=typeof chrome&&chrome.extension&&chrome.extension.onRequest}function g(a){if(b.isBoolean(a,"isForeground"),this._isForeground!==a)return a?(this._isForeground=!0,h.call(this,"foreground")):(this._isForeground=!1,h.call(this,"background"))}function h(b){var c=a.now(),d=c-this._timeOfLastTabFocusChange;this._timeOfLastTabFocusChange=c,this._namedEvents.fire(b,[d])}var i=3e3;return e.prototype.isForeground=function(){return this._isForeground},e.prototype.getTimeSinceLastChange=function(){return a.now()-this._timeOfLastTabFocusChange;
},e.prototype.onForeground=function(a){return b.isFunction(a,"callback"),this._namedEvents.listen("foreground",a)},e.prototype.onBackground=function(a){return b.isFunction(a,"callback"),this._namedEvents.listen("background",a)},new e}.apply(b,d))&&(a.exports=e)}])})},function(a,b,c){var d,e;d=[c(0),c(1),c(42),c(24),c(10)],e=function(a,b,c,d,e){function f(e,f,i,j,k){b.isStringNotEmpty(e,"uri"),b.isArray(f,"protocols"),b.isStringNotEmpty(i,"type"),b.isObject(j,"options");var l=a.assign({},j||{},{contentType:"application/protobuf"}),m=new d(f,k);return new c(e,l,a.bind(g,this,m,i),a.bind(h,this,m,i))}function g(a,b,c){return a.encode(b,c).toBinary()}function h(a,b,c){return a.decode(b+"Response",e.fromBinary(c))}return f}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(5),c(60),c(25)],e=function(a,b,c,d,e){"use strict";function f(f,g,o,p){b.isStringNotEmpty(f,"uri"),b.isObject(g,"logger"),b.isArray(o,"protocols"),this._uri=f,this._logger=g,this._logger.info("Connecting to [%s]",f),this._webSocket=new d(this._uri,this._logger),this._mqService=new e(this._logger,a.bind(n,this),a.bind(m,this),o,p),this._namedEvents=new c.NamedEvents,this._webSocket.onconnected=a.bind(i,this),this._webSocket.onreconnecting=a.bind(h,this),this._webSocket.onreconnected=a.bind(j,this),this._webSocket.ondisconnected=a.bind(k,this),this._webSocket.onerror=a.bind(l,this),this._disconnected=!1}function g(a,b){this._namedEvents.fire(a,b,this)}function h(a){g.call(this,"reconnecting")}function i(a){g.call(this,"connected")}function j(a){g.call(this,"reconnected")}function k(a){g.call(this,"disconnected",[a.code,a.reason]),this._disconnected&&(this._namedEvents.dispose(),this._mqService.dispose())}function l(a){g.call(this,"error",[a.data])}function m(a){this._webSocket.onmessage=a}function n(a){this._webSocket&&this._webSocket.send(a)}return f.prototype.onEvent=function(a,b){return this._namedEvents.listen(a,b),this._mqService.onEvent(a,b)},f.prototype.onRequest=function(a,b){return this._mqService.onRequest(a,b)},f.prototype.sendRequest=function(a,b,c,d){return this._mqService.sendRequest(a,b,c,d)},f.prototype.sendResponse=function(a,b,c,d){return this._mqService.sendResponse(a,b,c,d)},f.prototype.disconnect=function(){return this._disconnected=!0,this._webSocket.disconnect()},f.prototype.getApiVersion=function(){return this._mqService.getApiVersion()},f.prototype.toString=function(){return"MQWebSocket["+this._webSocket.toString()+"]"},f}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";var a={"package":"mq",messages:[{name:"Message",fields:[{rule:"optional",type:"MessageType",name:"messageType",id:7,options:{"default":"Request"}},{rule:"optional",type:"string",name:"sessionId",id:1},{rule:"optional",type:"string",name:"requestId",id:2},{rule:"required",type:"string",name:"type",id:3},{rule:"optional",type:"string",name:"encoding",id:4},{rule:"required",type:"bytes",name:"payload",id:5},{rule:"repeated",type:"double",name:"wallTime",id:6}],enums:[{name:"MessageType",values:[{name:"Request",id:0},{name:"Response",id:1},{name:"Event",id:2}]}]},{name:"Error",fields:[{rule:"required",type:"string",name:"reason",id:1}]},{name:"PingPong",fields:[{rule:"required",type:"uint64",name:"originTimestamp",id:1},{rule:"optional",type:"uint64",name:"count",id:2}]}]};return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(22)],e=function(a,b,c){"use strict";function d(d,e,g,h){b.isStringNotEmpty(d,"uri"),b.isObject(e,"logger"),a.isNullOrUndefined(g)?g=v:b.isNumber(g,"maxReconnectAttempts"),this._uri=d,this._logger=e,this._maxReconnectAttempts=g,this._reconnectBackoffInterval=h||u,this._hasAttemptedReconnect=!1,this._stopped=!1,this._queuedMessages=[],this._logger.info("Connecting to [%s]",d),this._webSocket=f.call(this,k,i);var j=this;this._networkConnectionMonitorDisposable=c.listenForNetworkChange(function(a){return a?p.call(j):q.call(j)},s)}function e(a){return this._webSocket.readyState===x.closed.code?i.call(this,a):this._webSocket.close(a.code,a.reason)}function f(b,c){var d=new WebSocket(this._uri);return d.onopen=a.bind(b,this),d.onclose=a.bind(c,this),d.onmessage=a.bind(o,this),d.onerror=a.bind(n,this),d}function g(a){var b=this;return setTimeout(function(){h.call(b,a)},a*a*this._reconnectBackoffInterval)}function h(a){this._webSocket.readyState!==x.open.code&&this.reconnect(a+1)}function i(a){switch(a.code){case w.reconnecting.code:return;case w.byebye.code:case w.backoffLimitReached.code:case w.networkDisconnect.code:return m.call(this,a);default:if(this._hasAttemptedReconnect)return;return j.call(this,a)}}function j(a){this._logger.info("Attempting to re-establish socket connection after disconnect event with code [%s] and reason [%s]",a.code,a.reason),this.onreconnecting&&this.onreconnecting(a),this.reconnect()}function k(a){this._logger.info("Connected"),r.call(this),this.onconnected&&this.onconnected(a)}function l(a){this._logger.info("Successfully reconnected to WebSocket"),this.onreconnected&&this.onreconnected(a)}function m(a){this._logger.info("Disconnected [%s]: [%s]",a.code,a.reason),this.ondisconnected&&this.ondisconnected(a)}function n(a){this._logger.error("An error occurred [%s]",a.data),this.onerror&&this.onerror(a)}function o(a){this._logger.debug(">> [%s]",a.data),this.onmessage&&this.onmessage(a)}function p(){var a=this;setTimeout(function(){return a._stopped?a._logger.info("Unable to go back online after network reconnect. Client has stopped WebSocket."):a._webSocket.readyState!==x.open.code?(a._logger.info("Network Reconnected. Attempting to reconnect WebSocket."),a.reconnect()):a._didGoOfflineDueToDisconnect?(a._logger.info("Network Reconnected while WebSocket connection still active."),k.call(a)):void a._logger.info("Network Reconnected.")},t)}function q(){this._logger.warn("Network not reconnected after [%s]. Going Offline and disconnecting WebSocket connection.",s),this._didGoOfflineDueToDisconnect=!0,m.call(this,w.networkDisconnect)}function r(){var a=this._queuedMessages.length;if(0!==a)for(this._logger.info("Sending [%s] queued messages",a);a>0;){a--;var b=this._queuedMessages.shift();this.send(b)}}var s=15e3,t=1e3,u=1e3,v=4,w={byebye:{code:1e3,reason:"byebye",desc:"Client closed"},backoffLimitReached:{code:4e3,reason:"backoff-limit-reached",desc:"Reached the limit in terms of the number of reconnects"},networkDisconnect:{code:4001,reason:"network-disconnect",desc:"Network connection monitor determined loss to internet connectivity"},reconnecting:{code:4002,reason:"reconnecting",desc:"Closing WebSocket in order to attempt to establish another connection"}},x={connecting:{code:0,state:"CONNECTING",desc:"The connection is not yet open"},open:{code:1,state:"OPEN",desc:"The connection is open and ready to communicate"},closing:{code:2,state:"CLOSING",desc:"The connection is in the process of closing"},closed:{code:3,state:"CLOSED",desc:"The connection is closed or could not be opened"}};return d.prototype.onmessage=null,d.prototype.onconnected=null,d.prototype.onreconnecting=null,d.prototype.onreconnected=null,d.prototype.ondisconnected=null,d.prototype.onerror=null,d.prototype.send=function(a){return!c.isOnline(),this._webSocket.send(a)},d.prototype.reconnect=function(b){this._webSocket.onclose=null,this._webSocket.onerror=null,this._hasAttemptedReconnect=!0;var c,d=this;if(a.isNumber(b)||(b=1),this._stopped)return this._logger.info("Client has stopped WebSocket after [%s] reconnect attempts",b-1);if(b>this._maxReconnectAttempts)return this._logger.warn("Unable to reconnect WebSocket after [%s] attempts",this._maxReconnectAttempts),e.call(this,w.backoffLimitReached);e.call(this,w.reconnecting);try{this._webSocket=f.call(d,function(){return c&&clearTimeout(c),d._hasAttemptedReconnect=!1,d._webSocket.onclose=a.bind(i,d),l.call(d)},function(){b+1>d._maxReconnectAttempts&&(c&&clearTimeout(c),h.call(d,b))})}catch(j){this._logger.warn("Unable to create WebSocket connection [%s]",j)}c=g.call(this,b)},d.prototype.disconnect=function(){return this._networkConnectionMonitorDisposable.dispose(),this._stopped=!0,this._webSocket.close(w.byebye.code,w.byebye.reason)},d.prototype.toString=function(){return"ReconnectedWebSocket["+this._uri+","+this._webSocket.readyState+"]"},d}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(59)],e=function(a){"use strict";return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b){function c(){throw new Error("setTimeout has not been defined")}function d(){throw new Error("clearTimeout has not been defined")}function e(a){if(k===setTimeout)return setTimeout(a,0);if((k===c||!k)&&setTimeout)return k=setTimeout,setTimeout(a,0);try{return k(a,0)}catch(b){try{return k.call(null,a,0)}catch(b){return k.call(this,a,0)}}}function f(a){if(l===clearTimeout)return clearTimeout(a);if((l===d||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(a);try{return l(a)}catch(b){try{return l.call(null,a)}catch(b){return l.call(this,a)}}}function g(){p&&n&&(p=!1,n.length?o=n.concat(o):q=-1,o.length&&h())}function h(){if(!p){var a=e(g);p=!0;for(var b=o.length;b;){for(n=o,o=[];++q<b;)n&&n[q].run();q=-1,b=o.length}n=null,p=!1,f(a)}}function i(a,b){this.fun=a,this.array=b}function j(){}var k,l,m=a.exports={};!function(){try{k="function"==typeof setTimeout?setTimeout:c}catch(a){k=c}try{l="function"==typeof clearTimeout?clearTimeout:d}catch(a){l=d}}();var n,o=[],p=!1,q=-1;m.nextTick=function(a){var b=new Array(arguments.length-1);if(arguments.length>1)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];o.push(new i(a,b)),1!==o.length||p||e(h)},i.prototype.run=function(){this.fun.apply(null,this.array)},m.title="browser",m.browser=!0,m.env={},m.argv=[],m.version="",m.versions={},m.on=j,m.addListener=j,m.once=j,m.off=j,m.removeListener=j,m.removeAllListeners=j,m.emit=j,m.prependListener=j,m.prependOnceListener=j,m.listeners=function(a){return[]},m.binding=function(a){throw new Error("process.binding is not supported")},m.cwd=function(){return"/"},m.chdir=function(a){throw new Error("process.chdir is not supported")},m.umask=function(){return 0}},function(a,b,c){(function(d){var e,f,g;!function(d,h){f=[c(10)],e=h,g="function"==typeof e?e.apply(b,f):e,!(void 0!==g&&(a.exports=g))}(this,function(a,b){"use strict";var e={};return e.ByteBuffer=a,e.Long=a.Long||null,e.VERSION="5.0.0",e.WIRE_TYPES={},e.WIRE_TYPES.VARINT=0,e.WIRE_TYPES.BITS64=1,e.WIRE_TYPES.LDELIM=2,e.WIRE_TYPES.STARTGROUP=3,e.WIRE_TYPES.ENDGROUP=4,e.WIRE_TYPES.BITS32=5,e.PACKABLE_WIRE_TYPES=[e.WIRE_TYPES.VARINT,e.WIRE_TYPES.BITS64,e.WIRE_TYPES.BITS32],e.TYPES={int32:{name:"int32",wireType:e.WIRE_TYPES.VARINT,defaultValue:0},uint32:{name:"uint32",wireType:e.WIRE_TYPES.VARINT,defaultValue:0},sint32:{name:"sint32",wireType:e.WIRE_TYPES.VARINT,defaultValue:0},int64:{name:"int64",wireType:e.WIRE_TYPES.VARINT,defaultValue:e.Long?e.Long.ZERO:void 0},uint64:{name:"uint64",wireType:e.WIRE_TYPES.VARINT,defaultValue:e.Long?e.Long.UZERO:void 0},sint64:{name:"sint64",wireType:e.WIRE_TYPES.VARINT,defaultValue:e.Long?e.Long.ZERO:void 0},bool:{name:"bool",wireType:e.WIRE_TYPES.VARINT,defaultValue:!1},"double":{name:"double",wireType:e.WIRE_TYPES.BITS64,defaultValue:0},string:{name:"string",wireType:e.WIRE_TYPES.LDELIM,defaultValue:""},bytes:{name:"bytes",wireType:e.WIRE_TYPES.LDELIM,defaultValue:null},fixed32:{name:"fixed32",wireType:e.WIRE_TYPES.BITS32,defaultValue:0},sfixed32:{name:"sfixed32",wireType:e.WIRE_TYPES.BITS32,defaultValue:0},fixed64:{name:"fixed64",wireType:e.WIRE_TYPES.BITS64,defaultValue:e.Long?e.Long.UZERO:void 0},sfixed64:{name:"sfixed64",wireType:e.WIRE_TYPES.BITS64,defaultValue:e.Long?e.Long.ZERO:void 0},"float":{name:"float",wireType:e.WIRE_TYPES.BITS32,defaultValue:0},"enum":{name:"enum",wireType:e.WIRE_TYPES.VARINT,defaultValue:0},message:{name:"message",wireType:e.WIRE_TYPES.LDELIM,defaultValue:null},group:{name:"group",wireType:e.WIRE_TYPES.STARTGROUP,defaultValue:null}},e.MAP_KEY_TYPES=[e.TYPES.int32,e.TYPES.sint32,e.TYPES.sfixed32,e.TYPES.uint32,e.TYPES.fixed32,e.TYPES.int64,e.TYPES.sint64,e.TYPES.sfixed64,e.TYPES.uint64,e.TYPES.fixed64,e.TYPES.bool,e.TYPES.string,e.TYPES.bytes],e.ID_MIN=1,e.ID_MAX=536870911,e.convertFieldsToCamelCase=!1,e.populateAccessors=!0,e.populateDefaults=!0,e.Util=function(){var a={};return a.IS_NODE=!("object"!=typeof d||d+""!="[object process]"||d.browser),a.XHR=function(){for(var a=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],b=null,c=0;c<a.length;c++){try{b=a[c]()}catch(d){continue}break}if(!b)throw Error("XMLHttpRequest is not supported");return b},a.fetch=function(b,d){if(d&&"function"!=typeof d&&(d=null),a.IS_NODE){var e=c(93);if(d)e.readFile(b,function(a,b){d(a?null:""+b)});else try{return e.readFileSync(b)}catch(f){return null}}else{var g=a.XHR();if(g.open("GET",b,!!d),g.setRequestHeader("Accept","text/plain"),"function"==typeof g.overrideMimeType&&g.overrideMimeType("text/plain"),!d)return g.send(null),200==g.status||0==g.status&&"string"==typeof g.responseText?g.responseText:null;if(g.onreadystatechange=function(){4==g.readyState&&d(200==g.status||0==g.status&&"string"==typeof g.responseText?g.responseText:null)},4==g.readyState)return;g.send(null)}},a.toCamelCase=function(a){return a.replace(/_([a-zA-Z])/g,function(a,b){return b.toUpperCase()})},a}(),e.Lang={DELIM:/[\s\{\}=;:\[\],'"\(\)<>]/g,RULE:/^(?:required|optional|repeated|map)$/,TYPE:/^(?:double|float|int32|uint32|sint32|int64|uint64|sint64|fixed32|sfixed32|fixed64|sfixed64|bool|string|bytes)$/,NAME:/^[a-zA-Z_][a-zA-Z_0-9]*$/,TYPEDEF:/^[a-zA-Z][a-zA-Z_0-9]*$/,TYPEREF:/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)+$/,FQTYPEREF:/^(?:\.[a-zA-Z][a-zA-Z_0-9]*)+$/,NUMBER:/^-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+|([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?)|inf|nan)$/,NUMBER_DEC:/^(?:[1-9][0-9]*|0)$/,NUMBER_HEX:/^0[xX][0-9a-fA-F]+$/,NUMBER_OCT:/^0[0-7]+$/,NUMBER_FLT:/^([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?|inf|nan)$/,BOOL:/^(?:true|false)$/i,ID:/^(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,NEGID:/^\-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,WHITESPACE:/\s/,STRING:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")|(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,STRING_DQ:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,STRING_SQ:/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g},e.DotProto=function(a,b){function c(a,c){var d=-1,e=1;if("-"==a.charAt(0)&&(e=-1,a=a.substring(1)),b.NUMBER_DEC.test(a))d=parseInt(a);else if(b.NUMBER_HEX.test(a))d=parseInt(a.substring(2),16);else{if(!b.NUMBER_OCT.test(a))throw Error("illegal id value: "+(e<0?"-":"")+a);d=parseInt(a.substring(1),8)}if(d=e*d|0,!c&&d<0)throw Error("illegal id value: "+(e<0?"-":"")+a);return d}function d(a){var c=1;if("-"==a.charAt(0)&&(c=-1,a=a.substring(1)),b.NUMBER_DEC.test(a))return c*parseInt(a,10);if(b.NUMBER_HEX.test(a))return c*parseInt(a.substring(2),16);if(b.NUMBER_OCT.test(a))return c*parseInt(a.substring(1),8);if("inf"===a)return c*(1/0);if("nan"===a)return NaN;if(b.NUMBER_FLT.test(a))return c*parseFloat(a);throw Error("illegal number value: "+(c<0?"-":"")+a)}function e(a,b,c){"undefined"==typeof a[b]?a[b]=c:(Array.isArray(a[b])||(a[b]=[a[b]]),a[b].push(c))}var f={},g=function(a){this.source=a+"",this.index=0,this.line=1,this.stack=[],this._stringOpen=null},h=g.prototype;h._readString=function(){var a='"'===this._stringOpen?b.STRING_DQ:b.STRING_SQ;a.lastIndex=this.index-1;var c=a.exec(this.source);if(!c)throw Error("unterminated string");return this.index=a.lastIndex,this.stack.push(this._stringOpen),this._stringOpen=null,c[1]},h.next=function(){if(this.stack.length>0)return this.stack.shift();if(this.index>=this.source.length)return null;if(null!==this._stringOpen)return this._readString();var a,c,d;do{for(a=!1;b.WHITESPACE.test(d=this.source.charAt(this.index));)if("\n"===d&&++this.line,++this.index===this.source.length)return null;if("/"===this.source.charAt(this.index))if(++this.index,"/"===this.source.charAt(this.index)){for(;"\n"!==this.source.charAt(++this.index);)if(this.index==this.source.length)return null;++this.index,++this.line,a=!0}else{if("*"!==(d=this.source.charAt(this.index)))return"/";do{if("\n"===d&&++this.line,++this.index===this.source.length)return null;c=d,d=this.source.charAt(this.index)}while("*"!==c||"/"!==d);++this.index,a=!0}}while(a);if(this.index===this.source.length)return null;var e=this.index;b.DELIM.lastIndex=0;var f=b.DELIM.test(this.source.charAt(e++));if(!f)for(;e<this.source.length&&!b.DELIM.test(this.source.charAt(e));)++e;var g=this.source.substring(this.index,this.index=e);return'"'!==g&&"'"!==g||(this._stringOpen=g),g},h.peek=function(){if(0===this.stack.length){var a=this.next();if(null===a)return null;this.stack.push(a)}return this.stack[0]},h.skip=function(a){var b=this.next();if(b!==a)throw Error("illegal '"+b+"', '"+a+"' expected")},h.omit=function(a){return this.peek()===a&&(this.next(),!0)},h.toString=function(){return"Tokenizer ("+this.index+"/"+this.source.length+" at line "+this.line+")"},f.Tokenizer=g;var i=function(a){this.tn=new g(a),this.proto3=!1},j=i.prototype;return j.parse=function(){var a,c={name:"[ROOT]","package":null,messages:[],enums:[],imports:[],options:{},services:[]},d=!0;try{for(;a=this.tn.next();)switch(a){case"package":if(!d||null!==c["package"])throw Error("unexpected 'package'");if(a=this.tn.next(),!b.TYPEREF.test(a))throw Error("illegal package name: "+a);this.tn.skip(";"),c["package"]=a;break;case"import":if(!d)throw Error("unexpected 'import'");a=this.tn.peek(),"public"===a&&this.tn.next(),a=this._readString(),this.tn.skip(";"),c.imports.push(a);break;case"syntax":if(!d)throw Error("unexpected 'syntax'");this.tn.skip("="),"proto3"===(c.syntax=this._readString())&&(this.proto3=!0),this.tn.skip(";");break;case"message":this._parseMessage(c,null),d=!1;break;case"enum":this._parseEnum(c),d=!1;break;case"option":this._parseOption(c);break;case"service":this._parseService(c);break;case"extend":this._parseExtend(c);break;default:throw Error("unexpected '"+a+"'")}}catch(e){throw e.message="Parse error at line "+this.tn.line+": "+e.message,e}return delete c.name,c},i.parse=function(a){return new i(a).parse()},j._readString=function(){var a,b,c="";do{if(b=this.tn.next(),"'"!==b&&'"'!==b)throw Error("illegal string delimiter: "+b);c+=this.tn.next(),this.tn.skip(b),a=this.tn.peek()}while('"'===a||'"'===a);return c},j._readValue=function(a){var c=this.tn.peek();if('"'===c||"'"===c)return this._readString();if(this.tn.next(),b.NUMBER.test(c))return d(c);if(b.BOOL.test(c))return"true"===c.toLowerCase();if(a&&b.TYPEREF.test(c))return c;throw Error("illegal value: "+c)},j._parseOption=function(a,c){var d=this.tn.next(),e=!1;if("("===d&&(e=!0,d=this.tn.next()),!b.TYPEREF.test(d))throw Error("illegal option name: "+d);var f=d;e&&(this.tn.skip(")"),f="("+f+")",d=this.tn.peek(),b.FQTYPEREF.test(d)&&(f+=d,this.tn.next())),this.tn.skip("="),this._parseOptionValue(a,f),c||this.tn.skip(";")},j._parseOptionValue=function(a,c){var d=this.tn.peek();if("{"!==d)e(a.options,c,this._readValue(!0));else for(this.tn.skip("{");"}"!==(d=this.tn.next());){if(!b.NAME.test(d))throw Error("illegal option name: "+c+"."+d);this.tn.omit(":")?e(a.options,c+"."+d,this._readValue(!0)):this._parseOptionValue(a,c+"."+d)}},j._parseService=function(a){var c=this.tn.next();if(!b.NAME.test(c))throw Error("illegal service name at line "+this.tn.line+": "+c);var d=c,e={name:d,rpc:{},options:{}};for(this.tn.skip("{");"}"!==(c=this.tn.next());)if("option"===c)this._parseOption(e);else{if("rpc"!==c)throw Error("illegal service token: "+c);this._parseServiceRPC(e)}this.tn.omit(";"),a.services.push(e)},j._parseServiceRPC=function(a){var c="rpc",d=this.tn.next();if(!b.NAME.test(d))throw Error("illegal rpc service method name: "+d);var e=d,f={request:null,response:null,request_stream:!1,response_stream:!1,options:{}};if(this.tn.skip("("),d=this.tn.next(),"stream"===d.toLowerCase()&&(f.request_stream=!0,d=this.tn.next()),!b.TYPEREF.test(d))throw Error("illegal rpc service request type: "+d);if(f.request=d,this.tn.skip(")"),d=this.tn.next(),"returns"!==d.toLowerCase())throw Error("illegal rpc service request type delimiter: "+d);if(this.tn.skip("("),d=this.tn.next(),"stream"===d.toLowerCase()&&(f.response_stream=!0,d=this.tn.next()),f.response=d,this.tn.skip(")"),d=this.tn.peek(),"{"===d){for(this.tn.next();"}"!==(d=this.tn.next());){if("option"!==d)throw Error("illegal rpc service token: "+d);this._parseOption(f)}this.tn.omit(";")}else this.tn.skip(";");"undefined"==typeof a[c]&&(a[c]={}),a[c][e]=f},j._parseMessage=function(a,d){var e=!!d,f=this.tn.next(),g={name:"",fields:[],enums:[],messages:[],options:{},services:[],oneofs:{}};if(!b.NAME.test(f))throw Error("illegal "+(e?"group":"message")+" name: "+f);for(g.name=f,e&&(this.tn.skip("="),d.id=c(this.tn.next()),g.isGroup=!0),f=this.tn.peek(),"["===f&&d&&this._parseFieldOptions(d),this.tn.skip("{");"}"!==(f=this.tn.next());)if(b.RULE.test(f))this._parseMessageField(g,f);else if("oneof"===f)this._parseMessageOneOf(g);else if("enum"===f)this._parseEnum(g);else if("message"===f)this._parseMessage(g);else if("option"===f)this._parseOption(g);else if("service"===f)this._parseService(g);else if("extensions"===f)this._parseExtensions(g);else if("extend"===f)this._parseExtend(g);else if("reserved"===f)this._parseMessageReserved(g);else{if(!b.TYPEREF.test(f))throw Error("illegal message token: "+f);if(!this.proto3)throw Error("illegal field rule: "+f);this._parseMessageField(g,"optional",f)}return this.tn.omit(";"),a.messages.push(g),g},j._parseMessageReserved=function(a){for(;";"!==this.tn.peek();)this.tn.next();this.tn.skip(";")},j._parseMessageField=function(a,d,e){if(!b.RULE.test(d))throw Error("illegal message field rule: "+d);var f,g={rule:d,type:"",name:"",options:{},id:0};if("map"===d){if(e)throw Error("illegal type: "+e);if(this.tn.skip("<"),f=this.tn.next(),!b.TYPE.test(f)&&!b.TYPEREF.test(f))throw Error("illegal message field type: "+f);if(g.keytype=f,this.tn.skip(","),f=this.tn.next(),!b.TYPE.test(f)&&!b.TYPEREF.test(f))throw Error("illegal message field: "+f);if(g.type=f,this.tn.skip(">"),f=this.tn.next(),!b.NAME.test(f))throw Error("illegal message field name: "+f);g.name=f,this.tn.skip("="),g.id=c(this.tn.next()),f=this.tn.peek(),"["===f&&this._parseFieldOptions(g),this.tn.skip(";")}else if(e="undefined"!=typeof e?e:this.tn.next(),"group"===e){var h=this._parseMessage(a,g);if(!/^[A-Z]/.test(h.name))throw Error("illegal group name: "+h.name);g.type=h.name,g.name=h.name.toLowerCase(),this.tn.omit(";")}else{if(!b.TYPE.test(e)&&!b.TYPEREF.test(e))throw Error("illegal message field type: "+e);if(g.type=e,f=this.tn.next(),!b.NAME.test(f))throw Error("illegal message field name: "+f);g.name=f,this.tn.skip("="),g.id=c(this.tn.next()),f=this.tn.peek(),"["===f&&this._parseFieldOptions(g),this.tn.skip(";")}return a.fields.push(g),g},j._parseMessageOneOf=function(a){var c=this.tn.next();if(!b.NAME.test(c))throw Error("illegal oneof name: "+c);var d,e=c,f=[];for(this.tn.skip("{");"}"!==(c=this.tn.next());)d=this._parseMessageField(a,"optional",c),d.oneof=e,f.push(d.id);this.tn.omit(";"),a.oneofs[e]=f},j._parseFieldOptions=function(a){this.tn.skip("[");for(var b,c=!0;"]"!==(b=this.tn.peek());)c||this.tn.skip(","),this._parseOption(a,!0),c=!1;this.tn.next()},j._parseEnum=function(a){var d={name:"",values:[],options:{}},e=this.tn.next();if(!b.NAME.test(e))throw Error("illegal name: "+e);for(d.name=e,this.tn.skip("{");"}"!==(e=this.tn.next());)if("option"===e)this._parseOption(d);else{if(!b.NAME.test(e))throw Error("illegal name: "+e);this.tn.skip("=");var f={name:e,id:c(this.tn.next(),!0)};e=this.tn.peek(),"["===e&&this._parseFieldOptions({options:{}}),this.tn.skip(";"),d.values.push(f)}this.tn.omit(";"),a.enums.push(d)},j._parseExtensions=function(b){var c=this.tn.next(),e=[];"min"===c?e.push(a.ID_MIN):"max"===c?e.push(a.ID_MAX):e.push(d(c)),this.tn.skip("to"),c=this.tn.next(),"min"===c?e.push(a.ID_MIN):"max"===c?e.push(a.ID_MAX):e.push(d(c)),this.tn.skip(";"),b.extensions=e},j._parseExtend=function(a){var c=this.tn.next();if(!b.TYPEREF.test(c))throw Error("illegal extend reference: "+c);var d={ref:c,fields:[]};for(this.tn.skip("{");"}"!==(c=this.tn.next());)if(b.RULE.test(c))this._parseMessageField(d,c);else{if(!b.TYPEREF.test(c))throw Error("illegal extend token: "+c);if(!this.proto3)throw Error("illegal field rule: "+c);this._parseMessageField(d,"optional",c)}return this.tn.omit(";"),a.messages.push(d),d},j.toString=function(){return"Parser at line "+this.tn.line},f.Parser=i,f}(e,e.Lang),e.Reflect=function(b){function c(c){if("string"==typeof c&&(c=b.TYPES[c]),"undefined"==typeof c.defaultValue)throw Error("default value for type "+c.name+" is not supported");return c==b.TYPES.bytes?new a(0):c.defaultValue}function d(a,c){if(a&&"number"==typeof a.low&&"number"==typeof a.high&&"boolean"==typeof a.unsigned&&a.low===a.low&&a.high===a.high)return new b.Long(a.low,a.high,"undefined"==typeof c?a.unsigned:c);if("string"==typeof a)return b.Long.fromString(a,c||!1,10);if("number"==typeof a)return b.Long.fromNumber(a,c||!1);throw Error("not convertible to Long")}function e(a,c){var d=c.readVarint32(),f=7&d,g=d>>>3;switch(f){case b.WIRE_TYPES.VARINT:do d=c.readUint8();while(128===(128&d));break;case b.WIRE_TYPES.BITS64:c.offset+=8;break;case b.WIRE_TYPES.LDELIM:d=c.readVarint32(),c.offset+=d;break;case b.WIRE_TYPES.STARTGROUP:e(g,c);break;case b.WIRE_TYPES.ENDGROUP:if(g===a)return!1;throw Error("Illegal GROUPEND after unknown group: "+g+" ("+a+" expected)");case b.WIRE_TYPES.BITS32:c.offset+=4;break;default:throw Error("Illegal wire type in unknown group "+a+": "+f)}return!0}var f={},g=function(a,b,c){this.builder=a,this.parent=b,this.name=c,this.className},h=g.prototype;h.fqn=function(){for(var a=this.name,b=this;;){if(b=b.parent,null==b)break;a=b.name+"."+a}return a},h.toString=function(a){return(a?this.className+" ":"")+this.fqn()},h.build=function(){throw Error(this.toString(!0)+" cannot be built directly")},f.T=g;var i=function(a,b,c,d,e){g.call(this,a,b,c),this.className="Namespace",this.children=[],this.options=d||{},this.syntax=e||"proto2"},j=i.prototype=Object.create(g.prototype);j.getChildren=function(a){if(a=a||null,null==a)return this.children.slice();for(var b=[],c=0,d=this.children.length;c<d;++c)this.children[c]instanceof a&&b.push(this.children[c]);return b},j.addChild=function(a){var b;if(b=this.getChild(a.name))if(b instanceof m.Field&&b.name!==b.originalName&&null===this.getChild(b.originalName))b.name=b.originalName;else{if(!(a instanceof m.Field&&a.name!==a.originalName&&null===this.getChild(a.originalName)))throw Error("Duplicate name in namespace "+this.toString(!0)+": "+a.name);a.name=a.originalName}this.children.push(a)},j.getChild=function(a){for(var b="number"==typeof a?"id":"name",c=0,d=this.children.length;c<d;++c)if(this.children[c][b]===a)return this.children[c];return null},j.resolve=function(a,b){var c="string"==typeof a?a.split("."):a,d=this,e=0;if(""===c[e]){for(;null!==d.parent;)d=d.parent;e++}var g;do{do{if(!(d instanceof f.Namespace)){d=null;break}if(g=d.getChild(c[e]),!g||!(g instanceof f.T)||b&&!(g instanceof f.Namespace)){d=null;break}d=g,e++}while(e<c.length);if(null!=d)break;if(null!==this.parent)return this.parent.resolve(a,b)}while(null!=d);return d},j.qn=function(a){var b=[],c=a;do b.unshift(c.name),c=c.parent;while(null!==c);for(var d=1;d<=b.length;d++){var e=b.slice(b.length-d);if(a===this.resolve(e,a instanceof f.Namespace))return e.join(".")}return a.fqn()},j.build=function(){for(var a,b={},c=this.children,d=0,e=c.length;d<e;++d)a=c[d],a instanceof i&&(b[a.name]=a.build());return Object.defineProperty&&Object.defineProperty(b,"$options",{value:this.buildOpt()}),b},j.buildOpt=function(){for(var a={},b=Object.keys(this.options),c=0,d=b.length;c<d;++c){var e=b[c],f=this.options[b[c]];a[e]=f}return a},j.getOption=function(a){return"undefined"==typeof a?this.options:"undefined"!=typeof this.options[a]?this.options[a]:null},f.Namespace=i;var k=function(a,c,d,e){if(this.type=a,this.resolvedType=c,this.isMapKey=d,this.syntax=e,d&&b.MAP_KEY_TYPES.indexOf(a)<0)throw Error("Invalid map key type: "+a.name)},l=k.prototype;k.defaultFieldValue=c,l.verifyValue=function(c){var e=function(a,b){throw Error("Illegal value for "+this.toString(!0)+" of type "+this.type.name+": "+a+" ("+b+")")}.bind(this);switch(this.type){case b.TYPES.int32:case b.TYPES.sint32:case b.TYPES.sfixed32:return("number"!=typeof c||c===c&&c%1!==0)&&e(typeof c,"not an integer"),c>4294967295?0|c:c;case b.TYPES.uint32:case b.TYPES.fixed32:return("number"!=typeof c||c===c&&c%1!==0)&&e(typeof c,"not an integer"),c<0?c>>>0:c;case b.TYPES.int64:case b.TYPES.sint64:case b.TYPES.sfixed64:if(b.Long)try{return d(c,!1)}catch(f){e(typeof c,f.message)}else e(typeof c,"requires Long.js");case b.TYPES.uint64:case b.TYPES.fixed64:if(b.Long)try{return d(c,!0)}catch(f){e(typeof c,f.message)}else e(typeof c,"requires Long.js");case b.TYPES.bool:return"boolean"!=typeof c&&e(typeof c,"not a boolean"),c;case b.TYPES["float"]:case b.TYPES["double"]:return"number"!=typeof c&&e(typeof c,"not a number"),c;case b.TYPES.string:return"string"==typeof c||c&&c instanceof String||e(typeof c,"not a string"),""+c;case b.TYPES.bytes:return a.isByteBuffer(c)?c:a.wrap(c,"base64");case b.TYPES["enum"]:var g=this.resolvedType.getChildren(b.Reflect.Enum.Value);for(i=0;i<g.length;i++){if(g[i].name==c)return g[i].id;if(g[i].id==c)return g[i].id}if("proto3"===this.syntax)return("number"!=typeof c||c===c&&c%1!==0)&&e(typeof c,"not an integer"),(c>4294967295||c<0)&&e(typeof c,"not in range for uint32"),c;e(c,"not a valid enum value");case b.TYPES.group:case b.TYPES.message:if(c&&"object"==typeof c||e(typeof c,"object expected"),c instanceof this.resolvedType.clazz)return c;if(c instanceof b.Builder.Message){var h={};for(var i in c)c.hasOwnProperty(i)&&(h[i]=c[i]);c=h}return new this.resolvedType.clazz(c)}throw Error("[INTERNAL] Illegal value for "+this.toString(!0)+": "+c+" (undefined type "+this.type+")")},l.calculateLength=function(c,d){if(null===d)return 0;var e;switch(this.type){case b.TYPES.int32:return d<0?a.calculateVarint64(d):a.calculateVarint32(d);case b.TYPES.uint32:return a.calculateVarint32(d);case b.TYPES.sint32:return a.calculateVarint32(a.zigZagEncode32(d));case b.TYPES.fixed32:case b.TYPES.sfixed32:case b.TYPES["float"]:return 4;case b.TYPES.int64:case b.TYPES.uint64:return a.calculateVarint64(d);case b.TYPES.sint64:return a.calculateVarint64(a.zigZagEncode64(d));case b.TYPES.fixed64:case b.TYPES.sfixed64:return 8;case b.TYPES.bool:return 1;case b.TYPES["enum"]:return a.calculateVarint32(d);case b.TYPES["double"]:return 8;case b.TYPES.string:return e=a.calculateUTF8Bytes(d),a.calculateVarint32(e)+e;case b.TYPES.bytes:if(d.remaining()<0)throw Error("Illegal value for "+this.toString(!0)+": "+d.remaining()+" bytes remaining");return a.calculateVarint32(d.remaining())+d.remaining();case b.TYPES.message:return e=this.resolvedType.calculate(d),a.calculateVarint32(e)+e;case b.TYPES.group:return e=this.resolvedType.calculate(d),e+a.calculateVarint32(c<<3|b.WIRE_TYPES.ENDGROUP)}throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+d+" (unknown type)")},l.encodeValue=function(c,d,e){if(null===d)return e;switch(this.type){case b.TYPES.int32:d<0?e.writeVarint64(d):e.writeVarint32(d);break;case b.TYPES.uint32:e.writeVarint32(d);break;case b.TYPES.sint32:e.writeVarint32ZigZag(d);break;case b.TYPES.fixed32:e.writeUint32(d);break;case b.TYPES.sfixed32:e.writeInt32(d);break;case b.TYPES.int64:case b.TYPES.uint64:e.writeVarint64(d);break;case b.TYPES.sint64:e.writeVarint64ZigZag(d);break;case b.TYPES.fixed64:e.writeUint64(d);break;case b.TYPES.sfixed64:e.writeInt64(d);break;case b.TYPES.bool:"string"==typeof d?e.writeVarint32("false"===d.toLowerCase()?0:!!d):e.writeVarint32(d?1:0);break;case b.TYPES["enum"]:e.writeVarint32(d);
break;case b.TYPES["float"]:e.writeFloat32(d);break;case b.TYPES["double"]:e.writeFloat64(d);break;case b.TYPES.string:e.writeVString(d);break;case b.TYPES.bytes:if(d.remaining()<0)throw Error("Illegal value for "+this.toString(!0)+": "+d.remaining()+" bytes remaining");var f=d.offset;e.writeVarint32(d.remaining()),e.append(d),d.offset=f;break;case b.TYPES.message:var g=(new a).LE();this.resolvedType.encode(d,g),e.writeVarint32(g.offset),e.append(g.flip());break;case b.TYPES.group:this.resolvedType.encode(d,e),e.writeVarint32(c<<3|b.WIRE_TYPES.ENDGROUP);break;default:throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+d+" (unknown type)")}return e},l.decode=function(a,c,d){if(c!=this.type.wireType)throw Error("Unexpected wire type for element");var e,f;switch(this.type){case b.TYPES.int32:return 0|a.readVarint32();case b.TYPES.uint32:return a.readVarint32()>>>0;case b.TYPES.sint32:return 0|a.readVarint32ZigZag();case b.TYPES.fixed32:return a.readUint32()>>>0;case b.TYPES.sfixed32:return 0|a.readInt32();case b.TYPES.int64:return a.readVarint64();case b.TYPES.uint64:return a.readVarint64().toUnsigned();case b.TYPES.sint64:return a.readVarint64ZigZag();case b.TYPES.fixed64:return a.readUint64();case b.TYPES.sfixed64:return a.readInt64();case b.TYPES.bool:return!!a.readVarint32();case b.TYPES["enum"]:return a.readVarint32();case b.TYPES["float"]:return a.readFloat();case b.TYPES["double"]:return a.readDouble();case b.TYPES.string:return a.readVString();case b.TYPES.bytes:if(f=a.readVarint32(),a.remaining()<f)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+f+" required but got only "+a.remaining());return e=a.clone(),e.limit=e.offset+f,a.offset+=f,e;case b.TYPES.message:return f=a.readVarint32(),this.resolvedType.decode(a,f);case b.TYPES.group:return this.resolvedType.decode(a,-1,d)}throw Error("[INTERNAL] Illegal decode type")},l.valueFromString=function(c){if(!this.isMapKey)throw Error("valueFromString() called on non-map-key element");switch(this.type){case b.TYPES.int32:case b.TYPES.sint32:case b.TYPES.sfixed32:case b.TYPES.uint32:case b.TYPES.fixed32:return this.verifyValue(parseInt(c));case b.TYPES.int64:case b.TYPES.sint64:case b.TYPES.sfixed64:case b.TYPES.uint64:case b.TYPES.fixed64:return this.verifyValue(c);case b.TYPES.bool:return"true"===c;case b.TYPES.string:return this.verifyValue(c);case b.TYPES.bytes:return a.fromBinary(c)}},l.valueToString=function(a){if(!this.isMapKey)throw Error("valueToString() called on non-map-key element");return this.type===b.TYPES.bytes?a.toString("binary"):a.toString()},f.Element=k;var m=function(a,c,d,e,f,g){i.call(this,a,c,d,e,g),this.className="Message",this.extensions=[b.ID_MIN,b.ID_MAX],this.clazz=null,this.isGroup=!!f,this._fields=null,this._fieldsById=null,this._fieldsByName=null},n=m.prototype=Object.create(i.prototype);n.build=function(c){if(this.clazz&&!c)return this.clazz;var d=function(b,c){function d(c,e,f,g){if(null===c||"object"!=typeof c){if(g&&g instanceof b.Reflect.Enum){var h=b.Reflect.Enum.getName(g.object,c);if(null!==h)return h}return c}if(a.isByteBuffer(c))return e?c.toBase64():c.toBuffer();if(b.Long.isLong(c))return f?c.toString():b.Long.fromValue(c);var i;if(Array.isArray(c))return i=[],c.forEach(function(a,b){i[b]=d(a,e,f,g)}),i;if(i={},c instanceof b.Map){for(var j=c.entries(),k=j.next();!k.done;k=j.next())i[c.keyElem.valueToString(k.value[0])]=d(k.value[1],e,f,c.valueElem.resolvedType);return i}var l=c.$type,m=void 0;for(var n in c)c.hasOwnProperty(n)&&(l&&(m=l.getChild(n))?i[n]=d(c[n],e,f,m.resolvedType):i[n]=d(c[n],e,f));return i}var e=c.getChildren(b.Reflect.Message.Field),f=c.getChildren(b.Reflect.Message.OneOf),g=function(d,h){b.Builder.Message.call(this);for(var i=0,j=f.length;i<j;++i)this[f[i].name]=null;for(i=0,j=e.length;i<j;++i){var k=e[i];this[k.name]=k.repeated?[]:k.map?new b.Map(k):null,!k.required&&"proto3"!==c.syntax||null===k.defaultValue||(this[k.name]=k.defaultValue)}if(arguments.length>0){var l;if(1!==arguments.length||null===d||"object"!=typeof d||!("function"!=typeof d.encode||d instanceof g)||Array.isArray(d)||d instanceof b.Map||a.isByteBuffer(d)||d instanceof ArrayBuffer||b.Long&&d instanceof b.Long)for(i=0,j=arguments.length;i<j;++i)"undefined"!=typeof(l=arguments[i])&&this.$set(e[i].name,l);else this.$set(d)}},h=g.prototype=Object.create(b.Builder.Message.prototype);h.add=function(a,d,e){var f=c._fieldsByName[a];if(!e){if(!f)throw Error(this+"#"+a+" is undefined");if(!(f instanceof b.Reflect.Message.Field))throw Error(this+"#"+a+" is not a field: "+f.toString(!0));if(!f.repeated)throw Error(this+"#"+a+" is not a repeated field");d=f.verifyValue(d,!0)}return null===this[a]&&(this[a]=[]),this[a].push(d),this},h.$add=h.add,h.set=function(a,d,e){if(a&&"object"==typeof a){e=d;for(var f in a)a.hasOwnProperty(f)&&"undefined"!=typeof(d=a[f])&&this.$set(f,d,e);return this}var g=c._fieldsByName[a];if(e)this[a]=d;else{if(!g)throw Error(this+"#"+a+" is not a field: undefined");if(!(g instanceof b.Reflect.Message.Field))throw Error(this+"#"+a+" is not a field: "+g.toString(!0));this[g.name]=d=g.verifyValue(d)}if(g&&g.oneof){var h=this[g.oneof.name];null!==d?(null!==h&&h!==g.name&&(this[h]=null),this[g.oneof.name]=g.name):h===a&&(this[g.oneof.name]=null)}return this},h.$set=h.set,h.get=function(a,d){if(d)return this[a];var e=c._fieldsByName[a];if(!(e&&e instanceof b.Reflect.Message.Field))throw Error(this+"#"+a+" is not a field: undefined");if(!(e instanceof b.Reflect.Message.Field))throw Error(this+"#"+a+" is not a field: "+e.toString(!0));return this[e.name]},h.$get=h.get;for(var i=0;i<e.length;i++){var j=e[i];j instanceof b.Reflect.Message.ExtensionField||c.builder.options.populateAccessors&&function(a){var b=a.originalName.replace(/(_[a-zA-Z])/g,function(a){return a.toUpperCase().replace("_","")});b=b.substring(0,1).toUpperCase()+b.substring(1);var d=a.originalName.replace(/([A-Z])/g,function(a){return"_"+a}),e=function(b,c){return this[a.name]=c?b:a.verifyValue(b),this},f=function(){return this[a.name]};null===c.getChild("set"+b)&&(h["set"+b]=e),null===c.getChild("set_"+d)&&(h["set_"+d]=e),null===c.getChild("get"+b)&&(h["get"+b]=f),null===c.getChild("get_"+d)&&(h["get_"+d]=f)}(j)}h.encode=function(b,d){"boolean"==typeof b&&(d=b,b=void 0);var e=!1;b||(b=new a,e=!0);var f=b.littleEndian;try{return c.encode(this,b.LE(),d),(e?b.flip():b).LE(f)}catch(g){throw b.LE(f),g}},g.encode=function(a,b,c){return new g(a).encode(b,c)},h.calculate=function(){return c.calculate(this)},h.encodeDelimited=function(b){var d=!1;b||(b=new a,d=!0);var e=(new a).LE();return c.encode(this,e).flip(),b.writeVarint32(e.remaining()),b.append(e),d?b.flip():b},h.encodeAB=function(){try{return this.encode().toArrayBuffer()}catch(a){throw a.encoded&&(a.encoded=a.encoded.toArrayBuffer()),a}},h.toArrayBuffer=h.encodeAB,h.encodeNB=function(){try{return this.encode().toBuffer()}catch(a){throw a.encoded&&(a.encoded=a.encoded.toBuffer()),a}},h.toBuffer=h.encodeNB,h.encode64=function(){try{return this.encode().toBase64()}catch(a){throw a.encoded&&(a.encoded=a.encoded.toBase64()),a}},h.toBase64=h.encode64,h.encodeHex=function(){try{return this.encode().toHex()}catch(a){throw a.encoded&&(a.encoded=a.encoded.toHex()),a}},h.toHex=h.encodeHex,h.toRaw=function(a,b){return d(this,!!a,!!b,this.$type)},h.encodeJSON=function(){return JSON.stringify(d(this,!0,!0,this.$type))},g.decode=function(b,d){"string"==typeof b&&(b=a.wrap(b,d?d:"base64")),b=a.isByteBuffer(b)?b:a.wrap(b);var e=b.littleEndian;try{var f=c.decode(b.LE());return b.LE(e),f}catch(g){throw b.LE(e),g}},g.decodeDelimited=function(b,d){if("string"==typeof b&&(b=a.wrap(b,d?d:"base64")),b=a.isByteBuffer(b)?b:a.wrap(b),b.remaining()<1)return null;var e=b.offset,f=b.readVarint32();if(b.remaining()<f)return b.offset=e,null;try{var g=c.decode(b.slice(b.offset,b.offset+f).LE());return b.offset+=f,g}catch(h){throw b.offset+=f,h}},g.decode64=function(a){return g.decode(a,"base64")},g.decodeHex=function(a){return g.decode(a,"hex")},g.decodeJSON=function(a){return new g(JSON.parse(a))},h.toString=function(){return c.toString()};return Object.defineProperty&&(Object.defineProperty(g,"$options",{value:c.buildOpt()}),Object.defineProperty(h,"$options",{value:g.$options}),Object.defineProperty(g,"$type",{value:c}),Object.defineProperty(h,"$type",{value:c})),g}(b,this);this._fields=[],this._fieldsById={},this._fieldsByName={};for(var e,f=0,g=this.children.length;f<g;f++)if(e=this.children[f],e instanceof s||e instanceof m||e instanceof w){if(d.hasOwnProperty(e.name))throw Error("Illegal reflect child of "+this.toString(!0)+": "+e.toString(!0)+" cannot override static property '"+e.name+"'");d[e.name]=e.build()}else if(e instanceof m.Field)e.build(),this._fields.push(e),this._fieldsById[e.id]=e,this._fieldsByName[e.name]=e;else if(!(e instanceof m.OneOf||e instanceof v))throw Error("Illegal reflect child of "+this.toString(!0)+": "+this.children[f].toString(!0));return this.clazz=d},n.encode=function(a,b,c){for(var d,e,f=null,g=0,h=this._fields.length;g<h;++g)d=this._fields[g],e=a[d.name],d.required&&null===e?null===f&&(f=d):d.encode(c?e:d.verifyValue(e),b,a);if(null!==f){var i=Error("Missing at least one required field for "+this.toString(!0)+": "+f);throw i.encoded=b,i}return b},n.calculate=function(a){for(var b,c,d=0,e=0,f=this._fields.length;e<f;++e){if(b=this._fields[e],c=a[b.name],b.required&&null===c)throw Error("Missing at least one required field for "+this.toString(!0)+": "+b);d+=b.calculate(c,a)}return d},n.decode=function(a,c,d){c="number"==typeof c?c:-1;for(var f,g,h,i,j=a.offset,k=new this.clazz;a.offset<j+c||c===-1&&a.remaining()>0;){if(f=a.readVarint32(),g=7&f,h=f>>>3,g===b.WIRE_TYPES.ENDGROUP){if(h!==d)throw Error("Illegal group end indicator for "+this.toString(!0)+": "+h+" ("+(d?d+" expected":"not a group")+")");break}if(i=this._fieldsById[h]){if(i.repeated&&!i.options.packed)k[i.name].push(i.decode(g,a));else if(i.map){var l=i.decode(g,a);k[i.name].set(l[0],l[1])}else if(k[i.name]=i.decode(g,a),i.oneof){var m=k[i.oneof.name];null!==m&&m!==i.name&&(k[m]=null),k[i.oneof.name]=i.name}}else switch(g){case b.WIRE_TYPES.VARINT:a.readVarint32();break;case b.WIRE_TYPES.BITS32:a.offset+=4;break;case b.WIRE_TYPES.BITS64:a.offset+=8;break;case b.WIRE_TYPES.LDELIM:var n=a.readVarint32();a.offset+=n;break;case b.WIRE_TYPES.STARTGROUP:for(;e(h,a););break;default:throw Error("Illegal wire type for unknown field "+h+" in "+this.toString(!0)+"#decode: "+g)}}for(var o=0,p=this._fields.length;o<p;++o)if(i=this._fields[o],null===k[i.name])if("proto3"===this.syntax)k[i.name]=i.defaultValue;else{if(i.required){var q=Error("Missing at least one required field for "+this.toString(!0)+": "+i.name);throw q.decoded=k,q}b.populateDefaults&&null!==i.defaultValue&&(k[i.name]=i.defaultValue)}return k},f.Message=m;var o=function(a,c,d,e,f,h,i,j,k,l){g.call(this,a,c,h),this.className="Message.Field",this.required="required"===d,this.repeated="repeated"===d,this.map="map"===d,this.keyType=e||null,this.type=f,this.resolvedType=null,this.id=i,this.options=j||{},this.defaultValue=null,this.oneof=k||null,this.syntax=l||"proto2",this.originalName=this.name,this.element=null,this.keyElement=null,!this.builder.options.convertFieldsToCamelCase||this instanceof m.ExtensionField||(this.name=b.Util.toCamelCase(this.name))},p=o.prototype=Object.create(g.prototype);p.build=function(){this.element=new k(this.type,this.resolvedType,(!1),this.syntax),this.map&&(this.keyElement=new k(this.keyType,(void 0),(!0),this.syntax)),"proto3"!==this.syntax||this.repeated||this.map?"undefined"!=typeof this.options["default"]&&(this.defaultValue=this.verifyValue(this.options["default"])):this.defaultValue=k.defaultFieldValue(this.type)},p.verifyValue=function(a,c){c=c||!1;var d=function(a,b){throw Error("Illegal value for "+this.toString(!0)+" of type "+this.type.name+": "+a+" ("+b+")")}.bind(this);if(null===a)return this.required&&d(typeof a,"required"),"proto3"===this.syntax&&this.type!==b.TYPES.message&&d(typeof a,"proto3 field without field presence cannot be null"),null;var e;if(this.repeated&&!c){Array.isArray(a)||(a=[a]);var f=[];for(e=0;e<a.length;e++)f.push(this.element.verifyValue(a[e]));return f}return this.map&&!c?a instanceof b.Map?a:(a instanceof Object||d(typeof a,"expected ProtoBuf.Map or raw object for map field"),new b.Map(this,a)):(!this.repeated&&Array.isArray(a)&&d(typeof a,"no array expected"),this.element.verifyValue(a))},p.hasWirePresence=function(a,c){if("proto3"!==this.syntax)return null!==a;if(this.oneof&&c[this.oneof.name]===this.name)return!0;switch(this.type){case b.TYPES.int32:case b.TYPES.sint32:case b.TYPES.sfixed32:case b.TYPES.uint32:case b.TYPES.fixed32:return 0!==a;case b.TYPES.int64:case b.TYPES.sint64:case b.TYPES.sfixed64:case b.TYPES.uint64:case b.TYPES.fixed64:return 0!==a.low||0!==a.high;case b.TYPES.bool:return a;case b.TYPES["float"]:case b.TYPES["double"]:return 0!==a;case b.TYPES.string:return a.length>0;case b.TYPES.bytes:return a.remaining()>0;case b.TYPES["enum"]:return 0!==a;case b.TYPES.message:return null!==a;default:return!0}},p.encode=function(c,d,e){if(null===this.type||"object"!=typeof this.type)throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===c||this.repeated&&0==c.length)return d;try{if(this.repeated){var f;if(this.options.packed&&b.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0){d.writeVarint32(this.id<<3|b.WIRE_TYPES.LDELIM),d.ensureCapacity(d.offset+=1);var g=d.offset;for(f=0;f<c.length;f++)this.element.encodeValue(this.id,c[f],d);var h=d.offset-g,i=a.calculateVarint32(h);if(i>1){var j=d.slice(g,d.offset);g+=i-1,d.offset=g,d.append(j)}d.writeVarint32(h,g-i)}else for(f=0;f<c.length;f++)d.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,c[f],d)}else this.map?c.forEach(function(c,e,f){var g=a.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,e)+a.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,c);d.writeVarint32(this.id<<3|b.WIRE_TYPES.LDELIM),d.writeVarint32(g),d.writeVarint32(8|this.keyType.wireType),this.keyElement.encodeValue(1,e,d),d.writeVarint32(16|this.type.wireType),this.element.encodeValue(2,c,d)},this):this.hasWirePresence(c,e)&&(d.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,c,d))}catch(k){throw Error("Illegal value for "+this.toString(!0)+": "+c+" ("+k+")")}return d},p.calculate=function(c,d){if(c=this.verifyValue(c),null===this.type||"object"!=typeof this.type)throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===c||this.repeated&&0==c.length)return 0;var e=0;try{if(this.repeated){var f,g;if(this.options.packed&&b.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0){for(e+=a.calculateVarint32(this.id<<3|b.WIRE_TYPES.LDELIM),g=0,f=0;f<c.length;f++)g+=this.element.calculateLength(this.id,c[f]);e+=a.calculateVarint32(g),e+=g}else for(f=0;f<c.length;f++)e+=a.calculateVarint32(this.id<<3|this.type.wireType),e+=this.element.calculateLength(this.id,c[f])}else this.map?c.forEach(function(c,d,f){var g=a.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,d)+a.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,c);e+=a.calculateVarint32(this.id<<3|b.WIRE_TYPES.LDELIM),e+=a.calculateVarint32(g),e+=g},this):this.hasWirePresence(c,d)&&(e+=a.calculateVarint32(this.id<<3|this.type.wireType),e+=this.element.calculateLength(this.id,c))}catch(h){throw Error("Illegal value for "+this.toString(!0)+": "+c+" ("+h+")")}return e},p.decode=function(a,c,d){var e,f,g=!this.map&&a==this.type.wireType||!d&&this.repeated&&this.options.packed&&a==b.WIRE_TYPES.LDELIM||this.map&&a==b.WIRE_TYPES.LDELIM;if(!g)throw Error("Illegal wire type for field "+this.toString(!0)+": "+a+" ("+this.type.wireType+" expected)");if(a==b.WIRE_TYPES.LDELIM&&this.repeated&&this.options.packed&&b.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0&&!d){f=c.readVarint32(),f=c.offset+f;for(var h=[];c.offset<f;)h.push(this.decode(this.type.wireType,c,!0));return h}if(this.map){var i=k.defaultFieldValue(this.keyType);if(e=k.defaultFieldValue(this.type),f=c.readVarint32(),c.remaining()<f)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+f+" required but got only "+c.remaining());var j=c.clone();for(j.limit=j.offset+f,c.offset+=f;j.remaining()>0;){var l=j.readVarint32();a=7&l;var m=l>>>3;if(1===m)i=this.keyElement.decode(j,a,m);else{if(2!==m)throw Error("Unexpected tag in map field key/value submessage");e=this.element.decode(j,a,m)}}return[i,e]}return this.element.decode(c,a,this.id)},f.Message.Field=o;var q=function(a,b,c,d,e,f,g){o.call(this,a,b,c,null,d,e,f,g),this.extension};q.prototype=Object.create(o.prototype),f.Message.ExtensionField=q;var r=function(a,b,c){g.call(this,a,b,c),this.fields=[]};f.Message.OneOf=r;var s=function(a,b,c,d,e){i.call(this,a,b,c,d,e),this.className="Enum",this.object=null};s.getName=function(a,b){for(var c,d=Object.keys(a),e=0;e<d.length;++e)if(a[c=d[e]]===b)return c;return null};var t=s.prototype=Object.create(i.prototype);t.build=function(a){if(this.object&&!a)return this.object;for(var c=new b.Builder.Enum,d=this.getChildren(s.Value),e=0,f=d.length;e<f;++e)c[d[e].name]=d[e].id;return Object.defineProperty&&Object.defineProperty(c,"$options",{value:this.buildOpt(),enumerable:!1}),this.object=c},f.Enum=s;var u=function(a,b,c,d){g.call(this,a,b,c),this.className="Enum.Value",this.id=d};u.prototype=Object.create(g.prototype),f.Enum.Value=u;var v=function(a,b,c,d){g.call(this,a,b,c),this.field=d};v.prototype=Object.create(g.prototype),f.Extension=v;var w=function(a,b,c,d){i.call(this,a,b,c,d),this.className="Service",this.clazz=null},x=w.prototype=Object.create(i.prototype);x.build=function(c){return this.clazz&&!c?this.clazz:this.clazz=function(b,c){for(var d=function(a){b.Builder.Service.call(this),this.rpcImpl=a||function(a,b,c){setTimeout(c.bind(this,Error("Not implemented, see: https://github.com/dcodeIO/ProtoBuf.js/wiki/Services")),0)}},e=d.prototype=Object.create(b.Builder.Service.prototype),f=c.getChildren(b.Reflect.Service.RPCMethod),g=0;g<f.length;g++)!function(b){e[b.name]=function(d,e){try{try{d=b.resolvedRequestType.clazz.decode(a.wrap(d))}catch(f){if(!(f instanceof TypeError))throw f}if(null===d||"object"!=typeof d)throw Error("Illegal arguments");d instanceof b.resolvedRequestType.clazz||(d=new b.resolvedRequestType.clazz(d)),this.rpcImpl(b.fqn(),d,function(a,d){if(a)return void e(a);try{d=b.resolvedResponseType.clazz.decode(d)}catch(f){}return d&&d instanceof b.resolvedResponseType.clazz?void e(null,d):void e(Error("Illegal response type received in service method "+c.name+"#"+b.name))})}catch(f){setTimeout(e.bind(this,f),0)}},d[b.name]=function(a,c,e){new d(a)[b.name](c,e)},Object.defineProperty&&(Object.defineProperty(d[b.name],"$options",{value:b.buildOpt()}),Object.defineProperty(e[b.name],"$options",{value:d[b.name].$options}))}(f[g]);return Object.defineProperty&&(Object.defineProperty(d,"$options",{value:c.buildOpt()}),Object.defineProperty(e,"$options",{value:d.$options}),Object.defineProperty(d,"$type",{value:c}),Object.defineProperty(e,"$type",{value:c})),d}(b,this)},f.Service=w;var y=function(a,b,c,d){g.call(this,a,b,c),this.className="Service.Method",this.options=d||{}},z=y.prototype=Object.create(g.prototype);z.buildOpt=j.buildOpt,f.Service.Method=y;var A=function(a,b,c,d,e,f,g,h){y.call(this,a,b,c,h),this.className="Service.RPCMethod",this.requestName=d,this.responseName=e,this.requestStream=f,this.responseStream=g,this.resolvedRequestType=null,this.resolvedResponseType=null};return A.prototype=Object.create(y.prototype),f.Service.RPCMethod=A,f}(e),e.Builder=function(a,b,d){function e(a){a.messages&&a.messages.forEach(function(b){b.syntax=a.syntax,e(b)}),a.enums&&a.enums.forEach(function(b){b.syntax=a.syntax})}var f=function(a){this.ns=new d.Namespace(this,null,""),this.ptr=this.ns,this.resolved=!1,this.result=null,this.files={},this.importRoot=null,this.options=a||{}},g=f.prototype;return f.isMessage=function(a){return"string"==typeof a.name&&("undefined"==typeof a.values&&"undefined"==typeof a.rpc)},f.isMessageField=function(a){return"string"==typeof a.rule&&"string"==typeof a.name&&"string"==typeof a.type&&"undefined"!=typeof a.id},f.isEnum=function(a){return"string"==typeof a.name&&!("undefined"==typeof a.values||!Array.isArray(a.values)||0===a.values.length)},f.isService=function(a){return!("string"!=typeof a.name||"object"!=typeof a.rpc||!a.rpc)},f.isExtend=function(a){return"string"==typeof a.ref},g.reset=function(){return this.ptr=this.ns,this},g.define=function(a){if("string"!=typeof a||!b.TYPEREF.test(a))throw Error("illegal namespace: "+a);return a.split(".").forEach(function(a){var b=this.ptr.getChild(a);null===b&&this.ptr.addChild(b=new d.Namespace(this,this.ptr,a)),this.ptr=b},this),this},g.create=function(b){if(!b)return this;if(Array.isArray(b)){if(0===b.length)return this;b=b.slice()}else b=[b];for(var c=[b];c.length>0;){if(b=c.pop(),!Array.isArray(b))throw Error("not a valid namespace: "+JSON.stringify(b));for(;b.length>0;){var e=b.shift();if(f.isMessage(e)){var g=new d.Message(this,this.ptr,e.name,e.options,e.isGroup,e.syntax),h={};e.oneofs&&Object.keys(e.oneofs).forEach(function(a){g.addChild(h[a]=new d.Message.OneOf(this,g,a))},this),e.fields&&e.fields.forEach(function(a){if(null!==g.getChild(0|a.id))throw Error("duplicate or invalid field id in "+g.name+": "+a.id);if(a.options&&"object"!=typeof a.options)throw Error("illegal field options in "+g.name+"#"+a.name);var b=null;if("string"==typeof a.oneof&&!(b=h[a.oneof]))throw Error("illegal oneof in "+g.name+"#"+a.name+": "+a.oneof);a=new d.Message.Field(this,g,a.rule,a.keytype,a.type,a.name,a.id,a.options,b,e.syntax),b&&b.fields.push(a),g.addChild(a)},this);var i=[];if(e.enums&&e.enums.forEach(function(a){i.push(a)}),e.messages&&e.messages.forEach(function(a){i.push(a)}),e.services&&e.services.forEach(function(a){i.push(a)}),e.extensions&&(g.extensions=e.extensions,g.extensions[0]<a.ID_MIN&&(g.extensions[0]=a.ID_MIN),g.extensions[1]>a.ID_MAX&&(g.extensions[1]=a.ID_MAX)),this.ptr.addChild(g),i.length>0){c.push(b),b=i,i=null,this.ptr=g,g=null;continue}i=null}else if(f.isEnum(e))g=new d.Enum(this,this.ptr,e.name,e.options,e.syntax),e.values.forEach(function(a){g.addChild(new d.Enum.Value(this,g,a.name,a.id))},this),this.ptr.addChild(g);else if(f.isService(e))g=new d.Service(this,this.ptr,e.name,e.options),Object.keys(e.rpc).forEach(function(a){var b=e.rpc[a];g.addChild(new d.Service.RPCMethod(this,g,a,b.request,b.response,(!!b.request_stream),(!!b.response_stream),b.options))},this),this.ptr.addChild(g);else{if(!f.isExtend(e))throw Error("not a valid definition: "+JSON.stringify(e));if(g=this.ptr.resolve(e.ref,!0))e.fields.forEach(function(b){if(null!==g.getChild(0|b.id))throw Error("duplicate extended field id in "+g.name+": "+b.id);if(b.id<g.extensions[0]||b.id>g.extensions[1])throw Error("illegal extended field id in "+g.name+": "+b.id+" ("+g.extensions.join(" to ")+" expected)");var c=b.name;this.options.convertFieldsToCamelCase&&(c=a.Util.toCamelCase(c));var e=new d.Message.ExtensionField(this,g,b.rule,b.type,this.ptr.fqn()+"."+c,b.id,b.options),f=new d.Extension(this,this.ptr,b.name,e);e.extension=f,this.ptr.addChild(f),g.addChild(e)},this);else if(!/\.?google\.protobuf\./.test(e.ref))throw Error("extended message "+e.ref+" is not defined")}e=null,g=null}b=null,this.ptr=this.ptr.parent}return this.resolved=!1,this.result=null,this},g["import"]=function(b,d){var f="/";if("string"==typeof d){if(a.Util.IS_NODE&&(d=c(35).resolve(d)),this.files[d]===!0)return this.reset();this.files[d]=!0}else if("object"==typeof d){var g=d.root;a.Util.IS_NODE&&(g=c(35).resolve(g)),(g.indexOf("\\")>=0||d.file.indexOf("\\")>=0)&&(f="\\");var h=g+f+d.file;if(this.files[h]===!0)return this.reset();this.files[h]=!0}if(b.imports&&b.imports.length>0){var i,j=!1;"object"==typeof d?(this.importRoot=d.root,j=!0,i=this.importRoot,d=d.file,(i.indexOf("\\")>=0||d.indexOf("\\")>=0)&&(f="\\")):"string"==typeof d?this.importRoot?i=this.importRoot:d.indexOf("/")>=0?(i=d.replace(/\/[^\/]*$/,""),""===i&&(i="/")):d.indexOf("\\")>=0?(i=d.replace(/\\[^\\]*$/,""),f="\\"):i=".":i=null;for(var k=0;k<b.imports.length;k++)if("string"==typeof b.imports[k]){if(!i)throw Error("cannot determine import root");var l=b.imports[k];if("google/protobuf/descriptor.proto"===l)continue;if(l=i+f+l,this.files[l]===!0)continue;/\.proto$/i.test(l)&&!a.DotProto&&(l=l.replace(/\.proto$/,".json"));var m=a.Util.fetch(l);if(null===m)throw Error("failed to import '"+l+"' in '"+d+"': file not found");/\.json$/i.test(l)?this["import"](JSON.parse(m+""),l):this["import"](a.DotProto.Parser.parse(m),l)}else d?/\.(\w+)$/.test(d)?this["import"](b.imports[k],d.replace(/^(.+)\.(\w+)$/,function(a,b,c){return b+"_import"+k+"."+c})):this["import"](b.imports[k],d+"_import"+k):this["import"](b.imports[k]);j&&(this.importRoot=null)}b["package"]&&this.define(b["package"]),b.syntax&&e(b);var n=this.ptr;return b.options&&Object.keys(b.options).forEach(function(a){n.options[a]=b.options[a]}),b.messages&&(this.create(b.messages),this.ptr=n),b.enums&&(this.create(b.enums),this.ptr=n),b.services&&(this.create(b.services),this.ptr=n),b["extends"]&&this.create(b["extends"]),this.reset()},g.resolveAll=function(){var c;if(null==this.ptr||"object"==typeof this.ptr.type)return this;if(this.ptr instanceof d.Namespace)this.ptr.children.forEach(function(a){this.ptr=a,this.resolveAll()},this);else if(this.ptr instanceof d.Message.Field){if(b.TYPE.test(this.ptr.type))this.ptr.type=a.TYPES[this.ptr.type];else{if(!b.TYPEREF.test(this.ptr.type))throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if(c=(this.ptr instanceof d.Message.ExtensionField?this.ptr.extension.parent:this.ptr.parent).resolve(this.ptr.type,!0),!c)throw Error("unresolvable type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if(this.ptr.resolvedType=c,c instanceof d.Enum){if(this.ptr.type=a.TYPES["enum"],"proto3"===this.ptr.syntax&&"proto3"!==c.syntax)throw Error("proto3 message cannot reference proto2 enum")}else{if(!(c instanceof d.Message))throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);this.ptr.type=c.isGroup?a.TYPES.group:a.TYPES.message}}if(this.ptr.map){if(!b.TYPE.test(this.ptr.keyType))throw Error("illegal key type for map field in "+this.ptr.toString(!0)+": "+this.ptr.keyType);this.ptr.keyType=a.TYPES[this.ptr.keyType]}}else if(this.ptr instanceof a.Reflect.Service.Method){if(!(this.ptr instanceof a.Reflect.Service.RPCMethod))throw Error("illegal service type in "+this.ptr.toString(!0));if(c=this.ptr.parent.resolve(this.ptr.requestName,!0),!(c&&c instanceof a.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.requestName);if(this.ptr.resolvedRequestType=c,c=this.ptr.parent.resolve(this.ptr.responseName,!0),!(c&&c instanceof a.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.responseName);this.ptr.resolvedResponseType=c}else if(!(this.ptr instanceof a.Reflect.Message.OneOf||this.ptr instanceof a.Reflect.Extension||this.ptr instanceof a.Reflect.Enum.Value))throw Error("illegal object in namespace: "+typeof this.ptr+": "+this.ptr);return this.reset()},g.build=function(a){if(this.reset(),this.resolved||(this.resolveAll(),this.resolved=!0,this.result=null),null===this.result&&(this.result=this.ns.build()),!a)return this.result;for(var b="string"==typeof a?a.split("."):a,c=this.result,d=0;d<b.length;d++){if(!c[b[d]]){c=null;break}c=c[b[d]]}return c},g.lookup=function(a,b){return a?this.ns.resolve(a,b):this.ns},g.toString=function(){return"Builder"},f.Message=function(){},f.Enum=function(){},f.Service=function(){},f}(e,e.Lang,e.Reflect),e.Map=function(a,b){function c(a){var b=0;return{next:function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}}}var d=function(a,c){if(!a.map)throw Error("field is not a map");if(this.field=a,this.keyElem=new b.Element(a.keyType,null,(!0),a.syntax),this.valueElem=new b.Element(a.type,a.resolvedType,(!1),a.syntax),this.map={},Object.defineProperty(this,"size",{get:function(){return Object.keys(this.map).length}}),c)for(var d=Object.keys(c),e=0;e<d.length;e++){var f=this.keyElem.valueFromString(d[e]),g=this.valueElem.verifyValue(c[d[e]]);this.map[this.keyElem.valueToString(f)]={key:f,value:g}}},e=d.prototype;return e.clear=function(){this.map={}},e["delete"]=function(a){var b=this.keyElem.valueToString(this.keyElem.verifyValue(a)),c=b in this.map;return delete this.map[b],c},e.entries=function(){for(var a,b=[],d=Object.keys(this.map),e=0;e<d.length;e++)b.push([(a=this.map[d[e]]).key,a.value]);return c(b)},e.keys=function(){for(var a=[],b=Object.keys(this.map),d=0;d<b.length;d++)a.push(this.map[b[d]].key);return c(a)},e.values=function(){for(var a=[],b=Object.keys(this.map),d=0;d<b.length;d++)a.push(this.map[b[d]].value);return c(a)},e.forEach=function(a,b){for(var c,d=Object.keys(this.map),e=0;e<d.length;e++)a.call(b,(c=this.map[d[e]]).value,c.key,this)},e.set=function(a,b){var c=this.keyElem.verifyValue(a),d=this.valueElem.verifyValue(b);return this.map[this.keyElem.valueToString(c)]={key:c,value:d},this},e.get=function(a){var b=this.keyElem.valueToString(this.keyElem.verifyValue(a));if(b in this.map)return this.map[b].value},e.has=function(a){var b=this.keyElem.valueToString(this.keyElem.verifyValue(a));return b in this.map},d}(e,e.Reflect),e.loadProto=function(a,b,c){return("string"==typeof b||b&&"string"==typeof b.file&&"string"==typeof b.root)&&(c=b,b=void 0),e.loadJson(e.DotProto.Parser.parse(a),b,c)},e.protoFromString=e.loadProto,e.loadProtoFile=function(a,b,c){if(b&&"object"==typeof b?(c=b,b=null):b&&"function"==typeof b||(b=null),b)return e.Util.fetch("string"==typeof a?a:a.root+"/"+a.file,function(d){if(null===d)return void b(Error("Failed to fetch file"));try{b(null,e.loadProto(d,c,a))}catch(f){b(f)}});var d=e.Util.fetch("object"==typeof a?a.root+"/"+a.file:a);return null===d?null:e.loadProto(d,c,a)},e.protoFromFile=e.loadProtoFile,e.newBuilder=function(a){return a=a||{},"undefined"==typeof a.convertFieldsToCamelCase&&(a.convertFieldsToCamelCase=e.convertFieldsToCamelCase),"undefined"==typeof a.populateAccessors&&(a.populateAccessors=e.populateAccessors),new e.Builder(a)},e.loadJson=function(a,b,c){return("string"==typeof b||b&&"string"==typeof b.file&&"string"==typeof b.root)&&(c=b,b=null),b&&"object"==typeof b||(b=e.newBuilder()),"string"==typeof a&&(a=JSON.parse(a)),b["import"](a,c),b.resolveAll(),b},e.loadJsonFile=function(a,b,c){if(b&&"object"==typeof b?(c=b,b=null):b&&"function"==typeof b||(b=null),b)return e.Util.fetch("string"==typeof a?a:a.root+"/"+a.file,function(d){if(null===d)return void b(Error("Failed to fetch file"));try{b(null,e.loadJson(JSON.parse(d),c,a))}catch(f){b(f)}});var d=e.Util.fetch("object"==typeof a?a.root+"/"+a.file:a);return null===d?null:e.loadJson(JSON.parse(d),c,a)},e})}).call(b,c(61))},function(a,b,c){var d,e;d=[c(0),c(1),c(4),c(12),c(2),c(76),c(75)],e=function(a,b,c,d,e,f,g){"use strict";function h(a,e,h,i){b.isStringNotEmpty(a,"uri"),b.isString(e,"deviceId"),b.isStringNotEmpty(h,"version"),b.isObject(i,"logger"),this._deviceId=e,this._version=h,this._logger=i,this._mqWebSocket=new d.MQWebSocket(a,this._logger,[f,g]),this._observableSessionId=new c.Observable(null).extend({rateLimit:0})}return h.prototype.onEvent=function(a,b){return this._mqWebSocket.onEvent(a,b)},h.prototype.disconnect=function(){return this._observableSessionId.setValue(null),this._mqWebSocket.disconnect()},h.prototype.authenticate=function(a,c){b.isStringNotEmpty(a,"authToken"),b.isFunction(c,"callback");var d={apiVersion:this._mqWebSocket.getApiVersion(),clientVersion:this._version,deviceId:this._deviceId,platform:e.browser,platformVersion:e.browserVersion.toString(),authenticationToken:a};this.getSessionId()&&(d.sessionId=this.getSessionId());
var f=this;return this._mqWebSocket.sendRequest("pcast.Authenticate",d,function(a,b){return b&&f._observableSessionId.setValue(b.sessionId),c(a,b)})},h.prototype.getSessionId=function(){return this._observableSessionId.getValue()},h.prototype.getObservableSessionId=function(){return this._observableSessionId},h.prototype.bye=function(a,c){b.isStringNotEmpty(a,"reason"),b.isFunction(c,"callback");var d={sessionId:this.getSessionId(),reason:a};return this._mqWebSocket.sendRequest("pcast.Bye",d,c)},h.prototype.setupStream=function(a,c,d,f){b.isStringNotEmpty(a,"streamType"),b.isStringNotEmpty(c,"streamToken"),b.isObject(d,"options"),b.isFunction(f,"callback");var g=e.browser||"UnknownBrowser",h=g+"-"+(e.browserVersion||0),i={streamToken:c,createStream:{sessionId:this.getSessionId(),options:["data-quality-notifications"],connectUri:d.connectUri,connectOptions:d.connectOptions||[],tags:d.tags||[]}};return d.negotiate&&(i.createStream.createOfferDescription={streamId:"",options:[a,g,h],apiVersion:this._mqWebSocket.getApiVersion()}),d.receiveAudio===!1&&i.createStream.options.push("no-audio"),d.receiveVideo===!1&&i.createStream.options.push("no-video"),this._mqWebSocket.sendRequest("pcast.SetupStream",i,f)},h.prototype.setAnswerDescription=function(a,c,d){b.isStringNotEmpty(a,"streamId"),b.isStringNotEmpty(c,"sdp"),b.isFunction(d,"callback");var e={streamId:a,sessionDescription:{type:"Answer",sdp:c},apiVersion:this._mqWebSocket.getApiVersion()};return this._mqWebSocket.sendRequest("pcast.SetRemoteDescription",e,d)},h.prototype.addIceCandidates=function(c,d,e,f){b.isStringNotEmpty(c,"streamId"),b.isArray(d,"candidates"),b.isObject(e,"options"),b.isFunction(f,"callback");var g=a.map(d,function(a,c){return b.isStringNotEmpty(a.candidate,"candidate["+c+"].candidate"),b.isNumber(a.sdpMLineIndex,"candidate["+c+"].sdpMLineIndex"),b.isStringNotEmpty(a.sdpMid,"candidate["+c+"].sdpMid"),{candidate:a.candidate,sdpMLineIndex:a.sdpMLineIndex,sdpMid:a.sdpMid}}),h={streamId:c,candidates:g,options:e,apiVersion:this._mqWebSocket.getApiVersion()};return this._mqWebSocket.sendRequest("pcast.AddIceCandidates",h,f)},h.prototype.updateStreamState=function(a,c,d,e,f){b.isStringNotEmpty(a,"streamId"),b.isStringNotEmpty(c,"signalingState"),b.isStringNotEmpty(d,"iceGatheringState"),b.isStringNotEmpty(e,"iceConnectionState"),b.isFunction(f,"callback");var g={streamId:a,signalingState:c,iceGatheringState:d,iceConnectionState:e,apiVersion:this._mqWebSocket.getApiVersion()};return this._mqWebSocket.sendRequest("pcast.UpdateStreamState",g,f)},h.prototype.destroyStream=function(a,c,d){b.isStringNotEmpty(a,"streamId"),b.isString(c,"reason"),b.isFunction(d,"callback");var e={streamId:a,reason:c};return this._mqWebSocket.sendRequest("pcast.DestroyStream",e,d)},h.prototype.getRoomInfo=function(a,c,d){a?b.isString(a,"roomId"):b.isString(c,"alias"),b.isFunction(d,"callback");var e={roomId:a,alias:c,sessionId:this.getSessionId()};return this._mqWebSocket.sendRequest("chat.GetRoomInfo",e,d)},h.prototype.createRoom=function(a,c){b.isObject(a,"room"),b.isStringNotEmpty(a.name,"room.name"),b.isStringNotEmpty(a.type,"room.type"),b.isStringNotEmpty(a.description,"room.description"),b.isFunction(c,"callback");var d={sessionId:this.getSessionId(),room:a};return this._mqWebSocket.sendRequest("chat.CreateRoom",d,c)},h.prototype.enterRoom=function(a,c,d,e,f){a?b.isString(a,"roomId"):b.isString(c,"alias"),b.isObject(d,"member"),b.isNumber(e,"timestamp"),b.isFunction(f,"callback");var g={roomId:a,alias:c,sessionId:this.getSessionId(),member:d,timestamp:e};return this._mqWebSocket.sendRequest("chat.JoinRoom",g,f)},h.prototype.leaveRoom=function(a,c,d){b.isString(a,"roomId"),b.isNumber(c,"timestamp"),b.isFunction(d,"callback");var e={roomId:a,sessionId:this.getSessionId(),timestamp:c};return this._mqWebSocket.sendRequest("chat.LeaveRoom",e,d)},h.prototype.updateMember=function(a,c,d){b.isObject(a,"member"),b.isNumber(c,"timestamp"),b.isFunction(d,"callback"),a.updateStreams=a.hasOwnProperty("streams");var e={sessionId:this.getSessionId(),member:a,timestamp:c};return this._mqWebSocket.sendRequest("chat.UpdateMember",e,d)},h.prototype.updateRoom=function(a,c,d){b.isObject(a,"room"),b.isNumber(c,"timestamp"),b.isFunction(d,"callback");var e={sessionId:this.getSessionId(),room:a,timestamp:c};return this._mqWebSocket.sendRequest("chat.UpdateRoom",e,d)},h.prototype.sendMessageToRoom=function(a,c,d){b.isStringNotEmpty(a,"roomId"),b.isObject(c,"chatMessage");var e={roomId:a,chatMessage:c};return this._mqWebSocket.sendRequest("chat.SendMessageToRoom",e,d)},h.prototype.subscribeToRoomConversation=function(a,c,d,e){b.isStringNotEmpty(a,"sessionId"),b.isStringNotEmpty(c,"roomId"),b.isNumber(d,"batchSize");var f={sessionId:a,roomId:c,limit:d,options:["Subscribe"]};return this._mqWebSocket.sendRequest("chat.FetchRoomConversation",f,e)},h.prototype.getMessages=function(a,c,d,e,f,g){b.isStringNotEmpty(a,"sessionId"),b.isStringNotEmpty(c,"roomId"),f&&e||b.isNumber(d,"batchSize");var h={sessionId:a,roomId:c,limit:d||0,options:[]};return f&&(b.isStringNotEmpty(f,"beforeMessageId"),h.beforeMessageId=f),e&&(b.isStringNotEmpty(e,"afterMessageId"),h.afterMessageId=e),this._mqWebSocket.sendRequest("chat.FetchRoomConversation",h,g)},h.prototype.toString=function(){return"PCastProtocol["+this._mqWebSocket.toString()+"]"},h}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(2)],e=function(a,b,c){"use strict";function d(a,c,d){b.isString(a,"name"),b.isObject(c,"peerConnection"),b.isObject(d,"logger"),this._name=a,this._peerConnection=c,this._logger=d}function e(b,d,e,g,m){function r(C){var D=null;h.call(s,d,D,g,function(h){function D(a,d){var g=a.id||a.ssrc,h=null;if(a.framesEncoded){var i=new f(a.framesEncoded);a.framerateMean=n(i,A[g],2*s._frameRateFailureThreshold),A[g]=i}switch(c.browser){case"Safari":case"Firefox":case"Edge":case"IE":if(I=H|=a.selected&&"succeeded"===a.state||"IE"===c.browser||"Edge"===c.browser||"Safari"===c.browser,"outbound"===e.direction&&("outboundrtp"===a.type||"outbound-rtp"===a.type||"kOutboundRtp"===a.type))switch(h=new f(a.bytesSent),a.mediaType){case"video":s._logger.debug("[%s] Outbound [%s] [%s] with bitrate [%s], droppedFrames [%s] and frame rate [%s]",b,a.mediaType,a.ssrc,a.bitrateMean,a.droppedFrames,a.framerateMean),E=!0,u=a.framerateMean||0,F=!0,v=o(h,z[g],2*s._videoBitRateFailureThreshold),z[g]=h;break;case"audio":s._logger.debug("[%s] Outbound [%s] [%s]",b,a.mediaType,a.ssrc),G=!0,w=o(h,y[g],2*s._audioBitRateFailureThreshold),y[g]=h}if("inbound"===e.direction&&("inboundrtp"===a.type||"inbound-rtp"===a.type||"kInboundRtp"===a.type))switch(h=new f(a.bytesReceived),a.mediaType){case"video":s._logger.debug("[%s] Inbound [%s] [%s] with framerate [%s] and jitter [%s]",b,a.mediaType,a.ssrc,a.framerateMean,a.jitter),F=!0,v=o(h,z[g],2*s._videoBitRateFailureThreshold),z[g]=h;break;case"audio":s._logger.debug("[%s] Inbound [%s] [%s] with jitter [%s]",b,a.mediaType,a.ssrc,a.jitter),G=!0,w=o(h,y[g],2*s._audioBitRateFailureThreshold),y[g]=h}break;case"Chrome":default:if("true"===a.googWritable&&(I=!0),"true"===a.googReadable&&(H=!0),"ssrc"!==a.type)return;if("outbound"===e.direction)switch(h=new f(a.bytesSent),a.mediaType){case"video":s._logger.debug("[%s] Outbound [%s] [%s] with average encoding time [%s] ms (CPU limited=[%s]) and RTT [%s]",b,a.mediaType,a.ssrc,a.googAvgEncodeMs,a.googCpuLimitedResolution,a.googRtt),E=!0,u=a.googFrameRateSent||0,F=!0,v=o(h,z[g],2*s._videoBitRateFailureThreshold),z[g]=h;break;case"audio":s._logger.debug("[%s] Outbound [%s] [%s] with audio input level [%s] and RTT [%s] and jitter [%s]",b,a.mediaType,a.ssrc,a.audioInputLevel,a.googRtt,a.googJitterReceived),G=!0,w=o(h,y[g],2*s._audioBitRateFailureThreshold),y[g]=h}else if("inbound"===e.direction)switch(h=new f(a.bytesReceived),a.mediaType){case"video":s._logger.debug("[%s] Inbound [%s] [%s] with current delay [%s] ms and target delay [%s] ms",b,a.mediaType,a.ssrc,a.googCurrentDelayMs,a.googTargetDelayMs),E=!0,u=a.googFrameRateReceived||0,F=!0,v=o(h,z[g],2*s._videoBitRateFailureThreshold),z[g]=h;break;case"audio":s._logger.debug("[%s] Inbound [%s] [%s] with output level [%s] and jitter [%s] and jitter buffer [%s] ms",b,a.mediaType,a.ssrc,a.audioOutputLevel,a.googJitterReceived,a.googJitterBufferMs),G=!0,w=o(h,y[g],2*s._audioBitRateFailureThreshold),y[g]=h}}}var E=!1,F=!1,G=!1,H=!1,I=!1;if(!g())return s._logger.info("[%s] Finished monitoring of peer connection",b);if(!h)throw new Error("Report must be a valid PeerConnection.getStats Report");h.forEach?h.forEach(D):a.forOwn(h,function(a,b){D(a,b)});var J=k(d),K=l(d);if((F&&0===v||G&&0===w||E&&0===u)&&(F=F&&K,G=G&&J,E=E&&K,H=H||!(K||J),I=I||!(K||J)),(G||F||E)&&s._logger.debug("[%s] Current bit rate is [%s] bps for audio and [%s] bps for video with [%s] FPS",b,Math.ceil(w||0),Math.ceil(v||0),u||"?"),!s._monitorState||"closed"!==d.connectionState&&"failed"!==d.connectionState&&"failed"!==d.iceConnectionState)s._monitorFrameRate&&E&&u<=s._frameRateFailureThreshold&&!q.call(s,"video")?t++:s._monitorBitRate&&G&&w<=s._audioBitRateFailureThreshold&&!q.call(s,"audio")?t++:s._monitorBitRate&&F&&v<=s._videoBitRateFailureThreshold&&!q.call(s,"video")?t++:H&&I?t=0:t++;else{var L=J&&K,M=i.call(s,d);if(!L&&j(d))return void s._logger.info("[%s] Finished monitoring of peer connection with [%s] inactive tracks",b,M.length);t++}var N=!(0!==v&&F||0!==w&&G||p.call(s));N&&!B?B=setTimeout(a.bind(r,this,!0),x):N||(clearTimeout(B),B=null);var O=C&&N&&B;if(t>=s._conditionCountForNotificationThreshold||O)if(m("condition",u,v,w))t=Number.MIN_VALUE,setTimeout(r,s._monitoringInterval);else{if(O)return s._logger.error("[%s] Failure detected with 0 bps audio and video for [%s] seconds",b,x/1e3);s._logger.error("[%s] Failure detected with frame rate [%s] FPS and bit rate [%s/%s] bps: [%s]",b,u,w,v,h)}else setTimeout(r,t>0?s._conditionMonitoringInterval:s._monitoringInterval)},function(a){m("error",a)})}var s=this,t=0,u=void 0,v=void 0,w=void 0,y={},z={},A={},B=null;setTimeout(r,s._monitoringInterval)}function f(b){this.time=a.now(),this.value=b||0}function g(b){var d={};switch(c.browser){case"Firefox":return b;case"IE":return a.forOwn(b,function(b,c){a.startsWith(c,"ssrc")&&(d[b.id]=b)}),d;case"Safari":case"Edge":return b.forEach(function(a){d[a.id]=a}),d;case"Chrome":default:return b.result().forEach(function(a){var b={id:a.id,type:a.type};a.names().forEach(function(c){b[c]=a.stat(c)}),d[b.id]=b}),d}}function h(a,b,d,e,f){return d()?void c.getStats(a,null,function(a){var b=g(a);e(b)},function(a){f("error",a)}):this._logger.info("[%s] Finished monitoring of peer connection",this._name)}function i(b){var c=b.getLocalStreams(),d=b.getRemoteStreams(),e=[],f=[];if(a.forEach(c,function(a){e=e.concat(a.getTracks())}),a.forEach(d,function(a){f=f.concat(a.getTracks())}),0!==e.length&&0!==f.length)throw this._logger.error("Invalid State. PeerConnection contains [%s] local and [%s] remote streams.",c.length,d.length),new Error("Invalid State. PeerConnection contains both local and remote streams.");return 0!==e.length?e:0!==f.length?f:[]}function j(b){var c=m(b,function(b){return a.startsWith(b,"video")||a.startsWith(b,"audio")});return a.isNumber(c)}function k(b){var c=m(b,function(b,c,d){return!!a.startsWith(b,"audio")&&(!a.includes(b,"a=inactive")&&!a.includes(d[c],"a=inactive"))});return a.isNumber(c)}function l(b){var c=m(b,function(b,c,d){return!!a.startsWith(b,"video")&&(!a.includes(b,"a=inactive")&&!a.includes(d[c],"a=inactive"))});return a.isNumber(c)}function m(b,c){var d=b.localDescription.sdp.split("m="),e=b.remoteDescription.sdp.split("m=");return d.length===e.length&&a.findIndex(d,function(a,b){return c(a,b,e)})}function n(a,b,c){return b?(a.value-b.value)/((a.time-b.time)/1e3):c}function o(a,b,c){return b?8*(a.value-b.value)/((a.time-b.time)/1e3):c}function p(){var b=this;return a.reduce(i(this._peerConnection),function(c,d){if(!c)return c;var e=!!a.find(b._pausedTracks,function(a){return a.id===d.id});return!d.enabled||e},!0)}function q(b){var c=i(this._peerConnection),d=a.filter(c,function(a){return a.kind===b}),e=a.filter(this._pausedTracks,function(a){return a.kind===b});return a.reduce(d,function(b,c){if(!b)return b;var d=!!a.find(e,function(a){return a.id===c.id});return!c.enabled||d},!0)}var r=4e3,s=1500,t=2,u=5e3,v=6e3,w=3,x=5e3;return d.prototype.start=function(a,c,d){if(b.isObject(a,"options"),b.isFunction(c,"activeCallback"),b.isFunction(d,"monitorCallback"),"inbound"!==a.direction&&"outbound"!==a.direction)throw new Error("Invalid monitoring direction");return this._frameRateFailureThreshold=a.frameRateThreshold||t,this._videoBitRateFailureThreshold=a.videoBitRateThreshold||v,this._audioBitRateFailureThreshold=a.audioBitRateThreshold||u,this._conditionCountForNotificationThreshold=a.conditionCountForNotificationThreshold||w,this._monitoringInterval=a.monitoringInterval||r,this._conditionMonitoringInterval=a.monitoringInterval||s,this._monitorFrameRate=!a.hasOwnProperty("monitorFrameRate")||a.monitorFrameRate,this._monitorBitRate=!a.hasOwnProperty("monitorBitRate")||a.monitorBitRate,this._monitorState=!a.hasOwnProperty("monitorState")||a.monitorState,this._pausedTracks=[],e.call(this,this._name,this._peerConnection,a,c,d)},d.prototype.setMonitorTrackState=function(c,d){b.isObject(c,"track"),b.isBoolean(d,"state");var e=i(this._peerConnection),f=!!a.find(e,function(a){return a.id===c.id});if(!f)return this._logger.warn("[%s] Unable to find track [%s] [%s] in peer connection",this._name,c.kind,c.id);if(!d)return this._logger.info("[%s] Pausing monitoring of track [%s] [%s]",this._name,c.kind,c.id),this._pausedTracks.push(c);var g=this._pausedTracks.length;this._pausedTracks=a.filter(this._pausedTracks,function(a){return a.id!==c.id}),g!==this._pausedTracks.length&&this._logger.info("[%s] Starting monitoring of track [%s] [%s] after it was paused",this._name,c.kind,c.id)},d.prototype.toString=function(){return"PeerConnectionMonitor["+this._name+"]"},d}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";function a(){this.init()}return a.prototype.init=function(){if(!window.AudioContext&&!window.webkitAudioContext)throw new Error("Browser does not support AudioContext");this._audioContext=new(window.AudioContext||window.webkitAudioContext)},a.prototype.getNativeAudioContext=function(){return this._audioContext},a.prototype.toString=function(){return"AudioContext"},a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1)],e=function(a,b){"use strict";function c(a){b.isObject(a,"logger"),this._logger=a,this.init()}function d(c,d){b.isObject(c,"audioVolumeMeter"),d=d||{};var g=this,h=!1,i=d.speakingHysteresisInterval||e,j=d.silenceHysteresisInterval||f;b.isNumber(i,"options.speakingHysteresisInterval"),b.isNumber(j,"options.silenceHysteresisInterval");var k=!1,l=a.now()+i,m=a.now()+j;c.onValue(function(d){if(!h){b.isObject(c,"audioVolumeMeter"),b.isNumber(d.date,"value.date"),b.isNumber(d.value,"value.value"),b.isNumber(d.smoothedValue,"value.smoothedValue"),b.isNumber(d.smoothedPeakValue,"value.smoothedPeakValue"),b.isNumber(d.clipped,"value.clipped");var e=d.value>.01&&d.value>2*d.smoothedValue&&d.value>.25*d.smoothedPeakValue,f=d.value>.8*d.smoothedValue,n=d.value<.5*d.smoothedValue,o=!e;(e||k&&f)&&l<d.date?(m=a.utc(d.date)+j,k||(k=!0,g._logger.info("Speaking detected"),g._callback&&g._callback("speaking"))):(n||!k&&o)&&m<d.date&&(l=a.utc(d.date)+i,k&&(k=!1,g._logger.info("Silence detected"),g._callback&&g._callback("silence")))}})}var e=50,f=1500;return c.prototype.init=function(){},c.prototype.onValue=function(a){this._callback=a},c.prototype.startDetection=function(a,b){var c=this;return d.call(c,a,b)},c.prototype.toString=function(){return"AudioSpeakerDetection"},c}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1)],e=function(a,b){"use strict";function c(a){b.isObject(a,"logger"),this._logger=a}function d(b){for(var c=b.inputBuffer.getChannelData(0),d=0,e=0,f=0;f<c.length;f++)d+=c[f]*c[f],Math.abs(c[f])>.99&&e++;this._value=Math.sqrt(d/c.length),this._smoothedValue=this._alpha*this._value+(1-this._alpha)*this._smoothedValue,this._smoothedPeakValue=Math.max(this._value,this._alpha*this._value+(1-this._alpha)*this._smoothedPeakValue),this._clipped=e,this._callback&&this._callback.call(this,{date:a.now(),value:this._value,smoothedValue:this._smoothedValue,smoothedPeakValue:this._smoothedPeakValue,clipped:this._clipped})}function e(a){b.isObject(a,"stream");var c=this;a.getAudioTracks().length>0?(c._mediaStreamSource=c._context.createMediaStreamSource(a),c._mediaStreamSource.connect(c._scriptProcessor),c._scriptProcessor.connect(c._context.destination)):c._logger.info("Stream has no audio tracks")}function f(){this._mediaStreamSource&&this._mediaStreamSource.disconnect(),this._scriptProcessor.disconnect()}var g=1/16;return c.prototype.init=function(c,e){b.isObject(c,"context"),b.isFunction(c.createScriptProcessor,"context.createScriptProcessor"),e=parseFloat(e||g),b.isNumber(e,"alpha"),this._context=c,this._alpha=e,this._value=0,this._smoothedValue=0,this._smoothedPeakValue=0,this._clipped=0,this._scriptProcessor=c.createScriptProcessor(4096,1,1),a.addEventListener(this._scriptProcessor,"audioprocess",a.bind(d,this))},c.prototype.onValue=function(a){this._callback=a},c.prototype.getValue=function(){return this._value},c.prototype.getSmoothedValue=function(){return this._smoothedValue},c.prototype.getSmoothedPeakValue=function(){return this._smoothedPeakValue},c.prototype.setAlpha=function(a){b.isNumber(a,"alpha"),this._alpha=parseFloat(a)},c.prototype.connect=function(a){var b=this;return e.call(b,a)},c.prototype.stop=function(){return f.call(this)},c.prototype.toString=function(){return"AudioVolumeMeter"},c}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(67)],e=function(a,b,c){"use strict";function d(a){b.isObject(a,"logger"),this._logger=a,this._audioVolumeMeters={}}return d.prototype.stopAllMeters=function(){a.forOwn(this._audioVolumeMeters,function(a){a.stop()})},d.prototype.getAudioVolumeMeter=function(a){return b.isObject(a,"stream"),b.isStringNotEmpty(a.id,"streamId"),this._audioVolumeMeters[a.id]||(this._audioVolumeMeters[a.id]=new c(this._logger)),this._audioVolumeMeters[a.id]},d.prototype.getAudioVolumeMeters=function(){return a.values(this._audioVolumeMeters)},d.prototype.toString=function(){return"AudioVolumeMeterFactory"},d}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1)],e=function(a,b){"use strict";function c(a){this.init(a)}function d(b,c){if(this._membersSubscription&&this._membersSubscription.dispose(),!c)return this._publisher.limitBandwidth(b);var d=c.getObservableMembers();this._membersSubscription=d.subscribe(a.bind(e,this,b),{initial:"notify"})}function e(a,b){if(b.length!==this._roomMemberCount){this._roomMemberCount=b.length;var c=a/Math.max(1,this._roomMemberCount-1);this._publisher.limitBandwidth(c)}}var f=5e6;return c.prototype.init=function(a){b.isObject(a,"publisher"),this._publisher=a,this._roomMemberCount=0,this._roomSubscription=null,this._membersSubscription=null},c.prototype.connect=function(c,e){b.isObject(c,"roomService"),e=e||{};var g=c.getObservableActiveRoom(),h=e.roomBandwidthLimit||f;this._roomSubscription=g.subscribe(a.bind(d,this,h),{initial:"notify"})},c.prototype.close=function(){this._roomSubscription&&this._roomSubscription.dispose(),this._membersSubscription&&this._membersSubscription.dispose(),this._roomSubscription=null,this._membersSubscription=null},c.prototype.toString=function(){return"PublisherBandwidthAdjuster"},c}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(4),c(3),c(27)],e=function(a,b,c,d,e){"use strict";function f(a){b.isObject(a,"pcast"),b.isFunction(a.getLogger,"pcast.getLogger"),b.isFunction(a.getProtocol,"pcast.getProtocol"),this._pcast=a,this._logger=a.getLogger(),this._protocol=a.getProtocol(),this._enabled=new c.Observable((!1)),this._lastSubscribedSessionId=null,b.isObject(this._logger,"this._logger"),b.isObject(this._protocol,"this._protocol"),this._authService=new e(this._pcast)}function g(){var b=this._authService.getObservableStatus().subscribe(a.bind(j,this)),c=this._authService.getObservableSessionId().subscribe(a.bind(k,this));this._disposables.add(b),this._disposables.add(c)}function h(a,b){var c=this;this._roomMessagesListeners[a]=b;var e=new d.Disposable(function(){c._roomMessagesListeners[a]===b&&delete c._roomMessagesListeners[a]});return this._disposables.add(e),e}function i(a){switch(b.isObject(a,"event"),b.isStringNotEmpty(a.roomId,"event.roomId"),b.isStringNotEmpty(a.eventType,"event.eventType"),b.isArray(a.chatMessages,"event.chatMessages"),a.eventType){case"Message":this._logger.debug("[%s] Room messages [%s]",a.roomId,a.chatMessages);var c=this._roomMessagesListeners[a.roomId];q(a.chatMessages),c&&c(null,{status:"ok",chatMessages:a.chatMessages});break;default:this._logger.warn("Unsupported room conversation event [%s]",a.eventType)}}function j(a){}function k(a){this._lastSubscribedSessionId&&this._lastSubscribedSessionId!==a&&l.call(this)}function l(){var b=this;a.forOwn(this._roomMessagesListeners,function(a,c){n.call(b,c,1)})}function m(a,c,d,e,f){b.isStringNotEmpty(a,"roomId"),b.isFunction(f,"callback"),e&&d||b.isNumber(c,"batchSize"),e&&b.isStringNotEmpty(e,"beforeMessageId"),d&&b.isStringNotEmpty(d,"afterMessageId"),p.call(this),this._authService.assertAuthorized();var g=this._authService.getPCastSessionId();this._logger.info("Get messages from room [%s] conversation with batch size of [%s], after [%s], and before [%s]",a,c,d,e);var h=this;this._protocol.getMessages(g,a,c,d,e,function(a,b){if(a)return h._logger.error("Get messages from room conversation failed with error [%s]",a),f(a,null);var c={status:b.status};return"ok"!==b.status?(h._logger.warn("Get messages from room conversation failed with status [%s]",b.status),f(null,c)):(c.chatMessages=b.chatMessages,q(c.chatMessages),void f(null,c))})}function n(a,c){b.isStringNotEmpty(a,"roomId"),b.isNumber(c,"batchSize"),p.call(this),this._authService.assertAuthorized();var d=this._authService.getPCastSessionId();this._lastSubscribedSessionId=d,this._logger.info("Subscribe to room [%s] conversation with batch size of [%s]",a,c);var e=this;this._protocol.subscribeToRoomConversation(d,a,c,function(b,c){var d=e._roomMessagesListeners[a];if(!d)return e._logger.warn("No subscription callback set for room [%s]",a);if(b)return e._logger.error("Subscribe to room conversation failed with error [%s]",b),d(b,null);var f={status:c.status};return"ok"!==c.status?(delete e._roomMessagesListeners[a],e._logger.warn("Subscribe to room conversation failed with status [%s]",c.status),d(null,f)):(f.chatMessages=c.chatMessages,q(f.chatMessages),void d(null,f))})}function o(a,c,d,e,f,g){b.isStringNotEmpty(a,"roomId"),b.isStringNotEmpty(c,"screenName"),b.isStringNotEmpty(d,"role"),b.isNumber(e,"lastUpdate"),b.isStringNotEmpty(f,"message"),b.isFunction(g,"callback"),p.call(this),this._authService.assertAuthorized();var h=this._authService.getPCastSessionId(),i={messageId:"",timestamp:0,from:{sessionId:h,screenName:c,role:d,lastUpdate:e},message:f};this._logger.info("Send message to room [%s] from [%s]",a,c);var j=this;return this._protocol.sendMessageToRoom(a,i,function(a,b){if(a)return j._logger.error("Send message to room failed with error [%s]",a),g(a,null);var c={status:b.status};"ok"!==b.status&&j._logger.warn("Send message to room failed with status [%s]",b.status),g(null,c)})}function p(){if(!this._enabled.getValue())throw new Error("ChatService not Enabled. Please start before performing actions.")}function q(b){a.forEach(b,function(a){r(a)})}function r(b){b.timestamp&&(b.timestamp=a.utc(b.timestamp)),b.from&&(b.from.lastUpdate=a.utc(b.from.lastUpdate))}return f.prototype.start=function(){if(!this._enabled.getValue()){this._disposables=new d.DisposableList,this._roomMessagesListeners={},this._enabled.setValue(!0),g.call(this);var b=this._protocol.onEvent("chat.RoomConversationEvent",a.bind(i,this));this._disposables.add(b)}},f.prototype.stop=function(){this._enabled.getValue()&&this._disposables&&this._disposables.dispose()},f.prototype.getObservableChatEnabled=function(){return this._enabled},f.prototype.sendMessageToRoom=function(a,b,c,d,e,f){o.call(this,a,b,c,d,e,f)},f.prototype.subscribeAndLoadMessages=function(a,b,c){var d=h.call(this,a,c);return n.call(this,a,b),d},f.prototype.getMessages=function(a,b,c,d,e){m.call(this,a,b,c,d,e)},f.prototype.toString=function(){return"ChatService"},f}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(4),c(3),c(70)],e=function(a,b,c,d,e){"use strict";function f(a){b.isObject(a,"roomService"),b.isObject(a._pcast,"roomService._pcast"),b.isObject(a._logger,"roomService._logger"),this._roomService=a,this._pcast=a._pcast,this._logger=a._logger,this._chatService=new e(this._pcast),this._chatMessages=new c.ObservableArray([]),this._latestMessageQueue=[],this._disposables=new d.DisposableList,this._chatRoomId=null}function g(a){a&&this._chatRoomId===a.getRoomId()||(j.call(this),a&&i.call(this))}function h(){var b=this._roomService.getObservableActiveRoom().subscribe(a.bind(g,this));this._disposables.add(b)}function i(){j.call(this),this._roomChatSubscription=k.call(this,this._batchSize)}function j(){this._roomChatSubscription&&this._roomChatSubscription.dispose&&this._roomChatSubscription.dispose()}function k(b){var c=this._roomService.getObservableActiveRoom().getValue(),d=c.getRoomId();this._chatRoomId=d;var e=this;return this._chatMessages.setValue([]),this._chatService.subscribeAndLoadMessages(d,b,function(b,c){if(b)throw b;if("ok"!==c.status)throw new Error("Unable to subscribe to room chat. Status "+status);var d=e._chatMessages.getValue();a.forEach(c.chatMessages,function(a){d.push(a)}),d.length>m&&d.splice(0,d.length-m),e._chatMessages.setValue(d)})}var l=0,m=100;return f.prototype.start=function(a){this._batchSize=a||l,this._chatService.start(),h.call(this),i.call(this)},f.prototype.stop=function(){this._chatService.stop(),j.call(this),this._disposables&&this._disposables.dispose()},f.prototype.getObservableChatMessages=function(){return this._chatMessages},f.prototype.getObservableChatEnabled=function(){return this._chatService.getObservableChatEnabled()},f.prototype.sendMessageToRoom=function(a,b){var c=this._roomService.getObservableActiveRoom().getValue(),d=c.getRoomId(),e=this._roomService._self.getValue(),f=e.getObservableScreenName().getValue(),g=e.getObservableRole().getValue(),h=e.getLastUpdate();this._chatService.sendMessageToRoom(d,f,g,h,a,b)},f.prototype.getMessages=function(a,b,c,d){var e=this._roomService.getObservableActiveRoom().getValue(),f=e.getRoomId();return this._chatService.getMessages(f,a,b,c,d)},f.prototype.toString=function(){return"RoomChatService"},f}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1)],e=function(a,b){"use strict";function c(a,c){a&&b.isStringNotEmpty(a,"selectionStrategy"),b.isObject(c,"logger"),this._selectionStrategy=a||p,this._logger=c,this._lastSelectedMember=null,this._blackListedMembers=[]}function d(b){return!!a.find(this._blackListedMembers,function(a){return a.key===g(b)})}function e(b){b&&this._blackListedMembers.push({key:g(b),timestamp:a.now()})}function f(){var b=a.reduce(this._blackListedMembers,function(b,c){return b+a.now()-c.timestamp},0);return b>r}function g(a){return a?a.getSessionId()+a.getObservableScreenName().getValue():""}function h(b,c){switch(this._selectionStrategy){case p:return i(b);case q:if(this._lastSelectedMember&&!c)return this._lastSelectedMember;var d=n.call(this,b);c&&(d=o(d,this._lastSelectedMember));var e=a.filter(d,j);return 0===e.length&&(e=a.filter(d,k)),0===e.length&&(e=d),a.sample(e);default:throw new Error("Invalid Selection Strategy")}}function i(b){return a.reduce(b,function(a,b){return a&&a.getLastUpdate()>b.getLastUpdate()?a:b})}function j(a){var b=a.getObservableScreenName().getValue();return l(b)}function k(a){var b=a.getObservableScreenName().getValue();return m(b)}function l(a){var b=/primary/i;return b.test(a)}function m(a){var b=/alternate/i;return b.test(a)}function n(b){var c=this;return a.filter(b,function(a){return!d.call(c,a)})}function o(b,c){return a.filter(b,function(a){return g(a)!==g(c)})}var p="most-recent",q="high-availability",r=18e4;return c.prototype.getNext=function(a,b){var c=h.call(this,a,b);return this.getNumberOfBlackListedMembers()>0&&f.call(this)&&!c?(this._logger.info("Unable to select new member. Clearing [%s] black-listed members and trying again",this.getNumberOfBlackListedMembers()),this.clearBlackListedMembers(),this.getNext(a,b)):(this._lastSelectedMember!==c&&(c?this._logger.info("Selecting new Member [%s]/[%s]",c.getSessionId(),c.getObservableScreenName().getValue()):this._logger.info("Unable to select new member"),this._lastSelectedMember&&!d.call(this,this._lastSelectedMember)&&e.call(this,this._lastSelectedMember)),this._lastSelectedMember=c,c)},c.prototype.getStrategy=function(){return this._selectionStrategy},c.prototype.clearBlackListedMembers=function(){this._blackListedMembers=[]},c.prototype.getNumberOfBlackListedMembers=function(){return this._blackListedMembers.length},c.prototype.dispose=function(){this._lastSelectedMember=null,this._blackListedMembers=[]},c.getSimilarMembers=function(b,c){var d=a.filter(c,function(a){return a.getObservableScreenName().getValue()!==b}),e=a.filter(d,j),f=a.filter(d,k);return l(b)?e||f||d:m(b)?f||e||d:d||e||f},c}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(2),c(8),c(12),c(29)],e=function(a,b,c,d,e,f){function g(g){b.isString(g,"uri"),this._loggingUrl="/telemetry/logs",this._domain=location.hostname,this._minLevel=d.level.TRACE,this._isEnabled=!0,this._browser=(c.browser||"Browser")+"/"+(c.browserVersion||"?"),this._mostRecentRuntime=0,this._batchHttpProtocol=new e.BatchHttpProto(g+this._loggingUrl,[f],"telemetry.StoreLogRecords",{maxAttempts:3,maxBufferedRecords:1e3,maxBatchSize:512}),this._batchHttpProtocol.on("capacity",a.bind(i,this))}function h(b,c,d){this._batchHttpProtocol.addRecord({level:b,timestamp:a.isoString(),category:c,message:d.join(" "),source:this._browser,fullQualifiedName:this._domain,sessionId:this._mostRecentSessionId,userId:this._mostRecentUserId,environment:this._mostRecentEnvironment,version:this._mostRecentVersion,runtime:this._mostRecentRuntime})}function i(b){this._batchHttpProtocol.addRecordToBeginning({level:"Warn",timestamp:a.isoString(),category:"websdk/telemetryLogger",message:"Deleted "+b+" records",source:this._browser,fullQualifiedName:this._domain,sessionId:this._mostRecentSessionId,userId:this._mostRecentUserId,environment:this._mostRecentEnvironment,version:this._mostRecentVersion,runtime:this._mostRecentRuntime})}return g.prototype.setThreshold=function(a){b.isNumber(a,"level"),this._minLevel=a},g.prototype.getThreshold=function(){return this._minLevel},g.prototype.isEnabled=function(){return this._isEnabled},g.prototype.setEnabled=function(a){b.isBoolean(a,"enabled"),this._isEnabled=a},g.prototype.log=function(a,c,d,e,f,g,i,j,k){k.level<this._minLevel||!this._isEnabled||(b.isArray(e,"messages"),this._mostRecentRuntime=a,this._mostRecentSessionId=f,this._mostRecentUserId=g,this._mostRecentEnvironment=i,this._mostRecentVersion=j,h.call(this,c,d,e))},g}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(28),c(73)],e=function(a,b,c,d){function e(){this._telemetryAppenders={}}function f(a){var b=new d(a);return a||b.setEnabled(!1),b}var g={urls:{local:"",staging:"https://telemetry-stg.phenixp2p.com",production:"https://telemetry.phenixp2p.com"}};return e.prototype.getAppender=function(a){var b=c.parseEnvFromPcastBaseUri(a||""),d=g.urls[b];return this._telemetryAppenders[b]||(this._telemetryAppenders[b]=f.call(this,d)),
this._telemetryAppenders[b]},new e}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";var a={"package":"chat",options:{optimize_for:"LITE_RUNTIME"},messages:[{name:"Room",fields:[{rule:"optional",type:"string",name:"roomId",id:1},{rule:"optional",type:"string",name:"alias",id:2},{rule:"required",type:"string",name:"name",id:3},{rule:"required",type:"string",name:"description",id:4},{rule:"required",type:"RoomType",name:"type",id:5},{rule:"repeated",type:"string",name:"options",id:6},{rule:"optional",type:"string",name:"bridgeId",id:7},{rule:"optional",type:"string",name:"pin",id:8}]},{name:"Stream",fields:[{rule:"required",type:"StreamType",name:"type",id:1},{rule:"required",type:"string",name:"uri",id:2},{rule:"required",type:"TrackState",name:"audioState",id:3},{rule:"required",type:"TrackState",name:"videoState",id:4}]},{name:"Member",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"screenName",id:2},{rule:"required",type:"MemberRole",name:"role",id:3},{rule:"repeated",type:"Stream",name:"streams",id:4},{rule:"required",type:"MemberState",name:"state",id:5},{rule:"required",type:"uint64",name:"lastUpdate",id:6}]},{name:"MemberUpdate",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"optional",type:"string",name:"screenName",id:2},{rule:"optional",type:"MemberRole",name:"role",id:3},{rule:"required",type:"bool",name:"updateStreams",id:7,options:{"default":!1}},{rule:"repeated",type:"Stream",name:"streams",id:4},{rule:"optional",type:"MemberState",name:"state",id:5},{rule:"required",type:"uint64",name:"lastUpdate",id:6}]},{name:"ChatUser",fields:[{rule:"optional",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"screenName",id:2},{rule:"required",type:"MemberRole",name:"role",id:3},{rule:"required",type:"uint64",name:"lastUpdate",id:4}]},{name:"ChatMessage",fields:[{rule:"required",type:"string",name:"messageId",id:1},{rule:"required",type:"uint64",name:"timestamp",id:2},{rule:"required",type:"ChatUser",name:"from",id:3},{rule:"required",type:"string",name:"message",id:4}]},{name:"CreateRoom",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"Room",name:"room",id:2}]},{name:"CreateRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"Room",name:"room",id:2}]},{name:"JoinRoom",fields:[{rule:"optional",type:"string",name:"roomId",id:1},{rule:"optional",type:"string",name:"alias",id:2},{rule:"required",type:"string",name:"sessionId",id:3},{rule:"required",type:"Member",name:"member",id:4},{rule:"repeated",type:"string",name:"options",id:5},{rule:"required",type:"uint64",name:"timestamp",id:6}]},{name:"JoinRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"Room",name:"room",id:2},{rule:"repeated",type:"Member",name:"members",id:3},{rule:"optional",type:"Member",name:"self",id:5},{rule:"repeated",type:"string",name:"options",id:4}]},{name:"UpdateRoom",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"Room",name:"room",id:2},{rule:"required",type:"uint64",name:"timestamp",id:3}]},{name:"UpdateRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"UpdateMember",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"MemberUpdate",name:"member",id:2},{rule:"repeated",type:"string",name:"options",id:3},{rule:"required",type:"uint64",name:"timestamp",id:4}]},{name:"UpdateMemberResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"uint64",name:"lastUpdate",id:2}]},{name:"LeaveRoom",fields:[{rule:"required",type:"string",name:"roomId",id:1},{rule:"required",type:"string",name:"sessionId",id:2},{rule:"required",type:"uint64",name:"timestamp",id:3}]},{name:"LeaveRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"DestroyRoom",fields:[{rule:"required",type:"string",name:"roomId",id:1}]},{name:"DestroyRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"GetRoomInfo",fields:[{rule:"optional",type:"string",name:"roomId",id:1},{rule:"optional",type:"string",name:"alias",id:2},{rule:"optional",type:"string",name:"sessionId",id:3},{rule:"optional",type:"string",name:"applicationId",id:4},{rule:"optional",type:"string",name:"secret",id:5},{rule:"repeated",type:"string",name:"options",id:6}]},{name:"GetRoomInfoResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"Room",name:"room",id:2},{rule:"repeated",type:"Member",name:"members",id:3},{rule:"repeated",type:"string",name:"options",id:4}]},{name:"RoomEvent",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"roomId",id:2},{rule:"required",type:"RoomEventType",name:"eventType",id:3},{rule:"repeated",type:"Member",name:"members",id:4},{rule:"optional",type:"Room",name:"room",id:5},{rule:"repeated",type:"string",name:"options",id:6},{rule:"required",type:"uint64",name:"timestamp",id:7}]},{name:"SendMessageToRoom",fields:[{rule:"required",type:"string",name:"roomId",id:1},{rule:"required",type:"ChatMessage",name:"chatMessage",id:2}]},{name:"SendMessageToRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"FetchRoomConversation",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"roomId",id:2},{rule:"optional",type:"string",name:"afterMessageId",id:3},{rule:"optional",type:"string",name:"beforeMessageId",id:4},{rule:"required",type:"uint32",name:"limit",id:5},{rule:"repeated",type:"RoomConversationOption",name:"options",id:6}]},{name:"FetchRoomConversationResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"ChatMessage",name:"chatMessages",id:2}]},{name:"RoomConversationEvent",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"roomId",id:2},{rule:"required",type:"RoomConversationEventType",name:"eventType",id:3},{rule:"repeated",type:"ChatMessage",name:"chatMessages",id:4}]},{name:"RoomBridgeIdle",fields:[{rule:"required",type:"string",name:"roomId",id:1},{rule:"required",type:"string",name:"bridgeId",id:2}]}],enums:[{name:"RoomType",values:[{name:"DirectChat",id:0},{name:"MultiPartyChat",id:1},{name:"ModeratedChat",id:2},{name:"TownHall",id:3},{name:"Channel",id:4}]},{name:"MemberRole",values:[{name:"Participant",id:0},{name:"Moderator",id:1},{name:"Presenter",id:2},{name:"Audience",id:3}]},{name:"MemberState",values:[{name:"Active",id:0},{name:"Passive",id:1},{name:"HandRaised",id:2},{name:"Inactive",id:3},{name:"Offline",id:4}]},{name:"RoomEventType",values:[{name:"MemberJoined",id:0},{name:"MemberLeft",id:1},{name:"MemberUpdated",id:2},{name:"RoomUpdated",id:3},{name:"RoomEnded",id:4}]},{name:"TrackState",values:[{name:"TrackEnabled",id:0},{name:"TrackDisabled",id:1},{name:"TrackEnded",id:2}]},{name:"StreamType",values:[{name:"User",id:0},{name:"Presentation",id:1},{name:"Audio",id:2}]},{name:"RoomConversationOption",values:[{name:"Subscribe",id:0}]},{name:"RoomConversationEventType",values:[{name:"Message",id:0}]}]};return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";var a={"package":"pcast",messages:[{name:"Authenticate",fields:[{rule:"optional",type:"uint32",name:"apiVersion",id:9,options:{"default":0}},{rule:"required",type:"string",name:"clientVersion",id:1},{rule:"optional",type:"string",name:"device",id:12},{rule:"required",type:"string",name:"deviceId",id:2},{rule:"optional",type:"string",name:"manufacturer",id:13},{rule:"required",type:"string",name:"platform",id:3},{rule:"required",type:"string",name:"platformVersion",id:4},{rule:"required",type:"string",name:"authenticationToken",id:5},{rule:"optional",type:"string",name:"connectionId",id:6},{rule:"optional",type:"string",name:"connectionRouteKey",id:10},{rule:"optional",type:"string",name:"remoteAddress",id:11},{rule:"optional",type:"string",name:"sessionId",id:7},{rule:"optional",type:"string",name:"applicationId",id:8}]},{name:"AuthenticateResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"sessionId",id:2},{rule:"optional",type:"string",name:"redirect",id:3},{rule:"repeated",type:"string",name:"roles",id:4}]},{name:"Bye",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"reason",id:2}]},{name:"ByeResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"SessionDescription",fields:[{rule:"required",type:"Type",name:"type",id:1,options:{"default":"Offer"}},{rule:"required",type:"string",name:"sdp",id:2}],enums:[{name:"Type",values:[{name:"Offer",id:0},{name:"Answer",id:1}]}]},{name:"CreateStream",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"optional",type:"string",name:"originStreamId",id:2},{rule:"repeated",type:"string",name:"options",id:3},{rule:"optional",type:"string",name:"connectUri",id:8},{rule:"repeated",type:"string",name:"connectOptions",id:9},{rule:"repeated",type:"string",name:"tags",id:4},{rule:"optional",type:"SetRemoteDescription",name:"setRemoteDescription",id:5},{rule:"optional",type:"CreateOfferDescription",name:"createOfferDescription",id:6},{rule:"optional",type:"CreateAnswerDescription",name:"createAnswerDescription",id:7}]},{name:"IceServer",fields:[{rule:"repeated",type:"string",name:"urls",id:1},{rule:"optional",type:"string",name:"username",id:2},{rule:"optional",type:"string",name:"credential",id:3}]},{name:"RtcConfiguration",fields:[{rule:"optional",type:"BundlePolicy",name:"bundlePolicy",id:1},{rule:"optional",type:"uint32",name:"iceCandidatePoolSize",id:3},{rule:"repeated",type:"IceServer",name:"iceServers",id:4},{rule:"optional",type:"IceTransportPolicy",name:"iceTransportPolicy",id:5},{rule:"optional",type:"string",name:"peerIdentity",id:6},{rule:"optional",type:"RtcpMuxPolicy",name:"rtcpMuxPolicy",id:7}],enums:[{name:"BundlePolicy",values:[{name:"BundlePolicyBalanced",id:1},{name:"BundlePolicyMaxCompat",id:2},{name:"BundlePolicyMaxBundle",id:3}]},{name:"IceTransportPolicy",values:[{name:"IceTransportPolicyAll",id:1},{name:"IceTransportPolicyPublic",id:2},{name:"IceTransportPolicyRelay",id:3}]},{name:"RtcpMuxPolicy",values:[{name:"RtcpMuxPolicyNegotiate",id:1},{name:"RtcpMuxPolicyRequire",id:2}]}]},{name:"CreateStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"streamId",id:2},{rule:"optional",type:"string",name:"instanceRouteKey",id:5},{rule:"repeated",type:"string",name:"streamUris",id:8},{rule:"optional",type:"RtcConfiguration",name:"rtcConfiguration",id:9},{rule:"optional",type:"SetRemoteDescriptionResponse",name:"setRemoteDescriptionResponse",id:3},{rule:"optional",type:"CreateOfferDescriptionResponse",name:"createOfferDescriptionResponse",id:4},{rule:"optional",type:"CreateAnswerDescriptionResponse",name:"createAnswerDescriptionResponse",id:6},{rule:"repeated",type:"string",name:"options",id:7},{rule:"optional",type:"uint64",name:"offset",id:10,options:{"default":0}}]},{name:"SetLocalDescription",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"required",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"optional",type:"uint32",name:"apiVersion",id:3,options:{"default":0}}]},{name:"SetLocalDescriptionResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"string",name:"options",id:2}]},{name:"SetRemoteDescription",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"required",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"optional",type:"uint32",name:"apiVersion",id:3,options:{"default":0}}]},{name:"SetRemoteDescriptionResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"repeated",type:"string",name:"options",id:3}]},{name:"CreateOfferDescription",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"repeated",type:"string",name:"options",id:2},{rule:"optional",type:"uint32",name:"apiVersion",id:3,options:{"default":0}}]},{name:"CreateOfferDescriptionResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"repeated",type:"string",name:"options",id:3}]},{name:"CreateAnswerDescription",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"repeated",type:"string",name:"options",id:2},{rule:"optional",type:"uint32",name:"apiVersion",id:3,options:{"default":0}}]},{name:"CreateAnswerDescriptionResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"repeated",type:"string",name:"options",id:3}]},{name:"IceCandidate",fields:[{rule:"required",type:"string",name:"candidate",id:1},{rule:"required",type:"uint32",name:"sdpMLineIndex",id:2},{rule:"required",type:"string",name:"sdpMid",id:3}]},{name:"AddIceCandidates",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"repeated",type:"IceCandidate",name:"candidates",id:2},{rule:"repeated",type:"string",name:"options",id:3},{rule:"optional",type:"uint32",name:"apiVersion",id:4,options:{"default":0}}]},{name:"AddIceCandidatesResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"string",name:"options",id:2}]},{name:"UpdateStreamState",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"required",type:"string",name:"signalingState",id:2},{rule:"required",type:"string",name:"iceGatheringState",id:3},{rule:"required",type:"string",name:"iceConnectionState",id:4},{rule:"optional",type:"uint32",name:"apiVersion",id:5,options:{"default":0}}]},{name:"UpdateStreamStateResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"string",name:"options",id:2}]},{name:"DestroyStream",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"optional",type:"string",name:"reason",id:2},{rule:"repeated",type:"string",name:"options",id:3}]},{name:"DestroyStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"ConnectionDisconnected",fields:[{rule:"required",type:"string",name:"connectionId",id:1},{rule:"required",type:"uint32",name:"reasonCode",id:2},{rule:"optional",type:"string",name:"description",id:3}]},{name:"ConnectionDisconnectedResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"StreamStarted",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"repeated",type:"string",name:"tags",id:3}]},{name:"SourceStreamStarted",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"repeated",type:"string",name:"capabilities",id:3},{rule:"repeated",type:"string",name:"tags",id:4}]},{name:"StreamEnded",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"string",name:"reason",id:3},{rule:"repeated",type:"string",name:"tags",id:4},{rule:"optional",type:"string",name:"continuationId",id:5},{rule:"optional",type:"string",name:"routeKey",id:6}]},{name:"SourceStreamEnded",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"string",name:"reason",id:3},{rule:"repeated",type:"string",name:"capabilities",id:4},{rule:"repeated",type:"string",name:"tags",id:5}]},{name:"StreamEndedResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"continuationId",id:2},{rule:"optional",type:"string",name:"routeKey",id:3}]},{name:"StreamIdle",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"repeated",type:"string",name:"options",id:3},{rule:"repeated",type:"string",name:"tags",id:4}]},{name:"StreamArchived",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"string",name:"uri",id:3}]},{name:"SessionEnded",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"reason",id:2},{rule:"required",type:"float",name:"duration",id:3}]},{name:"StreamPlaylist",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"PlaylistType",name:"playlistType",id:3},{rule:"required",type:"string",name:"uri",id:4}],enums:[{name:"PlaylistType",values:[{name:"Live",id:0},{name:"OnDemand",id:1}]}]},{name:"ForwardToClient",fields:[{rule:"required",type:"string",name:"connectionId",id:1},{rule:"required",type:"string",name:"type",id:2},{rule:"required",type:"bytes",name:"payload",id:3}]},{name:"ForwardToClientResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"SetupStream",fields:[{rule:"required",type:"string",name:"streamToken",id:1},{rule:"required",type:"CreateStream",name:"createStream",id:2}]},{name:"SetupStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"CreateStreamResponse",name:"createStreamResponse",id:2}]},{name:"SetupPlaylistStream",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamToken",id:2},{rule:"repeated",type:"string",name:"options",id:3},{rule:"repeated",type:"string",name:"tags",id:4}]},{name:"PlaylistStreamManifest",fields:[{rule:"required",type:"string",name:"manifest",id:1},{rule:"required",type:"bool",name:"isProtectedContent",id:2}]},{name:"SetupPlaylistStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"PlaylistStreamManifest",name:"manifests",id:2},{rule:"optional",type:"uint64",name:"offset",id:3,options:{"default":0}}]},{name:"StreamDataQuality",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"uint64",name:"timestamp",id:3},{rule:"required",type:"DataQualityStatus",name:"status",id:4},{rule:"required",type:"DataQualityReason",name:"reason",id:5}],enums:[{name:"DataQualityStatus",values:[{name:"NoData",id:0},{name:"AudioOnly",id:1},{name:"All",id:2}]},{name:"DataQualityReason",values:[{name:"None",id:0},{name:"UploadLimited",id:1},{name:"DownloadLimited",id:2},{name:"PublisherLimited",id:3},{name:"NetworkLimited",id:4}]}]},{name:"StreamDataQualityResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"CallbackEvent",fields:[{rule:"optional",type:"uint32",name:"apiVersion",id:1,options:{"default":0}},{rule:"required",type:"string",name:"entity",id:2},{rule:"required",type:"string",name:"what",id:3},{rule:"required",type:"string",name:"data",id:4},{rule:"optional",type:"string",name:"sessionId",id:5}]},{name:"Uri",fields:[{rule:"optional",type:"string",name:"protocol",id:1,options:{"default":"http"}},{rule:"required",type:"string",name:"host",id:2},{rule:"optional",type:"uint32",name:"port",id:3,options:{"default":80}},{rule:"optional",type:"string",name:"method",id:4,options:{"default":"POST"}},{rule:"optional",type:"string",name:"path",id:5,options:{"default":"/"}}]},{name:"SetApplicationCallback",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"required",type:"Uri",name:"callback",id:3}]},{name:"SetApplicationCallbackResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"IssueAuthenticationToken",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"repeated",type:"string",name:"capabilities",id:3}]},{name:"IssueAuthenticationTokenResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"authenticationToken",id:2}]},{name:"IssueStreamToken",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"required",type:"string",name:"sessionId",id:3},{rule:"optional",type:"string",name:"originStreamId",id:4},{rule:"repeated",type:"string",name:"capabilities",id:5}]},{name:"IssueStreamTokenResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"streamToken",id:2}]},{name:"IssueDrmToken",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"required",type:"string",name:"streamToken",id:3},{rule:"optional",type:"string",name:"sessionId",id:4},{rule:"required",type:"string",name:"originStreamId",id:5},{rule:"repeated",type:"string",name:"capabilities",id:6}]},{name:"IssueDrmTokenResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"drmToken",id:2}]},{name:"TerminateStream",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"optional",type:"string",name:"streamId",id:3,oneof:"streamOrToken"},{rule:"optional",type:"string",name:"streamToken",id:5,oneof:"streamOrToken"},{rule:"optional",type:"string",name:"reason",id:4}],oneofs:{streamOrToken:[3,5]}},{name:"TerminateStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"Stream",fields:[{rule:"required",type:"string",name:"streamId",id:1}]},{name:"ListStreams",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"optional",type:"string",name:"start",id:3},{rule:"required",type:"uint32",name:"length",id:4},{rule:"repeated",type:"string",name:"options",id:5}]},{name:"ListStreamsResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"start",id:2},{rule:"optional",type:"uint32",name:"length",id:3},{rule:"repeated",type:"Stream",name:"streams",id:4}]}]};return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(4),c(31)],e=function(a,b,c,d){"use strict";function e(a,b,c,d,e,f,g,h,i){this.init(a,b,c,d,e,f,g,h,i)}function f(){throw new Error("ImmutableRoom is Immutable")}function g(){throw new Error("Unable to subscribe to Immutable [ImmutableRoom]")}function h(b){a.isArray(b)?a.forEach(b,function(a){i(a)}):a.isObject(b)&&a.forOwn(b,function(a){i(a)})}function i(a){j(a),h(a)}function j(a){if(a instanceof c.Observable||a instanceof c.ObservableArray){a.setValue=f,a.subscribe=g;var b=a.getValue();h(b)}}return e.prototype.init=function(a,b,c,e,f,g,i,j,k){this._room=new d(null,b,c,e,f,g,i,j,k),h(this._room)},e.prototype.getRoomId=function(){return this._room.getRoomId()},e.prototype.getObservableAlias=function(){return this._room.getObservableAlias()},e.prototype.getObservableName=function(){return this._room.getObservableName()},e.prototype.getObservableDescription=function(){return this._room.getObservableDescription()},e.prototype.getObservableType=function(){return this._room.getObservableType()},e.prototype.getObservableMembers=function(){return this._room.getObservableMembers()},e.prototype.getObservableBridgeId=function(){return this._room.getObservableBridgeId()},e.prototype.getObservablePin=function(){return this._room.getObservablePin()},e.prototype.toString=function(){return this._room.toString()},e.prototype.toJson=function(){return this._room.toJson()},e.prototype.commitChanges=f,e.prototype.reload=f,e.prototype._update=f,e.prototype._addMembers=f,e.prototype._removeMembers=f,e.prototype._updateMembers=f,e}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(2)],e=function(a,b){"use strict";function c(){}var d=/profile-level-id=[^;\n]*/;return c.prototype.getH264ProfileId=function(c){b.isStringNotEmpty(c,"offerSdp");var e=a.get(c.match(d),"0","");return a.get(e.split("="),"1",null)},c.prototype.replaceH264ProfileId=function(a,c){b.isStringNotEmpty(a,"offerSdp"),b.isStringNotEmpty(c,"newProfileId");var d=this.getH264ProfileId(a);return d?a.replace("profile-level-id="+d,"profile-level-id="+c):a},new c}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(5),c(6),c(2),c(9),c(7)],e=function(a,b,c,d,e,f,g){"use strict";function h(b,d,e,g,h){this._logger=h,this._streamId=b,this._playlistUri=encodeURI(d).replace(/[#]/g,"%23"),this._bufferSizeHistory=[],this._streamTelemetry=e,this._options=g,this._element=null,this._dimensionsChangedMonitor=new f(h),this._lastProgress={time:0,buffered:null,averageLength:0,count:0,setupRetry:0,lastCurrentTime:0,lastCurrentTimeOccurenceTimestamp:0},this._namedEvents=new c.NamedEvents,this._onStalled=a.bind(l,this),this._onProgress=a.bind(k,this),this._onEnded=a.bind(m,this),this._onError=a.bind(j,this),this._onWaiting=a.bind(n,this)}function i(b){e.attachUriStream(b,this._playlistUri),this._options.receiveAudio===!1&&(b.muted=!0),this._streamTelemetry.recordTimeToFirstFrame(b),this._streamTelemetry.recordRebuffering(b),this._streamTelemetry.recordVideoResolutionChanges(this,b),a.addEventListener(b,"error",this._onError,!0),a.addEventListener(b,"stalled",this._onStalled,!1),a.addEventListener(b,"pause",this._onStalled,!1),a.addEventListener(b,"suspend",this._onStalled,!1),a.addEventListener(b,"progress",this._onProgress,!1),a.addEventListener(b,"ended",this._onEnded,!1),a.addEventListener(b,"waiting",this._onWaiting,!1),this._element=b,this._dimensionsChangedMonitor.start(this,this._element)}function j(b){var c=this,d=w*c._lastProgress.setupRetry*c._lastProgress.setupRetry,e=0===c._lastProgress.count,f=c._lastProgress.setupRetry<=u;return 4===a.get(this._element,["error","code"])&&e&&f?setTimeout(function(){c._lastProgress.setupRetry++,q.call(c)},Math.max(d,w)):void this._namedEvents.fire(g.rendererEvents.error.name,["player",b])}function k(){if(this._lastProgress.time=a.now(),0===this._element.buffered.length)return this._logger.debug("[%s] Hls stream progress event fired without any buffered content",this._streamId);var b=this._element.buffered.end(this._element.buffered.length-1);if(this._lastProgress.buffered!==b){if(null!==this._lastProgress.buffered){var c=this._lastProgress.averageLength*this._lastProgress.count,d=c+(b-this._lastProgress.buffered);this._lastProgress.count+=1,this._lastProgress.averageLength=d/this._lastProgress.count,this._lastProgress.lastCurrentTime!==this._element.currentTime&&(this._lastProgress.lastCurrentTimeOccurenceTimestamp=a.now());var e=this._lastProgress.lastCurrentTimeOccurenceTimestamp&&a.now()-this._lastProgress.lastCurrentTimeOccurenceTimestamp>x;e&&this._element&&!this._element.paused&&o.call(this)&&(this._logger.warn("Reloading stream after current time has not changed for [%s] seconds due to unregistered stall.",x/1e3),p.call(this))}this._lastProgress.buffered=b,this._lastProgress.setupRetry=0,this._lastProgress.lastCurrentTime=this._element.currentTime}}function l(){if(this._logger.info("[%s] Loading Hls stream stalled.",this._streamId),this._lastProgress.setupRetry>u)return this._logger.warn("[%s] Unable to recover from stalled Hls Stream.",this._streamId);var b=this;0===this._lastProgress.count?(this._lastProgress.setupRetry++,q.call(b)):(setTimeout(function(){0===b._lastProgress.count&&(b._lastProgress.setupRetry++,q.call(b))},r.call(b)),setTimeout(a.bind(s,b),t))}function m(){this._logger.info("[%s] Hls stream ended",this._streamId),this.stop("ended")}function n(){this._logger.info("Time elapsed since last progress [%s]",a.now()-this._lastProgress.time),setTimeout(a.bind(s,this),r.call(this))}function o(){var b=!this._lastReloadTime||a.now()-this._lastReloadTime>y;return this._element&&!this._waitForLastChunk&&0!==this._element.buffered.length&&b}function p(){o.call(this)&&(this._logger.warn("Reloading unhealthy stream that was active for at least [%s] seconds",y/1e3),this._lastReloadTime=a.now(),q.call(this))}function q(){this._logger.info("[%s] Attempting to reload Hls stream.",this._streamId),this._element.pause(),this._element.src="",this._element.currentTime=0,this._element.src=this._playlistUri,this._element.load(),this._element.play()}function r(){return 1.5*this._lastProgress.averageLength<2e3?2e3:1.5*this._lastProgress.averageLength}function s(){a.now()-this._lastProgress.time>r.call(this)&&this._waitForLastChunk&&this.stop("ended")}var t=5e3,u=5,v=6e3,w=250,x=6e3,y=15e3;return h.prototype.on=function(a,b){return this._namedEvents.listen(a,b)},h.prototype.start=function(b){try{var c=a.now()-this._options.originStartTime;c<v&&this._options.isDrmProtectedContent?setTimeout(a.bind(i,this,b),v):i.call(this,b)}catch(d){this._logger.error("[%s] Error while loading HLS live stream [%s]",this._streamId,d.code,d),this._namedEvents.fire(g.rendererEvents.error.name,["hls",d])}return b},h.prototype.stop=function(b,c){var d=this;if(!d._waitingForFinalization){if(c)return d._waitForLastChunk=!0;if(this._dimensionsChangedMonitor.stop(),this._streamTelemetry.stop(),this._element){var f=function(){d._element&&(a.removeEventListener(d._element,"error",d._onError,!0),a.removeEventListener(d._element,"stalled",d._onStalled,!1),a.removeEventListener(d._element,"pause",d._onStalled,!1),a.removeEventListener(d._element,"suspend",d._onStalled,!1),a.removeEventListener(d._element,"progress",d._onProgress,!1),a.removeEventListener(d._element,"ended",d._onEnded,!1),a.removeEventListener(d._element,"waiting",d._onWaiting,!1),"Safari"===e.browser&&e.browserVersion>=11?d._element.setAttribute("src",""):d._element.src="",d._element=null);var b="";d._namedEvents.fire(g.rendererEvents.ended.name,[b])};try{d._element.pause(),d._logger.info("[%s] HLS live stream has been destroyed",d._streamId),f()}catch(h){d._logger.error("[%s] Error while destroying HLS live stream [%s]",d._streamId,h.code,h),f(),d._namedEvents.fire(g.rendererEvents.error.name,["hls",h])}d._waitingForFinalization=!0}}},h.prototype.getStats=function(){if(!this._element)return{width:0,height:0,currentTime:0,lag:0,networkState:g.networkStates.networkNoSource.id};var b=this._element?this._element.currentTime||0:0,c=this._element&&this._element.buffered&&this._element.buffered.length>0?this._element.buffered.end(this._element.buffered.length-1):0,d=Math.max(0,c-b);this._bufferSizeHistory.push(d),this._bufferSizeHistory.length>15&&this._bufferSizeHistory.shift();for(var e=0,f=0,h=this._bufferSizeHistory.length;f<h;f++)e=Math.max(e,this._bufferSizeHistory[f]);var i=2,j=(a.now()-this._options.originStartTime)/1e3,k=2*i+e,l=j-k;return{width:this._element.videoWidth||this._element.width,height:this._element.videoHeight||this._element.height,currentTime:l,originTime:j,lag:k,networkState:this._element.networkState}},h.prototype.setDataQualityChangedCallback=function(a){b.isFunction(a,"callback"),this.dataQualityChangedCallback=a},h.prototype.getPlayer=function(){return null},h.prototype.addVideoDisplayDimensionsChangedCallback=function(a,b){this._dimensionsChangedMonitor.addVideoDisplayDimensionsChangedCallback(a,b)},h}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(5),c(2),c(82),c(79),c(81),c(7)],e=function(a,b,c,d,e,f,g,h){"use strict";function i(a,b,d,e,f,g,h){this._type=a,this._streamId=b,this._uri=d,this._streamTelemetry=e,this._options=f,this._shaka=g,this._logger=h,this._renderer=null,this._element=null,this._dimensionsChangedMonitor=null,this._namedEvents=new c.NamedEvents}return i.prototype.on=function(a,b){this._namedEvents.listen(a,b)},i.prototype.createRenderer=function(){switch(this._type){case h.types.dash.name:this._shaka?this._renderer=new e(this._streamId,this._uri,this._streamTelemetry,this._options,this._shaka,this._logger):this._renderer=new g(this._streamId,this._uri,this._streamTelemetry,this._options,this._logger);
break;case h.types.hls.name:g.isSupported()&&!this._options.useNativeHlsPlayer?this._renderer=new g(this._streamId,this._uri,this._streamTelemetry,this._options,this._logger):this._renderer=new f(this._streamId,this._uri,this._streamTelemetry,this._options,this._logger);break;default:throw new Error("Unsupported Live stream Type "+this._type)}var a=this;return this._renderer.on(h.rendererEvents.error.name,function(b,c){a._namedEvents.fire(h.streamEvents.playerError.name,[b,c])}),this._renderer.on(h.rendererEvents.ended.name,function(b){a._namedEvents.fire(h.streamEvents.playerEnded.name,[b])}),this._renderer},i.prototype.select=function(a){return this._logger.warn("[%s] selection of tracks not supported for [%s] live streams",this._streamId,this._type),this},i.prototype.setStreamEndedCallback=function(a){if("function"!=typeof a)throw new Error('"callback" must be a function');this.streamEndedCallback=a},i.prototype.setStreamErrorCallback=function(b){if(!a.isFunction(b))throw new Error('"callback" must be a function');this.streamErrorCallback=b},i.prototype.stop=function(a){this.isActive()&&(this._logger.info("[%s] stop media stream",this._streamId),this._namedEvents.fire(h.streamEvents.stopped.name,[a]),this._isStopped=!0)},i.prototype.monitor=function(a,b){if("object"!=typeof a)throw new Error('"options" must be an object');if("function"!=typeof b)throw new Error('"callback" must be a function')},i.prototype.getMonitor=function(){return null},i.prototype.getStream=function(){return this._logger.debug("[%s] stream not available for [%s] live streams",this._streamId,this._type),null},i.prototype.isActive=function(){return!this._isStopped},i.prototype.getStreamId=function(){return this._streamId},i.prototype.getStats=function(){return this._logger.debug("[%s] stats not available for [%s] live streams",this._streamId,this._type),null},i.prototype.getRenderer=function(){return this._renderer},i}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(8),c(5),c(6),c(55),c(2),c(9),c(7)],e=function(a,b,c,d,e,f,g,h,i){"use strict";function j(b,c,e,f,g){this._logger=g,this._streamId=b,this._manifestUri=encodeURI(c).replace(/[#]/g,"%23"),this._streamTelemetry=e,this._options=f,this._renderer=null,this._element=null,this._dimensionsChangedMonitor=new h(g),this._lastProgress={time:0,buffered:null,averageLength:0,count:0,lastCurrentTime:0,lastCurrentTimeOccurenceTimestamp:0},this._namedEvents=new d.NamedEvents,this._onStalled=a.bind(q,this),this._onProgress=a.bind(p,this),this._onEnded=a.bind(s,this)}function k(){var b,c=this,d=new f.StatsProvider(this._throttledLogger,{ewmaPeriods:30}),e={bandwidthToStartAt:c._options.bandwidthToStartAt||u};"Dash"===this._playlist.getDeliveryType()?(b=new f.MpdPlaylistChunkFeeder(this._throttledLogger,this._playlist,d,{}),c._options.isDrmProtectedContent&&(e.drm={"com.widevine.alpha":{serverCertificateUrl:c._options.widevineServiceCertificateUrl,mediaKeySystemConfiguration:{persistentState:"required"}},"com.microsoft.playready":{licenseServerUrl:c._options.playreadyLicenseUrl}})):"Hls"===this._playlist.getDeliveryType()&&(b=new f.M3u8PlaylistChunkFeeder(this._throttledLogger,this._playlist,d,{})),"Chrome"===g.browser&&(e.targetBufferSize=4),"IE"!==g.browser&&"Edge"!==g.browser||(e.maximumFastForwardFrequency=180);var h=new f.WebPlayer(this._throttledLogger,this._playlist,this._element,b,e),i=new f.AdaptiveStreamingManager(this._throttledLogger,this._playlist,h,d);h.start(),c._player=h,c._statsProvider=d,c._adaptiveStreamingManager=i,a.addEventListener(c._player,"error",a.bind(l,c))}function l(a){return a&&3===a.code&&o.call(this)?n.call(this):void this._namedEvents.fire(i.rendererEvents.error.name,["phenix",a])}function m(){this._player.dispose(),this._playlist.dispose(),this._statsProvider.dispose(),this._adaptiveStreamingManager.dispose(),this._player=null,this._playlist=null,this._statsProvider=null,this._adaptiveStreamingManager=null,this.start(this._element)}function n(){o.call(this)&&(this._logger.warn("Reloading unhealthy stream that was active for at least [%s] seconds",w/1e3),this._lastReloadTime=a.now(),m.call(this))}function o(){var b=!this._lastReloadTime||a.now()-this._lastReloadTime>w;return this._element&&!this._waitForLastChunk&&this._player&&0!==this._element.buffered.length&&b}function p(){if(this._lastProgress.time=a.now(),0===this._element.buffered.length)return this._logger.debug("[%s] Phenix live stream player progress event fired without any buffered content",this._streamId);var b=this._element.buffered.end(this._element.buffered.length-1);if(this._lastProgress.buffered!==b){if(null!==this._lastProgress.buffered){var c=this._lastProgress.averageLength*this._lastProgress.count,d=c+(b-this._lastProgress.buffered);this._lastProgress.count+=1,this._lastProgress.averageLength=d/this._lastProgress.count,this._lastProgress.lastCurrentTime!==this._element.currentTime&&(this._lastProgress.lastCurrentTimeOccurenceTimestamp=a.now());var e=this._lastProgress.lastCurrentTimeOccurenceTimestamp&&a.now()-this._lastProgress.lastCurrentTimeOccurenceTimestamp>v;e&&this._element&&!this._element.paused&&o.call(this)&&(this._logger.warn("Reloading stream after current time has not changed for [%s] seconds due to unregistered stall.",v/1e3),n.call(this))}this._lastProgress.buffered=b,this._lastProgress.lastCurrentTime=this._element.currentTime}}function q(b){var c=this;if(c._logger.info("[%s] Loading Phenix Live stream player stalled caused by [%s] event.",c._streamId,b.type),0!==c._lastProgress.time){var d=c._element.currentTime;setTimeout(function(){a.now()-c._lastProgress.time>r.call(c)&&c._waitForLastChunk&&c.stop("ended")},r.call(c)),setTimeout(function(){c._element&&c._element.currentTime===d&&!c._element.paused&&o.call(c)&&(c._logger.warn("Reloading stream after being stalled for [%s] seconds",v/1e3),n.call(c))},v)}}function r(){return 1.5*this._lastProgress.averageLength<2e3?2e3:1.5*this._lastProgress.averageLength}function s(){this._logger.info("[%s] Phenix live stream player ended.",this._streamId)}function t(b){var d=b.getAppenders(),e=new c.Logger;return a.forEach(d,function(a){a instanceof c.ConsoleAppender&&(a=new c.ConsoleAppender,a.setThreshold(c.level.INFO)),e.addAppender(a)}),e.setUserId(b.getUserId()),e.setEnvironment(b.getEnvironment()),e.setApplicationVersion(b.getApplicationVersion()),e.setObservableSessionId(b.getObservableSessionId()),e}var u=3e6,v=6e3,w=15e3;return j.isSupported=function(){return f.isSupported},j.prototype.on=function(a,b){return this._namedEvents.listen(a,b)},j.prototype.start=function(b){var c=this,d=t(this._logger),e=new f.Playlist(d,this._manifestUri);return this._throttledLogger=d,this._playlist=e,this._element=b,e.fetch(function(a){if(a)throw new Error(a);k.call(c)}),c._options.receiveAudio===!1&&(b.muted=!0),a.addEventListener(b,"stalled",c._onStalled,!1),a.addEventListener(b,"pause",c._onStalled,!1),a.addEventListener(b,"suspend",c._onStalled,!1),a.addEventListener(b,"progress",c._onProgress,!1),a.addEventListener(b,"ended",c._onEnded,!1),c._dimensionsChangedMonitor.start(this,b),b},j.prototype.stop=function(b,c){var d=this;if(!d._waitingForFinalization){if(c)return d._waitForLastChunk=!0;if(this._dimensionsChangedMonitor.stop(),this._streamTelemetry.stop(),this._player){var e=function(){var b="";d._element&&(a.removeEventListener(d._element,"stalled",d._onStalled,!1),a.removeEventListener(d._element,"pause",d._onStalled,!1),a.removeEventListener(d._element,"suspend",d._onStalled,!1),a.removeEventListener(d._element,"progress",d._onProgress,!1),a.removeEventListener(d._element,"ended",d._onEnded,!1),"Edge"===g.browser&&(d._element.src="")),d._namedEvents.fire(i.rendererEvents.ended.name,[b]),d._player=null,d._element=null};d._waitingForFinalization=!0;try{d._player.dispose(),d._playlist.dispose(),d._statsProvider.dispose(),d._adaptiveStreamingManager.dispose(),d._logger.info("[%s] Phenix live stream has been destroyed",d._streamId),e()}catch(f){d._logger.error("[%s] Error while destroying Phenix live stream player [%s]",d._streamId,f.code,f),e(),d._namedEvents.fire(i.rendererEvents.error.name,["phenix",f])}}}},j.prototype.getStats=function(){if(!this._statsProvider||!this._player)return{width:0,height:0,currentTime:0,lag:0,networkState:i.networkStates.networkNoSource.id};var b=a.assign(this._statsProvider.getRateAverages(),{currentTime:0,lag:0}),c=a.get(this._element,["currentTime"],0),d=(a.now()-this._options.originStartTime)/1e3,e=Math.max(0,d-c);return this._element&&(b.currentTime=c,b.lag=e),b.estimatedBandwidth>0?b.networkState=i.networkStates.networkLoading.id:b.playTime>0?b.networkState=i.networkStates.networkIdle.id:b.video?b.networkState=i.networkStates.networkEmpty.id:b.networkState=i.networkStates.networkNoSource.id,b},j.prototype.setDataQualityChangedCallback=function(a){b.isFunction(a,"callback"),this.dataQualityChangedCallback=a},j.prototype.getPlayer=function(){return this._player},j.prototype.addVideoDisplayDimensionsChangedCallback=function(a,b){this._dimensionsChangedMonitor.addVideoDisplayDimensionsChangedCallback(a,b)},j}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(5),c(6),c(2),c(9),c(7)],e=function(a,b,c,d,e,f,g){"use strict";function h(b,d,e,g,h,k){this._logger=k,this._streamId=b,this._manifestUri=encodeURI(d).replace(/[#]/g,"%23"),this._streamTelemetry=e,this._options=g,this._renderer=null,this._element=null,this._dimensionsChangedMonitor=new f(k),this._lastProgress={time:0,buffered:null,averageLength:0,count:0},this._namedEvents=new c.NamedEvents,this._shaka=h,this._onStalled=a.bind(j,this),this._onProgress=a.bind(i,this),this._onEnded=a.bind(l,this)}function i(){if(this._lastProgress.time=a.now(),0===this._element.buffered.length)return this._logger.debug("[%s] Shaka live stream player progress event fired without any buffered content",this._streamId);var b=this._element.buffered.end(this._element.buffered.length-1);if(this._lastProgress.buffered!==b){if(null!==this._lastProgress.buffered){var c=this._lastProgress.averageLength*this._lastProgress.count,d=c+(b-this._lastProgress.buffered);this._lastProgress.count+=1,this._lastProgress.averageLength=d/this._lastProgress.count}this._lastProgress.buffered=b}}function j(){var b=this;b._logger.info("[%s] Loading Shaka live stream player stream stalled.",b._streamId),0!==b._lastProgress.time&&setTimeout(function(){a.now()-b._lastProgress.time>k.call(b)&&b._waitForLastChunk&&b.stop("ended")},k.call(b))}function k(){return 1.5*this._lastProgress.averageLength<2e3?2e3:1.5*this._lastProgress.averageLength}function l(){this._logger.info("[%s] Shaka live stream player ended.",this._streamId)}function m(){var b;if(!a.isFunction(Uint8Array))throw b="Uint8Array support required for DRM",this._logger.error(b),new Error(b);if(!a.isFunction(window.atob))throw b="window.atob support required for DRM",this._logger.error(b),new Error(b)}function n(a){var b=this;a.getNetworkingEngine().registerResponseFilter(function(c,d){if(c.toString()===b._shaka.net.NetworkingEngine.RequestType.LICENSE.toString()){var e=new Uint8Array(d.data),f=String.fromCharCode.apply(null,e),g=JSON.parse(f),h=g.license,i=window.atob(h);d.data=new Uint8Array(i.length);for(var j=0;j<i.length;++j)d.data[j]=i.charCodeAt(j);g.trackRestrictions&&a.configure({restrictions:g.trackRestrictions})}})}function o(a,b,c){a.drm||(a.drm={}),a.drm.advanced||(a.drm.advanced={}),a.manifest||(a.manifest={}),a.manifest.dash||(a.manifest.dash={}),p.call(this,a,b,c)}function p(a,b,c){function e(b,d){return b?void c(b):(r=d,a.drm.advanced["com.widevine.alpha"]={serverCertificate:q(d),persistentStateRequired:!0,distinctiveIdentifierRequired:!1},void c(null,a))}a.manifest.dash.customScheme=function(a){if("com.phenixrts.widevine"===a.getAttribute("schemeIdUri")||"com.phenixp2p.widevine"===a.getAttribute("schemeIdUri"))return[{keySystem:"com.widevine.alpha",licenseServerUri:decodeURIComponent(a.getAttribute("widevineLicenseServerUrl"))}]},r?e(null,r):d.get(b.widevineServiceCertificateUrl,{mimeType:"text/plain; charset=x-user-defined"},e)}function q(a){for(var b=a.length,c=new Uint8Array(b),d=0;d<b;d++)c[d]=a.charCodeAt(d);return c}var r=null,s=2e6;return h.prototype.on=function(a,b){return this._namedEvents.listen(a,b)},h.prototype.start=function(b){function c(c){d._player.configure(c),d._options.receiveAudio===!1&&(b.muted=!0),a.addEventListener(d._player,"error",function(a){d._namedEvents.fire(g.rendererEvents.error.name,["player",a])}),a.addEventListener(b,"stalled",d._onStalled,!1),a.addEventListener(b,"pause",d._onStalled,!1),a.addEventListener(b,"suspend",d._onStalled,!1),a.addEventListener(b,"progress",d._onProgress,!1),a.addEventListener(b,"ended",d._onEnded,!1),d._player.load(d._manifestUri).then(function(){d._logger.info("[%s] DASH live stream has been loaded",d._streamId),a.isFunction(b.play)&&b.play()})["catch"](function(a){d._logger.error("[%s] Error while loading DASH live stream [%s]",d._streamId,a.code,a),d._namedEvents.fire(g.rendererEvents.error.name,["shaka",a])}),d._dimensionsChangedMonitor.start(this,b),d._element=b}var d=this;d._player=new this._shaka.Player(b),d._streamTelemetry.recordTimeToFirstFrame(b),d._streamTelemetry.recordRebuffering(b),d._streamTelemetry.recordVideoResolutionChanges(this,b);var e={abr:{defaultBandwidthEstimate:s},manifest:{retryParameters:{timeout:1e4}},streaming:{rebufferingGoal:2,bufferingGoal:10,bufferBehind:30,retryParameters:{timeout:1e4,maxAttempts:10,backoffFactor:1.1}}};return this._options.isDrmProtectedContent?(m.call(d),n.call(d,d._player),o.call(d,e,d._options,function(a,b){if(a)throw d._logger.error("Failed to add DRM configuration to shaka player",a),a;c(b)})):c(e),b},h.prototype.stop=function(b,c){var d=this;if(!d._waitingForFinalization){if(c)return d._waitForLastChunk=!0;if(this._dimensionsChangedMonitor.stop(),this._streamTelemetry.stop(),this._player){var f=function(){var b="";d._element&&(a.removeEventListener(d._element,"stalled",d._onStalled,!1),a.removeEventListener(d._element,"pause",d._onStalled,!1),a.removeEventListener(d._element,"suspend",d._onStalled,!1),a.removeEventListener(d._element,"progress",d._onProgress,!1),a.removeEventListener(d._element,"ended",d._onEnded,!1),"Edge"===e.browser&&(d._element.src="")),d._namedEvents.fire(g.rendererEvents.ended.name,[b]),d._player=null,d._element=null};d._player.destroy().then(function(){d._logger.info("[%s] Shaka live stream player has been destroyed",d._streamId)}).then(function(){f()})["catch"](function(a){d._logger.error("[%s] Error while destroying shaka live stream player [%s]",d._streamId,a.code,a),f(),d._namedEvents.fire(g.rendererEvents.error.name,["shaka",a])});d._waitingForFinalization=!0}}},h.prototype.getStats=function(){if(!this._player)return{width:0,height:0,currentTime:0,lag:0,networkState:g.networkStates.networkNoSource.id};var b=a.assign(this._player.getStats(),{currentTime:0,lag:0}),c=a.get(this._element,["currentTime"],0),d=(a.now()-this._options.originStartTime)/1e3,e=Math.max(0,d-c);return this._element&&(b.currentTime=c,b.lag=e),b.estimatedBandwidth>0?b.networkState=g.networkStates.networkLoading.id:b.playTime>0?b.networkState=g.networkStates.networkIdle.id:b.video?b.networkState=g.networkStates.networkEmpty.id:b.networkState=g.networkStates.networkNoSource.id,b},h.prototype.setDataQualityChangedCallback=function(a){b.isFunction(a,"callback"),this.dataQualityChangedCallback=a},h.prototype.getPlayer=function(){return this._player},h.prototype.addVideoDisplayDimensionsChangedCallback=function(a,b){this._dimensionsChangedMonitor.addVideoDisplayDimensionsChangedCallback(a,b)},h}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(7)],e=function(a,b,c){"use strict";function d(a,d,f){b.isStringNotEmpty(a,"type"),b.isObject(d,"stream"),b.isObject(f,"logger"),this._type=a,this._stream=d,this._logger=f,this._onPlayerEnd=null;var g=this;this._stream.on(c.streamEvents.playerEnded.name,function(a){return g._logger.info("[%s] [%s] player ended.",g._stream.getStreamId(),g._type),g._playerEnded=!0,g._onPlayerEnd?g._onPlayerEnd():void g.streamEndedCallback(e(a),a)})}function e(a){switch(a){case"":case"none":case"ended":return"ended";case"server-error":case"session-error":case"not-ready":case"error":case"died":return"failed";case"censored":return"censored";case"maintenance":return"maintenance";case"capacity":return"capacity";case"app-background":return"app-background";default:return"custom"}}return d.prototype.on=function(a,b){return this._stream.on(a,b)},d.prototype.streamErrorCallback=function(b,c){a.isFunction(this._stream.streamErrorCallback)?(this._logger.debug("[%s] [%s] live stream error event [%s]",this._stream.getStreamId(),this._type,c),this._stream.streamErrorCallback(this._stream,b,c)):this._logger.error("[%s] [%s] live stream error event [%s]",this._stream.getStreamId(),this._type,c)},d.prototype.streamEndedCallback=function(b,c,d){var e=this._stream.getRenderer();if(!this._isStreamEnded){if(d&&!this._onPlayerEnd&&this._stream.isActive()&&e&&!this._playerEnded)return this._onPlayerEnd=a.bind(this.streamEndedCallback,this,b,c),this._logger.info("[%s] [%s] stream ended. Waiting for end of player.",this._stream.getStreamId(),this._type),void(e&&e.stop(c,d));this._isStreamEnded=!0,a.isFunction(this._stream.streamEndedCallback)&&this._stream.streamEndedCallback(this._stream,b,c),this._stream.stop(),e&&e.stop(c,d)}},d.prototype.dataQualityChangedCallback=function(a,b){var c=this._stream.getRenderer();c&&"function"==typeof c.dataQualityChangedCallback&&c.dataQualityChangedCallback(c,a,b)},d.prototype.getPhenixMediaStream=function(){return this._stream},d}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[],e=function(){"use strict";var a={errorSeverity:{recoverable:{id:1,name:"RECOVERABLE"},critical:{id:2,name:"CRITICAL"}}};return a}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(12),c(2),c(29)],e=function(a,b,c,d,e){function f(f){b.isString(f,"uri"),this._loggingUrl="/telemetry/metrics",this._domain=location.hostname,this._isEnabled=!0,this._browser=(d.browser||"Browser")+"/"+(d.browserVersion||"?"),this._batchHttpProtocol=new c.BatchHttpProto(f+this._loggingUrl,[e],"telemetry.SubmitMetricRecords",{maxAttempts:3,maxBufferedRecords:1e3,maxBatchSize:512}),this._batchHttpProtocol.on("capacity",a.bind(h,this))}function g(b,c){var d=a.assign({},c,{metric:b,timestamp:a.isoString(),sessionId:this._mostRecentSessionId,streamId:this._mostRecentStreamId,source:this._browser,fullQualifiedName:this._domain,environment:this._mostRecentEnvironment,version:this._mostRecentVersion,runtime:this._mostRecentRuntime});this._batchHttpProtocol.addRecord(d)}function h(b){this._batchHttpProtocol.addRecordToBeginning({metric:"MetricDropped",value:{uint64:b},timestamp:a.isoString(),sessionId:this._mostRecentSessionId,streamId:this._mostRecentStreamId,source:this._browser,fullQualifiedName:this._domain,environment:this._mostRecentEnvironment,version:this._mostRecentVersion,runtime:this._mostRecentRuntime})}return f.prototype.isEnabled=function(){return this._isEnabled},f.prototype.setEnabled=function(a){b.isBoolean(a,"enabled"),this._isEnabled=a},f.prototype.submitMetric=function(a,c,d,e,f,h,i){this._isEnabled&&(b.isStringNotEmpty(a,"metric"),b.isObject(i,"value"),this._mostRecentRuntime=c,this._mostRecentSessionId=d,this._mostRecentStreamId=e,this._mostRecentEnvironment=f,this._mostRecentVersion=h,g.call(this,a,i))},f}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(5),c(3)],e=function(a,b,c,d){function e(a){return b.isObject(a,"logger"),this._logger=a,this._namedEvents=new c.NamedEvents,this._disposables=new d.DisposableList,this._disposables.add(this._namedEvents),this.isSupported()?(this._lastNetworkStats=f.call(this),void g.call(this)):this._logger.info("Network monitor is not supported.")}function f(){return{downlinkThroughputCapacity:this.getDownlinkThroughputCapacity(),effectiveType:this.getEffectiveType(),rtt:this.getRoundTripTime()}}function g(){var a=this;navigator.connection.addEventListener("change",function(){a._namedEvents.fireAsync("NetworkChange",[f.call(a),a._lastNetworkStats]),a._lastNetworkStats=f.call(a)})}return e.prototype.isSupported=function(){return window.navigator&&window.navigator.connection},e.prototype.getDownlinkThroughputCapacity=function(){return this.isSupported()?window.navigator.connection.downlink||window.navigator.connection.downlinkMax:-1},e.prototype.getEffectiveType=function(){return this.isSupported()?window.navigator.connection.effectiveType||window.navigator.connection.type:"Unknown"},e.prototype.getRoundTripTime=function(){return this.isSupported()?window.navigator.connection.rtt||window.navigator.connection.type:-1},e.prototype.onNetworkChange=function(a){if(this.isSupported())return b.isFunction(a,"callback"),this._namedEvents.listen("NetworkChange",a)},e.prototype.dispose=function(){this._disposables.dispose()},e}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(3),c(89),c(86),c(2)],e=function(a,b,c,d,e,f){"use strict";function g(b,f){this._environment=t,this._version=u,this._sessionId=null,this._properties={resource:"Session",kind:"Event"},this._logger=b,this._metricsTransmitter=f,this._networkMonitor=new e(this._logger),this._start=a.now(),this._disposables=new c.DisposableList,this._records=[],this._disposables.add(d.onBackground(a.bind(i,this,!1))),this._disposables.add(d.onForeground(a.bind(i,this,!0))),this._networkMonitor.isSupported()&&(this._disposables.add(this._networkMonitor.onNetworkChange(a.bind(n,this))),this._disposables.add(this._networkMonitor),j.call(this),m.call(this),l.call(this))}function h(){var a=d.isForeground(),b=d.getTimeSinceLastChange(),c=a?"ApplicationForeground":"ApplicationBackground";this.recordMetric(c,{uint64:b}),o.call(this,"Session has started in the [%s] after [%s] ms",a?"foreground":"background",b)}function i(a,b){var c=a?"ApplicationForeground":"ApplicationBackground";this.recordMetric(c,{uint64:b}),o.call(this,"Application has gone into the [%s] after [%s] ms",a?"foreground":"background",b)}function j(){var a=this._networkMonitor.getEffectiveType();this.recordMetric("NetworkType",{string:a},null,{resource:f.browser}),o.call(this,"[%s] has started with Network effective type of [%s]",this._sessionId?"Session":"Application",a)}function k(a,b){var c=a||this._networkMonitor.getEffectiveType(),d=b;this.recordMetric("NetworkType",{string:c},{string:d},{resource:f.browser}),o.call(this,"Network effective type has changed to [%s] from [%s]",c,d||"New")}function l(b,c){var d=b||this._networkMonitor.getRoundTripTime(),e=c||-1;return this.recordMetric("RoundTripTime",{uint32:d},{uint32:e},{resource:f.browser}),a.isNullOrUndefined(c)?o.call(this,"Network RTT [%s]",d):void o.call(this,"Network RTT changed to [%s] from [%s]",d,e)}function m(b,c){var d=b||this._networkMonitor.getDownlinkThroughputCapacity(),e=c||-1;return this.recordMetric("DownlinkThroughputCapacity",{uint64:d},{uint64:e},{resource:f.browser}),a.isNullOrUndefined(c)?o.call(this,"Network downlink throughput capacity [%s]",d):void o.call(this,"Network downlink throughput capacity changed to [%s] from [%s]",d,e)}function n(a,b){b.downlinkThroughputCapacity!==a.downlinkThroughputCapacity&&m.call(this,a.downlinkThroughputCapacity,b.downlinkThroughputCapacity),b.rtt!==a.rtt&&l.call(this,a.rtt,b.rtt),b.effectiveType!==a.effectiveType&&k.call(this,a.effectiveType,b.effectiveType)}function o(){var b=Array.prototype.slice.call(arguments);if(0===b.length)throw new Error("Invalid logging arguments.");var c="[%s] [SessionTelemetry] [%s] ",d=c+b[0],e=b.slice(1),f=[d,this._sessionId,a.now()-this._start].concat(e);this._logger.debug.apply(this._logger,f)}function p(){var b=a.now();return(b-s)/1e3}function q(c,d){if(b.isStringNotEmpty(c.metric,"record.metric"),!this._sessionId)return this._records.push({record:c,since:d});var e=a.assign({},this._properties,c);this._metricsTransmitter.submitMetric(c.metric,d,this._sessionId,null,this._environment,this._version,e)}function r(){if(this._sessionId)for(var a=this,b=this._records.length;b>0;){var c=this._records.splice(b-1,1);1===c.length&&q.call(a,c[0].record,c[0].since),b--}}var s=window.__phenixPageLoadTime||window.__pageLoadTime||a.now(),t="production",u="2018-01-13T00:05:28Z";return g.prototype.setSessionId=function(a){!a&&this._sessionId&&q.call(this,{metric:"Stopped",elapsed:this.elapsed()},p()),this._sessionId=a,a&&(q.call(this,{metric:"Initialized",elapsed:this.elapsed()},p()),r.call(this),h.call(this),this._networkMonitor.isSupported()&&(j.call(this),m.call(this),l.call(this)))},g.prototype.setProperty=function(a,c){b.isStringNotEmpty(a,"name"),b.isStringNotEmpty(c,"value"),this._properties[a]=c},g.prototype.recordMetric=function(c,d,e,f){b.isStringNotEmpty(c,"metric");var g=a.assign({},{metric:c,elapsed:this.elapsed(),value:d,previousValue:e},f||{});q.call(this,g,p())},g.prototype.elapsed=function(){var b=a.now();return b-this._start},g.prototype.stop=function(){this._disposables.dispose(),this.recordMetric("Stopped"),o.call(this,"Session telemetry stopped")},g}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(3),c(2)],e=function(a,b,c,d){"use strict";function e(d,e,g){b.isStringNotEmpty(d,"sessionId"),this._environment=j,this._version=k,this._sessionId=d,this._properties={},this._logger=e,this._metricsTransmitter=g,this._start=a.now(),this._disposables=new c.DisposableList,f.call(this,"Stream initializing")}function f(){var b=Array.prototype.slice.call(arguments);if(0===b.length)throw new Error("Invalid logging arguments.");var c="[%s] [StreamTelemetry] [%s] ",d=c+b[0],e=b.slice(1),f=[d,this._streamId,a.now()-this._start].concat(e);this._logger.debug.apply(this._logger,f)}function g(){var b=a.now();return(b-i)/1e3}function h(c,d){b.isStringNotEmpty(c.metric,"record.metric");var e=a.assign({},this._properties,c);this._metricsTransmitter.submitMetric(c.metric,d,this._sessionId,this._streamId,this._environment,this._version,e)}var i=window.__phenixPageLoadTime||window.__pageLoadTime||a.now(),j="production",k="2018-01-13T00:05:28Z";return e.prototype.setProperty=function(a,c){b.isStringNotEmpty(a,"name"),b.isStringNotEmpty(c,"value"),this._properties[a]=c},e.prototype.recordMetric=function(c,d,e,f){b.isStringNotEmpty(c,"metric");var i=a.assign({},{metric:c,elapsed:this.elapsed(),value:d,previousValue:e},f||{});h.call(this,i,g())},e.prototype.setStreamId=function(c){if(b.isStringNotEmpty(c,"streamId"),this._streamId)throw new Error("Stream ID can only be set once.");this._streamId=c;var d=a.now();h.call(this,{metric:"Initialized",elapsed:this.elapsed()-d+this._start},g()-(d-this._start)/1e3)},e.prototype.setStartOffset=function(a){if(b.isNumber(a,"startOffset"),this._startOffset)throw new Error("Start offset can only be set once.");this._startOffset=a,this.recordMetric("Offset",{uint64:a})},e.prototype.getStartOffset=function(){return this._startOffset},e.prototype.elapsed=function(){var b=a.now();return b-this._start},e.prototype.stop=function(){this._disposables.dispose(),this.recordMetric("Stopped"),f.call(this,"Stream stopped")},e.prototype.recordTimeToFirstFrame=function(b){var d,e=this,g=a.now(),h=function(){d||(d=a.now()-g,e.recordMetric("TimeToFirstFrame",{uint64:d}),f.call(e,"First frame [%s]",d),i.dispose())};a.addEventListener(b,"loadeddata",h);var i=new c.Disposable(function(){a.removeEventListener(b,"loadeddata",h)});this._disposables.add(i)},e.prototype.recordVideoResolutionChanges=function(a,b){var c=this,d={width:b.videoWidth,height:b.videoHeight};a.addVideoDisplayDimensionsChangedCallback(function(a,b){d.width===b.width&&d.height===b.height||(c.recordMetric("ResolutionChanged",{string:b.width+"x"+b.height},{string:d.width+"x"+d.height}),d={width:b.width,height:b.height},f.call(c,"Resolution changed: width [%s] height [%s]",b.width,b.height))})},e.prototype.recordRebuffering=function(b){var e,g,h=this,i=function(){e||(h.recordMetric("Stalled"),e=a.now(),f.call(h,"[buffering] Stream has stalled"))},j=function(c){var i=b.buffered.length,j=!("playing"===c.type||i>0)||("progress"===c.type||"timeupdate"===c.type)&&b.buffered.end(i-1)===g;if(e&&(i||"Edge"===d.browser)&&!j){"progress"===c.type&&(g=b.buffered.end(i-1));var k=a.now()-e;h.recordMetric("Buffering",{uint64:k}),h.recordMetric("Playing"),f.call(h,"[buffering] Stream has recovered from stall after [%s] milliseconds",k),e=null}};a.addEventListener(b,"stalled",i),a.addEventListener(b,"pause",i),a.addEventListener(b,"suspend",i),a.addEventListener(b,"play",j),a.addEventListener(b,"playing",j),a.addEventListener(b,"progress",j),a.addEventListener(b,"timeupdate",j),this._disposables.add(new c.Disposable(function(){a.removeEventListener(b,"stalled",i),a.removeEventListener(b,"pause",i),a.removeEventListener(b,"suspend",i),a.removeEventListener(b,"play",j),a.removeEventListener(b,"playing",j),a.removeEventListener(b,"progress",j),a.removeEventListener(b,"timeupdate",j)}))},e}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(5),c(3)],e=function(a,b,c,d){function e(){this._namedEvents=new c.NamedEvents,this._timeOfLastTabFocusChange=a.now(),this._disposables=new d.DisposableList,this._isForeground=!0,this._disposables.add(this._namedEvents),f.call(this)}function f(){return g()?h.call(this):void i.call(this)}function g(){return"undefined"!=typeof chrome&&chrome.extension&&chrome.extension.onRequest}function h(){if(g()){var a=this;chrome.extension.onRequest.addListener(function(b,c,d){"is_selected"===b&&chrome.tabs.getSelected(null,function(b){var e=b.id===c.tab.id;k.call(a,e),d(e?!0:!1)})})}}function i(){function b(){var a=!document[c];k.call(f,a)}var c,e,f=this;"undefined"!=typeof document.hidden?(c="hidden",e="visibilitychange"):"undefined"!=typeof document.msHidden?(c="msHidden",e="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(c="webkitHidden",e="webkitvisibilitychange"),"undefined"!=typeof document.addEventListener&&"undefined"!=typeof document[c]?(a.addEventListener(document,e,b,!1),f._disposables.add(new d.Disposable(function(){a.removeEventListener(document,e,b,!1)}))):j.call(f)}function j(){var b=this;b._documentFocusInterval=setInterval(function(){var a=document.hasFocus();k.call(b,a)},m),b._disposables.add(new d.Disposable(function(){a.isNumber(b._documentFocusInterval)&&clearInterval(b._documentFocusInterval),b._documentFocusInterval=null}))}function k(a){if(b.isBoolean(a,"isForeground"),this._isForeground!==a)return a?(this._isForeground=!0,l.call(this,"foreground")):(this._isForeground=!1,l.call(this,"background"))}function l(b){var c=a.now(),d=c-this._timeOfLastTabFocusChange;this._timeOfLastTabFocusChange=c,this._namedEvents.fire(b,[d])}var m=3e3;return e.prototype.isForeground=function(){return this._isForeground},e.prototype.getTimeSinceLastChange=function(){return a.now()-this._timeOfLastTabFocusChange},e.prototype.onForeground=function(a){return b.isFunction(a,"callback"),this._namedEvents.listen("foreground",a)},e.prototype.onBackground=function(a){return b.isFunction(a,"callback"),this._namedEvents.listen("background",a)},new e}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(28),c(85)],e=function(a,b,c,d){function e(){this._metricsTransmitters={}}function f(a){var b=new d(a);return a||b.setEnabled(!1),b}var g={urls:{local:"",staging:"https://telemetry-stg.phenixp2p.com",production:"https://telemetry.phenixp2p.com"}};return e.prototype.createMetricsTransmitter=function(a){var b=c.parseEnvFromPcastBaseUri(a||""),d=g.urls[b];return this._metricsTransmitters[b]||(this._metricsTransmitters[b]=f.call(this,d)),this._metricsTransmitters[b]},new e}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(4),c(2)],e=function(a,b,c,d){"use strict";function e(e,h){e=e||{},b.isObject(e,"options"),b.isObject(h,"logger"),this._logger=h,
this._screenSharingExtensionId=e.screenSharingExtensionId||s(),this._screenSharingAddOn=e.screenSharingAddOn||u,this._screenSharingEnabled=!1,this._isInitializedObservable=new c.Observable((!1)),"Chrome"===d.browser&&this._screenSharingExtensionId&&j.call(this),g.call(this,a.bind(f,this))}function f(a){this._isInitializedObservable.setValue(!0),this._screenSharingEnabled=a}function g(a){var b=this;if("Chrome"===d.browser&&b._screenSharingExtensionId){var c=r.call(this);if(!c)return a(!1);try{c.sendMessage(b._screenSharingExtensionId,{type:"version"},function(c){c&&"ok"===c.status?(b._logger.info("Screen sharing enabled using version [%s]",c.version),a(!0)):(b._logger.info("Screen sharing NOT available"),a(!1))})}catch(e){e.message&&b._logger.warn(e.message,e),a(!1)}}else a("Firefox"===d.browser&&d.browserVersion>=x?!0:"Firefox"===d.browser&&"object"==typeof window.PCastScreenSharing?!0:!1)}function h(a){if(this._isInitializedObservable.getValue())return a();var b=this._isInitializedObservable.subscribe(function(){return b.dispose(),a()})}function i(){return"https://chrome.google.com/webstore/detail/"+this._screenSharingExtensionId}function j(){for(var a=i.call(this),b=document.getElementsByTagName("link"),c=0;c<b.length;c++)if(b[c].href===a)return;this._logger.debug("Adding Chrome Web Store link [%s]",a);var d=document.createElement("link");d.rel="chrome-webstore-item",d.href=a,document.getElementsByTagName("head")[0].appendChild(d)}function k(b,c){switch(d.browser){case"Chrome":return l.call(this,function(d,e){return d||e&&"ok"!==e.status?c(d,e):(e.data||e.options||(e.options={canRequestAudioTrack:!0}),e.data&&a.hasIndexOrKey(e.data,"hasAudio")&&!e.options&&(e.options={canRequestAudioTrack:e.data.hasAudio}),void c(null,{status:"ok",constraints:m(b,e.streamId,e.options)}))});case"Firefox":c(null,{status:"ok",constraints:n(b)});break;default:c(new Error("not-supported"),{status:"not-supported"})}}function l(a){var b=this,c=r.call(this);if(!c)return a(new Error("not-available"));try{c.sendMessage(b._screenSharingExtensionId,{type:"get-desktop-media",sources:["screen","window","tab","audio"]},function(b){return"ok"!==b.status?a(new Error(b.status),b):void a(null,b)})}catch(d){d.message&&b._logger.warn(d.message),a(d,{status:"failed"})}}function m(b,c,d){var e={};return a.isObject(b)&&a.isObject(b.screen)&&(e.video=b.screen),a.isObject(b)&&a.isObject(b.screenAudio)&&d.canRequestAudioTrack&&(e.audio=b.screenAudio),b.screen&&a.set(e,["video","mandatory"],{chromeMediaSource:"desktop",chromeMediaSourceId:c}),b.screenAudio&&d.canRequestAudioTrack&&a.set(e,["audio","mandatory"],{chromeMediaSource:"system",chromeMediaSourceId:c}),e}function n(a,b){var c={video:{}};return"object"==typeof a&&"object"==typeof a.screen&&(c.video=a.screen),b&&(c.video.mediaSourceId=b),c.video.mediaSource=c.video.mediaSource||"window",c}function o(a){var b=this;if(!b._screenSharingEnabled){var c=function(c,d){return"cancelled"===d?a(null,{status:"cancelled"}):"ok"!==d?a(new Error("screen-sharing-installation-failed"),{status:d}):void g.call(b,function(c){return b._screenSharingEnabled=c,b._screenSharingEnabled?void a(null,{status:"ok"}):a(new Error("screen-sharing-installation-failed"),{status:d})})};switch(d.browser){case"Chrome":p.call(b,c);break;case"Firefox":q.call(b,c);break;default:a(new Error("not-supported"),{status:"not-supported"})}}}function p(a){var b=this,c=i.call(this);try{chrome.webstore.install(c,function(){return a(null,"ok")},function(c){if(c){if(c.match(/cancelled/gi))return b._logger.info("User cancelled screen sharing"),a(new Error(c),"cancelled");b._logger.warn(c)}return a(new Error(c||"failed"),"failed")})}catch(d){d.message&&b._logger.warn(d.message),a(d,"failed")}}function q(a){try{var b,c={"PCast Screen Sharing":{URL:this._screenSharingAddOn.url,IconURL:this._screenSharingAddOn.iconUrl,Hash:this._screenSharingAddOn.hash,toString:function(){return this.URL}}},d=w,e=function(){b&&clearInterval(b),a(null,"ok")},f=function(){b&&clearInterval(b),a(new Error("failed"),"failed")};b=setInterval(function(){return"object"==typeof window.PCastScreenSharing?e():d--<0?f():void 0},v),InstallTrigger.install(c,function(a,b){0===b?e():f()})}catch(g){g.message&&this._logger.warn(g.message),a("failed",g)}}function r(){var a=this;switch(d.browser){case"Chrome":return"undefined"!=typeof chrome&&chrome.runtime&&chrome.runtime.sendMessage?chrome.runtime:(a._logger.info("Screen sharing NOT available"),null);case"Firefox":default:return null}}function s(){switch(d.browser){case"Chrome":return t;case"Firefox":default:return""}}var t="icngjadgidcmifnehjcielbmiapkhjpn",u=a.freeze({url:"https://addons.mozilla.org/firefox/downloads/file/474686/pcast_screen_sharing-1.0.3-an+fx.xpi",iconUrl:"https://phenixp2p.com/public/images/phenix-logo-unicolor-64x64.png",hash:"sha256:4972e9718ea7f7c896abc12d1a9e664d5f3efe498539b082ab7694f9d7af4f3b"}),v=100,w=450,x=52;return e.prototype.isScreenSharingEnabled=function(a){var b=this;return h.call(this,function(){return a(b._screenSharingEnabled)})},e.prototype.installExtension=function(b){return h.call(this,a.bind(o,this,b))},e.prototype.getScreenSharingConstraints=function(b,c){return h.call(this,a.bind(k,this,b,c))},e.prototype.toString=function(){return"ScreenShareExtensionManager["+d.browser+"]"},e}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(0),c(1),c(2)],e=function(a,b,c){"use strict";function d(a,c,d){b.isObject(a,"logger"),b.isObject(c,"screenShareExtensionManager"),d&&b.isFunction(d,"onScreenShare"),this._logger=a,this._screenShareExtensionManager=c,this._onScreenShare=d}function e(a,b){var c=this,d=function(a,d){c._gumStreams&&c._gumStreams.push(d),b(c,a,d)},e=function(d,e,f){a.screenAudio&&c._logger.warn("Screen capture with audio is only supported on Windows or Chrome OS."),b(c,d,e,f)},g=a.screen||a.screenAudio,h=a.video||a.audio;return g&&h?f.call(c,{screen:a.screen},function(b,g){return f.call(c,{audio:a.audio,video:a.video},function(a,b){i(b,g.getTracks()),d(a,b)},function(a,b,c){l(g),e(a,b,c)})},e):f.call(c,a,d,e)}function f(a,b,d){var e=this,f=function(){d("cancelled",null)},i=function(a){d(n(a),void 0,a)},j=function(a){h.call(e,a),b("ok",a)};return g.call(this,a,function(b,d){if("cancelled"===d.status)return f();if("ok"!==d.status)return i(b);var g=d.constraints;if(e._onScreenShare&&(a.screen||a.screenAudio)&&"Chrome"===c.browser&&(g=e._onScreenShare(g),!g))throw new Error("onScreenShare must return an object of user media constraints");try{c.getUserMedia(g,j,i)}catch(h){i(h)}})}function g(a,b){var c=this;if(a.screen)return c._screenShareExtensionManager.isScreenSharingEnabled(function(d){return d?c._screenShareExtensionManager.getScreenSharingConstraints(a,b):c._screenShareExtensionManager.installExtension(function(d,e){return d||e&&"ok"!==e.status?b(d,e):c._screenShareExtensionManager.getScreenSharingConstraints(a,b)})});var d={audio:a.audio||!1,video:a.video||!1};b(null,{status:"ok",constraints:d})}function h(b){var c={},d=this;setTimeout(function e(){j(b)||(a.forEach(b.getTracks(),function(e){a.hasIndexOrKey(c,e.id)&&c[e.id]!==e.enabled&&(e.dispatchEvent(new window.Event("StateChange")),d._logger.info("[%s] Detected track [%s] enabled change of [%s]",b.id,e.id,e.enabled)),c[e.id]=e.enabled}),setTimeout(e,m))},m)}function i(b,c){b&&a.isFunction(b.addTrack)&&a.forEach(c,function(a){b.addTrack(a)})}function j(b){return a.reduce(b.getTracks(),function(a,b){return a&&k(b)},!0)}function k(a){return b.isNotUndefined(a,"track"),"ended"===a.readyState}function l(b){if(b&&a.isFunction(b.stop)&&b.stop(),b&&a.isFunction(b.getTracks))for(var c=b.getTracks(),d=0;d<c.length;d++){var e=c[d];e.stop()}}var m=2e3;d.prototype.getUserMedia=function(a,c){b.isObject(a,"options"),b.isFunction(c,"callback"),e.call(this,a,c)};var n=function(a){var b;return b="unavailable"===a.code?"conflict":"permission-denied"===a.message?"permission-denied":"PermissionDeniedError"===a.name?"permission-denied":"InternalError"===a.name&&"Starting video failed"===a.message?"conflict":"SourceUnavailableError"===a.name?"conflict":"SecurityError"===a.name&&"The operation is insecure."===a.message?"permission-denied":"failed"};return d}.apply(b,d),!(void 0!==e&&(a.exports=e))},function(a,b){},function(a,b,c){"use strict";var d,e;d=[c(2),c(8),c(17),c(19),c(36),c(37),c(20),c(18),c(38)],e=function(a,b,c,d,e,f,g,h,i){return window.PhenixPCast=c,{PCast:c,RoomService:d,AudioSpeakerDetector:e,BandwidthMonitor:f,UserMediaResolver:g,logging:b,RTC:a,express:{PCastExpress:h,RoomExpress:i}}}.apply(b,d),!(void 0!==e&&(a.exports=e))}])});